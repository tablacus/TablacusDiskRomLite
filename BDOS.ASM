_ERROR:
	LD	B,0
	AND	A
	RET

ROM_BDOS:
	PUSH	HL
	LD	A,C
	CP	07FH
	JR	C,_ERROR
	ADD	A,A
	LD	L,A
	LD	H,high STABLE
	LD	A,(HL)
	INC	L
	LD	H,(HL)
	LD	L,A
	EX	(SP),HL
	LD	A,C
	RET

_SYS0F:		;(BDOS)ファイルのオープン
	PUSH	DE
	POP	IY
	INC	DE
	EX	DE,HL
	LD	BC,8+3
	LDIR
	CALL	ROM_OPEN_0F
	JR	C,SCF_FF_RET
;				Open(Read)
	LD	(IY+28),0FFH
;				FILENAME
	PUSH	IY
	POP	DE
	INC	DE
	LD	BC,11
	LDIR
;				Attribute
	LD	A,(HL)
	LD	(IY+13),A
;				TIME
	LD	DE,11
	ADD	HL,DE
	LD	A,(HL)
	INC	HL
	LD	(IY+22),A
	LD	A,(HL)
	INC	HL
	LD	(IY+23),A
;				DATE
	LD	A,(HL)
	INC	HL
	LD	(IY+20),A
	LD	A,(HL)
	INC	HL
	LD	(IY+21),A
;				First cluster
	LD	A,(HL)
	INC	HL
	LD	(IY+26),A
	LD	A,(HL)
	INC	HL
	LD	(IY+27),A
;				SIZE
	LD	A,(HL)
	INC	HL
	LD	(IY+16),A
	LD	A,(HL)
	INC	HL
	LD	(IY+17),A
	LD	A,(HL)
	INC	HL
	LD	(IY+18),A
	LD	A,(HL)
	LD	(IY+19),A
	XOR	A
	LD	(IY+12),A
;	LD	(OFCB+1),IY
FEND:
	SBC	A,A		;CF=0 A=0 : CF=1 A=0FFH
FENDE:
	POP	IY
	POP	BC
	POP	DE
	POP	HL
	RET

_SYS10:
	XOR	A
	RET

SCF_FF_RET:
	SCF
	SBC	A,A
	RET

_SYS1A:		;(BDOS)DTAの設定
	LD	(_DTA),DE
	XOR	A
	RET

_SYS27:
	PUSH	HL
	POP	IY
	LD	A,(IY+28)
	CP	0FFH
	JR	NZ,SCF_FF_RET
	INC	DE
	EX	DE,HL
	LD	BC,8+3
	LDIR
	LD	L,(IY+26)
	LD	H,(IY+27)
	LD	(_CLPS),HL
	LD	L,(IY+33)
	LD	H,(IY+34)
	LD	(RR_LOW),HL
	LD	L,(IY+35)
	LD	H,(IY+36)
	LD	(RR_HIGH),HL
	POP	HL
	CALL	ROM_READ
	LD	HL,(RR_LOW)
	LD	(IY+33),L
	LD	(IY+34),H
	LD	HL,(RR_HIGH)
	LD	(IY+35),L
	LD	(IY+36),H
	SBC	A,A
	RET

_SYS2F:
	LD	B,H
	LD	HL,(_DTA)
	JP	DISKIO

	DS	05F00H-$
STABLE:
;0
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_SYS0F
;1
	DW	_SYS10,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_SYS1A,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
;2
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_SYS27
;3
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_SYS2F
;4
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
;5
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
;6
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
;7
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR
	DW	_ERROR,_ERROR,_ERROR,_ERROR

