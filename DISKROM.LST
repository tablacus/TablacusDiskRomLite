                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       005C                     LDIRVM  EQU 0005CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       0138                     RSLREG  EQU 00138H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F676                     TXTTAB  EQU 0F676H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7C5                     FBUFFR  EQU 0F7C5H
                                
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
       F871                     FILNM2  EQU 0F871H
                                
       FB03                     RSTMP   EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                
       FB03                     ISC EQU RSTMP
                                
       FF46                     _DTA    EQU H_GONE+3
                                
       F7C5                     _RESULT EQU FBUFFR
       F7C6                     RR_LOW  EQU FBUFFR+1
       F7C8                     RR_HIGH EQU FBUFFR+3
       F7CA                     _CLPS   EQU FBUFFR+5
       F7CC                     _LEFT   EQU FBUFFR+7
       F7CE                     LEFTX   EQU FBUFFR+9
       F7D0                     DTAX    EQU FBUFFR+11
       F7D2                     _DTPS   EQU FBUFFR+13
       F7D4                     _BANK   EQU FBUFFR+15
       F7D5                     _BUF    EQU FBUFFR+16
       F7D6                     _BUF_ST EQU FBUFFR+17
       F7D8                     _BUF_EN EQU FBUFFR+19
       F7DA                     _BUF_EX EQU FBUFFR+21
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       6200                     _FATBF  EQU BANK1_ADR+512       ;FATの先頭
       6E00                     _DIRBF  EQU BANK1_ADR+(1+3*2)*512   ;ディレクトリの先頭
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C32147          10      JP  DISKIO
000013 4013 C35047          10      JP  DSKCHG
000016 4016 C3A647          10      JP  GETDPB
000019 4019 C38E48          10      JP  CHOICE
00001C 401C C39248          10      JP  DSKFMT
00001F 401F C39448          10      JP  DSKSTP
                                ;   JP  BASENT
                                ;   SCF
                                ;   JP  DSKFMT
                                ;   JP  DSKSTP
                                ;   NOP
                                ;   JP  GETSLT
                                ;   LD  HL,(0F34BH)
                                ;   RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.0.0.2",0
            204449534B20524F    
            4D204C6974652076    
            302E302E302E3200    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3EFF             7      LD  A,0FFH
000102 4102 3299FD          13      LD  (DEVICE),A
                                
000105 4105 213542          10      LD  HL,AT_ISC
000108 4108 1103FB          10      LD  DE,ISC
00010B 410B 011A00          10      LD  BC,ISC_E-ISC
00010E 410E EDB0                    LDIR
                                
000110 4110 3EC3             7      LD  A,0C3H      ;JP
000112 4112 3243FF          13      LD  (H_GONE),A
000115 4115 327DF3          13      LD  (BDOS),A
000118 4118 2103FB          10      LD  HL,ISC
00011B 411B 2244FF          16      LD  (H_GONE+1),HL
00011E 411E 2131F3          10      LD  HL,H_BDOS
000121 4121 227EF3          16      LD  (BDOS+1),HL
                                
000124 4124 3E                      DB  03EH
000125 4125 F7              12      RST 30H
000126 4126 3271FE          13      LD  (H_BINS),A
000129 4129 3276FE          13      LD  (H_BINL),A
00012C 412C 327BFE          13      LD  (H_FILE),A
00012F 412F 3231F3          13      LD  (H_BDOS),A
000132 4132 32DAFE          13      LD  (H_STKE),A
                                
000135 4135 CDE441          17      CALL    GTSL1_
000138 4138 3216FB          13      LD  (ROM_SLT),A
00013B 413B 3272FE          13      LD  (H_BINS+1),A
00013E 413E 3277FE          13      LD  (H_BINL+1),A
000141 4141 327CFE          13      LD  (H_FILE+1),A
000144 4144 3232F3          13      LD  (H_BDOS+1),A
000147 4147 32DBFE          13      LD  (H_STKE+1),A
00014A 414A 3248F3          13      LD  (MASTERS),A
                                
00014D 414D 210743          10      LD  HL,ROM_LOAD
000150 4150 2273FE          16      LD  (H_BINS+2),HL
000153 4153 215443          10      LD  HL,ROM_BLOAD
000156 4156 2278FE          16      LD  (H_BINL+2),HL
000159 4159 21B143          10      LD  HL,ROM_FILES
00015C 415C 227DFE          16      LD  (H_FILE+2),HL
00015F 415F 21B248          10      LD  HL,ROM_BDOS
000162 4162 2233F3          16      LD  (H_BDOS+2),HL
000165 4165 218A42          10      LD  HL,ROM_STKE
000168 4168 22DCFE          16      LD  (H_STKE+2),HL
                                
00016B 416B 3E                      DB  03EH
00016C 416C C9              10      RET
00016D 416D 327FFE          13      LD  (H_FILE+4),A
000170 4170 3275FE          13      LD  (H_BINS+4),A
000173 4173 327AFE          13      LD  (H_BINL+4),A
000176 4176 3235F3          13      LD  (H_BDOS+4),A
000179 4179 32DEFE          13      LD  (H_STKE+4),A
                                
00017C 417C AF               4      XOR A
00017D 417D 320068          13      LD  (BANK1_SEL),A
000180 4180 3A0060          13      LD  A,(BANK1_ADR)
000183 4183 FE41             7      CP  'A'
000185 4185 204C            12      JR  NZ,NOT_8K_BANK
000187 4187 3E01             7      LD  A,DISK_BANK
000189 4189 320068          13      LD  (BANK1_SEL),A
                                
00018C 418C CD3801          17      CALL    RSLREG      ;read primary slot #
00018F 418F 07               4      RLCA
000190 4190 07               4      RLCA
000191 4191 F5              11      PUSH    AF
000192 4192 CDE941          17      CALL    GTSL2_
000195 4195 3244F3          13      LD  (RAMAD3),A
000198 4198 F1              10      POP AF  
000199 4199 CDE941          17      CALL    GTSL2_
00019C 419C 3243F3          13      LD  (RAMAD2),A
00019F 419F 3242F3          13      LD  (RAMAD1),A
0001A2 41A2 3241F3          13      LD  (RAMAD0),A
                                
0001A5 41A5 3A43F3          13      LD  A,(RAMAD2)
0001A8 41A8 210080          10      LD  HL,08000H
0001AB 41AB CD0042          17      CALL    CHK_RAM
0001AE 41AE 2804            12      JR  Z,RAMCHK2
0001B0 41B0 AF               4      XOR A
0001B1 41B1 3243F3          13      LD  (RAMAD2),A
       41B4                     RAMCHK2:
0001B4 41B4 3A42F3          13      LD  A,(RAMAD1)
0001B7 41B7 210040          10      LD  HL,04000H
0001BA 41BA CD0042          17      CALL    CHK_RAM
0001BD 41BD 2804            12      JR  Z,RAMCHK1
0001BF 41BF AF               4      XOR A
0001C0 41C0 3242F3          13      LD  (RAMAD1),A
       41C3                     RAMCHK1:
0001C3 41C3 3A41F3          13      LD  A,(RAMAD0)
0001C6 41C6 210000          10      LD  HL,00000H
0001C9 41C9 CD0042          17      CALL    CHK_RAM
0001CC 41CC 2804            12      JR  Z,RAMCHK0
0001CE 41CE AF               4      XOR A
0001CF 41CF 3241F3          13      LD  (RAMAD0),A
       41D2                     RAMCHK0:
0001D2 41D2 C9              10      RET
       41D3                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
0001D3 41D3 21B942          10      LD  HL,MSG_ERROR_ROM_MODE
0001D6 41D6 CD5242          17      CALL    MSX
0001D9 41D9 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0001DD 41DD DD219F00        14      LD  IX,CHGET
0001E1 41E1 C31C00          10      JP  _CALSLT
                                
       41E4                     GTSL1_:             ;自分のいるスロットを知る
0001E4 41E4 CD3801          17      CALL    RSLREG      ;read primary slot #
0001E7 41E7 0F               4      RRCA
0001E8 41E8 0F               4      RRCA
       41E9                     GTSL2_:
0001E9 41E9 E603             7      AND 3       ;[A]=000000PP
0001EB 41EB 5F               4      LD  E,A     ;[E]=000000PP
0001EC 41EC 21C1FC          10      LD  HL,EXPTBL
0001EF 41EF 85               4      ADD A,L     ;桁上りは無い
0001F0 41F0 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
0001F1 41F1 7B               4      LD  A,E     ;[A]=000000PP
0001F2 41F2 CB7E            13      BIT 7,(HL)
0001F4 41F4 C8              11      RET Z
0001F5 41F5 7D               4      LD  A,L     ;point to SLTTBL entry
0001F6 41F6 C604             7      ADD A,4     ;桁上りは無い
0001F8 41F8 6F               4      LD  L,A
0001F9 41F9 7E               7      LD  A,(HL)      ;get currently expansion slot register
0001FA 41FA E60C             7      AND 00CH        ;[A] = 0000SS00
0001FC 41FC B3               4      OR  E       ;[A] = 0000SSPP
0001FD 41FD F680             7      OR  080H        ;[A] = 1000SSPP
0001FF 41FF C9              10      RET
       4200                     GTSL1_E:
                                
       4200                     CHK_RAM:
000200 4200 4F               4      LD  C,A
000201 4201 DD210C00        14      LD  IX,_RDSLT
000205 4205 CD2942          17      CALL    CALSLT_R
000208 4208 2F               4      CPL
000209 4209 47               4      LD  B,A
00020A 420A 5F               4      LD  E,A
00020B 420B 79               4      LD  A,C
00020C 420C DD211400        14      LD  IX,_WRSLT
000210 4210 CD2942          17      CALL    CALSLT_R
000213 4213 79               4      LD  A,C
000214 4214 DD210C00        14      LD  IX,_RDSLT
000218 4218 CD2942          17      CALL    CALSLT_R
00021B 421B B8               4      CP  B
00021C 421C C0              11      RET NZ
00021D 421D 2F               4      CPL
00021E 421E 79               4      LD  A,C
00021F 421F 5F               4      LD  E,A
000220 4220 DD211400        14      LD  IX,_WRSLT
000224 4224 CD2942          17      CALL    CALSLT_R
000227 4227 AF               4      XOR A
000228 4228 C9              10      RET
       4229                     CALSLT_R:
000229 4229 C5              11      PUSH    BC
00022A 422A E5              11      PUSH    HL
00022B 422B FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00022F 422F CD1C00          17      CALL    _CALSLT
000232 4232 E1              10      POP HL
000233 4233 C1              10      POP BC
000234 4234 C9              10      RET
                                
       4235                     AT_ISC:
000235 FB03                         ORG ISC,AT_ISC-RUN
000235 FB03 FEB5             7      CP  0B5H            ;LOAD
000237 FB05 CA71FE          10      JP  Z,H_BINS
00023A FB08 FECF             7      CP  0CFH            ;BLOAD
00023C FB0A CA76FE          10      JP  Z,H_BINL
00023F FB0D FEB7             7      CP  0B7H            ;FILES
000241 FB0F CA7BFE          10      JP  Z,H_FILE
000244 FB12 FE8A             7      CP  08AH            ;RUN
000246 FB14 C0              11      RET NZ
       FB15                     FIX_RUN:
000247 FB15 F7              12      RST 30H
       FB16                     ROM_SLT:
000248 FB16 00                      DB  0
000249 FB17 9E43                    DW  ROM_RUN
00024B FB19 C9              10      RET
       FB1A                     LOAD_LDIR:
00024C FB1A C3F242          10      JP  ROM_LDIR
       FB1B                     SWC_LDIR    EQU $-2
                                
       FB1D                     ISC_E:
00024F 424F                         ORG $$+RUN          ;$DEPHASE
                                
       424F                     MSX1:
00024F 424F CD6442          17      CALL    MSGA1
       4252                     MSX:
000252 4252 7E               7      LD  A,(HL)
000253 4253 23               6      INC HL
000254 4254 B7               4      OR  A
000255 4255 20F8            12      JR  NZ,MSX1
000257 4257 C9              10      RET
                                
       4258                     PRTHX:
000258 4258 F5              11      PUSH    AF
000259 4259 07               4      RLCA
00025A 425A 07               4      RLCA
00025B 425B 07               4      RLCA
00025C 425C 07               4      RLCA
00025D 425D CD6142          17      CALL    PRTA2
000260 4260 F1              10      POP AF
       4261                     PRTA2:
000261 4261 CD7842          17      CALL    ASC
       4264                     MSG_A:
       4264                     MSGA1:
000264 4264 F5              11      PUSH    AF
000265 4265 C5              11      PUSH    BC
000266 4266 D5              11      PUSH    DE
000267 4267 E5              11      PUSH    HL
000268 4268 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00026C 426C DD21A200        14      LD  IX,CHPUT
000270 4270 CD1C00          17      CALL    _CALSLT
000273 4273 E1              10      POP HL
000274 4274 D1              10      POP DE
000275 4275 C1              10      POP BC
       4276                     MSGA2:
000276 4276 F1              10      POP AF
000277 4277 C9              10      RET
       4278                     ASC:
000278 4278 E60F             7      AND $0F
00027A 427A F630             7      OR  $30
00027C 427C FE3A             7      CP  $3A
00027E 427E D8              11      RET C
00027F 427F C607             7      ADD A,7
000281 4281 C9              10      RET
                                
       4282                     MSN:
000282 4282 7E               7      LD  A,(HL)
000283 4283 23               6      INC HL
000284 4284 CD6442          17      CALL    MSG_A
000287 4287 10F9            13      DJNZ    MSN
000289 4289 C9              10      RET
                                
       428A                     ROM_STKE:
00028A 428A 3E                      DB  03EH
00028B 428B C9              10      RET
00028C 428C 32DAFE          13      LD  (H_STKE),A
00028F 428F E5              11      PUSH    HL
000290 4290 D5              11      PUSH    DE
000291 4291 C5              11      PUSH    BC
000292 4292 21D442          10      LD  HL,AUTOEXEC
000295 4295 1166F8          10      LD  DE,FILNAM
000298 4298 010B00          10      LD  BC,8+3
00029B 429B EDB0                    LDIR
00029D 429D CD8345          17      CALL    ROM_OPEN_0F
0002A0 42A0 3813            12      JR  C,RSTKEE
0002A2 42A2 21DF42          10      LD  HL,RUN_AUTOEXEC
0002A5 42A5 11F0FB          10      LD  DE,KEYBUF
0002A8 42A8 ED53FAF3        20      LD  (GETPNT),DE
0002AC 42AC 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0002AF 42AF EDB0                    LDIR
0002B1 42B1 ED53F8F3        20      LD  (PUTPNT),DE
       42B5                     RSTKEE:
0002B5 42B5 C1              10      POP BC
0002B6 42B6 D1              10      POP DE
0002B7 42B7 E1              10      POP HL
0002B8 42B8 C9              10      RET
                                
       42B9                     MSG_ERROR_ROM_MODE:
0002B9 42B9 41534349492D384B        DB  "ASCII-8K/Konami-8K only!",13,10,0
            2F4B6F6E616D692D    
            384B206F6E6C7921    
            0D0A00              
                                
       42D4                     AUTOEXEC:
0002D4 42D4 4155544F45584543        DB  "AUTOEXECBAS"
            424153              
       42DF                     RUN_AUTOEXEC:
0002DF 42DF 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
       42F2                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       42F2                     ROM_LDIR:
0002F2 42F2 EDB0                    LDIR
0002F4 42F4 C9              10      RET
       42F5                     ROM_LDIRVM:
0002F5 42F5 C5              11      PUSH    BC
0002F6 42F6 D5              11      PUSH    DE
0002F7 42F7 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0002FB 42FB DD215C00        14      LD  IX,LDIRVM
0002FF 42FF CD1C00          17      CALL    _CALSLT
000302 4302 E1              10      POP HL
000303 4303 C1              10      POP BC
000304 4304 09              11      ADD HL,BC
000305 4305 EB               4      EX  DE,HL
000306 4306 C9              10      RET
                                
       4307                     ROM_LOAD:
000307 4307 E5              11      PUSH    HL
000308 4308 CD0544          17      CALL    INIT_PARAM
00030B 430B CD7745          17      CALL    ROM_OPEN
00030E 430E 3837            12      JR  C,ERROR_FILE_NOT_FOUND
       4310                     ROM_LOAD_BAS:
000310 4310 21D5F7          10      LD  HL,_BUF
000313 4313 2246FF          16      LD  (_DTA),HL
000316 4316 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000319 4319 CD2044          17      CALL    ROM_READ
00031C 431C 3AD5F7          13      LD  A,(_BUF)
00031F 431F 3C               4      INC A
000320 4320 2022            12      JR  NZ,ERROR_FILE_NOT_OPEN
000322 4322 2A76F6          16      LD  HL,(TXTTAB)
000325 4325 2246FF          16      LD  (_DTA),HL
000328 4328 EB               4      EX  DE,HL
000329 4329 2100FF          10      LD  HL,-256
00032C 432C 39              11      ADD HL,SP
00032D 432D ED52            15      SBC HL,DE
00032F 432F CD2044          17      CALL    ROM_READ
000332 4332 ED5B46FF        20      LD  DE,(_DTA)
000336 4336 19              11      ADD HL,DE
000337 4337 22C2F6          16      LD  (VARTAB),HL
00033A 433A 22C4F6          16      LD  (ARYTAB),HL
00033D 433D 22C6F6          16      LD  (STREND),HL
000340 4340 E1              10      POP HL
000341 4341 3E8F             7      LD  A,08FH          ;REM
000343 4343 C9              10      RET
                                
       4344                     ERROR_FILE_NOT_OPEN:
000344 4344 1E3B             7      LD  E,59            ;File not OPEN
000346 4346 01                      DB  1           ;LD BC,
       4347                     ERROR_FILE_NOT_FOUND:
000347 4347 1E35             7      LD  E,53            ;File not found
       4349                     ERROR:
000349 4349 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00034D 434D DD216F40        14      LD  IX,0406FH
000351 4351 C31C00          10      JP  _CALSLT
                                
       4354                     ROM_BLOAD:
000354 4354 E5              11      PUSH    HL
000355 4355 CD0544          17      CALL    INIT_PARAM
000358 4358 CD7745          17      CALL    ROM_OPEN
00035B 435B 38EA            12      JR  C,ERROR_FILE_NOT_FOUND
00035D 435D 21D5F7          10      LD  HL,_BUF
000360 4360 2246FF          16      LD  (_DTA),HL
000363 4363 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000366 4366 CD2044          17      CALL    ROM_READ
000369 4369 3AD5F7          13      LD  A,(_BUF)
00036C 436C FEFE             7      CP  0FEH
00036E 436E 20D4            12      JR  NZ,ERROR_FILE_NOT_OPEN
000370 4370 3ABEFC          13      LD  A,(RUNBNF)
000373 4373 FE53             7      CP  'S'
000375 4375 2006            12      JR  NZ,RBREAD_MEM
000377 4377 21F542          10      LD  HL,ROM_LDIRVM
00037A 437A 221BFB          16      LD  (SWC_LDIR),HL
       437D                     RBREAD_MEM:
00037D 437D 2AD6F7          16      LD  HL,(_BUF_ST)
000380 4380 2246FF          16      LD  (_DTA),HL
000383 4383 EB               4      EX  DE,HL
000384 4384 2AD8F7          16      LD  HL,(_BUF_EN)
000387 4387 A7               4      AND A
000388 4388 ED52            15      SBC HL,DE
00038A 438A CD2044          17      CALL    ROM_READ
00038D 438D 3ABEFC          13      LD  A,(RUNBNF)
000390 4390 FE52             7      CP  'R'
000392 4392 2006            12      JR  NZ,RBREAD1
000394 4394 2ADAF7          16      LD  HL,(_BUF_EX)
000397 4397 CD1247          17      CALL    JP_HL
       439A                     RBREAD1:
00039A 439A E1              10      POP HL
00039B 439B 3E8F             7      LD  A,08FH          ;REM
00039D 439D C9              10      RET
                                
       439E                     ROM_RUN:
00039E 439E 23               6      INC HL
00039F 439F 7E               7      LD  A,(HL)
0003A0 43A0 2B               6      DEC HL
0003A1 43A1 B7               4      OR  A
0003A2 43A2 280A            12      JR  Z,ROM_RUN1
0003A4 43A4 CD0743          17      CALL    ROM_LOAD
0003A7 43A7 AF               4      XOR A
0003A8 43A8 21D6F7          10      LD  HL,_BUF+1
0003AB 43AB 77               7      LD  (HL),A
0003AC 43AC 2B               6      DEC HL
0003AD 43AD 77               7      LD  (HL),A
       43AE                     ROM_RUN1:
0003AE 43AE 3E8A             7      LD  A,08AH          ;RUN
0003B0 43B0 C9              10      RET
                                
       43B1                     ROM_FILES:
0003B1 43B1 E5              11      PUSH    HL
0003B2 43B2 CD0544          17      CALL    INIT_PARAM
0003B5 43B5 CDB544          17      CALL    FILED
0003B8 43B8 3A66F8          13      LD  A,(FILNAM)
0003BB 43BB FE21             7      CP  021H
0003BD 43BD 3005            12      JR  NC,RFILES0
0003BF 43BF 060B             7      LD  B,11
0003C1 43C1 CDF844          17      CALL    FILE10
       43C4                     RFILES0:
0003C4 43C4 21006E          10      LD  HL,_DIRBF   ;ディレクトリの先頭
0003C7 43C7 0E70             7      LD  C,112       ;RootEntCnt
       43C9                     RFILES1:
0003C9 43C9 7E               7      LD  A,(HL)
0003CA 43CA B7               4      OR  A
0003CB 43CB 2834            12      JR  Z,RFILES_END
0003CD 43CD FEE5             7      CP  0E5H
0003CF 43CF 282B            12      JR  Z,RFILES_NEXT
0003D1 43D1 E5              11      PUSH    HL
0003D2 43D2 0608             7      LD  B,8
0003D4 43D4 CD8242          17      CALL    MSN
0003D7 43D7 3E2E             7      LD  A,'.'
0003D9 43D9 CD6442          17      CALL    MSG_A
0003DC 43DC 0603             7      LD  B,3
0003DE 43DE CD8242          17      CALL    MSN
0003E1 43E1 3ADDF3          13      LD  A,(CSRX)
0003E4 43E4 47               4      LD  B,A
0003E5 43E5 3AB0F3          13      LD  A,(LINLEN)
0003E8 43E8 90               4      SUB B
0003E9 43E9 FE0C             7      CP  12
0003EB 43EB 3009            12      JR  NC,RFILES2
0003ED 43ED 3E0D             7      LD  A,00DH      ;改行
0003EF 43EF CD6442          17      CALL    MSG_A
0003F2 43F2 3E0A             7      LD  A,00AH
0003F4 43F4 1802            12      JR  RFILES3
       43F6                     RFILES2:
0003F6 43F6 3E20             7      LD  A,020H
       43F8                     RFILES3:
0003F8 43F8 CD6442          17      CALL    MSG_A
0003FB 43FB E1              10      POP HL
       43FC                     RFILES_NEXT:
0003FC 43FC CDB645          17      CALL    FNEXT
0003FF 43FF 20C8            12      JR  NZ,RFILES1
       4401                     RFILES_END:
000401 4401 E1              10      POP HL
000402 4402 3E8F             7      LD  A,08FH          ;REM
000404 4404 C9              10      RET
                                
       4405                     INIT_PARAM:
000405 4405 E5              11      PUSH    HL
000406 4406 21F242          10      LD  HL,ROM_LDIR
000409 4409 221BFB          16      LD  (SWC_LDIR),HL
00040C 440C E1              10      POP HL
00040D 440D EB               4      EX  DE,HL
00040E 440E AF               4      XOR A
00040F 440F 32BEFC          13      LD  (RUNBNF),A
000412 4412 3E01             7      LD  A,DISK_BANK
000414 4414 320068          13      LD  (BANK1_SEL),A
000417 4417 13               6      INC DE
000418 4418 CD3245          17      CALL    SPCUT
00041B 441B FE22             7      CP  '"'
00041D 441D C0              11      RET NZ
00041E 441E 13               6      INC DE
00041F 441F C9              10      RET
                                
       4420                     ROM_READ:
000420 4420 E5              11      PUSH    HL
000421 4421 D5              11      PUSH    DE
000422 4422 C5              11      PUSH    BC
000423 4423 FDE5            15      PUSH    IY
000425 4425 22CEF7          16      LD  (LEFTX),HL
000428 4428 2A46FF          16      LD  HL,(_DTA)
00042B 442B 22D0F7          16      LD  (DTAX),HL
00042E 442E 2ACEF7          16      LD  HL,(LEFTX)
                                
000431 4431 CDE245          17      CALL    RBX1
000434 4434 386F            12      JR  C,RBRERR1
000436 4436 79               4      LD  A,C
000437 4437 EB               4      EX  DE,HL
000438 4438 ED52            15      SBC HL,DE       ;CP 0HL,CDE
00043A 443A 19              11      ADD HL,DE
00043B 443B DE00             7      SBC A,000H
00043D 443D 3801            12      JR  C,RBR1
00043F 443F EB               4      EX  DE,HL
       4440                     RBR1:
000440 4440 9F               4      SBC A,A
000441 4441 E601             7      AND 1
000443 4443 32C5F7          13      LD  (_RESULT),A
000446 4446 7C               4      LD  A,H
000447 4447 B5               4      OR  L
000448 4448 CA9B44          10      JP  Z,RBREND0
                                
00044B 444B 22CCF7          16      LD  (_LEFT),HL  ;Read record byte
00044E 444E 22CEF7          16      LD  (LEFTX),HL
                                
000451 4451 CD0A46          17      CALL    RBX2
000454 4454 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000456 4456 CD1B46          17      CALL    RBXA
000459 4459 DAB144          10      JP  C,RBRERR
00045C 445C C5              11      PUSH    BC
00045D 445D CD1AFB          17      CALL    LOAD_LDIR
000460 4460 ED53D0F7        20      LD  (DTAX),DE
000464 4464 2ACEF7          16      LD  HL,(LEFTX)
000467 4467 D1              10      POP DE
000468 4468 A7               4      AND A
000469 4469 ED52            15      SBC HL,DE
00046B 446B 22CEF7          16      LD  (LEFTX),HL
00046E 446E 2828            12      JR  Z,RBREND
                                
       4470                     RBRB:
000470 4470 CD5446          17      CALL    RBXB
000473 4473 2817            12      JR  Z,RBRC
       4475                     RBRB1:
000475 4475 C5              11      PUSH    BC
000476 4476 D5              11      PUSH    DE
000477 4477 CDE746          17      CALL    CLUST
00047A 447A EB               4      EX  DE,HL
00047B 447B 010004          10      LD  BC,1024     ;1クラスタのサイズ
00047E 447E CD1AFB          17      CALL    LOAD_LDIR
000481 4481 EB               4      EX  DE,HL
000482 4482 D1              10      POP DE
000483 4483 C1              10      POP BC
000484 4484 CDC446          17      CALL    GNCL
000487 4487 DAB144          10      JP  C,RBRERR
00048A 448A 10E9            13      DJNZ    RBRB1
       448C                     RBRC:
00048C 448C CD6446          17      CALL    RBXC
00048F 448F 2807            12      JR  Z,RBREND
                                
000491 4491 CDE746          17      CALL    CLUST
000494 4494 EB               4      EX  DE,HL
000495 4495 CD1AFB          17      CALL    LOAD_LDIR
       4498                     RBREND:
000498 4498 CD6E46          17      CALL    RBXEND
       449B                     RBREND0:
00049B 449B FDE1            14      POP IY
00049D 449D C1              10      POP BC
00049E 449E D1              10      POP DE
00049F 449F F1              10      POP AF  ;(HL)
0004A0 44A0 AF               4      XOR A
0004A1 44A1 3AC5F7          13      LD  A,(_RESULT)
0004A4 44A4 C9              10      RET
                                
       44A5                     RBRERR1:
0004A5 44A5 3E01             7      LD  A,001H
       44A7                     RBRERR2:
0004A7 44A7 FDE1            14      POP IY
0004A9 44A9 C1              10      POP BC
0004AA 44AA D1              10      POP DE
0004AB 44AB E1              10      POP HL
0004AC 44AC 37               4      SCF
0004AD 44AD 210000          10      LD  HL,0
0004B0 44B0 C9              10      RET
       44B1                     RBRERR:
0004B1 44B1 3EFF             7      LD  A,0FFH
0004B3 44B3 18F2            12      JR  RBRERR2
                                
       44B5                     FILED:
0004B5 44B5 CDFC44          17      CALL    FILEI
0004B8 44B8 2166F8          10      LD  HL,FILNAM
                                
0004BB 44BB 0608             7      LD  B,8
       44BD                     FILE2:
0004BD 44BD CD0945          17      CALL    CCHKF
0004C0 44C0 C8              11      RET Z
0004C1 44C1 FE2A             7      CP  '*'
0004C3 44C3 282E            12      JR  Z,FILE9
0004C5 44C5 FE2E             7      CP  '.'
0004C7 44C7 280C            12      JR  Z,FILE4
0004C9 44C9 77               7      LD  (HL),A
0004CA 44CA 23               6      INC HL
0004CB 44CB 10F0            13      DJNZ    FILE2
                                
       44CD                     FILE3:
0004CD 44CD CD0945          17      CALL    CCHKF
0004D0 44D0 C8              11      RET Z
0004D1 44D1 FE2E             7      CP  '.'
0004D3 44D3 20F8            12      JR  NZ,FILE3
                                
       44D5                     FILE4:
0004D5 44D5 216EF8          10      LD  HL,FILNAM+8
0004D8 44D8 0603             7      LD  B,3
                                
       44DA                     FILE4L:
0004DA 44DA CD0945          17      CALL    CCHKF
0004DD 44DD C8              11      RET Z
0004DE 44DE FE2E             7      CP  '.'
0004E0 44E0 2008            12      JR  NZ,FILE12
0004E2 44E2 3266F8          13      LD  (FILNAM),A  ;Parent directory(..)
0004E5 44E5 3267F8          13      LD  (FILNAM+1),A
0004E8 44E8 3E20             7      LD  A,020H
       44EA                     FILE12:
0004EA 44EA FE2A             7      CP  '*'
0004EC 44EC 280A            12      JR  Z,FILE10
0004EE 44EE 77               7      LD  (HL),A
0004EF 44EF 23               6      INC HL
0004F0 44F0 10E8            13      DJNZ    FILE4L
0004F2 44F2 C9              10      RET
                                
       44F3                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0004F3 44F3 CDF844          17      CALL    FILE10
0004F6 44F6 18D5            12      JR  FILE3
                                
       44F8                     FILE10:
0004F8 44F8 3E3F             7      LD  A,'?'
0004FA 44FA 1808            12      JR  FILL_MEMORY
       44FC                     FILEI:              ;名前＋拡張子をスペースで初期化
0004FC 44FC 3E20             7      LD  A,020H
0004FE 44FE 01000B          10      LD  BC,11*256   ;C=0にしておく
000501 4501 2166F8          10      LD  HL,FILNAM
       4504                     FILL_MEMORY:            ;HLからBバイトAで埋める
000504 4504 77               7      LD  (HL),A
000505 4505 23               6      INC HL
000506 4506 10FC            13      DJNZ    FILL_MEMORY
000508 4508 C9              10      RET
                                
       4509                     CCHKF:
000509 4509 1A               7      LD  A,(DE)
00050A 450A CD1145          17      CALL    CCHK2
00050D 450D C8              11      RET Z
00050E 450E C34E45          10      JP  FKAN
                                
       4511                     CCHK2:
000511 4511 0C               4      INC C
000512 4512 0D               4      DEC C
000513 4513 C0              11      RET NZ
       4514                     CCHK3:              ;ZF=1 で使えない文字
000514 4514 FE22             7      CP  '"'
000516 4516 C8              11      RET Z
000517 4517 FE2B             7      CP  '+'
000519 4519 C8              11      RET Z
00051A 451A FE2C             7      CP  ','
00051C 451C C8              11      RET Z
00051D 451D FE2F             7      CP  '/'
00051F 451F C8              11      RET Z
000520 4520 FE3A             7      CP  ':'
000522 4522 C8              11      RET Z
000523 4523 FE3B             7      CP  ';'
000525 4525 C8              11      RET Z
000526 4526 FE3D             7      CP  '='
000528 4528 C8              11      RET Z
000529 4529 FE5C             7      CP  05CH    ;\
00052B 452B C8              11      RET Z
00052C 452C FE20             7      CP  020H
00052E 452E D0              11      RET NC
00052F 452F BF               4      CP  A       ;Z=1
000530 4530 C9              10      RET
                                
       4531                     SS1:
000531 4531 13               6      INC DE
       4532                     SPCUT:              ;スペースをカット
000532 4532 1A               7      LD  A,(DE)
000533 4533 FE20             7      CP  020H
000535 4535 28FA            12      JR  Z,SS1
000537 4537 C9              10      RET
       4538                     OPCUT1:
000538 4538 13               6      INC DE
       4539                     OPCUT:
000539 4539 1A               7      LD  A,(DE)
00053A 453A FE20             7      CP  020H
00053C 453C 28FA            12      JR  Z,OPCUT1
00053E 453E FE22             7      CP  '"'
000540 4540 28F6            12      JR  Z,OPCUT1
000542 4542 FE2C             7      CP  ','
000544 4544 28F2            12      JR  Z,OPCUT1
000546 4546 C9              10      RET
                                
       4547                     FKANC:
000547 4547 CB41             8      BIT 0,C
000549 4549 CC6A45          17      CALL    Z,CAP2
00054C 454C 1801            12      JR  FKANX
       454E                     FKAN:           ;漢字チェック
00054E 454E 13               6      INC DE
       454F                     FKANX:
00054F 454F CB41             8      BIT 0,C
000551 4551 CB81             8      RES 0,C
000553 4553 C0              11      RET NZ
000554 4554 FE80             7      CP  080H
000556 4556 D8              11      RET C
000557 4557 FEA0             7      CP  0A0H
000559 4559 3803            12      JR  C,FKAN1
00055B 455B FEE0             7      CP  0E0H
00055D 455D D8              11      RET C
       455E                     FKAN1:
00055E 455E 0C               4      INC C
00055F 455F A7               4      AND A
000560 4560 C9              10      RET
                                
       4561                     CAP:
000561 4561 FE61             7      CP  'a'
000563 4563 D8              11      RET C
000564 4564 FE7B             7      CP  'z'+1
000566 4566 D0              11      RET NC
000567 4567 D620             7      SUB 020H
000569 4569 C9              10      RET
       456A                     CAP2:
00056A 456A CD6145          17      CALL    CAP
       456D                     CAP3:               ;
00056D 456D FE05             7      CP  5
00056F 456F 2803            12      JR  Z,CAP4
000571 4571 FE21             7      CP  021H
000573 4573 C9              10      RET
       4574                     CAP4:
000574 4574 3EE5             7      LD  A,0E5H
000576 4576 C9              10      RET
                                
       4577                     ROM_OPEN:
000577 4577 CDB544          17      CALL    FILED
00057A 457A CD3945          17      CALL    OPCUT
00057D 457D CD6145          17      CALL    CAP
000580 4580 32BEFC          13      LD  (RUNBNF),A
       4583                     ROM_OPEN_0F:
000583 4583 21006E          10      LD  HL,_DIRBF   ;ディレクトリの先頭
000586 4586 0E70             7      LD  C,112       ;RootEntCnt
000588 4588 CD9A45          17      CALL    FILESE
00058B 458B 3F               4      CCF
00058C 458C D8              11      RET C
00058D 458D 2264F8          16      LD  (PTRFIL),HL
000590 4590 210000          10      LD  HL,0
000593 4593 22C6F7          16      LD  (RR_LOW),HL
000596 4596 22C8F7          16      LD  (RR_HIGH),HL
000599 4599 C9              10      RET
                                
       459A                     FILESE:
00059A 459A 7E               7      LD  A,(HL)
00059B 459B B7               4      OR  A
00059C 459C C8              11      RET Z       ;END:ZF=1 CF=0
00059D 459D FEE5             7      CP  0E5H
00059F 459F 280D            12      JR  Z,FILESE1
0005A1 45A1 1166F8          10      LD  DE,FILNAM
0005A4 45A4 E5              11      PUSH    HL
0005A5 45A5 CDBC45          17      CALL    CPFILE
0005A8 45A8 CCDD45          17      CALL    Z,CPFILE2
0005AB 45AB E1              10      POP HL
0005AC 45AC 37               4      SCF
0005AD 45AD C8              11      RET Z       ;!!!:(ZF=1) CF=1
       45AE                     FILESE1:
0005AE 45AE CDB645          17      CALL    FNEXT
0005B1 45B1 20E7            12      JR  NZ,FILESE
       45B3                     ZF0_CF0_AFF_RET:
0005B3 45B3 F6FF             7      OR  0FFH        ;ZF=0 CF=0
0005B5 45B5 C9              10      RET
                                
       45B6                     FNEXT:
                                ;   PUSH    HL
                                ;   LD  HL,_FILEN
                                ;   INC (HL)
                                ;   POP HL
0005B6 45B6 112000          10      LD  DE,020H
0005B9 45B9 19              11      ADD HL,DE
0005BA 45BA 0D               4      DEC C
0005BB 45BB C9              10      RET
                                
       45BC                     CPFILE:
0005BC 45BC C5              11      PUSH    BC
0005BD 45BD 01000B          10      LD  BC,00B00H
       45C0                     CPSTR1:
0005C0 45C0 1A               7      LD  A,(DE)
0005C1 45C1 FE3F             7      CP  '?'     ;Wild card
0005C3 45C3 2812            12      JR  Z,CPSTR2
0005C5 45C5 7E               7      LD  A,(HL)
0005C6 45C6 CD4745          17      CALL    FKANC
0005C9 45C9 E5              11      PUSH    HL
0005CA 45CA 67               4      LD  H,A
0005CB 45CB 1A               7      LD  A,(DE)
0005CC 45CC CB01             4      RLC C
0005CE 45CE CD4745          17      CALL    FKANC
0005D1 45D1 CB09             4      RRC C
0005D3 45D3 BC               4      CP  H       ;CP (HL),(DE)
0005D4 45D4 E1              10      POP HL
0005D5 45D5 2004            12      JR  NZ,CPSTR3
       45D7                     CPSTR2:
0005D7 45D7 13               6      INC DE
0005D8 45D8 23               6      INC HL
0005D9 45D9 10E5            13      DJNZ    CPSTR1
       45DB                     CPSTR3:
0005DB 45DB C1              10      POP BC
0005DC 45DC C9              10      RET
                                
       45DD                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
0005DD 45DD 3EE1             7      LD  A,0E1H
0005DF 45DF 2F               4      CPL
0005E0 45E0 A6               7      AND (HL)
0005E1 45E1 C9              10      RET
                                
       45E2                     RBX1:
0005E2 45E2 E5              11      PUSH    HL      ;Record byte
                                
0005E3 45E3 ED5BC6F7        20      LD  DE,(RR_LOW) ;CDE=Random record
0005E7 45E7 3AC9F7          13      LD  A,(RR_HIGH+1)
0005EA 45EA 4F               4      LD  C,A
                                
0005EB 45EB 3E01             7      LD  A,DISK_BANK
0005ED 45ED 320068          13      LD  (BANK1_SEL),A
                                
0005F0 45F0 FD2A64F8        20      LD  IY,(PTRFIL)
0005F4 45F4 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
0005F7 45F7 FD661D          19      LD  H,(IY+01DH)
0005FA 45FA FD7E1E          19      LD  A,(IY+01EH)
                                
0005FD 45FD A7               4      AND A
0005FE 45FE ED52            15      SBC HL,DE
000600 4600 99               4      SBC A,C
000601 4601 D1              10      POP DE
                                
000602 4602 D8              11      RET C
000603 4603 4F               4      LD  C,A
000604 4604 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000605 4605 B2               4      OR  D
000606 4606 B3               4      OR  E
000607 4607 C0              11      RET NZ
000608 4608 37               4      SCF
000609 4609 C9              10      RET
                                
       460A                     RBX2:
00060A 460A ED4BC7F7        20      LD  BC,(RR_LOW+1)
00060E 460E CD8346          17      CALL    RWXR
000611 4611 3E03             7      LD  A,3     ;ooo 1
000613 4613 E5              11      PUSH    HL
000614 4614 2AC6F7          16      LD  HL,(RR_LOW)
000617 4617 A4               4      AND H
000618 4618 B5               4      OR  L
000619 4619 E1              10      POP HL
00061A 461A C9              10      RET
                                
       461B                     RBXA:
00061B 461B D5              11      PUSH    DE
00061C 461C CDE746          17      CALL    CLUST
00061F 461F ED53D2F7        20      LD  (_DTPS),DE
000623 4623 D1              10      POP DE
000624 4624 CDC446          17      CALL    GNCL
000627 4627 D8              11      RET C
000628 4628 ED53CAF7        20      LD  (_CLPS),DE
                                
00062C 462C ED4BC6F7        20      LD  BC,(RR_LOW)
000630 4630 3E03             7      LD  A,3     ;ooo 1
000632 4632 A0               4      AND B
000633 4633 47               4      LD  B,A
000634 4634 210004          10  IBM7:   LD  HL,1024     ;ooo 512
000637 4637 ED42            15      SBC HL,BC       ;remaining cluster
                                
000639 4639 ED5BCEF7        20      LD  DE,(LEFTX)
00063D 463D ED52            15      SBC HL,DE       ;CP HL,DE
00063F 463F 19              11      ADD HL,DE
000640 4640 3801            12      JR  C,RBXA1
000642 4642 EB               4      EX  DE,HL
       4643                     RBXA1:
000643 4643 3AD4F7          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
000646 4646 320068          13      LD  (BANK1_SEL),A   ;ASCII-8K/Konami-8K共通で使える
000649 4649 E5              11      PUSH    HL
00064A 464A 2AD2F7          16      LD  HL,(_DTPS)
00064D 464D 09              11      ADD HL,BC
00064E 464E ED5BD0F7        20      LD  DE,(DTAX)
000652 4652 C1              10      POP BC
000653 4653 C9              10      RET
                                
       4654                     RBXB:
000654 4654 2AD0F7          16      LD  HL,(DTAX)
000657 4657 ED5BCAF7        20      LD  DE,(_CLPS)
00065B 465B 3ACFF7          13      LD  A,(LEFTX+1)
00065E 465E CB3F             8      SRL A
000660 4660 CB3F             8  IBM8:   SRL A       ;ooo
000662 4662 47               4      LD  B,A
000663 4663 C9              10      RET
                                
       4664                     RBXC:
000664 4664 ED4BCEF7        20      LD  BC,(LEFTX)
000668 4668 3E03             7      LD  A,3     ;ooo 1
00066A 466A A0               4      AND B
00066B 466B 47               4      LD  B,A
00066C 466C B1               4      OR  C
00066D 466D C9              10      RET
                                
       466E                     RBXEND:
00066E 466E ED5BCCF7        20      LD  DE,(_LEFT)
000672 4672 2AC6F7          16      LD  HL,(RR_LOW)
000675 4675 3AC9F7          13      LD  A,(RR_HIGH+1)
000678 4678 19              11      ADD HL,DE
000679 4679 CE00             7      ADC A,0
00067B 467B 22C6F7          16      LD  (RR_LOW),HL
00067E 467E 32C9F7          13      LD  (RR_HIGH+1),A
000681 4681 EB               4      EX  DE,HL       ;HL=Read byte
000682 4682 C9              10      RET 
                                
       4683                     RWXR:
000683 4683 CB38             8      SRL B
000685 4685 CB19             8      RR  C
000687 4687 CB38             8  IBM4:   SRL B   ;ooo
000689 4689 CB19             8      RR  C
                                
00068B 468B 3E01             7      LD  A,DISK_BANK
00068D 468D 320068          13      LD  (BANK1_SEL),A
                                
000690 4690 FD2A64F8        20      LD  IY,(PTRFIL)
000694 4694 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000697 4697 FD561B          19      LD  D,(IY+01BH)
       469A                     RWX1:
00069A 469A ED53CAF7        20      LD  (_CLPS),DE
00069E 469E 7A               4      LD  A,D
00069F 469F B3               4      OR  E
0006A0 46A0 37               4      SCF
0006A1 46A1 C8              11      RET Z
                                
0006A2 46A2 78               4      LD  A,B
0006A3 46A3 B1               4      OR  C
0006A4 46A4 C8              11      RET Z
                                
0006A5 46A5 CDC446          17      CALL    GNCL
0006A8 46A8 D8              11      RET C
0006A9 46A9 0B               6      DEC BC
0006AA 46AA CD0947          17      CALL    ENDCL
0006AD 46AD 38EB            12      JR  C,RWX1
0006AF 46AF 37               4      SCF
0006B0 46B0 C9              10      RET
                                
       46B1                     NCL3:
0006B1 46B1 3E01             7      LD  A,DISK_BANK
0006B3 46B3 320068          13      LD  (BANK1_SEL),A
0006B6 46B6 6B               4      LD  L,E
0006B7 46B7 62               4      LD  H,D
0006B8 46B8 CB3C             8      SRL H
0006BA 46BA CB1D             8      RR  L
0006BC 46BC 1F               4      RRA
0006BD 46BD 010062          10      LD  BC,_FATBF
0006C0 46C0 19              11      ADD HL,DE
0006C1 46C1 09              11      ADD HL,BC
0006C2 46C2 17               4      RLA
0006C3 46C3 C9              10      RET
                                
       46C4                     GNCL:
0006C4 46C4 7A               4      LD  A,D
0006C5 46C5 B3               4      OR  E
0006C6 46C6 37               4      SCF
0006C7 46C7 C8              11      RET Z
0006C8 46C8 C5              11      PUSH    BC
0006C9 46C9 E5              11      PUSH    HL
0006CA 46CA CDB146          17      CALL    NCL3
0006CD 46CD 3809            12      JR  C,GNC1
0006CF 46CF 5E               7      LD  E,(HL)
0006D0 46D0 23               6      INC HL
0006D1 46D1 7E               7      LD  A,(HL)
0006D2 46D2 E60F             7      AND 00FH
0006D4 46D4 57               4      LD  D,A
0006D5 46D5 E1              10      POP HL
0006D6 46D6 C1              10      POP BC
0006D7 46D7 C9              10      RET
       46D8                     GNC1:
0006D8 46D8 7E               7      LD  A,(HL)
0006D9 46D9 23               6      INC HL
0006DA 46DA 56               7      LD  D,(HL)
0006DB 46DB 0604             7      LD  B,4
       46DD                     GNC1L:
0006DD 46DD CB3A             8      SRL D
0006DF 46DF 1F               4      RRA
0006E0 46E0 10FB            13      DJNZ    GNC1L
                                
0006E2 46E2 5F               4      LD  E,A
0006E3 46E3 E1              10      POP HL
0006E4 46E4 C1              10      POP BC
0006E5 46E5 A7               4      AND A
0006E6 46E6 C9              10      RET
                                
       46E7                     CLUST:
0006E7 46E7 EB               4      EX  DE,HL
0006E8 46E8 3E14             7      LD  A,20
0006EA 46EA 29              11      ADD HL,HL   ;*2
0006EB 46EB 29              11      ADD HL,HL   ;*4
0006EC 46EC 85               4      ADD A,L
0006ED 46ED 6F               4      LD  L,A
0006EE 46EE 8C               4      ADC A,H
0006EF 46EF 95               4      SUB L
0006F0 46F0 67               4      LD  H,A
0006F1 46F1 E5              11      PUSH    HL
0006F2 46F2 29              11      ADD HL,HL
0006F3 46F3 29              11      ADD HL,HL
0006F4 46F4 29              11      ADD HL,HL
0006F5 46F5 7C               4      LD  A,H
0006F6 46F6 C601             7      ADD A,DISK_BANK
0006F8 46F8 320068          13      LD  (BANK1_SEL),A
0006FB 46FB 32D4F7          13      LD  (_BANK),A
0006FE 46FE E1              10      POP HL
0006FF 46FF 3E1F             7      LD  A,01FH
000701 4701 A5               4      AND L
000702 4702 C660             7      ADD A,high BANK1_ADR
000704 4704 67               4      LD  H,A
000705 4705 2E00             7      LD  L,0
000707 4707 EB               4      EX  DE,HL
000708 4708 C9              10      RET
                                
       4709                     ENDCL:
000709 4709 7A               4      LD  A,D ;END CLUSTER
00070A 470A FE02             7      CP  2   ;2CB=715
00070C 470C C0              11      RET NZ
00070D 470D 7B               4      LD  A,E
00070E 470E FECB             7      CP  0CBH
000710 4710 C9              10      RET
                                
       4711                     DRDC:
000711 4711 C9              10      RET
                                
       4712                     JP_HL:
000712 4712 E9               4      JP  (HL)
                                
       4713                     WILDCARD:
000713 4713 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       471E                     ERROR_WRITE_PROTECTED:
00071E 471E 3E00             7      LD  A,0     ;Write protected
000720 4720 C9              10      RET
       4721                     DISKIO:
000721 4721 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000723 4723 48               4      LD  C,B
000724 4724 CD9948          17      CALL    GET_DISK_BANK
       4727                     SETMAP1:        
000727 4727 E5              11      PUSH    HL
       4728                     DISKIO1:
000728 4728 C5              11      PUSH    BC      ;B=残りのセクタ数
000729 4729 D5              11      PUSH    DE      ;DE=セクタ番号
00072A 472A F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
00072B 472B EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
00072C 472C 29              11      ADD HL,HL
00072D 472D 4D               4      LD  C,L     ;C=読み出し元(セクタ番号*2)※1セクタ512バイトなので倍にしておく
00072E 472E 29              11      ADD HL,HL       ;64KB→32KB
00072F 472F 29              11      ADD HL,HL       ;32KB→16KB
000730 4730 29              11      ADD HL,HL       ;16KB→8KB
000731 4731 84               4      ADD A,H
000732 4732 320068          13      LD  (BANK1_SEL),A   ;ASCII-8K/Konami-8K共通で使える
000735 4735 32D4F7          13      LD  (_BANK),A
000738 4738 79               4      LD  A,C     ;C=読み出し元
000739 4739 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F/16K:3F)
00073B 473B C660             7      ADD A,high BANK1_ADR
00073D 473D 67               4      LD  H,A
00073E 473E 010002          10      LD  BC,00200H   ;BCは読み出すセクタサイズ(512バイト)
000741 4741 69               4      LD  L,C     ;C=0
000742 4742 EDB0                    LDIR
000744 4744 EB               4      EX  DE,HL
000745 4745 F1              10      POP AF
000746 4746 D1              10      POP DE
000747 4747 13               6      INC DE
000748 4748 C1              10      POP BC
000749 4749 10DD            13      DJNZ    DISKIO1
00074B 474B 41               4      LD  B,C
                                
00074C 474C E1              10      POP HL
00074D 474D AF               4      XOR A
00074E 474E FB               4      EI
00074F 474F C9              10      RET
                                
       4750                     DSKCHG:
000750 4750 CD8947          17      CALL    IS_BPB
000753 4753 3824            12      JR  C,NOTREADY
000755 4755 3A23FB          13      LD  A,(DRVTBL+2)
000758 4758 B7               4      OR  A
000759 4759 201A            12      JR  NZ,DSKCHG1
00075B 475B 3A21FB          13      LD  A,(DRVTBL)
00075E 475E FE02             7      CP  2
000760 4760 2013            12      JR  NZ,DSKCHG1
000762 4762 CD8947          17      CALL    IS_BPB
000765 4765 300E            12      JR  NC,DSKCHG1
000767 4767 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000769 4769 3221FB          13      LD  (DRVTBL),A
00076C 476C 3223FB          13      LD  (DRVTBL+2),A
00076F 476F 3A48F3          13      LD  A,(MASTERS)
000772 4772 3224FB          13      LD  (DRVTBL+3),A
       4775                     DSKCHG1:
000775 4775 AF               4      XOR A
000776 4776 0601             7      LD  B,1
000778 4778 C9              10      RET
       4779                     NOTREADY:
000779 4779 3E02             7      LD  A,2
00077B 477B 37               4      SCF
00077C 477C C9              10      RET
                                
       477D                     NO_BPB:
00077D 477D E1              10      POP HL
00077E 477E 23               6      INC HL
00077F 477F 119C48          10      LD  DE,DPB2DD
000782 4782 011200          10      LD  BC,DPB2DD_E-DPB2DD
000785 4785 EDB0                    LDIR
000787 4787 AF               4      XOR A
000788 4788 C9              10      RET
                                
       4789                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000789 4789 CD9948          17      CALL    GET_DISK_BANK
00078C 478C 320068          13      LD  (BANK1_SEL),A
                                
00078F 478F 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000792 4792 FE01             7      CP  1
000794 4794 D8              11      RET C
                                
000795 4795 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000798 4798 C6FF             7      ADD A,0FFH
00079A 479A D8              11      RET C
                                
00079B 479B 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
00079E 479E FE02             7      CP  2
0007A0 47A0 C8              11      RET Z
0007A1 47A1 FE04             7      CP  4
0007A3 47A3 C8              11      RET Z
0007A4 47A4 37               4      SCF
0007A5 47A5 C9              10      RET
                                
       47A6                     GETDPB:
0007A6 47A6 E5              11      PUSH    HL
0007A7 47A7 CD9948          17      CALL    GET_DISK_BANK
0007AA 47AA 320068          13      LD  (BANK1_SEL),A
                                
0007AD 47AD 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
0007B0 47B0 B7               4      OR  A
0007B1 47B1 28CA            12      JR  Z,NO_BPB
0007B3 47B3 DDE1            14      POP IX
0007B5 47B5 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
0007B8 47B8 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
0007BB 47BB DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
0007BE 47BE 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
0007C1 47C1 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
0007C4 47C4 87               4      ADD A,A
0007C5 47C5 87               4      ADD A,A
0007C6 47C6 87               4      ADD A,A
0007C7 47C7 3D               4      DEC A
0007C8 47C8 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
0007CB 47CB 06FF             7      LD  B,-1
0007CD 47CD A7               4      AND A           ;無限ループ阻止
       47CE                     GETDPB1:
0007CE 47CE 04               4      INC B
0007CF 47CF 1F               4      RRA
0007D0 47D0 38FC            12      JR  C,GETDPB1
0007D2 47D2 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
0007D5 47D5 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus 
0007D8 47D8 3D               4      DEC A
0007D9 47D9 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
0007DC 47DC A7               4      AND A           ;無限ループ阻止
0007DD 47DD 06FF             7      LD  B,-1
       47DF                     GETDPB2:
0007DF 47DF 04               4      INC B
0007E0 47E0 1F               4      RRA
0007E1 47E1 38FC            12      JR  C,GETDPB2
0007E3 47E3 04               4      INC B
0007E4 47E4 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
0007E7 47E7 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
0007EA 47EA DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
0007ED 47ED DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
0007F0 47F0 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
0007F3 47F3 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
0007F6 47F6 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
0007F9 47F9 DD770B          19      LD  (IX+11),A       ;FATCNT
                                
0007FC 47FC ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000800 4800 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000803 4803 DD460A          19      LD  B,(IX+10)       ;FATCNT
000806 4806 210000          10      LD  HL,0
       4809                     GETDPB3:
000809 4809 19              11      ADD HL,DE
00080A 480A 10FD            13      DJNZ    GETDPB3
       480C                     GETDPB4:
00080C 480C DD5E08          19      LD  E,(IX+8)        ;FIRFAT
00080F 480F DD5609          19      LD  D,(IX+9)        ;FIRFAT
000812 4812 19              11      ADD HL,DE
000813 4813 DD7511          19      LD  (IX+17),L       ;FIRDIR
000816 4816 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000819 4819 3E08             7      LD  A,2*4           ;SECSIZ HIGH
00081B 481B DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       481E                     GETDPB5:
00081E 481E CB3B             8      SRL E
000820 4820 1F               4      RRA
000821 4821 30FB            12      JR  NC,GETDPB5
000823 4823 1600             7      LD  D,0
000825 4825 19              11      ADD HL,DE
000826 4826 DD750C          19      LD  (IX+12),L       ;FIRREC
000829 4829 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
00082C 482C 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
00082F 482F DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000832 4832 DD560D          19      LD  D,(IX+13)       ;FIRREC
000835 4835 A7               4      AND A
000836 4836 ED52            15      SBC HL,DE
                                
000838 4838 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
00083B 483B 3C               4      INC A
00083C 483C 37               4      SCF             ;無限ループ阻止
       483D                     GETDPB6:
00083D 483D 1F               4      RRA
00083E 483E 3806            12      JR  C,GETDPB7
000840 4840 CB3C             8      SRL H
000842 4842 CB1D             8      RR  L
000844 4844 18F7            12      JR  GETDPB6
       4846                     GETDPB7:
000846 4846 23               6      INC HL
000847 4847 DD750E          19      LD  (IX+14),L       ;MAXCLUS
00084A 484A DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       484D                     GETDPBD1:
00084D 484D DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000850 4850 E6FC             7      AND 0FCH
000852 4852 C8              11      RET Z
                                
000853 4853 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000857 4857 37               4      SCF
000858 4858 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
00085C 485C DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
00085F 485F DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000863 4863 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000867 4867 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
00086B 486B DDCB1126        23      SLA (IX+17)         ;FIRDIR
00086F 486F DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000873 4873 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000876 4876 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000879 4879 3E08             7      LD  A,2*4           ;SECSIZ HIGH
00087B 487B DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       487E                     GETDPBD5:
00087E 487E CB3B             8      SRL E
000880 4880 1F               4      RRA
000881 4881 30FB            12      JR  NC,GETDPBD5
000883 4883 1600             7      LD  D,0
000885 4885 19              11      ADD HL,DE
000886 4886 DD750C          19      LD  (IX+12),L       ;FIRREC
000889 4889 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
00088C 488C 18BF            12      JR  GETDPBD1
                                
       488E                     CHOICE:
00088E 488E 210000          10      LD  HL,0
000891 4891 C9              10      RET
                                
       4892                     DSKFMT:
000892 4892 AF               4      XOR A
000893 4893 37               4      SCF
       4894                     DSKSTP:
       4894                     BASENT:
000894 4894 C9              10      RET
                                
       4895                     GETSLT:
000895 4895 3A22FB          13      LD  A,(DRVTBL+1)
000898 4898 C9              10      RET
                                
       4899                     GET_DISK_BANK:
000899 4899 3E01             7      LD  A,DISK_BANK
00089B 489B C9              10      RET
                                
       489C                     DPB2DD:
00089C 489C F9                      DB  0F9H    ;MEDIA
00089D 489D 0002                    DW  00200H  ;SECSIZ
00089F 489F 0F                      DB  00FH    ;DIRMSK
0008A0 48A0 04                      DB  004H    ;DIRSHFT
0008A1 48A1 01                      DB  001H    ;CLUSMSK
0008A2 48A2 02                      DB  002H    ;CLUSSHFT
0008A3 48A3 0100                    DW  00001H  ;FIRFAT
0008A5 48A5 02                      DB  002H    ;FATCNT
0008A6 48A6 70                      DB  070H    ;MAXENT
0008A7 48A7 0E00                    DW  0000EH  ;FIRREC
0008A9 48A9 CA02                    DW  002CAH  ;MAXCLUS
0008AB 48AB 03                      DB  003H    ;FATSIZ
0008AC 48AC 0700                    DW  0007H   ;FIRDIR
       48AE                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       48AE                     _ERROR:
0008AE 48AE 0600             7      LD  B,0
0008B0 48B0 A7               4      AND A
0008B1 48B1 C9              10      RET
                                
       48B2                     ROM_BDOS:
0008B2 48B2 E5              11      PUSH    HL
0008B3 48B3 79               4      LD  A,C
0008B4 48B4 FE7F             7      CP  07FH
0008B6 48B6 38F6            12      JR  C,_ERROR
0008B8 48B8 87               4      ADD A,A
0008B9 48B9 6F               4      LD  L,A
0008BA 48BA 265F             7      LD  H,high STABLE
0008BC 48BC 7E               7      LD  A,(HL)
0008BD 48BD 2C               4      INC L
0008BE 48BE 66               7      LD  H,(HL)
0008BF 48BF 6F               4      LD  L,A
0008C0 48C0 E3              19      EX  (SP),HL
0008C1 48C1 79               4      LD  A,C
0008C2 48C2 C9              10      RET
                                
       48C3                     _SYS0F:     ;(BDOS)ファイルのオープン
0008C3 48C3 D5              11      PUSH    DE
0008C4 48C4 FDE1            14      POP IY
0008C6 48C6 13               6      INC DE
0008C7 48C7 EB               4      EX  DE,HL
0008C8 48C8 010B00          10      LD  BC,8+3
0008CB 48CB EDB0                    LDIR
0008CD 48CD CD8345          17      CALL    ROM_OPEN_0F
0008D0 48D0 3853            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0008D2 48D2 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0008D6 48D6 FDE5            15      PUSH    IY
0008D8 48D8 D1              10      POP DE
0008D9 48D9 13               6      INC DE
0008DA 48DA 010B00          10      LD  BC,11
0008DD 48DD EDB0                    LDIR
                                ;               Attribute
0008DF 48DF 7E               7      LD  A,(HL)
0008E0 48E0 FD770D          19      LD  (IY+13),A
                                ;               TIME
0008E3 48E3 110B00          10      LD  DE,11
0008E6 48E6 19              11      ADD HL,DE
0008E7 48E7 7E               7      LD  A,(HL)
0008E8 48E8 23               6      INC HL
0008E9 48E9 FD7716          19      LD  (IY+22),A
0008EC 48EC 7E               7      LD  A,(HL)
0008ED 48ED 23               6      INC HL
0008EE 48EE FD7717          19      LD  (IY+23),A
                                ;               DATE
0008F1 48F1 7E               7      LD  A,(HL)
0008F2 48F2 23               6      INC HL
0008F3 48F3 FD7714          19      LD  (IY+20),A
0008F6 48F6 7E               7      LD  A,(HL)
0008F7 48F7 23               6      INC HL
0008F8 48F8 FD7715          19      LD  (IY+21),A
                                ;               First cluster
0008FB 48FB 7E               7      LD  A,(HL)
0008FC 48FC 23               6      INC HL
0008FD 48FD FD771A          19      LD  (IY+26),A
000900 4900 7E               7      LD  A,(HL)
000901 4901 23               6      INC HL
000902 4902 FD771B          19      LD  (IY+27),A
                                ;               SIZE
000905 4905 7E               7      LD  A,(HL)
000906 4906 23               6      INC HL
000907 4907 FD7710          19      LD  (IY+16),A
00090A 490A 7E               7      LD  A,(HL)
00090B 490B 23               6      INC HL
00090C 490C FD7711          19      LD  (IY+17),A
00090F 490F 7E               7      LD  A,(HL)
000910 4910 23               6      INC HL
000911 4911 FD7712          19      LD  (IY+18),A
000914 4914 7E               7      LD  A,(HL)
000915 4915 FD7713          19      LD  (IY+19),A
000918 4918 AF               4      XOR A
000919 4919 FD770C          19      LD  (IY+12),A
                                ;   LD  (OFCB+1),IY
       491C                     FEND:
00091C 491C 9F               4      SBC A,A     ;CF=0 A=0 : CF=1 A=0FFH
       491D                     FENDE:
00091D 491D FDE1            14      POP IY
00091F 491F C1              10      POP BC
000920 4920 D1              10      POP DE
000921 4921 E1              10      POP HL
000922 4922 C9              10      RET
                                
       4923                     _SYS10:
000923 4923 AF               4      XOR A
000924 4924 C9              10      RET
                                
       4925                     SCF_FF_RET:
000925 4925 37               4      SCF
000926 4926 9F               4      SBC A,A
000927 4927 C9              10      RET
                                
       4928                     _SYS1A:     ;(BDOS)DTAの設定
000928 4928 ED5346FF        20      LD  (_DTA),DE
00092C 492C AF               4      XOR A
00092D 492D C9              10      RET
                                
       492E                     _SYS27:
00092E 492E E5              11      PUSH    HL
00092F 492F FDE1            14      POP IY
000931 4931 FD7E1C          19      LD  A,(IY+28)
000934 4934 FEFF             7      CP  0FFH
000936 4936 20ED            12      JR  NZ,SCF_FF_RET
000938 4938 13               6      INC DE
000939 4939 EB               4      EX  DE,HL
00093A 493A 010B00          10      LD  BC,8+3
00093D 493D EDB0                    LDIR
00093F 493F FD6E1A          19      LD  L,(IY+26)
000942 4942 FD661B          19      LD  H,(IY+27)
000945 4945 22CAF7          16      LD  (_CLPS),HL
000948 4948 FD6E21          19      LD  L,(IY+33)
00094B 494B FD6622          19      LD  H,(IY+34)
00094E 494E 22C6F7          16      LD  (RR_LOW),HL
000951 4951 FD6E23          19      LD  L,(IY+35)
000954 4954 FD6624          19      LD  H,(IY+36)
000957 4957 22C8F7          16      LD  (RR_HIGH),HL
00095A 495A E1              10      POP HL
00095B 495B CD2044          17      CALL    ROM_READ
00095E 495E 2AC6F7          16      LD  HL,(RR_LOW)
000961 4961 FD7521          19      LD  (IY+33),L
000964 4964 FD7422          19      LD  (IY+34),H
000967 4967 2AC8F7          16      LD  HL,(RR_HIGH)
00096A 496A FD7523          19      LD  (IY+35),L
00096D 496D FD7424          19      LD  (IY+36),H
000970 4970 9F               4      SBC A,A
000971 4971 C9              10      RET
                                
       4972                     _SYS2F:
000972 4972 44               4      LD  B,H
000973 4973 2A46FF          16      LD  HL,(_DTA)
000976 4976 C32147          10      JP  DISKIO
                                
000979 4979                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F08 5F08 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F10 5F10 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F18 5F18 AE48AE48AE48C348        DW  _ERROR,_ERROR,_ERROR,_SYS0F
                                ;1
001F20 5F20 2349AE48AE48AE48        DW  _SYS10,_ERROR,_ERROR,_ERROR
001F28 5F28 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F30 5F30 AE48AE482849AE48        DW  _ERROR,_ERROR,_SYS1A,_ERROR
001F38 5F38 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F48 5F48 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F50 5F50 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F58 5F58 AE48AE48AE482E49        DW  _ERROR,_ERROR,_ERROR,_SYS27
                                ;3
001F60 5F60 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 AE48AE48AE487249        DW  _ERROR,_ERROR,_ERROR,_SYS2F
                                ;4
001F80 5F80 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 AE48AE48AE48AE48        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
