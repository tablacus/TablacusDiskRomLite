                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 D14D                    DW  STATEMENT   ; STATEMENT
000006 4006 3B4E                    DW  DEVICE1     ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3724E          10      JP  DISKIO
000013 4013 C3AD4E          10      JP  DSKCHG
000016 4016 C3034F          10      JP  GETDPB
000019 4019 C3F64F          10      JP  CHOICE
00001C 401C C3FA4F          10      JP  DSKFMT
00001F 401F C3FC4F          10      JP  DSKSTP
000022 4022 C3FD4F          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3FA4F          10      JP  DSKFMT
000029 4029 C3FC4F          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C33950          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.4",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3400    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2262F1          16      LD  (_SP),HL
000129 4129 ED7B62F1        20      LD  SP,(_SP)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210743          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017B00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DBFD          13      LD  (H_PINL),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4742          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DCFD          13      LD  (H_PINL+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 210745          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 213C46          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 214946          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 219550          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AC43          10      LD  HL,ROM_BOOT
0001BC 41BC 22DDFD          16      LD  (H_PINL+2),HL
0001BF 41BF 21724E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DFFD          13      LD  (H_PINL+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001E5 41E5 204F            12      JR  NZ,NOT_BANK_TYPE
0001E7 41E7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001EA 41EA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001ED 41ED CD3801          17      CALL    RSLREG      ;read primary slot #
0001F0 41F0 07               4      RLCA
0001F1 41F1 07               4      RLCA
0001F2 41F2 F5              11      PUSH    AF
0001F3 41F3 1605             7      LD  D,4+1
0001F5 41F5 CD4E42          17      CALL    GTSL2_
0001F8 41F8 3244F3          13      LD  (RAMAD3),A
0001FB 41FB F1              10      POP AF
0001FC 41FC 07               4      RLCA
0001FD 41FD 07               4      RLCA
0001FE 41FE 1603             7      LD  D,2+1
000200 4200 CD4E42          17      CALL    GTSL2_
000203 4203 2680             7      LD  H,080H
000205 4205 CD6B42          17      CALL    CHK_RAM
000208 4208 3243F3          13      LD  (RAMAD2),A
       420B                     RAMCHK2:
00020B 420B 3A44F3          13      LD  A,(RAMAD3)
00020E 420E 2640             7      LD  H,040H
000210 4210 CD6B42          17      CALL    CHK_RAM
000213 4213 3242F3          13      LD  (RAMAD1),A
       4216                     RAMCHK1:
000216 4216 3A44F3          13      LD  A,(RAMAD3)
000219 4219 2600             7      LD  H,00H
00021B 421B CD6B42          17      CALL    CHK_RAM
00021E 421E 3241F3          13      LD  (RAMAD0),A
       4221                     RAMCHK0:
000221 4221 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000224 4224 010F00          10      LD  BC,0000FH       ;切り上げ
000227 4227 09              11      ADD HL,BC
000228 4228 7D               4      LD  A,L
                                
000229 4229 0604             7      LD  B,4
       422B                     B_DRIVE1:
00022B 422B CB3C             8      SRL H
00022D 422D 1F               4      RRA
00022E 422E 10FB            13      DJNZ    B_DRIVE1
                                
000230 4230 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000232 4232 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000235 4235 C9              10      RET
                                
       4236                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000236 4236 21DE43          10      LD  HL,MSG_ERROR_ROM_MODE
000239 4239 CD8543          17      CALL    MSX
00023C 423C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000240 4240 DD219F00        14      LD  IX,CHGET
000244 4244 C31C00          10      JP  _CALSLT
                                
       4247                     GTSL1_:             ;自分のいるスロットを知る
000247 4247 CD3801          17      CALL    RSLREG      ;read primary slot #
00024A 424A 0F               4      RRCA
00024B 424B 0F               4      RRCA
00024C 424C 1601             7      LD  D,1
       424E                     GTSL2_:
00024E 424E E603             7      AND 3       ;[A]=000000PP
000250 4250 5F               4      LD  E,A     ;[E]=000000PP
000251 4251 21C1FC          10      LD  HL,EXPTBL
000254 4254 85               4      ADD A,L     ;桁上りは無い
000255 4255 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000256 4256 7B               4      LD  A,E     ;[A]=000000PP
000257 4257 CB7E            13      BIT 7,(HL)
000259 4259 C8              11      RET Z
00025A 425A 7D               4      LD  A,L     ;point to SLTTBL entry
00025B 425B C604             7      ADD A,4     ;桁上りは無い
00025D 425D 6F               4      LD  L,A
00025E 425E 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425F                     GTSL3_:
00025F 425F 15               4      DEC D
000260 4260 2803            12      JR  Z,GTSL4_:
000262 4262 0F               4      RRCA
000263 4263 18FA            12      JR  GTSL3_:
       4265                     GTSL4_:
000265 4265 E60C             7      AND 00CH        ;[A] = 0000SS00
000267 4267 B3               4      OR  E       ;[A] = 0000SSPP
000268 4268 F680             7      OR  080H        ;[A] = 1000SSPP
00026A 426A C9              10      RET
                                
       426B                     CHK_RAM:
00026B 426B E5              11      PUSH    HL
00026C 426C CDC042          17      CALL    CHK_RAM0
00026F 426F E1              10      POP HL
000270 4270 C8              11      RET Z
000271 4271 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000274 4274 E680             7      AND 080H
000276 4276 CD9742          17      CALL    CHK_RAM_SLT
000279 4279 C8              11      RET Z
00027A 427A 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027D 427D E680             7      AND 080H
00027F 427F C601             7      ADD A,1
000281 4281 CD9742          17      CALL    CHK_RAM_SLT
000284 4284 C8              11      RET Z
000285 4285 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000288 4288 E680             7      AND 080H
00028A 428A C602             7      ADD A,2
00028C 428C CD9742          17      CALL    CHK_RAM_SLT
00028F 428F C8              11      RET Z
000290 4290 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000293 4293 E680             7      AND 080H
000295 4295 C603             7      ADD A,3
       4297                     CHK_RAM_SLT:
000297 4297 E5              11      PUSH    HL
000298 4298 CDC042          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029B 429B E1              10      POP HL
00029C 429C C8              11      RET Z
00029D 429D CB79             8      BIT 7,C
00029F 429F 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A1 42A1 79               4      LD  A,C
0002A2 42A2 C604             7      ADD A,4*1           ;スロット#X-1
0002A4 42A4 E5              11      PUSH    HL
0002A5 42A5 CDC042          17      CALL    CHK_RAM0
0002A8 42A8 E1              10      POP HL
0002A9 42A9 C8              11      RET Z
0002AA 42AA 79               4      LD  A,C
0002AB 42AB C608             7      ADD A,4*2           ;スロット#X-2
0002AD 42AD E5              11      PUSH    HL
0002AE 42AE CDC042          17      CALL    CHK_RAM0
0002B1 42B1 E1              10      POP HL
0002B2 42B2 C8              11      RET Z
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 C60C             7      ADD A,4*3           ;スロット#X-3
0002B6 42B6 E5              11      PUSH    HL
0002B7 42B7 CDC042          17      CALL    CHK_RAM0
0002BA 42BA E1              10      POP HL
       42BB                     CHK_RAM_E:
0002BB 42BB AF               4      XOR A
0002BC 42BC 3C               4      INC A           ;ZF=0にする
0002BD 42BD 3E00             7      LD  A,0
0002BF 42BF C9              10      RET
                                
       42C0                     CHK_RAM0:
0002C0 42C0 4F               4      LD  C,A
0002C1 42C1 3A00F1          13      LD  A,(ROM_SLT)
0002C4 42C4 B9               4      CP  C
0002C5 42C5 28F4            12      JR  Z,CHK_RAM_E
0002C7 42C7 2E00             7      LD  L,0
       42C9                     CHK_RAM1:
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDFB42          17      CALL    CALSLT_R
0002D1 42D1 C6E5             7      ADD A,0E5H
0002D3 42D3 47               4      LD  B,A
0002D4 42D4 5F               4      LD  E,A
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 DD211400        14      LD  IX,_WRSLT
0002DA 42DA CDFB42          17      CALL    CALSLT_R
0002DD 42DD 79               4      LD  A,C
0002DE 42DE DD210C00        14      LD  IX,_RDSLT
0002E2 42E2 CDFB42          17      CALL    CALSLT_R
0002E5 42E5 B8               4      CP  B
0002E6 42E6 C0              11      RET NZ
0002E7 42E7 D6E5             7      SUB 0E5H
0002E9 42E9 79               4      LD  A,C
0002EA 42EA 5F               4      LD  E,A
0002EB 42EB DD211400        14      LD  IX,_WRSLT
0002EF 42EF CDFB42          17      CALL    CALSLT_R
0002F2 42F2 24               4      INC H
0002F3 42F3 7D               4      LD  A,L
0002F4 42F4 C604             7      ADD A,4
0002F6 42F6 6F               4      LD  L,A
0002F7 42F7 20D0            12      JR  NZ,CHK_RAM1
0002F9 42F9 79               4      LD  A,C     ;ZF=1のハズ
0002FA 42FA C9              10      RET
                                
       42FB                     CALSLT_R:
0002FB 42FB C5              11      PUSH    BC
0002FC 42FC E5              11      PUSH    HL
0002FD 42FD FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000301 4301 CD1C00          17      CALL    _CALSLT
000304 4304 E1              10      POP HL
000305 4305 C1              10      POP BC
000306 4306 C9              10      RET
                                
       4307                     AT_ISC:
000307 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000307 F0E9 FEB7             7      CP  0B7H            ;FILES
000309 F0EB CC7BFE          17      CALL    Z,H_FILE
00030C F0EE FEB5             7      CP  0B5H            ;LOAD
00030E F0F0 CA71FE          10      JP  Z,H_BINS
000311 F0F3 FE8A             7      CP  08AH            ;RUN
000313 F0F5 CA76FE          10      JP  Z,H_BINL
000316 F0F8 FED6             7      CP  0D6H            ;COPY
000318 F0FA 2813            12      JR  Z,FIX_COPY
00031A F0FC FECF             7      CP  0CFH            ;BLOAD
00031C F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031D F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031E F100 00                      DB  0
00031F F101 7245                    DW  ROM_BLOAD
000321 F103 F5              11      PUSH    AF
000322 F104 E5              11      PUSH    HL
000323 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000326 F108 E1              10      POP HL
000327 F109 F1              10      POP AF
000328 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
00032A F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032C F10E C9              10      RET
       F10F                     FIX_COPY:
00032D F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032E F110 00                      DB  0
00032F F111 D846                    DW  ROM_COPY
000331 F113 C9              10      RET
       F114                     ROMUSE1:
000332 F114 3A00F1          13      LD  A,(ROM_SLT)
000335 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000337 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
00033A F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033D F11F 00                      DB  0
       F120                     _BANK:
00033E F120 00                      DB  0
       F121                     _BANK1:
00033F F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
000340 F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000342 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000344 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000346 F128 0000                    DW  0
       F12A                     _CLPS:
000348 F12A 0000                    DW  0
       F12C                     _LEFT:
00034A F12C 0000                    DW  0
       F12E                     _DTPS:
00034C F12E 0000                    DW  0
       F130                     _DTA:
00034E F130 0000                    DW  0
       F132                     FLG_LDIR:
000350 F132 00                      DB  0
       F133                     _FCB:
000351 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000353 F135 00                      DB  0
       F136                     _BUF_ST:
000354 F136 0000                    DW  0
       F138                     _BUF_EN:
000356 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000358 F13A 0000                    DW  0
       F13C                     _BUF_H:
00035A F13C 0000                    DW  0
       F13E                     _BUF_X:
00035C F13E 0000                    DW  0
       F140                     _BUF_Y:
00035E F140 00                      DB  0
       F141                     _BUF_P:
00035F F141 00                      DB  0
       F142                     _BUF_O:
000360 F142 00                      DB  0
       F143                     DTAX:
000361 F143 0000                    DW  0
       F145                     B_DRIVE:
000363 F145 00                      DB  0
       F146                     _DVSW:          ;カレントドライブ
000364 F146 00                      DB  0
       F147                     _CD:            ;カレントディレクトリ
000365 F147 0000                    DW  0
       F149                     DIRENT1:
000367 F149 0000                    DW  0
       F14B                     _DIR_BANK:
000369 F14B 00                      DB  0
       F14C                     LEFTX:
00036A F14C 0000                    DW  0
       F14E                     PARAM0:
00036C F14E 0000                    DW  0
       F150                     PARAM1:
00036E F150 0000                    DW  0
       F152                     _CDX:
000370 F152 0000                    DW  0
       F154                     FDRV:
000372 F154 00                      DB  0
       F155                     FNAME:
000373 F155                         DS  8+3
       F160                     _HL:
00037E F160 0000                    DW  0
       F162                     _SP:
000380 F162 0000                    DW  0
                                
       F164                     ISC_E:
000382 4382                         ORG $$+RUN          ;$DEPHASE
                                
       4382                     MSX1:
000382 4382 CDAE50          17      CALL    MSGA1
       4385                     MSX:
000385 4385 7E               7      LD  A,(HL)
000386 4386 23               6      INC HL
000387 4387 B7               4      OR  A
000388 4388 20F8            12      JR  NZ,MSX1
00038A 438A C9              10      RET
                                
       438B                     PRTHX:
00038B 438B F5              11      PUSH    AF
00038C 438C 07               4      RLCA
00038D 438D 07               4      RLCA
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 CD9443          17      CALL    PRTA2
000393 4393 F1              10      POP AF
       4394                     PRTA2:
000394 4394 CD9A43          17      CALL    ASC
000397 4397 C3AA50          10      JP  MSG_A
                                    
       439A                     ASC:
00039A 439A E60F             7      AND $0F
00039C 439C F630             7      OR  $30
00039E 439E FE3A             7      CP  $3A
0003A0 43A0 D8              11      RET C
0003A1 43A1 C607             7      ADD A,7
0003A3 43A3 C9              10      RET
                                
       43A4                     MSN:
0003A4 43A4 7E               7      LD  A,(HL)
0003A5 43A5 23               6      INC HL
0003A6 43A6 CDAA50          17      CALL    MSG_A
0003A9 43A9 10F9            13      DJNZ    MSN
0003AB 43AB C9              10      RET
                                
       43AC                     ROM_BOOT:
0003AC 43AC 3E                      DB  03EH
0003AD 43AD C9              10      RET
0003AE 43AE 32DBFD          13      LD  (H_PINL),A
                                
0003B1 43B1 210444          10      LD  HL,DELOK
0003B4 43B4 CD8543          17      CALL    MSX
                                
0003B7 43B7 AF               4      XOR A
0003B8 43B8 3240F3          13      LD  (REBOOT),A
0003BB 43BB 2A48FC          16      LD  HL,(BOTTOM)
0003BE 43BE 110040          10      LD  DE,16384
0003C1 43C1 19              11      ADD HL,DE
0003C2 43C2 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003C4 43C4 57               4      LD  D,A
0003C5 43C5 0601             7      LD  B,1
0003C7 43C7 2100C0          10      LD  HL,0C000H
0003CA 43CA CD724E          17      CALL    DISKIO
                                
0003CD 43CD 116BF3          10      LD  DE,RAMUSE
0003D0 43D0 AF               4      XOR A
0003D1 43D1 CD1EC0          17      CALL    0C01EH
0003D4 43D4 116BF3          10      LD  DE,RAMUSE
0003D7 43D7 37               4      SCF
0003D8 43D8 CD1EC0          17      CALL    0C01EH
       43DB                     BOOT1:
0003DB 43DB C3FD4F          10      JP  BASENT
                                
       43DE                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003DE 43DE 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       4403                     NULL:
000403 4403 00                      DB  0
       4404                     DELOK:
000404 4404 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4408                     ROM_LDIR:
000408 4408 3A32F1          13      LD  A,(FLG_LDIR)
00040B 440B B7               4      OR  A
00040C 440C 2008            12      JR  NZ,ROM_LDIRVM
00040E 440E CB7A             8      BIT 7,D
000410 4410 CA2844          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
000413 4413 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                    EI
                                #endif
000415 4415 C9              10      RET
                                
       4416                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000416 4416 C5              11      PUSH    BC
000417 4417 D5              11      PUSH    DE
000418 4418 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00041C 441C DD215C00        14      LD  IX,LDIRVM
000420 4420 CD1C00          17      CALL    _CALSLT
000423 4423 E1              10      POP HL
000424 4424 C1              10      POP BC
000425 4425 09              11      ADD HL,BC
000426 4426 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000427 4427 C9              10      RET
                                #endif
                                
       4428                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4428                     ROM_LDIRSLT1:
000428 4428 EB               4      EX  DE,HL
       4429                     RLDIRSLT1:
000429 4429 1A               7      LD  A,(DE)
00042A 442A 13               6      INC DE
00042B 442B C5              11      PUSH    BC
00042C 442C D5              11      PUSH    DE
00042D 442D E5              11      PUSH    HL
00042E 442E 5F               4      LD  E,A
                                
00042F 442F 0141F3          10      LD  BC,RAMAD0
000432 4432 7C               4      LD  A,H
000433 4433 07               4      RLCA
000434 4434 07               4      RLCA
000435 4435 E603             7      AND 3
000437 4437 81               4      ADD A,C
000438 4438 4F               4      LD  C,A
000439 4439 0A               7      LD  A,(BC)
       443A                     RLDIRSLT2:
00043A 443A CD1400          17      CALL    _WRSLT
00043D 443D 08               4      EX  AF,AF'
00043E 443E E1              10      POP HL
00043F 443F D1              10      POP DE
000440 4440 C1              10      POP BC
000441 4441 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000443 4443 EA2944          10      JP  PE,RLDIRSLT1
000446 4446 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000447 4447 C9              10      RET
                                #endif
                                
       4448                     END_OF_LINE:
000448 4448 215EF5          10      LD  HL,BUF
       444B                     EOL1:
00044B 444B 7E               7      LD  A,(HL)
00044C 444C C8              11      RET Z
00044D 444D FE0D             7      CP  00DH
00044F 444F 2807            12      JR  Z,EOLE
000451 4451 FE0A             7      CP  00AH
000453 4453 2803            12      JR  Z,EOLE
000455 4455 23               6      INC HL
000456 4456 18F3            12      JR  EOL1
       4458                     EOLE:
000458 4458 3600            10      LD  (HL),0
00045A 445A 23               6      INC HL
00045B 445B 7E               7      LD  A,(HL)
00045C 445C FE0A             7      CP  00AH
00045E 445E C0              11      RET NZ
00045F 445F 23               6      INC HL
000460 4460 C9              10      RET
                                
       4461                     ROM_LOAD_ASCII:
000461 4461 210000          10      LD  HL,0
000464 4464 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000467 4467 2A76F6          16      LD  HL,(TXTTAB)
00046A 446A 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00046D 446D 215EF5          10      LD  HL,BUF
000470 4470 2230F1          16      LD  (_DTA),HL
       4473                     RLOAD_A1:
000473 4473 2A36F1          16      LD  HL,(_BUF_ST)
000476 4476 2226F1          16      LD  (RR_LOW),HL
000479 4479 210201          10      LD  HL,258
00047C 447C CDF748          17      CALL    ROM_READ
00047F 447F 7C               4      LD  A,H
000480 4480 B5               4      OR  L
000481 4481 2877            12      JR  Z,RLOAD_AEND
000483 4483 015EF5          10      LD  BC,BUF
000486 4486 09              11      ADD HL,BC
000487 4487 3600            10      LD  (HL),0
000489 4489 CD4844          17      CALL    END_OF_LINE
00048C 448C 015EF5          10      LD  BC,BUF
00048F 448F A7               4      AND A
000490 4490 ED42            15      SBC HL,BC
000492 4492 2810            12      JR  Z,RLOAD_A2
000494 4494 4D               4      LD  C,L
000495 4495 44               4      LD  B,H
000496 4496 ED5B36F1        20      LD  DE,(_BUF_ST)
00049A 449A 19              11      ADD HL,DE
00049B 449B 2236F1          16      LD  (_BUF_ST),HL
00049E 449E 3A5EF5          13      LD  A,(BUF)
0004A1 44A1 B7               4      OR  A
0004A2 44A2 28CF            12      JR  Z,RLOAD_A1
       44A4                     RLOAD_A2:
0004A4 44A4 115EF5          10      LD  DE,BUF
0004A7 44A7 CDAE4A          17      CALL    SPCUTEX
0004AA 44AA 1A               7      LD  A,(DE)
0004AB 44AB B7               4      OR  A
0004AC 44AC 284C            12      JR  Z,RLOAD_AEND
0004AE 44AE CDC04A          17      CALL    GETNUM
0004B1 44B1 7C               4      LD  A,H
0004B2 44B2 B5               4      OR  L
0004B3 44B3 CA5945          10      JP  Z,ERROR_DIRECT_IN_FILE
0004B6 44B6 DD2A38F1        20      LD  IX,(_BUF_EN)
0004BA 44BA DD7502          19      LD  (IX+2),L
0004BD 44BD DD7403          19      LD  (IX+3),H
                                
0004C0 44C0 CDA74A          17      CALL    SPCUT
0004C3 44C3 EB               4      EX  DE,HL
0004C4 44C4 DDE5            15      PUSH    IX
0004C6 44C6 DD21B242        14      LD  IX,CRUNCH
0004CA 44CA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004CE 44CE CD1C00          17      CALL    _CALSLT
0004D1 44D1 DDE1            14      POP IX
0004D3 44D3 EB               4      EX  DE,HL
0004D4 44D4 111FF4          10      LD  DE,KBUF
0004D7 44D7 37               4      SCF
0004D8 44D8 ED52            15      SBC HL,DE
0004DA 44DA 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
0004DC 44DC 387B            12      JR  C,ERROR_DIRECT_IN_FILE
0004DE 44DE 4D               4      LD  C,L
0004DF 44DF 44               4      LD  B,H
0004E0 44E0 2A38F1          16      LD  HL,(_BUF_EN)
0004E3 44E3 110400          10      LD  DE,4
0004E6 44E6 19              11      ADD HL,DE
0004E7 44E7 111FF4          10      LD  DE,KBUF
                                
0004EA 44EA EB               4      EX  DE,HL
0004EB 44EB EDB0                    LDIR
0004ED 44ED EB               4      EX  DE,HL
                                
0004EE 44EE DD7500          19      LD  (IX+0),L
0004F1 44F1 DD7401          19      LD  (IX+1),H
0004F4 44F4 2238F1          16      LD  (_BUF_EN),HL
0004F7 44F7 C37344          10      JP  RLOAD_A1
                                
       44FA                     RLOAD_AEND:
0004FA 44FA 2A38F1          16      LD  HL,(_BUF_EN)
0004FD 44FD AF               4      XOR A
0004FE 44FE 77               7      LD  (HL),A
0004FF 44FF 23               6      INC HL
000500 4500 77               7      LD  (HL),A
000501 4501 23               6      INC HL
000502 4502 2238F1          16      LD  (_BUF_EN),HL
000505 4505 183B            12      JR  RLOAD_END1
                                
       4507                     ROM_LOAD:
000507 4507 CDA246          17      CALL    INIT_PARAM
00050A 450A CD9849          17      CALL    FILE_B
00050D 450D 3A55F1          13      LD  A,(FNAME)
000510 4510 FE20             7      CP  020H
000512 4512 CA9349          10      JP  Z,ROM_ORG
                                
000515 4515 CD174B          17      CALL    ROM_OPEN
000518 4518 384B            12      JR  C,ERROR_FILE_NOT_FOUND
       451A                     ROM_LOAD1:
00051A 451A 2135F1          10      LD  HL,_BUF
00051D 451D 2230F1          16      LD  (_DTA),HL
000520 4520 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000523 4523 CDF748          17      CALL    ROM_READ
000526 4526 3A35F1          13      LD  A,(_BUF)
000529 4529 3C               4      INC A
00052A 452A C26144          10      JP  NZ,ROM_LOAD_ASCII
00052D 452D 2A76F6          16      LD  HL,(TXTTAB)
000530 4530 2230F1          16      LD  (_DTA),HL
000533 4533 EB               4      EX  DE,HL
000534 4534 2100FF          10      LD  HL,-256
000537 4537 39              11      ADD HL,SP
000538 4538 ED52            15      SBC HL,DE
00053A 453A CDF748          17      CALL    ROM_READ
00053D 453D ED5B30F1        20      LD  DE,(_DTA)
000541 4541 19              11      ADD HL,DE
       4542                     RLOAD_END1:
000542 4542 22C2F6          16      LD  (VARTAB),HL
000545 4545 22C4F6          16      LD  (ARYTAB),HL
000548 4548 22C6F6          16      LD  (STREND),HL
                                
00054B 454B AF               4      XOR A
00054C 454C 2138F1          10      LD  HL,_BUF+3
00054F 454F 77               7      LD  (HL),A
000550 4550 2B               6      DEC HL
000551 4551 77               7      LD  (HL),A
000552 4552 2B               6      DEC HL
000553 4553 77               7      LD  (HL),A
000554 4554 2B               6      DEC HL
000555 4555 3E8F             7      LD  A,08FH          ;REM
000557 4557 77               7      LD  (HL),A
000558 4558 C9              10      RET
                                
       4559                     ERROR_DIRECT_IN_FILE:
000559 4559 1E39             7      LD  E,57            ;Direct statement in file
00055B 455B 01                      DB  1           ;LD BC,
       455C                     ERROR_DEVICE_IO_ERROR:
00055C 455C 1E13             7      LD  E,19            ;Device I/O error
00055E 455E 01                      DB  1           ;LD BC,
       455F                     ERROR_INTERNAL_ERROR:
00055F 455F 1E33             7      LD  E,51            ;Internal error
000561 4561 01                      DB  1           ;LD BC,
       4562                     ERROR_FILE_NOT_OPEN:
000562 4562 1E3B             7      LD  E,59            ;File not OPEN
000564 4564 01                      DB  1           ;LD BC,
       4565                     ERROR_FILE_NOT_FOUND:
000565 4565 1E35             7      LD  E,53            ;File not found
       4567                     ERROR:
000567 4567 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00056B 456B DD216F40        14      LD  IX,ERRHAND
00056F 456F C31C00          10      JP  _CALSLT
                                
       4572                     ROM_BLOAD:
000572 4572 CDA246          17      CALL    INIT_PARAM
000575 4575 CD9849          17      CALL    FILE_B
000578 4578 CD174B          17      CALL    ROM_OPEN
00057B 457B 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00057D 457D 2135F1          10      LD  HL,_BUF
000580 4580 2230F1          16      LD  (_DTA),HL
000583 4583 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000586 4586 CDF748          17      CALL    ROM_READ
000589 4589 3A35F1          13      LD  A,(_BUF)
00058C 458C FEFE             7      CP  0FEH
00058E 458E 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
000590 4590 210EF1          10      LD  HL,BLOAD_RET
000593 4593 2206F1          16      LD  (SWC_BLOAD),HL
                                
000596 4596 2A50F1          16      LD  HL,(PARAM1)
000599 4599 7E               7      LD  A,(HL)
00059A 459A FE2C             7      CP  ','
00059C 459C 2048            12      JR  NZ,RBREAD_MEM
00059E 459E 23               6      INC HL
00059F 459F 7E               7      LD  A,(HL)
0005A0 45A0 CD014B          17      CALL    CAP
0005A3 45A3 32BEFC          13      LD  (RUNBNF),A
       45A6                     RBOS1:
0005A6 45A6 7E               7      LD  A,(HL)
0005A7 45A7 23               6      INC HL
0005A8 45A8 B7               4      OR  A
0005A9 45A9 282F            12      JR  Z,RBREAD_OSE
0005AB 45AB FE3A             7      CP  ':'
0005AD 45AD 282B            12      JR  Z,RBREAD_OSE
0005AF 45AF FE2C             7      CP  ','     ;次のパラメータを探す
0005B1 45B1 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005B3 45B3 2250F1          16      LD  (PARAM1),HL
0005B6 45B6 7E               7      LD  A,(HL)
0005B7 45B7 B7               4      OR  A
0005B8 45B8 2820            12      JR  Z,RBREAD_OSE
0005BA 45BA DD21644C        14      LD  IX,FRMEVL
0005BE 45BE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005C2 45C2 CD1C00          17      CALL    _CALSLT
0005C5 45C5 2250F1          16      LD  (PARAM1),HL
0005C8 45C8 3A63F6          13      LD  A,(VALTYP)
0005CB 45CB FE02             7      CP  2
0005CD 45CD 200B            12      JR  NZ,RBREAD_OSE
0005CF 45CF 2A36F1          16      LD  HL,(_BUF_ST)
0005D2 45D2 ED5BF8F7        20      LD  DE,(DACDAT)
0005D6 45D6 19              11      ADD HL,DE
0005D7 45D7 2236F1          16      LD  (_BUF_ST),HL
       45DA                     RBREAD_OSE:
0005DA 45DA 3ABEFC          13      LD  A,(RUNBNF)
0005DD 45DD FE53             7      CP  'S'
0005DF 45DF 2005            12      JR  NZ,RBREAD_MEM
0005E1 45E1 3E01             7      LD  A,1
0005E3 45E3 3232F1          13      LD  (FLG_LDIR),A
       45E6                     RBREAD_MEM:
0005E6 45E6 2A36F1          16      LD  HL,(_BUF_ST)
0005E9 45E9 22BFFC          16      LD  (SAVENT),HL
0005EC 45EC 2230F1          16      LD  (_DTA),HL
0005EF 45EF 21FFFF          10      LD  HL,0FFFFH
0005F2 45F2 CDF748          17      CALL    ROM_READ
0005F5 45F5 3ABEFC          13      LD  A,(RUNBNF)
0005F8 45F8 FE52             7      CP  'R'
0005FA 45FA 2006            12      JR  NZ,RBREAD1
0005FC 45FC 2A3AF1          16      LD  HL,(_BUF_EX)
0005FF 45FF 2206F1          16      LD  (SWC_BLOAD),HL
       4602                     RBREAD1:
       4602                     ROM_NEXT:
000602 4602 2A50F1          16      LD  HL,(PARAM1)
000605 4605 7E               7      LD  A,(HL)
000606 4606 2B               6      DEC HL
000607 4607 B7               4      OR  A
000608 4608 2805            12      JR  Z,RN1
00060A 460A FE3A             7      CP  ':'
00060C 460C 2801            12      JR  Z,RN1
00060E 460E 23               6      INC HL
       460F                     RN1:
00060F 460F 5D               4      LD  E,L
000610 4610 54               4      LD  D,H
                                
000611 4611 CDD74A          17      CALL    SEARCH_END
000614 4614 B7               4      OR  A
000615 4615 2821            12      JR  Z,REM
       4617                     RN3:                    ;マルチステートメントの処理
000617 4617 7E               7      LD  A,(HL)
                                
000618 4618 FEB5             7      CP  0B5H            ;LOAD
00061A 461A CA0745          10      JP  Z,ROM_LOAD
00061D 461D FE8A             7      CP  08AH            ;RUN
00061F 461F 281B            12      JR  Z,ROM_RUN
000621 4621 FEB7             7      CP  0B7H            ;FILES
000623 4623 2824            12      JR  Z,ROM_FILES
000625 4625 FED6             7      CP  0D6H            ;COPY
000627 4627 CAD846          10      JP  Z,ROM_COPY
00062A 462A FE20             7      CP  020H
00062C 462C 2807            12      JR  Z,RN_SP
                                
00062E 462E 3E28             7      LD  A,028H          ;JR Z,
000630 4630 320CF1          13      LD  (SWC_BLOAD_M),A
000633 4633 7E               7      LD  A,(HL)
000634 4634 C9              10      RET
       4635                     RN_SP:
000635 4635 23               6      INC HL
000636 4636 18DF            12      JR  RN3
                                
       4638                     REM:
000638 4638 EB               4      EX  DE,HL
000639 4639 3E8F             7      LD  A,08FH          ;REM
00063B 463B C9              10      RET
                                
       463C                     ROM_RUN:
00063C 463C 23               6      INC HL
00063D 463D 7E               7      LD  A,(HL)
00063E 463E 2B               6      DEC HL
00063F 463F B7               4      OR  A
000640 4640 2803            12      JR  Z,ROM_RUN1
000642 4642 CD0745          17      CALL    ROM_LOAD
       4645                     ROM_RUN1:
000645 4645 3E8A             7      LD  A,08AH          ;RUN
000647 4647 77               7      LD  (HL),A
000648 4648 C9              10      RET
                                
       4649                     ROM_FILES:
000649 4649 CDA246          17      CALL    INIT_PARAM
00064C 464C CD9849          17      CALL    FILE_B
00064F 464F CD3D50          17      CALL    GET_DISK_BANK_FDRV
000652 4652 3A25F1          13      LD  A,(SECSZ_H)
000655 4655 CDF84E          17      CALL    IS_BPB1
000658 4658 DA5C45          10      JP  C,ERROR_DEVICE_IO_ERROR
00065B 465B 3A55F1          13      LD  A,(FNAME)
00065E 465E FE21             7      CP  021H
000660 4660 3005            12      JR  NC,RFILES0
000662 4662 060B             7      LD  B,11
000664 4664 CD6B4A          17      CALL    FILE10
       4667                     RFILES0:
000667 4667 CD844D          17      CALL    GET_DIR_DAT
       466A                     RFILES1:
00066A 466A CD334B          17      CALL    FILESE
00066D 466D 302E            12      JR  NC,RFILES_NOT_MATCH
       466F                     RFILES_DISP:
00066F 466F E5              11      PUSH    HL
000670 4670 0608             7      LD  B,8
000672 4672 CDA443          17      CALL    MSN
000675 4675 3E2E             7      LD  A,'.'
000677 4677 CDAA50          17      CALL    MSG_A
00067A 467A 0603             7      LD  B,3
00067C 467C CDA443          17      CALL    MSN
00067F 467F 3ADDF3          13      LD  A,(CSRX)
000682 4682 47               4      LD  B,A
000683 4683 3AB0F3          13      LD  A,(LINLEN)
000686 4686 90               4      SUB B
000687 4687 FE0C             7      CP  12
000689 4689 3009            12      JR  NC,RFILES2
00068B 468B 3E0D             7      LD  A,00DH      ;改行
00068D 468D CDAA50          17      CALL    MSG_A
000690 4690 3E0A             7      LD  A,00AH
000692 4692 1802            12      JR  RFILES3
       4694                     RFILES2:
000694 4694 3E20             7      LD  A,020H
       4696                     RFILES3:
000696 4696 CDAA50          17      CALL    MSG_A
000699 4699 E1              10      POP HL
00069A 469A CD4F4B          17      CALL    FNEXT
       469D                     RFILES_NOT_MATCH:
00069D 469D 20CB            12      JR  NZ,RFILES1
00069F 469F C30246          10      JP  ROM_NEXT
                                
       46A2                     INIT_PARAM:
0006A2 46A2 224EF1          16      LD  (PARAM0),HL
0006A5 46A5 2250F1          16      LD  (PARAM1),HL
0006A8 46A8 EB               4      EX  DE,HL
0006A9 46A9 AF               4      XOR A
0006AA 46AA 3232F1          13      LD  (FLG_LDIR),A
0006AD 46AD 32BEFC          13      LD  (RUNBNF),A
0006B0 46B0 3263F6          13      LD  (VALTYP),A
0006B3 46B3 E5              11      PUSH    HL
0006B4 46B4 2A47F1          16      LD  HL,(_CD)
0006B7 46B7 2252F1          16      LD  (_CDX),HL
0006BA 46BA E1              10      POP HL
0006BB 46BB 13               6      INC DE
0006BC 46BC CDA74A          17      CALL    SPCUT
0006BF 46BF 1A               7      LD  A,(DE)
0006C0 46C0 B7               4      OR  A
0006C1 46C1 C8              11      RET Z
0006C2 46C2 FE3A             7      CP  ':'
0006C4 46C4 C8              11      RET Z
0006C5 46C5 FE28             7      CP  '('
0006C7 46C7 C8              11      RET Z
0006C8 46C8 EB               4      EX  DE,HL
0006C9 46C9 DD21644C        14      LD  IX,FRMEVL
0006CD 46CD FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006D1 46D1 CD1C00          17      CALL    _CALSLT
0006D4 46D4 2250F1          16      LD  (PARAM1),HL
0006D7 46D7 C9              10      RET
                                
       46D8                     ROM_COPY:
0006D8 46D8 CDA246          17      CALL    INIT_PARAM
0006DB 46DB 3A63F6          13      LD  A,(VALTYP)
0006DE 46DE FE03             7      CP  3       ;string
0006E0 46E0 C29349          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
0006E3 46E3 CD9849          17      CALL    FILE_B
0006E6 46E6 CD174B          17      CALL    ROM_OPEN
0006E9 46E9 DA6545          10      JP  C,ERROR_FILE_NOT_FOUND
                                
0006EC 46EC 213AF1          10      LD  HL,_BUF_W
0006EF 46EF 2230F1          16      LD  (_DTA),HL
0006F2 46F2 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
0006F5 46F5 CDF748          17      CALL    ROM_READ
                                
0006F8 46F8 AF               4      XOR A
0006F9 46F9 3235F1          13      LD  (_BUF_LO),A     ;PSET
0006FC 46FC 3242F1          13      LD  (_BUF_O),A      ;向き
                                
0006FF 46FF 2A50F1          16      LD  HL,(PARAM1)
       4702                     RCP_PARAM1:
000702 4702 7E               7      LD  A,(HL)
000703 4703 23               6      INC HL
000704 4704 B7               4      OR  A
000705 4705 CA9349          10      JP  Z,ROM_ORG
000708 4708 FE3A             7      CP  ':'
00070A 470A CA9349          10      JP  Z,ROM_ORG
00070D 470D FE2C             7      CP  ','
00070F 470F 2012            12      JR  NZ,RCP_PARAM1_
                                
000711 4711 DD212F54        14      LD  IX,FRMQNT
000715 4715 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000719 4719 CD1C00          17      CALL    _CALSLT
00071C 471C 7B               4      LD  A,E
00071D 471D 87               4      ADD A,A
00071E 471E 87               4      ADD A,A
00071F 471F 3242F1          13      LD  (_BUF_O),A
000722 4722 7E               7      LD  A,(HL)
       4723                     RCP_PARAM1_:
000723 4723 FE28             7      CP  '('
000725 4725 20DB            12      JR  NZ,RCP_PARAM1
                                
000727 4727 DD212F54        14      LD  IX,FRMQNT
00072B 472B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00072F 472F CD1C00          17      CALL    _CALSLT
                                
000732 4732 ED533EF1        20      LD  (_BUF_X),DE
                                
       4736                     RCP_PARAM2:
000736 4736 23               6      INC HL
000737 4737 7E               7      LD  A,(HL)
000738 4738 FE20             7      CP  020H
00073A 473A 28FA            12      JR  Z,RCP_PARAM2
00073C 473C FE2C             7      CP  ','
00073E 473E 28F6            12      JR  Z,RCP_PARAM2
                                
000740 4740 DD212F54        14      LD  IX,FRMQNT
000744 4744 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000748 4748 CD1C00          17      CALL    _CALSLT
                                
00074B 474B 3AF6FA          13      LD  A,(ACPAGE)
00074E 474E 57               4      LD  D,A
00074F 474F ED5340F1        20      LD  (_BUF_Y),DE
       4753                     RCP_PARAM3:
000753 4753 23               6      INC HL
000754 4754 7E               7      LD  A,(HL)
000755 4755 FE20             7      CP  020H
000757 4757 28FA            12      JR  Z,RCP_PARAM3
000759 4759 FE29             7      CP  ')'
00075B 475B 28F6            12      JR  Z,RCP_PARAM3
00075D 475D FE2C             7      CP  ','
00075F 475F 2033            12      JR  NZ,RCP_ST
                                
000761 4761 23               6      INC HL
000762 4762 DD212F54        14      LD  IX,FRMQNT
000766 4766 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00076A 476A CD1C00          17      CALL    _CALSLT
                                
00076D 476D 7B               4      LD  A,E
00076E 476E 3241F1          13      LD  (_BUF_P),A
                                
       4771                     RCP_PARAM4:
000771 4771 7E               7      LD  A,(HL)
000772 4772 23               6      INC HL
000773 4773 FE20             7      CP  020H
000775 4775 28FA            12      JR  Z,RCP_PARAM4
                                
000777 4777 FE2C             7      CP  ','
000779 4779 2019            12      JR  NZ,RCP_ST
                                
00077B 477B 7E               7      LD  A,(HL)
00077C 477C 0604             7      LD  B,4
00077E 477E FEC3             7      CP  0C3H        ;PRESET
000780 4780 280E            12      JR  Z,RCP_LO
000782 4782 05               4      DEC B       ;3
000783 4783 D6F8             7      SUB 0F8H        ;XOR
000785 4785 2809            12      JR  Z,RCP_LO
000787 4787 05               4      DEC B       ;2
000788 4788 3C               4      INC A       ;OR
000789 4789 2805            12      JR  Z,RCP_LO
00078B 478B 05               4      DEC B       ;1
00078C 478C 3C               4      INC A       ;AND
00078D 478D 2801            12      JR  Z,RCP_LO
00078F 478F 05               4      DEC B       ;0
                                                ;PSET
       4790                     RCP_LO:
000790 4790 78               4      LD  A,B
000791 4791 3235F1          13      LD  (_BUF_LO),A
       4794                     RCP_ST:
000794 4794 2AC6F6          16      LD  HL,(STREND)
000797 4797 2230F1          16      LD  (_DTA),HL
00079A 479A EB               4      EX  DE,HL
00079B 479B 2100FE          10      LD  HL,-512
00079E 479E 39              11      ADD HL,SP
00079F 479F AF               4      XOR A
0007A0 47A0 ED52            15      SBC HL,DE
0007A2 47A2 3008            12      JR  NC,RCP0
0007A4 47A4 215EF5          10      LD  HL,BUF
0007A7 47A7 2230F1          16      LD  (_DTA),HL
0007AA 47AA 6F               4      LD  L,A ;0
0007AB 47AB 67               4      LD  H,A ;0
       47AC                     RCP0:
0007AC 47AC 24               4      INC H
0007AD 47AD 2238F1          16      LD  (_BUF_EN),HL
       47B0                     RCP1:
0007B0 47B0 F3               4      DI
0007B1 47B1 CD8548          17      CALL    WAIT_VDP
                                
0007B4 47B4 3A0700          13      LD  A,(WRVDP)
0007B7 47B7 4F               4      LD  C,A
0007B8 47B8 0C               4      INC C       ;C := PORT#1's address(WR)
0007B9 47B9 3E24             7      LD  A,36
0007BB 47BB ED79            12      OUT (C),A
0007BD 47BD 3E91             7      LD  A,080H+17
0007BF 47BF ED79            12      OUT (C),A       ;R#17 := 36
                                
0007C1 47C1 0C               4      INC C
0007C2 47C2 0C               4      INC C       ;C := PORT#3's address(WR)
0007C3 47C3 2A3EF1          16      LD  HL,(_BUF_X)
0007C6 47C6 ED69            12      OUT (C),L       ;R#36 DX
0007C8 47C8 ED61            12      OUT (C),H       ;R#37
0007CA 47CA 2A40F1          16      LD  HL,(_BUF_Y)
0007CD 47CD ED69            12      OUT (C),L       ;R#38 DY
0007CF 47CF ED61            12      OUT (C),H       ;R#39
0007D1 47D1 2A3AF1          16      LD  HL,(_BUF_W)
0007D4 47D4 ED69            12      OUT (C),L       ;R#40 NX
0007D6 47D6 ED61            12      OUT (C),H       ;R#41
0007D8 47D8 2A3CF1          16      LD  HL,(_BUF_H)
0007DB 47DB ED69            12      OUT (C),L       ;R#42 NY
0007DD 47DD ED61            12      OUT (C),H       ;R#43
                                
0007DF 47DF DD2AAFFC        20      LD  IX,(SCRMOD)
0007E3 47E3 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0007E6 47E6 B7               4      OR  A
0007E7 47E7 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
0007E9 47E9 DD7D             9      LD  A,IXL
0007EB 47EB FE08             7      CP  8
0007ED 47ED 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
0007EF 47EF FE06             7      CP  6
0007F1 47F1 2A3EF1          16      LD  HL,(_BUF_X)
0007F4 47F4 3A3AF1          13      LD  A,(_BUF_W)
0007F7 47F7 2005            12      JR  NZ,SCR57
0007F9 47F9 B5               4      OR  L       ;スクリーン6
0007FA 47FA E603             7      AND 3
0007FC 47FC 200D            12      JR  NZ,USE_LMMC
       47FE                     SCR57:              ;スクリーン5,7
0007FE 47FE B5               4      OR  L
0007FF 47FF E601             7      AND 1
000801 4801 2008            12      JR  NZ,USE_LMMC
       4803                     USE_HMMC:
000803 4803 DD2E08          10      LD  IXL,8
       4806                     USE_HMMC8:
000806 4806 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000808 4808 3235F1          13      LD  (_BUF_LO),A
       480B                     USE_LMMC:
00080B 480B 110000          10      LD  DE,0
00080E 480E 06FF             7      LD  B,-1
000810 4810 CDB048          17      CALL    GET_PIXEL
000813 4813 ED79            12      OUT (C),A       ;R#44 first DATA
000815 4815 3A42F1          13      LD  A,(_BUF_O)
000818 4818 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
00081A 481A 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00081D 481D F6B0             7      OR  0B0H        ;R#46 LMMC command
00081F 481F ED79            12      OUT (C),A
                                
000821 4821 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000823 4823 0D               4      DEC C
000824 4824 0D               4      DEC C       ;C := PORT#1's address(WR)
000825 4825 3EAC             7      LD  A,080H+44
000827 4827 ED79            12      OUT (C),A
000829 4829 3E91             7      LD  A,080H+17
00082B 482B ED79            12      OUT (C),A       ;R#17 := 44
                                
00082D 482D 3A0600          13      LD  A,(RDVDP)
000830 4830 3C               4      INC A
000831 4831 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000833 4833 3E02             7      LD  A,2
000835 4835 ED79            12      OUT (C),A
000837 4837 3E8F             7      LD  A,08FH
000839 4839 ED79            12      OUT (C),A
00083B 483B 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00083E 483E E640             7      AND 040H
000840 4840 201C            12      JR  NZ,LOOP_HMMC
       4842                     LOOP_COPY:
000842 4842 CDB048          17      CALL    GET_PIXEL
000845 4845 08               4      EX  AF,AF'
000846 4846 FD4C             9      LD  C,IYH
       4848                     LOOP_COPY1:
000848 4848 ED78            12      IN  A,(C)
00084A 484A 0F               4      RRCA            ;RRCAではサインフラグは変化しない
00084B 484B 300A            12      JR  NC,EXIT_COPY    ;check CE bit
00084D 484D F24848          10      JP  P,LOOP_COPY1    ;check TR bit
000850 4850 08               4      EX  AF,AF'
000851 4851 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000853 4853 ED79            12      OUT (C),A
000855 4855 18EB            12      JR  LOOP_COPY
                                
       4857                     EXIT_COPY:
000857 4857 CD8D48          17      CALL    GET_STATUS_0
00085A 485A FB               4      EI
00085B 485B C30246          10      JP  ROM_NEXT
                                
       485E                     LOOP_HMMC:
00085E 485E FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000860 4860 43               4      LD  B,E
000861 4861 7B               4      LD  A,E
000862 4862 B7               4      OR  A
000863 4863 2802            12      JR  Z,LOOP_HMMC1
000865 4865 EDB3                    OTIR
       4867                     LOOP_HMMC1:
000867 4867 14               4      INC D
       4868                     LOOP_HMMC2:
000868 4868 15               4      DEC D
000869 4869 2805            12      JR  Z,LOOP_HMMC3
00086B 486B EDB3                    OTIR
00086D 486D C36848          10      JP  LOOP_HMMC2
       4870                     LOOP_HMMC3:
000870 4870 ED78            12      IN  A,(C)
000872 4872 0F               4      RRCA
000873 4873 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
000875 4875 2A38F1          16      LD  HL,(_BUF_EN)
000878 4878 CDF748          17      CALL    ROM_READ
00087B 487B EB               4      EX  DE,HL
00087C 487C 2A30F1          16      LD  HL,(_DTA)
00087F 487F 7A               4      LD  A,D
000880 4880 B3               4      OR  E
000881 4881 20DB            12      JR  NZ,LOOP_HMMC
000883 4883 18C3            12      JR  LOOP_COPY1
                                    
       4885                     WAIT_VDP:
000885 4885 3E02             7      LD  A,2
000887 4887 CD8E48          17      CALL    GET_STATUS
00088A 488A 0F               4      RRCA
00088B 488B 38F8            12      JR  C,WAIT_VDP
       488D                     GET_STATUS_0:
00088D 488D AF               4      XOR A
       488E                     GET_STATUS:
00088E 488E C5              11      PUSH    BC
00088F 488F ED4B0600        20      LD  BC,(RDVDP)
000893 4893 0C               4      INC C
000894 4894 ED79            12      OUT (C),A
000896 4896 3E8F             7      LD  A,08FH
000898 4898 ED79            12      OUT (C),A
00089A 489A ED78            12      IN  A,(C)
00089C 489C C1              10      POP BC
00089D 489D C9              10      RET
                                
       489E                     GET_PIXEL256:
00089E 489E 7A               4      LD  A,D
00089F 489F B3               4      OR  E
0008A0 48A0 200A            12      JR  NZ,GET_PIXEL1
0008A2 48A2 2A38F1          16      LD  HL,(_BUF_EN)
0008A5 48A5 CDF748          17      CALL    ROM_READ
0008A8 48A8 EB               4      EX  DE,HL
0008A9 48A9 2A30F1          16      LD  HL,(_DTA)
       48AC                     GET_PIXEL1:
0008AC 48AC 7E               7      LD  A,(HL)
0008AD 48AD 23               6      INC HL
0008AE 48AE 1B               6      DEC DE
0008AF 48AF C9              10      RET
                                
       48B0                     GET_PIXEL:
0008B0 48B0 04               4      INC B
0008B1 48B1 DD7D             9      LD  A,IXL
0008B3 48B3 FE08             7      CP  8
0008B5 48B5 28E7            12      JR  Z,GET_PIXEL256
0008B7 48B7 FE06             7      CP  6
0008B9 48B9 282E            12      JR  Z,GET_PIXEL4
                                
0008BB 48BB CB40             8      BIT 0,B
0008BD 48BD 20ED            12      JR  NZ,GET_PIXEL1
                                
0008BF 48BF 7A               4      LD  A,D
0008C0 48C0 B3               4      OR  E
0008C1 48C1 200A            12      JR  NZ,GET_PIXEL2
                                
0008C3 48C3 2A38F1          16      LD  HL,(_BUF_EN)
0008C6 48C6 CDF748          17      CALL    ROM_READ
0008C9 48C9 EB               4      EX  DE,HL
0008CA 48CA 2A30F1          16      LD  HL,(_DTA)
                                
       48CD                     GET_PIXEL2:
0008CD 48CD 7E               7      LD  A,(HL)
0008CE 48CE 0F               4      RRCA
0008CF 48CF 0F               4      RRCA
0008D0 48D0 0F               4      RRCA
0008D1 48D1 0F               4      RRCA
0008D2 48D2 C9              10      RET
                                
       48D3                     GET_PIXEL3:
0008D3 48D3 7A               4      LD  A,D
0008D4 48D4 B3               4      OR  E
0008D5 48D5 200A            12      JR  NZ,GET_PIXEL5
                                
0008D7 48D7 2A38F1          16      LD  HL,(_BUF_EN)
0008DA 48DA CDF748          17      CALL    ROM_READ
0008DD 48DD EB               4      EX  DE,HL
0008DE 48DE 2A30F1          16      LD  HL,(_DTA)
       48E1                     GET_PIXEL5:
0008E1 48E1 7E               7      LD  A,(HL)
0008E2 48E2 0F               4      RRCA
0008E3 48E3 0F               4      RRCA
0008E4 48E4 0F               4      RRCA
0008E5 48E5 0F               4      RRCA
0008E6 48E6 0F               4      RRCA
0008E7 48E7 0F               4      RRCA
0008E8 48E8 C9              10      RET
                                
       48E9                     GET_PIXEL4:
0008E9 48E9 78               4      LD  A,B
0008EA 48EA E603             7      AND 3   ;+0
0008EC 48EC 28E5            12      JR  Z,GET_PIXEL3
0008EE 48EE 3D               4      DEC A   ;+1
0008EF 48EF 28DC            12      JR  Z,GET_PIXEL2
0008F1 48F1 3D               4      DEC A   ;+2
0008F2 48F2 7E               7      LD  A,(HL)
0008F3 48F3 C0              11      RET NZ
0008F4 48F4 0F               4      RRCA        ;+3
0008F5 48F5 0F               4      RRCA
0008F6 48F6 C9              10      RET
                                
       48F7                     ROM_READ:
0008F7 48F7 E5              11      PUSH    HL
0008F8 48F8 D5              11      PUSH    DE
0008F9 48F9 C5              11      PUSH    BC
0008FA 48FA FDE5            15      PUSH    IY
0008FC 48FC 224CF1          16      LD  (LEFTX),HL
0008FF 48FF 2A30F1          16      LD  HL,(_DTA)
000902 4902 2243F1          16      LD  (DTAX),HL
000905 4905 2A4CF1          16      LD  HL,(LEFTX)
                                
000908 4908 CDAA4B          17      CALL    RBX1
00090B 490B 3870            12      JR  C,RBRERR1
00090D 490D 79               4      LD  A,C
00090E 490E EB               4      EX  DE,HL
00090F 490F ED52            15      SBC HL,DE       ;CP 0HL,CDE
000911 4911 19              11      ADD HL,DE
000912 4912 DE00             7      SBC A,000H
000914 4914 3801            12      JR  C,RBR1
000916 4916 EB               4      EX  DE,HL
       4917                     RBR1:
000917 4917 9F               4      SBC A,A
000918 4918 E601             7      AND 1
00091A 491A 321FF1          13      LD  (_RESULT),A
00091D 491D 7C               4      LD  A,H
00091E 491E B5               4      OR  L
00091F 491F CA7349          10      JP  Z,RBREND0
                                
000922 4922 222CF1          16      LD  (_LEFT),HL  ;Read record byte
000925 4925 224CF1          16      LD  (LEFTX),HL
                                
000928 4928 CDD64B          17      CALL    RBX2
00092B 492B 281A            12      JR  Z,RBRB
                                                ;先頭の端数
00092D 492D CDE94B          17      CALL    RBXA
000930 4930 DA8949          10      JP  C,RBRERR
000933 4933 C5              11      PUSH    BC
000934 4934 CD0844          17      CALL    ROM_LDIR
000937 4937 ED5343F1        20      LD  (DTAX),DE
00093B 493B 2A4CF1          16      LD  HL,(LEFTX)
00093E 493E D1              10      POP DE
00093F 493F A7               4      AND A
000940 4940 ED52            15      SBC HL,DE
000942 4942 224CF1          16      LD  (LEFTX),HL
000945 4945 2829            12      JR  Z,RBREND
                                
       4947                     RBRB:
000947 4947 CD254C          17      CALL    RBXB
00094A 494A 2818            12      JR  Z,RBRC
       494C                     RBRB1:
00094C 494C C5              11      PUSH    BC
00094D 494D D5              11      PUSH    DE
00094E 494E CDD04C          17      CALL    CLUST
000951 4951 EB               4      EX  DE,HL
000952 4952 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000956 4956 CD0844          17      CALL    ROM_LDIR
000959 4959 EB               4      EX  DE,HL
00095A 495A D1              10      POP DE
00095B 495B C1              10      POP BC
00095C 495C CDAD4C          17      CALL    GNCL
00095F 495F DA8949          10      JP  C,RBRERR
000962 4962 10E8            13      DJNZ    RBRB1
       4964                     RBRC:
000964 4964 CD3D4C          17      CALL    RBXC
000967 4967 2807            12      JR  Z,RBREND
                                
000969 4969 CDD04C          17      CALL    CLUST
00096C 496C EB               4      EX  DE,HL
00096D 496D CD0844          17      CALL    ROM_LDIR
       4970                     RBREND:
000970 4970 CD494C          17      CALL    RBXEND
       4973                     RBREND0:
000973 4973 FDE1            14      POP IY
000975 4975 C1              10      POP BC
000976 4976 D1              10      POP DE
000977 4977 F1              10      POP AF  ;(HL)
000978 4978 AF               4      XOR A
000979 4979 3A1FF1          13      LD  A,(_RESULT)
00097C 497C C9              10      RET
                                
       497D                     RBRERR1:
00097D 497D 3E01             7      LD  A,001H
       497F                     RBRERR2:
00097F 497F FDE1            14      POP IY
000981 4981 C1              10      POP BC
000982 4982 D1              10      POP DE
000983 4983 E1              10      POP HL
000984 4984 37               4      SCF
000985 4985 210000          10      LD  HL,0
000988 4988 C9              10      RET
       4989                     RBRERR:
000989 4989 3EFF             7      LD  A,0FFH
00098B 498B 18F2            12      JR  RBRERR2
                                
       498D                     FILE_DD:
00098D 498D E1              10      POP HL
00098E 498E 3E                      DB  03EH
00098F 498F C9              10      RET
000990 4990 320CF1          13      LD  (SWC_BLOAD_M),A
       4993                     ROM_ORG:
000993 4993 2A4EF1          16      LD  HL,(PARAM0)
000996 4996 7E               7      LD  A,(HL)
000997 4997 C9              10      RET
       4998                     FILE_B:
000998 4998 AF               4      XOR A
000999 4999 3254F1          13      LD  (FDRV),A
00099C 499C 1E00             7      LD  E,0
00099E 499E 3A63F6          13      LD  A,(VALTYP)
0009A1 49A1 FE03             7      CP  3       ;string
0009A3 49A3 C2284A          10      JP  NZ,FILED
                                
0009A6 49A6 DD21D067        14      LD  IX,FRESTR
0009AA 49AA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009AE 49AE CD1C00          17      CALL    _CALSLT
0009B1 49B1 E5              11      PUSH    HL
0009B2 49B2 DDE1            14      POP IX
                                
0009B4 49B4 DD5E00          19      LD  E,(IX+0)
0009B7 49B7 DD7E01          19      LD  A,(IX+1)
0009BA 49BA DD5602          19      LD  D,(IX+2)
0009BD 49BD DD62             9      LD  IXH,D
0009BF 49BF DD6F             9      LD  IXL,A
0009C1 49C1 7B               4      LD  A,E
       49C2                     FILE_BDOS:
0009C2 49C2 FE04             7      CP  4
0009C4 49C4 3808            12      JR  C,FILEB1
0009C6 49C6 DD7E03          19      LD  A,(IX+3)
0009C9 49C9 FE3A             7      CP  ':'
0009CB 49CB 28C0            12      JR  Z,FILE_DD
0009CD 49CD 7B               4      LD  A,E
       49CE                     FILEB1:
0009CE 49CE FE02             7      CP  2
0009D0 49D0 3818            12      JR  C,DEVI1
0009D2 49D2 DD7E01          19      LD  A,(IX+1)
0009D5 49D5 FE3A             7      CP  ':'
0009D7 49D7 2011            12      JR  NZ,DEVI1
0009D9 49D9 DD7E00          19      LD  A,(IX+0)        ;DRIVE
0009DC 49DC CD014B          17      CALL    CAP
0009DF 49DF D640             7      SUB '@'
0009E1 49E1 DD23            10      INC IX
0009E3 49E3 DD23            10      INC IX
0009E5 49E5 1D               4      DEC E
0009E6 49E6 1D               4      DEC E
0009E7 49E7 3254F1          13      LD  (FDRV),A
       49EA                     DEVI1:
0009EA 49EA DD7E00          19      LD  A,(IX+0)
0009ED 49ED D65C             7      SUB 05CH        ;\
0009EF 49EF 2008            12      JR  NZ,NOROOT
0009F1 49F1 6F               4      LD  L,A
0009F2 49F2 67               4      LD  H,A
0009F3 49F3 2252F1          16      LD  (_CDX),HL
0009F6 49F6 DD23            10      INC IX
0009F8 49F8 1D               4      DEC E
       49F9                     NOROOT:
                                
       49F9                     SETDIR:
0009F9 49F9 CD284A          17      CALL    FILED
0009FC 49FC DD7E00          19      LD  A,(IX+0)
0009FF 49FF FE5C             7      CP  05CH        ;\
000A01 4A01 C0              11      RET NZ
000A02 4A02 DD23            10      INC IX
000A04 4A04 1D               4      DEC E
000A05 4A05 3A55F1          13      LD  A,(FNAME)
000A08 4A08 FE20             7      CP  020H        ;. の処理
000A0A 4A0A 28ED            12      JR  Z,SETDIR
                                
000A0C 4A0C CD174B          17      CALL    ROM_OPEN
000A0F 4A0F B7               4      OR  A
000A10 4A10 C0              11      RET NZ
                                
000A11 4A11 FD2A49F1        20      LD  IY,(DIRENT1)
000A15 4A15 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000A19 4A19 C8              11      RET Z
000A1A 4A1A CD6F4A          17      CALL    FILEI
000A1D 4A1D FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A20 4A20 FD661B          19      LD  H,(IY+01BH)
000A23 4A23 2252F1          16      LD  (_CDX),HL
000A26 4A26 18D1            12      JR  SETDIR
                                
       4A28                     FILED:
000A28 4A28 CD6F4A          17      CALL    FILEI
000A2B 4A2B 2155F1          10      LD  HL,FNAME
                                
000A2E 4A2E 0608             7      LD  B,8
       4A30                     FILE2:
000A30 4A30 CD7C4A          17      CALL    CCHKF
000A33 4A33 C8              11      RET Z
000A34 4A34 FE2A             7      CP  '*'
000A36 4A36 282E            12      JR  Z,FILE9
000A38 4A38 FE2E             7      CP  '.'
000A3A 4A3A 280C            12      JR  Z,FILE4
000A3C 4A3C 77               7      LD  (HL),A
000A3D 4A3D 23               6      INC HL
000A3E 4A3E 10F0            13      DJNZ    FILE2
                                
       4A40                     FILE3:
000A40 4A40 CD7C4A          17      CALL    CCHKF
000A43 4A43 C8              11      RET Z
000A44 4A44 FE2E             7      CP  '.'
000A46 4A46 20F8            12      JR  NZ,FILE3
                                
       4A48                     FILE4:
000A48 4A48 215DF1          10      LD  HL,FNAME+8
000A4B 4A4B 0603             7      LD  B,3
                                
       4A4D                     FILE4L:
000A4D 4A4D CD7C4A          17      CALL    CCHKF
000A50 4A50 C8              11      RET Z
000A51 4A51 FE2E             7      CP  '.'
000A53 4A53 2008            12      JR  NZ,FILE12
000A55 4A55 3255F1          13      LD  (FNAME),A   ;Parent directory(..)
000A58 4A58 3256F1          13      LD  (FNAME+1),A
000A5B 4A5B 3E20             7      LD  A,020H
       4A5D                     FILE12:
000A5D 4A5D FE2A             7      CP  '*'
000A5F 4A5F 280A            12      JR  Z,FILE10
000A61 4A61 77               7      LD  (HL),A
000A62 4A62 23               6      INC HL
000A63 4A63 10E8            13      DJNZ    FILE4L
000A65 4A65 C9              10      RET
                                
       4A66                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A66 4A66 CD6B4A          17      CALL    FILE10
000A69 4A69 18D5            12      JR  FILE3
                                
       4A6B                     FILE10:
000A6B 4A6B 3E3F             7      LD  A,'?'
000A6D 4A6D 1808            12      JR  FILL_MEMORY
       4A6F                     FILEI:              ;名前＋拡張子をスペースで初期化
000A6F 4A6F 3E20             7      LD  A,020H
000A71 4A71 01000B          10      LD  BC,11*256   ;C=0にしておく
000A74 4A74 2155F1          10      LD  HL,FNAME
       4A77                     FILL_MEMORY:            ;HLからBバイトAで埋める
000A77 4A77 77               7      LD  (HL),A
000A78 4A78 23               6      INC HL
000A79 4A79 10FC            13      DJNZ    FILL_MEMORY
000A7B 4A7B C9              10      RET
                                
       4A7C                     CCHKF:
000A7C 4A7C 7B               4      LD  A,E
000A7D 4A7D B7               4      OR  A
000A7E 4A7E C8              11      RET Z
000A7F 4A7F DD7E00          19      LD  A,(IX+0)
000A82 4A82 CD894A          17      CALL    CCHK2
000A85 4A85 C8              11      RET Z
000A86 4A86 C3EC4A          10      JP  FKAN
                                
       4A89                     CCHK2:
000A89 4A89 0C               4      INC C
000A8A 4A8A 0D               4      DEC C
000A8B 4A8B C0              11      RET NZ
       4A8C                     CCHK3:              ;ZF=1 で使えない文字
000A8C 4A8C FE2B             7      CP  '+'
000A8E 4A8E C8              11      RET Z
000A8F 4A8F FE2C             7      CP  ','
000A91 4A91 C8              11      RET Z
000A92 4A92 FE2F             7      CP  '/'
000A94 4A94 C8              11      RET Z
000A95 4A95 FE3A             7      CP  ':'
000A97 4A97 C8              11      RET Z
000A98 4A98 FE3B             7      CP  ';'
000A9A 4A9A C8              11      RET Z
000A9B 4A9B FE3D             7      CP  '='
000A9D 4A9D C8              11      RET Z
000A9E 4A9E FE5C             7      CP  05CH    ;\
000AA0 4AA0 C8              11      RET Z
000AA1 4AA1 FE1F             7      CP  01FH
000AA3 4AA3 D0              11      RET NC
000AA4 4AA4 BF               4      CP  A       ;Z=1
000AA5 4AA5 C9              10      RET
                                
       4AA6                     SS1:
000AA6 4AA6 13               6      INC DE
       4AA7                     SPCUT:              ;スペースをカット
000AA7 4AA7 1A               7      LD  A,(DE)
000AA8 4AA8 FE20             7      CP  020H
000AAA 4AAA 28FA            12      JR  Z,SS1
000AAC 4AAC C9              10      RET
                                
       4AAD                     SCREOF1:
000AAD 4AAD 13               6      INC DE
       4AAE                     SPCUTEX:            ;スペース改行などをカット
000AAE 4AAE 1A               7      LD  A,(DE)
000AAF 4AAF FE20             7      CP  020H
000AB1 4AB1 28FA            12      JR  Z,SCREOF1
000AB3 4AB3 FE0D             7      CP  00DH
000AB5 4AB5 28F6            12      JR  Z,SCREOF1
000AB7 4AB7 FE0A             7      CP  00AH
000AB9 4AB9 28F2            12      JR  Z,SCREOF1
000ABB 4ABB FE1A             7      CP  01AH
000ABD 4ABD 28EE            12      JR  Z,SCREOF1
000ABF 4ABF C9              10      RET
                                
       4AC0                     GETNUM:
000AC0 4AC0 210000          10      LD  HL,0
       4AC3                     GETNUM1:
000AC3 4AC3 1A               7      LD  A,(DE)
000AC4 4AC4 13               6      INC DE
000AC5 4AC5 D630             7      SUB '0'
000AC7 4AC7 D8              11      RET C
000AC8 4AC8 FE0A             7      CP  10
000ACA 4ACA D0              11      RET NC
000ACB 4ACB 4D               4      LD  C,L
000ACC 4ACC 44               4      LD  B,H
000ACD 4ACD 29              11      ADD HL,HL   ;*2
000ACE 4ACE 29              11      ADD HL,HL   ;*4
000ACF 4ACF 09              11      ADD HL,BC   ;*5
000AD0 4AD0 29              11      ADD HL,HL   ;*10
000AD1 4AD1 4F               4      LD  C,A
000AD2 4AD2 0600             7      LD  B,0
000AD4 4AD4 09              11      ADD HL,BC
000AD5 4AD5 18EC            12      JR  GETNUM1
                                
       4AD7                     SEARCH_END:
000AD7 4AD7 7E               7      LD  A,(HL)
       4AD8                     SEARCH_END1:
000AD8 4AD8 23               6      INC HL
000AD9 4AD9 B7               4      OR  A
000ADA 4ADA C8              11      RET Z
000ADB 4ADB FE3A             7      CP  ':'
000ADD 4ADD 20F8            12      JR  NZ,SEARCH_END
000ADF 4ADF 7E               7      LD  A,(HL)
000AE0 4AE0 FE3A             7      CP  ':'
000AE2 4AE2 28F4            12      JR  Z,SEARCH_END1
000AE4 4AE4 C9              10      RET
                                
       4AE5                     FKANC:
000AE5 4AE5 CB41             8      BIT 0,C
000AE7 4AE7 CC0A4B          17      CALL    Z,CAP2
000AEA 4AEA 1803            12      JR  FKANX
       4AEC                     FKAN:           ;漢字チェック
000AEC 4AEC DD23            10      INC IX
000AEE 4AEE 1D               4      DEC E
       4AEF                     FKANX:
000AEF 4AEF CB41             8      BIT 0,C
000AF1 4AF1 CB81             8      RES 0,C
000AF3 4AF3 C0              11      RET NZ
000AF4 4AF4 FE80             7      CP  080H
000AF6 4AF6 D8              11      RET C
000AF7 4AF7 FEA0             7      CP  0A0H
000AF9 4AF9 3803            12      JR  C,FKAN1
000AFB 4AFB FEE0             7      CP  0E0H
000AFD 4AFD D8              11      RET C
       4AFE                     FKAN1:
000AFE 4AFE 0C               4      INC C
000AFF 4AFF A7               4      AND A
000B00 4B00 C9              10      RET
                                
       4B01                     CAP:
000B01 4B01 FE61             7      CP  'a'
000B03 4B03 D8              11      RET C
000B04 4B04 FE7B             7      CP  'z'+1
000B06 4B06 D0              11      RET NC
000B07 4B07 D620             7      SUB 020H
000B09 4B09 C9              10      RET
       4B0A                     CAP2:
000B0A 4B0A CD014B          17      CALL    CAP
       4B0D                     CAP3:               ;
000B0D 4B0D FE05             7      CP  5
000B0F 4B0F 2803            12      JR  Z,CAP4
000B11 4B11 FE21             7      CP  021H
000B13 4B13 C9              10      RET
       4B14                     CAP4:
000B14 4B14 3EE5             7      LD  A,0E5H
000B16 4B16 C9              10      RET
                                
       4B17                     ROM_OPEN:
000B17 4B17 CD3D50          17      CALL    GET_DISK_BANK_FDRV
                                
000B1A 4B1A CD844D          17      CALL    GET_DIR_DAT
000B1D 4B1D D5              11      PUSH    DE
000B1E 4B1E CD334B          17      CALL    FILESE
000B21 4B21 D1              10      POP DE
000B22 4B22 3F               4      CCF
000B23 4B23 D8              11      RET C
000B24 4B24 2249F1          16      LD  (DIRENT1),HL
000B27 4B27 E5              11      PUSH    HL
000B28 4B28 210000          10      LD  HL,0
000B2B 4B2B 2226F1          16      LD  (RR_LOW),HL
000B2E 4B2E 2228F1          16      LD  (RR_HIGH),HL
000B31 4B31 E1              10      POP HL
000B32 4B32 C9              10      RET
                                
       4B33                     FILESE:
000B33 4B33 7E               7      LD  A,(HL)
000B34 4B34 B7               4      OR  A
000B35 4B35 C8              11      RET Z       ;END:ZF=1 CF=0
000B36 4B36 FEE5             7      CP  0E5H
000B38 4B38 280D            12      JR  Z,FILESE1
000B3A 4B3A 1155F1          10      LD  DE,FNAME
000B3D 4B3D E5              11      PUSH    HL
000B3E 4B3E CD844B          17      CALL    CPFILE
000B41 4B41 CCA54B          17      CALL    Z,CPFILE2
000B44 4B44 E1              10      POP HL
000B45 4B45 37               4      SCF
000B46 4B46 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B47                     FILESE1:
000B47 4B47 CD4F4B          17      CALL    FNEXT
000B4A 4B4A 20E7            12      JR  NZ,FILESE
000B4C 4B4C F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B4E 4B4E C9              10      RET
                                
       4B4F                     FNEXT:
000B4F 4B4F 112000          10      LD  DE,020H
000B52 4B52 19              11      ADD HL,DE
000B53 4B53 ED5B52F1        20      LD  DE,(_CDX)
000B57 4B57 7A               4      LD  A,D
000B58 4B58 B3               4      OR  E
000B59 4B59 2019            12      JR  NZ,FNEXT_SUBDIR
000B5B 4B5B 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       4B5C                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B5C 4B5C F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B5D 4B5D CB7C             8      BIT 7,H
000B5F 4B5F 2811            12      JR  Z,CHECK_DIR_PAGE1
000B61 4B61 7C               4      LD  A,H
000B62 4B62 D620             7      SUB 020H
000B64 4B64 67               4      LD  H,A
000B65 4B65 3A4BF1          13      LD  A,(_DIR_BANK)
000B68 4B68 3C               4      INC A
000B69 4B69 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B6C 4B6C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B6F 4B6F 324BF1          13      LD  (_DIR_BANK),A
       4B72                     CHECK_DIR_PAGE1:
000B72 4B72 F1              10      POP AF
                                #endif
000B73 4B73 C9              10      RET
                                
       4B74                     FNEXT_SUBDIR:           ;サブディレクトリ
000B74 4B74 0D               4      DEC C
000B75 4B75 C0              11      RET NZ
                                
000B76 4B76 ED5B52F1        20      LD  DE,(_CDX)
000B7A 4B7A CDAD4C          17      CALL    GNCL
000B7D 4B7D EB               4      EX  DE,HL
000B7E 4B7E 2252F1          16      LD  (_CDX),HL
000B81 4B81 C3BF4D          10      JP  GET_SUBDIR
                                
       4B84                     CPFILE:
000B84 4B84 C5              11      PUSH    BC
000B85 4B85 01000B          10      LD  BC,00B00H
       4B88                     CPSTR1:
000B88 4B88 1A               7      LD  A,(DE)
000B89 4B89 FE3F             7      CP  '?'     ;Wild card
000B8B 4B8B 2812            12      JR  Z,CPSTR2
000B8D 4B8D 7E               7      LD  A,(HL)
000B8E 4B8E CDE54A          17      CALL    FKANC
000B91 4B91 E5              11      PUSH    HL
000B92 4B92 67               4      LD  H,A
000B93 4B93 1A               7      LD  A,(DE)
000B94 4B94 CB01             4      RLC C
000B96 4B96 CDE54A          17      CALL    FKANC
000B99 4B99 CB09             4      RRC C
000B9B 4B9B BC               4      CP  H       ;CP (HL),(DE)
000B9C 4B9C E1              10      POP HL
000B9D 4B9D 2004            12      JR  NZ,CPSTR3
       4B9F                     CPSTR2:
000B9F 4B9F 13               6      INC DE
000BA0 4BA0 23               6      INC HL
000BA1 4BA1 10E5            13      DJNZ    CPSTR1
       4BA3                     CPSTR3:
000BA3 4BA3 C1              10      POP BC
000BA4 4BA4 C9              10      RET
                                
       4BA5                     CPFILE2:
                                ;   LD  A,0E1H
000BA5 4BA5 3EF1             7      LD  A,0F1H
000BA7 4BA7 2F               4      CPL
000BA8 4BA8 A6               7      AND (HL)
000BA9 4BA9 C9              10      RET
                                
       4BAA                     RBX1:
000BAA 4BAA E5              11      PUSH    HL      ;Record byte
                                
000BAB 4BAB ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000BAF 4BAF 3A29F1          13      LD  A,(RR_HIGH+1)
000BB2 4BB2 4F               4      LD  C,A
                                
000BB3 4BB3 3A4BF1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000BB6 4BB6 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BB9 4BB9 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000BBC 4BBC FD2A49F1        20      LD  IY,(DIRENT1)
000BC0 4BC0 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BC3 4BC3 FD661D          19      LD  H,(IY+01DH)
000BC6 4BC6 FD7E1E          19      LD  A,(IY+01EH)
                                
000BC9 4BC9 A7               4      AND A
000BCA 4BCA ED52            15      SBC HL,DE
000BCC 4BCC 99               4      SBC A,C
000BCD 4BCD D1              10      POP DE
                                
000BCE 4BCE D8              11      RET C
000BCF 4BCF 4F               4      LD  C,A
000BD0 4BD0 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BD1 4BD1 B2               4      OR  D
000BD2 4BD2 B3               4      OR  E
000BD3 4BD3 C0              11      RET NZ
000BD4 4BD4 37               4      SCF
000BD5 4BD5 C9              10      RET
                                
       4BD6                     RBX2:
000BD6 4BD6 ED4B27F1        20      LD  BC,(RR_LOW+1)
000BDA 4BDA CD5E4C          17      CALL    RWXR
000BDD 4BDD 3A23F1          13      LD  A,(CLSZ_H)
000BE0 4BE0 3D               4      DEC A
000BE1 4BE1 E5              11      PUSH    HL
000BE2 4BE2 2A26F1          16      LD  HL,(RR_LOW)
000BE5 4BE5 A4               4      AND H
000BE6 4BE6 B5               4      OR  L
000BE7 4BE7 E1              10      POP HL
000BE8 4BE8 C9              10      RET
                                
       4BE9                     RBXA:
000BE9 4BE9 D5              11      PUSH    DE
000BEA 4BEA CDD04C          17      CALL    CLUST
000BED 4BED ED532EF1        20      LD  (_DTPS),DE
000BF1 4BF1 D1              10      POP DE
000BF2 4BF2 CDAD4C          17      CALL    GNCL
000BF5 4BF5 D8              11      RET C
000BF6 4BF6 ED532AF1        20      LD  (_CLPS),DE
                                
000BFA 4BFA ED4B26F1        20      LD  BC,(RR_LOW)
000BFE 4BFE 2A22F1          16      LD  HL,(CLSZ)
000C01 4C01 7C               4      LD  A,H
000C02 4C02 3D               4      DEC A
000C03 4C03 A0               4      AND B
000C04 4C04 47               4      LD  B,A
000C05 4C05 ED42            15      SBC HL,BC       ;remaining cluster
                                
000C07 4C07 ED5B4CF1        20      LD  DE,(LEFTX)
000C0B 4C0B ED52            15      SBC HL,DE       ;CP HL,DE
000C0D 4C0D 19              11      ADD HL,DE
000C0E 4C0E 3801            12      JR  C,RBXA1
000C10 4C10 EB               4      EX  DE,HL
       4C11                     RBXA1:
000C11 4C11 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C14 4C14 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C17 4C17 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C1A 4C1A E5              11      PUSH    HL
000C1B 4C1B 2A2EF1          16      LD  HL,(_DTPS)
000C1E 4C1E 09              11      ADD HL,BC
000C1F 4C1F ED5B43F1        20      LD  DE,(DTAX)
000C23 4C23 C1              10      POP BC
000C24 4C24 C9              10      RET
                                
       4C25                     RBXB:
000C25 4C25 2A43F1          16      LD  HL,(DTAX)
000C28 4C28 ED5B2AF1        20      LD  DE,(_CLPS)
000C2C 4C2C 3A4DF1          13      LD  A,(LEFTX+1)
000C2F 4C2F 47               4      LD  B,A
000C30 4C30 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C33                     RBXB1:
000C33 4C33 1F               4      RRA     ;->CF
000C34 4C34 3804            12      JR  C,RBXB2
000C36 4C36 CB38             8      SRL B   ;B=B/2
000C38 4C38 18F9            12      JR  RBXB1
       4C3A                     RBXB2:
000C3A 4C3A 78               4      LD  A,B
000C3B 4C3B B7               4      OR  A
000C3C 4C3C C9              10      RET
                                
       4C3D                     RBXC:
000C3D 4C3D ED4B4CF1        20      LD  BC,(LEFTX)
000C41 4C41 3A23F1          13      LD  A,(CLSZ_H)
000C44 4C44 3D               4      DEC A
000C45 4C45 A0               4      AND B
000C46 4C46 47               4      LD  B,A
000C47 4C47 B1               4      OR  C
000C48 4C48 C9              10      RET
                                
       4C49                     RBXEND:
000C49 4C49 ED5B2CF1        20      LD  DE,(_LEFT)
000C4D 4C4D 2A26F1          16      LD  HL,(RR_LOW)
000C50 4C50 3A29F1          13      LD  A,(RR_HIGH+1)
000C53 4C53 19              11      ADD HL,DE
000C54 4C54 CE00             7      ADC A,0
000C56 4C56 2226F1          16      LD  (RR_LOW),HL
000C59 4C59 3229F1          13      LD  (RR_HIGH+1),A
000C5C 4C5C EB               4      EX  DE,HL       ;HL=Read byte
000C5D 4C5D C9              10      RET 
                                
       4C5E                     RWXR:
000C5E 4C5E 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C61                     L_RWX:
000C61 4C61 1F               4      RRA     ;->CF
000C62 4C62 3806            12      JR  C,E_RWX
000C64 4C64 CB38             8      SRL B   ;BC=BC/2
000C66 4C66 CB19             8      RR  C   ;
000C68 4C68 18F7            12      JR  L_RWX
       4C6A                     E_RWX:
000C6A 4C6A 3A4BF1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C6D 4C6D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C70 4C70 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C73 4C73 FD2A49F1        20      LD  IY,(DIRENT1)
000C77 4C77 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C7A 4C7A FD561B          19      LD  D,(IY+01BH)
000C7D 4C7D CD3D50          17      CALL    GET_DISK_BANK_FDRV
       4C80                     RWX1:
000C80 4C80 ED532AF1        20      LD  (_CLPS),DE
000C84 4C84 7A               4      LD  A,D
000C85 4C85 B3               4      OR  E
000C86 4C86 37               4      SCF
000C87 4C87 C8              11      RET Z
                                
000C88 4C88 78               4      LD  A,B
000C89 4C89 B1               4      OR  C
000C8A 4C8A C8              11      RET Z
                                
000C8B 4C8B CDAD4C          17      CALL    GNCL
000C8E 4C8E D8              11      RET C
000C8F 4C8F 0B               6      DEC BC
000C90 4C90 CD1D4D          17      CALL    ENDCL
000C93 4C93 38EB            12      JR  C,RWX1
000C95 4C95 37               4      SCF
000C96 4C96 C9              10      RET
                                
       4C97                     NCL3:
000C97 4C97 CD3D50          17      CALL    GET_DISK_BANK_FDRV
000C9A 4C9A 6B               4      LD  L,E
000C9B 4C9B 62               4      LD  H,D
000C9C 4C9C CB3C             8      SRL H
000C9E 4C9E CB1D             8      RR  L
000CA0 4CA0 1F               4      RRA
000CA1 4CA1 19              11      ADD HL,DE
000CA2 4CA2 010060          10      LD  BC,BANK1_ADR
000CA5 4CA5 09              11      ADD HL,BC
000CA6 4CA6 ED4B24F1        20      LD  BC,(SECSZ)
000CAA 4CAA 09              11      ADD HL,BC
000CAB 4CAB 17               4      RLA
000CAC 4CAC C9              10      RET
                                
       4CAD                     GNCL:
000CAD 4CAD 7A               4      LD  A,D
000CAE 4CAE B3               4      OR  E
000CAF 4CAF 37               4      SCF
000CB0 4CB0 C8              11      RET Z
000CB1 4CB1 C5              11      PUSH    BC
000CB2 4CB2 E5              11      PUSH    HL
000CB3 4CB3 CD974C          17      CALL    NCL3
000CB6 4CB6 3809            12      JR  C,GNC1
000CB8 4CB8 5E               7      LD  E,(HL)
000CB9 4CB9 23               6      INC HL
000CBA 4CBA 7E               7      LD  A,(HL)
000CBB 4CBB E60F             7      AND 00FH
000CBD 4CBD 57               4      LD  D,A
000CBE 4CBE E1              10      POP HL
000CBF 4CBF C1              10      POP BC
000CC0 4CC0 C9              10      RET
       4CC1                     GNC1:
000CC1 4CC1 7E               7      LD  A,(HL)
000CC2 4CC2 23               6      INC HL
000CC3 4CC3 56               7      LD  D,(HL)
000CC4 4CC4 0604             7      LD  B,4
       4CC6                     GNC1L:
000CC6 4CC6 CB3A             8      SRL D
000CC8 4CC8 1F               4      RRA
000CC9 4CC9 10FB            13      DJNZ    GNC1L
                                
000CCB 4CCB 5F               4      LD  E,A
000CCC 4CCC E1              10      POP HL
000CCD 4CCD C1              10      POP BC
000CCE 4CCE A7               4      AND A
000CCF 4CCF C9              10      RET
                                
       4CD0                     CLUST:
000CD0 4CD0 EB               4      EX  DE,HL
       4CD1                     CLUST_HL:
000CD1 4CD1 C5              11      PUSH    BC
000CD2 4CD2 3A23F1          13      LD  A,(CLSZ_H)
000CD5 4CD5 CD6950          17      CALL    MUL_AHL
                                
000CD8 4CD8 CDA14D          17      CALL    GET_DIR_POS
000CDB 4CDB 4F               4      LD  C,A
000CDC 4CDC 0600             7      LD  B,0
000CDE 4CDE 09              11      ADD HL,BC
                                
000CDF 4CDF 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000CE2 4CE2 1F               4      RRA
000CE3 4CE3 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000CE6 4CE6 1F               4      RRA
000CE7 4CE7 0F               4      RRCA
000CE8 4CE8 0F               4      RRCA
000CE9 4CE9 0F               4      RRCA
000CEA 4CEA 4F               4      LD  C,A
                                
000CEB 4CEB 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000CEE 4CEE FE02             7      CP  2
000CF0 4CF0 280C            12      JR  Z,CLUST1
000CF2 4CF2 CB01             4      RLC C
000CF4 4CF4 0D               4      DEC C
000CF5 4CF5 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000CF8 4CF8 FE02             7      CP  2
000CFA 4CFA 2002            12      JR  NZ,CLUST1
000CFC 4CFC 0D               4      DEC C
000CFD 4CFD 0D               4      DEC C
       4CFE                     CLUST1:
000CFE 4CFE 0D               4      DEC C
000CFF 4CFF 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000D00 4D00 4D               4      LD  C,L     ;C=読み出し元
000D01 4D01 29              11      ADD HL,HL   ;64KB→32KB
000D02 4D02 29              11      ADD HL,HL   ;32KB→16KB
000D03 4D03 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D04 4D04 CD3D50          17      CALL    GET_DISK_BANK_FDRV
000D07 4D07 84               4      ADD A,H
000D08 4D08 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D0B 4D0B 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D0E 4D0E 3220F1          13      LD  (_BANK),A
000D11 4D11 69               4      LD  L,C     ;C=読み出し元
000D12 4D12 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D14 4D14 A5               4      AND L
                                #endif
       4D15                     CLUST2:
000D15 4D15 C660             7      ADD A,high BANK1_ADR
000D17 4D17 67               4      LD  H,A
000D18 4D18 2E00             7      LD  L,0
000D1A 4D1A EB               4      EX  DE,HL
000D1B 4D1B C1              10      POP BC
000D1C 4D1C C9              10      RET
                                
       4D1D                     ENDCL:
000D1D 4D1D 7A               4      LD  A,D ;END CLUSTER
000D1E 4D1E FE0F             7      CP  00FH    ;FAT12の最大値
000D20 4D20 C0              11      RET NZ
000D21 4D21 7B               4      LD  A,E
000D22 4D22 FEF7             7      CP  0F7H
000D24 4D24 C9              10      RET
                                
       4D25                     RB_READ:
000D25 4D25 AF               4      XOR A   ;HLA = HL*128
000D26 4D26 CB3C             8      SRL H
000D28 4D28 CB1D             8      RR  L
000D2A 4D2A 1F               4      RRA
000D2B 4D2B 3226F1          13      LD  (RR_LOW),A
000D2E 4D2E 2227F1          16      LD  (RR_MID),HL
000D31 4D31 218000          10      LD  HL,128
                                
000D34 4D34 CDF748          17      CALL    ROM_READ
000D37 4D37 C9              10      RET
                                
       4D38                     GETSEQ:
000D38 4D38 FD6E20          19      LD  L,(IY+32)
000D3B 4D3B FD660C          19      LD  H,(IY+12)
                                
000D3E 4D3E CB25             8      SLA L
                                
000D40 4D40 CB3C             8      SRL H
000D42 4D42 CB1D             8      RR  L
000D44 4D44 C9              10      RET
                                
       4D45                     SETSEQ:
000D45 4D45 F5              11      PUSH    AF
000D46 4D46 3A26F1          13      LD  A,(RR_LOW)
000D49 4D49 2A27F1          16      LD  HL,(RR_MID)
                                
000D4C 4D4C CD634D          17      CALL    SSQ1
                                
000D4F 4D4F 29              11      ADD HL,HL
000D50 4D50 CB3D             8      SRL L
000D52 4D52 FD7520          19      LD  (IY+32),L
000D55 4D55 FD740C          19      LD  (IY+12),H
000D58 4D58 F1              10      POP AF
000D59 4D59 C9              10      RET
                                
       4D5A                     GETSIZE:
000D5A 4D5A FD7E10          19      LD  A,(IY+16)
000D5D 4D5D FD6E11          19      LD  L,(IY+17)
000D60 4D60 FD6612          19      LD  H,(IY+18)
       4D63                     SSQ1:
000D63 4D63 87               4      ADD A,A
000D64 4D64 ED6A            15      ADC HL,HL
000D66 4D66 B7               4      OR  A
000D67 4D67 C8              11      RET Z
000D68 4D68 23               6      INC HL
000D69 4D69 C9              10      RET
                                
       4D6A                     SET_FCB:
000D6A 4D6A D5              11      PUSH    DE
000D6B 4D6B FDE1            14      POP IY
000D6D 4D6D FD7E1C          19      LD  A,(IY+28)
000D70 4D70 FEFF             7      CP  0FFH
000D72 4D72 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D74 4D74 E5              11      PUSH    HL
000D75 4D75 FD6E1A          19      LD  L,(IY+26)
000D78 4D78 FD661B          19      LD  H,(IY+27)
000D7B 4D7B 222AF1          16      LD  (_CLPS),HL
000D7E 4D7E E1              10      POP HL
000D7F 4D7F C9              10      RET
                                
       4D80                     POPAF_SCF_FF_RET:
000D80 4D80 F1              10      POP AF
000D81 4D81 37               4      SCF
000D82 4D82 9F               4      SBC A,A
000D83 4D83 C9              10      RET
                                
       4D84                     GET_DIR_DAT:
000D84 4D84 2A52F1          16      LD  HL,(_CDX)
000D87 4D87 7C               4      LD  A,H
000D88 4D88 B5               4      OR  L
000D89 4D89 2034            12      JR  NZ,GET_SUBDIR
000D8B 4D8B CDA14D          17      CALL    GET_DIR_POS
000D8E 4D8E C660             7      ADD A,high BANK1_ADR
000D90 4D90 2E00             7      LD  L,0
000D92 4D92 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000D93 4D93 CD5C4B          17      CALL    CHECK_DIR_PAGE
                                #endif
000D96 4D96 3A21F1          13      LD  A,(_BANK1)
000D99 4D99 324BF1          13      LD  (_DIR_BANK),A
                                
000D9C 4D9C 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D9F 4D9F 4F               4      LD  C,A
000DA0 4DA0 C9              10      RET
                                
       4DA1                     GET_DIR_POS:                ;ルートディレクトリ
000DA1 4DA1 CD3D50          17      CALL    GET_DISK_BANK_FDRV
000DA4 4DA4 3221F1          13      LD  (_BANK1),A
000DA7 4DA7 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000DAA 4DAA 47               4      LD  B,A
000DAB 4DAB 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000DAE 4DAE 4F               4      LD  C,A
000DAF 4DAF 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DB2                     GET_DIR_POS1:
000DB2 4DB2 81               4      ADD A,C
000DB3 4DB3 10FD            13      DJNZ    GET_DIR_POS1
                                
000DB5 4DB5 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4DB9                     L_MDP:
000DB9 4DB9 CB18             8      RR  B   ;->CF
000DBB 4DBB D8              11      RET C
000DBC 4DBC 87               4      ADD A,A
000DBD 4DBD 18FA            12      JR  L_MDP
                                
       4DBF                     GET_SUBDIR:             ;サブディレクトリ
000DBF 4DBF CDD14C          17      CALL    CLUST_HL
000DC2 4DC2 EB               4      EX  DE,HL
000DC3 4DC3 3A20F1          13      LD  A,(_BANK)
000DC6 4DC6 324BF1          13      LD  (_DIR_BANK),A
000DC9 4DC9 3A23F1          13      LD  A,(CLSZ_H)
000DCC 4DCC 87               4      ADD A,A     ;*2
000DCD 4DCD 87               4      ADD A,A     ;*4
000DCE 4DCE 87               4      ADD A,A     ;*8
000DCF 4DCF 4F               4      LD  C,A
000DD0 4DD0 C9              10      RET
                                
       4DD1                     STATEMENT:
000DD1 4DD1 115F4E          10      LD  DE,STR_CHDIR
000DD4 4DD4 CD454E          17      CALL    CPPROCNM
000DD7 4DD7 280A            12      JR  Z,_CHDIR
000DD9 4DD9 11654E          10      LD  DE,STR_RAMDISK
000DDC 4DDC CD454E          17      CALL    CPPROCNM
000DDF 4DDF 2814            12      JR  Z,_RAMDISK
000DE1 4DE1 37               4      SCF
000DE2 4DE2 C9              10      RET
       4DE3                     _CHDIR:
000DE3 4DE3 7E               7      LD  A,(HL)
000DE4 4DE4 FE28             7      CP  '('
000DE6 4DE6 37               4      SCF
000DE7 4DE7 C0              11      RET NZ
000DE8 4DE8 CDA246          17      CALL    INIT_PARAM
000DEB 4DEB CD9849          17      CALL    FILE_B
000DEE 4DEE CD0D4E          17      CALL    ROM_CD
000DF1 4DF1 DA6545          10      JP  C,ERROR_FILE_NOT_FOUND
000DF4 4DF4 C9              10      RET
                                
       4DF5                     _RAMDISK:
000DF5 4DF5 7E               7      LD  A,(HL)
000DF6 4DF6 FE28             7      CP  '('
000DF8 4DF8 37               4      SCF
000DF9 4DF9 C0              11      RET NZ
000DFA 4DFA 23               6      INC HL
000DFB 4DFB DD212F54        14      LD  IX,FRMQNT
000DFF 4DFF FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E03 4E03 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E06 4E06 7A               4      LD  A,D
000E07 4E07 B3               4      OR  E
000E08 4E08 C25F45          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E0B 4E0B 23               6      INC HL
000E0C 4E0C C9              10      RET
                                
       4E0D                     ROM_CD:
000E0D 4E0D 3A55F1          13      LD  A,(FNAME)
000E10 4E10 FE20             7      CP  020H
000E12 4E12 2822            12      JR  Z,CD1
000E14 4E14 CD174B          17      CALL    ROM_OPEN
000E17 4E17 D8              11      RET C
000E18 4E18 FD2A49F1        20      LD  IY,(DIRENT1)
000E1C 4E1C FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E20 4E20 CA6545          10      JP  Z,ERROR_FILE_NOT_FOUND
000E23 4E23 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E26 4E26 FD661B          19      LD  H,(IY+01BH)
       4E29                     CD2:
000E29 4E29 2247F1          16      LD  (_CD),HL
000E2C 4E2C 2A50F1          16      LD  HL,(PARAM1)
       4E2F                     CD_SKIP:
000E2F 4E2F 7E               7      LD  A,(HL)
000E30 4E30 23               6      INC HL
000E31 4E31 FE21             7      CP  021H
000E33 4E33 38FA            12      JR  C,CD_SKIP
000E35 4E35 C9              10      RET
       4E36                     CD1:
000E36 4E36 2A52F1          16      LD  HL,(_CDX)
000E39 4E39 18EE            12      JR  CD2
                                
       4E3B                     DEVICE1:
000E3B 4E3B 116D4E          10      LD  DE,STR_A
000E3E 4E3E CD454E          17      CALL    CPPROCNM
000E41 4E41 37               4      SCF
000E42 4E42 C0              11      RET NZ
000E43 4E43 AF               4      XOR A
000E44 4E44 C9              10      RET
                                
       4E45                     CPPROCNM:
000E45 4E45 E5              11      PUSH    HL
000E46 4E46 2189FD          10      LD  HL,PROCNM
       4E49                     CPPROCNM1:
000E49 4E49 1A               7      LD  A,(DE)
000E4A 4E4A 13               6      INC DE
000E4B 4E4B BE               7      CP  (HL)
000E4C 4E4C 23               6      INC HL
000E4D 4E4D 2003            12      JR  NZ,CPPROCNM2
000E4F 4E4F B7               4      OR  A
000E50 4E50 20F7            12      JR  NZ,CPPROCNM1
       4E52                     CPPROCNM2:
000E52 4E52 E1              10      POP HL
000E53 4E53 C9              10      RET
                                
       4E54                     WILDCARD:
000E54 4E54 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4E5F                     STR_CHDIR:
000E5F 4E5F 434844495200            DB  "CHDIR",0
       4E65                     STR_RAMDISK:
000E65 4E65 52414D4449534B00        DB  "RAMDISK",0
       4E6D                     STR_A:
000E6D 4E6D 4100                    DB  "A",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4E6F                     ERROR_WRITE_PROTECTED:
000E6F 4E6F 3E00             7      LD  A,0     ;Write protected
000E71 4E71 C9              10      RET
       4E72                     DISKIO:
000E72 4E72 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000E74 4E74 48               4      LD  C,B
000E75 4E75 CD4750          17      CALL    GET_DISK_BANK
       4E78                     SETMAP1:        
000E78 4E78 E5              11      PUSH    HL
       4E79                     DISKIO1:
000E79 4E79 C5              11      PUSH    BC      ;B=残りのセクタ数
000E7A 4E7A D5              11      PUSH    DE      ;DE=セクタ番号
000E7B 4E7B F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000E7C 4E7C EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000E7D 4E7D F5              11      PUSH    AF
000E7E 4E7E 3A25F1          13      LD  A,(SECSZ_H)
000E81 4E81 CD6950          17      CALL    MUL_AHL
000E84 4E84 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000E85 4E85 4D               4      LD  C,L     ;C=読み出し元
000E86 4E86 29              11      ADD HL,HL       ;64KB→32KB
000E87 4E87 29              11      ADD HL,HL       ;32KB→16KB
000E88 4E88 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000E89 4E89 84               4      ADD A,H
000E8A 4E8A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000E8D 4E8D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000E90 4E90 3220F1          13      LD  (_BANK),A
000E93 4E93 79               4      LD  A,C     ;C=読み出し元
000E94 4E94 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4E96                     DISKIO2:
000E96 4E96 C660             7      ADD A,high BANK1_ADR
000E98 4E98 67               4      LD  H,A
000E99 4E99 ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000E9D 4E9D 69               4      LD  L,C     ;C=0
000E9E 4E9E CD0844          17      CALL    ROM_LDIR
000EA1 4EA1 EB               4      EX  DE,HL
000EA2 4EA2 F1              10      POP AF
000EA3 4EA3 D1              10      POP DE
000EA4 4EA4 13               6      INC DE
000EA5 4EA5 C1              10      POP BC
000EA6 4EA6 10D1            13      DJNZ    DISKIO1
000EA8 4EA8 41               4      LD  B,C
                                
000EA9 4EA9 E1              10      POP HL
000EAA 4EAA AF               4      XOR A
                                
000EAB 4EAB FB               4      EI
000EAC 4EAC C9              10      RET
                                
       4EAD                     DSKCHG:
000EAD 4EAD CDE64E          17      CALL    IS_BPB
000EB0 4EB0 3824            12      JR  C,NOTREADY
000EB2 4EB2 3A23FB          13      LD  A,(DRVTBL+2)
000EB5 4EB5 B7               4      OR  A
000EB6 4EB6 201A            12      JR  NZ,DSKCHG1
000EB8 4EB8 3A21FB          13      LD  A,(DRVTBL)
000EBB 4EBB FE02             7      CP  2
000EBD 4EBD 2013            12      JR  NZ,DSKCHG1
000EBF 4EBF CDE64E          17      CALL    IS_BPB
000EC2 4EC2 300E            12      JR  NC,DSKCHG1
000EC4 4EC4 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000EC6 4EC6 3221FB          13      LD  (DRVTBL),A
000EC9 4EC9 3223FB          13      LD  (DRVTBL+2),A
000ECC 4ECC 3A48F3          13      LD  A,(MASTERS)
000ECF 4ECF 3224FB          13      LD  (DRVTBL+3),A
       4ED2                     DSKCHG1:
000ED2 4ED2 AF               4      XOR A
000ED3 4ED3 0601             7      LD  B,1
000ED5 4ED5 C9              10      RET
       4ED6                     NOTREADY:
000ED6 4ED6 3E02             7      LD  A,2
000ED8 4ED8 37               4      SCF
000ED9 4ED9 C9              10      RET
                                
       4EDA                     NO_BPB:
000EDA 4EDA E1              10      POP HL
000EDB 4EDB 23               6      INC HL
000EDC 4EDC 116F50          10      LD  DE,DPB2DD
000EDF 4EDF 011200          10      LD  BC,DPB2DD_E-DPB2DD
000EE2 4EE2 EDB0                    LDIR
000EE4 4EE4 AF               4      XOR A
000EE5 4EE5 C9              10      RET
                                
       4EE6                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000EE6 4EE6 CD4750          17      CALL    GET_DISK_BANK
                                
000EE9 4EE9 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000EEC 4EEC FE01             7      CP  1
000EEE 4EEE D8              11      RET C
                                
000EEF 4EEF 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000EF2 4EF2 C6FF             7      ADD A,0FFH
000EF4 4EF4 D8              11      RET C
                                
000EF5 4EF5 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       4EF8                     IS_BPB1:
000EF8 4EF8 FE01             7      CP  1
000EFA 4EFA C8              11      RET Z
000EFB 4EFB FE02             7      CP  2
000EFD 4EFD C8              11      RET Z
000EFE 4EFE FE04             7      CP  4
000F00 4F00 C8              11      RET Z
000F01 4F01 37               4      SCF
000F02 4F02 C9              10      RET
                                
       4F03                     GETDPB:
000F03 4F03 E5              11      PUSH    HL
000F04 4F04 CD4750          17      CALL    GET_DISK_BANK
                                
000F07 4F07 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000F0A 4F0A B7               4      OR  A
000F0B 4F0B 28CD            12      JR  Z,NO_BPB
000F0D 4F0D DDE1            14      POP IX
000F0F 4F0F DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F12 4F12 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F15 4F15 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F18 4F18 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F1B 4F1B DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F1E 4F1E 87               4      ADD A,A
000F1F 4F1F 87               4      ADD A,A
000F20 4F20 87               4      ADD A,A
000F21 4F21 3D               4      DEC A
000F22 4F22 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F25 4F25 06FF             7      LD  B,-1
000F27 4F27 A7               4      AND A           ;無限ループ阻止
       4F28                     GETDPB1:
000F28 4F28 04               4      INC B
000F29 4F29 1F               4      RRA
000F2A 4F2A 38FC            12      JR  C,GETDPB1
000F2C 4F2C DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F2F 4F2F 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F32 4F32 3D               4      DEC A
000F33 4F33 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F36 4F36 A7               4      AND A           ;無限ループ阻止
000F37 4F37 06FF             7      LD  B,-1
       4F39                     GETDPB2:
000F39 4F39 04               4      INC B
000F3A 4F3A 1F               4      RRA
000F3B 4F3B 38FC            12      JR  C,GETDPB2
000F3D 4F3D 04               4      INC B
000F3E 4F3E DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000F41 4F41 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000F44 4F44 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000F47 4F47 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000F4A 4F4A 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000F4D 4F4D DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000F50 4F50 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000F53 4F53 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000F56 4F56 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000F5A 4F5A DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000F5D 4F5D DD460A          19      LD  B,(IX+10)       ;FATCNT
000F60 4F60 210000          10      LD  HL,0
       4F63                     GETDPB3:
000F63 4F63 19              11      ADD HL,DE
000F64 4F64 10FD            13      DJNZ    GETDPB3
       4F66                     GETDPB4:
000F66 4F66 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000F69 4F69 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000F6C 4F6C 19              11      ADD HL,DE
000F6D 4F6D DD7511          19      LD  (IX+17),L       ;FIRDIR
000F70 4F70 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000F73 4F73 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F76 4F76 87               4      ADD A,A
000F77 4F77 87               4      ADD A,A
000F78 4F78 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F7B                     GETDPB5:
000F7B 4F7B CB3B             8      SRL E
000F7D 4F7D 1F               4      RRA
000F7E 4F7E 30FB            12      JR  NC,GETDPB5
000F80 4F80 1600             7      LD  D,0
000F82 4F82 19              11      ADD HL,DE
000F83 4F83 DD750C          19      LD  (IX+12),L       ;FIRREC
000F86 4F86 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000F89 4F89 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000F8C 4F8C DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000F8F 4F8F DD560D          19      LD  D,(IX+13)       ;FIRREC
000F92 4F92 A7               4      AND A
000F93 4F93 ED52            15      SBC HL,DE
                                
000F95 4F95 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000F98 4F98 3C               4      INC A
000F99 4F99 37               4      SCF             ;無限ループ阻止
       4F9A                     GETDPB6:
000F9A 4F9A 1F               4      RRA
000F9B 4F9B 3806            12      JR  C,GETDPB7
000F9D 4F9D CB3C             8      SRL H
000F9F 4F9F CB1D             8      RR  L
000FA1 4FA1 18F7            12      JR  GETDPB6
       4FA3                     GETDPB7:
000FA3 4FA3 23               6      INC HL
000FA4 4FA4 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000FA7 4FA7 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4FAA                     GETDPBD1:
000FAA 4FAA DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FAD 4FAD E6FC             7      AND 0FCH
000FAF 4FAF C8              11      RET Z
                                
000FB0 4FB0 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000FB4 4FB4 37               4      SCF
000FB5 4FB5 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000FB9 4FB9 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000FBC 4FBC DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000FC0 4FC0 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000FC4 4FC4 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000FC8 4FC8 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000FCC 4FCC DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000FD0 4FD0 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000FD4 4FD4 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000FD8 4FD8 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000FDB 4FDB DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000FDE 4FDE DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FE1 4FE1 87               4      ADD A,A
000FE2 4FE2 87               4      ADD A,A
000FE3 4FE3 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4FE6                     GETDPBD5:
000FE6 4FE6 CB3B             8      SRL E
000FE8 4FE8 1F               4      RRA
000FE9 4FE9 30FB            12      JR  NC,GETDPBD5
000FEB 4FEB 1600             7      LD  D,0
000FED 4FED 19              11      ADD HL,DE
000FEE 4FEE DD750C          19      LD  (IX+12),L       ;FIRREC
000FF1 4FF1 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FF4 4FF4 18B4            12      JR  GETDPBD1
                                
       4FF6                     CHOICE:
000FF6 4FF6 210000          10      LD  HL,0
000FF9 4FF9 C9              10      RET
                                
       4FFA                     DSKFMT:
000FFA 4FFA AF               4      XOR A
000FFB 4FFB 37               4      SCF
       4FFC                     DSKSTP:
000FFC 4FFC C9              10      RET
                                
       4FFD                     BASENT:
000FFD 4FFD 3A40F3          13      LD  A,(REBOOT)
001000 5000 B7               4      OR  A
001001 5001 202B            12      JR  NZ,REBOOT1
001003 5003 218150          10      LD  HL,AUTOEXEC
001006 5006 1154F1          10      LD  DE,FDRV
001009 5009 010C00          10      LD  BC,1+8+3
00100C 500C EDB0                    LDIR
00100E 500E CD174B          17      CALL    ROM_OPEN
001011 5011 381B            12      JR  C,REBOOT1
001013 5013 CD1A45          17      CALL    ROM_LOAD1
001016 5016 218D50          10      LD  HL,CMD_RUN
001019 5019 111FF4          10      LD  DE,KBUF
00101C 501C D5              11      PUSH    DE
00101D 501D 010300          10      LD  BC,3
001020 5020 EDB0                    LDIR
001022 5022 E1              10      POP HL
001023 5023 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001027 5027 DD210146        14      LD  IX,NEWSTT
00102B 502B CD1C00          17      CALL    _CALSLT
       502E                     REBOOT1:
00102E 502E FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001032 5032 DD219B40        14      LD  IX,READYR
001036 5036 C31C00          10      JP  _CALSLT
                                
       5039                     GETSLT:
001039 5039 3A22FB          13      LD  A,(DRVTBL+1)
00103C 503C C9              10      RET
                                
       503D                     GET_DISK_BANK_FDRV:
00103D 503D 3A54F1          13      LD  A,(FDRV)
001040 5040 D601             7      SUB 1
001042 5042 3003            12      JR  NC,GET_DISK_BANK
001044 5044 3A46F1          13      LD  A,(_DVSW)
       5047                     GET_DISK_BANK:
001047 5047 B7               4      OR  A       ;A=DRIVE
001048 5048 3E01             7      LD  A,DISK_BANK
00104A 504A 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
00104C 504C 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       504F                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
00104F 504F 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001052 5052 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001055 5055 F5              11      PUSH    AF
001056 5056 E5              11      PUSH    HL
001057 5057 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
00105A 505A 2224F1          16      LD  (SECSZ),HL
00105D 505D 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001060 5060 CD6950          17      CALL    MUL_AHL
001063 5063 2222F1          16      LD  (CLSZ),HL
001066 5066 E1              10      POP HL
001067 5067 F1              10      POP AF
001068 5068 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5069                     MUL_AHL:
001069 5069 37               4      SCF     ;無限ループ回避
       506A                     MUL_AHL1:
00106A 506A 1F               4      RRA     ;->CF
00106B 506B D8              11      RET C
00106C 506C 29              11      ADD HL,HL
00106D 506D 18FB            12      JR  MUL_AHL1
                                
       506F                     DPB2DD:
00106F 506F F9                      DB  0F9H    ;MEDIA
001070 5070 0002                    DW  00200H  ;SECSIZ
001072 5072 0F                      DB  00FH    ;DIRMSK
001073 5073 04                      DB  004H    ;DIRSHFT
001074 5074 01                      DB  001H    ;CLUSMSK
001075 5075 02                      DB  002H    ;CLUSSHFT
001076 5076 0100                    DW  00001H  ;FIRFAT
001078 5078 02                      DB  002H    ;FATCNT
001079 5079 70                      DB  070H    ;MAXENT
00107A 507A 0E00                    DW  0000EH  ;FIRREC
00107C 507C CA02                    DW  002CAH  ;MAXCLUS
00107E 507E 03                      DB  003H    ;FATSIZ
00107F 507F 0700                    DW  0007H   ;FIRDIR
       5081                     DPB2DD_E:
                                
       5081                     AUTOEXEC:
001081 5081 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       508D                     CMD_RUN:
00108D 508D 3A8A00                  DB  03AH,08AH,0
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       5090                     POP_HL_ERROR:
001090 5090 E1              10      POP     HL
       5091                     _ERROR:
001091 5091 0600             7      LD  B,0
001093 5093 A7               4      AND A
001094 5094 C9              10      RET
                                
       5095                     ROM_BDOS:
001095 5095 E5              11      PUSH    HL
001096 5096 79               4      LD  A,C
001097 5097 87               4      ADD A,A
001098 5098 38F7            12      JR  C,_ERROR
00109A 509A 6F               4      LD  L,A
00109B 509B 265F             7      LD  H,high STABLE
00109D 509D 7E               7      LD  A,(HL)
00109E 509E 2C               4      INC L
00109F 509F 66               7      LD  H,(HL)
0010A0 50A0 6F               4      LD  L,A
0010A1 50A1 E3              19      EX  (SP),HL
0010A2 50A2 79               4      LD  A,C
0010A3 50A3 C9              10      RET
                                
       50A4                     _PRINT:
       50A4                     PRINT:
0010A4 50A4 7B               4      LD  A,E
0010A5 50A5 1803            12      JR  MSG_A
                                
       50A7                     _SYS01:     ;(BDOS)コンソール入力
0010A7 50A7 CD1E51          17      CALL    _SYS07
       50AA                     MSG_A:
0010AA 50AA FE03             7      CP  3
0010AC 50AC 2814            12      JR  Z,MSG_BR
       50AE                     MSGA1:
0010AE 50AE F5              11      PUSH    AF
0010AF 50AF C5              11      PUSH    BC
0010B0 50B0 D5              11      PUSH    DE
0010B1 50B1 E5              11      PUSH    HL
0010B2 50B2 DDE5            15      PUSH    IX
0010B4 50B4 DD21A200        14      LD  IX,CHPUT
0010B8 50B8 CDFB42          17      CALL    CALSLT_R
0010BB 50BB DDE1            14      POP IX
0010BD 50BD E1              10      POP HL
0010BE 50BE D1              10      POP DE
0010BF 50BF C1              10      POP BC
       50C0                     MSGA2:
0010C0 50C0 F1              10      POP AF
0010C1 50C1 C9              10      RET
       50C2                     MSG_BR:
0010C2 50C2 F5              11      PUSH    AF
0010C3 50C3 3ADDF3          13      LD  A,(CSRX)
0010C6 50C6 FE02             7      CP  2
0010C8 50C8 38F6            12      JR  C,MSGA2
0010CA 50CA F1              10      POP AF
       50CB                     MSG_CR:
0010CB 50CB F5              11      PUSH    AF
0010CC 50CC 3E0D             7      LD  A,00DH
0010CE 50CE CDAE50          17      CALL    MSGA1
0010D1 50D1 3E0A             7      LD  A,00AH
0010D3 50D3 CDAE50          17      CALL    MSGA1
0010D6 50D6 F1              10      POP AF
0010D7 50D7 C9              10      RET
                                
       50D8                     _SYS02:     ;(BDOS)コンソール出力
0010D8 50D8 CDF350          17      CALL    BREAK
0010DB 50DB 1805            12      JR  PRINTX
                                
       50DD                     _SYS06:     ;(BDOS)コンソール直接入出力
0010DD 50DD 7B               4      LD  A,E
0010DE 50DE 3C               4      INC A
0010DF 50DF CA3251          10      JP  Z,_INKEY
       50E2                     PRINTX:
0010E2 50E2 C3A450          10      JP  _PRINT
                                
       50E5                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0010E5 50E5 CD1E51          17      CALL    _SYS07
0010E8 50E8 FE03             7      CP  3
0010EA 50EA CCF350          17      CALL    Z,_BREAK
0010ED 50ED FE13             7      CP  013H        ;CTRL+S
0010EF 50EF C0              11      RET NZ
       50F0                     PAUSE:
0010F0 50F0 CD0A51          17      CALL    KEYBC
                                
       50F3                     _BREAK:
       50F3                     BREAK:
0010F3 50F3 F5              11      PUSH    AF
0010F4 50F4 C5              11      PUSH    BC
0010F5 50F5 D5              11      PUSH    DE
0010F6 50F6 E5              11      PUSH    HL
0010F7 50F7 DDE5            15      PUSH    IX
0010F9 50F9 DD21B700        14      LD  IX,BREAKX
0010FD 50FD CDFB42          17      CALL    CALSLT_R
001100 5100 DDE1            14      POP IX
001102 5102 E1              10      POP HL
001103 5103 D1              10      POP DE
001104 5104 C1              10      POP BC
001105 5105 DCF350          17      CALL    C,_BREAK
001108 5108 F1              10      POP AF
001109 5109 C9              10      RET
       510A                     KEYBC:
00110A 510A F5              11      PUSH    AF
00110B 510B C5              11      PUSH    BC
00110C 510C D5              11      PUSH    DE
00110D 510D E5              11      PUSH    HL
00110E 510E DDE5            15      PUSH    IX
001110 5110 DD215601        14      LD  IX,KILBUF
001114 5114 CDFB42          17      CALL    CALSLT_R
001117 5117 DDE1            14      POP IX
001119 5119 E1              10      POP HL
00111A 511A D1              10      POP DE
00111B 511B C1              10      POP BC
00111C 511C F1              10      POP AF
00111D 511D C9              10      RET
                                
       511E                     _SYS07:
       511E                     FLGET:
00111E 511E C5              11      PUSH    BC
00111F 511F D5              11      PUSH    DE
001120 5120 E5              11      PUSH    HL
001121 5121 DDE5            15      PUSH    IX
001123 5123 DD219F00        14      LD  IX,CHGET
001127 5127 CDFB42          17      CALL    CALSLT_R
00112A 512A DDE1            14      POP IX
00112C 512C E1              10      POP HL
00112D 512D D1              10      POP DE
00112E 512E C1              10      POP BC
00112F 512F FE03             7      CP  3
001131 5131 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5132                     _INKEY:
       5132                     INKEY:
001132 5132 CDCC51          17      CALL    CPM_CONST
001135 5135 C8              11      RET Z
001136 5136 18E6            12      JR  FLGET
                                
       5138                     _SYS0A:     ;(BDOS)文字列入力
001138 5138 C5              11      PUSH    BC
001139 5139 E5              11      PUSH    HL
00113A 513A D5              11      PUSH    DE
00113B 513B CD6451          17      CALL    GETL
00113E 513E 111FF4          10      LD  DE,KBUF
001141 5141 E1              10      POP HL
001142 5142 E5              11      PUSH    HL
001143 5143 0E00             7      LD  C,0
001145 5145 3004            12      JR  NC,SAX0
001147 5147 23               6      INC HL
001148 5148 23               6      INC HL
001149 5149 1808            12      JR  SAX4
       514B                     SAX0:
00114B 514B 46               7      LD  B,(HL)
00114C 514C 23               6      INC HL
       514D                     SAX1:
00114D 514D 23               6      INC HL
00114E 514E 1A               7      LD  A,(DE)
00114F 514F 13               6      INC DE
001150 5150 B7               4      OR  A
001151 5151 2004            12      JR  NZ,SAX2
       5153                     SAX4:
001153 5153 360D            10      LD  (HL),00DH
001155 5155 1804            12      JR  SAX3
       5157                     SAX2:
001157 5157 77               7      LD  (HL),A
001158 5158 0C               4      INC C
001159 5159 10F2            13      DJNZ    SAX1
       515B                     SAX3:
00115B 515B D1              10      POP DE
00115C 515C 79               4      LD  A,C
00115D 515D 13               6      INC DE
00115E 515E 12               7      LD  (DE),A
00115F 515F 1B               6      DEC DE
001160 5160 E1              10      POP HL
001161 5161 C1              10      POP BC
001162 5162 A7               4      AND A
001163 5163 C9              10      RET
       5164                     GETL:
001164 5164 DDE5            15      PUSH    IX
001166 5166 FDE5            15      PUSH    IY
                                
001168 5168 2ADCF3          16      LD  HL,(CSRY)
00116B 516B 22CAFB          16      LD  (FSTPOS),HL
       516E                     GETL1:
00116E 516E CDE550          17      CALL    _SYS08
001171 5171 FE09             7      CP  9
001173 5173 2008            12      JR  NZ,GETL1V
001175 5175 211FF4          10      LD  HL,KBUF
001178 5178 CD8543          17      CALL    MSX
00117B 517B 18F1            12      JR  GETL1
       517D                     GETL1V:
00117D 517D 5F               4      LD  E,A
00117E 517E FE08             7      CP  8
001180 5180 CC1A52          17      CALL    Z,CTRL02
001183 5183 FE20             7      CP  020H
001185 5185 D44652          17      CALL    NC,INSERT
001188 5188 CDAE50          17      CALL    MSGA1
                                
00118B 518B 7B               4      LD  A,E
00118C 518C FE0D             7      CP  00DH
00118E 518E 20DE            12      JR  NZ,GETL1
                                
001190 5190 111FF4          10      LD  DE,KBUF
001193 5193 3AB0F3          13      LD  A,(LINLEN)
001196 5196 47               4      LD  B,A
001197 5197 CD2854          17      CALL    ZERO_MEMORY_DE
                                
00119A 519A 2ACAFB          16      LD  HL,(FSTPOS)
00119D 519D 3ADCF3          13      LD  A,(CSRY)
0011A0 51A0 6F               4      LD  L,A
0011A1 51A1 E5              11      PUSH    HL
0011A2 51A2 CD7752          17      CALL    LOC0
0011A5 51A5 4D               4      LD  C,L
0011A6 51A6 44               4      LD  B,H
0011A7 51A7 E1              10      POP HL
0011A8 51A8 3AB0F3          13      LD  A,(LINLEN)
0011AB 51AB 94               4      SUB H
0011AC 51AC 3D               4      DEC A
0011AD 51AD 5F               4      LD  E,A
0011AE 51AE 211FF4          10      LD  HL,KBUF
       51B1                     GETL2:
0011B1 51B1 CD0A52          17      CALL    _SCRN
0011B4 51B4 03               6      INC BC
0011B5 51B5 77               7      LD  (HL),A
0011B6 51B6 23               6      INC HL
0011B7 51B7 1D               4      DEC E
0011B8 51B8 20F7            12      JR  NZ,GETL2
0011BA 51BA CDCB50          17      CALL    MSG_CR
                                
0011BD 51BD FDE1            14      POP IY
0011BF 51BF DDE1            14      POP IX
       51C1                     GETL3:
0011C1 51C1 2B               6      DEC HL
0011C2 51C2 7E               7      LD  A,(HL)
0011C3 51C3 FE21             7      CP  021H
0011C5 51C5 D0              11      RET NC
0011C6 51C6 3600            10      LD  (HL),0
0011C8 51C8 15               4      DEC D
0011C9 51C9 20F6            12      JR  NZ,GETL3
0011CB 51CB C9              10      RET
                                
       51CC                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       51CC                     CONSTX:
       51CC                     CPM_CONST:
0011CC 51CC C5              11      PUSH    BC
0011CD 51CD D5              11      PUSH    DE
0011CE 51CE E5              11      PUSH    HL
0011CF 51CF DDE5            15      PUSH    IX
0011D1 51D1 DD219C00        14      LD  IX,CHSNS
0011D5 51D5 CDFB42          17      CALL    CALSLT_R
0011D8 51D8 DDE1            14      POP IX
0011DA 51DA E1              10      POP HL
0011DB 51DB D1              10      POP DE
0011DC 51DC C1              10      POP BC
0011DD 51DD C9              10      RET
                                
       51DE                     _SYS2A:     ;(BDOS)日付の獲得
0011DE 51DE AF               4      XOR A
0011DF 51DF 57               4      LD  D,A
0011E0 51E0 5F               4      LD  E,A
0011E1 51E1 67               4      LD  H,A
0011E2 51E2 6F               4      LD  L,A
0011E3 51E3 C9              10      RET
                                
       51E4                     _SYS2C:     ;(BDOS)時刻の獲得
0011E4 51E4 AF               4      XOR A
0011E5 51E5 57               4      LD  D,A
0011E6 51E6 5F               4      LD  E,A
0011E7 51E7 67               4      LD  H,A
0011E8 51E8 6F               4      LD  L,A
0011E9 51E9 C9              10      RET
                                
       51EA                     POS:
0011EA 51EA F5              11      PUSH    AF
0011EB 51EB 2ADCF3          16      LD  HL,(CSRY)
0011EE 51EE 7D               4      LD  A,L
0011EF 51EF 6C               4      LD  L,H
0011F0 51F0 67               4      LD  H,A
0011F1 51F1 2C               4      INC L
0011F2 51F2 24               4      INC H
0011F3 51F3 F1              10      POP AF
0011F4 51F4 C9              10      RET
                                
       51F5                     LOC:
0011F5 51F5 F5              11      PUSH    AF
0011F6 51F6 E5              11      PUSH    HL
0011F7 51F7 7D               4      LD  A,L
0011F8 51F8 6C               4      LD  L,H
0011F9 51F9 67               4      LD  H,A
0011FA 51FA 2D               4      DEC L
0011FB 51FB 25               4      DEC H
0011FC 51FC DDE5            15      PUSH    IX
0011FE 51FE DD21C600        14      LD  IX,POSIT
001202 5202 CDFB42          17      CALL    CALSLT_R
001205 5205 DDE1            14      POP IX
001207 5207 E1              10      POP HL
001208 5208 F1              10      POP AF
001209 5209 C9              10      RET
                                
       520A                     _SCRN:
       520A                     SCRN:
00120A 520A E5              11      PUSH    HL
00120B 520B DDE5            15      PUSH    IX
                                
00120D 520D 69               4      LD  L,C
00120E 520E 60               4      LD  H,B
00120F 520F DD214A00        14      LD  IX,RDVRM
001213 5213 CDFB42          17      CALL    CALSLT_R
                                
001216 5216 DDE1            14      POP IX
001218 5218 E1              10      POP HL
001219 5219 C9              10      RET
                                
       521A                     CTRL02:
00121A 521A F5              11      PUSH    AF
00121B 521B D5              11      PUSH    DE
00121C 521C 2ADCF3          16      LD  HL,(CSRY)
00121F 521F 3AB0F3          13      LD  A,(LINLEN)
001222 5222 4F               4      LD  C,A
001223 5223 94               4      SUB H   ;CSRX
001224 5224 C602             7      ADD A,2
001226 5226 47               4      LD  B,A ;カーソルより右の文字数
001227 5227 61               4      LD  H,C ;LINLEN
001228 5228 C5              11      PUSH    BC
001229 5229 CD7752          17      CALL    LOC0
00122C 522C C1              10      POP BC
                                
00122D 522D 1620             7      LD  D,020H
       522F                     C8X1:
00122F 522F DD214A00        14      LD  IX,RDVRM
001233 5233 CDFB42          17      CALL    CALSLT_R
001236 5236 4F               4      LD  C,A
001237 5237 7A               4      LD  A,D
001238 5238 DD214D00        14      LD  IX,WRTVRM
00123C 523C CDFB42          17      CALL    CALSLT_R
00123F 523F 2B               6      DEC HL
001240 5240 51               4      LD  D,C
001241 5241 10EC            13      DJNZ    C8X1
001243 5243 D1              10      POP DE
001244 5244 F1              10      POP AF
001245 5245 C9              10      RET
                                
       5246                     INSERT:
001246 5246 F5              11      PUSH    AF
001247 5247 D5              11      PUSH    DE
001248 5248 2ADCF3          16      LD  HL,(CSRY)
00124B 524B 3AB0F3          13      LD  A,(LINLEN)
00124E 524E 4F               4      LD  C,A
00124F 524F 94               4      SUB H   ;CSRX
001250 5250 3C               4      INC A
001251 5251 47               4      LD  B,A ;カーソルより右の文字数
001252 5252 C5              11      PUSH    BC
001253 5253 CD7752          17      CALL    LOC0
001256 5256 C1              10      POP BC
                                
001257 5257 1620             7      LD  D,020H
       5259                     INS1:
001259 5259 DD214A00        14      LD  IX,RDVRM
00125D 525D CDFB42          17      CALL    CALSLT_R
001260 5260 4F               4      LD  C,A
001261 5261 7A               4      LD  A,D
001262 5262 DD214D00        14      LD  IX,WRTVRM
001266 5266 CDFB42          17      CALL    CALSLT_R
001269 5269 23               6      INC HL
00126A 526A 51               4      LD  D,C
00126B 526B 10EC            13      DJNZ    INS1
00126D 526D D1              10      POP DE
00126E 526E F1              10      POP AF
00126F 526F C9              10      RET
                                
       5270                     CONOUT1:
001270 5270 59               4      LD  E,C
001271 5271 C3A450          10      JP  _PRINT
                                
       5274                     GETVRAM:
001274 5274 2ADCF3          16      LD  HL,(CSRY)
       5277                     LOC0:
001277 5277 2D               4      DEC L
001278 5278 25               4      DEC H
001279 5279 4C               4      LD  C,H ;CSRX-1
00127A 527A 5D               4      LD  E,L ;CSRY-1
       527B                     LOC1:
00127B 527B 3AB0F3          13      LD  A,(LINLEN)
00127E 527E 67               4      LD  H,A
00127F 527F 1600             7      LD  D,0
001281 5281 6A               4      LD  L,D ;0
001282 5282 0608             7      LD  B,8
       5284                     LOC2:
001284 5284 29              11      ADD HL,HL
001285 5285 3001            12      JR  NC,LOC3
001287 5287 19              11      ADD HL,DE
       5288                     LOC3:
001288 5288 10FA            13      DJNZ    LOC2
00128A 528A 09              11      ADD HL,BC
00128B 528B C9              10      RET
                                
       528C                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00128C 528C 212200          10      LD  HL,00022H
00128F 528F AF               4      XOR A
001290 5290 7D               4      LD  A,L
001291 5291 C9              10      RET
                                
       5292                     _SYS0D:     ;(BDOS)ディスク・リセット
001292 5292 218000          10      LD  HL,00080H
001295 5295 2230F1          16      LD  (_DTA),HL
001298 5298 C9              10      RET
                                
       5299                     _SYS0E:     ;(BDOS)カレントドライブの設定
001299 5299 7B               4      LD  A,E
00129A 529A FE02             7      CP  2
00129C 529C D0              11      RET NC
00129D 529D 3246F1          13      LD  (_DVSW),A
0012A0 52A0 C9              10      RET
                                
       52A1                     _SYS0F:     ;(BDOS)ファイルのオープン
0012A1 52A1 D5              11      PUSH    DE
0012A2 52A2 FDE1            14      POP IY
0012A4 52A4 CD0F54          17      CALL    INIT_FILE
0012A7 52A7 CD174B          17      CALL    ROM_OPEN
0012AA 52AA 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0012AC 52AC FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0012B0 52B0 FDE5            15      PUSH    IY
0012B2 52B2 D1              10      POP DE
0012B3 52B3 13               6      INC DE
0012B4 52B4 010B00          10      LD  BC,11
0012B7 52B7 EDB0                    LDIR
                                ;               Attribute
0012B9 52B9 7E               7      LD  A,(HL)
0012BA 52BA FD770D          19      LD  (IY+13),A
                                ;               TIME
0012BD 52BD 110B00          10      LD  DE,11
0012C0 52C0 19              11      ADD HL,DE
0012C1 52C1 7E               7      LD  A,(HL)
0012C2 52C2 23               6      INC HL
0012C3 52C3 FD7716          19      LD  (IY+22),A
0012C6 52C6 7E               7      LD  A,(HL)
0012C7 52C7 23               6      INC HL
0012C8 52C8 FD7717          19      LD  (IY+23),A
                                ;               DATE
0012CB 52CB 7E               7      LD  A,(HL)
0012CC 52CC 23               6      INC HL
0012CD 52CD FD7714          19      LD  (IY+20),A
0012D0 52D0 7E               7      LD  A,(HL)
0012D1 52D1 23               6      INC HL
0012D2 52D2 FD7715          19      LD  (IY+21),A
                                ;               First cluster
0012D5 52D5 7E               7      LD  A,(HL)
0012D6 52D6 23               6      INC HL
0012D7 52D7 FD771A          19      LD  (IY+26),A
0012DA 52DA 7E               7      LD  A,(HL)
0012DB 52DB 23               6      INC HL
0012DC 52DC FD771B          19      LD  (IY+27),A
                                ;               SIZE
0012DF 52DF 7E               7      LD  A,(HL)
0012E0 52E0 23               6      INC HL
0012E1 52E1 FD7710          19      LD  (IY+16),A
0012E4 52E4 7E               7      LD  A,(HL)
0012E5 52E5 23               6      INC HL
0012E6 52E6 FD7711          19      LD  (IY+17),A
0012E9 52E9 7E               7      LD  A,(HL)
0012EA 52EA 23               6      INC HL
0012EB 52EB FD7712          19      LD  (IY+18),A
0012EE 52EE 7E               7      LD  A,(HL)
0012EF 52EF FD7713          19      LD  (IY+19),A
0012F2 52F2 AF               4      XOR A
0012F3 52F3 FD770C          19      LD  (IY+12),A
0012F6 52F6 C9              10      RET
                                
       52F7                     _SYS10:     ;(BDOS)ファイルのクローズ
0012F7 52F7 AF               4      XOR A
0012F8 52F8 C9              10      RET
                                
       52F9                     S11X1:
0012F9 52F9 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012FC 52FC FD750E          19      LD  (IY+14),L
0012FF 52FF FD740F          19      LD  (IY+15),H
       5302                     SCF_FF_RET:
001302 5302 37               4      SCF
001303 5303 9F               4      SBC A,A
001304 5304 C9              10      RET
                                
       5305                     _SYS11:     ;(BDOS)最初のファイルの検索
001305 5305 ED5333F1        20      LD  (_FCB),DE
001309 5309 D5              11      PUSH    DE
00130A 530A FDE1            14      POP IY
00130C 530C CD0F54          17      CALL    INIT_FILE
00130F 530F CD844D          17      CALL    GET_DIR_DAT
       5312                     S12X1:
001312 5312 CD334B          17      CALL    FILESE
001315 5315 30E2            12      JR  NC,S11X1
001317 5317 0D               4      DEC C
001318 5318 FD7119          19      LD  (IY+25),C       ;RootEntCnt
00131B 531B FDCB0D66        20      BIT 4,(IY+13)
00131F 531F 2809            12      JR  Z,S12X2
001321 5321 E5              11      PUSH    HL
001322 5322 DDE1            14      POP IX
001324 5324 DDCB0E66        20      BIT 4,(IX+1+13)
001328 5328 28E8            12      JR  Z,S12X1
       532A                     S12X2:
00132A 532A 012000          10      LD  BC,32
00132D 532D ED5B30F1        20      LD  DE,(_DTA)
001331 5331 AF               4      XOR A
001332 5332 12               7      LD  (DE),A      ;ドライブ番号
001333 5333 13               6      INC DE
001334 5334 EDB0                    LDIR            ;ディレクトリエントリ
001336 5336 FD750E          19      LD  (IY+14),L
001339 5339 FD740F          19      LD  (IY+15),H
00133C 533C C9              10      RET
                                
       533D                     _SYS12:
00133D 533D FD2A33F1        20      LD  IY,(_FCB)
001341 5341 FDE5            15      PUSH    IY
001343 5343 D1              10      POP DE
001344 5344 CD0F54          17      CALL    INIT_FILE
                                
001347 5347 FD6E0E          19      LD  L,(IY+14)
00134A 534A FD660F          19      LD  H,(IY+15)
00134D 534D FD4E19          19      LD  C,(IY+25)
001350 5350 18C0            12      JR  S12X1
                                
       5352                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001352 5352 CD6A4D          17      CALL    SET_FCB
001355 5355 CD384D          17      CALL    GETSEQ
001358 5358 CD254D          17      CALL    RB_READ
00135B 535B E5              11      PUSH    HL
00135C 535C CD454D          17      CALL    SETSEQ
00135F 535F E1              10      POP HL
       5360                     SREAD:
001360 5360 C601             7      ADD A,001H
001362 5362 D8              11      RET C
                                
001363 5363 7D               4      LD  A,L
001364 5364 D601             7      SUB 001H
001366 5366 9F               4      SBC A,A
001367 5367 E603             7      AND 3
001369 5369 1F               4      RRA
00136A 536A C9              10      RET
                                
       536B                     _SYS18:     ;(BDOS)ログインベクトルの獲得
00136B 536B 210100          10      LD  HL,00001H
00136E 536E AF               4      XOR A
00136F 536F C9              10      RET
                                
       5370                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001370 5370 3A46F1          13      LD  A,(_DVSW)
001373 5373 C9              10      RET
                                
       5374                     _SYS1A:     ;(BDOS)DTAの設定
001374 5374 ED5330F1        20      LD  (_DTA),DE
001378 5378 AF               4      XOR A
001379 5379 C9              10      RET
                                
       537A                     _SYS1B:     ;(BDOS)ディスク情報の獲得
00137A 537A 010002          10      LD  BC,512
00137D 537D 11C302          10      LD  DE,707
001380 5380 210000          10      LD  HL,0
001383 5383 DD2135F1        14      LD  IX,_BUF
001387 5387 FD2135F1        14      LD  IY,_BUF
00138B 538B FD3600F9        19      LD  (IY+0),0F9H
00138F 538F 3E02             7      LD  A,2
001391 5391 C9              10      RET
                                
       5392                     _SYS21:     ;(BDOS)ランダムな読み出し
001392 5392 CD6A4D          17      CALL    SET_FCB
                                
001395 5395 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001398 5398 FD6622          19      LD  H,(IY+34)
                                
00139B 539B CD254D          17      CALL    RB_READ
00139E 539E 18C0            12      JR  SREAD
                                
       53A0                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
0013A0 53A0 CDA152          17      CALL    _SYS0F
0013A3 53A3 D8              11      RET C
                                
0013A4 53A4 D5              11      PUSH    DE      ;EX DE,IY
0013A5 53A5 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013A7 53A7 CD5A4D          17      CALL    GETSIZE
       53AA                     _S24X1:
0013AA 53AA FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013AD 53AD FD7422          19      LD  (IY+34),H
0013B0 53B0 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0013B4 53B4 FDE3            23      EX  (SP),IY     ;
0013B6 53B6 D1              10      POP DE      ;
                                
0013B7 53B7 AF               4      XOR A
0013B8 53B8 C9              10      RET
                                
       53B9                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0013B9 53B9 E5              11      PUSH    HL
0013BA 53BA D5              11      PUSH    DE      ;EX DE,IY
0013BB 53BB FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013BD 53BD CD384D          17      CALL    GETSEQ
0013C0 53C0 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       53C2                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0013C2 53C2 CD6A4D          17      CALL    SET_FCB
0013C5 53C5 E5              11      PUSH    HL
0013C6 53C6 FD6E21          19      LD  L,(IY+33)
0013C9 53C9 FD6622          19      LD  H,(IY+34)
0013CC 53CC 2226F1          16      LD  (RR_LOW),HL
0013CF 53CF FD6E23          19      LD  L,(IY+35)
0013D2 53D2 FD6624          19      LD  H,(IY+36)
0013D5 53D5 2228F1          16      LD  (RR_HIGH),HL
0013D8 53D8 E1              10      POP HL
0013D9 53D9 CDF748          17      CALL    ROM_READ
0013DC 53DC ED5B26F1        20      LD  DE,(RR_LOW)
0013E0 53E0 FD7321          19      LD  (IY+33),E
0013E3 53E3 FD7222          19      LD  (IY+34),D
0013E6 53E6 ED5B28F1        20      LD  DE,(RR_HIGH)
0013EA 53EA FD7323          19      LD  (IY+35),E
0013ED 53ED FD7224          19      LD  (IY+36),D
0013F0 53F0 9F               4      SBC A,A
0013F1 53F1 C9              10      RET
                                
       53F2                     _SYS2F:
0013F2 53F2 44               4      LD  B,H
0013F3 53F3 2A30F1          16      LD  HL,(_DTA)
0013F6 53F6 C3724E          10      JP  DISKIO
                                
       53F9                     _SYS5A:
0013F9 53F9 0600             7      LD  B,0
0013FB 53FB D5              11      PUSH    DE
0013FC 53FC DDE1            14      POP IX
       53FE                     _SX5A1:
0013FE 53FE 1A               7      LD  A,(DE)
0013FF 53FF B7               4      OR  A
001400 5400 2804            12      JR  Z,_SX5A2
001402 5402 13               6      INC DE
001403 5403 04               4      INC B
001404 5404 18F8            12      JR  _SX5A1
                                
       5406                     _SX5A2:
001406 5406 78               4      LD  A,B
001407 5407 CDC249          17      CALL    FILE_BDOS
00140A 540A CD0D4E          17      CALL    ROM_CD
00140D 540D 9F               4      SBC A,A
00140E 540E C9              10      RET
                                
       540F                     INIT_FILE:
00140F 540F EB               4      EX  DE,HL
001410 5410 1154F1          10      LD  DE,FDRV
001413 5413 010C00          10      LD  BC,1+8+3
001416 5416 EDB0                    LDIR
001418 5418 CD3D50          17      CALL    GET_DISK_BANK_FDRV
00141B 541B 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00141E 541E 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
001421 5421 2A47F1          16      LD  HL,(_CD)
001424 5424 2252F1          16      LD  (_CDX),HL           ;カレントディレクトリ
001427 5427 C9              10      RET
                                
       5428                     ZERO_MEMORY_DE:
001428 5428 AF               4      XOR A
       5429                     FILL_MEMORY_DE:
001429 5429 12               7      LD  (DE),A
00142A 542A 13               6      INC DE
00142B 542B 10FC            13      DJNZ    FILL_MEMORY_DE
00142D 542D C9              10      RET
                                
00142E 542E                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 9150A750D8509150        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 91509150DD501E51        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 E55091503851CC51        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 8C5292529952A152        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 F75205533D539150        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 5253915091509150        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 6B53705374537A53        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 915091509150A053        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 B95391509150C253        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 91509150DE519150        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 E45191509150F253        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 91509150F9539150        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 9150915091509150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
