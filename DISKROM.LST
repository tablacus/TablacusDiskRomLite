                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       0138                     RSLREG  EQU 00138H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F676                     TXTTAB  EQU 0F676H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
                                ;SAVENT EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                
       F300                     ISC EQU 0F300H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       6200                     _FATBF  EQU BANK1_ADR+512       ;FATの先頭
       6E00                     _DIRBF  EQU BANK1_ADR+(1+3*2)*512   ;ディレクトリの先頭
                                
       F349                     DTAX    EQU 0F349H
       F34B                     FCBX    EQU DTAX+2
       F34D                     LEFTX   EQU FCBX+2
       F34F                     FDRV    EQU LEFTX+2
       F350                     FNAME   EQU FDRV+1
                                
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C30449          10      JP  DISKIO
000013 4013 C33349          10      JP  DSKCHG
000016 4016 C38949          10      JP  GETDPB
000019 4019 C3714A          10      JP  CHOICE
00001C 401C C3754A          10      JP  DSKFMT
00001F 401F C3774A          10      JP  DSKSTP
                                ;   JP  BASENT
                                ;   SCF
                                ;   JP  DSKFMT
                                ;   JP  DSKSTP
                                ;   NOP
                                ;   JP  GETSLT
                                ;   LD  HL,(0F34BH)
                                ;   RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.0.1.0",0
            204449534B20524F    
            4D204C6974652076    
            302E302E312E3000    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 2100F3          10      LD  HL,ISC
000103 4103 224AFC          16      LD  (HIMEM),HL
                                
000106 4106 3EFF             7      LD  A,0FFH
000108 4108 3299FD          13      LD  (DEVICE),A
                                
00010B 410B 3E01             7      LD  A,1
00010D 410D 3221FB          13      LD  (DRVTBL),A
                                
000110 4110 214642          10      LD  HL,AT_ISC
000113 4113 1100F3          10      LD  DE,ISC
000116 4116 013F00          10      LD  BC,ISC_E-ISC
000119 4119 EDB0                    LDIR
                                
00011B 411B 3EC3             7      LD  A,0C3H      ;JP
00011D 411D 3243FF          13      LD  (H_GONE),A
000120 4120 327DF3          13      LD  (BDOS),A
000123 4123 2100F3          10      LD  HL,ISC
000126 4126 2244FF          16      LD  (H_GONE+1),HL
000129 4129 2131F3          10      LD  HL,H_BDOS
00012C 412C 227EF3          16      LD  (BDOS+1),HL
                                
00012F 412F 3E                      DB  03EH
000130 4130 F7              12      RST 30H
000131 4131 3271FE          13      LD  (H_BINS),A
000134 4134 3276FE          13      LD  (H_BINL),A
000137 4137 327BFE          13      LD  (H_FILE),A
                                ;   LD  (H_BDOS),A
00013A 413A 32DAFE          13      LD  (H_STKE),A
00013D 413D 32A7FF          13      LD  (H_PHYD),A
                                
000140 4140 CDF541          17      CALL    GTSL1_
000143 4143 3213F3          13      LD  (ROM_SLT),A
000146 4146 3272FE          13      LD  (H_BINS+1),A
000149 4149 3277FE          13      LD  (H_BINL+1),A
00014C 414C 327CFE          13      LD  (H_FILE+1),A
00014F 414F 3232F3          13      LD  (H_BDOS+1),A
000152 4152 32DBFE          13      LD  (H_STKE+1),A
000155 4155 32A8FF          13      LD  (H_PHYD+1),A
000158 4158 3222FB          13      LD  (DRVTBL+1),A
00015B 415B 3248F3          13      LD  (MASTERS),A
                                
00015E 415E 212544          10      LD  HL,ROM_LOAD
000161 4161 2273FE          16      LD  (H_BINS+2),HL
000164 4164 21E244          10      LD  HL,ROM_RUN
000167 4167 2278FE          16      LD  (H_BINL+2),HL
00016A 416A 21EF44          10      LD  HL,ROM_FILES
00016D 416D 227DFE          16      LD  (H_FILE+2),HL
                                ;   LD  HL,ROM_BDOS
                                ;   LD  (H_BDOS+2),HL
000170 4170 21C042          10      LD  HL,ROM_STKE
000173 4173 22DCFE          16      LD  (H_STKE+2),HL
000176 4176 210449          10      LD  HL,DISKIO
000179 4179 22A9FF          16      LD  (H_PHYD+2),HL
                                
00017C 417C 3E                      DB  03EH
00017D 417D C9              10      RET
00017E 417E 327FFE          13      LD  (H_FILE+4),A
000181 4181 3275FE          13      LD  (H_BINS+4),A
000184 4184 327AFE          13      LD  (H_BINL+4),A
                                ;   LD  (H_BDOS+4),A
000187 4187 32DEFE          13      LD  (H_STKE+4),A
00018A 418A 32ABFF          13      LD  (H_PHYD+4),A
                                
00018D 418D AF               4      XOR A
00018E 418E 320068          13      LD  (BANK1_SEL),A
000191 4191 3A0060          13      LD  A,(BANK1_ADR)
000194 4194 FE41             7      CP  'A'
000196 4196 204C            12      JR  NZ,NOT_8K_BANK
000198 4198 3E01             7      LD  A,DISK_BANK
00019A 419A 320068          13      LD  (BANK1_SEL),A
                                
00019D 419D CD3801          17      CALL    RSLREG      ;read primary slot #
0001A0 41A0 07               4      RLCA
0001A1 41A1 07               4      RLCA
0001A2 41A2 F5              11      PUSH    AF
0001A3 41A3 CDFA41          17      CALL    GTSL2_
0001A6 41A6 3244F3          13      LD  (RAMAD3),A
0001A9 41A9 F1              10      POP AF  
0001AA 41AA CDFA41          17      CALL    GTSL2_
0001AD 41AD 3243F3          13      LD  (RAMAD2),A
0001B0 41B0 3242F3          13      LD  (RAMAD1),A
0001B3 41B3 3241F3          13      LD  (RAMAD0),A
                                
0001B6 41B6 3A43F3          13      LD  A,(RAMAD2)
0001B9 41B9 210080          10      LD  HL,08000H
0001BC 41BC CD1142          17      CALL    CHK_RAM
0001BF 41BF 2804            12      JR  Z,RAMCHK2
0001C1 41C1 AF               4      XOR A
0001C2 41C2 3243F3          13      LD  (RAMAD2),A
       41C5                     RAMCHK2:
0001C5 41C5 3A42F3          13      LD  A,(RAMAD1)
0001C8 41C8 210040          10      LD  HL,04000H
0001CB 41CB CD1142          17      CALL    CHK_RAM
0001CE 41CE 2804            12      JR  Z,RAMCHK1
0001D0 41D0 AF               4      XOR A
0001D1 41D1 3242F3          13      LD  (RAMAD1),A
       41D4                     RAMCHK1:
0001D4 41D4 3A41F3          13      LD  A,(RAMAD0)
0001D7 41D7 210000          10      LD  HL,00000H
0001DA 41DA CD1142          17      CALL    CHK_RAM
0001DD 41DD 2804            12      JR  Z,RAMCHK0
0001DF 41DF AF               4      XOR A
0001E0 41E0 3241F3          13      LD  (RAMAD0),A
       41E3                     RAMCHK0:
0001E3 41E3 C9              10      RET
                                
       41E4                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
0001E4 41E4 21EF42          10      LD  HL,MSG_ERROR_ROM_MODE
0001E7 41E7 CD8842          17      CALL    MSX
0001EA 41EA FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0001EE 41EE DD219F00        14      LD  IX,CHGET
0001F2 41F2 C31C00          10      JP  _CALSLT
                                
       41F5                     GTSL1_:             ;自分のいるスロットを知る
0001F5 41F5 CD3801          17      CALL    RSLREG      ;read primary slot #
0001F8 41F8 0F               4      RRCA
0001F9 41F9 0F               4      RRCA
       41FA                     GTSL2_:
0001FA 41FA E603             7      AND 3       ;[A]=000000PP
0001FC 41FC 5F               4      LD  E,A     ;[E]=000000PP
0001FD 41FD 21C1FC          10      LD  HL,EXPTBL
000200 4200 85               4      ADD A,L     ;桁上りは無い
000201 4201 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000202 4202 7B               4      LD  A,E     ;[A]=000000PP
000203 4203 CB7E            13      BIT 7,(HL)
000205 4205 C8              11      RET Z
000206 4206 7D               4      LD  A,L     ;point to SLTTBL entry
000207 4207 C604             7      ADD A,4     ;桁上りは無い
000209 4209 6F               4      LD  L,A
00020A 420A 7E               7      LD  A,(HL)      ;get currently expansion slot register
00020B 420B E60C             7      AND 00CH        ;[A] = 0000SS00
00020D 420D B3               4      OR  E       ;[A] = 0000SSPP
00020E 420E F680             7      OR  080H        ;[A] = 1000SSPP
000210 4210 C9              10      RET
       4211                     GTSL1_E:
                                
       4211                     CHK_RAM:
000211 4211 4F               4      LD  C,A
000212 4212 DD210C00        14      LD  IX,_RDSLT
000216 4216 CD3A42          17      CALL    CALSLT_R
000219 4219 2F               4      CPL
00021A 421A 47               4      LD  B,A
00021B 421B 5F               4      LD  E,A
00021C 421C 79               4      LD  A,C
00021D 421D DD211400        14      LD  IX,_WRSLT
000221 4221 CD3A42          17      CALL    CALSLT_R
000224 4224 79               4      LD  A,C
000225 4225 DD210C00        14      LD  IX,_RDSLT
000229 4229 CD3A42          17      CALL    CALSLT_R
00022C 422C B8               4      CP  B
00022D 422D C0              11      RET NZ
00022E 422E 2F               4      CPL
00022F 422F 79               4      LD  A,C
000230 4230 5F               4      LD  E,A
000231 4231 DD211400        14      LD  IX,_WRSLT
000235 4235 CD3A42          17      CALL    CALSLT_R
000238 4238 AF               4      XOR A
000239 4239 C9              10      RET
       423A                     CALSLT_R:
00023A 423A C5              11      PUSH    BC
00023B 423B E5              11      PUSH    HL
00023C 423C FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000240 4240 CD1C00          17      CALL    _CALSLT
000243 4243 E1              10      POP HL
000244 4244 C1              10      POP BC
000245 4245 C9              10      RET
                                
       4246                     AT_ISC:
000246 F300                         ORG ISC,AT_ISC-RUN
000246 F300 FEB7             7      CP  0B7H            ;FILES
000248 F302 CC7BFE          17      CALL    Z,H_FILE
00024B F305 FEB5             7      CP  0B5H            ;LOAD
00024D F307 CA71FE          10      JP  Z,H_BINS
000250 F30A FE8A             7      CP  08AH            ;RUN
000252 F30C CA76FE          10      JP  Z,H_BINL
000255 F30F FECF             7      CP  0CFH            ;BLOAD
000257 F311 C0              11      RET NZ
       F312                     FIX_BLOAD:
000258 F312 F7              12      RST 30H
       F313                     ROM_SLT:
000259 F313 00                      DB  0
00025A F314 7F44                    DW  ROM_BLOAD
00025C F316 F5              11      PUSH    AF
00025D F317 E5              11      PUSH    HL
00025E F318 CD21F3          17      CALL    BLOAD_RET
       F319                     SWC_BLOAD   EQU $-2
000261 F31B E1              10      POP HL
000262 F31C F1              10      POP AF
000263 F31D FECF             7      CP  0CFH            ;BLOAD
000265 F31F 28DF            12      JR  Z,ISC
       F321                     BLOAD_RET:
000267 F321 C9              10      RET
                                
       F322                     _RESULT:
000268 F322 00                      DB  0
       F323                     _BANK:
000269 F323 00                      DB  0
       F324                     RR_LOW:
00026A F324 0000                    DW  0
       F325                     RR_MID  EQU $-1
       F326                     RR_HIGH:
00026C F326 0000                    DW  0
       F328                     _CLPS:
00026E F328 0000                    DW  0
       F32A                     _LEFT:
000270 F32A 0000                    DW  0
       F32C                     _DTPS:
000272 F32C 0000                    DW  0
       F32E                     _DTA:
000274 F32E 0000                    DW  0
       F330                     FLG_LDIR:
000276 F330 00                      DB  0
                                ;   BDOS
000277 F331 F7              12      RST 30H
000278 F332 00                      DB  0
000279 F333 964A                    DW  ROM_BDOS
00027B F335 C9              10      RET 
       F336                     _FCB:
00027C F336 0000                    DW  0
       F338                     _BUF:
00027E F338 00                      DB  0
       F339                     _BUF_ST:
00027F F339 0000                    DW  0
       F33B                     _BUF_EN:
000281 F33B 0000                    DW  0
       F33D                     _BUF_EX:
000283 F33D 0000                    DW  0
                                
       F33F                     ISC_E:
000285 4285                         ORG $$+RUN          ;$DEPHASE
                                
       4285                     MSX1:
000285 4285 CD9A42          17      CALL    MSGA1
       4288                     MSX:
000288 4288 7E               7      LD  A,(HL)
000289 4289 23               6      INC HL
00028A 428A B7               4      OR  A
00028B 428B 20F8            12      JR  NZ,MSX1
00028D 428D C9              10      RET
                                
       428E                     PRTHX:
00028E 428E F5              11      PUSH    AF
00028F 428F 07               4      RLCA
000290 4290 07               4      RLCA
000291 4291 07               4      RLCA
000292 4292 07               4      RLCA
000293 4293 CD9742          17      CALL    PRTA2
000296 4296 F1              10      POP AF
       4297                     PRTA2:
000297 4297 CDAE42          17      CALL    ASC
       429A                     MSG_A:
       429A                     MSGA1:
00029A 429A F5              11      PUSH    AF
00029B 429B C5              11      PUSH    BC
00029C 429C D5              11      PUSH    DE
00029D 429D E5              11      PUSH    HL
00029E 429E FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
0002A2 42A2 DD21A200        14      LD  IX,CHPUT
0002A6 42A6 CD1C00          17      CALL    _CALSLT
0002A9 42A9 E1              10      POP HL
0002AA 42AA D1              10      POP DE
0002AB 42AB C1              10      POP BC
       42AC                     MSGA2:
0002AC 42AC F1              10      POP AF
0002AD 42AD C9              10      RET
       42AE                     ASC:
0002AE 42AE E60F             7      AND $0F
0002B0 42B0 F630             7      OR  $30
0002B2 42B2 FE3A             7      CP  $3A
0002B4 42B4 D8              11      RET C
0002B5 42B5 C607             7      ADD A,7
0002B7 42B7 C9              10      RET
                                
       42B8                     MSN:
0002B8 42B8 7E               7      LD  A,(HL)
0002B9 42B9 23               6      INC HL
0002BA 42BA CD9A42          17      CALL    MSG_A
0002BD 42BD 10F9            13      DJNZ    MSN
0002BF 42BF C9              10      RET
                                
       42C0                     ROM_STKE:
0002C0 42C0 3E                      DB  03EH
0002C1 42C1 C9              10      RET
0002C2 42C2 32DAFE          13      LD  (H_STKE),A
0002C5 42C5 E5              11      PUSH    HL
0002C6 42C6 D5              11      PUSH    DE
0002C7 42C7 C5              11      PUSH    BC
0002C8 42C8 210A43          10      LD  HL,AUTOEXEC
0002CB 42CB 114FF3          10      LD  DE,FDRV
0002CE 42CE 010C00          10      LD  BC,1+8+3
0002D1 42D1 EDB0                    LDIR
0002D3 42D3 CD0547          17      CALL    ROM_OPEN_0F
0002D6 42D6 3813            12      JR  C,RSTKEE
0002D8 42D8 211643          10      LD  HL,RUN_AUTOEXEC
0002DB 42DB 11F0FB          10      LD  DE,KEYBUF
0002DE 42DE ED53FAF3        20      LD  (GETPNT),DE
0002E2 42E2 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0002E5 42E5 EDB0                    LDIR
0002E7 42E7 ED53F8F3        20      LD  (PUTPNT),DE
       42EB                     RSTKEE:
0002EB 42EB C1              10      POP BC
0002EC 42EC D1              10      POP DE
0002ED 42ED E1              10      POP HL
0002EE 42EE C9              10      RET
                                
       42EF                     MSG_ERROR_ROM_MODE:
0002EF 42EF 41534349492D384B        DB  "ASCII-8K/Konami-8K only!",13,10,0
            2F4B6F6E616D692D    
            384B206F6E6C7921    
            0D0A00              
                                
       430A                     AUTOEXEC:
00030A 430A 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4316                     RUN_AUTOEXEC:
000316 4316 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4329                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4329                     ROM_LDIR:
000329 4329 3A30F3          13      LD  A,(FLG_LDIR)
00032C 432C B7               4      OR  A
00032D 432D 2007            12      JR  NZ,ROM_LDIRVM
00032F 432F CB7A             8      BIT 7,D
000331 4331 2815            12      JR  Z,ROM_LDIRSLT
000333 4333 EDB0                    LDIR
000335 4335 C9              10      RET
                                
       4336                     ROM_LDIRVM:
000336 4336 C5              11      PUSH    BC
000337 4337 D5              11      PUSH    DE
000338 4338 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
00033C 433C DD215C00        14      LD  IX,LDIRVM
000340 4340 CD1C00          17      CALL    _CALSLT
000343 4343 E1              10      POP HL
000344 4344 C1              10      POP BC
000345 4345 09              11      ADD HL,BC
000346 4346 EB               4      EX  DE,HL
000347 4347 C9              10      RET
                                
       4348                     ROM_LDIRSLT:
000348 4348 EB               4      EX  DE,HL
       4349                     RLDIRSLT1:
000349 4349 1A               7      LD  A,(DE)
00034A 434A 13               6      INC DE
00034B 434B C5              11      PUSH    BC
00034C 434C D5              11      PUSH    DE
00034D 434D E5              11      PUSH    HL
00034E 434E 5F               4      LD  E,A
00034F 434F 3A42F3          13      LD  A,(RAMAD1)
000352 4352 FD2AC1FC        20      LD  IY,(EXPTBL)     ;メインROMスロット
000356 4356 DD211400        14      LD  IX,_WRSLT
00035A 435A CD1C00          17      CALL    _CALSLT
00035D 435D E1              10      POP HL
00035E 435E D1              10      POP DE
00035F 435F C1              10      POP BC
000360 4360 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000362 4362 EA4943          10      JP  PE,RLDIRSLT1
000365 4365 EB               4      EX  DE,HL
000366 4366 C9              10      RET
                                
       4367                     END_OF_LINE:
000367 4367 215EF5          10      LD  HL,BUF
       436A                     EOL1:
00036A 436A 7E               7      LD  A,(HL)
00036B 436B B7               4      OR  A
00036C 436C C8              11      RET Z
00036D 436D FE0D             7      CP  00DH
00036F 436F 2807            12      JR  Z,EOLE
000371 4371 FE0A             7      CP  00AH
000373 4373 2803            12      JR  Z,EOLE
000375 4375 23               6      INC HL
000376 4376 18F2            12      JR  EOL1
       4378                     EOLE:
000378 4378 3600            10      LD  (HL),0
00037A 437A 23               6      INC HL
00037B 437B 7E               7      LD  A,(HL)
00037C 437C FE0A             7      CP  00AH
00037E 437E C0              11      RET NZ
00037F 437F 23               6      INC HL
000380 4380 C9              10      RET
                                
       4381                     ROM_LOAD_ASCII:
000381 4381 210000          10      LD  HL,0
000384 4384 2239F3          16      LD  (_BUF_ST),HL    ;読み出し位置
000387 4387 2A76F6          16      LD  HL,(TXTTAB)
00038A 438A 223BF3          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00038D 438D 215EF5          10      LD  HL,BUF
000390 4390 222EF3          16      LD  (_DTA),HL
       4393                     RLOAD_A1:
000393 4393 2A39F3          16      LD  HL,(_BUF_ST)
000396 4396 2224F3          16      LD  (RR_LOW),HL
000399 4399 210201          10      LD  HL,258
00039C 439C CD5445          17      CALL    ROM_READ
00039F 439F 7C               4      LD  A,H
0003A0 43A0 B5               4      OR  L
0003A1 43A1 2875            12      JR  Z,RLOAD_AEND
0003A3 43A3 015EF5          10      LD  BC,BUF
0003A6 43A6 09              11      ADD HL,BC
0003A7 43A7 3600            10      LD  (HL),0
0003A9 43A9 CD6743          17      CALL    END_OF_LINE
0003AC 43AC 015EF5          10      LD  BC,BUF
0003AF 43AF A7               4      AND A
0003B0 43B0 ED42            15      SBC HL,BC
0003B2 43B2 4D               4      LD  C,L
0003B3 43B3 44               4      LD  B,H
0003B4 43B4 ED5B39F3        20      LD  DE,(_BUF_ST)
0003B8 43B8 19              11      ADD HL,DE
0003B9 43B9 2239F3          16      LD  (_BUF_ST),HL
0003BC 43BC 3A5EF5          13      LD  A,(BUF)
0003BF 43BF B7               4      OR  A
0003C0 43C0 28D1            12      JR  Z,RLOAD_A1
                                
0003C2 43C2 115EF5          10      LD  DE,BUF
0003C5 43C5 CD9246          17      CALL    SPCUTEX
0003C8 43C8 1A               7      LD  A,(DE)
0003C9 43C9 B7               4      OR  A
0003CA 43CA 284C            12      JR  Z,RLOAD_AEND
0003CC 43CC CDA446          17      CALL    GETNUM
0003CF 43CF 7C               4      LD  A,H
0003D0 43D0 B5               4      OR  L
0003D1 43D1 CA6C44          10      JP  Z,ERROR_DIRECT_IN_FILE
0003D4 43D4 DD2A3BF3        20      LD  IX,(_BUF_EN)
0003D8 43D8 DD7502          19      LD  (IX+2),L
0003DB 43DB DD7403          19      LD  (IX+3),H
                                
0003DE 43DE CD7C46          17      CALL    SPCUT
0003E1 43E1 EB               4      EX  DE,HL
0003E2 43E2 DDE5            15      PUSH    IX
0003E4 43E4 DD21B242        14      LD  IX,042B2H
0003E8 43E8 FD2AC1FC        20      LD  IY,(EXPTBL)     ;メインROMスロット
0003EC 43EC CD1C00          17      CALL    _CALSLT
0003EF 43EF DDE1            14      POP IX
0003F1 43F1 EB               4      EX  DE,HL
0003F2 43F2 111FF4          10      LD  DE,KBUF
0003F5 43F5 37               4      SCF
0003F6 43F6 ED52            15      SBC HL,DE
0003F8 43F8 2872            12      JR  Z,ERROR_DIRECT_IN_FILE
0003FA 43FA 3870            12      JR  C,ERROR_DIRECT_IN_FILE
0003FC 43FC 4D               4      LD  C,L
0003FD 43FD 44               4      LD  B,H
0003FE 43FE 2A3BF3          16      LD  HL,(_BUF_EN)
000401 4401 110400          10      LD  DE,4
000404 4404 19              11      ADD HL,DE
000405 4405 111FF4          10      LD  DE,KBUF
                                
000408 4408 EB               4      EX  DE,HL
000409 4409 EDB0                    LDIR
00040B 440B EB               4      EX  DE,HL
                                
00040C 440C DD7500          19      LD  (IX+0),L
00040F 440F DD7401          19      LD  (IX+1),H
000412 4412 223BF3          16      LD  (_BUF_EN),HL
000415 4415 C39343          10      JP  RLOAD_A1
                                
       4418                     RLOAD_AEND:
000418 4418 2A3BF3          16      LD  HL,(_BUF_EN)
00041B 441B AF               4      XOR A
00041C 441C 77               7      LD  (HL),A
00041D 441D 23               6      INC HL
00041E 441E 77               7      LD  (HL),A
00041F 441F 23               6      INC HL
000420 4420 223BF3          16      LD  (_BUF_EN),HL
000423 4423 1830            12      JR  RLOAD_END1
                                
       4425                     ROM_LOAD:
000425 4425 CD3E45          17      CALL    INIT_PARAM
000428 4428 CDF946          17      CALL    ROM_OPEN
00042B 442B 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00042D 442D 2138F3          10      LD  HL,_BUF
000430 4430 222EF3          16      LD  (_DTA),HL
000433 4433 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000436 4436 CD5445          17      CALL    ROM_READ
000439 4439 3A38F3          13      LD  A,(_BUF)
00043C 443C 3C               4      INC A
00043D 443D C28143          10      JP  NZ,ROM_LOAD_ASCII
000440 4440 2A76F6          16      LD  HL,(TXTTAB)
000443 4443 222EF3          16      LD  (_DTA),HL
000446 4446 EB               4      EX  DE,HL
000447 4447 2100FF          10      LD  HL,-256
00044A 444A 39              11      ADD HL,SP
00044B 444B ED52            15      SBC HL,DE
00044D 444D CD5445          17      CALL    ROM_READ
000450 4450 ED5B2EF3        20      LD  DE,(_DTA)
000454 4454 19              11      ADD HL,DE
       4455                     RLOAD_END1:
000455 4455 22C2F6          16      LD  (VARTAB),HL
000458 4458 22C4F6          16      LD  (ARYTAB),HL
00045B 445B 22C6F6          16      LD  (STREND),HL
                                
00045E 445E AF               4      XOR A
00045F 445F 213BF3          10      LD  HL,_BUF+3
000462 4462 77               7      LD  (HL),A
000463 4463 2B               6      DEC HL
000464 4464 77               7      LD  (HL),A
000465 4465 2B               6      DEC HL
000466 4466 77               7      LD  (HL),A
000467 4467 2B               6      DEC HL
000468 4468 3E8F             7      LD  A,08FH          ;REM
00046A 446A 77               7      LD  (HL),A
00046B 446B C9              10      RET
                                
       446C                     ERROR_DIRECT_IN_FILE:
00046C 446C 1E39             7      LD  E,57            ;Direct statement in file
00046E 446E 01                      DB  1           ;LD BC,
       446F                     ERROR_FILE_NOT_OPEN:
00046F 446F 1E3B             7      LD  E,59            ;File not OPEN
000471 4471 01                      DB  1           ;LD BC,
       4472                     ERROR_FILE_NOT_FOUND:
000472 4472 1E35             7      LD  E,53            ;File not found
       4474                     ERROR:
000474 4474 FD2AC1FC        20      LD  IY,(EXPTBL) ;メインROMスロット
000478 4478 DD216F40        14      LD  IX,0406FH
00047C 447C C31C00          10      JP  _CALSLT
                                
       447F                     ROM_BLOAD:
00047F 447F CD3E45          17      CALL    INIT_PARAM
000482 4482 CDF946          17      CALL    ROM_OPEN
000485 4485 38EB            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000487 4487 D5              11      PUSH    DE
000488 4488 2138F3          10      LD  HL,_BUF
00048B 448B 222EF3          16      LD  (_DTA),HL
00048E 448E 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000491 4491 CD5445          17      CALL    ROM_READ
000494 4494 3A38F3          13      LD  A,(_BUF)
000497 4497 FEFE             7      CP  0FEH
000499 4499 20D4            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00049B 449B 2121F3          10      LD  HL,BLOAD_RET
00049E 449E 2219F3          16      LD  (SWC_BLOAD),HL
0004A1 44A1 3ABEFC          13      LD  A,(RUNBNF)
0004A4 44A4 FE53             7      CP  'S'
0004A6 44A6 2005            12      JR  NZ,RBREAD_MEM
0004A8 44A8 3E01             7      LD  A,1
0004AA 44AA 3230F3          13      LD  (FLG_LDIR),A
       44AD                     RBREAD_MEM:
0004AD 44AD 2A39F3          16      LD  HL,(_BUF_ST)
0004B0 44B0 222EF3          16      LD  (_DTA),HL
0004B3 44B3 21FFFF          10      LD  HL,0FFFFH
0004B6 44B6 CD5445          17      CALL    ROM_READ
0004B9 44B9 3ABEFC          13      LD  A,(RUNBNF)
0004BC 44BC FE52             7      CP  'R'
0004BE 44BE 2006            12      JR  NZ,RBREAD1
0004C0 44C0 2A3DF3          16      LD  HL,(_BUF_EX)
0004C3 44C3 2219F3          16      LD  (SWC_BLOAD),HL
       44C6                     RBREAD1:
       44C6                     ROM_NEXT:
0004C6 44C6 E1              10      POP HL
0004C7 44C7 5D               4      LD  E,L
0004C8 44C8 54               4      LD  D,H
                                
0004C9 44C9 CDBB46          17      CALL    SEARCH_END
0004CC 44CC B7               4      OR  A
0004CD 44CD 280F            12      JR  Z,REM
                                                    ;マルチステートメントの処理
0004CF 44CF 7E               7      LD  A,(HL)
                                
0004D0 44D0 FEB5             7      CP  0B5H            ;LOAD
0004D2 44D2 CA2544          10      JP  Z,ROM_LOAD
0004D5 44D5 FE8A             7      CP  08AH            ;RUN
0004D7 44D7 2809            12      JR  Z,ROM_RUN
0004D9 44D9 FEB7             7      CP  0B7H            ;FILES
0004DB 44DB 2812            12      JR  Z,ROM_FILES
0004DD 44DD C9              10      RET
       44DE                     REM:
0004DE 44DE EB               4      EX  DE,HL
0004DF 44DF 3E8F             7      LD  A,08FH          ;REM
0004E1 44E1 C9              10      RET
                                
       44E2                     ROM_RUN:
0004E2 44E2 23               6      INC HL
0004E3 44E3 7E               7      LD  A,(HL)
0004E4 44E4 2B               6      DEC HL
0004E5 44E5 B7               4      OR  A
0004E6 44E6 2803            12      JR  Z,ROM_RUN1
0004E8 44E8 CD2544          17      CALL    ROM_LOAD
       44EB                     ROM_RUN1:
0004EB 44EB 3E8A             7      LD  A,08AH          ;RUN
0004ED 44ED 77               7      LD  (HL),A
0004EE 44EE C9              10      RET
                                
       44EF                     ROM_FILES:
0004EF 44EF E5              11      PUSH    HL
0004F0 44F0 CD3E45          17      CALL    INIT_PARAM
0004F3 44F3 CDE945          17      CALL    FILE
0004F6 44F6 3A50F3          13      LD  A,(FNAME)
0004F9 44F9 FE21             7      CP  021H
0004FB 44FB 3005            12      JR  NC,RFILES0
0004FD 44FD 060B             7      LD  B,11
0004FF 44FF CD4246          17      CALL    FILE10
       4502                     RFILES0:
000502 4502 21006E          10      LD  HL,_DIRBF   ;ディレクトリの先頭
000505 4505 0E70             7      LD  C,112       ;RootEntCnt
       4507                     RFILES1:
000507 4507 CD2047          17      CALL    FILESE
00050A 450A 302E            12      JR  NC,RFILES_NOT_MATCH
       450C                     RFILES_DISP:
00050C 450C E5              11      PUSH    HL
00050D 450D 0608             7      LD  B,8
00050F 450F CDB842          17      CALL    MSN
000512 4512 3E2E             7      LD  A,'.'
000514 4514 CD9A42          17      CALL    MSG_A
000517 4517 0603             7      LD  B,3
000519 4519 CDB842          17      CALL    MSN
00051C 451C 3ADDF3          13      LD  A,(CSRX)
00051F 451F 47               4      LD  B,A
000520 4520 3AB0F3          13      LD  A,(LINLEN)
000523 4523 90               4      SUB B
000524 4524 FE0C             7      CP  12
000526 4526 3009            12      JR  NC,RFILES2
000528 4528 3E0D             7      LD  A,00DH      ;改行
00052A 452A CD9A42          17      CALL    MSG_A
00052D 452D 3E0A             7      LD  A,00AH
00052F 452F 1802            12      JR  RFILES3
       4531                     RFILES2:
000531 4531 3E20             7      LD  A,020H
       4533                     RFILES3:
000533 4533 CD9A42          17      CALL    MSG_A
000536 4536 E1              10      POP HL
000537 4537 CD3C47          17      CALL    FNEXT
       453A                     RFILES_NOT_MATCH:
00053A 453A 20CB            12      JR  NZ,RFILES1
00053C 453C 1888            12      JR  ROM_NEXT
                                
       453E                     INIT_PARAM:
00053E 453E EB               4      EX  DE,HL
00053F 453F AF               4      XOR A
000540 4540 3230F3          13      LD  (FLG_LDIR),A
000543 4543 32BEFC          13      LD  (RUNBNF),A
000546 4546 3E01             7      LD  A,DISK_BANK
000548 4548 320068          13      LD  (BANK1_SEL),A
00054B 454B 13               6      INC DE
00054C 454C CD7C46          17      CALL    SPCUT
00054F 454F FE22             7      CP  '"'
000551 4551 C0              11      RET NZ
000552 4552 13               6      INC DE
000553 4553 C9              10      RET
                                
       4554                     ROM_READ:
000554 4554 E5              11      PUSH    HL
000555 4555 D5              11      PUSH    DE
000556 4556 C5              11      PUSH    BC
000557 4557 FDE5            15      PUSH    IY
000559 4559 224DF3          16      LD  (LEFTX),HL
00055C 455C 2A2EF3          16      LD  HL,(_DTA)
00055F 455F 2249F3          16      LD  (DTAX),HL
000562 4562 2A4DF3          16      LD  HL,(LEFTX)
                                
000565 4565 CD6847          17      CALL    RBX1
000568 4568 386F            12      JR  C,RBRERR1
00056A 456A 79               4      LD  A,C
00056B 456B EB               4      EX  DE,HL
00056C 456C ED52            15      SBC HL,DE       ;CP 0HL,CDE
00056E 456E 19              11      ADD HL,DE
00056F 456F DE00             7      SBC A,000H
000571 4571 3801            12      JR  C,RBR1
000573 4573 EB               4      EX  DE,HL
       4574                     RBR1:
000574 4574 9F               4      SBC A,A
000575 4575 E601             7      AND 1
000577 4577 3222F3          13      LD  (_RESULT),A
00057A 457A 7C               4      LD  A,H
00057B 457B B5               4      OR  L
00057C 457C CACF45          10      JP  Z,RBREND0
                                
00057F 457F 222AF3          16      LD  (_LEFT),HL  ;Read record byte
000582 4582 224DF3          16      LD  (LEFTX),HL
                                
000585 4585 CD9047          17      CALL    RBX2
000588 4588 281A            12      JR  Z,RBRB
                                                ;先頭の端数
00058A 458A CDA147          17      CALL    RBXA
00058D 458D DAE545          10      JP  C,RBRERR
000590 4590 C5              11      PUSH    BC
000591 4591 CD2943          17      CALL    ROM_LDIR
000594 4594 ED5349F3        20      LD  (DTAX),DE
000598 4598 2A4DF3          16      LD  HL,(LEFTX)
00059B 459B D1              10      POP DE
00059C 459C A7               4      AND A
00059D 459D ED52            15      SBC HL,DE
00059F 459F 224DF3          16      LD  (LEFTX),HL
0005A2 45A2 2828            12      JR  Z,RBREND
                                
       45A4                     RBRB:
0005A4 45A4 CDDA47          17      CALL    RBXB
0005A7 45A7 2817            12      JR  Z,RBRC
       45A9                     RBRB1:
0005A9 45A9 C5              11      PUSH    BC
0005AA 45AA D5              11      PUSH    DE
0005AB 45AB CD6D48          17      CALL    CLUST
0005AE 45AE EB               4      EX  DE,HL
0005AF 45AF 010004          10      LD  BC,1024     ;1クラスタのサイズ
0005B2 45B2 CD2943          17      CALL    ROM_LDIR
0005B5 45B5 EB               4      EX  DE,HL
0005B6 45B6 D1              10      POP DE
0005B7 45B7 C1              10      POP BC
0005B8 45B8 CD4A48          17      CALL    GNCL
0005BB 45BB DAE545          10      JP  C,RBRERR
0005BE 45BE 10E9            13      DJNZ    RBRB1
       45C0                     RBRC:
0005C0 45C0 CDEA47          17      CALL    RBXC
0005C3 45C3 2807            12      JR  Z,RBREND
                                
0005C5 45C5 CD6D48          17      CALL    CLUST
0005C8 45C8 EB               4      EX  DE,HL
0005C9 45C9 CD2943          17      CALL    ROM_LDIR
       45CC                     RBREND:
0005CC 45CC CDF447          17      CALL    RBXEND
       45CF                     RBREND0:
0005CF 45CF FDE1            14      POP IY
0005D1 45D1 C1              10      POP BC
0005D2 45D2 D1              10      POP DE
0005D3 45D3 F1              10      POP AF  ;(HL)
0005D4 45D4 AF               4      XOR A
0005D5 45D5 3A22F3          13      LD  A,(_RESULT)
0005D8 45D8 C9              10      RET
                                
       45D9                     RBRERR1:
0005D9 45D9 3E01             7      LD  A,001H
       45DB                     RBRERR2:
0005DB 45DB FDE1            14      POP IY
0005DD 45DD C1              10      POP BC
0005DE 45DE D1              10      POP DE
0005DF 45DF E1              10      POP HL
0005E0 45E0 37               4      SCF
0005E1 45E1 210000          10      LD  HL,0
0005E4 45E4 C9              10      RET
       45E5                     RBRERR:
0005E5 45E5 3EFF             7      LD  A,0FFH
0005E7 45E7 18F2            12      JR  RBRERR2
                                
       45E9                     FILE:
0005E9 45E9 AF               4      XOR A
0005EA 45EA 324FF3          13      LD  (FDRV),A
0005ED 45ED 13               6      INC DE
0005EE 45EE 1A               7      LD  A,(DE)
0005EF 45EF 1B               6      DEC DE
0005F0 45F0 FE3A             7      CP  ':'
0005F2 45F2 200B            12      JR  NZ,DEVI1
0005F4 45F4 1A               7      LD  A,(DE)      ;DRIVE
0005F5 45F5 CDE346          17      CALL    CAP
0005F8 45F8 D640             7      SUB '@'
0005FA 45FA 13               6      INC DE
0005FB 45FB 13               6      INC DE
0005FC 45FC 324FF3          13      LD  (FDRV),A
       45FF                     DEVI1:
                                
       45FF                     FILED:
0005FF 45FF CD4646          17      CALL    FILEI
000602 4602 2150F3          10      LD  HL,FNAME
                                
000605 4605 0608             7      LD  B,8
       4607                     FILE2:
000607 4607 CD5346          17      CALL    CCHKF
00060A 460A C8              11      RET Z
00060B 460B FE2A             7      CP  '*'
00060D 460D 282E            12      JR  Z,FILE9
00060F 460F FE2E             7      CP  '.'
000611 4611 280C            12      JR  Z,FILE4
000613 4613 77               7      LD  (HL),A
000614 4614 23               6      INC HL
000615 4615 10F0            13      DJNZ    FILE2
                                
       4617                     FILE3:
000617 4617 CD5346          17      CALL    CCHKF
00061A 461A C8              11      RET Z
00061B 461B FE2E             7      CP  '.'
00061D 461D 20F8            12      JR  NZ,FILE3
                                
       461F                     FILE4:
00061F 461F 2158F3          10      LD  HL,FNAME+8
000622 4622 0603             7      LD  B,3
                                
       4624                     FILE4L:
000624 4624 CD5346          17      CALL    CCHKF
000627 4627 C8              11      RET Z
000628 4628 FE2E             7      CP  '.'
00062A 462A 2008            12      JR  NZ,FILE12
00062C 462C 3250F3          13      LD  (FNAME),A   ;Parent directory(..)
00062F 462F 3251F3          13      LD  (FNAME+1),A
000632 4632 3E20             7      LD  A,020H
       4634                     FILE12:
000634 4634 FE2A             7      CP  '*'
000636 4636 280A            12      JR  Z,FILE10
000638 4638 77               7      LD  (HL),A
000639 4639 23               6      INC HL
00063A 463A 10E8            13      DJNZ    FILE4L
00063C 463C C9              10      RET
                                
       463D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00063D 463D CD4246          17      CALL    FILE10
000640 4640 18D5            12      JR  FILE3
                                
       4642                     FILE10:
000642 4642 3E3F             7      LD  A,'?'
000644 4644 1808            12      JR  FILL_MEMORY
       4646                     FILEI:              ;名前＋拡張子をスペースで初期化
000646 4646 3E20             7      LD  A,020H
000648 4648 01000B          10      LD  BC,11*256   ;C=0にしておく
00064B 464B 2150F3          10      LD  HL,FNAME
       464E                     FILL_MEMORY:            ;HLからBバイトAで埋める
00064E 464E 77               7      LD  (HL),A
00064F 464F 23               6      INC HL
000650 4650 10FC            13      DJNZ    FILL_MEMORY
000652 4652 C9              10      RET
                                
       4653                     CCHKF:
000653 4653 1A               7      LD  A,(DE)
000654 4654 CD5B46          17      CALL    CCHK2
000657 4657 C8              11      RET Z
000658 4658 C3D046          10      JP  FKAN
                                
       465B                     CCHK2:
00065B 465B 0C               4      INC C
00065C 465C 0D               4      DEC C
00065D 465D C0              11      RET NZ
       465E                     CCHK3:              ;ZF=1 で使えない文字
00065E 465E FE22             7      CP  '"'
000660 4660 C8              11      RET Z
000661 4661 FE2B             7      CP  '+'
000663 4663 C8              11      RET Z
000664 4664 FE2C             7      CP  ','
000666 4666 C8              11      RET Z
000667 4667 FE2F             7      CP  '/'
000669 4669 C8              11      RET Z
00066A 466A FE3A             7      CP  ':'
00066C 466C C8              11      RET Z
00066D 466D FE3B             7      CP  ';'
00066F 466F C8              11      RET Z
000670 4670 FE3D             7      CP  '='
000672 4672 C8              11      RET Z
000673 4673 FE5C             7      CP  05CH    ;\
000675 4675 C8              11      RET Z
000676 4676 FE20             7      CP  020H
000678 4678 D0              11      RET NC
000679 4679 BF               4      CP  A       ;Z=1
00067A 467A C9              10      RET
                                
       467B                     SS1:
00067B 467B 13               6      INC DE
       467C                     SPCUT:              ;スペースをカット
00067C 467C 1A               7      LD  A,(DE)
00067D 467D FE20             7      CP  020H
00067F 467F 28FA            12      JR  Z,SS1
000681 4681 C9              10      RET
       4682                     OPCUT1:
000682 4682 13               6      INC DE
       4683                     OPCUT:
000683 4683 1A               7      LD  A,(DE)
000684 4684 FE20             7      CP  020H
000686 4686 28FA            12      JR  Z,OPCUT1
000688 4688 FE22             7      CP  '"'
00068A 468A 28F6            12      JR  Z,OPCUT1
00068C 468C FE2C             7      CP  ','
00068E 468E 28F2            12      JR  Z,OPCUT1
000690 4690 C9              10      RET
                                
       4691                     SCREOF1:
000691 4691 13               6      INC DE
       4692                     SPCUTEX:            ;スペース改行などをカット
000692 4692 1A               7      LD  A,(DE)
000693 4693 FE20             7      CP  020H
000695 4695 28FA            12      JR  Z,SCREOF1
000697 4697 FE0D             7      CP  00DH
000699 4699 28F6            12      JR  Z,SCREOF1
00069B 469B FE0A             7      CP  00AH
00069D 469D 28F2            12      JR  Z,SCREOF1
00069F 469F FE1A             7      CP  01AH
0006A1 46A1 28EE            12      JR  Z,SCREOF1
0006A3 46A3 C9              10      RET
                                
       46A4                     GETNUM:
0006A4 46A4 210000          10      LD  HL,0
       46A7                     GETNUM1:
0006A7 46A7 1A               7      LD  A,(DE)
0006A8 46A8 13               6      INC DE
0006A9 46A9 D630             7      SUB '0'
0006AB 46AB D8              11      RET C
0006AC 46AC FE0A             7      CP  10
0006AE 46AE D0              11      RET NC
0006AF 46AF 4D               4      LD  C,L
0006B0 46B0 44               4      LD  B,H
0006B1 46B1 29              11      ADD HL,HL   ;*2
0006B2 46B2 29              11      ADD HL,HL   ;*4
0006B3 46B3 09              11      ADD HL,BC   ;*5
0006B4 46B4 29              11      ADD HL,HL   ;*10
0006B5 46B5 4F               4      LD  C,A
0006B6 46B6 0600             7      LD  B,0
0006B8 46B8 09              11      ADD HL,BC
0006B9 46B9 18EC            12      JR  GETNUM1
                                
       46BB                     SEARCH_END:
0006BB 46BB 7E               7      LD  A,(HL)
       46BC                     SEARCH_END1:
0006BC 46BC 23               6      INC HL
0006BD 46BD B7               4      OR  A
0006BE 46BE C8              11      RET Z
0006BF 46BF FE3A             7      CP  ':'
0006C1 46C1 20F8            12      JR  NZ,SEARCH_END
0006C3 46C3 7E               7      LD  A,(HL)
0006C4 46C4 FE3A             7      CP  ':'
0006C6 46C6 28F4            12      JR  Z,SEARCH_END1
0006C8 46C8 C9              10      RET
                                
       46C9                     FKANC:
0006C9 46C9 CB41             8      BIT 0,C
0006CB 46CB CCEC46          17      CALL    Z,CAP2
0006CE 46CE 1801            12      JR  FKANX
       46D0                     FKAN:           ;漢字チェック
0006D0 46D0 13               6      INC DE
       46D1                     FKANX:
0006D1 46D1 CB41             8      BIT 0,C
0006D3 46D3 CB81             8      RES 0,C
0006D5 46D5 C0              11      RET NZ
0006D6 46D6 FE80             7      CP  080H
0006D8 46D8 D8              11      RET C
0006D9 46D9 FEA0             7      CP  0A0H
0006DB 46DB 3803            12      JR  C,FKAN1
0006DD 46DD FEE0             7      CP  0E0H
0006DF 46DF D8              11      RET C
       46E0                     FKAN1:
0006E0 46E0 0C               4      INC C
0006E1 46E1 A7               4      AND A
0006E2 46E2 C9              10      RET
                                
       46E3                     CAP:
0006E3 46E3 FE61             7      CP  'a'
0006E5 46E5 D8              11      RET C
0006E6 46E6 FE7B             7      CP  'z'+1
0006E8 46E8 D0              11      RET NC
0006E9 46E9 D620             7      SUB 020H
0006EB 46EB C9              10      RET
       46EC                     CAP2:
0006EC 46EC CDE346          17      CALL    CAP
       46EF                     CAP3:               ;
0006EF 46EF FE05             7      CP  5
0006F1 46F1 2803            12      JR  Z,CAP4
0006F3 46F3 FE21             7      CP  021H
0006F5 46F5 C9              10      RET
       46F6                     CAP4:
0006F6 46F6 3EE5             7      LD  A,0E5H
0006F8 46F8 C9              10      RET
                                
       46F9                     ROM_OPEN:
0006F9 46F9 CDE945          17      CALL    FILE
0006FC 46FC CD8346          17      CALL    OPCUT
0006FF 46FF CDE346          17      CALL    CAP
000702 4702 32BEFC          13      LD  (RUNBNF),A
       4705                     ROM_OPEN_0F:
000705 4705 21006E          10      LD  HL,_DIRBF   ;ディレクトリの先頭
000708 4708 0E70             7      LD  C,112       ;RootEntCnt
00070A 470A D5              11      PUSH    DE
00070B 470B CD2047          17      CALL    FILESE
00070E 470E D1              10      POP DE
00070F 470F 3F               4      CCF
000710 4710 D8              11      RET C
000711 4711 224BF3          16      LD  (FCBX),HL
000714 4714 E5              11      PUSH    HL
000715 4715 210000          10      LD  HL,0
000718 4718 2224F3          16      LD  (RR_LOW),HL
00071B 471B 2226F3          16      LD  (RR_HIGH),HL
00071E 471E E1              10      POP HL
00071F 471F C9              10      RET
                                
       4720                     FILESE:
000720 4720 7E               7      LD  A,(HL)
000721 4721 B7               4      OR  A
000722 4722 C8              11      RET Z       ;END:ZF=1 CF=0
000723 4723 FEE5             7      CP  0E5H
000725 4725 280D            12      JR  Z,FILESE1
000727 4727 1150F3          10      LD  DE,FNAME
00072A 472A E5              11      PUSH    HL
00072B 472B CD4247          17      CALL    CPFILE
00072E 472E CC6347          17      CALL    Z,CPFILE2
000731 4731 E1              10      POP HL
000732 4732 37               4      SCF
000733 4733 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4734                     FILESE1:
000734 4734 CD3C47          17      CALL    FNEXT
000737 4737 20E7            12      JR  NZ,FILESE
       4739                     ZF0_CF0_AFF_RET:
000739 4739 F6FF             7      OR  0FFH        ;ZF=0 CF=0
00073B 473B C9              10      RET
                                
       473C                     FNEXT:
                                ;   PUSH    HL
                                ;   LD  HL,_FILEN
                                ;   INC (HL)
                                ;   POP HL
00073C 473C 112000          10      LD  DE,020H
00073F 473F 19              11      ADD HL,DE
000740 4740 0D               4      DEC C
000741 4741 C9              10      RET
                                
       4742                     CPFILE:
000742 4742 C5              11      PUSH    BC
000743 4743 01000B          10      LD  BC,00B00H
       4746                     CPSTR1:
000746 4746 1A               7      LD  A,(DE)
000747 4747 FE3F             7      CP  '?'     ;Wild card
000749 4749 2812            12      JR  Z,CPSTR2
00074B 474B 7E               7      LD  A,(HL)
00074C 474C CDC946          17      CALL    FKANC
00074F 474F E5              11      PUSH    HL
000750 4750 67               4      LD  H,A
000751 4751 1A               7      LD  A,(DE)
000752 4752 CB01             4      RLC C
000754 4754 CDC946          17      CALL    FKANC
000757 4757 CB09             4      RRC C
000759 4759 BC               4      CP  H       ;CP (HL),(DE)
00075A 475A E1              10      POP HL
00075B 475B 2004            12      JR  NZ,CPSTR3
       475D                     CPSTR2:
00075D 475D 13               6      INC DE
00075E 475E 23               6      INC HL
00075F 475F 10E5            13      DJNZ    CPSTR1
       4761                     CPSTR3:
000761 4761 C1              10      POP BC
000762 4762 C9              10      RET
                                
       4763                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
000763 4763 3EE1             7      LD  A,0E1H
000765 4765 2F               4      CPL
000766 4766 A6               7      AND (HL)
000767 4767 C9              10      RET
                                
       4768                     RBX1:
000768 4768 E5              11      PUSH    HL      ;Record byte
                                
000769 4769 ED5B24F3        20      LD  DE,(RR_LOW) ;CDE=Random record
00076D 476D 3A27F3          13      LD  A,(RR_HIGH+1)
000770 4770 4F               4      LD  C,A
                                
000771 4771 3E01             7      LD  A,DISK_BANK
000773 4773 320068          13      LD  (BANK1_SEL),A
                                
000776 4776 FD2A4BF3        20      LD  IY,(FCBX)
00077A 477A FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
00077D 477D FD661D          19      LD  H,(IY+01DH)
000780 4780 FD7E1E          19      LD  A,(IY+01EH)
                                
000783 4783 A7               4      AND A
000784 4784 ED52            15      SBC HL,DE
000786 4786 99               4      SBC A,C
000787 4787 D1              10      POP DE
                                
000788 4788 D8              11      RET C
000789 4789 4F               4      LD  C,A
00078A 478A EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
00078B 478B B2               4      OR  D
00078C 478C B3               4      OR  E
00078D 478D C0              11      RET NZ
00078E 478E 37               4      SCF
00078F 478F C9              10      RET
                                
       4790                     RBX2:
000790 4790 ED4B25F3        20      LD  BC,(RR_LOW+1)
000794 4794 CD0948          17      CALL    RWXR
000797 4797 3E03             7      LD  A,3     ;ooo 1
000799 4799 E5              11      PUSH    HL
00079A 479A 2A24F3          16      LD  HL,(RR_LOW)
00079D 479D A4               4      AND H
00079E 479E B5               4      OR  L
00079F 479F E1              10      POP HL
0007A0 47A0 C9              10      RET
                                
       47A1                     RBXA:
0007A1 47A1 D5              11      PUSH    DE
0007A2 47A2 CD6D48          17      CALL    CLUST
0007A5 47A5 ED532CF3        20      LD  (_DTPS),DE
0007A9 47A9 D1              10      POP DE
0007AA 47AA CD4A48          17      CALL    GNCL
0007AD 47AD D8              11      RET C
0007AE 47AE ED5328F3        20      LD  (_CLPS),DE
                                
0007B2 47B2 ED4B24F3        20      LD  BC,(RR_LOW)
0007B6 47B6 3E03             7      LD  A,3     ;ooo 1
0007B8 47B8 A0               4      AND B
0007B9 47B9 47               4      LD  B,A
0007BA 47BA 210004          10  IBM7:   LD  HL,1024     ;ooo 512
0007BD 47BD ED42            15      SBC HL,BC       ;remaining cluster
                                
0007BF 47BF ED5B4DF3        20      LD  DE,(LEFTX)
0007C3 47C3 ED52            15      SBC HL,DE       ;CP HL,DE
0007C5 47C5 19              11      ADD HL,DE
0007C6 47C6 3801            12      JR  C,RBXA1
0007C8 47C8 EB               4      EX  DE,HL
       47C9                     RBXA1:
0007C9 47C9 3A23F3          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
0007CC 47CC 320068          13      LD  (BANK1_SEL),A   ;ASCII-8K/Konami-8K共通で使える
0007CF 47CF E5              11      PUSH    HL
0007D0 47D0 2A2CF3          16      LD  HL,(_DTPS)
0007D3 47D3 09              11      ADD HL,BC
0007D4 47D4 ED5B49F3        20      LD  DE,(DTAX)
0007D8 47D8 C1              10      POP BC
0007D9 47D9 C9              10      RET
                                
       47DA                     RBXB:
0007DA 47DA 2A49F3          16      LD  HL,(DTAX)
0007DD 47DD ED5B28F3        20      LD  DE,(_CLPS)
0007E1 47E1 3A4EF3          13      LD  A,(LEFTX+1)
0007E4 47E4 CB3F             8      SRL A
0007E6 47E6 CB3F             8  IBM8:   SRL A       ;ooo
0007E8 47E8 47               4      LD  B,A
0007E9 47E9 C9              10      RET
                                
       47EA                     RBXC:
0007EA 47EA ED4B4DF3        20      LD  BC,(LEFTX)
0007EE 47EE 3E03             7      LD  A,3     ;ooo 1
0007F0 47F0 A0               4      AND B
0007F1 47F1 47               4      LD  B,A
0007F2 47F2 B1               4      OR  C
0007F3 47F3 C9              10      RET
                                
       47F4                     RBXEND:
0007F4 47F4 ED5B2AF3        20      LD  DE,(_LEFT)
0007F8 47F8 2A24F3          16      LD  HL,(RR_LOW)
0007FB 47FB 3A27F3          13      LD  A,(RR_HIGH+1)
0007FE 47FE 19              11      ADD HL,DE
0007FF 47FF CE00             7      ADC A,0
000801 4801 2224F3          16      LD  (RR_LOW),HL
000804 4804 3227F3          13      LD  (RR_HIGH+1),A
000807 4807 EB               4      EX  DE,HL       ;HL=Read byte
000808 4808 C9              10      RET 
                                
       4809                     RWXR:
000809 4809 CB38             8      SRL B
00080B 480B CB19             8      RR  C
00080D 480D CB38             8  IBM4:   SRL B   ;ooo
00080F 480F CB19             8      RR  C
                                
000811 4811 3E01             7      LD  A,DISK_BANK
000813 4813 320068          13      LD  (BANK1_SEL),A
                                
000816 4816 FD2A4BF3        20      LD  IY,(FCBX)
00081A 481A FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
00081D 481D FD561B          19      LD  D,(IY+01BH)
       4820                     RWX1:
000820 4820 ED5328F3        20      LD  (_CLPS),DE
000824 4824 7A               4      LD  A,D
000825 4825 B3               4      OR  E
000826 4826 37               4      SCF
000827 4827 C8              11      RET Z
                                
000828 4828 78               4      LD  A,B
000829 4829 B1               4      OR  C
00082A 482A C8              11      RET Z
                                
00082B 482B CD4A48          17      CALL    GNCL
00082E 482E D8              11      RET C
00082F 482F 0B               6      DEC BC
000830 4830 CD8F48          17      CALL    ENDCL
000833 4833 38EB            12      JR  C,RWX1
000835 4835 37               4      SCF
000836 4836 C9              10      RET
                                
       4837                     NCL3:
000837 4837 3E01             7      LD  A,DISK_BANK
000839 4839 320068          13      LD  (BANK1_SEL),A
00083C 483C 6B               4      LD  L,E
00083D 483D 62               4      LD  H,D
00083E 483E CB3C             8      SRL H
000840 4840 CB1D             8      RR  L
000842 4842 1F               4      RRA
000843 4843 010062          10      LD  BC,_FATBF
000846 4846 19              11      ADD HL,DE
000847 4847 09              11      ADD HL,BC
000848 4848 17               4      RLA
000849 4849 C9              10      RET
                                
       484A                     GNCL:
00084A 484A 7A               4      LD  A,D
00084B 484B B3               4      OR  E
00084C 484C 37               4      SCF
00084D 484D C8              11      RET Z
00084E 484E C5              11      PUSH    BC
00084F 484F E5              11      PUSH    HL
000850 4850 CD3748          17      CALL    NCL3
000853 4853 3809            12      JR  C,GNC1
000855 4855 5E               7      LD  E,(HL)
000856 4856 23               6      INC HL
000857 4857 7E               7      LD  A,(HL)
000858 4858 E60F             7      AND 00FH
00085A 485A 57               4      LD  D,A
00085B 485B E1              10      POP HL
00085C 485C C1              10      POP BC
00085D 485D C9              10      RET
       485E                     GNC1:
00085E 485E 7E               7      LD  A,(HL)
00085F 485F 23               6      INC HL
000860 4860 56               7      LD  D,(HL)
000861 4861 0604             7      LD  B,4
       4863                     GNC1L:
000863 4863 CB3A             8      SRL D
000865 4865 1F               4      RRA
000866 4866 10FB            13      DJNZ    GNC1L
                                
000868 4868 5F               4      LD  E,A
000869 4869 E1              10      POP HL
00086A 486A C1              10      POP BC
00086B 486B A7               4      AND A
00086C 486C C9              10      RET
                                
       486D                     CLUST:
00086D 486D EB               4      EX  DE,HL
00086E 486E 3E14             7      LD  A,20
000870 4870 29              11      ADD HL,HL   ;*2
000871 4871 29              11      ADD HL,HL   ;*4
000872 4872 85               4      ADD A,L
000873 4873 6F               4      LD  L,A
000874 4874 8C               4      ADC A,H
000875 4875 95               4      SUB L
000876 4876 67               4      LD  H,A
000877 4877 E5              11      PUSH    HL
000878 4878 29              11      ADD HL,HL
000879 4879 29              11      ADD HL,HL
00087A 487A 29              11      ADD HL,HL
00087B 487B 7C               4      LD  A,H
00087C 487C C601             7      ADD A,DISK_BANK
00087E 487E 320068          13      LD  (BANK1_SEL),A
000881 4881 3223F3          13      LD  (_BANK),A
000884 4884 E1              10      POP HL
000885 4885 3E1F             7      LD  A,01FH
000887 4887 A5               4      AND L
000888 4888 C660             7      ADD A,high BANK1_ADR
00088A 488A 67               4      LD  H,A
00088B 488B 2E00             7      LD  L,0
00088D 488D EB               4      EX  DE,HL
00088E 488E C9              10      RET
                                
       488F                     ENDCL:
00088F 488F 7A               4      LD  A,D ;END CLUSTER
000890 4890 FE02             7      CP  2   ;2CB=715
000892 4892 C0              11      RET NZ
000893 4893 7B               4      LD  A,E
000894 4894 FECB             7      CP  0CBH
000896 4896 C9              10      RET
                                
       4897                     RB_READ:
000897 4897 AF               4      XOR A   ;HLA = HL*128
000898 4898 CB3C             8      SRL H
00089A 489A CB1D             8      RR  L
00089C 489C 1F               4      RRA
00089D 489D 3224F3          13      LD  (RR_LOW),A
0008A0 48A0 2225F3          16      LD  (RR_MID),HL
0008A3 48A3 218000          10      LD  HL,128
                                
0008A6 48A6 CD5445          17      CALL    ROM_READ
0008A9 48A9 C9              10      RET
                                
       48AA                     GETSEQ:
0008AA 48AA FD6E20          19      LD  L,(IY+32)
0008AD 48AD FD660C          19      LD  H,(IY+12)
                                
0008B0 48B0 CB25             8      SLA L
                                
0008B2 48B2 CB3C             8      SRL H
0008B4 48B4 CB1D             8      RR  L
0008B6 48B6 C9              10      RET
                                
       48B7                     SETSEQ:
0008B7 48B7 F5              11      PUSH    AF
0008B8 48B8 3A24F3          13      LD  A,(RR_LOW)
0008BB 48BB 2A25F3          16      LD  HL,(RR_MID)
                                
0008BE 48BE CDD548          17      CALL    SSQ1
                                
0008C1 48C1 29              11      ADD HL,HL
0008C2 48C2 CB3D             8      SRL L
0008C4 48C4 FD7520          19      LD  (IY+32),L
0008C7 48C7 FD740C          19      LD  (IY+12),H
0008CA 48CA F1              10      POP AF
0008CB 48CB C9              10      RET
                                
       48CC                     GETSIZE:
0008CC 48CC FD7E10          19      LD  A,(IY+16)
0008CF 48CF FD6E11          19      LD  L,(IY+17)
0008D2 48D2 FD6612          19      LD  H,(IY+18)
       48D5                     SSQ1:
0008D5 48D5 87               4      ADD A,A
0008D6 48D6 ED6A            15      ADC HL,HL
0008D8 48D8 B7               4      OR  A
0008D9 48D9 C8              11      RET Z
0008DA 48DA 23               6      INC HL
0008DB 48DB C9              10      RET
                                
       48DC                     SET_FCB:
0008DC 48DC D5              11      PUSH    DE
0008DD 48DD FDE1            14      POP IY
0008DF 48DF FD7E1C          19      LD  A,(IY+28)
0008E2 48E2 FEFF             7      CP  0FFH
0008E4 48E4 200C            12      JR  NZ,POPAF_SCF_FF_RET
0008E6 48E6 E5              11      PUSH    HL
0008E7 48E7 FD6E1A          19      LD  L,(IY+26)
0008EA 48EA FD661B          19      LD  H,(IY+27)
0008ED 48ED 2228F3          16      LD  (_CLPS),HL
0008F0 48F0 E1              10      POP HL
0008F1 48F1 C9              10      RET
                                
       48F2                     POPAF_SCF_FF_RET:
0008F2 48F2 F1              10      POP AF
0008F3 48F3 37               4      SCF
0008F4 48F4 9F               4      SBC A,A
0008F5 48F5 C9              10      RET
                                
       48F6                     WILDCARD:
0008F6 48F6 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4901                     ERROR_WRITE_PROTECTED:
000901 4901 3E00             7      LD  A,0     ;Write protected
000903 4903 C9              10      RET
       4904                     DISKIO:
000904 4904 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000906 4906 48               4      LD  C,B
000907 4907 CD7C4A          17      CALL    GET_DISK_BANK
       490A                     SETMAP1:        
00090A 490A E5              11      PUSH    HL
       490B                     DISKIO1:
00090B 490B C5              11      PUSH    BC      ;B=残りのセクタ数
00090C 490C D5              11      PUSH    DE      ;DE=セクタ番号
00090D 490D F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
00090E 490E EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
00090F 490F 29              11      ADD HL,HL
000910 4910 4D               4      LD  C,L     ;C=読み出し元(セクタ番号*2)※1セクタ512バイトなので倍にしておく
000911 4911 29              11      ADD HL,HL       ;64KB→32KB
000912 4912 29              11      ADD HL,HL       ;32KB→16KB
000913 4913 29              11      ADD HL,HL       ;16KB→8KB
000914 4914 84               4      ADD A,H
000915 4915 320068          13      LD  (BANK1_SEL),A   ;ASCII-8K/Konami-8K共通で使える
000918 4918 3223F3          13      LD  (_BANK),A
00091B 491B 79               4      LD  A,C     ;C=読み出し元
00091C 491C E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F/16K:3F)
00091E 491E C660             7      ADD A,high BANK1_ADR
000920 4920 67               4      LD  H,A
000921 4921 010002          10      LD  BC,00200H   ;BCは読み出すセクタサイズ(512バイト)
000924 4924 69               4      LD  L,C     ;C=0
000925 4925 EDB0                    LDIR
000927 4927 EB               4      EX  DE,HL
000928 4928 F1              10      POP AF
000929 4929 D1              10      POP DE
00092A 492A 13               6      INC DE
00092B 492B C1              10      POP BC
00092C 492C 10DD            13      DJNZ    DISKIO1
00092E 492E 41               4      LD  B,C
                                
00092F 492F E1              10      POP HL
000930 4930 AF               4      XOR A
000931 4931 FB               4      EI
000932 4932 C9              10      RET
                                
       4933                     DSKCHG:
000933 4933 CD6C49          17      CALL    IS_BPB
000936 4936 3824            12      JR  C,NOTREADY
000938 4938 3A23FB          13      LD  A,(DRVTBL+2)
00093B 493B B7               4      OR  A
00093C 493C 201A            12      JR  NZ,DSKCHG1
00093E 493E 3A21FB          13      LD  A,(DRVTBL)
000941 4941 FE02             7      CP  2
000943 4943 2013            12      JR  NZ,DSKCHG1
000945 4945 CD6C49          17      CALL    IS_BPB
000948 4948 300E            12      JR  NC,DSKCHG1
00094A 494A 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
00094C 494C 3221FB          13      LD  (DRVTBL),A
00094F 494F 3223FB          13      LD  (DRVTBL+2),A
000952 4952 3A48F3          13      LD  A,(MASTERS)
000955 4955 3224FB          13      LD  (DRVTBL+3),A
       4958                     DSKCHG1:
000958 4958 AF               4      XOR A
000959 4959 0601             7      LD  B,1
00095B 495B C9              10      RET
       495C                     NOTREADY:
00095C 495C 3E02             7      LD  A,2
00095E 495E 37               4      SCF
00095F 495F C9              10      RET
                                
       4960                     NO_BPB:
000960 4960 E1              10      POP HL
000961 4961 23               6      INC HL
000962 4962 117F4A          10      LD  DE,DPB2DD
000965 4965 011200          10      LD  BC,DPB2DD_E-DPB2DD
000968 4968 EDB0                    LDIR
00096A 496A AF               4      XOR A
00096B 496B C9              10      RET
                                
       496C                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
00096C 496C CD7C4A          17      CALL    GET_DISK_BANK
00096F 496F 320068          13      LD  (BANK1_SEL),A
                                
000972 4972 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000975 4975 FE01             7      CP  1
000977 4977 D8              11      RET C
                                
000978 4978 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
00097B 497B C6FF             7      ADD A,0FFH
00097D 497D D8              11      RET C
                                
00097E 497E 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000981 4981 FE02             7      CP  2
000983 4983 C8              11      RET Z
000984 4984 FE04             7      CP  4
000986 4986 C8              11      RET Z
000987 4987 37               4      SCF
000988 4988 C9              10      RET
                                
       4989                     GETDPB:
000989 4989 E5              11      PUSH    HL
00098A 498A CD7C4A          17      CALL    GET_DISK_BANK
00098D 498D 320068          13      LD  (BANK1_SEL),A
                                
000990 4990 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000993 4993 B7               4      OR  A
000994 4994 28CA            12      JR  Z,NO_BPB
000996 4996 DDE1            14      POP IX
000998 4998 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
00099B 499B 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
00099E 499E DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
0009A1 49A1 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
0009A4 49A4 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
0009A7 49A7 87               4      ADD A,A
0009A8 49A8 87               4      ADD A,A
0009A9 49A9 87               4      ADD A,A
0009AA 49AA 3D               4      DEC A
0009AB 49AB DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
0009AE 49AE 06FF             7      LD  B,-1
0009B0 49B0 A7               4      AND A           ;無限ループ阻止
       49B1                     GETDPB1:
0009B1 49B1 04               4      INC B
0009B2 49B2 1F               4      RRA
0009B3 49B3 38FC            12      JR  C,GETDPB1
0009B5 49B5 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
0009B8 49B8 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus 
0009BB 49BB 3D               4      DEC A
0009BC 49BC DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
0009BF 49BF A7               4      AND A           ;無限ループ阻止
0009C0 49C0 06FF             7      LD  B,-1
       49C2                     GETDPB2:
0009C2 49C2 04               4      INC B
0009C3 49C3 1F               4      RRA
0009C4 49C4 38FC            12      JR  C,GETDPB2
0009C6 49C6 04               4      INC B
0009C7 49C7 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
0009CA 49CA 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
0009CD 49CD DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
0009D0 49D0 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
0009D3 49D3 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
0009D6 49D6 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
0009D9 49D9 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
0009DC 49DC DD770B          19      LD  (IX+11),A       ;FATCNT
                                
0009DF 49DF ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
0009E3 49E3 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
0009E6 49E6 DD460A          19      LD  B,(IX+10)       ;FATCNT
0009E9 49E9 210000          10      LD  HL,0
       49EC                     GETDPB3:
0009EC 49EC 19              11      ADD HL,DE
0009ED 49ED 10FD            13      DJNZ    GETDPB3
       49EF                     GETDPB4:
0009EF 49EF DD5E08          19      LD  E,(IX+8)        ;FIRFAT
0009F2 49F2 DD5609          19      LD  D,(IX+9)        ;FIRFAT
0009F5 49F5 19              11      ADD HL,DE
0009F6 49F6 DD7511          19      LD  (IX+17),L       ;FIRDIR
0009F9 49F9 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
0009FC 49FC 3E08             7      LD  A,2*4           ;SECSIZ HIGH
0009FE 49FE DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4A01                     GETDPB5:
000A01 4A01 CB3B             8      SRL E
000A03 4A03 1F               4      RRA
000A04 4A04 30FB            12      JR  NC,GETDPB5
000A06 4A06 1600             7      LD  D,0
000A08 4A08 19              11      ADD HL,DE
000A09 4A09 DD750C          19      LD  (IX+12),L       ;FIRREC
000A0C 4A0C DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000A0F 4A0F 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000A12 4A12 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000A15 4A15 DD560D          19      LD  D,(IX+13)       ;FIRREC
000A18 4A18 A7               4      AND A
000A19 4A19 ED52            15      SBC HL,DE
                                
000A1B 4A1B DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000A1E 4A1E 3C               4      INC A
000A1F 4A1F 37               4      SCF             ;無限ループ阻止
       4A20                     GETDPB6:
000A20 4A20 1F               4      RRA
000A21 4A21 3806            12      JR  C,GETDPB7
000A23 4A23 CB3C             8      SRL H
000A25 4A25 CB1D             8      RR  L
000A27 4A27 18F7            12      JR  GETDPB6
       4A29                     GETDPB7:
000A29 4A29 23               6      INC HL
000A2A 4A2A DD750E          19      LD  (IX+14),L       ;MAXCLUS
000A2D 4A2D DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4A30                     GETDPBD1:
000A30 4A30 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000A33 4A33 E6FC             7      AND 0FCH
000A35 4A35 C8              11      RET Z
                                
000A36 4A36 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000A3A 4A3A 37               4      SCF
000A3B 4A3B DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000A3F 4A3F DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000A42 4A42 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000A46 4A46 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000A4A 4A4A DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000A4E 4A4E DDCB1126        23      SLA (IX+17)         ;FIRDIR
000A52 4A52 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000A56 4A56 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000A59 4A59 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000A5C 4A5C 3E08             7      LD  A,2*4           ;SECSIZ HIGH
000A5E 4A5E DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4A61                     GETDPBD5:
000A61 4A61 CB3B             8      SRL E
000A63 4A63 1F               4      RRA
000A64 4A64 30FB            12      JR  NC,GETDPBD5
000A66 4A66 1600             7      LD  D,0
000A68 4A68 19              11      ADD HL,DE
000A69 4A69 DD750C          19      LD  (IX+12),L       ;FIRREC
000A6C 4A6C DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000A6F 4A6F 18BF            12      JR  GETDPBD1
                                
       4A71                     CHOICE:
000A71 4A71 210000          10      LD  HL,0
000A74 4A74 C9              10      RET
                                
       4A75                     DSKFMT:
000A75 4A75 AF               4      XOR A
000A76 4A76 37               4      SCF
       4A77                     DSKSTP:
       4A77                     BASENT:
000A77 4A77 C9              10      RET
                                
       4A78                     GETSLT:
000A78 4A78 3A22FB          13      LD  A,(DRVTBL+1)
000A7B 4A7B C9              10      RET
                                
       4A7C                     GET_DISK_BANK:
000A7C 4A7C 3E01             7      LD  A,DISK_BANK
000A7E 4A7E C9              10      RET
                                
       4A7F                     DPB2DD:
000A7F 4A7F F9                      DB  0F9H    ;MEDIA
000A80 4A80 0002                    DW  00200H  ;SECSIZ
000A82 4A82 0F                      DB  00FH    ;DIRMSK
000A83 4A83 04                      DB  004H    ;DIRSHFT
000A84 4A84 01                      DB  001H    ;CLUSMSK
000A85 4A85 02                      DB  002H    ;CLUSSHFT
000A86 4A86 0100                    DW  00001H  ;FIRFAT
000A88 4A88 02                      DB  002H    ;FATCNT
000A89 4A89 70                      DB  070H    ;MAXENT
000A8A 4A8A 0E00                    DW  0000EH  ;FIRREC
000A8C 4A8C CA02                    DW  002CAH  ;MAXCLUS
000A8E 4A8E 03                      DB  003H    ;FATSIZ
000A8F 4A8F 0700                    DW  0007H   ;FIRDIR
       4A91                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4A91                     POP_HL_ERROR:
000A91 4A91 E1              10      POP     HL
       4A92                     _ERROR:
000A92 4A92 0600             7      LD  B,0
000A94 4A94 A7               4      AND A
000A95 4A95 C9              10      RET
                                
       4A96                     ROM_BDOS:
000A96 4A96 E5              11      PUSH    HL
000A97 4A97 79               4      LD  A,C
000A98 4A98 87               4      ADD A,A
000A99 4A99 38F7            12      JR  C,_ERROR
000A9B 4A9B 6F               4      LD  L,A
000A9C 4A9C 265F             7      LD  H,high STABLE
000A9E 4A9E 7E               7      LD  A,(HL)
000A9F 4A9F 2C               4      INC L
000AA0 4AA0 66               7      LD  H,(HL)
000AA1 4AA1 6F               4      LD  L,A
000AA2 4AA2 E3              19      EX  (SP),HL
000AA3 4AA3 79               4      LD  A,C
000AA4 4AA4 C9              10      RET
                                
       4AA5                     _SYS0B:     ;(BDOS)コンソール状態のチェック
000AA5 4AA5 C5              11      PUSH    BC
000AA6 4AA6 D5              11      PUSH    DE
000AA7 4AA7 E5              11      PUSH    HL
000AA8 4AA8 DDE5            15      PUSH    IX
000AAA 4AAA DD219C00        14      LD  IX,CHSNS
000AAE 4AAE CD3A42          17      CALL    CALSLT_R
000AB1 4AB1 DDE1            14      POP IX
000AB3 4AB3 E1              10      POP HL
000AB4 4AB4 D1              10      POP DE
000AB5 4AB5 C1              10      POP BC
000AB6 4AB6 C9              10      RET
                                
       4AB7                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000AB7 4AB7 212200          10      LD  HL,00022H
000ABA 4ABA AF               4      XOR A
000ABB 4ABB 7D               4      LD  A,L
000ABC 4ABC C9              10      RET
                                
       4ABD                     _SYS0D:     ;(BDOS)ディスク・リセット
000ABD 4ABD 218000          10      LD  HL,00080H
000AC0 4AC0 222EF3          16      LD  (_DTA),HL
000AC3 4AC3 C9              10      RET
                                
       4AC4                     _SYS0F:     ;(BDOS)ファイルのオープン
000AC4 4AC4 D5              11      PUSH    DE
000AC5 4AC5 FDE1            14      POP IY
000AC7 4AC7 CD0D4C          17      CALL    INIT_FILE
                                
000ACA 4ACA CD0547          17      CALL    ROM_OPEN_0F
000ACD 4ACD 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
000ACF 4ACF FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
000AD3 4AD3 FDE5            15      PUSH    IY
000AD5 4AD5 D1              10      POP DE
000AD6 4AD6 13               6      INC DE
000AD7 4AD7 010B00          10      LD  BC,11
000ADA 4ADA EDB0                    LDIR
                                ;               Attribute
000ADC 4ADC 7E               7      LD  A,(HL)
000ADD 4ADD FD770D          19      LD  (IY+13),A
                                ;               TIME
000AE0 4AE0 110B00          10      LD  DE,11
000AE3 4AE3 19              11      ADD HL,DE
000AE4 4AE4 7E               7      LD  A,(HL)
000AE5 4AE5 23               6      INC HL
000AE6 4AE6 FD7716          19      LD  (IY+22),A
000AE9 4AE9 7E               7      LD  A,(HL)
000AEA 4AEA 23               6      INC HL
000AEB 4AEB FD7717          19      LD  (IY+23),A
                                ;               DATE
000AEE 4AEE 7E               7      LD  A,(HL)
000AEF 4AEF 23               6      INC HL
000AF0 4AF0 FD7714          19      LD  (IY+20),A
000AF3 4AF3 7E               7      LD  A,(HL)
000AF4 4AF4 23               6      INC HL
000AF5 4AF5 FD7715          19      LD  (IY+21),A
                                ;               First cluster
000AF8 4AF8 7E               7      LD  A,(HL)
000AF9 4AF9 23               6      INC HL
000AFA 4AFA FD771A          19      LD  (IY+26),A
000AFD 4AFD 7E               7      LD  A,(HL)
000AFE 4AFE 23               6      INC HL
000AFF 4AFF FD771B          19      LD  (IY+27),A
                                ;               SIZE
000B02 4B02 7E               7      LD  A,(HL)
000B03 4B03 23               6      INC HL
000B04 4B04 FD7710          19      LD  (IY+16),A
000B07 4B07 7E               7      LD  A,(HL)
000B08 4B08 23               6      INC HL
000B09 4B09 FD7711          19      LD  (IY+17),A
000B0C 4B0C 7E               7      LD  A,(HL)
000B0D 4B0D 23               6      INC HL
000B0E 4B0E FD7712          19      LD  (IY+18),A
000B11 4B11 7E               7      LD  A,(HL)
000B12 4B12 FD7713          19      LD  (IY+19),A
000B15 4B15 AF               4      XOR A
000B16 4B16 FD770C          19      LD  (IY+12),A
000B19 4B19 C9              10      RET
                                
       4B1A                     _SYS10:     ;(BDOS)ファイルのクローズ
000B1A 4B1A AF               4      XOR A
000B1B 4B1B C9              10      RET
                                
       4B1C                     S11X1:
000B1C 4B1C FD7119          19      LD  (IY+25),C       ;RootEntCnt
000B1F 4B1F FD750E          19      LD  (IY+14),L
000B22 4B22 FD740F          19      LD  (IY+15),H
       4B25                     SCF_FF_RET:
000B25 4B25 37               4      SCF
000B26 4B26 9F               4      SBC A,A
000B27 4B27 C9              10      RET
                                
       4B28                     _SYS11:     ;(BDOS)最初のファイルの検索
000B28 4B28 ED5336F3        20      LD  (_FCB),DE
000B2C 4B2C D5              11      PUSH    DE
000B2D 4B2D FDE1            14      POP IY
000B2F 4B2F CD0D4C          17      CALL    INIT_FILE
                                
000B32 4B32 21006E          10      LD  HL,_DIRBF   ;ディレクトリの先頭
000B35 4B35 0E70             7      LD  C,112       ;RootEntCnt
       4B37                     S12X1:
000B37 4B37 CD2047          17      CALL    FILESE
000B3A 4B3A 30E0            12      JR  NC,S11X1
000B3C 4B3C 0D               4      DEC C
000B3D 4B3D FD7119          19      LD  (IY+25),C       ;RootEntCnt
000B40 4B40 012000          10      LD  BC,32
000B43 4B43 ED5B2EF3        20      LD  DE,(_DTA)
000B47 4B47 AF               4      XOR A
000B48 4B48 12               7      LD  (DE),A      ;ドライブ番号
000B49 4B49 13               6      INC DE
000B4A 4B4A EDB0                    LDIR            ;ディレクトリエントリ
000B4C 4B4C FD750E          19      LD  (IY+14),L
000B4F 4B4F FD740F          19      LD  (IY+15),H
000B52 4B52 C9              10      RET
                                
       4B53                     _SYS12:
000B53 4B53 FD2A36F3        20      LD  IY,(_FCB)
000B57 4B57 FDE5            15      PUSH    IY
000B59 4B59 D1              10      POP DE
000B5A 4B5A CD0D4C          17      CALL    INIT_FILE
                                
000B5D 4B5D FD6E0E          19      LD  L,(IY+14)
000B60 4B60 FD660F          19      LD  H,(IY+15)
000B63 4B63 FD4E19          19      LD  C,(IY+25)
000B66 4B66 18CF            12      JR  S12X1
                                
       4B68                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000B68 4B68 CDDC48          17      CALL    SET_FCB
000B6B 4B6B CDAA48          17      CALL    GETSEQ
000B6E 4B6E CD9748          17      CALL    RB_READ
000B71 4B71 E5              11      PUSH    HL
000B72 4B72 CDB748          17      CALL    SETSEQ
000B75 4B75 E1              10      POP HL
       4B76                     SREAD:
000B76 4B76 C601             7      ADD A,001H
000B78 4B78 D8              11      RET C
                                
000B79 4B79 7D               4      LD  A,L
000B7A 4B7A D601             7      SUB 001H
000B7C 4B7C 9F               4      SBC A,A
000B7D 4B7D E603             7      AND 3
000B7F 4B7F 1F               4      RRA
000B80 4B80 C9              10      RET
                                
       4B81                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000B81 4B81 210100          10      LD  HL,00001H
000B84 4B84 AF               4      XOR A
000B85 4B85 C9              10      RET
                                
       4B86                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000B86 4B86 AF               4      XOR A
000B87 4B87 C9              10      RET
                                
       4B88                     _SYS1A:     ;(BDOS)DTAの設定
000B88 4B88 ED532EF3        20      LD  (_DTA),DE
000B8C 4B8C AF               4      XOR A
000B8D 4B8D C9              10      RET
                                
       4B8E                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000B8E 4B8E 010002          10      LD  BC,512
000B91 4B91 11C302          10      LD  DE,707
000B94 4B94 210000          10      LD  HL,0
000B97 4B97 DD2138F3        14      LD  IX,_BUF
000B9B 4B9B FD2138F3        14      LD  IY,_BUF
000B9F 4B9F FD3600F9        19      LD  (IY+0),0F9H
000BA3 4BA3 3E02             7      LD  A,2
000BA5 4BA5 C9              10      RET
                                
       4BA6                     _SYS21:     ;(BDOS)ランダムな読み出し
000BA6 4BA6 CDDC48          17      CALL    SET_FCB
                                
000BA9 4BA9 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
000BAC 4BAC FD6622          19      LD  H,(IY+34)
                                
000BAF 4BAF CD9748          17      CALL    RB_READ
000BB2 4BB2 18C2            12      JR  SREAD
                                
       4BB4                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
000BB4 4BB4 CDC44A          17      CALL    _SYS0F
000BB7 4BB7 D8              11      RET C
                                
000BB8 4BB8 D5              11      PUSH    DE      ;EX DE,IY
000BB9 4BB9 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000BBB 4BBB CDCC48          17      CALL    GETSIZE
       4BBE                     _S24X1:
000BBE 4BBE FD7521          19      LD  (IY+33),L   ;(FCB)Random record
000BC1 4BC1 FD7422          19      LD  (IY+34),H
000BC4 4BC4 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
000BC8 4BC8 FDE3            23      EX  (SP),IY     ;
000BCA 4BCA D1              10      POP DE      ;
                                
000BCB 4BCB AF               4      XOR A
000BCC 4BCC C9              10      RET
                                
       4BCD                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
000BCD 4BCD E5              11      PUSH    HL
000BCE 4BCE D5              11      PUSH    DE      ;EX DE,IY
000BCF 4BCF FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
000BD1 4BD1 CDAA48          17      CALL    GETSEQ
000BD4 4BD4 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       4BD6                     _SYS27:     ;(BDOS)ランダムブロック読み込み
000BD6 4BD6 CDDC48          17      CALL    SET_FCB
000BD9 4BD9 E5              11      PUSH    HL
000BDA 4BDA FD6E21          19      LD  L,(IY+33)
000BDD 4BDD FD6622          19      LD  H,(IY+34)
000BE0 4BE0 2224F3          16      LD  (RR_LOW),HL
000BE3 4BE3 FD6E23          19      LD  L,(IY+35)
000BE6 4BE6 FD6624          19      LD  H,(IY+36)
000BE9 4BE9 2226F3          16      LD  (RR_HIGH),HL
000BEC 4BEC E1              10      POP HL
000BED 4BED CD5445          17      CALL    ROM_READ
000BF0 4BF0 ED5B24F3        20      LD  DE,(RR_LOW)
000BF4 4BF4 FD7321          19      LD  (IY+33),E
000BF7 4BF7 FD7222          19      LD  (IY+34),D
000BFA 4BFA ED5B26F3        20      LD  DE,(RR_HIGH)
000BFE 4BFE FD7323          19      LD  (IY+35),E
000C01 4C01 FD7224          19      LD  (IY+36),D
000C04 4C04 9F               4      SBC A,A
000C05 4C05 C9              10      RET
                                
       4C06                     _SYS2F:
000C06 4C06 44               4      LD  B,H
000C07 4C07 2A2EF3          16      LD  HL,(_DTA)
000C0A 4C0A C30449          10      JP  DISKIO
                                
       4C0D                     INIT_FILE:
000C0D 4C0D EB               4      EX  DE,HL
000C0E 4C0E 114FF3          10      LD  DE,FDRV
000C11 4C11 010C00          10      LD  BC,1+8+3
000C14 4C14 EDB0                    LDIR
000C16 4C16 3E01             7      LD  A,DISK_BANK
000C18 4C18 320068          13      LD  (BANK1_SEL),A
000C1B 4C1B C9              10      RET
                                
000C1C 4C1C                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F08 5F08 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F10 5F10 924A924A924AA54A        DW  _ERROR,_ERROR,_ERROR,_SYS0B
001F18 5F18 B74ABD4A924AC44A        DW  _SYS0C,_SYS0D,_ERROR,_SYS0F
                                ;1
001F20 5F20 1A4B284B534B924A        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 684B924A924A924A        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 814B864B884B8E4B        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 924A924A924AB44B        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 CD4B924A924AD64B        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F58 5F58 924A924A924A064C        DW  _ERROR,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 924A924A924A924A        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
