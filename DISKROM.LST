                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
                                ;USE_RAM_BLOAD_S    EQU 1   ;先頭のコメントを外すとBLOAD,SでRAMを使う
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3354B          10      JP  DISKIO
000013 4013 C36F4B          10      JP  DSKCHG
000016 4016 C3C54B          10      JP  GETDPB
000019 4019 C3B84C          10      JP  CHOICE
00001C 401C C3BC4C          10      JP  DSKFMT
00001F 401F C3BE4C          10      JP  DSKSTP
000022 4022 C3BF4C          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3BC4C          10      JP  DSKFMT
000029 4029 C3BE4C          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3C64C          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.1.4.2",0
            204449534B20524F    
            4D204C6974652076    
            302E312E342E3200    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2257F1          16      LD  (BASSTK),HL
000129 4129 ED7B57F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3242F1          13      LD  (_DVSW),A
                                
00013B 413B 21F342          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017400          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2110F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 210BF1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD3B42          17      CALL    GTSL1_
000183 4183 32FCF0          13      LD  (ROM_SLT),A
000186 4186 3272FE          13      LD  (H_BINS+1),A
000189 4189 3277FE          13      LD  (H_BINL+1),A
00018C 418C 327CFE          13      LD  (H_FILE+1),A
00018F 418F 3232F3          13      LD  (H_BDOS+1),A
000192 4192 32DBFE          13      LD  (H_STKE+1),A
000195 4195 32A8FF          13      LD  (H_PHYD+1),A
000198 4198 3222FB          13      LD  (DRVTBL+1),A
00019B 419B 3248F3          13      LD  (MASTERS),A
                                
00019E 419E 212245          10      LD  HL,ROM_LOAD
0001A1 41A1 2273FE          16      LD  (H_BINS+2),HL
0001A4 41A4 213D46          10      LD  HL,ROM_RUN
0001A7 41A7 2278FE          16      LD  (H_BINL+2),HL
0001AA 41AA 214A46          10      LD  HL,ROM_FILES
0001AD 41AD 227DFE          16      LD  (H_FILE+2),HL
0001B0 41B0 21124D          10      LD  HL,ROM_BDOS
0001B3 41B3 2233F3          16      LD  (H_BDOS+2),HL
0001B6 41B6 219143          10      LD  HL,ROM_STKE
0001B9 41B9 22DCFE          16      LD  (H_STKE+2),HL
0001BC 41BC 21354B          10      LD  HL,DISKIO
0001BF 41BF 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C2 41C2 3E                      DB  03EH
0001C3 41C3 C9              10      RET
0001C4 41C4 327FFE          13      LD  (H_FILE+4),A
0001C7 41C7 3275FE          13      LD  (H_BINS+4),A
0001CA 41CA 327AFE          13      LD  (H_BINL+4),A
0001CD 41CD 3235F3          13      LD  (H_BDOS+4),A
0001D0 41D0 32DEFE          13      LD  (H_STKE+4),A
0001D3 41D3 32ABFF          13      LD  (H_PHYD+4),A
                                
                                #if exists USE_NORMAL_32K_ROM
                                #else
0001D6 41D6 AF               4      XOR A
0001D7 41D7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DA 41DA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001DD 41DD 3A0060          13      LD  A,(BANK1_ADR)
0001E0 41E0 FE41             7      CP  'A'
0001E2 41E2 2046            12      JR  NZ,NOT_8K_BANK
0001E4 41E4 3E01             7      LD  A,DISK_BANK
0001E6 41E6 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001E9 41E9 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001EC 41EC CD3801          17      CALL    RSLREG      ;read primary slot #
0001EF 41EF 07               4      RLCA
0001F0 41F0 07               4      RLCA
0001F1 41F1 F5              11      PUSH    AF
0001F2 41F2 CD4042          17      CALL    GTSL2_
0001F5 41F5 3244F3          13      LD  (RAMAD3),A
0001F8 41F8 F1              10      POP AF  
0001F9 41F9 CD4042          17      CALL    GTSL2_
0001FC 41FC 3243F3          13      LD  (RAMAD2),A
       41FF                     RAMCHK2:
0001FF 41FF 3A44F3          13      LD  A,(RAMAD3)
000202 4202 2640             7      LD  H,040H
000204 4204 CD5742          17      CALL    CHK_RAM
000207 4207 3242F3          13      LD  (RAMAD1),A
       420A                     RAMCHK1:
00020A 420A 3A44F3          13      LD  A,(RAMAD3)
00020D 420D 2600             7      LD  H,00H
00020F 420F CD5742          17      CALL    CHK_RAM
000212 4212 3241F3          13      LD  (RAMAD0),A
       4215                     RAMCHK0:
000215 4215 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000218 4218 010F00          10      LD  BC,0000FH       ;切り上げ
00021B 421B 09              11      ADD HL,BC
00021C 421C 7D               4      LD  A,L
                                
00021D 421D 0604             7      LD  B,4
       421F                     B_DRIVE1:
00021F 421F CB3C             8      SRL H
000221 4221 1F               4      RRA
000222 4222 10FB            13      DJNZ    B_DRIVE1
                                
000224 4224 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000226 4226 3241F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000229 4229 C9              10      RET
                                
       422A                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
00022A 422A 21DF43          10      LD  HL,MSG_ERROR_ROM_MODE
00022D 422D CD6A43          17      CALL    MSX
000230 4230 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000234 4234 DD219F00        14      LD  IX,CHGET
000238 4238 C31C00          10      JP  _CALSLT
                                
       423B                     GTSL1_:             ;自分のいるスロットを知る
00023B 423B CD3801          17      CALL    RSLREG      ;read primary slot #
00023E 423E 0F               4      RRCA
00023F 423F 0F               4      RRCA
       4240                     GTSL2_:
000240 4240 E603             7      AND 3       ;[A]=000000PP
000242 4242 5F               4      LD  E,A     ;[E]=000000PP
000243 4243 21C1FC          10      LD  HL,EXPTBL
000246 4246 85               4      ADD A,L     ;桁上りは無い
000247 4247 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000248 4248 7B               4      LD  A,E     ;[A]=000000PP
000249 4249 CB7E            13      BIT 7,(HL)
00024B 424B C8              11      RET Z
00024C 424C 7D               4      LD  A,L     ;point to SLTTBL entry
00024D 424D C604             7      ADD A,4     ;桁上りは無い
00024F 424F 6F               4      LD  L,A
000250 4250 7E               7      LD  A,(HL)      ;get currently expansion slot register
000251 4251 E60C             7      AND 00CH        ;[A] = 0000SS00
000253 4253 B3               4      OR  E       ;[A] = 0000SSPP
000254 4254 F680             7      OR  080H        ;[A] = 1000SSPP
000256 4256 C9              10      RET
       4257                     GTSL1_E:
                                
       4257                     CHK_RAM:
000257 4257 E5              11      PUSH    HL
000258 4258 CDAC42          17      CALL    CHK_RAM0
00025B 425B E1              10      POP HL
00025C 425C C8              11      RET Z
00025D 425D 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000260 4260 E680             7      AND 080H
000262 4262 CD8342          17      CALL    CHK_RAM_SLT
000265 4265 C8              11      RET Z
000266 4266 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000269 4269 E680             7      AND 080H
00026B 426B C601             7      ADD A,1
00026D 426D CD8342          17      CALL    CHK_RAM_SLT
000270 4270 C8              11      RET Z
000271 4271 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000274 4274 E680             7      AND 080H
000276 4276 C602             7      ADD A,2
000278 4278 CD8342          17      CALL    CHK_RAM_SLT
00027B 427B C8              11      RET Z
00027C 427C 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00027F 427F E680             7      AND 080H
000281 4281 C603             7      ADD A,3
       4283                     CHK_RAM_SLT:
000283 4283 E5              11      PUSH    HL
000284 4284 CDAC42          17      CALL    CHK_RAM0        ;スロット#X or X-0
000287 4287 E1              10      POP HL
000288 4288 C8              11      RET Z
000289 4289 CB79             8      BIT 7,C
00028B 428B 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00028D 428D 79               4      LD  A,C
00028E 428E C604             7      ADD A,4         ;スロット#X-1
000290 4290 E5              11      PUSH    HL
000291 4291 CDAC42          17      CALL    CHK_RAM0
000294 4294 E1              10      POP HL
000295 4295 C8              11      RET Z
000296 4296 79               4      LD  A,C
000297 4297 C604             7      ADD A,4         ;スロット#X-2
000299 4299 E5              11      PUSH    HL
00029A 429A CDAC42          17      CALL    CHK_RAM0
00029D 429D E1              10      POP HL
00029E 429E C8              11      RET Z
00029F 429F 79               4      LD  A,C
0002A0 42A0 C604             7      ADD A,4         ;スロット#X-3
0002A2 42A2 E5              11      PUSH    HL
0002A3 42A3 CDAC42          17      CALL    CHK_RAM0
0002A6 42A6 E1              10      POP HL
       42A7                     CHK_RAM_E:
0002A7 42A7 AF               4      XOR A
0002A8 42A8 3C               4      INC A           ;ZF=0にする
0002A9 42A9 3E00             7      LD  A,0
0002AB 42AB C9              10      RET
                                
       42AC                     CHK_RAM0:
0002AC 42AC 4F               4      LD  C,A
0002AD 42AD 3AFCF0          13      LD  A,(ROM_SLT)
0002B0 42B0 B9               4      CP  C
0002B1 42B1 28F4            12      JR  Z,CHK_RAM_E
0002B3 42B3 2E00             7      LD  L,0
       42B5                     CHK_RAM1:
0002B5 42B5 79               4      LD  A,C
0002B6 42B6 DD210C00        14      LD  IX,_RDSLT
0002BA 42BA CDE742          17      CALL    CALSLT_R
0002BD 42BD C6E5             7      ADD A,0E5H
0002BF 42BF 47               4      LD  B,A
0002C0 42C0 5F               4      LD  E,A
0002C1 42C1 79               4      LD  A,C
0002C2 42C2 DD211400        14      LD  IX,_WRSLT
0002C6 42C6 CDE742          17      CALL    CALSLT_R
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDE742          17      CALL    CALSLT_R
0002D1 42D1 B8               4      CP  B
0002D2 42D2 C0              11      RET NZ
0002D3 42D3 D6E5             7      SUB 0E5H
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 5F               4      LD  E,A
0002D7 42D7 DD211400        14      LD  IX,_WRSLT
0002DB 42DB CDE742          17      CALL    CALSLT_R
0002DE 42DE 24               4      INC H
0002DF 42DF 7D               4      LD  A,L
0002E0 42E0 C604             7      ADD A,4
0002E2 42E2 6F               4      LD  L,A
0002E3 42E3 20D0            12      JR  NZ,CHK_RAM1
0002E5 42E5 79               4      LD  A,C     ;ZF=1のハズ
0002E6 42E6 C9              10      RET
                                
       42E7                     CALSLT_R:
0002E7 42E7 C5              11      PUSH    BC
0002E8 42E8 E5              11      PUSH    HL
0002E9 42E9 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002ED 42ED CD1C00          17      CALL    _CALSLT
0002F0 42F0 E1              10      POP HL
0002F1 42F1 C1              10      POP BC
0002F2 42F2 C9              10      RET
                                
       42F3                     AT_ISC:
0002F3 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
0002F3 F0E9 FEB7             7      CP  0B7H            ;FILES
0002F5 F0EB CC7BFE          17      CALL    Z,H_FILE
0002F8 F0EE FEB5             7      CP  0B5H            ;LOAD
0002FA F0F0 CA71FE          10      JP  Z,H_BINS
0002FD F0F3 FE8A             7      CP  08AH            ;RUN
0002FF F0F5 CA76FE          10      JP  Z,H_BINL
000302 F0F8 FECF             7      CP  0CFH            ;BLOAD
000304 F0FA C0              11      RET NZ
       F0FB                     FIX_BLOAD:
000305 F0FB F7              12      RST 30H
       F0FC                     ROM_SLT:
000306 F0FC 00                      DB  0
000307 F0FD 7F45                    DW  ROM_BLOAD
000309 F0FF F5              11      PUSH    AF
00030A F100 E5              11      PUSH    HL
00030B F101 CD0AF1          17      CALL    BLOAD_RET
       F102                     SWC_BLOAD   EQU $-2
00030E F104 E1              10      POP HL
00030F F105 F1              10      POP AF
000310 F106 FECF             7      CP  0CFH            ;BLOAD
       F108                     SWC_BLOAD_M:
000312 F108 28DF            12      JR  Z,REPLACE_COMMAND
       F10A                     BLOAD_RET:
000314 F10A C9              10      RET
       F10B                     ROMUSE1:
000315 F10B 3AFCF0          13      LD  A,(ROM_SLT)
000318 F10E 1803            12      JR  ROMUSE2
       F110                     RAMUSE1:
00031A F110 3A42F3          13      LD  A,(RAMAD1)
       F113                     ROMUSE2:
00031D F113 DD212400        14      LD  IX,_ENASLT
000321 F117 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000325 F11B C31C00          10      JP  _CALSLT
                                
       F11E                     _RESULT:
000328 F11E 00                      DB  0
       F11F                     _BANK:
000329 F11F 00                      DB  0
       F120                     CLSZ:               ;クラスタサイズ
00032A F120 0004                    DW  1024
       F121                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F122                     SECSZ:              ;セクタサイズ
00032C F122 0002                    DW  512
       F123                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F124                     RR_LOW:
00032E F124 0000                    DW  0
       F125                     RR_MID  EQU $-1
       F126                     RR_HIGH:
000330 F126 0000                    DW  0
       F128                     _CLPS:
000332 F128 0000                    DW  0
       F12A                     _LEFT:
000334 F12A 0000                    DW  0
       F12C                     _DTPS:
000336 F12C 0000                    DW  0
       F12E                     _DTA:
000338 F12E 0000                    DW  0
                                #if exists USE_RAM_BLOAD_S
                                #else
       F130                     FLG_LDIR:
00033A F130 00                      DB  0
                                #endif
                                ;   BDOS
00033B F131 F7              12      RST 30H
00033C F132 00                      DB  0
00033D F133 124D                    DW  ROM_BDOS
00033F F135 C9              10      RET 
       F136                     _FCB:
000340 F136 0000                    DW  0
       F138                     _BUF:
000342 F138 00                      DB  0
       F139                     _BUF_ST:
000343 F139 0000                    DW  0
       F13B                     _BUF_EN:
000345 F13B 0000                    DW  0
       F13D                     _BUF_EX:
000347 F13D 0000                    DW  0
                                
       F13F                     DTAX:
000349 F13F 0000                    DW  0
       F141                     B_DRIVE:
00034B F141 00                      DB  0
       F142                     _DVSW:
00034C F142 00                      DB  0
       F143                     FCBX:
00034D F143 0000                    DW  0
       F145                     LEFTX:
00034F F145 0000                    DW  0
       F147                     PARAM0:
000351 F147 0000                    DW  0
       F149                     PARAM1:
000353 F149 0000                    DW  0
       F14B                     FDRV:
000355 F14B 00                      DB  0
       F14C                     FNAME:
000356 F14C                         DS  8+3
                                
       F157                     BASSTK:
000361 F157 0000                    DW  0
       F159                     _HL:
000363 F159 0000                    DW  0
       F15B                     _SP:
000365 F15B 0000                    DW  0
                                
       F15D                     ISC_E:
000367 4367                         ORG $$+RUN          ;$DEPHASE
                                
       4367                     MSX1:
000367 4367 CD2B4D          17      CALL    MSGA1
       436A                     MSX:
00036A 436A 7E               7      LD  A,(HL)
00036B 436B 23               6      INC HL
00036C 436C B7               4      OR  A
00036D 436D 20F8            12      JR  NZ,MSX1
00036F 436F C9              10      RET
                                
       4370                     PRTHX:
000370 4370 F5              11      PUSH    AF
000371 4371 07               4      RLCA
000372 4372 07               4      RLCA
000373 4373 07               4      RLCA
000374 4374 07               4      RLCA
000375 4375 CD7943          17      CALL    PRTA2
000378 4378 F1              10      POP AF
       4379                     PRTA2:
000379 4379 CD7F43          17      CALL    ASC
00037C 437C C3274D          10      JP  MSG_A
                                    
       437F                     ASC:
00037F 437F E60F             7      AND $0F
000381 4381 F630             7      OR  $30
000383 4383 FE3A             7      CP  $3A
000385 4385 D8              11      RET C
000386 4386 C607             7      ADD A,7
000388 4388 C9              10      RET
                                
       4389                     MSN:
000389 4389 7E               7      LD  A,(HL)
00038A 438A 23               6      INC HL
00038B 438B CD274D          17      CALL    MSG_A
00038E 438E 10F9            13      DJNZ    MSN
000390 4390 C9              10      RET
                                
       4391                     ROM_STKE:
000391 4391 3E                      DB  03EH
000392 4392 C9              10      RET
000393 4393 32DAFE          13      LD  (H_STKE),A
000396 4396 E5              11      PUSH    HL
000397 4397 D5              11      PUSH    DE
000398 4398 C5              11      PUSH    BC
000399 4399 181D            12      JR  BASAUTO
                                
00039B 439B AF               4      XOR A
00039C 439C 5F               4      LD  E,A
00039D 439D 57               4      LD  D,A
00039E 439E 0601             7      LD  B,1
0003A0 43A0 2100C0          10      LD  HL,0C000H
0003A3 43A3 CD354B          17      CALL    DISKIO
                                
0003A6 43A6 ED7357F1        20      LD  (BASSTK),SP
0003AA 43AA 116BF3          10      LD  DE,RAMUSE
0003AD 43AD AF               4      XOR A
0003AE 43AE CD1EC0          17      CALL    0C01EH
0003B1 43B1 116BF3          10      LD  DE,RAMUSE
0003B4 43B4 37               4      SCF
0003B5 43B5 CD1EC0          17      CALL    0C01EH
       43B8                     BASAUTO:
0003B8 43B8 210544          10      LD  HL,AUTOEXEC
0003BB 43BB 114BF1          10      LD  DE,FDRV
0003BE 43BE 010C00          10      LD  BC,1+8+3
0003C1 43C1 EDB0                    LDIR
0003C3 43C3 CDAB48          17      CALL    ROM_OPEN
0003C6 43C6 3813            12      JR  C,RSTKEE
0003C8 43C8 211144          10      LD  HL,RUN_AUTOEXEC
0003CB 43CB 11F0FB          10      LD  DE,KEYBUF
0003CE 43CE ED53FAF3        20      LD  (GETPNT),DE
0003D2 43D2 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003D5 43D5 EDB0                    LDIR
0003D7 43D7 ED53F8F3        20      LD  (PUTPNT),DE
       43DB                     RSTKEE:
0003DB 43DB C1              10      POP BC
0003DC 43DC D1              10      POP DE
0003DD 43DD E1              10      POP HL
0003DE 43DE C9              10      RET
                                
       43DF                     MSG_ERROR_ROM_MODE:
0003DF 43DF 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
       4404                     NULL:
000404 4404 00                      DB  0
                                
       4405                     AUTOEXEC:
000405 4405 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4411                     RUN_AUTOEXEC:
000411 4411 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4424                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4424                     ROM_LDIR:
                                #if exists USE_RAM_BLOAD_S
                                #else
000424 4424 3A30F1          13      LD  A,(FLG_LDIR)
000427 4427 B7               4      OR  A
000428 4428 2008            12      JR  NZ,ROM_LDIRVM
                                #endif
00042A 442A CB7A             8      BIT 7,D
00042C 442C CA4444          10      JP  Z,ROM_LDIRSLT
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    LD  HL,BUF
                                    POP BC
                                    POP DE
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
00042F 442F EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    LD  SP,(_SP)
                                #endif
000431 4431 C9              10      RET
                                
       4432                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000432 4432 C5              11      PUSH    BC
000433 4433 D5              11      PUSH    DE
000434 4434 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000438 4438 DD215C00        14      LD  IX,LDIRVM
00043C 443C CD1C00          17      CALL    _CALSLT
                                #if exists USE_NORMAL_32K_ROM
                                    LD  H,080H
                                    LD  A,(RAMAD2)
                                    CALL    _ENASLT
                                #endif
00043F 443F E1              10      POP HL
000440 4440 C1              10      POP BC
000441 4441 09              11      ADD HL,BC
000442 4442 EB               4      EX  DE,HL
000443 4443 C9              10      RET
                                
       4444                     ROM_LDIRSLT:
000444 4444 EB               4      EX  DE,HL
       4445                     RLDIRSLT1:
000445 4445 1A               7      LD  A,(DE)
000446 4446 13               6      INC DE
000447 4447 C5              11      PUSH    BC
000448 4448 D5              11      PUSH    DE
000449 4449 E5              11      PUSH    HL
00044A 444A 5F               4      LD  E,A
00044B 444B 3A42F3          13      LD  A,(RAMAD1)
00044E 444E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000452 4452 DD211400        14      LD  IX,_WRSLT
000456 4456 CD1C00          17      CALL    _CALSLT
000459 4459 E1              10      POP HL
00045A 445A D1              10      POP DE
00045B 445B C1              10      POP BC
00045C 445C EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00045E 445E EA4544          10      JP  PE,RLDIRSLT1
000461 4461 EB               4      EX  DE,HL
000462 4462 C9              10      RET
                                
       4463                     END_OF_LINE:
000463 4463 215EF5          10      LD  HL,BUF
       4466                     EOL1:
000466 4466 7E               7      LD  A,(HL)
000467 4467 C8              11      RET Z
000468 4468 FE0D             7      CP  00DH
00046A 446A 2807            12      JR  Z,EOLE
00046C 446C FE0A             7      CP  00AH
00046E 446E 2803            12      JR  Z,EOLE
000470 4470 23               6      INC HL
000471 4471 18F3            12      JR  EOL1
       4473                     EOLE:
000473 4473 3600            10      LD  (HL),0
000475 4475 23               6      INC HL
000476 4476 7E               7      LD  A,(HL)
000477 4477 FE0A             7      CP  00AH
000479 4479 C0              11      RET NZ
00047A 447A 23               6      INC HL
00047B 447B C9              10      RET
                                
       447C                     ROM_LOAD_ASCII:
00047C 447C 210000          10      LD  HL,0
00047F 447F 2239F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000482 4482 2A76F6          16      LD  HL,(TXTTAB)
000485 4485 223BF1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000488 4488 215EF5          10      LD  HL,BUF
00048B 448B 222EF1          16      LD  (_DTA),HL
       448E                     RLOAD_A1:
00048E 448E 2A39F1          16      LD  HL,(_BUF_ST)
000491 4491 2224F1          16      LD  (RR_LOW),HL
000494 4494 210201          10      LD  HL,258
000497 4497 CDCB46          17      CALL    ROM_READ
00049A 449A 7C               4      LD  A,H
00049B 449B B5               4      OR  L
00049C 449C 2877            12      JR  Z,RLOAD_AEND
00049E 449E 015EF5          10      LD  BC,BUF
0004A1 44A1 09              11      ADD HL,BC
0004A2 44A2 3600            10      LD  (HL),0
0004A4 44A4 CD6344          17      CALL    END_OF_LINE
0004A7 44A7 015EF5          10      LD  BC,BUF
0004AA 44AA A7               4      AND A
0004AB 44AB ED42            15      SBC HL,BC
0004AD 44AD 2810            12      JR  Z,RLOAD_A2
0004AF 44AF 4D               4      LD  C,L
0004B0 44B0 44               4      LD  B,H
0004B1 44B1 ED5B39F1        20      LD  DE,(_BUF_ST)
0004B5 44B5 19              11      ADD HL,DE
0004B6 44B6 2239F1          16      LD  (_BUF_ST),HL
0004B9 44B9 3A5EF5          13      LD  A,(BUF)
0004BC 44BC B7               4      OR  A
0004BD 44BD 28CF            12      JR  Z,RLOAD_A1
       44BF                     RLOAD_A2:
0004BF 44BF 115EF5          10      LD  DE,BUF
0004C2 44C2 CD4248          17      CALL    SPCUTEX
0004C5 44C5 1A               7      LD  A,(DE)
0004C6 44C6 B7               4      OR  A
0004C7 44C7 284C            12      JR  Z,RLOAD_AEND
0004C9 44C9 CD5448          17      CALL    GETNUM
0004CC 44CC 7C               4      LD  A,H
0004CD 44CD B5               4      OR  L
0004CE 44CE CA6C45          10      JP  Z,ERROR_DIRECT_IN_FILE
0004D1 44D1 DD2A3BF1        20      LD  IX,(_BUF_EN)
0004D5 44D5 DD7502          19      LD  (IX+2),L
0004D8 44D8 DD7403          19      LD  (IX+3),H
                                
0004DB 44DB CD3B48          17      CALL    SPCUT
0004DE 44DE EB               4      EX  DE,HL
0004DF 44DF DDE5            15      PUSH    IX
0004E1 44E1 DD21B242        14      LD  IX,CRUNCH
0004E5 44E5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004E9 44E9 CD1C00          17      CALL    _CALSLT
0004EC 44EC DDE1            14      POP IX
0004EE 44EE EB               4      EX  DE,HL
0004EF 44EF 111FF4          10      LD  DE,KBUF
0004F2 44F2 37               4      SCF
0004F3 44F3 ED52            15      SBC HL,DE
0004F5 44F5 2875            12      JR  Z,ERROR_DIRECT_IN_FILE
0004F7 44F7 3873            12      JR  C,ERROR_DIRECT_IN_FILE
0004F9 44F9 4D               4      LD  C,L
0004FA 44FA 44               4      LD  B,H
0004FB 44FB 2A3BF1          16      LD  HL,(_BUF_EN)
0004FE 44FE 110400          10      LD  DE,4
000501 4501 19              11      ADD HL,DE
000502 4502 111FF4          10      LD  DE,KBUF
                                
000505 4505 EB               4      EX  DE,HL
000506 4506 EDB0                    LDIR
000508 4508 EB               4      EX  DE,HL
                                
000509 4509 DD7500          19      LD  (IX+0),L
00050C 450C DD7401          19      LD  (IX+1),H
00050F 450F 223BF1          16      LD  (_BUF_EN),HL
000512 4512 C38E44          10      JP  RLOAD_A1
                                
       4515                     RLOAD_AEND:
000515 4515 2A3BF1          16      LD  HL,(_BUF_EN)
000518 4518 AF               4      XOR A
000519 4519 77               7      LD  (HL),A
00051A 451A 23               6      INC HL
00051B 451B 77               7      LD  (HL),A
00051C 451C 23               6      INC HL
00051D 451D 223BF1          16      LD  (_BUF_EN),HL
000520 4520 1833            12      JR  RLOAD_END1
                                
       4522                     ROM_LOAD:
000522 4522 CDA046          17      CALL    INIT_PARAM
000525 4525 CD6B47          17      CALL    FILE_B
000528 4528 CDAB48          17      CALL    ROM_OPEN
00052B 452B 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00052D 452D 2138F1          10      LD  HL,_BUF
000530 4530 222EF1          16      LD  (_DTA),HL
000533 4533 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000536 4536 CDCB46          17      CALL    ROM_READ
000539 4539 3A38F1          13      LD  A,(_BUF)
00053C 453C 3C               4      INC A
00053D 453D C27C44          10      JP  NZ,ROM_LOAD_ASCII
000540 4540 2A76F6          16      LD  HL,(TXTTAB)
000543 4543 222EF1          16      LD  (_DTA),HL
000546 4546 EB               4      EX  DE,HL
000547 4547 2100FF          10      LD  HL,-256
00054A 454A 39              11      ADD HL,SP
00054B 454B ED52            15      SBC HL,DE
00054D 454D CDCB46          17      CALL    ROM_READ
000550 4550 ED5B2EF1        20      LD  DE,(_DTA)
000554 4554 19              11      ADD HL,DE
       4555                     RLOAD_END1:
000555 4555 22C2F6          16      LD  (VARTAB),HL
000558 4558 22C4F6          16      LD  (ARYTAB),HL
00055B 455B 22C6F6          16      LD  (STREND),HL
                                
00055E 455E AF               4      XOR A
00055F 455F 213BF1          10      LD  HL,_BUF+3
000562 4562 77               7      LD  (HL),A
000563 4563 2B               6      DEC HL
000564 4564 77               7      LD  (HL),A
000565 4565 2B               6      DEC HL
000566 4566 77               7      LD  (HL),A
000567 4567 2B               6      DEC HL
000568 4568 3E8F             7      LD  A,08FH          ;REM
00056A 456A 77               7      LD  (HL),A
00056B 456B C9              10      RET
                                
       456C                     ERROR_DIRECT_IN_FILE:
00056C 456C 1E39             7      LD  E,57            ;Direct statement in file
00056E 456E 01                      DB  1           ;LD BC,
       456F                     ERROR_FILE_NOT_OPEN:
00056F 456F 1E3B             7      LD  E,59            ;File not OPEN
000571 4571 01                      DB  1           ;LD BC,
       4572                     ERROR_FILE_NOT_FOUND:
000572 4572 1E35             7      LD  E,53            ;File not found
       4574                     ERROR:
000574 4574 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000578 4578 DD216F40        14      LD  IX,ERRHAND
00057C 457C C31C00          10      JP  _CALSLT
                                
       457F                     ROM_BLOAD:
00057F 457F CDA046          17      CALL    INIT_PARAM
000582 4582 CD6B47          17      CALL    FILE_B
000585 4585 CDAB48          17      CALL    ROM_OPEN
000588 4588 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00058A 458A 2138F1          10      LD  HL,_BUF
00058D 458D 222EF1          16      LD  (_DTA),HL
000590 4590 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000593 4593 CDCB46          17      CALL    ROM_READ
000596 4596 3A38F1          13      LD  A,(_BUF)
000599 4599 FEFE             7      CP  0FEH
00059B 459B 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00059D 459D 210AF1          10      LD  HL,BLOAD_RET
0005A0 45A0 2202F1          16      LD  (SWC_BLOAD),HL
                                
0005A3 45A3 2A49F1          16      LD  HL,(PARAM1)
0005A6 45A6 7E               7      LD  A,(HL)
0005A7 45A7 FE2C             7      CP  ','
0005A9 45A9 2048            12      JR  NZ,RBREAD_MEM
0005AB 45AB 23               6      INC HL
0005AC 45AC 7E               7      LD  A,(HL)
0005AD 45AD CD9548          17      CALL    CAP
0005B0 45B0 32BEFC          13      LD  (RUNBNF),A
       45B3                     RBOS1:
0005B3 45B3 7E               7      LD  A,(HL)
0005B4 45B4 23               6      INC HL
0005B5 45B5 B7               4      OR  A
0005B6 45B6 282F            12      JR  Z,RBREAD_OSE
0005B8 45B8 FE3A             7      CP  ':'
0005BA 45BA 282B            12      JR  Z,RBREAD_OSE
0005BC 45BC FE2C             7      CP  ','     ;次のパラメータを探す
0005BE 45BE 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005C0 45C0 2249F1          16      LD  (PARAM1),HL
0005C3 45C3 7E               7      LD  A,(HL)
0005C4 45C4 B7               4      OR  A
0005C5 45C5 2820            12      JR  Z,RBREAD_OSE
0005C7 45C7 DD21644C        14      LD  IX,FRMEVL
0005CB 45CB FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005CF 45CF CD1C00          17      CALL    _CALSLT
0005D2 45D2 2249F1          16      LD  (PARAM1),HL
0005D5 45D5 3A63F6          13      LD  A,(VALTYP)
0005D8 45D8 FE02             7      CP  2
0005DA 45DA 200B            12      JR  NZ,RBREAD_OSE
0005DC 45DC 2A39F1          16      LD  HL,(_BUF_ST)
0005DF 45DF ED5BF8F7        20      LD  DE,(DACDAT)
0005E3 45E3 19              11      ADD HL,DE
0005E4 45E4 2239F1          16      LD  (_BUF_ST),HL
       45E7                     RBREAD_OSE:
0005E7 45E7 3ABEFC          13      LD  A,(RUNBNF)
0005EA 45EA FE53             7      CP  'S'
                                #if exists USE_RAM_BLOAD_S
                                    JR  Z,ROM_BLOAD_SCREEN
                                #else
0005EC 45EC 2005            12      JR  NZ,RBREAD_MEM
0005EE 45EE 3E01             7      LD  A,1
0005F0 45F0 3230F1          13      LD  (FLG_LDIR),A
                                #endif
       45F3                     RBREAD_MEM:
0005F3 45F3 2A39F1          16      LD  HL,(_BUF_ST)
0005F6 45F6 22BFFC          16      LD  (SAVENT),HL
0005F9 45F9 222EF1          16      LD  (_DTA),HL
0005FC 45FC 21FFFF          10      LD  HL,0FFFFH
0005FF 45FF CDCB46          17      CALL    ROM_READ
000602 4602 3ABEFC          13      LD  A,(RUNBNF)
000605 4605 FE52             7      CP  'R'
000607 4607 2006            12      JR  NZ,RBREAD1
000609 4609 2A3DF1          16      LD  HL,(_BUF_EX)
00060C 460C 2202F1          16      LD  (SWC_BLOAD),HL
       460F                     RBREAD1:
       460F                     ROM_NEXT:
00060F 460F 2A49F1          16      LD  HL,(PARAM1)
000612 4612 7E               7      LD  A,(HL)
000613 4613 2B               6      DEC HL
000614 4614 B7               4      OR  A
000615 4615 2805            12      JR  Z,RN1
000617 4617 FE3A             7      CP  ':'
000619 4619 2801            12      JR  Z,RN1
00061B 461B 23               6      INC HL
       461C                     RN1:
00061C 461C 5D               4      LD  E,L
00061D 461D 54               4      LD  D,H
                                
00061E 461E CD6B48          17      CALL    SEARCH_END
000621 4621 B7               4      OR  A
000622 4622 2815            12      JR  Z,REM
                                                    ;マルチステートメントの処理
000624 4624 7E               7      LD  A,(HL)
                                
000625 4625 FEB5             7      CP  0B5H            ;LOAD
000627 4627 CA2245          10      JP  Z,ROM_LOAD
00062A 462A FE8A             7      CP  08AH            ;RUN
00062C 462C 280F            12      JR  Z,ROM_RUN
00062E 462E FEB7             7      CP  0B7H            ;FILES
000630 4630 2818            12      JR  Z,ROM_FILES
000632 4632 3E28             7      LD  A,028H          ;JR Z,
000634 4634 3208F1          13      LD  (SWC_BLOAD_M),A
000637 4637 7E               7      LD  A,(HL)
000638 4638 C9              10      RET
                                
       4639                     REM:
000639 4639 EB               4      EX  DE,HL
00063A 463A 3E8F             7      LD  A,08FH          ;REM
00063C 463C C9              10      RET
                                
                                #if exists USE_RAM_BLOAD_S
                                ROM_BLOAD_SCREEN:
                                    LD  HL,(STREND)
                                    LD  (_DTA),HL
                                    EX  DE,HL
                                    LD  HL,-512
                                    ADD HL,SP
                                    XOR A
                                    SBC HL,DE
                                    JR  NC,RBS0
                                    LD  HL,BUF
                                    LD  (_DTA),HL
                                    LD  L,A ;0
                                    LD  H,A ;0
                                RBS0:
                                    INC H
                                    LD  (_BUF_EN),HL
                                RBS1:
                                    LD  HL,(_BUF_EN)
                                    CALL    ROM_READ
                                    LD  A,H
                                    OR  L
                                    JR  Z,ROM_NEXT
                                
                                    PUSH    HL
                                    LD  C,L
                                    LD  B,H
                                    LD  HL,(_DTA)   ;転送元
                                    LD  DE,(_BUF_ST)    ;転送先
                                
                                    LD  IY,(EXPTBL-1)   ;メインROMスロット
                                    LD  IX,LDIRVM
                                    CALL    _CALSLT
                                
                                    LD  HL,(_BUF_ST)
                                    POP DE
                                    ADD HL,DE
                                    LD  (_BUF_ST),HL
                                    JR  RBS1
                                #endif
                                
       463D                     ROM_RUN:
00063D 463D 23               6      INC HL
00063E 463E 7E               7      LD  A,(HL)
00063F 463F 2B               6      DEC HL
000640 4640 B7               4      OR  A
000641 4641 2803            12      JR  Z,ROM_RUN1
000643 4643 CD2245          17      CALL    ROM_LOAD
       4646                     ROM_RUN1:
000646 4646 3E8A             7      LD  A,08AH          ;RUN
000648 4648 77               7      LD  (HL),A
000649 4649 C9              10      RET
                                
       464A                     ROM_FILES:
00064A 464A CDA046          17      CALL    INIT_PARAM
00064D 464D CD6B47          17      CALL    FILE_B
000650 4650 CDCA4C          17      CALL    GET_DISK_BANK_FDRV
000653 4653 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000656 4656 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000659 4659 3A4CF1          13      LD  A,(FNAME)
00065C 465C FE21             7      CP  021H
00065E 465E 3005            12      JR  NC,RFILES0
000660 4660 060B             7      LD  B,11
000662 4662 CDFF47          17      CALL    FILE10
       4665                     RFILES0:
000665 4665 CDF34A          17      CALL    GET_DIR_DAT
       4668                     RFILES1:
000668 4668 CDC748          17      CALL    FILESE
00066B 466B 302E            12      JR  NC,RFILES_NOT_MATCH
       466D                     RFILES_DISP:
00066D 466D E5              11      PUSH    HL
00066E 466E 0608             7      LD  B,8
000670 4670 CD8943          17      CALL    MSN
000673 4673 3E2E             7      LD  A,'.'
000675 4675 CD274D          17      CALL    MSG_A
000678 4678 0603             7      LD  B,3
00067A 467A CD8943          17      CALL    MSN
00067D 467D 3ADDF3          13      LD  A,(CSRX)
000680 4680 47               4      LD  B,A
000681 4681 3AB0F3          13      LD  A,(LINLEN)
000684 4684 90               4      SUB B
000685 4685 FE0C             7      CP  12
000687 4687 3009            12      JR  NC,RFILES2
000689 4689 3E0D             7      LD  A,00DH      ;改行
00068B 468B CD274D          17      CALL    MSG_A
00068E 468E 3E0A             7      LD  A,00AH
000690 4690 1802            12      JR  RFILES3
       4692                     RFILES2:
000692 4692 3E20             7      LD  A,020H
       4694                     RFILES3:
000694 4694 CD274D          17      CALL    MSG_A
000697 4697 E1              10      POP HL
000698 4698 CDE348          17      CALL    FNEXT
       469B                     RFILES_NOT_MATCH:
00069B 469B 20CB            12      JR  NZ,RFILES1
00069D 469D C30F46          10      JP  ROM_NEXT
                                
       46A0                     INIT_PARAM:
0006A0 46A0 2247F1          16      LD  (PARAM0),HL
0006A3 46A3 2249F1          16      LD  (PARAM1),HL
0006A6 46A6 EB               4      EX  DE,HL
0006A7 46A7 AF               4      XOR A
                                #if exists USE_RAM_BLOAD_S
                                #else
0006A8 46A8 3230F1          13      LD  (FLG_LDIR),A
                                #endif
0006AB 46AB 32BEFC          13      LD  (RUNBNF),A
0006AE 46AE 3263F6          13      LD  (VALTYP),A
0006B1 46B1 13               6      INC DE
0006B2 46B2 CD3B48          17      CALL    SPCUT
0006B5 46B5 1A               7      LD  A,(DE)
0006B6 46B6 B7               4      OR  A
0006B7 46B7 C8              11      RET Z
0006B8 46B8 FE3A             7      CP  ':'
0006BA 46BA C8              11      RET Z
0006BB 46BB EB               4      EX  DE,HL
0006BC 46BC DD21644C        14      LD  IX,FRMEVL
0006C0 46C0 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006C4 46C4 CD1C00          17      CALL    _CALSLT
0006C7 46C7 2249F1          16      LD  (PARAM1),HL
0006CA 46CA C9              10      RET
                                
       46CB                     ROM_READ:
0006CB 46CB E5              11      PUSH    HL
0006CC 46CC D5              11      PUSH    DE
0006CD 46CD C5              11      PUSH    BC
0006CE 46CE FDE5            15      PUSH    IY
0006D0 46D0 2245F1          16      LD  (LEFTX),HL
0006D3 46D3 2A2EF1          16      LD  HL,(_DTA)
0006D6 46D6 223FF1          16      LD  (DTAX),HL
0006D9 46D9 2A45F1          16      LD  HL,(LEFTX)
                                
0006DC 46DC CD2649          17      CALL    RBX1
0006DF 46DF 3870            12      JR  C,RBRERR1
0006E1 46E1 79               4      LD  A,C
0006E2 46E2 EB               4      EX  DE,HL
0006E3 46E3 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0006E5 46E5 19              11      ADD HL,DE
0006E6 46E6 DE00             7      SBC A,000H
0006E8 46E8 3801            12      JR  C,RBR1
0006EA 46EA EB               4      EX  DE,HL
       46EB                     RBR1:
0006EB 46EB 9F               4      SBC A,A
0006EC 46EC E601             7      AND 1
0006EE 46EE 321EF1          13      LD  (_RESULT),A
0006F1 46F1 7C               4      LD  A,H
0006F2 46F2 B5               4      OR  L
0006F3 46F3 CA4747          10      JP  Z,RBREND0
                                
0006F6 46F6 222AF1          16      LD  (_LEFT),HL  ;Read record byte
0006F9 46F9 2245F1          16      LD  (LEFTX),HL
                                
0006FC 46FC CD4C49          17      CALL    RBX2
0006FF 46FF 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000701 4701 CD5F49          17      CALL    RBXA
000704 4704 DA5D47          10      JP  C,RBRERR
000707 4707 C5              11      PUSH    BC
000708 4708 CD2444          17      CALL    ROM_LDIR
00070B 470B ED533FF1        20      LD  (DTAX),DE
00070F 470F 2A45F1          16      LD  HL,(LEFTX)
000712 4712 D1              10      POP DE
000713 4713 A7               4      AND A
000714 4714 ED52            15      SBC HL,DE
000716 4716 2245F1          16      LD  (LEFTX),HL
000719 4719 2829            12      JR  Z,RBREND
                                
       471B                     RBRB:
00071B 471B CD9B49          17      CALL    RBXB
00071E 471E 2818            12      JR  Z,RBRC
       4720                     RBRB1:
000720 4720 C5              11      PUSH    BC
000721 4721 D5              11      PUSH    DE
000722 4722 CD434A          17      CALL    CLUST
000725 4725 EB               4      EX  DE,HL
000726 4726 ED4B20F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
00072A 472A CD2444          17      CALL    ROM_LDIR
00072D 472D EB               4      EX  DE,HL
00072E 472E D1              10      POP DE
00072F 472F C1              10      POP BC
000730 4730 CD204A          17      CALL    GNCL
000733 4733 DA5D47          10      JP  C,RBRERR
000736 4736 10E8            13      DJNZ    RBRB1
       4738                     RBRC:
000738 4738 CDB349          17      CALL    RBXC
00073B 473B 2807            12      JR  Z,RBREND
                                
00073D 473D CD434A          17      CALL    CLUST
000740 4740 EB               4      EX  DE,HL
000741 4741 CD2444          17      CALL    ROM_LDIR
       4744                     RBREND:
000744 4744 CDBF49          17      CALL    RBXEND
       4747                     RBREND0:
000747 4747 FDE1            14      POP IY
000749 4749 C1              10      POP BC
00074A 474A D1              10      POP DE
00074B 474B F1              10      POP AF  ;(HL)
00074C 474C AF               4      XOR A
00074D 474D 3A1EF1          13      LD  A,(_RESULT)
000750 4750 C9              10      RET
                                
       4751                     RBRERR1:
000751 4751 3E01             7      LD  A,001H
       4753                     RBRERR2:
000753 4753 FDE1            14      POP IY
000755 4755 C1              10      POP BC
000756 4756 D1              10      POP DE
000757 4757 E1              10      POP HL
000758 4758 37               4      SCF
000759 4759 210000          10      LD  HL,0
00075C 475C C9              10      RET
       475D                     RBRERR:
00075D 475D 3EFF             7      LD  A,0FFH
00075F 475F 18F2            12      JR  RBRERR2
                                
       4761                     FILE_DD:
000761 4761 3E                      DB  03EH
000762 4762 C9              10      RET
000763 4763 3208F1          13      LD  (SWC_BLOAD_M),A
000766 4766 2A47F1          16      LD  HL,(PARAM0)
000769 4769 7E               7      LD  A,(HL)
00076A 476A C9              10      RET
       476B                     FILE_B:
00076B 476B AF               4      XOR A
00076C 476C 324BF1          13      LD  (FDRV),A
00076F 476F 1E00             7      LD  E,0
000771 4771 3A63F6          13      LD  A,(VALTYP)
000774 4774 FE03             7      CP  3       ;string
000776 4776 2044            12      JR  NZ,FILED
                                
000778 4778 DD21D067        14      LD  IX,FRESTR
00077C 477C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000780 4780 CD1C00          17      CALL    _CALSLT
000783 4783 E5              11      PUSH    HL
000784 4784 DDE1            14      POP IX
                                
000786 4786 DD5E00          19      LD  E,(IX+0)
000789 4789 DD7E01          19      LD  A,(IX+1)
00078C 478C DD5602          19      LD  D,(IX+2)
00078F 478F DD62             9      LD  IXH,D
000791 4791 DD6F             9      LD  IXL,A
000793 4793 7B               4      LD  A,E
000794 4794 FE04             7      CP  4
000796 4796 3808            12      JR  C,FILEB1
000798 4798 DD7E03          19      LD  A,(IX+3)
00079B 479B FE3A             7      CP  ':'
00079D 479D 28C2            12      JR  Z,FILE_DD
00079F 479F 7B               4      LD  A,E
       47A0                     FILEB1:
0007A0 47A0 FE02             7      CP  2
0007A2 47A2 3818            12      JR  C,FILED
0007A4 47A4 DD7E01          19      LD  A,(IX+1)
0007A7 47A7 FE3A             7      CP  ':'
0007A9 47A9 2011            12      JR  NZ,DEVI1
0007AB 47AB DD7E00          19      LD  A,(IX+0)        ;DRIVE
0007AE 47AE CD9548          17      CALL    CAP
0007B1 47B1 D640             7      SUB '@'
0007B3 47B3 DD23            10      INC IX
0007B5 47B5 DD23            10      INC IX
0007B7 47B7 1D               4      DEC E
0007B8 47B8 1D               4      DEC E
0007B9 47B9 324BF1          13      LD  (FDRV),A
       47BC                     DEVI1:
                                
       47BC                     FILED:
0007BC 47BC CD0348          17      CALL    FILEI
0007BF 47BF 214CF1          10      LD  HL,FNAME
                                
0007C2 47C2 0608             7      LD  B,8
       47C4                     FILE2:
0007C4 47C4 CD1048          17      CALL    CCHKF
0007C7 47C7 C8              11      RET Z
0007C8 47C8 FE2A             7      CP  '*'
0007CA 47CA 282E            12      JR  Z,FILE9
0007CC 47CC FE2E             7      CP  '.'
0007CE 47CE 280C            12      JR  Z,FILE4
0007D0 47D0 77               7      LD  (HL),A
0007D1 47D1 23               6      INC HL
0007D2 47D2 10F0            13      DJNZ    FILE2
                                
       47D4                     FILE3:
0007D4 47D4 CD1048          17      CALL    CCHKF
0007D7 47D7 C8              11      RET Z
0007D8 47D8 FE2E             7      CP  '.'
0007DA 47DA 20F8            12      JR  NZ,FILE3
                                
       47DC                     FILE4:
0007DC 47DC 2154F1          10      LD  HL,FNAME+8
0007DF 47DF 0603             7      LD  B,3
                                
       47E1                     FILE4L:
0007E1 47E1 CD1048          17      CALL    CCHKF
0007E4 47E4 C8              11      RET Z
0007E5 47E5 FE2E             7      CP  '.'
0007E7 47E7 2008            12      JR  NZ,FILE12
0007E9 47E9 324CF1          13      LD  (FNAME),A   ;Parent directory(..)
0007EC 47EC 324DF1          13      LD  (FNAME+1),A
0007EF 47EF 3E20             7      LD  A,020H
       47F1                     FILE12:
0007F1 47F1 FE2A             7      CP  '*'
0007F3 47F3 280A            12      JR  Z,FILE10
0007F5 47F5 77               7      LD  (HL),A
0007F6 47F6 23               6      INC HL
0007F7 47F7 10E8            13      DJNZ    FILE4L
0007F9 47F9 C9              10      RET
                                
       47FA                     FILE9:              ;名前の*処理、名前の残りを?で埋める
0007FA 47FA CDFF47          17      CALL    FILE10
0007FD 47FD 18D5            12      JR  FILE3
                                
       47FF                     FILE10:
0007FF 47FF 3E3F             7      LD  A,'?'
000801 4801 1808            12      JR  FILL_MEMORY
       4803                     FILEI:              ;名前＋拡張子をスペースで初期化
000803 4803 3E20             7      LD  A,020H
000805 4805 01000B          10      LD  BC,11*256   ;C=0にしておく
000808 4808 214CF1          10      LD  HL,FNAME
       480B                     FILL_MEMORY:            ;HLからBバイトAで埋める
00080B 480B 77               7      LD  (HL),A
00080C 480C 23               6      INC HL
00080D 480D 10FC            13      DJNZ    FILL_MEMORY
00080F 480F C9              10      RET
                                
       4810                     CCHKF:
000810 4810 7B               4      LD  A,E
000811 4811 B7               4      OR  A
000812 4812 C8              11      RET Z
000813 4813 DD7E00          19      LD  A,(IX+0)
000816 4816 CD1D48          17      CALL    CCHK2
000819 4819 C8              11      RET Z
00081A 481A C38048          10      JP  FKAN
                                
       481D                     CCHK2:
00081D 481D 0C               4      INC C
00081E 481E 0D               4      DEC C
00081F 481F C0              11      RET NZ
       4820                     CCHK3:              ;ZF=1 で使えない文字
000820 4820 FE2B             7      CP  '+'
000822 4822 C8              11      RET Z
000823 4823 FE2C             7      CP  ','
000825 4825 C8              11      RET Z
000826 4826 FE2F             7      CP  '/'
000828 4828 C8              11      RET Z
000829 4829 FE3A             7      CP  ':'
00082B 482B C8              11      RET Z
00082C 482C FE3B             7      CP  ';'
00082E 482E C8              11      RET Z
00082F 482F FE3D             7      CP  '='
000831 4831 C8              11      RET Z
000832 4832 FE5C             7      CP  05CH    ;\
000834 4834 C8              11      RET Z
000835 4835 FE1F             7      CP  01FH
000837 4837 D0              11      RET NC
000838 4838 BF               4      CP  A       ;Z=1
000839 4839 C9              10      RET
                                
       483A                     SS1:
00083A 483A 13               6      INC DE
       483B                     SPCUT:              ;スペースをカット
00083B 483B 1A               7      LD  A,(DE)
00083C 483C FE20             7      CP  020H
00083E 483E 28FA            12      JR  Z,SS1
000840 4840 C9              10      RET
                                
       4841                     SCREOF1:
000841 4841 13               6      INC DE
       4842                     SPCUTEX:            ;スペース改行などをカット
000842 4842 1A               7      LD  A,(DE)
000843 4843 FE20             7      CP  020H
000845 4845 28FA            12      JR  Z,SCREOF1
000847 4847 FE0D             7      CP  00DH
000849 4849 28F6            12      JR  Z,SCREOF1
00084B 484B FE0A             7      CP  00AH
00084D 484D 28F2            12      JR  Z,SCREOF1
00084F 484F FE1A             7      CP  01AH
000851 4851 28EE            12      JR  Z,SCREOF1
000853 4853 C9              10      RET
                                
       4854                     GETNUM:
000854 4854 210000          10      LD  HL,0
       4857                     GETNUM1:
000857 4857 1A               7      LD  A,(DE)
000858 4858 13               6      INC DE
000859 4859 D630             7      SUB '0'
00085B 485B D8              11      RET C
00085C 485C FE0A             7      CP  10
00085E 485E D0              11      RET NC
00085F 485F 4D               4      LD  C,L
000860 4860 44               4      LD  B,H
000861 4861 29              11      ADD HL,HL   ;*2
000862 4862 29              11      ADD HL,HL   ;*4
000863 4863 09              11      ADD HL,BC   ;*5
000864 4864 29              11      ADD HL,HL   ;*10
000865 4865 4F               4      LD  C,A
000866 4866 0600             7      LD  B,0
000868 4868 09              11      ADD HL,BC
000869 4869 18EC            12      JR  GETNUM1
                                
       486B                     SEARCH_END:
00086B 486B 7E               7      LD  A,(HL)
       486C                     SEARCH_END1:
00086C 486C 23               6      INC HL
00086D 486D B7               4      OR  A
00086E 486E C8              11      RET Z
00086F 486F FE3A             7      CP  ':'
000871 4871 20F8            12      JR  NZ,SEARCH_END
000873 4873 7E               7      LD  A,(HL)
000874 4874 FE3A             7      CP  ':'
000876 4876 28F4            12      JR  Z,SEARCH_END1
000878 4878 C9              10      RET
                                
       4879                     FKANC:
000879 4879 CB41             8      BIT 0,C
00087B 487B CC9E48          17      CALL    Z,CAP2
00087E 487E 1803            12      JR  FKANX
       4880                     FKAN:           ;漢字チェック
000880 4880 DD23            10      INC IX
000882 4882 1D               4      DEC E
       4883                     FKANX:
000883 4883 CB41             8      BIT 0,C
000885 4885 CB81             8      RES 0,C
000887 4887 C0              11      RET NZ
000888 4888 FE80             7      CP  080H
00088A 488A D8              11      RET C
00088B 488B FEA0             7      CP  0A0H
00088D 488D 3803            12      JR  C,FKAN1
00088F 488F FEE0             7      CP  0E0H
000891 4891 D8              11      RET C
       4892                     FKAN1:
000892 4892 0C               4      INC C
000893 4893 A7               4      AND A
000894 4894 C9              10      RET
                                
       4895                     CAP:
000895 4895 FE61             7      CP  'a'
000897 4897 D8              11      RET C
000898 4898 FE7B             7      CP  'z'+1
00089A 489A D0              11      RET NC
00089B 489B D620             7      SUB 020H
00089D 489D C9              10      RET
       489E                     CAP2:
00089E 489E CD9548          17      CALL    CAP
       48A1                     CAP3:               ;
0008A1 48A1 FE05             7      CP  5
0008A3 48A3 2803            12      JR  Z,CAP4
0008A5 48A5 FE21             7      CP  021H
0008A7 48A7 C9              10      RET
       48A8                     CAP4:
0008A8 48A8 3EE5             7      LD  A,0E5H
0008AA 48AA C9              10      RET
                                
       48AB                     ROM_OPEN:
0008AB 48AB CDCA4C          17      CALL    GET_DISK_BANK_FDRV
                                
0008AE 48AE CDF34A          17      CALL    GET_DIR_DAT
0008B1 48B1 D5              11      PUSH    DE
0008B2 48B2 CDC748          17      CALL    FILESE
0008B5 48B5 D1              10      POP DE
0008B6 48B6 3F               4      CCF
0008B7 48B7 D8              11      RET C
0008B8 48B8 2243F1          16      LD  (FCBX),HL
0008BB 48BB E5              11      PUSH    HL
0008BC 48BC 210000          10      LD  HL,0
0008BF 48BF 2224F1          16      LD  (RR_LOW),HL
0008C2 48C2 2226F1          16      LD  (RR_HIGH),HL
0008C5 48C5 E1              10      POP HL
0008C6 48C6 C9              10      RET
                                
       48C7                     FILESE:
0008C7 48C7 7E               7      LD  A,(HL)
0008C8 48C8 B7               4      OR  A
0008C9 48C9 C8              11      RET Z       ;END:ZF=1 CF=0
0008CA 48CA FEE5             7      CP  0E5H
0008CC 48CC 280D            12      JR  Z,FILESE1
0008CE 48CE 114CF1          10      LD  DE,FNAME
0008D1 48D1 E5              11      PUSH    HL
0008D2 48D2 CD0049          17      CALL    CPFILE
0008D5 48D5 CC2149          17      CALL    Z,CPFILE2
0008D8 48D8 E1              10      POP HL
0008D9 48D9 37               4      SCF
0008DA 48DA C8              11      RET Z       ;!!!:(ZF=1) CF=1
       48DB                     FILESE1:
0008DB 48DB CDE348          17      CALL    FNEXT
0008DE 48DE 20E7            12      JR  NZ,FILESE
       48E0                     ZF0_CF0_AFF_RET:
0008E0 48E0 F6FF             7      OR  0FFH        ;ZF=0 CF=0
0008E2 48E2 C9              10      RET
                                
       48E3                     FNEXT:
0008E3 48E3 112000          10      LD  DE,020H
0008E6 48E6 19              11      ADD HL,DE
0008E7 48E7 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       48E8                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
0008E8 48E8 F5              11      PUSH    AF
0008E9 48E9 CB7C             8      BIT 7,H
0008EB 48EB 2811            12      JR  Z,CHECK_DIR_PAGE1
0008ED 48ED 7C               4      LD  A,H
0008EE 48EE D620             7      SUB 020H
0008F0 48F0 67               4      LD  H,A
0008F1 48F1 3A1FF1          13      LD  A,(_BANK)
0008F4 48F4 3C               4      INC A
0008F5 48F5 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0008F8 48F8 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0008FB 48FB 321FF1          13      LD  (_BANK),A
       48FE                     CHECK_DIR_PAGE1:
0008FE 48FE F1              10      POP AF
                                #endif
0008FF 48FF C9              10      RET
                                
       4900                     CPFILE:
000900 4900 C5              11      PUSH    BC
000901 4901 01000B          10      LD  BC,00B00H
       4904                     CPSTR1:
000904 4904 1A               7      LD  A,(DE)
000905 4905 FE3F             7      CP  '?'     ;Wild card
000907 4907 2812            12      JR  Z,CPSTR2
000909 4909 7E               7      LD  A,(HL)
00090A 490A CD7948          17      CALL    FKANC
00090D 490D E5              11      PUSH    HL
00090E 490E 67               4      LD  H,A
00090F 490F 1A               7      LD  A,(DE)
000910 4910 CB01             4      RLC C
000912 4912 CD7948          17      CALL    FKANC
000915 4915 CB09             4      RRC C
000917 4917 BC               4      CP  H       ;CP (HL),(DE)
000918 4918 E1              10      POP HL
000919 4919 2004            12      JR  NZ,CPSTR3
       491B                     CPSTR2:
00091B 491B 13               6      INC DE
00091C 491C 23               6      INC HL
00091D 491D 10E5            13      DJNZ    CPSTR1
       491F                     CPSTR3:
00091F 491F C1              10      POP BC
000920 4920 C9              10      RET
                                
       4921                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
000921 4921 3EE1             7      LD  A,0E1H
000923 4923 2F               4      CPL
000924 4924 A6               7      AND (HL)
000925 4925 C9              10      RET
                                
       4926                     RBX1:
000926 4926 E5              11      PUSH    HL      ;Record byte
                                
000927 4927 ED5B24F1        20      LD  DE,(RR_LOW) ;CDE=Random record
00092B 492B 3A27F1          13      LD  A,(RR_HIGH+1)
00092E 492E 4F               4      LD  C,A
                                
00092F 492F CDCA4C          17      CALL    GET_DISK_BANK_FDRV
                                
000932 4932 FD2A43F1        20      LD  IY,(FCBX)
000936 4936 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000939 4939 FD661D          19      LD  H,(IY+01DH)
00093C 493C FD7E1E          19      LD  A,(IY+01EH)
                                
00093F 493F A7               4      AND A
000940 4940 ED52            15      SBC HL,DE
000942 4942 99               4      SBC A,C
000943 4943 D1              10      POP DE
                                
000944 4944 D8              11      RET C
000945 4945 4F               4      LD  C,A
000946 4946 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000947 4947 B2               4      OR  D
000948 4948 B3               4      OR  E
000949 4949 C0              11      RET NZ
00094A 494A 37               4      SCF
00094B 494B C9              10      RET
                                
       494C                     RBX2:
00094C 494C ED4B25F1        20      LD  BC,(RR_LOW+1)
000950 4950 CDD449          17      CALL    RWXR
000953 4953 3A21F1          13      LD  A,(CLSZ_H)
000956 4956 3D               4      DEC A
000957 4957 E5              11      PUSH    HL
000958 4958 2A24F1          16      LD  HL,(RR_LOW)
00095B 495B A4               4      AND H
00095C 495C B5               4      OR  L
00095D 495D E1              10      POP HL
00095E 495E C9              10      RET
                                
       495F                     RBXA:
00095F 495F D5              11      PUSH    DE
000960 4960 CD434A          17      CALL    CLUST
000963 4963 ED532CF1        20      LD  (_DTPS),DE
000967 4967 D1              10      POP DE
000968 4968 CD204A          17      CALL    GNCL
00096B 496B D8              11      RET C
00096C 496C ED5328F1        20      LD  (_CLPS),DE
                                
000970 4970 ED4B24F1        20      LD  BC,(RR_LOW)
000974 4974 2A20F1          16      LD  HL,(CLSZ)
000977 4977 7C               4      LD  A,H
000978 4978 3D               4      DEC A
000979 4979 A0               4      AND B
00097A 497A 47               4      LD  B,A
00097B 497B ED42            15      SBC HL,BC       ;remaining cluster
                                
00097D 497D ED5B45F1        20      LD  DE,(LEFTX)
000981 4981 ED52            15      SBC HL,DE       ;CP HL,DE
000983 4983 19              11      ADD HL,DE
000984 4984 3801            12      JR  C,RBXA1
000986 4986 EB               4      EX  DE,HL
       4987                     RBXA1:
000987 4987 3A1FF1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
00098A 498A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00098D 498D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000990 4990 E5              11      PUSH    HL
000991 4991 2A2CF1          16      LD  HL,(_DTPS)
000994 4994 09              11      ADD HL,BC
000995 4995 ED5B3FF1        20      LD  DE,(DTAX)
000999 4999 C1              10      POP BC
00099A 499A C9              10      RET
                                
       499B                     RBXB:
00099B 499B 2A3FF1          16      LD  HL,(DTAX)
00099E 499E ED5B28F1        20      LD  DE,(_CLPS)
0009A2 49A2 3A46F1          13      LD  A,(LEFTX+1)
0009A5 49A5 47               4      LD  B,A
0009A6 49A6 3A21F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       49A9                     RBXB1:
0009A9 49A9 1F               4      RRA     ;->CF
0009AA 49AA 3804            12      JR  C,RBXB2
0009AC 49AC CB38             8      SRL B   ;B=B/2
0009AE 49AE 18F9            12      JR  RBXB1
       49B0                     RBXB2:
0009B0 49B0 78               4      LD  A,B
0009B1 49B1 B7               4      OR  A
0009B2 49B2 C9              10      RET
                                
       49B3                     RBXC:
0009B3 49B3 ED4B45F1        20      LD  BC,(LEFTX)
0009B7 49B7 3A21F1          13      LD  A,(CLSZ_H)
0009BA 49BA 3D               4      DEC A
0009BB 49BB A0               4      AND B
0009BC 49BC 47               4      LD  B,A
0009BD 49BD B1               4      OR  C
0009BE 49BE C9              10      RET
                                
       49BF                     RBXEND:
0009BF 49BF ED5B2AF1        20      LD  DE,(_LEFT)
0009C3 49C3 2A24F1          16      LD  HL,(RR_LOW)
0009C6 49C6 3A27F1          13      LD  A,(RR_HIGH+1)
0009C9 49C9 19              11      ADD HL,DE
0009CA 49CA CE00             7      ADC A,0
0009CC 49CC 2224F1          16      LD  (RR_LOW),HL
0009CF 49CF 3227F1          13      LD  (RR_HIGH+1),A
0009D2 49D2 EB               4      EX  DE,HL       ;HL=Read byte
0009D3 49D3 C9              10      RET 
                                
       49D4                     RWXR:
0009D4 49D4 3A21F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       49D7                     L_RWX:
0009D7 49D7 1F               4      RRA     ;->CF
0009D8 49D8 3806            12      JR  C,E_RWX
0009DA 49DA CB38             8      SRL B   ;BC=BC/2
0009DC 49DC CB19             8      RR  C   ;
0009DE 49DE 18F7            12      JR  L_RWX
       49E0                     E_RWX:
0009E0 49E0 CDCA4C          17      CALL    GET_DISK_BANK_FDRV
                                
0009E3 49E3 FD2A43F1        20      LD  IY,(FCBX)
0009E7 49E7 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
0009EA 49EA FD561B          19      LD  D,(IY+01BH)
       49ED                     RWX1:
0009ED 49ED ED5328F1        20      LD  (_CLPS),DE
0009F1 49F1 7A               4      LD  A,D
0009F2 49F2 B3               4      OR  E
0009F3 49F3 37               4      SCF
0009F4 49F4 C8              11      RET Z
                                
0009F5 49F5 78               4      LD  A,B
0009F6 49F6 B1               4      OR  C
0009F7 49F7 C8              11      RET Z
                                
0009F8 49F8 CD204A          17      CALL    GNCL
0009FB 49FB D8              11      RET C
0009FC 49FC 0B               6      DEC BC
0009FD 49FD CD8C4A          17      CALL    ENDCL
000A00 4A00 38EB            12      JR  C,RWX1
000A02 4A02 37               4      SCF
000A03 4A03 C9              10      RET
                                
       4A04                     NCL3:
000A04 4A04 CDCA4C          17      CALL    GET_DISK_BANK_FDRV
000A07 4A07 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000A0A 4A0A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000A0D 4A0D 6B               4      LD  L,E
000A0E 4A0E 62               4      LD  H,D
000A0F 4A0F CB3C             8      SRL H
000A11 4A11 CB1D             8      RR  L
000A13 4A13 1F               4      RRA
000A14 4A14 19              11      ADD HL,DE
000A15 4A15 010060          10      LD  BC,BANK1_ADR
000A18 4A18 09              11      ADD HL,BC
000A19 4A19 ED4B22F1        20      LD  BC,(SECSZ)
000A1D 4A1D 09              11      ADD HL,BC
000A1E 4A1E 17               4      RLA
000A1F 4A1F C9              10      RET
                                
       4A20                     GNCL:
000A20 4A20 7A               4      LD  A,D
000A21 4A21 B3               4      OR  E
000A22 4A22 37               4      SCF
000A23 4A23 C8              11      RET Z
000A24 4A24 C5              11      PUSH    BC
000A25 4A25 E5              11      PUSH    HL
000A26 4A26 CD044A          17      CALL    NCL3
000A29 4A29 3809            12      JR  C,GNC1
000A2B 4A2B 5E               7      LD  E,(HL)
000A2C 4A2C 23               6      INC HL
000A2D 4A2D 7E               7      LD  A,(HL)
000A2E 4A2E E60F             7      AND 00FH
000A30 4A30 57               4      LD  D,A
000A31 4A31 E1              10      POP HL
000A32 4A32 C1              10      POP BC
000A33 4A33 C9              10      RET
       4A34                     GNC1:
000A34 4A34 7E               7      LD  A,(HL)
000A35 4A35 23               6      INC HL
000A36 4A36 56               7      LD  D,(HL)
000A37 4A37 0604             7      LD  B,4
       4A39                     GNC1L:
000A39 4A39 CB3A             8      SRL D
000A3B 4A3B 1F               4      RRA
000A3C 4A3C 10FB            13      DJNZ    GNC1L
                                
000A3E 4A3E 5F               4      LD  E,A
000A3F 4A3F E1              10      POP HL
000A40 4A40 C1              10      POP BC
000A41 4A41 A7               4      AND A
000A42 4A42 C9              10      RET
                                
       4A43                     CLUST:
000A43 4A43 EB               4      EX  DE,HL
000A44 4A44 C5              11      PUSH    BC
000A45 4A45 3A21F1          13      LD  A,(CLSZ_H)
000A48 4A48 CDF64C          17      CALL    MUL_AHL
                                
000A4B 4A4B CD034B          17      CALL    GET_DIR_POS
000A4E 4A4E 4F               4      LD  C,A
000A4F 4A4F 0600             7      LD  B,0
000A51 4A51 09              11      ADD HL,BC
                                
000A52 4A52 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000A55 4A55 0F               4      RRCA
000A56 4A56 0F               4      RRCA
000A57 4A57 0F               4      RRCA
000A58 4A58 0F               4      RRCA
000A59 4A59 4F               4      LD  C,A
                                
000A5A 4A5A 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000A5D 4A5D FE02             7      CP  2
000A5F 4A5F 280C            12      JR  Z,CLUST1
000A61 4A61 CB01             4      RLC C
000A63 4A63 0D               4      DEC C
000A64 4A64 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000A67 4A67 FE02             7      CP  2
000A69 4A69 2002            12      JR  NZ,CLUST1
000A6B 4A6B 0D               4      DEC C
000A6C 4A6C 0D               4      DEC C
       4A6D                     CLUST1:
000A6D 4A6D 0D               4      DEC C
000A6E 4A6E 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                #else
000A6F 4A6F E5              11      PUSH    HL
000A70 4A70 29              11      ADD HL,HL   ;*2
000A71 4A71 29              11      ADD HL,HL   ;*4
000A72 4A72 29              11      ADD HL,HL   ;*8
000A73 4A73 CDCA4C          17      CALL    GET_DISK_BANK_FDRV
000A76 4A76 84               4      ADD A,H
000A77 4A77 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000A7A 4A7A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000A7D 4A7D 321FF1          13      LD  (_BANK),A
000A80 4A80 E1              10      POP HL
000A81 4A81 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000A83 4A83 A5               4      AND L
                                #endif
000A84 4A84 C660             7      ADD A,high BANK1_ADR
000A86 4A86 67               4      LD  H,A
000A87 4A87 2E00             7      LD  L,0
000A89 4A89 EB               4      EX  DE,HL
000A8A 4A8A C1              10      POP BC
000A8B 4A8B C9              10      RET
                                
       4A8C                     ENDCL:
000A8C 4A8C 7A               4      LD  A,D ;END CLUSTER
000A8D 4A8D FE0F             7      CP  00FH    ;FAT12の最大値
000A8F 4A8F C0              11      RET NZ
000A90 4A90 7B               4      LD  A,E
000A91 4A91 FEF7             7      CP  0F7H
000A93 4A93 C9              10      RET
                                
       4A94                     RB_READ:
000A94 4A94 AF               4      XOR A   ;HLA = HL*128
000A95 4A95 CB3C             8      SRL H
000A97 4A97 CB1D             8      RR  L
000A99 4A99 1F               4      RRA
000A9A 4A9A 3224F1          13      LD  (RR_LOW),A
000A9D 4A9D 2225F1          16      LD  (RR_MID),HL
000AA0 4AA0 218000          10      LD  HL,128
                                
000AA3 4AA3 CDCB46          17      CALL    ROM_READ
000AA6 4AA6 C9              10      RET
                                
       4AA7                     GETSEQ:
000AA7 4AA7 FD6E20          19      LD  L,(IY+32)
000AAA 4AAA FD660C          19      LD  H,(IY+12)
                                
000AAD 4AAD CB25             8      SLA L
                                
000AAF 4AAF CB3C             8      SRL H
000AB1 4AB1 CB1D             8      RR  L
000AB3 4AB3 C9              10      RET
                                
       4AB4                     SETSEQ:
000AB4 4AB4 F5              11      PUSH    AF
000AB5 4AB5 3A24F1          13      LD  A,(RR_LOW)
000AB8 4AB8 2A25F1          16      LD  HL,(RR_MID)
                                
000ABB 4ABB CDD24A          17      CALL    SSQ1
                                
000ABE 4ABE 29              11      ADD HL,HL
000ABF 4ABF CB3D             8      SRL L
000AC1 4AC1 FD7520          19      LD  (IY+32),L
000AC4 4AC4 FD740C          19      LD  (IY+12),H
000AC7 4AC7 F1              10      POP AF
000AC8 4AC8 C9              10      RET
                                
       4AC9                     GETSIZE:
000AC9 4AC9 FD7E10          19      LD  A,(IY+16)
000ACC 4ACC FD6E11          19      LD  L,(IY+17)
000ACF 4ACF FD6612          19      LD  H,(IY+18)
       4AD2                     SSQ1:
000AD2 4AD2 87               4      ADD A,A
000AD3 4AD3 ED6A            15      ADC HL,HL
000AD5 4AD5 B7               4      OR  A
000AD6 4AD6 C8              11      RET Z
000AD7 4AD7 23               6      INC HL
000AD8 4AD8 C9              10      RET
                                
       4AD9                     SET_FCB:
000AD9 4AD9 D5              11      PUSH    DE
000ADA 4ADA FDE1            14      POP IY
000ADC 4ADC FD7E1C          19      LD  A,(IY+28)
000ADF 4ADF FEFF             7      CP  0FFH
000AE1 4AE1 200C            12      JR  NZ,POPAF_SCF_FF_RET
000AE3 4AE3 E5              11      PUSH    HL
000AE4 4AE4 FD6E1A          19      LD  L,(IY+26)
000AE7 4AE7 FD661B          19      LD  H,(IY+27)
000AEA 4AEA 2228F1          16      LD  (_CLPS),HL
000AED 4AED E1              10      POP HL
000AEE 4AEE C9              10      RET
                                
       4AEF                     POPAF_SCF_FF_RET:
000AEF 4AEF F1              10      POP AF
000AF0 4AF0 37               4      SCF
000AF1 4AF1 9F               4      SBC A,A
000AF2 4AF2 C9              10      RET
                                
       4AF3                     GET_DIR_DAT:
000AF3 4AF3 CD034B          17      CALL    GET_DIR_POS
000AF6 4AF6 C660             7      ADD A,high BANK1_ADR
000AF8 4AF8 2E00             7      LD  L,0
000AFA 4AFA 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000AFB 4AFB CDE848          17      CALL    CHECK_DIR_PAGE
                                #endif
000AFE 4AFE 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000B01 4B01 4F               4      LD  C,A
000B02 4B02 C9              10      RET
                                
       4B03                     GET_DIR_POS:
000B03 4B03 CDCA4C          17      CALL    GET_DISK_BANK_FDRV
000B06 4B06 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B09 4B09 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B0C 4B0C 321FF1          13      LD  (_BANK),A
000B0F 4B0F 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000B12 4B12 47               4      LD  B,A
000B13 4B13 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000B16 4B16 4F               4      LD  C,A
000B17 4B17 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4B1A                     GET_DIR_POS1:
000B1A 4B1A 81               4      ADD A,C
000B1B 4B1B 10FD            13      DJNZ    GET_DIR_POS1
                                
000B1D 4B1D ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4B21                     L_MDP:
000B21 4B21 CB18             8      RR  B   ;->CF
000B23 4B23 D8              11      RET C
000B24 4B24 87               4      ADD A,A
000B25 4B25 18FA            12      JR  L_MDP
                                
       4B27                     WILDCARD:
000B27 4B27 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4B32                     ERROR_WRITE_PROTECTED:
000B32 4B32 3E00             7      LD  A,0     ;Write protected
000B34 4B34 C9              10      RET
       4B35                     DISKIO:
000B35 4B35 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000B37 4B37 48               4      LD  C,B
000B38 4B38 CDD44C          17      CALL    GET_DISK_BANK
       4B3B                     SETMAP1:        
000B3B 4B3B E5              11      PUSH    HL
       4B3C                     DISKIO1:
000B3C 4B3C C5              11      PUSH    BC      ;B=残りのセクタ数
000B3D 4B3D D5              11      PUSH    DE      ;DE=セクタ番号
000B3E 4B3E F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000B3F 4B3F EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000B40 4B40 F5              11      PUSH    AF
000B41 4B41 3A23F1          13      LD  A,(SECSZ_H)
000B44 4B44 CDF64C          17      CALL    MUL_AHL
000B47 4B47 F1              10      POP AF
000B48 4B48 4D               4      LD  C,L     ;C=読み出し元
000B49 4B49 29              11      ADD HL,HL       ;64KB→32KB
000B4A 4B4A 29              11      ADD HL,HL       ;32KB→16KB
000B4B 4B4B 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000B4C 4B4C 84               4      ADD A,H
000B4D 4B4D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B50 4B50 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B53 4B53 321FF1          13      LD  (_BANK),A
000B56 4B56 79               4      LD  A,C     ;C=読み出し元
000B57 4B57 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
000B59 4B59 C660             7      ADD A,high BANK1_ADR
000B5B 4B5B 67               4      LD  H,A
000B5C 4B5C ED4B22F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000B60 4B60 69               4      LD  L,C     ;C=0
000B61 4B61 EDB0                    LDIR
000B63 4B63 EB               4      EX  DE,HL
000B64 4B64 F1              10      POP AF
000B65 4B65 D1              10      POP DE
000B66 4B66 13               6      INC DE
000B67 4B67 C1              10      POP BC
000B68 4B68 10D2            13      DJNZ    DISKIO1
000B6A 4B6A 41               4      LD  B,C
                                
000B6B 4B6B E1              10      POP HL
000B6C 4B6C AF               4      XOR A
000B6D 4B6D FB               4      EI
000B6E 4B6E C9              10      RET
                                
       4B6F                     DSKCHG:
000B6F 4B6F CDA84B          17      CALL    IS_BPB
000B72 4B72 3824            12      JR  C,NOTREADY
000B74 4B74 3A23FB          13      LD  A,(DRVTBL+2)
000B77 4B77 B7               4      OR  A
000B78 4B78 201A            12      JR  NZ,DSKCHG1
000B7A 4B7A 3A21FB          13      LD  A,(DRVTBL)
000B7D 4B7D FE02             7      CP  2
000B7F 4B7F 2013            12      JR  NZ,DSKCHG1
000B81 4B81 CDA84B          17      CALL    IS_BPB
000B84 4B84 300E            12      JR  NC,DSKCHG1
000B86 4B86 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000B88 4B88 3221FB          13      LD  (DRVTBL),A
000B8B 4B8B 3223FB          13      LD  (DRVTBL+2),A
000B8E 4B8E 3A48F3          13      LD  A,(MASTERS)
000B91 4B91 3224FB          13      LD  (DRVTBL+3),A
       4B94                     DSKCHG1:
000B94 4B94 AF               4      XOR A
000B95 4B95 0601             7      LD  B,1
000B97 4B97 C9              10      RET
       4B98                     NOTREADY:
000B98 4B98 3E02             7      LD  A,2
000B9A 4B9A 37               4      SCF
000B9B 4B9B C9              10      RET
                                
       4B9C                     NO_BPB:
000B9C 4B9C E1              10      POP HL
000B9D 4B9D 23               6      INC HL
000B9E 4B9E 11FB4C          10      LD  DE,DPB2DD
000BA1 4BA1 011200          10      LD  BC,DPB2DD_E-DPB2DD
000BA4 4BA4 EDB0                    LDIR
000BA6 4BA6 AF               4      XOR A
000BA7 4BA7 C9              10      RET
                                
       4BA8                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000BA8 4BA8 CDD44C          17      CALL    GET_DISK_BANK
                                
000BAB 4BAB 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000BAE 4BAE FE01             7      CP  1
000BB0 4BB0 D8              11      RET C
                                
000BB1 4BB1 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000BB4 4BB4 C6FF             7      ADD A,0FFH
000BB6 4BB6 D8              11      RET C
                                
000BB7 4BB7 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000BBA 4BBA FE01             7      CP  1
000BBC 4BBC C8              11      RET Z
000BBD 4BBD FE02             7      CP  2
000BBF 4BBF C8              11      RET Z
000BC0 4BC0 FE04             7      CP  4
000BC2 4BC2 C8              11      RET Z
000BC3 4BC3 37               4      SCF
000BC4 4BC4 C9              10      RET
                                
       4BC5                     GETDPB:
000BC5 4BC5 E5              11      PUSH    HL
000BC6 4BC6 CDD44C          17      CALL    GET_DISK_BANK
                                
000BC9 4BC9 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000BCC 4BCC B7               4      OR  A
000BCD 4BCD 28CD            12      JR  Z,NO_BPB
000BCF 4BCF DDE1            14      POP IX
000BD1 4BD1 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000BD4 4BD4 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000BD7 4BD7 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000BDA 4BDA 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000BDD 4BDD DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000BE0 4BE0 87               4      ADD A,A
000BE1 4BE1 87               4      ADD A,A
000BE2 4BE2 87               4      ADD A,A
000BE3 4BE3 3D               4      DEC A
000BE4 4BE4 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000BE7 4BE7 06FF             7      LD  B,-1
000BE9 4BE9 A7               4      AND A           ;無限ループ阻止
       4BEA                     GETDPB1:
000BEA 4BEA 04               4      INC B
000BEB 4BEB 1F               4      RRA
000BEC 4BEC 38FC            12      JR  C,GETDPB1
000BEE 4BEE DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000BF1 4BF1 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000BF4 4BF4 3D               4      DEC A
000BF5 4BF5 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000BF8 4BF8 A7               4      AND A           ;無限ループ阻止
000BF9 4BF9 06FF             7      LD  B,-1
       4BFB                     GETDPB2:
000BFB 4BFB 04               4      INC B
000BFC 4BFC 1F               4      RRA
000BFD 4BFD 38FC            12      JR  C,GETDPB2
000BFF 4BFF 04               4      INC B
000C00 4C00 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000C03 4C03 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000C06 4C06 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000C09 4C09 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000C0C 4C0C 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000C0F 4C0F DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000C12 4C12 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000C15 4C15 DD770B          19      LD  (IX+11),A       ;FATCNT
                                
000C18 4C18 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000C1C 4C1C DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000C1F 4C1F DD460A          19      LD  B,(IX+10)       ;FATCNT
000C22 4C22 210000          10      LD  HL,0
       4C25                     GETDPB3:
000C25 4C25 19              11      ADD HL,DE
000C26 4C26 10FD            13      DJNZ    GETDPB3
       4C28                     GETDPB4:
000C28 4C28 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000C2B 4C2B DD5609          19      LD  D,(IX+9)        ;FIRFAT
000C2E 4C2E 19              11      ADD HL,DE
000C2F 4C2F DD7511          19      LD  (IX+17),L       ;FIRDIR
000C32 4C32 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000C35 4C35 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C38 4C38 87               4      ADD A,A
000C39 4C39 87               4      ADD A,A
000C3A 4C3A DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4C3D                     GETDPB5:
000C3D 4C3D CB3B             8      SRL E
000C3F 4C3F 1F               4      RRA
000C40 4C40 30FB            12      JR  NC,GETDPB5
000C42 4C42 1600             7      LD  D,0
000C44 4C44 19              11      ADD HL,DE
000C45 4C45 DD750C          19      LD  (IX+12),L       ;FIRREC
000C48 4C48 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000C4B 4C4B 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000C4E 4C4E DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000C51 4C51 DD560D          19      LD  D,(IX+13)       ;FIRREC
000C54 4C54 A7               4      AND A
000C55 4C55 ED52            15      SBC HL,DE
                                
000C57 4C57 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000C5A 4C5A 3C               4      INC A
000C5B 4C5B 37               4      SCF             ;無限ループ阻止
       4C5C                     GETDPB6:
000C5C 4C5C 1F               4      RRA
000C5D 4C5D 3806            12      JR  C,GETDPB7
000C5F 4C5F CB3C             8      SRL H
000C61 4C61 CB1D             8      RR  L
000C63 4C63 18F7            12      JR  GETDPB6
       4C65                     GETDPB7:
000C65 4C65 23               6      INC HL
000C66 4C66 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000C69 4C69 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4C6C                     GETDPBD1:
000C6C 4C6C DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C6F 4C6F E6FC             7      AND 0FCH
000C71 4C71 C8              11      RET Z
                                
000C72 4C72 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000C76 4C76 37               4      SCF
000C77 4C77 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000C7B 4C7B DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000C7E 4C7E DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000C82 4C82 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000C86 4C86 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000C8A 4C8A DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000C8E 4C8E DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000C92 4C92 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000C96 4C96 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000C9A 4C9A DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000C9D 4C9D DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000CA0 4CA0 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000CA3 4CA3 87               4      ADD A,A
000CA4 4CA4 87               4      ADD A,A
000CA5 4CA5 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4CA8                     GETDPBD5:
000CA8 4CA8 CB3B             8      SRL E
000CAA 4CAA 1F               4      RRA
000CAB 4CAB 30FB            12      JR  NC,GETDPBD5
000CAD 4CAD 1600             7      LD  D,0
000CAF 4CAF 19              11      ADD HL,DE
000CB0 4CB0 DD750C          19      LD  (IX+12),L       ;FIRREC
000CB3 4CB3 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000CB6 4CB6 18B4            12      JR  GETDPBD1
                                
       4CB8                     CHOICE:
000CB8 4CB8 210000          10      LD  HL,0
000CBB 4CBB C9              10      RET
                                
       4CBC                     DSKFMT:
000CBC 4CBC AF               4      XOR A
000CBD 4CBD 37               4      SCF
       4CBE                     DSKSTP:
000CBE 4CBE C9              10      RET
                                
       4CBF                     BASENT:
000CBF 4CBF ED7B57F1        20      LD  SP,(BASSTK)
000CC3 4CC3 C3B843          10      JP  BASAUTO
                                
       4CC6                     GETSLT:
000CC6 4CC6 3A22FB          13      LD  A,(DRVTBL+1)
000CC9 4CC9 C9              10      RET
                                
       4CCA                     GET_DISK_BANK_FDRV:
000CCA 4CCA 3A4BF1          13      LD  A,(FDRV)
000CCD 4CCD D601             7      SUB 1
000CCF 4CCF 3003            12      JR  NC,GET_DISK_BANK
000CD1 4CD1 3A42F1          13      LD  A,(_DVSW)
       4CD4                     GET_DISK_BANK:
000CD4 4CD4 B7               4      OR  A       ;A=DRIVE
000CD5 4CD5 3E01             7      LD  A,DISK_BANK
000CD7 4CD7 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
000CD9 4CD9 3A41F1          13      LD  A,(B_DRIVE)
                                #endif
       4CDC                     SET_DISK_BANK:
000CDC 4CDC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000CDF 4CDF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000CE2 4CE2 F5              11      PUSH    AF
000CE3 4CE3 E5              11      PUSH    HL
000CE4 4CE4 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
000CE7 4CE7 2222F1          16      LD  (SECSZ),HL
000CEA 4CEA 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000CED 4CED CDF64C          17      CALL    MUL_AHL
000CF0 4CF0 2220F1          16      LD  (CLSZ),HL
000CF3 4CF3 E1              10      POP HL
000CF4 4CF4 F1              10      POP AF
000CF5 4CF5 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)
       4CF6                     MUL_AHL:
000CF6 4CF6 1F               4      RRA     ;->CF
000CF7 4CF7 D8              11      RET C
000CF8 4CF8 29              11      ADD HL,HL
000CF9 4CF9 18FB            12      JR  MUL_AHL
                                
       4CFB                     DPB2DD:
000CFB 4CFB F9                      DB  0F9H    ;MEDIA
000CFC 4CFC 0002                    DW  00200H  ;SECSIZ
000CFE 4CFE 0F                      DB  00FH    ;DIRMSK
000CFF 4CFF 04                      DB  004H    ;DIRSHFT
000D00 4D00 01                      DB  001H    ;CLUSMSK
000D01 4D01 02                      DB  002H    ;CLUSSHFT
000D02 4D02 0100                    DW  00001H  ;FIRFAT
000D04 4D04 02                      DB  002H    ;FATCNT
000D05 4D05 70                      DB  070H    ;MAXENT
000D06 4D06 0E00                    DW  0000EH  ;FIRREC
000D08 4D08 CA02                    DW  002CAH  ;MAXCLUS
000D0A 4D0A 03                      DB  003H    ;FATSIZ
000D0B 4D0B 0700                    DW  0007H   ;FIRDIR
       4D0D                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4D0D                     POP_HL_ERROR:
000D0D 4D0D E1              10      POP     HL
       4D0E                     _ERROR:
000D0E 4D0E 0600             7      LD  B,0
000D10 4D10 A7               4      AND A
000D11 4D11 C9              10      RET
                                
       4D12                     ROM_BDOS:
000D12 4D12 E5              11      PUSH    HL
000D13 4D13 79               4      LD  A,C
000D14 4D14 87               4      ADD A,A
000D15 4D15 38F7            12      JR  C,_ERROR
000D17 4D17 6F               4      LD  L,A
000D18 4D18 265F             7      LD  H,high STABLE
000D1A 4D1A 7E               7      LD  A,(HL)
000D1B 4D1B 2C               4      INC L
000D1C 4D1C 66               7      LD  H,(HL)
000D1D 4D1D 6F               4      LD  L,A
000D1E 4D1E E3              19      EX  (SP),HL
000D1F 4D1F 79               4      LD  A,C
000D20 4D20 C9              10      RET
                                
       4D21                     _PRINT:
       4D21                     PRINT:
000D21 4D21 7B               4      LD  A,E
000D22 4D22 1803            12      JR  MSG_A
                                
       4D24                     _SYS01:     ;(BDOS)コンソール入力
000D24 4D24 CD9B4D          17      CALL    _SYS07
       4D27                     MSG_A:
000D27 4D27 FE03             7      CP  3
000D29 4D29 2814            12      JR  Z,MSG_BR
       4D2B                     MSGA1:
000D2B 4D2B F5              11      PUSH    AF
000D2C 4D2C C5              11      PUSH    BC
000D2D 4D2D D5              11      PUSH    DE
000D2E 4D2E E5              11      PUSH    HL
000D2F 4D2F DDE5            15      PUSH    IX
000D31 4D31 DD21A200        14      LD  IX,CHPUT
000D35 4D35 CDE742          17      CALL    CALSLT_R
000D38 4D38 DDE1            14      POP IX
000D3A 4D3A E1              10      POP HL
000D3B 4D3B D1              10      POP DE
000D3C 4D3C C1              10      POP BC
       4D3D                     MSGA2:
000D3D 4D3D F1              10      POP AF
000D3E 4D3E C9              10      RET
       4D3F                     MSG_BR:
000D3F 4D3F F5              11      PUSH    AF
000D40 4D40 3ADDF3          13      LD  A,(CSRX)
000D43 4D43 FE02             7      CP  2
000D45 4D45 38F6            12      JR  C,MSGA2
000D47 4D47 F1              10      POP AF
       4D48                     MSG_CR:
000D48 4D48 F5              11      PUSH    AF
000D49 4D49 3E0D             7      LD  A,00DH
000D4B 4D4B CD2B4D          17      CALL    MSGA1
000D4E 4D4E 3E0A             7      LD  A,00AH
000D50 4D50 CD2B4D          17      CALL    MSGA1
000D53 4D53 F1              10      POP AF
000D54 4D54 C9              10      RET
                                
       4D55                     _SYS02:     ;(BDOS)コンソール出力
000D55 4D55 CD704D          17      CALL    BREAK
000D58 4D58 1805            12      JR  PRINTX
                                
       4D5A                     _SYS06:     ;(BDOS)コンソール直接入出力
000D5A 4D5A 7B               4      LD  A,E
000D5B 4D5B 3C               4      INC A
000D5C 4D5C CAAF4D          10      JP  Z,_INKEY
       4D5F                     PRINTX:
000D5F 4D5F C3214D          10      JP  _PRINT
                                
       4D62                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D62 4D62 CD9B4D          17      CALL    _SYS07
000D65 4D65 FE03             7      CP  3
000D67 4D67 CC704D          17      CALL    Z,_BREAK
000D6A 4D6A FE13             7      CP  013H        ;CTRL+S
000D6C 4D6C C0              11      RET NZ
       4D6D                     PAUSE:
000D6D 4D6D CD874D          17      CALL    KEYBC
                                
       4D70                     _BREAK:
       4D70                     BREAK:
000D70 4D70 F5              11      PUSH    AF
000D71 4D71 C5              11      PUSH    BC
000D72 4D72 D5              11      PUSH    DE
000D73 4D73 E5              11      PUSH    HL
000D74 4D74 DDE5            15      PUSH    IX
000D76 4D76 DD21B700        14      LD  IX,BREAKX
000D7A 4D7A CDE742          17      CALL    CALSLT_R
000D7D 4D7D DDE1            14      POP IX
000D7F 4D7F E1              10      POP HL
000D80 4D80 D1              10      POP DE
000D81 4D81 C1              10      POP BC
000D82 4D82 DC704D          17      CALL    C,_BREAK
000D85 4D85 F1              10      POP AF
000D86 4D86 C9              10      RET
       4D87                     KEYBC:
000D87 4D87 F5              11      PUSH    AF
000D88 4D88 C5              11      PUSH    BC
000D89 4D89 D5              11      PUSH    DE
000D8A 4D8A E5              11      PUSH    HL
000D8B 4D8B DDE5            15      PUSH    IX
000D8D 4D8D DD215601        14      LD  IX,KILBUF
000D91 4D91 CDE742          17      CALL    CALSLT_R
000D94 4D94 DDE1            14      POP IX
000D96 4D96 E1              10      POP HL
000D97 4D97 D1              10      POP DE
000D98 4D98 C1              10      POP BC
000D99 4D99 F1              10      POP AF
000D9A 4D9A C9              10      RET
                                
       4D9B                     _SYS07:
       4D9B                     FLGET:
000D9B 4D9B C5              11      PUSH    BC
000D9C 4D9C D5              11      PUSH    DE
000D9D 4D9D E5              11      PUSH    HL
000D9E 4D9E DDE5            15      PUSH    IX
000DA0 4DA0 DD219F00        14      LD  IX,CHGET
000DA4 4DA4 CDE742          17      CALL    CALSLT_R
000DA7 4DA7 DDE1            14      POP IX
000DA9 4DA9 E1              10      POP HL
000DAA 4DAA D1              10      POP DE
000DAB 4DAB C1              10      POP BC
000DAC 4DAC FE03             7      CP  3
000DAE 4DAE C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       4DAF                     _INKEY:
       4DAF                     INKEY:
000DAF 4DAF CD494E          17      CALL    CPM_CONST
000DB2 4DB2 C8              11      RET Z
000DB3 4DB3 18E6            12      JR  FLGET
                                
       4DB5                     _SYS0A:     ;(BDOS)文字列入力
000DB5 4DB5 C5              11      PUSH    BC
000DB6 4DB6 E5              11      PUSH    HL
000DB7 4DB7 D5              11      PUSH    DE
000DB8 4DB8 CDE14D          17      CALL    GETL
000DBB 4DBB 111FF4          10      LD  DE,KBUF
000DBE 4DBE E1              10      POP HL
000DBF 4DBF E5              11      PUSH    HL
000DC0 4DC0 0E00             7      LD  C,0
000DC2 4DC2 3004            12      JR  NC,SAX0
000DC4 4DC4 23               6      INC HL
000DC5 4DC5 23               6      INC HL
000DC6 4DC6 1808            12      JR  SAX4
       4DC8                     SAX0:
000DC8 4DC8 46               7      LD  B,(HL)
000DC9 4DC9 23               6      INC HL
       4DCA                     SAX1:
000DCA 4DCA 23               6      INC HL
000DCB 4DCB 1A               7      LD  A,(DE)
000DCC 4DCC 13               6      INC DE
000DCD 4DCD B7               4      OR  A
000DCE 4DCE 2004            12      JR  NZ,SAX2
       4DD0                     SAX4:
000DD0 4DD0 360D            10      LD  (HL),00DH
000DD2 4DD2 1804            12      JR  SAX3
       4DD4                     SAX2:
000DD4 4DD4 77               7      LD  (HL),A
000DD5 4DD5 0C               4      INC C
000DD6 4DD6 10F2            13      DJNZ    SAX1
       4DD8                     SAX3:
000DD8 4DD8 D1              10      POP DE
000DD9 4DD9 79               4      LD  A,C
000DDA 4DDA 13               6      INC DE
000DDB 4DDB 12               7      LD  (DE),A
000DDC 4DDC 1B               6      DEC DE
000DDD 4DDD E1              10      POP HL
000DDE 4DDE C1              10      POP BC
000DDF 4DDF A7               4      AND A
000DE0 4DE0 C9              10      RET
       4DE1                     GETL:
000DE1 4DE1 DDE5            15      PUSH    IX
000DE3 4DE3 FDE5            15      PUSH    IY
                                
000DE5 4DE5 2ADCF3          16      LD  HL,(CSRY)
000DE8 4DE8 22CAFB          16      LD  (FSTPOS),HL
       4DEB                     GETL1:
000DEB 4DEB CD624D          17      CALL    _SYS08
000DEE 4DEE FE09             7      CP  9
000DF0 4DF0 2008            12      JR  NZ,GETL1V
000DF2 4DF2 211FF4          10      LD  HL,KBUF
000DF5 4DF5 CD6A43          17      CALL    MSX
000DF8 4DF8 18F1            12      JR  GETL1
       4DFA                     GETL1V:
000DFA 4DFA 5F               4      LD  E,A
000DFB 4DFB FE08             7      CP  8
000DFD 4DFD CC974E          17      CALL    Z,CTRL02
000E00 4E00 FE20             7      CP  020H
000E02 4E02 D4C34E          17      CALL    NC,INSERT
000E05 4E05 CD2B4D          17      CALL    MSGA1
                                
000E08 4E08 7B               4      LD  A,E
000E09 4E09 FE0D             7      CP  00DH
000E0B 4E0B 20DE            12      JR  NZ,GETL1
                                
000E0D 4E0D 111FF4          10      LD  DE,KBUF
000E10 4E10 3AB0F3          13      LD  A,(LINLEN)
000E13 4E13 47               4      LD  B,A
000E14 4E14 CD7650          17      CALL    ZERO_MEMORY_DE
                                
000E17 4E17 2ACAFB          16      LD  HL,(FSTPOS)
000E1A 4E1A 3ADCF3          13      LD  A,(CSRY)
000E1D 4E1D 6F               4      LD  L,A
000E1E 4E1E E5              11      PUSH    HL
000E1F 4E1F CDF44E          17      CALL    LOC0
000E22 4E22 4D               4      LD  C,L
000E23 4E23 44               4      LD  B,H
000E24 4E24 E1              10      POP HL
000E25 4E25 3AB0F3          13      LD  A,(LINLEN)
000E28 4E28 94               4      SUB H
000E29 4E29 3D               4      DEC A
000E2A 4E2A 5F               4      LD  E,A
000E2B 4E2B 211FF4          10      LD  HL,KBUF
       4E2E                     GETL2:
000E2E 4E2E CD874E          17      CALL    _SCRN
000E31 4E31 03               6      INC BC
000E32 4E32 77               7      LD  (HL),A
000E33 4E33 23               6      INC HL
000E34 4E34 1D               4      DEC E
000E35 4E35 20F7            12      JR  NZ,GETL2
000E37 4E37 CD484D          17      CALL    MSG_CR
                                
000E3A 4E3A FDE1            14      POP IY
000E3C 4E3C DDE1            14      POP IX
       4E3E                     GETL3:
000E3E 4E3E 2B               6      DEC HL
000E3F 4E3F 7E               7      LD  A,(HL)
000E40 4E40 FE21             7      CP  021H
000E42 4E42 D0              11      RET NC
000E43 4E43 3600            10      LD  (HL),0
000E45 4E45 15               4      DEC D
000E46 4E46 20F6            12      JR  NZ,GETL3
000E48 4E48 C9              10      RET
                                
       4E49                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       4E49                     CONSTX:
       4E49                     CPM_CONST:
000E49 4E49 C5              11      PUSH    BC
000E4A 4E4A D5              11      PUSH    DE
000E4B 4E4B E5              11      PUSH    HL
000E4C 4E4C DDE5            15      PUSH    IX
000E4E 4E4E DD219C00        14      LD  IX,CHSNS
000E52 4E52 CDE742          17      CALL    CALSLT_R
000E55 4E55 DDE1            14      POP IX
000E57 4E57 E1              10      POP HL
000E58 4E58 D1              10      POP DE
000E59 4E59 C1              10      POP BC
000E5A 4E5A C9              10      RET
                                
       4E5B                     _SYS2A:     ;(BDOS)日付の獲得
000E5B 4E5B AF               4      XOR A
000E5C 4E5C 57               4      LD  D,A
000E5D 4E5D 5F               4      LD  E,A
000E5E 4E5E 67               4      LD  H,A
000E5F 4E5F 6F               4      LD  L,A
000E60 4E60 C9              10      RET
                                
       4E61                     _SYS2C:     ;(BDOS)時刻の獲得
000E61 4E61 AF               4      XOR A
000E62 4E62 57               4      LD  D,A
000E63 4E63 5F               4      LD  E,A
000E64 4E64 67               4      LD  H,A
000E65 4E65 6F               4      LD  L,A
000E66 4E66 C9              10      RET
                                
       4E67                     POS:
000E67 4E67 F5              11      PUSH    AF
000E68 4E68 2ADCF3          16      LD  HL,(CSRY)
000E6B 4E6B 7D               4      LD  A,L
000E6C 4E6C 6C               4      LD  L,H
000E6D 4E6D 67               4      LD  H,A
000E6E 4E6E 2C               4      INC L
000E6F 4E6F 24               4      INC H
000E70 4E70 F1              10      POP AF
000E71 4E71 C9              10      RET
                                
       4E72                     LOC:
000E72 4E72 F5              11      PUSH    AF
000E73 4E73 E5              11      PUSH    HL
000E74 4E74 7D               4      LD  A,L
000E75 4E75 6C               4      LD  L,H
000E76 4E76 67               4      LD  H,A
000E77 4E77 2D               4      DEC L
000E78 4E78 25               4      DEC H
000E79 4E79 DDE5            15      PUSH    IX
000E7B 4E7B DD21C600        14      LD  IX,POSIT
000E7F 4E7F CDE742          17      CALL    CALSLT_R
000E82 4E82 DDE1            14      POP IX
000E84 4E84 E1              10      POP HL
000E85 4E85 F1              10      POP AF
000E86 4E86 C9              10      RET
                                
       4E87                     _SCRN:
       4E87                     SCRN:
000E87 4E87 E5              11      PUSH    HL
000E88 4E88 DDE5            15      PUSH    IX
                                
000E8A 4E8A 69               4      LD  L,C
000E8B 4E8B 60               4      LD  H,B
000E8C 4E8C DD214A00        14      LD  IX,RDVRM
000E90 4E90 CDE742          17      CALL    CALSLT_R
                                
000E93 4E93 DDE1            14      POP IX
000E95 4E95 E1              10      POP HL
000E96 4E96 C9              10      RET
                                
       4E97                     CTRL02:
000E97 4E97 F5              11      PUSH    AF
000E98 4E98 D5              11      PUSH    DE
000E99 4E99 2ADCF3          16      LD  HL,(CSRY)
000E9C 4E9C 3AB0F3          13      LD  A,(LINLEN)
000E9F 4E9F 4F               4      LD  C,A
000EA0 4EA0 94               4      SUB H   ;CSRX
000EA1 4EA1 C602             7      ADD A,2
000EA3 4EA3 47               4      LD  B,A ;カーソルより右の文字数
000EA4 4EA4 61               4      LD  H,C ;LINLEN
000EA5 4EA5 C5              11      PUSH    BC
000EA6 4EA6 CDF44E          17      CALL    LOC0
000EA9 4EA9 C1              10      POP BC
                                
000EAA 4EAA 1620             7      LD  D,020H
       4EAC                     C8X1:
000EAC 4EAC DD214A00        14      LD  IX,RDVRM
000EB0 4EB0 CDE742          17      CALL    CALSLT_R
000EB3 4EB3 4F               4      LD  C,A
000EB4 4EB4 7A               4      LD  A,D
000EB5 4EB5 DD214D00        14      LD  IX,WRTVRM
000EB9 4EB9 CDE742          17      CALL    CALSLT_R
000EBC 4EBC 2B               6      DEC HL
000EBD 4EBD 51               4      LD  D,C
000EBE 4EBE 10EC            13      DJNZ    C8X1
000EC0 4EC0 D1              10      POP DE
000EC1 4EC1 F1              10      POP AF
000EC2 4EC2 C9              10      RET
                                
       4EC3                     INSERT:
000EC3 4EC3 F5              11      PUSH    AF
000EC4 4EC4 D5              11      PUSH    DE
000EC5 4EC5 2ADCF3          16      LD  HL,(CSRY)
000EC8 4EC8 3AB0F3          13      LD  A,(LINLEN)
000ECB 4ECB 4F               4      LD  C,A
000ECC 4ECC 94               4      SUB H   ;CSRX
000ECD 4ECD 3C               4      INC A
000ECE 4ECE 47               4      LD  B,A ;カーソルより右の文字数
000ECF 4ECF C5              11      PUSH    BC
000ED0 4ED0 CDF44E          17      CALL    LOC0
000ED3 4ED3 C1              10      POP BC
                                
000ED4 4ED4 1620             7      LD  D,020H
       4ED6                     INS1:
000ED6 4ED6 DD214A00        14      LD  IX,RDVRM
000EDA 4EDA CDE742          17      CALL    CALSLT_R
000EDD 4EDD 4F               4      LD  C,A
000EDE 4EDE 7A               4      LD  A,D
000EDF 4EDF DD214D00        14      LD  IX,WRTVRM
000EE3 4EE3 CDE742          17      CALL    CALSLT_R
000EE6 4EE6 23               6      INC HL
000EE7 4EE7 51               4      LD  D,C
000EE8 4EE8 10EC            13      DJNZ    INS1
000EEA 4EEA D1              10      POP DE
000EEB 4EEB F1              10      POP AF
000EEC 4EEC C9              10      RET
                                
       4EED                     CONOUT1:
000EED 4EED 59               4      LD  E,C
000EEE 4EEE C3214D          10      JP  _PRINT
                                
       4EF1                     GETVRAM:
000EF1 4EF1 2ADCF3          16      LD  HL,(CSRY)
       4EF4                     LOC0:
000EF4 4EF4 2D               4      DEC L
000EF5 4EF5 25               4      DEC H
000EF6 4EF6 4C               4      LD  C,H ;CSRX-1
000EF7 4EF7 5D               4      LD  E,L ;CSRY-1
       4EF8                     LOC1:
000EF8 4EF8 3AB0F3          13      LD  A,(LINLEN)
000EFB 4EFB 67               4      LD  H,A
000EFC 4EFC 1600             7      LD  D,0
000EFE 4EFE 6A               4      LD  L,D ;0
000EFF 4EFF 0608             7      LD  B,8
       4F01                     LOC2:
000F01 4F01 29              11      ADD HL,HL
000F02 4F02 3001            12      JR  NC,LOC3
000F04 4F04 19              11      ADD HL,DE
       4F05                     LOC3:
000F05 4F05 10FA            13      DJNZ    LOC2
000F07 4F07 09              11      ADD HL,BC
000F08 4F08 C9              10      RET
                                
       4F09                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000F09 4F09 212200          10      LD  HL,00022H
000F0C 4F0C AF               4      XOR A
000F0D 4F0D 7D               4      LD  A,L
000F0E 4F0E C9              10      RET
                                
       4F0F                     _SYS0D:     ;(BDOS)ディスク・リセット
000F0F 4F0F 218000          10      LD  HL,00080H
000F12 4F12 222EF1          16      LD  (_DTA),HL
000F15 4F15 C9              10      RET
                                
       4F16                     _SYS0E:     ;(BDOS)カレントドライブの設定
000F16 4F16 3242F1          13      LD  (_DVSW),A
000F19 4F19 C9              10      RET
                                
       4F1A                     _SYS0F:     ;(BDOS)ファイルのオープン
000F1A 4F1A D5              11      PUSH    DE
000F1B 4F1B FDE1            14      POP IY
000F1D 4F1D CD6350          17      CALL    INIT_FILE
000F20 4F20 CDAB48          17      CALL    ROM_OPEN
000F23 4F23 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
000F25 4F25 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
000F29 4F29 FDE5            15      PUSH    IY
000F2B 4F2B D1              10      POP DE
000F2C 4F2C 13               6      INC DE
000F2D 4F2D 010B00          10      LD  BC,11
000F30 4F30 EDB0                    LDIR
                                ;               Attribute
000F32 4F32 7E               7      LD  A,(HL)
000F33 4F33 FD770D          19      LD  (IY+13),A
                                ;               TIME
000F36 4F36 110B00          10      LD  DE,11
000F39 4F39 19              11      ADD HL,DE
000F3A 4F3A 7E               7      LD  A,(HL)
000F3B 4F3B 23               6      INC HL
000F3C 4F3C FD7716          19      LD  (IY+22),A
000F3F 4F3F 7E               7      LD  A,(HL)
000F40 4F40 23               6      INC HL
000F41 4F41 FD7717          19      LD  (IY+23),A
                                ;               DATE
000F44 4F44 7E               7      LD  A,(HL)
000F45 4F45 23               6      INC HL
000F46 4F46 FD7714          19      LD  (IY+20),A
000F49 4F49 7E               7      LD  A,(HL)
000F4A 4F4A 23               6      INC HL
000F4B 4F4B FD7715          19      LD  (IY+21),A
                                ;               First cluster
000F4E 4F4E 7E               7      LD  A,(HL)
000F4F 4F4F 23               6      INC HL
000F50 4F50 FD771A          19      LD  (IY+26),A
000F53 4F53 7E               7      LD  A,(HL)
000F54 4F54 23               6      INC HL
000F55 4F55 FD771B          19      LD  (IY+27),A
                                ;               SIZE
000F58 4F58 7E               7      LD  A,(HL)
000F59 4F59 23               6      INC HL
000F5A 4F5A FD7710          19      LD  (IY+16),A
000F5D 4F5D 7E               7      LD  A,(HL)
000F5E 4F5E 23               6      INC HL
000F5F 4F5F FD7711          19      LD  (IY+17),A
000F62 4F62 7E               7      LD  A,(HL)
000F63 4F63 23               6      INC HL
000F64 4F64 FD7712          19      LD  (IY+18),A
000F67 4F67 7E               7      LD  A,(HL)
000F68 4F68 FD7713          19      LD  (IY+19),A
000F6B 4F6B AF               4      XOR A
000F6C 4F6C FD770C          19      LD  (IY+12),A
000F6F 4F6F C9              10      RET
                                
       4F70                     _SYS10:     ;(BDOS)ファイルのクローズ
000F70 4F70 AF               4      XOR A
000F71 4F71 C9              10      RET
                                
       4F72                     S11X1:
000F72 4F72 FD7119          19      LD  (IY+25),C       ;RootEntCnt
000F75 4F75 FD750E          19      LD  (IY+14),L
000F78 4F78 FD740F          19      LD  (IY+15),H
       4F7B                     SCF_FF_RET:
000F7B 4F7B 37               4      SCF
000F7C 4F7C 9F               4      SBC A,A
000F7D 4F7D C9              10      RET
                                
       4F7E                     _SYS11:     ;(BDOS)最初のファイルの検索
000F7E 4F7E ED5336F1        20      LD  (_FCB),DE
000F82 4F82 D5              11      PUSH    DE
000F83 4F83 FDE1            14      POP IY
000F85 4F85 CD6350          17      CALL    INIT_FILE
000F88 4F88 CDF34A          17      CALL    GET_DIR_DAT
       4F8B                     S12X1:
000F8B 4F8B CDC748          17      CALL    FILESE
000F8E 4F8E 30E2            12      JR  NC,S11X1
000F90 4F90 0D               4      DEC C
000F91 4F91 FD7119          19      LD  (IY+25),C       ;RootEntCnt
000F94 4F94 012000          10      LD  BC,32
000F97 4F97 ED5B2EF1        20      LD  DE,(_DTA)
000F9B 4F9B AF               4      XOR A
000F9C 4F9C 12               7      LD  (DE),A      ;ドライブ番号
000F9D 4F9D 13               6      INC DE
000F9E 4F9E EDB0                    LDIR            ;ディレクトリエントリ
000FA0 4FA0 FD750E          19      LD  (IY+14),L
000FA3 4FA3 FD740F          19      LD  (IY+15),H
000FA6 4FA6 C9              10      RET
                                
       4FA7                     _SYS12:
000FA7 4FA7 FD2A36F1        20      LD  IY,(_FCB)
000FAB 4FAB FDE5            15      PUSH    IY
000FAD 4FAD D1              10      POP DE
000FAE 4FAE CD6350          17      CALL    INIT_FILE
                                
000FB1 4FB1 FD6E0E          19      LD  L,(IY+14)
000FB4 4FB4 FD660F          19      LD  H,(IY+15)
000FB7 4FB7 FD4E19          19      LD  C,(IY+25)
000FBA 4FBA 18CF            12      JR  S12X1
                                
       4FBC                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000FBC 4FBC CDD94A          17      CALL    SET_FCB
000FBF 4FBF CDA74A          17      CALL    GETSEQ
000FC2 4FC2 CD944A          17      CALL    RB_READ
000FC5 4FC5 E5              11      PUSH    HL
000FC6 4FC6 CDB44A          17      CALL    SETSEQ
000FC9 4FC9 E1              10      POP HL
       4FCA                     SREAD:
000FCA 4FCA C601             7      ADD A,001H
000FCC 4FCC D8              11      RET C
                                
000FCD 4FCD 7D               4      LD  A,L
000FCE 4FCE D601             7      SUB 001H
000FD0 4FD0 9F               4      SBC A,A
000FD1 4FD1 E603             7      AND 3
000FD3 4FD3 1F               4      RRA
000FD4 4FD4 C9              10      RET
                                
       4FD5                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000FD5 4FD5 210100          10      LD  HL,00001H
000FD8 4FD8 AF               4      XOR A
000FD9 4FD9 C9              10      RET
                                
       4FDA                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
000FDA 4FDA 3A42F1          13      LD  A,(_DVSW)
000FDD 4FDD C9              10      RET
                                
       4FDE                     _SYS1A:     ;(BDOS)DTAの設定
000FDE 4FDE ED532EF1        20      LD  (_DTA),DE
000FE2 4FE2 AF               4      XOR A
000FE3 4FE3 C9              10      RET
                                
       4FE4                     _SYS1B:     ;(BDOS)ディスク情報の獲得
000FE4 4FE4 010002          10      LD  BC,512
000FE7 4FE7 11C302          10      LD  DE,707
000FEA 4FEA 210000          10      LD  HL,0
000FED 4FED DD2138F1        14      LD  IX,_BUF
000FF1 4FF1 FD2138F1        14      LD  IY,_BUF
000FF5 4FF5 FD3600F9        19      LD  (IY+0),0F9H
000FF9 4FF9 3E02             7      LD  A,2
000FFB 4FFB C9              10      RET
                                
       4FFC                     _SYS21:     ;(BDOS)ランダムな読み出し
000FFC 4FFC CDD94A          17      CALL    SET_FCB
                                
000FFF 4FFF FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001002 5002 FD6622          19      LD  H,(IY+34)
                                
001005 5005 CD944A          17      CALL    RB_READ
001008 5008 18C0            12      JR  SREAD
                                
       500A                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00100A 500A CD1A4F          17      CALL    _SYS0F
00100D 500D D8              11      RET C
                                
00100E 500E D5              11      PUSH    DE      ;EX DE,IY
00100F 500F FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001011 5011 CDC94A          17      CALL    GETSIZE
       5014                     _S24X1:
001014 5014 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001017 5017 FD7422          19      LD  (IY+34),H
00101A 501A FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00101E 501E FDE3            23      EX  (SP),IY     ;
001020 5020 D1              10      POP DE      ;
                                
001021 5021 AF               4      XOR A
001022 5022 C9              10      RET
                                
       5023                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001023 5023 E5              11      PUSH    HL
001024 5024 D5              11      PUSH    DE      ;EX DE,IY
001025 5025 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001027 5027 CDA74A          17      CALL    GETSEQ
00102A 502A 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       502C                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00102C 502C CDD94A          17      CALL    SET_FCB
00102F 502F E5              11      PUSH    HL
001030 5030 FD6E21          19      LD  L,(IY+33)
001033 5033 FD6622          19      LD  H,(IY+34)
001036 5036 2224F1          16      LD  (RR_LOW),HL
001039 5039 FD6E23          19      LD  L,(IY+35)
00103C 503C FD6624          19      LD  H,(IY+36)
00103F 503F 2226F1          16      LD  (RR_HIGH),HL
001042 5042 E1              10      POP HL
001043 5043 CDCB46          17      CALL    ROM_READ
001046 5046 ED5B24F1        20      LD  DE,(RR_LOW)
00104A 504A FD7321          19      LD  (IY+33),E
00104D 504D FD7222          19      LD  (IY+34),D
001050 5050 ED5B26F1        20      LD  DE,(RR_HIGH)
001054 5054 FD7323          19      LD  (IY+35),E
001057 5057 FD7224          19      LD  (IY+36),D
00105A 505A 9F               4      SBC A,A
00105B 505B C9              10      RET
                                
       505C                     _SYS2F:
00105C 505C 44               4      LD  B,H
00105D 505D 2A2EF1          16      LD  HL,(_DTA)
001060 5060 C3354B          10      JP  DISKIO
                                
       5063                     INIT_FILE:
001063 5063 EB               4      EX  DE,HL
001064 5064 114BF1          10      LD  DE,FDRV
001067 5067 010C00          10      LD  BC,1+8+3
00106A 506A EDB0                    LDIR
00106C 506C CDCA4C          17      CALL    GET_DISK_BANK_FDRV
00106F 506F 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001072 5072 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
001075 5075 C9              10      RET
                                
       5076                     ZERO_MEMORY_DE:
001076 5076 AF               4      XOR A
       5077                     FILL_MEMORY_DE:
001077 5077 12               7      LD  (DE),A
001078 5078 13               6      INC DE
001079 5079 10FC            13      DJNZ    FILL_MEMORY_DE
00107B 507B C9              10      RET
                                
00107C 507C                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 0E4D244D554D0E4D        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 0E4D0E4D5A4D9B4D        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 624D0E4DB54D494E        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 094F0F4F164F1A4F        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 704F7E4FA74F0E4D        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 BC4F0E4D0E4D0E4D        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 D54FDA4FDE4FE44F        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 0E4D0E4D0E4D0A50        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 23500E4D0E4D2C50        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 0E4D0E4D5B4E0E4D        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 614E0E4D0E4D5C50        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 0E4D0E4D0E4D0E4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
