                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 C14D                    DW  STATEMENT   ; STATEMENT
000006 4006 2B4E                    DW  DEVICE1     ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3624E          10      JP  DISKIO
000013 4013 C39D4E          10      JP  DSKCHG
000016 4016 C3F34E          10      JP  GETDPB
000019 4019 C3E64F          10      JP  CHOICE
00001C 401C C3EA4F          10      JP  DSKFMT
00001F 401F C3EC4F          10      JP  DSKSTP
000022 4022 C3ED4F          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3EA4F          10      JP  DSKFMT
000029 4029 C3EC4F          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C32950          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.2",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3200    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2262F1          16      LD  (_SP),HL
000129 4129 ED7B62F1        20      LD  SP,(_SP)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210743          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017B00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DBFD          13      LD  (H_PINL),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4742          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DCFD          13      LD  (H_PINL+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 210745          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 213946          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 214646          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 218550          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AC43          10      LD  HL,ROM_BOOT
0001BC 41BC 22DDFD          16      LD  (H_PINL+2),HL
0001BF 41BF 21624E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DFFD          13      LD  (H_PINL+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001E5 41E5 204F            12      JR  NZ,NOT_BANK_TYPE
0001E7 41E7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001EA 41EA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001ED 41ED CD3801          17      CALL    RSLREG      ;read primary slot #
0001F0 41F0 07               4      RLCA
0001F1 41F1 07               4      RLCA
0001F2 41F2 F5              11      PUSH    AF
0001F3 41F3 1605             7      LD  D,4+1
0001F5 41F5 CD4E42          17      CALL    GTSL2_
0001F8 41F8 3244F3          13      LD  (RAMAD3),A
0001FB 41FB F1              10      POP AF
0001FC 41FC 07               4      RLCA
0001FD 41FD 07               4      RLCA
0001FE 41FE 1603             7      LD  D,2+1
000200 4200 CD4E42          17      CALL    GTSL2_
000203 4203 2680             7      LD  H,080H
000205 4205 CD6B42          17      CALL    CHK_RAM
000208 4208 3243F3          13      LD  (RAMAD2),A
       420B                     RAMCHK2:
00020B 420B 3A44F3          13      LD  A,(RAMAD3)
00020E 420E 2640             7      LD  H,040H
000210 4210 CD6B42          17      CALL    CHK_RAM
000213 4213 3242F3          13      LD  (RAMAD1),A
       4216                     RAMCHK1:
000216 4216 3A44F3          13      LD  A,(RAMAD3)
000219 4219 2600             7      LD  H,00H
00021B 421B CD6B42          17      CALL    CHK_RAM
00021E 421E 3241F3          13      LD  (RAMAD0),A
       4221                     RAMCHK0:
000221 4221 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000224 4224 010F00          10      LD  BC,0000FH       ;切り上げ
000227 4227 09              11      ADD HL,BC
000228 4228 7D               4      LD  A,L
                                
000229 4229 0604             7      LD  B,4
       422B                     B_DRIVE1:
00022B 422B CB3C             8      SRL H
00022D 422D 1F               4      RRA
00022E 422E 10FB            13      DJNZ    B_DRIVE1
                                
000230 4230 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000232 4232 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000235 4235 C9              10      RET
                                
       4236                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000236 4236 21DE43          10      LD  HL,MSG_ERROR_ROM_MODE
000239 4239 CD8543          17      CALL    MSX
00023C 423C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000240 4240 DD219F00        14      LD  IX,CHGET
000244 4244 C31C00          10      JP  _CALSLT
                                
       4247                     GTSL1_:             ;自分のいるスロットを知る
000247 4247 CD3801          17      CALL    RSLREG      ;read primary slot #
00024A 424A 0F               4      RRCA
00024B 424B 0F               4      RRCA
00024C 424C 1601             7      LD  D,1
       424E                     GTSL2_:
00024E 424E E603             7      AND 3       ;[A]=000000PP
000250 4250 5F               4      LD  E,A     ;[E]=000000PP
000251 4251 21C1FC          10      LD  HL,EXPTBL
000254 4254 85               4      ADD A,L     ;桁上りは無い
000255 4255 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000256 4256 7B               4      LD  A,E     ;[A]=000000PP
000257 4257 CB7E            13      BIT 7,(HL)
000259 4259 C8              11      RET Z
00025A 425A 7D               4      LD  A,L     ;point to SLTTBL entry
00025B 425B C604             7      ADD A,4     ;桁上りは無い
00025D 425D 6F               4      LD  L,A
00025E 425E 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425F                     GTSL3_:
00025F 425F 15               4      DEC D
000260 4260 2803            12      JR  Z,GTSL4_:
000262 4262 0F               4      RRCA
000263 4263 18FA            12      JR  GTSL3_:
       4265                     GTSL4_:
000265 4265 E60C             7      AND 00CH        ;[A] = 0000SS00
000267 4267 B3               4      OR  E       ;[A] = 0000SSPP
000268 4268 F680             7      OR  080H        ;[A] = 1000SSPP
00026A 426A C9              10      RET
                                
       426B                     CHK_RAM:
00026B 426B E5              11      PUSH    HL
00026C 426C CDC042          17      CALL    CHK_RAM0
00026F 426F E1              10      POP HL
000270 4270 C8              11      RET Z
000271 4271 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000274 4274 E680             7      AND 080H
000276 4276 CD9742          17      CALL    CHK_RAM_SLT
000279 4279 C8              11      RET Z
00027A 427A 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027D 427D E680             7      AND 080H
00027F 427F C601             7      ADD A,1
000281 4281 CD9742          17      CALL    CHK_RAM_SLT
000284 4284 C8              11      RET Z
000285 4285 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000288 4288 E680             7      AND 080H
00028A 428A C602             7      ADD A,2
00028C 428C CD9742          17      CALL    CHK_RAM_SLT
00028F 428F C8              11      RET Z
000290 4290 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000293 4293 E680             7      AND 080H
000295 4295 C603             7      ADD A,3
       4297                     CHK_RAM_SLT:
000297 4297 E5              11      PUSH    HL
000298 4298 CDC042          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029B 429B E1              10      POP HL
00029C 429C C8              11      RET Z
00029D 429D CB79             8      BIT 7,C
00029F 429F 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A1 42A1 79               4      LD  A,C
0002A2 42A2 C604             7      ADD A,4*1           ;スロット#X-1
0002A4 42A4 E5              11      PUSH    HL
0002A5 42A5 CDC042          17      CALL    CHK_RAM0
0002A8 42A8 E1              10      POP HL
0002A9 42A9 C8              11      RET Z
0002AA 42AA 79               4      LD  A,C
0002AB 42AB C608             7      ADD A,4*2           ;スロット#X-2
0002AD 42AD E5              11      PUSH    HL
0002AE 42AE CDC042          17      CALL    CHK_RAM0
0002B1 42B1 E1              10      POP HL
0002B2 42B2 C8              11      RET Z
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 C60C             7      ADD A,4*3           ;スロット#X-3
0002B6 42B6 E5              11      PUSH    HL
0002B7 42B7 CDC042          17      CALL    CHK_RAM0
0002BA 42BA E1              10      POP HL
       42BB                     CHK_RAM_E:
0002BB 42BB AF               4      XOR A
0002BC 42BC 3C               4      INC A           ;ZF=0にする
0002BD 42BD 3E00             7      LD  A,0
0002BF 42BF C9              10      RET
                                
       42C0                     CHK_RAM0:
0002C0 42C0 4F               4      LD  C,A
0002C1 42C1 3A00F1          13      LD  A,(ROM_SLT)
0002C4 42C4 B9               4      CP  C
0002C5 42C5 28F4            12      JR  Z,CHK_RAM_E
0002C7 42C7 2E00             7      LD  L,0
       42C9                     CHK_RAM1:
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDFB42          17      CALL    CALSLT_R
0002D1 42D1 C6E5             7      ADD A,0E5H
0002D3 42D3 47               4      LD  B,A
0002D4 42D4 5F               4      LD  E,A
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 DD211400        14      LD  IX,_WRSLT
0002DA 42DA CDFB42          17      CALL    CALSLT_R
0002DD 42DD 79               4      LD  A,C
0002DE 42DE DD210C00        14      LD  IX,_RDSLT
0002E2 42E2 CDFB42          17      CALL    CALSLT_R
0002E5 42E5 B8               4      CP  B
0002E6 42E6 C0              11      RET NZ
0002E7 42E7 D6E5             7      SUB 0E5H
0002E9 42E9 79               4      LD  A,C
0002EA 42EA 5F               4      LD  E,A
0002EB 42EB DD211400        14      LD  IX,_WRSLT
0002EF 42EF CDFB42          17      CALL    CALSLT_R
0002F2 42F2 24               4      INC H
0002F3 42F3 7D               4      LD  A,L
0002F4 42F4 C604             7      ADD A,4
0002F6 42F6 6F               4      LD  L,A
0002F7 42F7 20D0            12      JR  NZ,CHK_RAM1
0002F9 42F9 79               4      LD  A,C     ;ZF=1のハズ
0002FA 42FA C9              10      RET
                                
       42FB                     CALSLT_R:
0002FB 42FB C5              11      PUSH    BC
0002FC 42FC E5              11      PUSH    HL
0002FD 42FD FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000301 4301 CD1C00          17      CALL    _CALSLT
000304 4304 E1              10      POP HL
000305 4305 C1              10      POP BC
000306 4306 C9              10      RET
                                
       4307                     AT_ISC:
000307 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000307 F0E9 FEB7             7      CP  0B7H            ;FILES
000309 F0EB CC7BFE          17      CALL    Z,H_FILE
00030C F0EE FEB5             7      CP  0B5H            ;LOAD
00030E F0F0 CA71FE          10      JP  Z,H_BINS
000311 F0F3 FE8A             7      CP  08AH            ;RUN
000313 F0F5 CA76FE          10      JP  Z,H_BINL
000316 F0F8 FED6             7      CP  0D6H            ;COPY
000318 F0FA 2813            12      JR  Z,FIX_COPY
00031A F0FC FECF             7      CP  0CFH            ;BLOAD
00031C F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031D F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031E F100 00                      DB  0
00031F F101 6F45                    DW  ROM_BLOAD
000321 F103 F5              11      PUSH    AF
000322 F104 E5              11      PUSH    HL
000323 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000326 F108 E1              10      POP HL
000327 F109 F1              10      POP AF
000328 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
00032A F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032C F10E C9              10      RET
       F10F                     FIX_COPY:
00032D F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032E F110 00                      DB  0
00032F F111 CC46                    DW  ROM_COPY
000331 F113 C9              10      RET
       F114                     ROMUSE1:
000332 F114 3A00F1          13      LD  A,(ROM_SLT)
000335 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000337 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
00033A F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033D F11F 00                      DB  0
       F120                     _BANK:
00033E F120 00                      DB  0
       F121                     _BANK1:
00033F F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
000340 F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000342 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000344 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000346 F128 0000                    DW  0
       F12A                     _CLPS:
000348 F12A 0000                    DW  0
       F12C                     _LEFT:
00034A F12C 0000                    DW  0
       F12E                     _DTPS:
00034C F12E 0000                    DW  0
       F130                     _DTA:
00034E F130 0000                    DW  0
       F132                     FLG_LDIR:
000350 F132 00                      DB  0
       F133                     _FCB:
000351 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000353 F135 00                      DB  0
       F136                     _BUF_ST:
000354 F136 0000                    DW  0
       F138                     _BUF_EN:
000356 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000358 F13A 0000                    DW  0
       F13C                     _BUF_H:
00035A F13C 0000                    DW  0
       F13E                     _BUF_X:
00035C F13E 0000                    DW  0
       F140                     _BUF_Y:
00035E F140 00                      DB  0
       F141                     _BUF_P:
00035F F141 00                      DB  0
       F142                     _BUF_O:
000360 F142 00                      DB  0
       F143                     DTAX:
000361 F143 0000                    DW  0
       F145                     B_DRIVE:
000363 F145 00                      DB  0
       F146                     _DVSW:
000364 F146 00                      DB  0
       F147                     DIRENT1:
000365 F147 0000                    DW  0
       F149                     _DIR_BANK:
000367 F149 00                      DB  0
       F14A                     LEFTX:
000368 F14A 0000                    DW  0
       F14C                     PARAM0:
00036A F14C 0000                    DW  0
       F14E                     PARAM1:
00036C F14E 0000                    DW  0
       F150                     FDRV:
00036E F150 00                      DB  0
       F151                     FNAME:
00036F F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
00037A F15C 0000                    DW  0
       F15E                     _CDX:
00037C F15E 0000                    DW  0
       F160                     _HL:
00037E F160 0000                    DW  0
       F162                     _SP:
000380 F162 0000                    DW  0
                                
       F164                     ISC_E:
000382 4382                         ORG $$+RUN          ;$DEPHASE
                                
       4382                     MSX1:
000382 4382 CD9E50          17      CALL    MSGA1
       4385                     MSX:
000385 4385 7E               7      LD  A,(HL)
000386 4386 23               6      INC HL
000387 4387 B7               4      OR  A
000388 4388 20F8            12      JR  NZ,MSX1
00038A 438A C9              10      RET
                                
       438B                     PRTHX:
00038B 438B F5              11      PUSH    AF
00038C 438C 07               4      RLCA
00038D 438D 07               4      RLCA
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 CD9443          17      CALL    PRTA2
000393 4393 F1              10      POP AF
       4394                     PRTA2:
000394 4394 CD9A43          17      CALL    ASC
000397 4397 C39A50          10      JP  MSG_A
                                    
       439A                     ASC:
00039A 439A E60F             7      AND $0F
00039C 439C F630             7      OR  $30
00039E 439E FE3A             7      CP  $3A
0003A0 43A0 D8              11      RET C
0003A1 43A1 C607             7      ADD A,7
0003A3 43A3 C9              10      RET
                                
       43A4                     MSN:
0003A4 43A4 7E               7      LD  A,(HL)
0003A5 43A5 23               6      INC HL
0003A6 43A6 CD9A50          17      CALL    MSG_A
0003A9 43A9 10F9            13      DJNZ    MSN
0003AB 43AB C9              10      RET
                                
       43AC                     ROM_BOOT:
0003AC 43AC 3E                      DB  03EH
0003AD 43AD C9              10      RET
0003AE 43AE 32DBFD          13      LD  (H_PINL),A
                                
0003B1 43B1 210444          10      LD  HL,DELOK
0003B4 43B4 CD8543          17      CALL    MSX
                                
0003B7 43B7 AF               4      XOR A
0003B8 43B8 3240F3          13      LD  (REBOOT),A
0003BB 43BB 2A48FC          16      LD  HL,(BOTTOM)
0003BE 43BE 110040          10      LD  DE,16384
0003C1 43C1 19              11      ADD HL,DE
0003C2 43C2 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003C4 43C4 57               4      LD  D,A
0003C5 43C5 0601             7      LD  B,1
0003C7 43C7 2100C0          10      LD  HL,0C000H
0003CA 43CA CD624E          17      CALL    DISKIO
                                
0003CD 43CD 116BF3          10      LD  DE,RAMUSE
0003D0 43D0 AF               4      XOR A
0003D1 43D1 CD1EC0          17      CALL    0C01EH
0003D4 43D4 116BF3          10      LD  DE,RAMUSE
0003D7 43D7 37               4      SCF
0003D8 43D8 CD1EC0          17      CALL    0C01EH
       43DB                     BOOT1:
0003DB 43DB C3ED4F          10      JP  BASENT
                                
       43DE                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003DE 43DE 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       4403                     NULL:
000403 4403 00                      DB  0
       4404                     DELOK:
000404 4404 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4408                     ROM_LDIR:
000408 4408 3A32F1          13      LD  A,(FLG_LDIR)
00040B 440B B7               4      OR  A
00040C 440C 2008            12      JR  NZ,ROM_LDIRVM
00040E 440E CB7A             8      BIT 7,D
000410 4410 CA2844          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
000413 4413 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                    EI
                                #endif
000415 4415 C9              10      RET
                                
       4416                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000416 4416 C5              11      PUSH    BC
000417 4417 D5              11      PUSH    DE
000418 4418 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00041C 441C DD215C00        14      LD  IX,LDIRVM
000420 4420 CD1C00          17      CALL    _CALSLT
000423 4423 E1              10      POP HL
000424 4424 C1              10      POP BC
000425 4425 09              11      ADD HL,BC
000426 4426 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000427 4427 C9              10      RET
                                #endif
                                
       4428                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4428                     ROM_LDIRSLT1:
000428 4428 EB               4      EX  DE,HL
       4429                     RLDIRSLT1:
000429 4429 1A               7      LD  A,(DE)
00042A 442A 13               6      INC DE
00042B 442B C5              11      PUSH    BC
00042C 442C D5              11      PUSH    DE
00042D 442D E5              11      PUSH    HL
00042E 442E 5F               4      LD  E,A
                                
00042F 442F 0141F3          10      LD  BC,RAMAD0
000432 4432 7C               4      LD  A,H
000433 4433 07               4      RLCA
000434 4434 07               4      RLCA
000435 4435 E603             7      AND 3
000437 4437 81               4      ADD A,C
000438 4438 4F               4      LD  C,A
000439 4439 0A               7      LD  A,(BC)
       443A                     RLDIRSLT2:
00043A 443A CD1400          17      CALL    _WRSLT
00043D 443D 08               4      EX  AF,AF'
00043E 443E E1              10      POP HL
00043F 443F D1              10      POP DE
000440 4440 C1              10      POP BC
000441 4441 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000443 4443 EA2944          10      JP  PE,RLDIRSLT1
000446 4446 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000447 4447 C9              10      RET
                                #endif
                                
       4448                     END_OF_LINE:
000448 4448 215EF5          10      LD  HL,BUF
       444B                     EOL1:
00044B 444B 7E               7      LD  A,(HL)
00044C 444C C8              11      RET Z
00044D 444D FE0D             7      CP  00DH
00044F 444F 2807            12      JR  Z,EOLE
000451 4451 FE0A             7      CP  00AH
000453 4453 2803            12      JR  Z,EOLE
000455 4455 23               6      INC HL
000456 4456 18F3            12      JR  EOL1
       4458                     EOLE:
000458 4458 3600            10      LD  (HL),0
00045A 445A 23               6      INC HL
00045B 445B 7E               7      LD  A,(HL)
00045C 445C FE0A             7      CP  00AH
00045E 445E C0              11      RET NZ
00045F 445F 23               6      INC HL
000460 4460 C9              10      RET
                                
       4461                     ROM_LOAD_ASCII:
000461 4461 210000          10      LD  HL,0
000464 4464 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000467 4467 2A76F6          16      LD  HL,(TXTTAB)
00046A 446A 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00046D 446D 215EF5          10      LD  HL,BUF
000470 4470 2230F1          16      LD  (_DTA),HL
       4473                     RLOAD_A1:
000473 4473 2A36F1          16      LD  HL,(_BUF_ST)
000476 4476 2226F1          16      LD  (RR_LOW),HL
000479 4479 210201          10      LD  HL,258
00047C 447C CDE748          17      CALL    ROM_READ
00047F 447F 7C               4      LD  A,H
000480 4480 B5               4      OR  L
000481 4481 2877            12      JR  Z,RLOAD_AEND
000483 4483 015EF5          10      LD  BC,BUF
000486 4486 09              11      ADD HL,BC
000487 4487 3600            10      LD  (HL),0
000489 4489 CD4844          17      CALL    END_OF_LINE
00048C 448C 015EF5          10      LD  BC,BUF
00048F 448F A7               4      AND A
000490 4490 ED42            15      SBC HL,BC
000492 4492 2810            12      JR  Z,RLOAD_A2
000494 4494 4D               4      LD  C,L
000495 4495 44               4      LD  B,H
000496 4496 ED5B36F1        20      LD  DE,(_BUF_ST)
00049A 449A 19              11      ADD HL,DE
00049B 449B 2236F1          16      LD  (_BUF_ST),HL
00049E 449E 3A5EF5          13      LD  A,(BUF)
0004A1 44A1 B7               4      OR  A
0004A2 44A2 28CF            12      JR  Z,RLOAD_A1
       44A4                     RLOAD_A2:
0004A4 44A4 115EF5          10      LD  DE,BUF
0004A7 44A7 CD9E4A          17      CALL    SPCUTEX
0004AA 44AA 1A               7      LD  A,(DE)
0004AB 44AB B7               4      OR  A
0004AC 44AC 284C            12      JR  Z,RLOAD_AEND
0004AE 44AE CDB04A          17      CALL    GETNUM
0004B1 44B1 7C               4      LD  A,H
0004B2 44B2 B5               4      OR  L
0004B3 44B3 CA5945          10      JP  Z,ERROR_DIRECT_IN_FILE
0004B6 44B6 DD2A38F1        20      LD  IX,(_BUF_EN)
0004BA 44BA DD7502          19      LD  (IX+2),L
0004BD 44BD DD7403          19      LD  (IX+3),H
                                
0004C0 44C0 CD974A          17      CALL    SPCUT
0004C3 44C3 EB               4      EX  DE,HL
0004C4 44C4 DDE5            15      PUSH    IX
0004C6 44C6 DD21B242        14      LD  IX,CRUNCH
0004CA 44CA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004CE 44CE CD1C00          17      CALL    _CALSLT
0004D1 44D1 DDE1            14      POP IX
0004D3 44D3 EB               4      EX  DE,HL
0004D4 44D4 111FF4          10      LD  DE,KBUF
0004D7 44D7 37               4      SCF
0004D8 44D8 ED52            15      SBC HL,DE
0004DA 44DA 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
0004DC 44DC 387B            12      JR  C,ERROR_DIRECT_IN_FILE
0004DE 44DE 4D               4      LD  C,L
0004DF 44DF 44               4      LD  B,H
0004E0 44E0 2A38F1          16      LD  HL,(_BUF_EN)
0004E3 44E3 110400          10      LD  DE,4
0004E6 44E6 19              11      ADD HL,DE
0004E7 44E7 111FF4          10      LD  DE,KBUF
                                
0004EA 44EA EB               4      EX  DE,HL
0004EB 44EB EDB0                    LDIR
0004ED 44ED EB               4      EX  DE,HL
                                
0004EE 44EE DD7500          19      LD  (IX+0),L
0004F1 44F1 DD7401          19      LD  (IX+1),H
0004F4 44F4 2238F1          16      LD  (_BUF_EN),HL
0004F7 44F7 C37344          10      JP  RLOAD_A1
                                
       44FA                     RLOAD_AEND:
0004FA 44FA 2A38F1          16      LD  HL,(_BUF_EN)
0004FD 44FD AF               4      XOR A
0004FE 44FE 77               7      LD  (HL),A
0004FF 44FF 23               6      INC HL
000500 4500 77               7      LD  (HL),A
000501 4501 23               6      INC HL
000502 4502 2238F1          16      LD  (_BUF_EN),HL
000505 4505 183B            12      JR  RLOAD_END1
                                
       4507                     ROM_LOAD:
000507 4507 CD9646          17      CALL    INIT_PARAM
00050A 450A CD8849          17      CALL    FILE_B
00050D 450D 3A51F1          13      LD  A,(FNAME)
000510 4510 FE20             7      CP  020H
000512 4512 CA8349          10      JP  Z,ROM_ORG
                                
000515 4515 CD074B          17      CALL    ROM_OPEN
000518 4518 3848            12      JR  C,ERROR_FILE_NOT_FOUND
       451A                     ROM_LOAD1:
00051A 451A 2135F1          10      LD  HL,_BUF
00051D 451D 2230F1          16      LD  (_DTA),HL
000520 4520 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000523 4523 CDE748          17      CALL    ROM_READ
000526 4526 3A35F1          13      LD  A,(_BUF)
000529 4529 3C               4      INC A
00052A 452A C26144          10      JP  NZ,ROM_LOAD_ASCII
00052D 452D 2A76F6          16      LD  HL,(TXTTAB)
000530 4530 2230F1          16      LD  (_DTA),HL
000533 4533 EB               4      EX  DE,HL
000534 4534 2100FF          10      LD  HL,-256
000537 4537 39              11      ADD HL,SP
000538 4538 ED52            15      SBC HL,DE
00053A 453A CDE748          17      CALL    ROM_READ
00053D 453D ED5B30F1        20      LD  DE,(_DTA)
000541 4541 19              11      ADD HL,DE
       4542                     RLOAD_END1:
000542 4542 22C2F6          16      LD  (VARTAB),HL
000545 4545 22C4F6          16      LD  (ARYTAB),HL
000548 4548 22C6F6          16      LD  (STREND),HL
                                
00054B 454B AF               4      XOR A
00054C 454C 2138F1          10      LD  HL,_BUF+3
00054F 454F 77               7      LD  (HL),A
000550 4550 2B               6      DEC HL
000551 4551 77               7      LD  (HL),A
000552 4552 2B               6      DEC HL
000553 4553 77               7      LD  (HL),A
000554 4554 2B               6      DEC HL
000555 4555 3E8F             7      LD  A,08FH          ;REM
000557 4557 77               7      LD  (HL),A
000558 4558 C9              10      RET
                                
       4559                     ERROR_DIRECT_IN_FILE:
000559 4559 1E39             7      LD  E,57            ;Direct statement in file
00055B 455B 01                      DB  1           ;LD BC,
       455C                     ERROR_INTERNAL_ERROR:
00055C 455C 1E33             7      LD  E,51            ;Internal error
00055E 455E 01                      DB  1           ;LD BC,
       455F                     ERROR_FILE_NOT_OPEN:
00055F 455F 1E3B             7      LD  E,59            ;File not OPEN
000561 4561 01                      DB  1           ;LD BC,
       4562                     ERROR_FILE_NOT_FOUND:
000562 4562 1E35             7      LD  E,53            ;File not found
       4564                     ERROR:
000564 4564 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000568 4568 DD216F40        14      LD  IX,ERRHAND
00056C 456C C31C00          10      JP  _CALSLT
                                
       456F                     ROM_BLOAD:
00056F 456F CD9646          17      CALL    INIT_PARAM
000572 4572 CD8849          17      CALL    FILE_B
000575 4575 CD074B          17      CALL    ROM_OPEN
000578 4578 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00057A 457A 2135F1          10      LD  HL,_BUF
00057D 457D 2230F1          16      LD  (_DTA),HL
000580 4580 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000583 4583 CDE748          17      CALL    ROM_READ
000586 4586 3A35F1          13      LD  A,(_BUF)
000589 4589 FEFE             7      CP  0FEH
00058B 458B 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00058D 458D 210EF1          10      LD  HL,BLOAD_RET
000590 4590 2206F1          16      LD  (SWC_BLOAD),HL
                                
000593 4593 2A4EF1          16      LD  HL,(PARAM1)
000596 4596 7E               7      LD  A,(HL)
000597 4597 FE2C             7      CP  ','
000599 4599 2048            12      JR  NZ,RBREAD_MEM
00059B 459B 23               6      INC HL
00059C 459C 7E               7      LD  A,(HL)
00059D 459D CDF14A          17      CALL    CAP
0005A0 45A0 32BEFC          13      LD  (RUNBNF),A
       45A3                     RBOS1:
0005A3 45A3 7E               7      LD  A,(HL)
0005A4 45A4 23               6      INC HL
0005A5 45A5 B7               4      OR  A
0005A6 45A6 282F            12      JR  Z,RBREAD_OSE
0005A8 45A8 FE3A             7      CP  ':'
0005AA 45AA 282B            12      JR  Z,RBREAD_OSE
0005AC 45AC FE2C             7      CP  ','     ;次のパラメータを探す
0005AE 45AE 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005B0 45B0 224EF1          16      LD  (PARAM1),HL
0005B3 45B3 7E               7      LD  A,(HL)
0005B4 45B4 B7               4      OR  A
0005B5 45B5 2820            12      JR  Z,RBREAD_OSE
0005B7 45B7 DD21644C        14      LD  IX,FRMEVL
0005BB 45BB FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005BF 45BF CD1C00          17      CALL    _CALSLT
0005C2 45C2 224EF1          16      LD  (PARAM1),HL
0005C5 45C5 3A63F6          13      LD  A,(VALTYP)
0005C8 45C8 FE02             7      CP  2
0005CA 45CA 200B            12      JR  NZ,RBREAD_OSE
0005CC 45CC 2A36F1          16      LD  HL,(_BUF_ST)
0005CF 45CF ED5BF8F7        20      LD  DE,(DACDAT)
0005D3 45D3 19              11      ADD HL,DE
0005D4 45D4 2236F1          16      LD  (_BUF_ST),HL
       45D7                     RBREAD_OSE:
0005D7 45D7 3ABEFC          13      LD  A,(RUNBNF)
0005DA 45DA FE53             7      CP  'S'
0005DC 45DC 2005            12      JR  NZ,RBREAD_MEM
0005DE 45DE 3E01             7      LD  A,1
0005E0 45E0 3232F1          13      LD  (FLG_LDIR),A
       45E3                     RBREAD_MEM:
0005E3 45E3 2A36F1          16      LD  HL,(_BUF_ST)
0005E6 45E6 22BFFC          16      LD  (SAVENT),HL
0005E9 45E9 2230F1          16      LD  (_DTA),HL
0005EC 45EC 21FFFF          10      LD  HL,0FFFFH
0005EF 45EF CDE748          17      CALL    ROM_READ
0005F2 45F2 3ABEFC          13      LD  A,(RUNBNF)
0005F5 45F5 FE52             7      CP  'R'
0005F7 45F7 2006            12      JR  NZ,RBREAD1
0005F9 45F9 2A3AF1          16      LD  HL,(_BUF_EX)
0005FC 45FC 2206F1          16      LD  (SWC_BLOAD),HL
       45FF                     RBREAD1:
       45FF                     ROM_NEXT:
0005FF 45FF 2A4EF1          16      LD  HL,(PARAM1)
000602 4602 7E               7      LD  A,(HL)
000603 4603 2B               6      DEC HL
000604 4604 B7               4      OR  A
000605 4605 2805            12      JR  Z,RN1
000607 4607 FE3A             7      CP  ':'
000609 4609 2801            12      JR  Z,RN1
00060B 460B 23               6      INC HL
       460C                     RN1:
00060C 460C 5D               4      LD  E,L
00060D 460D 54               4      LD  D,H
                                
00060E 460E CDC74A          17      CALL    SEARCH_END
000611 4611 B7               4      OR  A
000612 4612 2821            12      JR  Z,REM
       4614                     RN3:                    ;マルチステートメントの処理
000614 4614 7E               7      LD  A,(HL)
                                
000615 4615 FEB5             7      CP  0B5H            ;LOAD
000617 4617 CA0745          10      JP  Z,ROM_LOAD
00061A 461A FE8A             7      CP  08AH            ;RUN
00061C 461C 281B            12      JR  Z,ROM_RUN
00061E 461E FEB7             7      CP  0B7H            ;FILES
000620 4620 2824            12      JR  Z,ROM_FILES
000622 4622 FED6             7      CP  0D6H            ;COPY
000624 4624 CACC46          10      JP  Z,ROM_COPY
000627 4627 FE20             7      CP  020H
000629 4629 2807            12      JR  Z,RN_SP
                                
00062B 462B 3E28             7      LD  A,028H          ;JR Z,
00062D 462D 320CF1          13      LD  (SWC_BLOAD_M),A
000630 4630 7E               7      LD  A,(HL)
000631 4631 C9              10      RET
       4632                     RN_SP:
000632 4632 23               6      INC HL
000633 4633 18DF            12      JR  RN3
                                
       4635                     REM:
000635 4635 EB               4      EX  DE,HL
000636 4636 3E8F             7      LD  A,08FH          ;REM
000638 4638 C9              10      RET
                                
       4639                     ROM_RUN:
000639 4639 23               6      INC HL
00063A 463A 7E               7      LD  A,(HL)
00063B 463B 2B               6      DEC HL
00063C 463C B7               4      OR  A
00063D 463D 2803            12      JR  Z,ROM_RUN1
00063F 463F CD0745          17      CALL    ROM_LOAD
       4642                     ROM_RUN1:
000642 4642 3E8A             7      LD  A,08AH          ;RUN
000644 4644 77               7      LD  (HL),A
000645 4645 C9              10      RET
                                
       4646                     ROM_FILES:
000646 4646 CD9646          17      CALL    INIT_PARAM
000649 4649 CD8849          17      CALL    FILE_B
00064C 464C CD2D50          17      CALL    GET_DISK_BANK_FDRV
00064F 464F 3A51F1          13      LD  A,(FNAME)
000652 4652 FE21             7      CP  021H
000654 4654 3005            12      JR  NC,RFILES0
000656 4656 060B             7      LD  B,11
000658 4658 CD5B4A          17      CALL    FILE10
       465B                     RFILES0:
00065B 465B CD744D          17      CALL    GET_DIR_DAT
       465E                     RFILES1:
00065E 465E CD234B          17      CALL    FILESE
000661 4661 302E            12      JR  NC,RFILES_NOT_MATCH
       4663                     RFILES_DISP:
000663 4663 E5              11      PUSH    HL
000664 4664 0608             7      LD  B,8
000666 4666 CDA443          17      CALL    MSN
000669 4669 3E2E             7      LD  A,'.'
00066B 466B CD9A50          17      CALL    MSG_A
00066E 466E 0603             7      LD  B,3
000670 4670 CDA443          17      CALL    MSN
000673 4673 3ADDF3          13      LD  A,(CSRX)
000676 4676 47               4      LD  B,A
000677 4677 3AB0F3          13      LD  A,(LINLEN)
00067A 467A 90               4      SUB B
00067B 467B FE0C             7      CP  12
00067D 467D 3009            12      JR  NC,RFILES2
00067F 467F 3E0D             7      LD  A,00DH      ;改行
000681 4681 CD9A50          17      CALL    MSG_A
000684 4684 3E0A             7      LD  A,00AH
000686 4686 1802            12      JR  RFILES3
       4688                     RFILES2:
000688 4688 3E20             7      LD  A,020H
       468A                     RFILES3:
00068A 468A CD9A50          17      CALL    MSG_A
00068D 468D E1              10      POP HL
00068E 468E CD3F4B          17      CALL    FNEXT
       4691                     RFILES_NOT_MATCH:
000691 4691 20CB            12      JR  NZ,RFILES1
000693 4693 C3FF45          10      JP  ROM_NEXT
                                
       4696                     INIT_PARAM:
000696 4696 224CF1          16      LD  (PARAM0),HL
000699 4699 224EF1          16      LD  (PARAM1),HL
00069C 469C EB               4      EX  DE,HL
00069D 469D AF               4      XOR A
00069E 469E 3232F1          13      LD  (FLG_LDIR),A
0006A1 46A1 32BEFC          13      LD  (RUNBNF),A
0006A4 46A4 3263F6          13      LD  (VALTYP),A
0006A7 46A7 E5              11      PUSH    HL
0006A8 46A8 2A5CF1          16      LD  HL,(_CD)
0006AB 46AB 225EF1          16      LD  (_CDX),HL
0006AE 46AE E1              10      POP HL
0006AF 46AF 13               6      INC DE
0006B0 46B0 CD974A          17      CALL    SPCUT
0006B3 46B3 1A               7      LD  A,(DE)
0006B4 46B4 B7               4      OR  A
0006B5 46B5 C8              11      RET Z
0006B6 46B6 FE3A             7      CP  ':'
0006B8 46B8 C8              11      RET Z
0006B9 46B9 FE28             7      CP  '('
0006BB 46BB C8              11      RET Z
0006BC 46BC EB               4      EX  DE,HL
0006BD 46BD DD21644C        14      LD  IX,FRMEVL
0006C1 46C1 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006C5 46C5 CD1C00          17      CALL    _CALSLT
0006C8 46C8 224EF1          16      LD  (PARAM1),HL
0006CB 46CB C9              10      RET
                                
       46CC                     ROM_COPY:
0006CC 46CC CD9646          17      CALL    INIT_PARAM
0006CF 46CF 3A63F6          13      LD  A,(VALTYP)
0006D2 46D2 FE03             7      CP  3       ;string
0006D4 46D4 C28349          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
0006D7 46D7 CD8849          17      CALL    FILE_B
0006DA 46DA CD074B          17      CALL    ROM_OPEN
0006DD 46DD DA6245          10      JP  C,ERROR_FILE_NOT_FOUND
                                
0006E0 46E0 213AF1          10      LD  HL,_BUF_W
0006E3 46E3 2230F1          16      LD  (_DTA),HL
0006E6 46E6 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
0006E9 46E9 CDE748          17      CALL    ROM_READ
                                
0006EC 46EC AF               4      XOR A
0006ED 46ED 3235F1          13      LD  (_BUF_LO),A     ;PSET
0006F0 46F0 3242F1          13      LD  (_BUF_O),A      ;向き
                                
0006F3 46F3 2A4EF1          16      LD  HL,(PARAM1)
       46F6                     RCP_PARAM1:
0006F6 46F6 7E               7      LD  A,(HL)
0006F7 46F7 23               6      INC HL
0006F8 46F8 B7               4      OR  A
0006F9 46F9 CA8349          10      JP  Z,ROM_ORG
0006FC 46FC FE3A             7      CP  ':'
0006FE 46FE CA8349          10      JP  Z,ROM_ORG
000701 4701 FE2C             7      CP  ','
000703 4703 2012            12      JR  NZ,RCP_PARAM1_
                                
000705 4705 DD212F54        14      LD  IX,FRMQNT
000709 4709 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00070D 470D CD1C00          17      CALL    _CALSLT
000710 4710 7B               4      LD  A,E
000711 4711 87               4      ADD A,A
000712 4712 87               4      ADD A,A
000713 4713 3242F1          13      LD  (_BUF_O),A
000716 4716 7E               7      LD  A,(HL)
       4717                     RCP_PARAM1_:
000717 4717 FE28             7      CP  '('
000719 4719 20DB            12      JR  NZ,RCP_PARAM1
                                
00071B 471B DD212F54        14      LD  IX,FRMQNT
00071F 471F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000723 4723 CD1C00          17      CALL    _CALSLT
                                
000726 4726 ED533EF1        20      LD  (_BUF_X),DE
                                
       472A                     RCP_PARAM2:
00072A 472A 23               6      INC HL
00072B 472B 7E               7      LD  A,(HL)
00072C 472C FE20             7      CP  020H
00072E 472E 28FA            12      JR  Z,RCP_PARAM2
000730 4730 FE2C             7      CP  ','
000732 4732 28F6            12      JR  Z,RCP_PARAM2
                                
000734 4734 DD212F54        14      LD  IX,FRMQNT
000738 4738 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00073C 473C CD1C00          17      CALL    _CALSLT
                                
00073F 473F ED5340F1        20      LD  (_BUF_Y),DE
       4743                     RCP_PARAM3:
000743 4743 23               6      INC HL
000744 4744 7E               7      LD  A,(HL)
000745 4745 FE20             7      CP  020H
000747 4747 28FA            12      JR  Z,RCP_PARAM3
000749 4749 FE29             7      CP  ')'
00074B 474B 28F6            12      JR  Z,RCP_PARAM3
00074D 474D FE2C             7      CP  ','
00074F 474F 2033            12      JR  NZ,RCP_ST
                                
000751 4751 23               6      INC HL
000752 4752 DD212F54        14      LD  IX,FRMQNT
000756 4756 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00075A 475A CD1C00          17      CALL    _CALSLT
                                
00075D 475D 7B               4      LD  A,E
00075E 475E 3241F1          13      LD  (_BUF_P),A
                                
       4761                     RCP_PARAM4:
000761 4761 7E               7      LD  A,(HL)
000762 4762 23               6      INC HL
000763 4763 FE20             7      CP  020H
000765 4765 28FA            12      JR  Z,RCP_PARAM4
                                
000767 4767 FE2C             7      CP  ','
000769 4769 2019            12      JR  NZ,RCP_ST
                                
00076B 476B 7E               7      LD  A,(HL)
00076C 476C 0604             7      LD  B,4
00076E 476E FEC3             7      CP  0C3H        ;PRESET
000770 4770 280E            12      JR  Z,RCP_LO
000772 4772 05               4      DEC B       ;3
000773 4773 D6F8             7      SUB 0F8H        ;XOR
000775 4775 2809            12      JR  Z,RCP_LO
000777 4777 05               4      DEC B       ;2
000778 4778 3C               4      INC A       ;OR
000779 4779 2805            12      JR  Z,RCP_LO
00077B 477B 05               4      DEC B       ;1
00077C 477C 3C               4      INC A       ;AND
00077D 477D 2801            12      JR  Z,RCP_LO
00077F 477F 05               4      DEC B       ;0
                                                ;PSET
       4780                     RCP_LO:
000780 4780 78               4      LD  A,B
000781 4781 3235F1          13      LD  (_BUF_LO),A
       4784                     RCP_ST:
000784 4784 2AC6F6          16      LD  HL,(STREND)
000787 4787 2230F1          16      LD  (_DTA),HL
00078A 478A EB               4      EX  DE,HL
00078B 478B 2100FE          10      LD  HL,-512
00078E 478E 39              11      ADD HL,SP
00078F 478F AF               4      XOR A
000790 4790 ED52            15      SBC HL,DE
000792 4792 3008            12      JR  NC,RCP0
000794 4794 215EF5          10      LD  HL,BUF
000797 4797 2230F1          16      LD  (_DTA),HL
00079A 479A 6F               4      LD  L,A ;0
00079B 479B 67               4      LD  H,A ;0
       479C                     RCP0:
00079C 479C 24               4      INC H
00079D 479D 2238F1          16      LD  (_BUF_EN),HL
       47A0                     RCP1:
0007A0 47A0 F3               4      DI
0007A1 47A1 CD7548          17      CALL    WAIT_VDP
                                
0007A4 47A4 3A0700          13      LD  A,(WRVDP)
0007A7 47A7 4F               4      LD  C,A
0007A8 47A8 0C               4      INC C       ;C := PORT#1's address(WR)
0007A9 47A9 3E24             7      LD  A,36
0007AB 47AB ED79            12      OUT (C),A
0007AD 47AD 3E91             7      LD  A,080H+17
0007AF 47AF ED79            12      OUT (C),A       ;R#17 := 36
                                
0007B1 47B1 0C               4      INC C
0007B2 47B2 0C               4      INC C       ;C := PORT#3's address(WR)
0007B3 47B3 2A3EF1          16      LD  HL,(_BUF_X)
0007B6 47B6 ED69            12      OUT (C),L       ;R#36 DX
0007B8 47B8 ED61            12      OUT (C),H       ;R#37
0007BA 47BA 2A40F1          16      LD  HL,(_BUF_Y)
0007BD 47BD ED69            12      OUT (C),L       ;R#38 DY
0007BF 47BF ED61            12      OUT (C),H       ;R#39
0007C1 47C1 2A3AF1          16      LD  HL,(_BUF_W)
0007C4 47C4 ED69            12      OUT (C),L       ;R#40 NX
0007C6 47C6 ED61            12      OUT (C),H       ;R#41
0007C8 47C8 2A3CF1          16      LD  HL,(_BUF_H)
0007CB 47CB ED69            12      OUT (C),L       ;R#42 NY
0007CD 47CD ED61            12      OUT (C),H       ;R#43
                                
0007CF 47CF DD2AAFFC        20      LD  IX,(SCRMOD)
0007D3 47D3 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0007D6 47D6 B7               4      OR  A
0007D7 47D7 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
0007D9 47D9 DD7D             9      LD  A,IXL
0007DB 47DB FE08             7      CP  8
0007DD 47DD 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
0007DF 47DF FE06             7      CP  6
0007E1 47E1 2A3EF1          16      LD  HL,(_BUF_X)
0007E4 47E4 3A3AF1          13      LD  A,(_BUF_W)
0007E7 47E7 2005            12      JR  NZ,SCR57
0007E9 47E9 B5               4      OR  L       ;スクリーン6
0007EA 47EA E603             7      AND 3
0007EC 47EC 200D            12      JR  NZ,USE_LMMC
       47EE                     SCR57:              ;スクリーン5,7
0007EE 47EE B5               4      OR  L
0007EF 47EF E601             7      AND 1
0007F1 47F1 2008            12      JR  NZ,USE_LMMC
       47F3                     USE_HMMC:
0007F3 47F3 DD2E08          10      LD  IXL,8
       47F6                     USE_HMMC8:
0007F6 47F6 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
0007F8 47F8 3235F1          13      LD  (_BUF_LO),A
       47FB                     USE_LMMC:
0007FB 47FB 110000          10      LD  DE,0
0007FE 47FE 06FF             7      LD  B,-1
000800 4800 CDA048          17      CALL    GET_PIXEL
000803 4803 ED79            12      OUT (C),A       ;R#44 first DATA
000805 4805 3A42F1          13      LD  A,(_BUF_O)
000808 4808 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
00080A 480A 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00080D 480D F6B0             7      OR  0B0H        ;R#46 LMMC command
00080F 480F ED79            12      OUT (C),A
                                
000811 4811 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000813 4813 0D               4      DEC C
000814 4814 0D               4      DEC C       ;C := PORT#1's address(WR)
000815 4815 3EAC             7      LD  A,080H+44
000817 4817 ED79            12      OUT (C),A
000819 4819 3E91             7      LD  A,080H+17
00081B 481B ED79            12      OUT (C),A       ;R#17 := 44
                                
00081D 481D 3A0600          13      LD  A,(RDVDP)
000820 4820 3C               4      INC A
000821 4821 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000823 4823 3E02             7      LD  A,2
000825 4825 ED79            12      OUT (C),A
000827 4827 3E8F             7      LD  A,08FH
000829 4829 ED79            12      OUT (C),A
00082B 482B 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00082E 482E E640             7      AND 040H
000830 4830 201C            12      JR  NZ,LOOP_HMMC
       4832                     LOOP_COPY:
000832 4832 CDA048          17      CALL    GET_PIXEL
000835 4835 08               4      EX  AF,AF'
000836 4836 FD4C             9      LD  C,IYH
       4838                     LOOP_COPY1:
000838 4838 ED78            12      IN  A,(C)
00083A 483A 0F               4      RRCA            ;RRCAではサインフラグは変化しない
00083B 483B 300A            12      JR  NC,EXIT_COPY    ;check CE bit
00083D 483D F23848          10      JP  P,LOOP_COPY1    ;check TR bit
000840 4840 08               4      EX  AF,AF'
000841 4841 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000843 4843 ED79            12      OUT (C),A
000845 4845 18EB            12      JR  LOOP_COPY
                                
       4847                     EXIT_COPY:
000847 4847 CD7D48          17      CALL    GET_STATUS_0
00084A 484A FB               4      EI
00084B 484B C3FF45          10      JP  ROM_NEXT
                                
       484E                     LOOP_HMMC:
00084E 484E FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000850 4850 43               4      LD  B,E
000851 4851 7B               4      LD  A,E
000852 4852 B7               4      OR  A
000853 4853 2802            12      JR  Z,LOOP_HMMC1
000855 4855 EDB3                    OTIR
       4857                     LOOP_HMMC1:
000857 4857 14               4      INC D
       4858                     LOOP_HMMC2:
000858 4858 15               4      DEC D
000859 4859 2805            12      JR  Z,LOOP_HMMC3
00085B 485B EDB3                    OTIR
00085D 485D C35848          10      JP  LOOP_HMMC2
       4860                     LOOP_HMMC3:
000860 4860 ED78            12      IN  A,(C)
000862 4862 0F               4      RRCA
000863 4863 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
000865 4865 2A38F1          16      LD  HL,(_BUF_EN)
000868 4868 CDE748          17      CALL    ROM_READ
00086B 486B EB               4      EX  DE,HL
00086C 486C 2A30F1          16      LD  HL,(_DTA)
00086F 486F 7A               4      LD  A,D
000870 4870 B3               4      OR  E
000871 4871 20DB            12      JR  NZ,LOOP_HMMC
000873 4873 18C3            12      JR  LOOP_COPY1
                                    
       4875                     WAIT_VDP:
000875 4875 3E02             7      LD  A,2
000877 4877 CD7E48          17      CALL    GET_STATUS
00087A 487A 0F               4      RRCA
00087B 487B 38F8            12      JR  C,WAIT_VDP
       487D                     GET_STATUS_0:
00087D 487D AF               4      XOR A
       487E                     GET_STATUS:
00087E 487E C5              11      PUSH    BC
00087F 487F ED4B0600        20      LD  BC,(RDVDP)
000883 4883 0C               4      INC C
000884 4884 ED79            12      OUT (C),A
000886 4886 3E8F             7      LD  A,08FH
000888 4888 ED79            12      OUT (C),A
00088A 488A ED78            12      IN  A,(C)
00088C 488C C1              10      POP BC
00088D 488D C9              10      RET
                                
       488E                     GET_PIXEL256:
00088E 488E 7A               4      LD  A,D
00088F 488F B3               4      OR  E
000890 4890 200A            12      JR  NZ,GET_PIXEL1
000892 4892 2A38F1          16      LD  HL,(_BUF_EN)
000895 4895 CDE748          17      CALL    ROM_READ
000898 4898 EB               4      EX  DE,HL
000899 4899 2A30F1          16      LD  HL,(_DTA)
       489C                     GET_PIXEL1:
00089C 489C 7E               7      LD  A,(HL)
00089D 489D 23               6      INC HL
00089E 489E 1B               6      DEC DE
00089F 489F C9              10      RET
                                
       48A0                     GET_PIXEL:
0008A0 48A0 04               4      INC B
0008A1 48A1 DD7D             9      LD  A,IXL
0008A3 48A3 FE08             7      CP  8
0008A5 48A5 28E7            12      JR  Z,GET_PIXEL256
0008A7 48A7 FE06             7      CP  6
0008A9 48A9 282E            12      JR  Z,GET_PIXEL4
                                
0008AB 48AB CB40             8      BIT 0,B
0008AD 48AD 20ED            12      JR  NZ,GET_PIXEL1
                                
0008AF 48AF 7A               4      LD  A,D
0008B0 48B0 B3               4      OR  E
0008B1 48B1 200A            12      JR  NZ,GET_PIXEL2
                                
0008B3 48B3 2A38F1          16      LD  HL,(_BUF_EN)
0008B6 48B6 CDE748          17      CALL    ROM_READ
0008B9 48B9 EB               4      EX  DE,HL
0008BA 48BA 2A30F1          16      LD  HL,(_DTA)
                                
       48BD                     GET_PIXEL2:
0008BD 48BD 7E               7      LD  A,(HL)
0008BE 48BE 0F               4      RRCA
0008BF 48BF 0F               4      RRCA
0008C0 48C0 0F               4      RRCA
0008C1 48C1 0F               4      RRCA
0008C2 48C2 C9              10      RET
                                
       48C3                     GET_PIXEL3:
0008C3 48C3 7A               4      LD  A,D
0008C4 48C4 B3               4      OR  E
0008C5 48C5 200A            12      JR  NZ,GET_PIXEL5
                                
0008C7 48C7 2A38F1          16      LD  HL,(_BUF_EN)
0008CA 48CA CDE748          17      CALL    ROM_READ
0008CD 48CD EB               4      EX  DE,HL
0008CE 48CE 2A30F1          16      LD  HL,(_DTA)
       48D1                     GET_PIXEL5:
0008D1 48D1 7E               7      LD  A,(HL)
0008D2 48D2 0F               4      RRCA
0008D3 48D3 0F               4      RRCA
0008D4 48D4 0F               4      RRCA
0008D5 48D5 0F               4      RRCA
0008D6 48D6 0F               4      RRCA
0008D7 48D7 0F               4      RRCA
0008D8 48D8 C9              10      RET
                                
       48D9                     GET_PIXEL4:
0008D9 48D9 78               4      LD  A,B
0008DA 48DA E603             7      AND 3   ;+0
0008DC 48DC 28E5            12      JR  Z,GET_PIXEL3
0008DE 48DE 3D               4      DEC A   ;+1
0008DF 48DF 28DC            12      JR  Z,GET_PIXEL2
0008E1 48E1 3D               4      DEC A   ;+2
0008E2 48E2 7E               7      LD  A,(HL)
0008E3 48E3 C0              11      RET NZ
0008E4 48E4 0F               4      RRCA        ;+3
0008E5 48E5 0F               4      RRCA
0008E6 48E6 C9              10      RET
                                
       48E7                     ROM_READ:
0008E7 48E7 E5              11      PUSH    HL
0008E8 48E8 D5              11      PUSH    DE
0008E9 48E9 C5              11      PUSH    BC
0008EA 48EA FDE5            15      PUSH    IY
0008EC 48EC 224AF1          16      LD  (LEFTX),HL
0008EF 48EF 2A30F1          16      LD  HL,(_DTA)
0008F2 48F2 2243F1          16      LD  (DTAX),HL
0008F5 48F5 2A4AF1          16      LD  HL,(LEFTX)
                                
0008F8 48F8 CD9A4B          17      CALL    RBX1
0008FB 48FB 3870            12      JR  C,RBRERR1
0008FD 48FD 79               4      LD  A,C
0008FE 48FE EB               4      EX  DE,HL
0008FF 48FF ED52            15      SBC HL,DE       ;CP 0HL,CDE
000901 4901 19              11      ADD HL,DE
000902 4902 DE00             7      SBC A,000H
000904 4904 3801            12      JR  C,RBR1
000906 4906 EB               4      EX  DE,HL
       4907                     RBR1:
000907 4907 9F               4      SBC A,A
000908 4908 E601             7      AND 1
00090A 490A 321FF1          13      LD  (_RESULT),A
00090D 490D 7C               4      LD  A,H
00090E 490E B5               4      OR  L
00090F 490F CA6349          10      JP  Z,RBREND0
                                
000912 4912 222CF1          16      LD  (_LEFT),HL  ;Read record byte
000915 4915 224AF1          16      LD  (LEFTX),HL
                                
000918 4918 CDC64B          17      CALL    RBX2
00091B 491B 281A            12      JR  Z,RBRB
                                                ;先頭の端数
00091D 491D CDD94B          17      CALL    RBXA
000920 4920 DA7949          10      JP  C,RBRERR
000923 4923 C5              11      PUSH    BC
000924 4924 CD0844          17      CALL    ROM_LDIR
000927 4927 ED5343F1        20      LD  (DTAX),DE
00092B 492B 2A4AF1          16      LD  HL,(LEFTX)
00092E 492E D1              10      POP DE
00092F 492F A7               4      AND A
000930 4930 ED52            15      SBC HL,DE
000932 4932 224AF1          16      LD  (LEFTX),HL
000935 4935 2829            12      JR  Z,RBREND
                                
       4937                     RBRB:
000937 4937 CD154C          17      CALL    RBXB
00093A 493A 2818            12      JR  Z,RBRC
       493C                     RBRB1:
00093C 493C C5              11      PUSH    BC
00093D 493D D5              11      PUSH    DE
00093E 493E CDC04C          17      CALL    CLUST
000941 4941 EB               4      EX  DE,HL
000942 4942 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000946 4946 CD0844          17      CALL    ROM_LDIR
000949 4949 EB               4      EX  DE,HL
00094A 494A D1              10      POP DE
00094B 494B C1              10      POP BC
00094C 494C CD9D4C          17      CALL    GNCL
00094F 494F DA7949          10      JP  C,RBRERR
000952 4952 10E8            13      DJNZ    RBRB1
       4954                     RBRC:
000954 4954 CD2D4C          17      CALL    RBXC
000957 4957 2807            12      JR  Z,RBREND
                                
000959 4959 CDC04C          17      CALL    CLUST
00095C 495C EB               4      EX  DE,HL
00095D 495D CD0844          17      CALL    ROM_LDIR
       4960                     RBREND:
000960 4960 CD394C          17      CALL    RBXEND
       4963                     RBREND0:
000963 4963 FDE1            14      POP IY
000965 4965 C1              10      POP BC
000966 4966 D1              10      POP DE
000967 4967 F1              10      POP AF  ;(HL)
000968 4968 AF               4      XOR A
000969 4969 3A1FF1          13      LD  A,(_RESULT)
00096C 496C C9              10      RET
                                
       496D                     RBRERR1:
00096D 496D 3E01             7      LD  A,001H
       496F                     RBRERR2:
00096F 496F FDE1            14      POP IY
000971 4971 C1              10      POP BC
000972 4972 D1              10      POP DE
000973 4973 E1              10      POP HL
000974 4974 37               4      SCF
000975 4975 210000          10      LD  HL,0
000978 4978 C9              10      RET
       4979                     RBRERR:
000979 4979 3EFF             7      LD  A,0FFH
00097B 497B 18F2            12      JR  RBRERR2
                                
       497D                     FILE_DD:
00097D 497D E1              10      POP HL
00097E 497E 3E                      DB  03EH
00097F 497F C9              10      RET
000980 4980 320CF1          13      LD  (SWC_BLOAD_M),A
       4983                     ROM_ORG:
000983 4983 2A4CF1          16      LD  HL,(PARAM0)
000986 4986 7E               7      LD  A,(HL)
000987 4987 C9              10      RET
       4988                     FILE_B:
000988 4988 AF               4      XOR A
000989 4989 3250F1          13      LD  (FDRV),A
00098C 498C 1E00             7      LD  E,0
00098E 498E 3A63F6          13      LD  A,(VALTYP)
000991 4991 FE03             7      CP  3       ;string
000993 4993 C2184A          10      JP  NZ,FILED
                                
000996 4996 DD21D067        14      LD  IX,FRESTR
00099A 499A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00099E 499E CD1C00          17      CALL    _CALSLT
0009A1 49A1 E5              11      PUSH    HL
0009A2 49A2 DDE1            14      POP IX
                                
0009A4 49A4 DD5E00          19      LD  E,(IX+0)
0009A7 49A7 DD7E01          19      LD  A,(IX+1)
0009AA 49AA DD5602          19      LD  D,(IX+2)
0009AD 49AD DD62             9      LD  IXH,D
0009AF 49AF DD6F             9      LD  IXL,A
0009B1 49B1 7B               4      LD  A,E
       49B2                     FILE_BDOS:
0009B2 49B2 FE04             7      CP  4
0009B4 49B4 3808            12      JR  C,FILEB1
0009B6 49B6 DD7E03          19      LD  A,(IX+3)
0009B9 49B9 FE3A             7      CP  ':'
0009BB 49BB 28C0            12      JR  Z,FILE_DD
0009BD 49BD 7B               4      LD  A,E
       49BE                     FILEB1:
0009BE 49BE FE02             7      CP  2
0009C0 49C0 3818            12      JR  C,DEVI1
0009C2 49C2 DD7E01          19      LD  A,(IX+1)
0009C5 49C5 FE3A             7      CP  ':'
0009C7 49C7 2011            12      JR  NZ,DEVI1
0009C9 49C9 DD7E00          19      LD  A,(IX+0)        ;DRIVE
0009CC 49CC CDF14A          17      CALL    CAP
0009CF 49CF D640             7      SUB '@'
0009D1 49D1 DD23            10      INC IX
0009D3 49D3 DD23            10      INC IX
0009D5 49D5 1D               4      DEC E
0009D6 49D6 1D               4      DEC E
0009D7 49D7 3250F1          13      LD  (FDRV),A
       49DA                     DEVI1:
0009DA 49DA DD7E00          19      LD  A,(IX+0)
0009DD 49DD D65C             7      SUB 05CH        ;\
0009DF 49DF 2008            12      JR  NZ,NOROOT
0009E1 49E1 6F               4      LD  L,A
0009E2 49E2 67               4      LD  H,A
0009E3 49E3 225EF1          16      LD  (_CDX),HL
0009E6 49E6 DD23            10      INC IX
0009E8 49E8 1D               4      DEC E
       49E9                     NOROOT:
                                
       49E9                     SETDIR:
0009E9 49E9 CD184A          17      CALL    FILED
0009EC 49EC DD7E00          19      LD  A,(IX+0)
0009EF 49EF FE5C             7      CP  05CH        ;\
0009F1 49F1 C0              11      RET NZ
0009F2 49F2 DD23            10      INC IX
0009F4 49F4 1D               4      DEC E
0009F5 49F5 3A51F1          13      LD  A,(FNAME)
0009F8 49F8 FE20             7      CP  020H        ;. の処理
0009FA 49FA 28ED            12      JR  Z,SETDIR
                                
0009FC 49FC CD074B          17      CALL    ROM_OPEN
0009FF 49FF B7               4      OR  A
000A00 4A00 C0              11      RET NZ
                                
000A01 4A01 FD2A47F1        20      LD  IY,(DIRENT1)
000A05 4A05 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000A09 4A09 C8              11      RET Z
000A0A 4A0A CD5F4A          17      CALL    FILEI
000A0D 4A0D FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A10 4A10 FD661B          19      LD  H,(IY+01BH)
000A13 4A13 225EF1          16      LD  (_CDX),HL
000A16 4A16 18D1            12      JR  SETDIR
                                
       4A18                     FILED:
000A18 4A18 CD5F4A          17      CALL    FILEI
000A1B 4A1B 2151F1          10      LD  HL,FNAME
                                
000A1E 4A1E 0608             7      LD  B,8
       4A20                     FILE2:
000A20 4A20 CD6C4A          17      CALL    CCHKF
000A23 4A23 C8              11      RET Z
000A24 4A24 FE2A             7      CP  '*'
000A26 4A26 282E            12      JR  Z,FILE9
000A28 4A28 FE2E             7      CP  '.'
000A2A 4A2A 280C            12      JR  Z,FILE4
000A2C 4A2C 77               7      LD  (HL),A
000A2D 4A2D 23               6      INC HL
000A2E 4A2E 10F0            13      DJNZ    FILE2
                                
       4A30                     FILE3:
000A30 4A30 CD6C4A          17      CALL    CCHKF
000A33 4A33 C8              11      RET Z
000A34 4A34 FE2E             7      CP  '.'
000A36 4A36 20F8            12      JR  NZ,FILE3
                                
       4A38                     FILE4:
000A38 4A38 2159F1          10      LD  HL,FNAME+8
000A3B 4A3B 0603             7      LD  B,3
                                
       4A3D                     FILE4L:
000A3D 4A3D CD6C4A          17      CALL    CCHKF
000A40 4A40 C8              11      RET Z
000A41 4A41 FE2E             7      CP  '.'
000A43 4A43 2008            12      JR  NZ,FILE12
000A45 4A45 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000A48 4A48 3252F1          13      LD  (FNAME+1),A
000A4B 4A4B 3E20             7      LD  A,020H
       4A4D                     FILE12:
000A4D 4A4D FE2A             7      CP  '*'
000A4F 4A4F 280A            12      JR  Z,FILE10
000A51 4A51 77               7      LD  (HL),A
000A52 4A52 23               6      INC HL
000A53 4A53 10E8            13      DJNZ    FILE4L
000A55 4A55 C9              10      RET
                                
       4A56                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A56 4A56 CD5B4A          17      CALL    FILE10
000A59 4A59 18D5            12      JR  FILE3
                                
       4A5B                     FILE10:
000A5B 4A5B 3E3F             7      LD  A,'?'
000A5D 4A5D 1808            12      JR  FILL_MEMORY
       4A5F                     FILEI:              ;名前＋拡張子をスペースで初期化
000A5F 4A5F 3E20             7      LD  A,020H
000A61 4A61 01000B          10      LD  BC,11*256   ;C=0にしておく
000A64 4A64 2151F1          10      LD  HL,FNAME
       4A67                     FILL_MEMORY:            ;HLからBバイトAで埋める
000A67 4A67 77               7      LD  (HL),A
000A68 4A68 23               6      INC HL
000A69 4A69 10FC            13      DJNZ    FILL_MEMORY
000A6B 4A6B C9              10      RET
                                
       4A6C                     CCHKF:
000A6C 4A6C 7B               4      LD  A,E
000A6D 4A6D B7               4      OR  A
000A6E 4A6E C8              11      RET Z
000A6F 4A6F DD7E00          19      LD  A,(IX+0)
000A72 4A72 CD794A          17      CALL    CCHK2
000A75 4A75 C8              11      RET Z
000A76 4A76 C3DC4A          10      JP  FKAN
                                
       4A79                     CCHK2:
000A79 4A79 0C               4      INC C
000A7A 4A7A 0D               4      DEC C
000A7B 4A7B C0              11      RET NZ
       4A7C                     CCHK3:              ;ZF=1 で使えない文字
000A7C 4A7C FE2B             7      CP  '+'
000A7E 4A7E C8              11      RET Z
000A7F 4A7F FE2C             7      CP  ','
000A81 4A81 C8              11      RET Z
000A82 4A82 FE2F             7      CP  '/'
000A84 4A84 C8              11      RET Z
000A85 4A85 FE3A             7      CP  ':'
000A87 4A87 C8              11      RET Z
000A88 4A88 FE3B             7      CP  ';'
000A8A 4A8A C8              11      RET Z
000A8B 4A8B FE3D             7      CP  '='
000A8D 4A8D C8              11      RET Z
000A8E 4A8E FE5C             7      CP  05CH    ;\
000A90 4A90 C8              11      RET Z
000A91 4A91 FE1F             7      CP  01FH
000A93 4A93 D0              11      RET NC
000A94 4A94 BF               4      CP  A       ;Z=1
000A95 4A95 C9              10      RET
                                
       4A96                     SS1:
000A96 4A96 13               6      INC DE
       4A97                     SPCUT:              ;スペースをカット
000A97 4A97 1A               7      LD  A,(DE)
000A98 4A98 FE20             7      CP  020H
000A9A 4A9A 28FA            12      JR  Z,SS1
000A9C 4A9C C9              10      RET
                                
       4A9D                     SCREOF1:
000A9D 4A9D 13               6      INC DE
       4A9E                     SPCUTEX:            ;スペース改行などをカット
000A9E 4A9E 1A               7      LD  A,(DE)
000A9F 4A9F FE20             7      CP  020H
000AA1 4AA1 28FA            12      JR  Z,SCREOF1
000AA3 4AA3 FE0D             7      CP  00DH
000AA5 4AA5 28F6            12      JR  Z,SCREOF1
000AA7 4AA7 FE0A             7      CP  00AH
000AA9 4AA9 28F2            12      JR  Z,SCREOF1
000AAB 4AAB FE1A             7      CP  01AH
000AAD 4AAD 28EE            12      JR  Z,SCREOF1
000AAF 4AAF C9              10      RET
                                
       4AB0                     GETNUM:
000AB0 4AB0 210000          10      LD  HL,0
       4AB3                     GETNUM1:
000AB3 4AB3 1A               7      LD  A,(DE)
000AB4 4AB4 13               6      INC DE
000AB5 4AB5 D630             7      SUB '0'
000AB7 4AB7 D8              11      RET C
000AB8 4AB8 FE0A             7      CP  10
000ABA 4ABA D0              11      RET NC
000ABB 4ABB 4D               4      LD  C,L
000ABC 4ABC 44               4      LD  B,H
000ABD 4ABD 29              11      ADD HL,HL   ;*2
000ABE 4ABE 29              11      ADD HL,HL   ;*4
000ABF 4ABF 09              11      ADD HL,BC   ;*5
000AC0 4AC0 29              11      ADD HL,HL   ;*10
000AC1 4AC1 4F               4      LD  C,A
000AC2 4AC2 0600             7      LD  B,0
000AC4 4AC4 09              11      ADD HL,BC
000AC5 4AC5 18EC            12      JR  GETNUM1
                                
       4AC7                     SEARCH_END:
000AC7 4AC7 7E               7      LD  A,(HL)
       4AC8                     SEARCH_END1:
000AC8 4AC8 23               6      INC HL
000AC9 4AC9 B7               4      OR  A
000ACA 4ACA C8              11      RET Z
000ACB 4ACB FE3A             7      CP  ':'
000ACD 4ACD 20F8            12      JR  NZ,SEARCH_END
000ACF 4ACF 7E               7      LD  A,(HL)
000AD0 4AD0 FE3A             7      CP  ':'
000AD2 4AD2 28F4            12      JR  Z,SEARCH_END1
000AD4 4AD4 C9              10      RET
                                
       4AD5                     FKANC:
000AD5 4AD5 CB41             8      BIT 0,C
000AD7 4AD7 CCFA4A          17      CALL    Z,CAP2
000ADA 4ADA 1803            12      JR  FKANX
       4ADC                     FKAN:           ;漢字チェック
000ADC 4ADC DD23            10      INC IX
000ADE 4ADE 1D               4      DEC E
       4ADF                     FKANX:
000ADF 4ADF CB41             8      BIT 0,C
000AE1 4AE1 CB81             8      RES 0,C
000AE3 4AE3 C0              11      RET NZ
000AE4 4AE4 FE80             7      CP  080H
000AE6 4AE6 D8              11      RET C
000AE7 4AE7 FEA0             7      CP  0A0H
000AE9 4AE9 3803            12      JR  C,FKAN1
000AEB 4AEB FEE0             7      CP  0E0H
000AED 4AED D8              11      RET C
       4AEE                     FKAN1:
000AEE 4AEE 0C               4      INC C
000AEF 4AEF A7               4      AND A
000AF0 4AF0 C9              10      RET
                                
       4AF1                     CAP:
000AF1 4AF1 FE61             7      CP  'a'
000AF3 4AF3 D8              11      RET C
000AF4 4AF4 FE7B             7      CP  'z'+1
000AF6 4AF6 D0              11      RET NC
000AF7 4AF7 D620             7      SUB 020H
000AF9 4AF9 C9              10      RET
       4AFA                     CAP2:
000AFA 4AFA CDF14A          17      CALL    CAP
       4AFD                     CAP3:               ;
000AFD 4AFD FE05             7      CP  5
000AFF 4AFF 2803            12      JR  Z,CAP4
000B01 4B01 FE21             7      CP  021H
000B03 4B03 C9              10      RET
       4B04                     CAP4:
000B04 4B04 3EE5             7      LD  A,0E5H
000B06 4B06 C9              10      RET
                                
       4B07                     ROM_OPEN:
000B07 4B07 CD2D50          17      CALL    GET_DISK_BANK_FDRV
                                
000B0A 4B0A CD744D          17      CALL    GET_DIR_DAT
000B0D 4B0D D5              11      PUSH    DE
000B0E 4B0E CD234B          17      CALL    FILESE
000B11 4B11 D1              10      POP DE
000B12 4B12 3F               4      CCF
000B13 4B13 D8              11      RET C
000B14 4B14 2247F1          16      LD  (DIRENT1),HL
000B17 4B17 E5              11      PUSH    HL
000B18 4B18 210000          10      LD  HL,0
000B1B 4B1B 2226F1          16      LD  (RR_LOW),HL
000B1E 4B1E 2228F1          16      LD  (RR_HIGH),HL
000B21 4B21 E1              10      POP HL
000B22 4B22 C9              10      RET
                                
       4B23                     FILESE:
000B23 4B23 7E               7      LD  A,(HL)
000B24 4B24 B7               4      OR  A
000B25 4B25 C8              11      RET Z       ;END:ZF=1 CF=0
000B26 4B26 FEE5             7      CP  0E5H
000B28 4B28 280D            12      JR  Z,FILESE1
000B2A 4B2A 1151F1          10      LD  DE,FNAME
000B2D 4B2D E5              11      PUSH    HL
000B2E 4B2E CD744B          17      CALL    CPFILE
000B31 4B31 CC954B          17      CALL    Z,CPFILE2
000B34 4B34 E1              10      POP HL
000B35 4B35 37               4      SCF
000B36 4B36 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B37                     FILESE1:
000B37 4B37 CD3F4B          17      CALL    FNEXT
000B3A 4B3A 20E7            12      JR  NZ,FILESE
000B3C 4B3C F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B3E 4B3E C9              10      RET
                                
       4B3F                     FNEXT:
000B3F 4B3F 112000          10      LD  DE,020H
000B42 4B42 19              11      ADD HL,DE
000B43 4B43 ED5B5EF1        20      LD  DE,(_CDX)
000B47 4B47 7A               4      LD  A,D
000B48 4B48 B3               4      OR  E
000B49 4B49 2019            12      JR  NZ,FNEXT_SUBDIR
000B4B 4B4B 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       4B4C                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B4C 4B4C F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B4D 4B4D CB7C             8      BIT 7,H
000B4F 4B4F 2811            12      JR  Z,CHECK_DIR_PAGE1
000B51 4B51 7C               4      LD  A,H
000B52 4B52 D620             7      SUB 020H
000B54 4B54 67               4      LD  H,A
000B55 4B55 3A49F1          13      LD  A,(_DIR_BANK)
000B58 4B58 3C               4      INC A
000B59 4B59 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B5C 4B5C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B5F 4B5F 3249F1          13      LD  (_DIR_BANK),A
       4B62                     CHECK_DIR_PAGE1:
000B62 4B62 F1              10      POP AF
                                #endif
000B63 4B63 C9              10      RET
                                
       4B64                     FNEXT_SUBDIR:           ;サブディレクトリ
000B64 4B64 0D               4      DEC C
000B65 4B65 C0              11      RET NZ
                                
000B66 4B66 ED5B5EF1        20      LD  DE,(_CDX)
000B6A 4B6A CD9D4C          17      CALL    GNCL
000B6D 4B6D EB               4      EX  DE,HL
000B6E 4B6E 225EF1          16      LD  (_CDX),HL
000B71 4B71 C3AF4D          10      JP  GET_SUBDIR
                                
       4B74                     CPFILE:
000B74 4B74 C5              11      PUSH    BC
000B75 4B75 01000B          10      LD  BC,00B00H
       4B78                     CPSTR1:
000B78 4B78 1A               7      LD  A,(DE)
000B79 4B79 FE3F             7      CP  '?'     ;Wild card
000B7B 4B7B 2812            12      JR  Z,CPSTR2
000B7D 4B7D 7E               7      LD  A,(HL)
000B7E 4B7E CDD54A          17      CALL    FKANC
000B81 4B81 E5              11      PUSH    HL
000B82 4B82 67               4      LD  H,A
000B83 4B83 1A               7      LD  A,(DE)
000B84 4B84 CB01             4      RLC C
000B86 4B86 CDD54A          17      CALL    FKANC
000B89 4B89 CB09             4      RRC C
000B8B 4B8B BC               4      CP  H       ;CP (HL),(DE)
000B8C 4B8C E1              10      POP HL
000B8D 4B8D 2004            12      JR  NZ,CPSTR3
       4B8F                     CPSTR2:
000B8F 4B8F 13               6      INC DE
000B90 4B90 23               6      INC HL
000B91 4B91 10E5            13      DJNZ    CPSTR1
       4B93                     CPSTR3:
000B93 4B93 C1              10      POP BC
000B94 4B94 C9              10      RET
                                
       4B95                     CPFILE2:
                                ;   LD  A,0E1H
000B95 4B95 3EF1             7      LD  A,0F1H
000B97 4B97 2F               4      CPL
000B98 4B98 A6               7      AND (HL)
000B99 4B99 C9              10      RET
                                
       4B9A                     RBX1:
000B9A 4B9A E5              11      PUSH    HL      ;Record byte
                                
000B9B 4B9B ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000B9F 4B9F 3A29F1          13      LD  A,(RR_HIGH+1)
000BA2 4BA2 4F               4      LD  C,A
                                
000BA3 4BA3 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000BA6 4BA6 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BA9 4BA9 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000BAC 4BAC FD2A47F1        20      LD  IY,(DIRENT1)
000BB0 4BB0 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BB3 4BB3 FD661D          19      LD  H,(IY+01DH)
000BB6 4BB6 FD7E1E          19      LD  A,(IY+01EH)
                                
000BB9 4BB9 A7               4      AND A
000BBA 4BBA ED52            15      SBC HL,DE
000BBC 4BBC 99               4      SBC A,C
000BBD 4BBD D1              10      POP DE
                                
000BBE 4BBE D8              11      RET C
000BBF 4BBF 4F               4      LD  C,A
000BC0 4BC0 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BC1 4BC1 B2               4      OR  D
000BC2 4BC2 B3               4      OR  E
000BC3 4BC3 C0              11      RET NZ
000BC4 4BC4 37               4      SCF
000BC5 4BC5 C9              10      RET
                                
       4BC6                     RBX2:
000BC6 4BC6 ED4B27F1        20      LD  BC,(RR_LOW+1)
000BCA 4BCA CD4E4C          17      CALL    RWXR
000BCD 4BCD 3A23F1          13      LD  A,(CLSZ_H)
000BD0 4BD0 3D               4      DEC A
000BD1 4BD1 E5              11      PUSH    HL
000BD2 4BD2 2A26F1          16      LD  HL,(RR_LOW)
000BD5 4BD5 A4               4      AND H
000BD6 4BD6 B5               4      OR  L
000BD7 4BD7 E1              10      POP HL
000BD8 4BD8 C9              10      RET
                                
       4BD9                     RBXA:
000BD9 4BD9 D5              11      PUSH    DE
000BDA 4BDA CDC04C          17      CALL    CLUST
000BDD 4BDD ED532EF1        20      LD  (_DTPS),DE
000BE1 4BE1 D1              10      POP DE
000BE2 4BE2 CD9D4C          17      CALL    GNCL
000BE5 4BE5 D8              11      RET C
000BE6 4BE6 ED532AF1        20      LD  (_CLPS),DE
                                
000BEA 4BEA ED4B26F1        20      LD  BC,(RR_LOW)
000BEE 4BEE 2A22F1          16      LD  HL,(CLSZ)
000BF1 4BF1 7C               4      LD  A,H
000BF2 4BF2 3D               4      DEC A
000BF3 4BF3 A0               4      AND B
000BF4 4BF4 47               4      LD  B,A
000BF5 4BF5 ED42            15      SBC HL,BC       ;remaining cluster
                                
000BF7 4BF7 ED5B4AF1        20      LD  DE,(LEFTX)
000BFB 4BFB ED52            15      SBC HL,DE       ;CP HL,DE
000BFD 4BFD 19              11      ADD HL,DE
000BFE 4BFE 3801            12      JR  C,RBXA1
000C00 4C00 EB               4      EX  DE,HL
       4C01                     RBXA1:
000C01 4C01 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C04 4C04 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C07 4C07 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C0A 4C0A E5              11      PUSH    HL
000C0B 4C0B 2A2EF1          16      LD  HL,(_DTPS)
000C0E 4C0E 09              11      ADD HL,BC
000C0F 4C0F ED5B43F1        20      LD  DE,(DTAX)
000C13 4C13 C1              10      POP BC
000C14 4C14 C9              10      RET
                                
       4C15                     RBXB:
000C15 4C15 2A43F1          16      LD  HL,(DTAX)
000C18 4C18 ED5B2AF1        20      LD  DE,(_CLPS)
000C1C 4C1C 3A4BF1          13      LD  A,(LEFTX+1)
000C1F 4C1F 47               4      LD  B,A
000C20 4C20 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C23                     RBXB1:
000C23 4C23 1F               4      RRA     ;->CF
000C24 4C24 3804            12      JR  C,RBXB2
000C26 4C26 CB38             8      SRL B   ;B=B/2
000C28 4C28 18F9            12      JR  RBXB1
       4C2A                     RBXB2:
000C2A 4C2A 78               4      LD  A,B
000C2B 4C2B B7               4      OR  A
000C2C 4C2C C9              10      RET
                                
       4C2D                     RBXC:
000C2D 4C2D ED4B4AF1        20      LD  BC,(LEFTX)
000C31 4C31 3A23F1          13      LD  A,(CLSZ_H)
000C34 4C34 3D               4      DEC A
000C35 4C35 A0               4      AND B
000C36 4C36 47               4      LD  B,A
000C37 4C37 B1               4      OR  C
000C38 4C38 C9              10      RET
                                
       4C39                     RBXEND:
000C39 4C39 ED5B2CF1        20      LD  DE,(_LEFT)
000C3D 4C3D 2A26F1          16      LD  HL,(RR_LOW)
000C40 4C40 3A29F1          13      LD  A,(RR_HIGH+1)
000C43 4C43 19              11      ADD HL,DE
000C44 4C44 CE00             7      ADC A,0
000C46 4C46 2226F1          16      LD  (RR_LOW),HL
000C49 4C49 3229F1          13      LD  (RR_HIGH+1),A
000C4C 4C4C EB               4      EX  DE,HL       ;HL=Read byte
000C4D 4C4D C9              10      RET 
                                
       4C4E                     RWXR:
000C4E 4C4E 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C51                     L_RWX:
000C51 4C51 1F               4      RRA     ;->CF
000C52 4C52 3806            12      JR  C,E_RWX
000C54 4C54 CB38             8      SRL B   ;BC=BC/2
000C56 4C56 CB19             8      RR  C   ;
000C58 4C58 18F7            12      JR  L_RWX
       4C5A                     E_RWX:
000C5A 4C5A 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C5D 4C5D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C60 4C60 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C63 4C63 FD2A47F1        20      LD  IY,(DIRENT1)
000C67 4C67 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C6A 4C6A FD561B          19      LD  D,(IY+01BH)
000C6D 4C6D CD2D50          17      CALL    GET_DISK_BANK_FDRV
       4C70                     RWX1:
000C70 4C70 ED532AF1        20      LD  (_CLPS),DE
000C74 4C74 7A               4      LD  A,D
000C75 4C75 B3               4      OR  E
000C76 4C76 37               4      SCF
000C77 4C77 C8              11      RET Z
                                
000C78 4C78 78               4      LD  A,B
000C79 4C79 B1               4      OR  C
000C7A 4C7A C8              11      RET Z
                                
000C7B 4C7B CD9D4C          17      CALL    GNCL
000C7E 4C7E D8              11      RET C
000C7F 4C7F 0B               6      DEC BC
000C80 4C80 CD0D4D          17      CALL    ENDCL
000C83 4C83 38EB            12      JR  C,RWX1
000C85 4C85 37               4      SCF
000C86 4C86 C9              10      RET
                                
       4C87                     NCL3:
000C87 4C87 CD2D50          17      CALL    GET_DISK_BANK_FDRV
000C8A 4C8A 6B               4      LD  L,E
000C8B 4C8B 62               4      LD  H,D
000C8C 4C8C CB3C             8      SRL H
000C8E 4C8E CB1D             8      RR  L
000C90 4C90 1F               4      RRA
000C91 4C91 19              11      ADD HL,DE
000C92 4C92 010060          10      LD  BC,BANK1_ADR
000C95 4C95 09              11      ADD HL,BC
000C96 4C96 ED4B24F1        20      LD  BC,(SECSZ)
000C9A 4C9A 09              11      ADD HL,BC
000C9B 4C9B 17               4      RLA
000C9C 4C9C C9              10      RET
                                
       4C9D                     GNCL:
000C9D 4C9D 7A               4      LD  A,D
000C9E 4C9E B3               4      OR  E
000C9F 4C9F 37               4      SCF
000CA0 4CA0 C8              11      RET Z
000CA1 4CA1 C5              11      PUSH    BC
000CA2 4CA2 E5              11      PUSH    HL
000CA3 4CA3 CD874C          17      CALL    NCL3
000CA6 4CA6 3809            12      JR  C,GNC1
000CA8 4CA8 5E               7      LD  E,(HL)
000CA9 4CA9 23               6      INC HL
000CAA 4CAA 7E               7      LD  A,(HL)
000CAB 4CAB E60F             7      AND 00FH
000CAD 4CAD 57               4      LD  D,A
000CAE 4CAE E1              10      POP HL
000CAF 4CAF C1              10      POP BC
000CB0 4CB0 C9              10      RET
       4CB1                     GNC1:
000CB1 4CB1 7E               7      LD  A,(HL)
000CB2 4CB2 23               6      INC HL
000CB3 4CB3 56               7      LD  D,(HL)
000CB4 4CB4 0604             7      LD  B,4
       4CB6                     GNC1L:
000CB6 4CB6 CB3A             8      SRL D
000CB8 4CB8 1F               4      RRA
000CB9 4CB9 10FB            13      DJNZ    GNC1L
                                
000CBB 4CBB 5F               4      LD  E,A
000CBC 4CBC E1              10      POP HL
000CBD 4CBD C1              10      POP BC
000CBE 4CBE A7               4      AND A
000CBF 4CBF C9              10      RET
                                
       4CC0                     CLUST:
000CC0 4CC0 EB               4      EX  DE,HL
       4CC1                     CLUST_HL:
000CC1 4CC1 C5              11      PUSH    BC
000CC2 4CC2 3A23F1          13      LD  A,(CLSZ_H)
000CC5 4CC5 CD5950          17      CALL    MUL_AHL
                                
000CC8 4CC8 CD914D          17      CALL    GET_DIR_POS
000CCB 4CCB 4F               4      LD  C,A
000CCC 4CCC 0600             7      LD  B,0
000CCE 4CCE 09              11      ADD HL,BC
                                
000CCF 4CCF 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000CD2 4CD2 1F               4      RRA
000CD3 4CD3 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000CD6 4CD6 1F               4      RRA
000CD7 4CD7 0F               4      RRCA
000CD8 4CD8 0F               4      RRCA
000CD9 4CD9 0F               4      RRCA
000CDA 4CDA 4F               4      LD  C,A
                                
000CDB 4CDB 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000CDE 4CDE FE02             7      CP  2
000CE0 4CE0 280C            12      JR  Z,CLUST1
000CE2 4CE2 CB01             4      RLC C
000CE4 4CE4 0D               4      DEC C
000CE5 4CE5 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000CE8 4CE8 FE02             7      CP  2
000CEA 4CEA 2002            12      JR  NZ,CLUST1
000CEC 4CEC 0D               4      DEC C
000CED 4CED 0D               4      DEC C
       4CEE                     CLUST1:
000CEE 4CEE 0D               4      DEC C
000CEF 4CEF 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000CF0 4CF0 4D               4      LD  C,L     ;C=読み出し元
000CF1 4CF1 29              11      ADD HL,HL   ;64KB→32KB
000CF2 4CF2 29              11      ADD HL,HL   ;32KB→16KB
000CF3 4CF3 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000CF4 4CF4 CD2D50          17      CALL    GET_DISK_BANK_FDRV
000CF7 4CF7 84               4      ADD A,H
000CF8 4CF8 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000CFB 4CFB 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000CFE 4CFE 3220F1          13      LD  (_BANK),A
000D01 4D01 69               4      LD  L,C     ;C=読み出し元
000D02 4D02 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D04 4D04 A5               4      AND L
                                #endif
       4D05                     CLUST2:
000D05 4D05 C660             7      ADD A,high BANK1_ADR
000D07 4D07 67               4      LD  H,A
000D08 4D08 2E00             7      LD  L,0
000D0A 4D0A EB               4      EX  DE,HL
000D0B 4D0B C1              10      POP BC
000D0C 4D0C C9              10      RET
                                
       4D0D                     ENDCL:
000D0D 4D0D 7A               4      LD  A,D ;END CLUSTER
000D0E 4D0E FE0F             7      CP  00FH    ;FAT12の最大値
000D10 4D10 C0              11      RET NZ
000D11 4D11 7B               4      LD  A,E
000D12 4D12 FEF7             7      CP  0F7H
000D14 4D14 C9              10      RET
                                
       4D15                     RB_READ:
000D15 4D15 AF               4      XOR A   ;HLA = HL*128
000D16 4D16 CB3C             8      SRL H
000D18 4D18 CB1D             8      RR  L
000D1A 4D1A 1F               4      RRA
000D1B 4D1B 3226F1          13      LD  (RR_LOW),A
000D1E 4D1E 2227F1          16      LD  (RR_MID),HL
000D21 4D21 218000          10      LD  HL,128
                                
000D24 4D24 CDE748          17      CALL    ROM_READ
000D27 4D27 C9              10      RET
                                
       4D28                     GETSEQ:
000D28 4D28 FD6E20          19      LD  L,(IY+32)
000D2B 4D2B FD660C          19      LD  H,(IY+12)
                                
000D2E 4D2E CB25             8      SLA L
                                
000D30 4D30 CB3C             8      SRL H
000D32 4D32 CB1D             8      RR  L
000D34 4D34 C9              10      RET
                                
       4D35                     SETSEQ:
000D35 4D35 F5              11      PUSH    AF
000D36 4D36 3A26F1          13      LD  A,(RR_LOW)
000D39 4D39 2A27F1          16      LD  HL,(RR_MID)
                                
000D3C 4D3C CD534D          17      CALL    SSQ1
                                
000D3F 4D3F 29              11      ADD HL,HL
000D40 4D40 CB3D             8      SRL L
000D42 4D42 FD7520          19      LD  (IY+32),L
000D45 4D45 FD740C          19      LD  (IY+12),H
000D48 4D48 F1              10      POP AF
000D49 4D49 C9              10      RET
                                
       4D4A                     GETSIZE:
000D4A 4D4A FD7E10          19      LD  A,(IY+16)
000D4D 4D4D FD6E11          19      LD  L,(IY+17)
000D50 4D50 FD6612          19      LD  H,(IY+18)
       4D53                     SSQ1:
000D53 4D53 87               4      ADD A,A
000D54 4D54 ED6A            15      ADC HL,HL
000D56 4D56 B7               4      OR  A
000D57 4D57 C8              11      RET Z
000D58 4D58 23               6      INC HL
000D59 4D59 C9              10      RET
                                
       4D5A                     SET_FCB:
000D5A 4D5A D5              11      PUSH    DE
000D5B 4D5B FDE1            14      POP IY
000D5D 4D5D FD7E1C          19      LD  A,(IY+28)
000D60 4D60 FEFF             7      CP  0FFH
000D62 4D62 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D64 4D64 E5              11      PUSH    HL
000D65 4D65 FD6E1A          19      LD  L,(IY+26)
000D68 4D68 FD661B          19      LD  H,(IY+27)
000D6B 4D6B 222AF1          16      LD  (_CLPS),HL
000D6E 4D6E E1              10      POP HL
000D6F 4D6F C9              10      RET
                                
       4D70                     POPAF_SCF_FF_RET:
000D70 4D70 F1              10      POP AF
000D71 4D71 37               4      SCF
000D72 4D72 9F               4      SBC A,A
000D73 4D73 C9              10      RET
                                
       4D74                     GET_DIR_DAT:
000D74 4D74 2A5EF1          16      LD  HL,(_CDX)
000D77 4D77 7C               4      LD  A,H
000D78 4D78 B5               4      OR  L
000D79 4D79 2034            12      JR  NZ,GET_SUBDIR
000D7B 4D7B CD914D          17      CALL    GET_DIR_POS
000D7E 4D7E C660             7      ADD A,high BANK1_ADR
000D80 4D80 2E00             7      LD  L,0
000D82 4D82 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000D83 4D83 CD4C4B          17      CALL    CHECK_DIR_PAGE
                                #endif
000D86 4D86 3A21F1          13      LD  A,(_BANK1)
000D89 4D89 3249F1          13      LD  (_DIR_BANK),A
                                
000D8C 4D8C 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D8F 4D8F 4F               4      LD  C,A
000D90 4D90 C9              10      RET
                                
       4D91                     GET_DIR_POS:                ;ルートディレクトリ
000D91 4D91 CD2D50          17      CALL    GET_DISK_BANK_FDRV
000D94 4D94 3221F1          13      LD  (_BANK1),A
000D97 4D97 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000D9A 4D9A 47               4      LD  B,A
000D9B 4D9B 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000D9E 4D9E 4F               4      LD  C,A
000D9F 4D9F 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DA2                     GET_DIR_POS1:
000DA2 4DA2 81               4      ADD A,C
000DA3 4DA3 10FD            13      DJNZ    GET_DIR_POS1
                                
000DA5 4DA5 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4DA9                     L_MDP:
000DA9 4DA9 CB18             8      RR  B   ;->CF
000DAB 4DAB D8              11      RET C
000DAC 4DAC 87               4      ADD A,A
000DAD 4DAD 18FA            12      JR  L_MDP
                                
       4DAF                     GET_SUBDIR:             ;サブディレクトリ
000DAF 4DAF CDC14C          17      CALL    CLUST_HL
000DB2 4DB2 EB               4      EX  DE,HL
000DB3 4DB3 3A20F1          13      LD  A,(_BANK)
000DB6 4DB6 3249F1          13      LD  (_DIR_BANK),A
000DB9 4DB9 3A23F1          13      LD  A,(CLSZ_H)
000DBC 4DBC 87               4      ADD A,A     ;*2
000DBD 4DBD 87               4      ADD A,A     ;*4
000DBE 4DBE 87               4      ADD A,A     ;*8
000DBF 4DBF 4F               4      LD  C,A
000DC0 4DC0 C9              10      RET
                                
       4DC1                     STATEMENT:
000DC1 4DC1 114F4E          10      LD  DE,STR_CHDIR
000DC4 4DC4 CD354E          17      CALL    CPPROCNM
000DC7 4DC7 280A            12      JR  Z,_CHDIR
000DC9 4DC9 11554E          10      LD  DE,STR_RAMDISK
000DCC 4DCC CD354E          17      CALL    CPPROCNM
000DCF 4DCF 2814            12      JR  Z,_RAMDISK
000DD1 4DD1 37               4      SCF
000DD2 4DD2 C9              10      RET
       4DD3                     _CHDIR:
000DD3 4DD3 7E               7      LD  A,(HL)
000DD4 4DD4 FE28             7      CP  '('
000DD6 4DD6 37               4      SCF
000DD7 4DD7 C0              11      RET NZ
000DD8 4DD8 CD9646          17      CALL    INIT_PARAM
000DDB 4DDB CD8849          17      CALL    FILE_B
000DDE 4DDE CDFD4D          17      CALL    ROM_CD
000DE1 4DE1 DA6245          10      JP  C,ERROR_FILE_NOT_FOUND
000DE4 4DE4 C9              10      RET
                                
       4DE5                     _RAMDISK:
000DE5 4DE5 7E               7      LD  A,(HL)
000DE6 4DE6 FE28             7      CP  '('
000DE8 4DE8 37               4      SCF
000DE9 4DE9 C0              11      RET NZ
000DEA 4DEA 23               6      INC HL
000DEB 4DEB DD212F54        14      LD  IX,FRMQNT
000DEF 4DEF FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000DF3 4DF3 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000DF6 4DF6 7A               4      LD  A,D
000DF7 4DF7 B3               4      OR  E
000DF8 4DF8 C25C45          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000DFB 4DFB 23               6      INC HL
000DFC 4DFC C9              10      RET
                                
       4DFD                     ROM_CD:
000DFD 4DFD 3A51F1          13      LD  A,(FNAME)
000E00 4E00 FE20             7      CP  020H
000E02 4E02 2822            12      JR  Z,CD1
000E04 4E04 CD074B          17      CALL    ROM_OPEN
000E07 4E07 D8              11      RET C
000E08 4E08 FD2A47F1        20      LD  IY,(DIRENT1)
000E0C 4E0C FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E10 4E10 CA6245          10      JP  Z,ERROR_FILE_NOT_FOUND
000E13 4E13 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E16 4E16 FD661B          19      LD  H,(IY+01BH)
       4E19                     CD2:
000E19 4E19 225CF1          16      LD  (_CD),HL
000E1C 4E1C 2A4EF1          16      LD  HL,(PARAM1)
       4E1F                     CD_SKIP:
000E1F 4E1F 7E               7      LD  A,(HL)
000E20 4E20 23               6      INC HL
000E21 4E21 FE21             7      CP  021H
000E23 4E23 38FA            12      JR  C,CD_SKIP
000E25 4E25 C9              10      RET
       4E26                     CD1:
000E26 4E26 2A5EF1          16      LD  HL,(_CDX)
000E29 4E29 18EE            12      JR  CD2
                                
       4E2B                     DEVICE1:
000E2B 4E2B 115D4E          10      LD  DE,STR_A
000E2E 4E2E CD354E          17      CALL    CPPROCNM
000E31 4E31 37               4      SCF
000E32 4E32 C0              11      RET NZ
000E33 4E33 AF               4      XOR A
000E34 4E34 C9              10      RET
                                
       4E35                     CPPROCNM:
000E35 4E35 E5              11      PUSH    HL
000E36 4E36 2189FD          10      LD  HL,PROCNM
       4E39                     CPPROCNM1:
000E39 4E39 1A               7      LD  A,(DE)
000E3A 4E3A 13               6      INC DE
000E3B 4E3B BE               7      CP  (HL)
000E3C 4E3C 23               6      INC HL
000E3D 4E3D 2003            12      JR  NZ,CPPROCNM2
000E3F 4E3F B7               4      OR  A
000E40 4E40 20F7            12      JR  NZ,CPPROCNM1
       4E42                     CPPROCNM2:
000E42 4E42 E1              10      POP HL
000E43 4E43 C9              10      RET
                                
       4E44                     WILDCARD:
000E44 4E44 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4E4F                     STR_CHDIR:
000E4F 4E4F 434844495200            DB  "CHDIR",0
       4E55                     STR_RAMDISK:
000E55 4E55 52414D4449534B00        DB  "RAMDISK",0
       4E5D                     STR_A:
000E5D 4E5D 4100                    DB  "A",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4E5F                     ERROR_WRITE_PROTECTED:
000E5F 4E5F 3E00             7      LD  A,0     ;Write protected
000E61 4E61 C9              10      RET
       4E62                     DISKIO:
000E62 4E62 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000E64 4E64 48               4      LD  C,B
000E65 4E65 CD3750          17      CALL    GET_DISK_BANK
       4E68                     SETMAP1:        
000E68 4E68 E5              11      PUSH    HL
       4E69                     DISKIO1:
000E69 4E69 C5              11      PUSH    BC      ;B=残りのセクタ数
000E6A 4E6A D5              11      PUSH    DE      ;DE=セクタ番号
000E6B 4E6B F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000E6C 4E6C EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000E6D 4E6D F5              11      PUSH    AF
000E6E 4E6E 3A25F1          13      LD  A,(SECSZ_H)
000E71 4E71 CD5950          17      CALL    MUL_AHL
000E74 4E74 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000E75 4E75 4D               4      LD  C,L     ;C=読み出し元
000E76 4E76 29              11      ADD HL,HL       ;64KB→32KB
000E77 4E77 29              11      ADD HL,HL       ;32KB→16KB
000E78 4E78 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000E79 4E79 84               4      ADD A,H
000E7A 4E7A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000E7D 4E7D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000E80 4E80 3220F1          13      LD  (_BANK),A
000E83 4E83 79               4      LD  A,C     ;C=読み出し元
000E84 4E84 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4E86                     DISKIO2:
000E86 4E86 C660             7      ADD A,high BANK1_ADR
000E88 4E88 67               4      LD  H,A
000E89 4E89 ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000E8D 4E8D 69               4      LD  L,C     ;C=0
000E8E 4E8E CD0844          17      CALL    ROM_LDIR
000E91 4E91 EB               4      EX  DE,HL
000E92 4E92 F1              10      POP AF
000E93 4E93 D1              10      POP DE
000E94 4E94 13               6      INC DE
000E95 4E95 C1              10      POP BC
000E96 4E96 10D1            13      DJNZ    DISKIO1
000E98 4E98 41               4      LD  B,C
                                
000E99 4E99 E1              10      POP HL
000E9A 4E9A AF               4      XOR A
                                
000E9B 4E9B FB               4      EI
000E9C 4E9C C9              10      RET
                                
       4E9D                     DSKCHG:
000E9D 4E9D CDD64E          17      CALL    IS_BPB
000EA0 4EA0 3824            12      JR  C,NOTREADY
000EA2 4EA2 3A23FB          13      LD  A,(DRVTBL+2)
000EA5 4EA5 B7               4      OR  A
000EA6 4EA6 201A            12      JR  NZ,DSKCHG1
000EA8 4EA8 3A21FB          13      LD  A,(DRVTBL)
000EAB 4EAB FE02             7      CP  2
000EAD 4EAD 2013            12      JR  NZ,DSKCHG1
000EAF 4EAF CDD64E          17      CALL    IS_BPB
000EB2 4EB2 300E            12      JR  NC,DSKCHG1
000EB4 4EB4 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000EB6 4EB6 3221FB          13      LD  (DRVTBL),A
000EB9 4EB9 3223FB          13      LD  (DRVTBL+2),A
000EBC 4EBC 3A48F3          13      LD  A,(MASTERS)
000EBF 4EBF 3224FB          13      LD  (DRVTBL+3),A
       4EC2                     DSKCHG1:
000EC2 4EC2 AF               4      XOR A
000EC3 4EC3 0601             7      LD  B,1
000EC5 4EC5 C9              10      RET
       4EC6                     NOTREADY:
000EC6 4EC6 3E02             7      LD  A,2
000EC8 4EC8 37               4      SCF
000EC9 4EC9 C9              10      RET
                                
       4ECA                     NO_BPB:
000ECA 4ECA E1              10      POP HL
000ECB 4ECB 23               6      INC HL
000ECC 4ECC 115F50          10      LD  DE,DPB2DD
000ECF 4ECF 011200          10      LD  BC,DPB2DD_E-DPB2DD
000ED2 4ED2 EDB0                    LDIR
000ED4 4ED4 AF               4      XOR A
000ED5 4ED5 C9              10      RET
                                
       4ED6                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000ED6 4ED6 CD3750          17      CALL    GET_DISK_BANK
                                
000ED9 4ED9 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000EDC 4EDC FE01             7      CP  1
000EDE 4EDE D8              11      RET C
                                
000EDF 4EDF 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000EE2 4EE2 C6FF             7      ADD A,0FFH
000EE4 4EE4 D8              11      RET C
                                
000EE5 4EE5 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000EE8 4EE8 FE01             7      CP  1
000EEA 4EEA C8              11      RET Z
000EEB 4EEB FE02             7      CP  2
000EED 4EED C8              11      RET Z
000EEE 4EEE FE04             7      CP  4
000EF0 4EF0 C8              11      RET Z
000EF1 4EF1 37               4      SCF
000EF2 4EF2 C9              10      RET
                                
       4EF3                     GETDPB:
000EF3 4EF3 E5              11      PUSH    HL
000EF4 4EF4 CD3750          17      CALL    GET_DISK_BANK
                                
000EF7 4EF7 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000EFA 4EFA B7               4      OR  A
000EFB 4EFB 28CD            12      JR  Z,NO_BPB
000EFD 4EFD DDE1            14      POP IX
000EFF 4EFF DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F02 4F02 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F05 4F05 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F08 4F08 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F0B 4F0B DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F0E 4F0E 87               4      ADD A,A
000F0F 4F0F 87               4      ADD A,A
000F10 4F10 87               4      ADD A,A
000F11 4F11 3D               4      DEC A
000F12 4F12 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F15 4F15 06FF             7      LD  B,-1
000F17 4F17 A7               4      AND A           ;無限ループ阻止
       4F18                     GETDPB1:
000F18 4F18 04               4      INC B
000F19 4F19 1F               4      RRA
000F1A 4F1A 38FC            12      JR  C,GETDPB1
000F1C 4F1C DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F1F 4F1F 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F22 4F22 3D               4      DEC A
000F23 4F23 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F26 4F26 A7               4      AND A           ;無限ループ阻止
000F27 4F27 06FF             7      LD  B,-1
       4F29                     GETDPB2:
000F29 4F29 04               4      INC B
000F2A 4F2A 1F               4      RRA
000F2B 4F2B 38FC            12      JR  C,GETDPB2
000F2D 4F2D 04               4      INC B
000F2E 4F2E DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000F31 4F31 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000F34 4F34 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000F37 4F37 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000F3A 4F3A 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000F3D 4F3D DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000F40 4F40 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000F43 4F43 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000F46 4F46 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000F4A 4F4A DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000F4D 4F4D DD460A          19      LD  B,(IX+10)       ;FATCNT
000F50 4F50 210000          10      LD  HL,0
       4F53                     GETDPB3:
000F53 4F53 19              11      ADD HL,DE
000F54 4F54 10FD            13      DJNZ    GETDPB3
       4F56                     GETDPB4:
000F56 4F56 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000F59 4F59 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000F5C 4F5C 19              11      ADD HL,DE
000F5D 4F5D DD7511          19      LD  (IX+17),L       ;FIRDIR
000F60 4F60 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000F63 4F63 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F66 4F66 87               4      ADD A,A
000F67 4F67 87               4      ADD A,A
000F68 4F68 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F6B                     GETDPB5:
000F6B 4F6B CB3B             8      SRL E
000F6D 4F6D 1F               4      RRA
000F6E 4F6E 30FB            12      JR  NC,GETDPB5
000F70 4F70 1600             7      LD  D,0
000F72 4F72 19              11      ADD HL,DE
000F73 4F73 DD750C          19      LD  (IX+12),L       ;FIRREC
000F76 4F76 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000F79 4F79 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000F7C 4F7C DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000F7F 4F7F DD560D          19      LD  D,(IX+13)       ;FIRREC
000F82 4F82 A7               4      AND A
000F83 4F83 ED52            15      SBC HL,DE
                                
000F85 4F85 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000F88 4F88 3C               4      INC A
000F89 4F89 37               4      SCF             ;無限ループ阻止
       4F8A                     GETDPB6:
000F8A 4F8A 1F               4      RRA
000F8B 4F8B 3806            12      JR  C,GETDPB7
000F8D 4F8D CB3C             8      SRL H
000F8F 4F8F CB1D             8      RR  L
000F91 4F91 18F7            12      JR  GETDPB6
       4F93                     GETDPB7:
000F93 4F93 23               6      INC HL
000F94 4F94 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000F97 4F97 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4F9A                     GETDPBD1:
000F9A 4F9A DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F9D 4F9D E6FC             7      AND 0FCH
000F9F 4F9F C8              11      RET Z
                                
000FA0 4FA0 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000FA4 4FA4 37               4      SCF
000FA5 4FA5 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000FA9 4FA9 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000FAC 4FAC DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000FB0 4FB0 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000FB4 4FB4 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000FB8 4FB8 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000FBC 4FBC DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000FC0 4FC0 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000FC4 4FC4 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000FC8 4FC8 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000FCB 4FCB DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000FCE 4FCE DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FD1 4FD1 87               4      ADD A,A
000FD2 4FD2 87               4      ADD A,A
000FD3 4FD3 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4FD6                     GETDPBD5:
000FD6 4FD6 CB3B             8      SRL E
000FD8 4FD8 1F               4      RRA
000FD9 4FD9 30FB            12      JR  NC,GETDPBD5
000FDB 4FDB 1600             7      LD  D,0
000FDD 4FDD 19              11      ADD HL,DE
000FDE 4FDE DD750C          19      LD  (IX+12),L       ;FIRREC
000FE1 4FE1 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FE4 4FE4 18B4            12      JR  GETDPBD1
                                
       4FE6                     CHOICE:
000FE6 4FE6 210000          10      LD  HL,0
000FE9 4FE9 C9              10      RET
                                
       4FEA                     DSKFMT:
000FEA 4FEA AF               4      XOR A
000FEB 4FEB 37               4      SCF
       4FEC                     DSKSTP:
000FEC 4FEC C9              10      RET
                                
       4FED                     BASENT:
000FED 4FED 3A40F3          13      LD  A,(REBOOT)
000FF0 4FF0 B7               4      OR  A
000FF1 4FF1 202B            12      JR  NZ,REBOOT1
000FF3 4FF3 217150          10      LD  HL,AUTOEXEC
000FF6 4FF6 1150F1          10      LD  DE,FDRV
000FF9 4FF9 010C00          10      LD  BC,1+8+3
000FFC 4FFC EDB0                    LDIR
000FFE 4FFE CD074B          17      CALL    ROM_OPEN
001001 5001 381B            12      JR  C,REBOOT1
001003 5003 CD1A45          17      CALL    ROM_LOAD1
001006 5006 217D50          10      LD  HL,CMD_RUN
001009 5009 111FF4          10      LD  DE,KBUF
00100C 500C D5              11      PUSH    DE
00100D 500D 010300          10      LD  BC,3
001010 5010 EDB0                    LDIR
001012 5012 E1              10      POP HL
001013 5013 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001017 5017 DD210146        14      LD  IX,NEWSTT
00101B 501B CD1C00          17      CALL    _CALSLT
       501E                     REBOOT1:
00101E 501E FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001022 5022 DD219B40        14      LD  IX,READYR
001026 5026 C31C00          10      JP  _CALSLT
                                
       5029                     GETSLT:
001029 5029 3A22FB          13      LD  A,(DRVTBL+1)
00102C 502C C9              10      RET
                                
       502D                     GET_DISK_BANK_FDRV:
00102D 502D 3A50F1          13      LD  A,(FDRV)
001030 5030 D601             7      SUB 1
001032 5032 3003            12      JR  NC,GET_DISK_BANK
001034 5034 3A46F1          13      LD  A,(_DVSW)
       5037                     GET_DISK_BANK:
001037 5037 B7               4      OR  A       ;A=DRIVE
001038 5038 3E01             7      LD  A,DISK_BANK
00103A 503A 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
00103C 503C 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       503F                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
00103F 503F 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001042 5042 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001045 5045 F5              11      PUSH    AF
001046 5046 E5              11      PUSH    HL
001047 5047 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
00104A 504A 2224F1          16      LD  (SECSZ),HL
00104D 504D 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001050 5050 CD5950          17      CALL    MUL_AHL
001053 5053 2222F1          16      LD  (CLSZ),HL
001056 5056 E1              10      POP HL
001057 5057 F1              10      POP AF
001058 5058 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5059                     MUL_AHL:
001059 5059 37               4      SCF     ;無限ループ回避
       505A                     MUL_AHL1:
00105A 505A 1F               4      RRA     ;->CF
00105B 505B D8              11      RET C
00105C 505C 29              11      ADD HL,HL
00105D 505D 18FB            12      JR  MUL_AHL1
                                
       505F                     DPB2DD:
00105F 505F F9                      DB  0F9H    ;MEDIA
001060 5060 0002                    DW  00200H  ;SECSIZ
001062 5062 0F                      DB  00FH    ;DIRMSK
001063 5063 04                      DB  004H    ;DIRSHFT
001064 5064 01                      DB  001H    ;CLUSMSK
001065 5065 02                      DB  002H    ;CLUSSHFT
001066 5066 0100                    DW  00001H  ;FIRFAT
001068 5068 02                      DB  002H    ;FATCNT
001069 5069 70                      DB  070H    ;MAXENT
00106A 506A 0E00                    DW  0000EH  ;FIRREC
00106C 506C CA02                    DW  002CAH  ;MAXCLUS
00106E 506E 03                      DB  003H    ;FATSIZ
00106F 506F 0700                    DW  0007H   ;FIRDIR
       5071                     DPB2DD_E:
                                
       5071                     AUTOEXEC:
001071 5071 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       507D                     CMD_RUN:
00107D 507D 3A8A00                  DB  03AH,08AH,0
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       5080                     POP_HL_ERROR:
001080 5080 E1              10      POP     HL
       5081                     _ERROR:
001081 5081 0600             7      LD  B,0
001083 5083 A7               4      AND A
001084 5084 C9              10      RET
                                
       5085                     ROM_BDOS:
001085 5085 E5              11      PUSH    HL
001086 5086 79               4      LD  A,C
001087 5087 87               4      ADD A,A
001088 5088 38F7            12      JR  C,_ERROR
00108A 508A 6F               4      LD  L,A
00108B 508B 265F             7      LD  H,high STABLE
00108D 508D 7E               7      LD  A,(HL)
00108E 508E 2C               4      INC L
00108F 508F 66               7      LD  H,(HL)
001090 5090 6F               4      LD  L,A
001091 5091 E3              19      EX  (SP),HL
001092 5092 79               4      LD  A,C
001093 5093 C9              10      RET
                                
       5094                     _PRINT:
       5094                     PRINT:
001094 5094 7B               4      LD  A,E
001095 5095 1803            12      JR  MSG_A
                                
       5097                     _SYS01:     ;(BDOS)コンソール入力
001097 5097 CD0E51          17      CALL    _SYS07
       509A                     MSG_A:
00109A 509A FE03             7      CP  3
00109C 509C 2814            12      JR  Z,MSG_BR
       509E                     MSGA1:
00109E 509E F5              11      PUSH    AF
00109F 509F C5              11      PUSH    BC
0010A0 50A0 D5              11      PUSH    DE
0010A1 50A1 E5              11      PUSH    HL
0010A2 50A2 DDE5            15      PUSH    IX
0010A4 50A4 DD21A200        14      LD  IX,CHPUT
0010A8 50A8 CDFB42          17      CALL    CALSLT_R
0010AB 50AB DDE1            14      POP IX
0010AD 50AD E1              10      POP HL
0010AE 50AE D1              10      POP DE
0010AF 50AF C1              10      POP BC
       50B0                     MSGA2:
0010B0 50B0 F1              10      POP AF
0010B1 50B1 C9              10      RET
       50B2                     MSG_BR:
0010B2 50B2 F5              11      PUSH    AF
0010B3 50B3 3ADDF3          13      LD  A,(CSRX)
0010B6 50B6 FE02             7      CP  2
0010B8 50B8 38F6            12      JR  C,MSGA2
0010BA 50BA F1              10      POP AF
       50BB                     MSG_CR:
0010BB 50BB F5              11      PUSH    AF
0010BC 50BC 3E0D             7      LD  A,00DH
0010BE 50BE CD9E50          17      CALL    MSGA1
0010C1 50C1 3E0A             7      LD  A,00AH
0010C3 50C3 CD9E50          17      CALL    MSGA1
0010C6 50C6 F1              10      POP AF
0010C7 50C7 C9              10      RET
                                
       50C8                     _SYS02:     ;(BDOS)コンソール出力
0010C8 50C8 CDE350          17      CALL    BREAK
0010CB 50CB 1805            12      JR  PRINTX
                                
       50CD                     _SYS06:     ;(BDOS)コンソール直接入出力
0010CD 50CD 7B               4      LD  A,E
0010CE 50CE 3C               4      INC A
0010CF 50CF CA2251          10      JP  Z,_INKEY
       50D2                     PRINTX:
0010D2 50D2 C39450          10      JP  _PRINT
                                
       50D5                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0010D5 50D5 CD0E51          17      CALL    _SYS07
0010D8 50D8 FE03             7      CP  3
0010DA 50DA CCE350          17      CALL    Z,_BREAK
0010DD 50DD FE13             7      CP  013H        ;CTRL+S
0010DF 50DF C0              11      RET NZ
       50E0                     PAUSE:
0010E0 50E0 CDFA50          17      CALL    KEYBC
                                
       50E3                     _BREAK:
       50E3                     BREAK:
0010E3 50E3 F5              11      PUSH    AF
0010E4 50E4 C5              11      PUSH    BC
0010E5 50E5 D5              11      PUSH    DE
0010E6 50E6 E5              11      PUSH    HL
0010E7 50E7 DDE5            15      PUSH    IX
0010E9 50E9 DD21B700        14      LD  IX,BREAKX
0010ED 50ED CDFB42          17      CALL    CALSLT_R
0010F0 50F0 DDE1            14      POP IX
0010F2 50F2 E1              10      POP HL
0010F3 50F3 D1              10      POP DE
0010F4 50F4 C1              10      POP BC
0010F5 50F5 DCE350          17      CALL    C,_BREAK
0010F8 50F8 F1              10      POP AF
0010F9 50F9 C9              10      RET
       50FA                     KEYBC:
0010FA 50FA F5              11      PUSH    AF
0010FB 50FB C5              11      PUSH    BC
0010FC 50FC D5              11      PUSH    DE
0010FD 50FD E5              11      PUSH    HL
0010FE 50FE DDE5            15      PUSH    IX
001100 5100 DD215601        14      LD  IX,KILBUF
001104 5104 CDFB42          17      CALL    CALSLT_R
001107 5107 DDE1            14      POP IX
001109 5109 E1              10      POP HL
00110A 510A D1              10      POP DE
00110B 510B C1              10      POP BC
00110C 510C F1              10      POP AF
00110D 510D C9              10      RET
                                
       510E                     _SYS07:
       510E                     FLGET:
00110E 510E C5              11      PUSH    BC
00110F 510F D5              11      PUSH    DE
001110 5110 E5              11      PUSH    HL
001111 5111 DDE5            15      PUSH    IX
001113 5113 DD219F00        14      LD  IX,CHGET
001117 5117 CDFB42          17      CALL    CALSLT_R
00111A 511A DDE1            14      POP IX
00111C 511C E1              10      POP HL
00111D 511D D1              10      POP DE
00111E 511E C1              10      POP BC
00111F 511F FE03             7      CP  3
001121 5121 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5122                     _INKEY:
       5122                     INKEY:
001122 5122 CDBC51          17      CALL    CPM_CONST
001125 5125 C8              11      RET Z
001126 5126 18E6            12      JR  FLGET
                                
       5128                     _SYS0A:     ;(BDOS)文字列入力
001128 5128 C5              11      PUSH    BC
001129 5129 E5              11      PUSH    HL
00112A 512A D5              11      PUSH    DE
00112B 512B CD5451          17      CALL    GETL
00112E 512E 111FF4          10      LD  DE,KBUF
001131 5131 E1              10      POP HL
001132 5132 E5              11      PUSH    HL
001133 5133 0E00             7      LD  C,0
001135 5135 3004            12      JR  NC,SAX0
001137 5137 23               6      INC HL
001138 5138 23               6      INC HL
001139 5139 1808            12      JR  SAX4
       513B                     SAX0:
00113B 513B 46               7      LD  B,(HL)
00113C 513C 23               6      INC HL
       513D                     SAX1:
00113D 513D 23               6      INC HL
00113E 513E 1A               7      LD  A,(DE)
00113F 513F 13               6      INC DE
001140 5140 B7               4      OR  A
001141 5141 2004            12      JR  NZ,SAX2
       5143                     SAX4:
001143 5143 360D            10      LD  (HL),00DH
001145 5145 1804            12      JR  SAX3
       5147                     SAX2:
001147 5147 77               7      LD  (HL),A
001148 5148 0C               4      INC C
001149 5149 10F2            13      DJNZ    SAX1
       514B                     SAX3:
00114B 514B D1              10      POP DE
00114C 514C 79               4      LD  A,C
00114D 514D 13               6      INC DE
00114E 514E 12               7      LD  (DE),A
00114F 514F 1B               6      DEC DE
001150 5150 E1              10      POP HL
001151 5151 C1              10      POP BC
001152 5152 A7               4      AND A
001153 5153 C9              10      RET
       5154                     GETL:
001154 5154 DDE5            15      PUSH    IX
001156 5156 FDE5            15      PUSH    IY
                                
001158 5158 2ADCF3          16      LD  HL,(CSRY)
00115B 515B 22CAFB          16      LD  (FSTPOS),HL
       515E                     GETL1:
00115E 515E CDD550          17      CALL    _SYS08
001161 5161 FE09             7      CP  9
001163 5163 2008            12      JR  NZ,GETL1V
001165 5165 211FF4          10      LD  HL,KBUF
001168 5168 CD8543          17      CALL    MSX
00116B 516B 18F1            12      JR  GETL1
       516D                     GETL1V:
00116D 516D 5F               4      LD  E,A
00116E 516E FE08             7      CP  8
001170 5170 CC0A52          17      CALL    Z,CTRL02
001173 5173 FE20             7      CP  020H
001175 5175 D43652          17      CALL    NC,INSERT
001178 5178 CD9E50          17      CALL    MSGA1
                                
00117B 517B 7B               4      LD  A,E
00117C 517C FE0D             7      CP  00DH
00117E 517E 20DE            12      JR  NZ,GETL1
                                
001180 5180 111FF4          10      LD  DE,KBUF
001183 5183 3AB0F3          13      LD  A,(LINLEN)
001186 5186 47               4      LD  B,A
001187 5187 CD1454          17      CALL    ZERO_MEMORY_DE
                                
00118A 518A 2ACAFB          16      LD  HL,(FSTPOS)
00118D 518D 3ADCF3          13      LD  A,(CSRY)
001190 5190 6F               4      LD  L,A
001191 5191 E5              11      PUSH    HL
001192 5192 CD6752          17      CALL    LOC0
001195 5195 4D               4      LD  C,L
001196 5196 44               4      LD  B,H
001197 5197 E1              10      POP HL
001198 5198 3AB0F3          13      LD  A,(LINLEN)
00119B 519B 94               4      SUB H
00119C 519C 3D               4      DEC A
00119D 519D 5F               4      LD  E,A
00119E 519E 211FF4          10      LD  HL,KBUF
       51A1                     GETL2:
0011A1 51A1 CDFA51          17      CALL    _SCRN
0011A4 51A4 03               6      INC BC
0011A5 51A5 77               7      LD  (HL),A
0011A6 51A6 23               6      INC HL
0011A7 51A7 1D               4      DEC E
0011A8 51A8 20F7            12      JR  NZ,GETL2
0011AA 51AA CDBB50          17      CALL    MSG_CR
                                
0011AD 51AD FDE1            14      POP IY
0011AF 51AF DDE1            14      POP IX
       51B1                     GETL3:
0011B1 51B1 2B               6      DEC HL
0011B2 51B2 7E               7      LD  A,(HL)
0011B3 51B3 FE21             7      CP  021H
0011B5 51B5 D0              11      RET NC
0011B6 51B6 3600            10      LD  (HL),0
0011B8 51B8 15               4      DEC D
0011B9 51B9 20F6            12      JR  NZ,GETL3
0011BB 51BB C9              10      RET
                                
       51BC                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       51BC                     CONSTX:
       51BC                     CPM_CONST:
0011BC 51BC C5              11      PUSH    BC
0011BD 51BD D5              11      PUSH    DE
0011BE 51BE E5              11      PUSH    HL
0011BF 51BF DDE5            15      PUSH    IX
0011C1 51C1 DD219C00        14      LD  IX,CHSNS
0011C5 51C5 CDFB42          17      CALL    CALSLT_R
0011C8 51C8 DDE1            14      POP IX
0011CA 51CA E1              10      POP HL
0011CB 51CB D1              10      POP DE
0011CC 51CC C1              10      POP BC
0011CD 51CD C9              10      RET
                                
       51CE                     _SYS2A:     ;(BDOS)日付の獲得
0011CE 51CE AF               4      XOR A
0011CF 51CF 57               4      LD  D,A
0011D0 51D0 5F               4      LD  E,A
0011D1 51D1 67               4      LD  H,A
0011D2 51D2 6F               4      LD  L,A
0011D3 51D3 C9              10      RET
                                
       51D4                     _SYS2C:     ;(BDOS)時刻の獲得
0011D4 51D4 AF               4      XOR A
0011D5 51D5 57               4      LD  D,A
0011D6 51D6 5F               4      LD  E,A
0011D7 51D7 67               4      LD  H,A
0011D8 51D8 6F               4      LD  L,A
0011D9 51D9 C9              10      RET
                                
       51DA                     POS:
0011DA 51DA F5              11      PUSH    AF
0011DB 51DB 2ADCF3          16      LD  HL,(CSRY)
0011DE 51DE 7D               4      LD  A,L
0011DF 51DF 6C               4      LD  L,H
0011E0 51E0 67               4      LD  H,A
0011E1 51E1 2C               4      INC L
0011E2 51E2 24               4      INC H
0011E3 51E3 F1              10      POP AF
0011E4 51E4 C9              10      RET
                                
       51E5                     LOC:
0011E5 51E5 F5              11      PUSH    AF
0011E6 51E6 E5              11      PUSH    HL
0011E7 51E7 7D               4      LD  A,L
0011E8 51E8 6C               4      LD  L,H
0011E9 51E9 67               4      LD  H,A
0011EA 51EA 2D               4      DEC L
0011EB 51EB 25               4      DEC H
0011EC 51EC DDE5            15      PUSH    IX
0011EE 51EE DD21C600        14      LD  IX,POSIT
0011F2 51F2 CDFB42          17      CALL    CALSLT_R
0011F5 51F5 DDE1            14      POP IX
0011F7 51F7 E1              10      POP HL
0011F8 51F8 F1              10      POP AF
0011F9 51F9 C9              10      RET
                                
       51FA                     _SCRN:
       51FA                     SCRN:
0011FA 51FA E5              11      PUSH    HL
0011FB 51FB DDE5            15      PUSH    IX
                                
0011FD 51FD 69               4      LD  L,C
0011FE 51FE 60               4      LD  H,B
0011FF 51FF DD214A00        14      LD  IX,RDVRM
001203 5203 CDFB42          17      CALL    CALSLT_R
                                
001206 5206 DDE1            14      POP IX
001208 5208 E1              10      POP HL
001209 5209 C9              10      RET
                                
       520A                     CTRL02:
00120A 520A F5              11      PUSH    AF
00120B 520B D5              11      PUSH    DE
00120C 520C 2ADCF3          16      LD  HL,(CSRY)
00120F 520F 3AB0F3          13      LD  A,(LINLEN)
001212 5212 4F               4      LD  C,A
001213 5213 94               4      SUB H   ;CSRX
001214 5214 C602             7      ADD A,2
001216 5216 47               4      LD  B,A ;カーソルより右の文字数
001217 5217 61               4      LD  H,C ;LINLEN
001218 5218 C5              11      PUSH    BC
001219 5219 CD6752          17      CALL    LOC0
00121C 521C C1              10      POP BC
                                
00121D 521D 1620             7      LD  D,020H
       521F                     C8X1:
00121F 521F DD214A00        14      LD  IX,RDVRM
001223 5223 CDFB42          17      CALL    CALSLT_R
001226 5226 4F               4      LD  C,A
001227 5227 7A               4      LD  A,D
001228 5228 DD214D00        14      LD  IX,WRTVRM
00122C 522C CDFB42          17      CALL    CALSLT_R
00122F 522F 2B               6      DEC HL
001230 5230 51               4      LD  D,C
001231 5231 10EC            13      DJNZ    C8X1
001233 5233 D1              10      POP DE
001234 5234 F1              10      POP AF
001235 5235 C9              10      RET
                                
       5236                     INSERT:
001236 5236 F5              11      PUSH    AF
001237 5237 D5              11      PUSH    DE
001238 5238 2ADCF3          16      LD  HL,(CSRY)
00123B 523B 3AB0F3          13      LD  A,(LINLEN)
00123E 523E 4F               4      LD  C,A
00123F 523F 94               4      SUB H   ;CSRX
001240 5240 3C               4      INC A
001241 5241 47               4      LD  B,A ;カーソルより右の文字数
001242 5242 C5              11      PUSH    BC
001243 5243 CD6752          17      CALL    LOC0
001246 5246 C1              10      POP BC
                                
001247 5247 1620             7      LD  D,020H
       5249                     INS1:
001249 5249 DD214A00        14      LD  IX,RDVRM
00124D 524D CDFB42          17      CALL    CALSLT_R
001250 5250 4F               4      LD  C,A
001251 5251 7A               4      LD  A,D
001252 5252 DD214D00        14      LD  IX,WRTVRM
001256 5256 CDFB42          17      CALL    CALSLT_R
001259 5259 23               6      INC HL
00125A 525A 51               4      LD  D,C
00125B 525B 10EC            13      DJNZ    INS1
00125D 525D D1              10      POP DE
00125E 525E F1              10      POP AF
00125F 525F C9              10      RET
                                
       5260                     CONOUT1:
001260 5260 59               4      LD  E,C
001261 5261 C39450          10      JP  _PRINT
                                
       5264                     GETVRAM:
001264 5264 2ADCF3          16      LD  HL,(CSRY)
       5267                     LOC0:
001267 5267 2D               4      DEC L
001268 5268 25               4      DEC H
001269 5269 4C               4      LD  C,H ;CSRX-1
00126A 526A 5D               4      LD  E,L ;CSRY-1
       526B                     LOC1:
00126B 526B 3AB0F3          13      LD  A,(LINLEN)
00126E 526E 67               4      LD  H,A
00126F 526F 1600             7      LD  D,0
001271 5271 6A               4      LD  L,D ;0
001272 5272 0608             7      LD  B,8
       5274                     LOC2:
001274 5274 29              11      ADD HL,HL
001275 5275 3001            12      JR  NC,LOC3
001277 5277 19              11      ADD HL,DE
       5278                     LOC3:
001278 5278 10FA            13      DJNZ    LOC2
00127A 527A 09              11      ADD HL,BC
00127B 527B C9              10      RET
                                
       527C                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00127C 527C 212200          10      LD  HL,00022H
00127F 527F AF               4      XOR A
001280 5280 7D               4      LD  A,L
001281 5281 C9              10      RET
                                
       5282                     _SYS0D:     ;(BDOS)ディスク・リセット
001282 5282 218000          10      LD  HL,00080H
001285 5285 2230F1          16      LD  (_DTA),HL
001288 5288 C9              10      RET
                                
       5289                     _SYS0E:     ;(BDOS)カレントドライブの設定
001289 5289 3246F1          13      LD  (_DVSW),A
00128C 528C C9              10      RET
                                
       528D                     _SYS0F:     ;(BDOS)ファイルのオープン
00128D 528D D5              11      PUSH    DE
00128E 528E FDE1            14      POP IY
001290 5290 CDFB53          17      CALL    INIT_FILE
001293 5293 CD074B          17      CALL    ROM_OPEN
001296 5296 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001298 5298 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
00129C 529C FDE5            15      PUSH    IY
00129E 529E D1              10      POP DE
00129F 529F 13               6      INC DE
0012A0 52A0 010B00          10      LD  BC,11
0012A3 52A3 EDB0                    LDIR
                                ;               Attribute
0012A5 52A5 7E               7      LD  A,(HL)
0012A6 52A6 FD770D          19      LD  (IY+13),A
                                ;               TIME
0012A9 52A9 110B00          10      LD  DE,11
0012AC 52AC 19              11      ADD HL,DE
0012AD 52AD 7E               7      LD  A,(HL)
0012AE 52AE 23               6      INC HL
0012AF 52AF FD7716          19      LD  (IY+22),A
0012B2 52B2 7E               7      LD  A,(HL)
0012B3 52B3 23               6      INC HL
0012B4 52B4 FD7717          19      LD  (IY+23),A
                                ;               DATE
0012B7 52B7 7E               7      LD  A,(HL)
0012B8 52B8 23               6      INC HL
0012B9 52B9 FD7714          19      LD  (IY+20),A
0012BC 52BC 7E               7      LD  A,(HL)
0012BD 52BD 23               6      INC HL
0012BE 52BE FD7715          19      LD  (IY+21),A
                                ;               First cluster
0012C1 52C1 7E               7      LD  A,(HL)
0012C2 52C2 23               6      INC HL
0012C3 52C3 FD771A          19      LD  (IY+26),A
0012C6 52C6 7E               7      LD  A,(HL)
0012C7 52C7 23               6      INC HL
0012C8 52C8 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0012CB 52CB 7E               7      LD  A,(HL)
0012CC 52CC 23               6      INC HL
0012CD 52CD FD7710          19      LD  (IY+16),A
0012D0 52D0 7E               7      LD  A,(HL)
0012D1 52D1 23               6      INC HL
0012D2 52D2 FD7711          19      LD  (IY+17),A
0012D5 52D5 7E               7      LD  A,(HL)
0012D6 52D6 23               6      INC HL
0012D7 52D7 FD7712          19      LD  (IY+18),A
0012DA 52DA 7E               7      LD  A,(HL)
0012DB 52DB FD7713          19      LD  (IY+19),A
0012DE 52DE AF               4      XOR A
0012DF 52DF FD770C          19      LD  (IY+12),A
0012E2 52E2 C9              10      RET
                                
       52E3                     _SYS10:     ;(BDOS)ファイルのクローズ
0012E3 52E3 AF               4      XOR A
0012E4 52E4 C9              10      RET
                                
       52E5                     S11X1:
0012E5 52E5 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012E8 52E8 FD750E          19      LD  (IY+14),L
0012EB 52EB FD740F          19      LD  (IY+15),H
       52EE                     SCF_FF_RET:
0012EE 52EE 37               4      SCF
0012EF 52EF 9F               4      SBC A,A
0012F0 52F0 C9              10      RET
                                
       52F1                     _SYS11:     ;(BDOS)最初のファイルの検索
0012F1 52F1 ED5333F1        20      LD  (_FCB),DE
0012F5 52F5 D5              11      PUSH    DE
0012F6 52F6 FDE1            14      POP IY
0012F8 52F8 CDFB53          17      CALL    INIT_FILE
0012FB 52FB CD744D          17      CALL    GET_DIR_DAT
       52FE                     S12X1:
0012FE 52FE CD234B          17      CALL    FILESE
001301 5301 30E2            12      JR  NC,S11X1
001303 5303 0D               4      DEC C
001304 5304 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001307 5307 FDCB0D66        20      BIT 4,(IY+13)
00130B 530B 2809            12      JR  Z,S12X2
00130D 530D E5              11      PUSH    HL
00130E 530E DDE1            14      POP IX
001310 5310 DDCB0E66        20      BIT 4,(IX+1+13)
001314 5314 28E8            12      JR  Z,S12X1
       5316                     S12X2:
001316 5316 012000          10      LD  BC,32
001319 5319 ED5B30F1        20      LD  DE,(_DTA)
00131D 531D AF               4      XOR A
00131E 531E 12               7      LD  (DE),A      ;ドライブ番号
00131F 531F 13               6      INC DE
001320 5320 EDB0                    LDIR            ;ディレクトリエントリ
001322 5322 FD750E          19      LD  (IY+14),L
001325 5325 FD740F          19      LD  (IY+15),H
001328 5328 C9              10      RET
                                
       5329                     _SYS12:
001329 5329 FD2A33F1        20      LD  IY,(_FCB)
00132D 532D FDE5            15      PUSH    IY
00132F 532F D1              10      POP DE
001330 5330 CDFB53          17      CALL    INIT_FILE
                                
001333 5333 FD6E0E          19      LD  L,(IY+14)
001336 5336 FD660F          19      LD  H,(IY+15)
001339 5339 FD4E19          19      LD  C,(IY+25)
00133C 533C 18C0            12      JR  S12X1
                                
       533E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00133E 533E CD5A4D          17      CALL    SET_FCB
001341 5341 CD284D          17      CALL    GETSEQ
001344 5344 CD154D          17      CALL    RB_READ
001347 5347 E5              11      PUSH    HL
001348 5348 CD354D          17      CALL    SETSEQ
00134B 534B E1              10      POP HL
       534C                     SREAD:
00134C 534C C601             7      ADD A,001H
00134E 534E D8              11      RET C
                                
00134F 534F 7D               4      LD  A,L
001350 5350 D601             7      SUB 001H
001352 5352 9F               4      SBC A,A
001353 5353 E603             7      AND 3
001355 5355 1F               4      RRA
001356 5356 C9              10      RET
                                
       5357                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001357 5357 210100          10      LD  HL,00001H
00135A 535A AF               4      XOR A
00135B 535B C9              10      RET
                                
       535C                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00135C 535C 3A46F1          13      LD  A,(_DVSW)
00135F 535F C9              10      RET
                                
       5360                     _SYS1A:     ;(BDOS)DTAの設定
001360 5360 ED5330F1        20      LD  (_DTA),DE
001364 5364 AF               4      XOR A
001365 5365 C9              10      RET
                                
       5366                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001366 5366 010002          10      LD  BC,512
001369 5369 11C302          10      LD  DE,707
00136C 536C 210000          10      LD  HL,0
00136F 536F DD2135F1        14      LD  IX,_BUF
001373 5373 FD2135F1        14      LD  IY,_BUF
001377 5377 FD3600F9        19      LD  (IY+0),0F9H
00137B 537B 3E02             7      LD  A,2
00137D 537D C9              10      RET
                                
       537E                     _SYS21:     ;(BDOS)ランダムな読み出し
00137E 537E CD5A4D          17      CALL    SET_FCB
                                
001381 5381 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001384 5384 FD6622          19      LD  H,(IY+34)
                                
001387 5387 CD154D          17      CALL    RB_READ
00138A 538A 18C0            12      JR  SREAD
                                
       538C                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00138C 538C CD8D52          17      CALL    _SYS0F
00138F 538F D8              11      RET C
                                
001390 5390 D5              11      PUSH    DE      ;EX DE,IY
001391 5391 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001393 5393 CD4A4D          17      CALL    GETSIZE
       5396                     _S24X1:
001396 5396 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001399 5399 FD7422          19      LD  (IY+34),H
00139C 539C FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0013A0 53A0 FDE3            23      EX  (SP),IY     ;
0013A2 53A2 D1              10      POP DE      ;
                                
0013A3 53A3 AF               4      XOR A
0013A4 53A4 C9              10      RET
                                
       53A5                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0013A5 53A5 E5              11      PUSH    HL
0013A6 53A6 D5              11      PUSH    DE      ;EX DE,IY
0013A7 53A7 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013A9 53A9 CD284D          17      CALL    GETSEQ
0013AC 53AC 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       53AE                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0013AE 53AE CD5A4D          17      CALL    SET_FCB
0013B1 53B1 E5              11      PUSH    HL
0013B2 53B2 FD6E21          19      LD  L,(IY+33)
0013B5 53B5 FD6622          19      LD  H,(IY+34)
0013B8 53B8 2226F1          16      LD  (RR_LOW),HL
0013BB 53BB FD6E23          19      LD  L,(IY+35)
0013BE 53BE FD6624          19      LD  H,(IY+36)
0013C1 53C1 2228F1          16      LD  (RR_HIGH),HL
0013C4 53C4 E1              10      POP HL
0013C5 53C5 CDE748          17      CALL    ROM_READ
0013C8 53C8 ED5B26F1        20      LD  DE,(RR_LOW)
0013CC 53CC FD7321          19      LD  (IY+33),E
0013CF 53CF FD7222          19      LD  (IY+34),D
0013D2 53D2 ED5B28F1        20      LD  DE,(RR_HIGH)
0013D6 53D6 FD7323          19      LD  (IY+35),E
0013D9 53D9 FD7224          19      LD  (IY+36),D
0013DC 53DC 9F               4      SBC A,A
0013DD 53DD C9              10      RET
                                
       53DE                     _SYS2F:
0013DE 53DE 44               4      LD  B,H
0013DF 53DF 2A30F1          16      LD  HL,(_DTA)
0013E2 53E2 C3624E          10      JP  DISKIO
                                
       53E5                     _SYS5A:
0013E5 53E5 0600             7      LD  B,0
0013E7 53E7 D5              11      PUSH    DE
0013E8 53E8 DDE1            14      POP IX
       53EA                     _SX5A1:
0013EA 53EA 1A               7      LD  A,(DE)
0013EB 53EB B7               4      OR  A
0013EC 53EC 2804            12      JR  Z,_SX5A2
0013EE 53EE 13               6      INC DE
0013EF 53EF 04               4      INC B
0013F0 53F0 18F8            12      JR  _SX5A1
                                
       53F2                     _SX5A2:
0013F2 53F2 78               4      LD  A,B
0013F3 53F3 CDB249          17      CALL    FILE_BDOS
0013F6 53F6 CDFD4D          17      CALL    ROM_CD
0013F9 53F9 9F               4      SBC A,A
0013FA 53FA C9              10      RET
                                
       53FB                     INIT_FILE:
0013FB 53FB EB               4      EX  DE,HL
0013FC 53FC 1150F1          10      LD  DE,FDRV
0013FF 53FF 010C00          10      LD  BC,1+8+3
001402 5402 EDB0                    LDIR
001404 5404 CD2D50          17      CALL    GET_DISK_BANK_FDRV
001407 5407 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00140A 540A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
00140D 540D 2A5CF1          16      LD  HL,(_CD)
001410 5410 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
001413 5413 C9              10      RET
                                
       5414                     ZERO_MEMORY_DE:
001414 5414 AF               4      XOR A
       5415                     FILL_MEMORY_DE:
001415 5415 12               7      LD  (DE),A
001416 5416 13               6      INC DE
001417 5417 10FC            13      DJNZ    FILL_MEMORY_DE
001419 5419 C9              10      RET
                                
00141A 541A                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 81509750C8508150        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 81508150CD500E51        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 D55081502851BC51        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 7C52825289528D52        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 E352F15229538150        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 3E53815081508150        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 57535C5360536653        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 8150815081508C53        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 A55381508150AE53        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 81508150CE518150        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 D45181508150DE53        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 81508150E5538150        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 8150815081508150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
