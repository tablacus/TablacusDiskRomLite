                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
                                ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
                                ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
       F280                     ISC EQU 0F280H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU 0F280H
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 554E                    DW  STATEMENT   ; STATEMENT
000006 4006 534F                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3D44F          10      JP  DISKIO
000013 4013 C30F50          10      JP  DSKCHG
000016 4016 C36550          10      JP  GETDPB
000019 4019 C35851          10      JP  CHOICE
00001C 401C C35C51          10      JP  DSKFMT
00001F 401F C35E51          10      JP  DSKSTP
000022 4022 C35F51          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C35C51          10      JP  DSKFMT
000029 4029 C35E51          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C39851          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.4.1.0",0
            204449534B20524F    
            4D204C6974652076    
            302E342E312E3000    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 AF               4      XOR A
000107 4107 2100F3          10      LD  HL,0F300H
00010A 410A 0668             7      LD  B,068H
00010C 410C CD094B          17      CALL    FILL_MEMORY
                                
00010F 410F 3E01             7      LD  A,1
000111 4111 3221FB          13      LD  (DRVTBL),A
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  HL,(STKTOP) ;起動時の空き容量表示の為
                                    LD  BC,-00140H
                                    ADD HL,BC
                                    LD  (STKTOP),HL
                                #else
000114 4114 2175F6          10      LD  HL,STKTOP+1 ;起動時の空き容量表示の為
000117 4117 35              11      DEC (HL)
                                #endif
                                
000118 4118 AF               4      XOR A
000119 4119 32DDF2          13      LD  (_DVSW),A
00011C 411C 3D               4      DEC A       ;0FFH
00011D 411D 3299FD          13      LD  (DEVICE),A
                                
000120 4120 21E042          10      LD  HL,AT_ISC
000123 4123 1180F2          10      LD  DE,ISC
000126 4126 017B00          10      LD  BC,ISC_E-ISC
000129 4129 EDB0                    LDIR
                                    
00012B 412B 3EC3             7      LD  A,0C3H      ;JP
00012D 412D 3243FF          13      LD  (H_GONE),A
000130 4130 327DF3          13      LD  (BDOS),A
000133 4133 326BF3          13      LD  (RAMUSE),A
000136 4136 3268F3          13      LD  (ROMUSE),A
000139 4139 2180F2          10      LD  HL,REPLACE_COMMAND
00013C 413C 2244FF          16      LD  (H_GONE+1),HL
00013F 413F 2131F3          10      LD  HL,H_BDOS
000142 4142 227EF3          16      LD  (BDOS+1),HL
000145 4145 21B0F2          10      LD  HL,RAMUSE1
000148 4148 226CF3          16      LD  (RAMUSE+1),HL
00014B 414B 21ABF2          10      LD  HL,ROMUSE1
00014E 414E 2269F3          16      LD  (ROMUSE+1),HL
                                
000151 4151 3E                      DB  03EH
000152 4152 F7              12      RST 30H
000153 4153 3271FE          13      LD  (H_BINS),A
000156 4156 3276FE          13      LD  (H_BINL),A
000159 4159 327BFE          13      LD  (H_FILE),A
00015C 415C 3231F3          13      LD  (H_BDOS),A
00015F 415F 32DBFD          13      LD  (H_PINL),A
000162 4162 32A7FF          13      LD  (H_PHYD),A
                                
000165 4165 CD2C42          17      CALL    GTSL1_
000168 4168 3297F2          13      LD  (ROM_SLT),A
00016B 416B 32A7F2          13      LD  (ROM_SLT_COPY),A
00016E 416E 3272FE          13      LD  (H_BINS+1),A
000171 4171 3277FE          13      LD  (H_BINL+1),A
000174 4174 327CFE          13      LD  (H_FILE+1),A
000177 4177 3232F3          13      LD  (H_BDOS+1),A
00017A 417A 32DCFD          13      LD  (H_PINL+1),A
00017D 417D 32A8FF          13      LD  (H_PHYD+1),A
000180 4180 3222FB          13      LD  (DRVTBL+1),A
000183 4183 3248F3          13      LD  (MASTERS),A
                                
000186 4186 210D45          10      LD  HL,ROM_LOAD
000189 4189 2273FE          16      LD  (H_BINS+2),HL
00018C 418C 21BD46          10      LD  HL,ROM_RUN
00018F 418F 2278FE          16      LD  (H_BINL+2),HL
000192 4192 21CB46          10      LD  HL,ROM_FILES
000195 4195 227DFE          16      LD  (H_FILE+2),HL
000198 4198 21FC51          10      LD  HL,ROM_BDOS
00019B 419B 2233F3          16      LD  (H_BDOS+2),HL
00019E 419E 219643          10      LD  HL,ROM_BOOT
0001A1 41A1 22DDFD          16      LD  (H_PINL+2),HL
0001A4 41A4 21D44F          10      LD  HL,DISKIO
0001A7 41A7 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001AA 41AA 3E                      DB  03EH
0001AB 41AB C9              10      RET
0001AC 41AC 327FFE          13      LD  (H_FILE+4),A
0001AF 41AF 3275FE          13      LD  (H_BINS+4),A
0001B2 41B2 327AFE          13      LD  (H_BINL+4),A
0001B5 41B5 3235F3          13      LD  (H_BDOS+4),A
0001B8 41B8 32DFFD          13      LD  (H_PINL+4),A
0001BB 41BB 32ABFF          13      LD  (H_PHYD+4),A
                                
0001BE 41BE AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001BF 41BF 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001C2 41C2 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001C5 41C5 3A0060          13      LD  A,(BANK1_ADR)
0001C8 41C8 FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001CA 41CA 204F            12      JR  NZ,NOT_BANK_TYPE
0001CC 41CC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001CF 41CF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D2 41D2 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D5 41D5 07               4      RLCA
0001D6 41D6 07               4      RLCA
0001D7 41D7 F5              11      PUSH    AF
0001D8 41D8 1605             7      LD  D,4+1
0001DA 41DA CD3342          17      CALL    GTSL2_
0001DD 41DD 3244F3          13      LD  (RAMAD3),A
0001E0 41E0 F1              10      POP AF
0001E1 41E1 07               4      RLCA
0001E2 41E2 07               4      RLCA
0001E3 41E3 1603             7      LD  D,2+1
0001E5 41E5 CD3342          17      CALL    GTSL2_
0001E8 41E8 2680             7      LD  H,080H
0001EA 41EA CD5042          17      CALL    CHK_RAM
0001ED 41ED 3243F3          13      LD  (RAMAD2),A
       41F0                     RAMCHK2:
0001F0 41F0 3A44F3          13      LD  A,(RAMAD3)
0001F3 41F3 2640             7      LD  H,040H
0001F5 41F5 CD5042          17      CALL    CHK_RAM
0001F8 41F8 3242F3          13      LD  (RAMAD1),A
       41FB                     RAMCHK1:
0001FB 41FB 3A44F3          13      LD  A,(RAMAD3)
0001FE 41FE 2600             7      LD  H,00H
000200 4200 CD5042          17      CALL    CHK_RAM
000203 4203 3241F3          13      LD  (RAMAD0),A
       4206                     RAMCHK0:
000206 4206 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000209 4209 010F00          10      LD  BC,0000FH       ;切り上げ
00020C 420C 09              11      ADD HL,BC
00020D 420D 7D               4      LD  A,L
                                
00020E 420E 0604             7      LD  B,4
       4210                     B_DRIVE1:
000210 4210 CB3C             8      SRL H
000212 4212 1F               4      RRA
000213 4213 10FB            13      DJNZ    B_DRIVE1
                                
000215 4215 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000217 4217 32DCF2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
00021A 421A C9              10      RET
                                
       421B                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
00021B 421B 21D943          10      LD  HL,MSG_ERROR_ROM_MODE
00021E 421E CD5E43          17      CALL    MSX
000221 4221 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000225 4225 DD219F00        14      LD  IX,CHGET
000229 4229 C31C00          10      JP  _CALSLT
                                
       422C                     GTSL1_:             ;自分のいるスロットを知る
00022C 422C CD3801          17      CALL    RSLREG      ;read primary slot #
00022F 422F 0F               4      RRCA
000230 4230 0F               4      RRCA
000231 4231 1601             7      LD  D,1
       4233                     GTSL2_:
000233 4233 E603             7      AND 3       ;[A]=000000PP
000235 4235 5F               4      LD  E,A     ;[E]=000000PP
000236 4236 21C1FC          10      LD  HL,EXPTBL
000239 4239 85               4      ADD A,L     ;桁上りは無い
00023A 423A 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00023B 423B 7B               4      LD  A,E     ;[A]=000000PP
00023C 423C CB7E            13      BIT 7,(HL)
00023E 423E C8              11      RET Z
00023F 423F 7D               4      LD  A,L     ;point to SLTTBL entry
000240 4240 C604             7      ADD A,4     ;桁上りは無い
000242 4242 6F               4      LD  L,A
000243 4243 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4244                     GTSL3_:
000244 4244 15               4      DEC D
000245 4245 2803            12      JR  Z,GTSL4_:
000247 4247 0F               4      RRCA
000248 4248 18FA            12      JR  GTSL3_:
       424A                     GTSL4_:
00024A 424A E60C             7      AND 00CH        ;[A] = 0000SS00
00024C 424C B3               4      OR  E       ;[A] = 0000SSPP
00024D 424D F680             7      OR  080H        ;[A] = 1000SSPP
00024F 424F C9              10      RET
                                
       4250                     CHK_RAM:
000250 4250 E5              11      PUSH    HL
000251 4251 CDA542          17      CALL    CHK_RAM0
000254 4254 E1              10      POP HL
000255 4255 C8              11      RET Z
000256 4256 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000259 4259 E680             7      AND 080H
00025B 425B CD7C42          17      CALL    CHK_RAM_SLT
00025E 425E C8              11      RET Z
00025F 425F 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000262 4262 E680             7      AND 080H
000264 4264 C601             7      ADD A,1
000266 4266 CD7C42          17      CALL    CHK_RAM_SLT
000269 4269 C8              11      RET Z
00026A 426A 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00026D 426D E680             7      AND 080H
00026F 426F C602             7      ADD A,2
000271 4271 CD7C42          17      CALL    CHK_RAM_SLT
000274 4274 C8              11      RET Z
000275 4275 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000278 4278 E680             7      AND 080H
00027A 427A C603             7      ADD A,3
       427C                     CHK_RAM_SLT:
00027C 427C E5              11      PUSH    HL
00027D 427D CDA542          17      CALL    CHK_RAM0        ;スロット#X or X-0
000280 4280 E1              10      POP HL
000281 4281 C8              11      RET Z
000282 4282 CB79             8      BIT 7,C
000284 4284 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
000286 4286 79               4      LD  A,C
000287 4287 C604             7      ADD A,4*1           ;スロット#X-1
000289 4289 E5              11      PUSH    HL
00028A 428A CDA542          17      CALL    CHK_RAM0
00028D 428D E1              10      POP HL
00028E 428E C8              11      RET Z
00028F 428F 79               4      LD  A,C
000290 4290 C608             7      ADD A,4*2           ;スロット#X-2
000292 4292 E5              11      PUSH    HL
000293 4293 CDA542          17      CALL    CHK_RAM0
000296 4296 E1              10      POP HL
000297 4297 C8              11      RET Z
000298 4298 79               4      LD  A,C
000299 4299 C60C             7      ADD A,4*3           ;スロット#X-3
00029B 429B E5              11      PUSH    HL
00029C 429C CDA542          17      CALL    CHK_RAM0
00029F 429F E1              10      POP HL
       42A0                     CHK_RAM_E:
0002A0 42A0 AF               4      XOR A
0002A1 42A1 3C               4      INC A           ;ZF=0にする
0002A2 42A2 3E00             7      LD  A,0
0002A4 42A4 C9              10      RET
                                
       42A5                     CHK_RAM0:
0002A5 42A5 4F               4      LD  C,A
0002A6 42A6 3A97F2          13      LD  A,(ROM_SLT)
0002A9 42A9 B9               4      CP  C
0002AA 42AA 28F4            12      JR  Z,CHK_RAM_E
0002AC 42AC 2E00             7      LD  L,0
       42AE                     CHK_RAM1:
0002AE 42AE 79               4      LD  A,C
0002AF 42AF CD8E43          17      CALL    RDSLTX
0002B2 42B2 C6E5             7      ADD A,0E5H
0002B4 42B4 47               4      LD  B,A
0002B5 42B5 5F               4      LD  E,A
0002B6 42B6 79               4      LD  A,C
0002B7 42B7 C5              11      PUSH    BC
0002B8 42B8 CD1400          17      CALL    _WRSLT
0002BB 42BB C1              10      POP BC
0002BC 42BC 79               4      LD  A,C
0002BD 42BD CD8E43          17      CALL    RDSLTX
0002C0 42C0 B8               4      CP  B
0002C1 42C1 C0              11      RET NZ
0002C2 42C2 D6E5             7      SUB 0E5H
0002C4 42C4 79               4      LD  A,C
0002C5 42C5 5F               4      LD  E,A
0002C6 42C6 C5              11      PUSH    BC
0002C7 42C7 CD1400          17      CALL    _WRSLT
0002CA 42CA C1              10      POP BC
0002CB 42CB 24               4      INC H
0002CC 42CC 7D               4      LD  A,L
0002CD 42CD C604             7      ADD A,4
0002CF 42CF 6F               4      LD  L,A
0002D0 42D0 20DC            12      JR  NZ,CHK_RAM1
0002D2 42D2 79               4      LD  A,C     ;ZF=1のハズ
0002D3 42D3 C9              10      RET
                                
       42D4                     CALSLT_R:
0002D4 42D4 C5              11      PUSH    BC
0002D5 42D5 E5              11      PUSH    HL
0002D6 42D6 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DA 42DA CD1C00          17      CALL    _CALSLT
0002DD 42DD E1              10      POP HL
0002DE 42DE C1              10      POP BC
0002DF 42DF C9              10      RET
                                
       42E0                     AT_ISC:
0002E0 F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
0002E0 F280 FEB7             7      CP  0B7H            ;FILES
0002E2 F282 CC7BFE          17      CALL    Z,H_FILE
0002E5 F285 FEB5             7      CP  0B5H            ;LOAD
0002E7 F287 CA71FE          10      JP  Z,H_BINS
0002EA F28A FE8A             7      CP  08AH            ;RUN
0002EC F28C CA76FE          10      JP  Z,H_BINL
0002EF F28F FED6             7      CP  0D6H            ;COPY
0002F1 F291 2813            12      JR  Z,FIX_COPY
0002F3 F293 FECF             7      CP  0CFH            ;BLOAD
0002F5 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
0002F6 F296 F7              12      RST 30H
       F297                     ROM_SLT:
0002F7 F297 00                      DB  0
0002F8 F298 EF45                    DW  ROM_BLOAD
0002FA F29A F5              11      PUSH    AF
0002FB F29B E5              11      PUSH    HL
0002FC F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
0002FF F29F E1              10      POP HL
000300 F2A0 F1              10      POP AF
000301 F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000303 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000305 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000306 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000307 F2A7 00                      DB  0
000308 F2A8 6947                    DW  ROM_COPY
00030A F2AA C9              10      RET
       F2AB                     ROMUSE1:
00030B F2AB 3A97F2          13      LD  A,(ROM_SLT)
00030E F2AE 1803            12      JR  ROMUSE2
       F2B0                     RAMUSE1:
000310 F2B0 3A42F3          13      LD  A,(RAMAD1)
       F2B3                     ROMUSE2:
000313 F2B3 C32400          10      JP  _ENASLT
                                
       F2B6                     _RESULT:
000316 F2B6 00                      DB  0
       F2B7                     _BANK:
000317 F2B7 00                      DB  0
       F2B8                     _BANK1:
000318 F2B8 00                      DB  0
       F2B9                     CLSZ:               ;クラスタサイズ
000319 F2B9 0004                    DW  1024
       F2BA                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2BB                     SECSZ:              ;セクタサイズ
00031B F2BB 0002                    DW  512
       F2BC                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2BD                     RR_LOW:
00031D F2BD 0000                    DW  0
       F2BE                     RR_MID  EQU $-1
       F2BF                     RR_HIGH:
00031F F2BF 0000                    DW  0
       F2C1                     _CLPS:
000321 F2C1 0000                    DW  0
       F2C3                     _LEFT:
000323 F2C3 0000                    DW  0
       F2C5                     _DTPS:
000325 F2C5 0000                    DW  0
       F2C7                     _DTA:
000327 F2C7 0000                    DW  0
       F2C9                     FLG_LDIR:
000329 F2C9 00                      DB  0
       F2CA                     _FCB:
00032A F2CA 0000                    DW  0
       F2CC                     _BUF:
       F2CC                     _BUF_LO:        ;LOGICAL OPERATION
00032C F2CC 00                      DB  0
       F2CD                     _BUF_ST:
00032D F2CD 0000                    DW  0
       F2CF                     _BUF_EN:
00032F F2CF 0000                    DW  0
       F2D1                     _BUF_EX:
       F2D1                     _BUF_W:
000331 F2D1 0000                    DW  0
       F2D3                     _BUF_H:
000333 F2D3 0000                    DW  0
       F2D5                     _BUF_X:
000335 F2D5 0000                    DW  0
       F2D7                     _BUF_Y:
000337 F2D7 00                      DB  0
       F2D8                     _BUF_P:
000338 F2D8 00                      DB  0
       F2D9                     _BUF_O:
000339 F2D9 00                      DB  0
       F2DA                     DTAX:
00033A F2DA 0000                    DW  0
       F2DC                     B_DRIVE:
00033C F2DC 00                      DB  0
       F2DD                     _DVSW:          ;カレントドライブ
00033D F2DD 00                      DB  0
       F2DE                     _CD:            ;カレントディレクトリ
00033E F2DE 0000                    DW  0
       F2E0                     DIRENT1:
000340 F2E0 0000                    DW  0
       F2E2                     _DIR_BANK:
000342 F2E2 00                      DB  0
       F2E3                     LEFTX:
000343 F2E3 0000                    DW  0
       F2E5                     PARAM0:
000345 F2E5 0000                    DW  0
       F2E7                     PARAM1:
000347 F2E7 0000                    DW  0
       F2E9                     _CDX:
000349 F2E9 0000                    DW  0
       F2EB                     FDRV:
00034B F2EB 00                      DB  0
       F2EC                     FNAME:
00034C F2EC                         DS  8+3
       F2F7                     _HL:
000357 F2F7 0000                    DW  0
       F2F9                     _SP:
000359 F2F9 0000                    DW  0
       F2FA                     _SP_H   EQU $-1
       F2FB                     ISC_E:
00035B 435B                         ORG $$+RUN          ;$DEPHASE
                                
       435B                     MSX1:
00035B 435B CD1552          17      CALL    MSGA1
       435E                     MSX:
00035E 435E 7E               7      LD  A,(HL)
00035F 435F 23               6      INC HL
000360 4360 B7               4      OR  A
000361 4361 20F8            12      JR  NZ,MSX1
000363 4363 C9              10      RET
                                
       4364                     PRTHX:
000364 4364 F5              11      PUSH    AF
000365 4365 07               4      RLCA
000366 4366 07               4      RLCA
000367 4367 07               4      RLCA
000368 4368 07               4      RLCA
000369 4369 CD6D43          17      CALL    PRTA2
00036C 436C F1              10      POP AF
       436D                     PRTA2:
00036D 436D CD7343          17      CALL    ASC
000370 4370 C31152          10      JP  MSG_A
                                    
       4373                     ASC:
000373 4373 E60F             7      AND $0F
000375 4375 F630             7      OR  $30
000377 4377 FE3A             7      CP  $3A
000379 4379 D8              11      RET C
00037A 437A C607             7      ADD A,7
00037C 437C C9              10      RET
                                
       437D                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
00037D 437D 7E               7      LD  A,(HL)
                                #endif
00037E 437E 23               6      INC HL
00037F 437F CD1152          17      CALL    MSG_A
000382 4382 10F9            13      DJNZ    MSN
000384 4384 C9              10      RET
                                
       4385                     RDSLT_ROM3:
000385 4385 7E               7      LD  A,(HL)
000386 4386 C9              10      RET
       4387                     RDSLT_ROM:
000387 4387 CB7C             8      BIT 7,H
000389 4389 28FA            12      JR  Z,RDSLT_ROM3
       438B                     RDSLT_ROM2:
00038B 438B 3A97F2          13      LD  A,(ROM_SLT)
       438E                     RDSLTX:
00038E 438E C5              11      PUSH    BC
00038F 438F D5              11      PUSH    DE
000390 4390 CD0C00          17      CALL    _RDSLT
000393 4393 D1              10      POP DE
000394 4394 C1              10      POP BC
000395 4395 C9              10      RET
                                
       4396                     ROM_BOOT:
000396 4396 3E                      DB  03EH
000397 4397 C9              10      RET
000398 4398 32DBFD          13      LD  (H_PINL),A
00039B 439B 3ACAFF          13      LD  A,(EXTBIO)
00039E 439E FEF7             7      CP  0F7H        ;RST 30H
0003A0 43A0 280A            12      JR  Z,EXTBIO_OK
0003A2 43A2 3E                      DB  03EH
0003A3 43A3 C9              10      RET
0003A4 43A4 21CAFF          10      LD  HL,EXTBIO
0003A7 43A7 061D             7      LD  B,29
0003A9 43A9 CD094B          17      CALL    FILL_MEMORY
       43AC                     EXTBIO_OK:
0003AC 43AC 21FF43          10      LD  HL,DELOK
0003AF 43AF CD5E43          17      CALL    MSX
                                
0003B2 43B2 AF               4      XOR A
0003B3 43B3 3240F3          13      LD  (REBOOT),A
0003B6 43B6 2A48FC          16      LD  HL,(BOTTOM)
0003B9 43B9 110040          10      LD  DE,16384
0003BC 43BC 19              11      ADD HL,DE
0003BD 43BD 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003BF 43BF 57               4      LD  D,A
0003C0 43C0 0601             7      LD  B,1
0003C2 43C2 2100C0          10      LD  HL,0C000H
0003C5 43C5 CDD44F          17      CALL    DISKIO
                                
0003C8 43C8 116BF3          10      LD  DE,RAMUSE
0003CB 43CB AF               4      XOR A
0003CC 43CC CD1EC0          17      CALL    0C01EH
0003CF 43CF 116BF3          10      LD  DE,RAMUSE
0003D2 43D2 37               4      SCF
0003D3 43D3 CD1EC0          17      CALL    0C01EH
       43D6                     BOOT1:
0003D6 43D6 C35F51          10      JP  BASENT
                                
       43D9                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003D9 43D9 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       43FE                     NULL:
0003FE 43FE 00                      DB  0
       43FF                     DELOK:
0003FF 43FF 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4403                     ROM_LDIR:
000403 4403 3AC9F2          13      LD  A,(FLG_LDIR)
000406 4406 B7               4      OR  A
000407 4407 2008            12      JR  NZ,ROM_LDIRVM
000409 4409 CB7A             8      BIT 7,D
00040B 440B CA2344          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ1
                                    LD  SP,SP32
                                SPJ1:
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
00040E 440E EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                #endif
000410 4410 C9              10      RET
                                
       4411                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ2
                                    LD  SP,SP32
                                SPJ2:
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000411 4411 C5              11      PUSH    BC
000412 4412 D5              11      PUSH    DE
000413 4413 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000417 4417 DD215C00        14      LD  IX,LDIRVM
00041B 441B CD1C00          17      CALL    _CALSLT
00041E 441E E1              10      POP HL
00041F 441F C1              10      POP BC
000420 4420 09              11      ADD HL,BC
000421 4421 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JR  LDIRE2
                                #else
000422 4422 C9              10      RET
                                #endif
                                
       4423                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ3
                                    LD  SP,SP32
                                SPJ3:
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4423                     ROM_LDIRSLT1:
000423 4423 EB               4      EX  DE,HL
       4424                     RLDIRSLT1:
000424 4424 CB7C             8      BIT 7,H
000426 4426 201F            12      JR  NZ,RLDIRSLT_EXIT
000428 4428 1A               7      LD  A,(DE)
000429 4429 13               6      INC DE
00042A 442A C5              11      PUSH    BC
00042B 442B D5              11      PUSH    DE
00042C 442C E5              11      PUSH    HL
00042D 442D 5F               4      LD  E,A
                                
00042E 442E 0141F3          10      LD  BC,RAMAD0
000431 4431 7C               4      LD  A,H
000432 4432 07               4      RLCA
000433 4433 07               4      RLCA
000434 4434 E603             7      AND 3
000436 4436 81               4      ADD A,C
000437 4437 4F               4      LD  C,A
000438 4438 0A               7      LD  A,(BC)
       4439                     RLDIRSLT2:
000439 4439 CD1400          17      CALL    _WRSLT
00043C 443C 08               4      EX  AF,AF'
00043D 443D E1              10      POP HL
00043E 443E D1              10      POP DE
00043F 443F C1              10      POP BC
000440 4440 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000442 4442 EA2444          10      JP  PE,RLDIRSLT1
000445 4445 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JP  LDIRE2
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    JP  LDIR1
                                #else
000446 4446 C9              10      RET
       4447                     RLDIRSLT_EXIT:
000447 4447 EB               4      EX  DE,HL
000448 4448 EDB0                    LDIR
00044A 444A C9              10      RET
                                #endif
                                
       444B                     END_OF_LINE:
00044B 444B 215EF5          10      LD  HL,BUF
       444E                     EOL1:
00044E 444E 7E               7      LD  A,(HL)
00044F 444F C8              11      RET Z
000450 4450 FE0D             7      CP  00DH
000452 4452 2807            12      JR  Z,EOLE
000454 4454 FE0A             7      CP  00AH
000456 4456 2803            12      JR  Z,EOLE
000458 4458 23               6      INC HL
000459 4459 18F3            12      JR  EOL1
       445B                     EOLE:
00045B 445B 3600            10      LD  (HL),0
00045D 445D 23               6      INC HL
00045E 445E 7E               7      LD  A,(HL)
00045F 445F FE0A             7      CP  00AH
000461 4461 C0              11      RET NZ
000462 4462 23               6      INC HL
000463 4463 C9              10      RET
                                
       4464                     ROM_LOAD_ASCII:
000464 4464 210000          10      LD  HL,0
000467 4467 22CDF2          16      LD  (_BUF_ST),HL    ;読み出し位置
00046A 446A 2A76F6          16      LD  HL,(TXTTAB)
00046D 446D 22CFF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000470 4470 215EF5          10      LD  HL,BUF
000473 4473 22C7F2          16      LD  (_DTA),HL
       4476                     RLOAD_A1:
000476 4476 2ACDF2          16      LD  HL,(_BUF_ST)
000479 4479 22BDF2          16      LD  (RR_LOW),HL
00047C 447C 210201          10      LD  HL,258
00047F 447F CD8949          17      CALL    ROM_READ
000482 4482 7C               4      LD  A,H
000483 4483 B5               4      OR  L
000484 4484 2879            12      JR  Z,RLOAD_AEND
000486 4486 015EF5          10      LD  BC,BUF
000489 4489 09              11      ADD HL,BC
00048A 448A 3600            10      LD  (HL),0
00048C 448C CD4B44          17      CALL    END_OF_LINE
00048F 448F 015EF5          10      LD  BC,BUF
000492 4492 A7               4      AND A
000493 4493 ED42            15      SBC HL,BC
000495 4495 2810            12      JR  Z,RLOAD_A2
000497 4497 4D               4      LD  C,L
000498 4498 44               4      LD  B,H
000499 4499 ED5BCDF2        20      LD  DE,(_BUF_ST)
00049D 449D 19              11      ADD HL,DE
00049E 449E 22CDF2          16      LD  (_BUF_ST),HL
0004A1 44A1 3A5EF5          13      LD  A,(BUF)
0004A4 44A4 B7               4      OR  A
0004A5 44A5 28CF            12      JR  Z,RLOAD_A1
       44A7                     RLOAD_A2:
0004A7 44A7 115EF5          10      LD  DE,BUF
0004AA 44AA CD404B          17      CALL    SPCUTEX
0004AD 44AD 1A               7      LD  A,(DE)
0004AE 44AE B7               4      OR  A
0004AF 44AF 284E            12      JR  Z,RLOAD_AEND
0004B1 44B1 CD524B          17      CALL    GETNUM
0004B4 44B4 7C               4      LD  A,H
0004B5 44B5 B5               4      OR  L
0004B6 44B6 CAD645          10      JP  Z,ERROR_DIRECT_IN_FILE
0004B9 44B9 DD2ACFF2        20      LD  IX,(_BUF_EN)
0004BD 44BD DD7502          19      LD  (IX+2),L
0004C0 44C0 DD7403          19      LD  (IX+3),H
                                
0004C3 44C3 CD394B          17      CALL    SPCUT
0004C6 44C6 EB               4      EX  DE,HL
0004C7 44C7 DDE5            15      PUSH    IX
0004C9 44C9 DD21B242        14      LD  IX,CRUNCH
0004CD 44CD FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004D1 44D1 CD1C00          17      CALL    _CALSLT
0004D4 44D4 DDE1            14      POP IX
0004D6 44D6 EB               4      EX  DE,HL
0004D7 44D7 111FF4          10      LD  DE,KBUF
0004DA 44DA 37               4      SCF
0004DB 44DB ED52            15      SBC HL,DE
0004DD 44DD CAD645          10      JP  Z,ERROR_DIRECT_IN_FILE
0004E0 44E0 DAD645          10      JP  C,ERROR_DIRECT_IN_FILE
0004E3 44E3 4D               4      LD  C,L
0004E4 44E4 44               4      LD  B,H
0004E5 44E5 2ACFF2          16      LD  HL,(_BUF_EN)
0004E8 44E8 110400          10      LD  DE,4
0004EB 44EB 19              11      ADD HL,DE
0004EC 44EC 111FF4          10      LD  DE,KBUF
                                
0004EF 44EF EB               4      EX  DE,HL
0004F0 44F0 EDB0                    LDIR
0004F2 44F2 EB               4      EX  DE,HL
                                
0004F3 44F3 DD7500          19      LD  (IX+0),L
0004F6 44F6 DD7401          19      LD  (IX+1),H
0004F9 44F9 22CFF2          16      LD  (_BUF_EN),HL
0004FC 44FC C37644          10      JP  RLOAD_A1
                                
       44FF                     RLOAD_AEND:
0004FF 44FF 2ACFF2          16      LD  HL,(_BUF_EN)
000502 4502 AF               4      XOR A
000503 4503 77               7      LD  (HL),A
000504 4504 23               6      INC HL
000505 4505 77               7      LD  (HL),A
000506 4506 23               6      INC HL
000507 4507 22CFF2          16      LD  (_BUF_EN),HL
00050A 450A C39945          10      JP  RLOAD_END1
                                
       450D                     ROM_LOAD:
00050D 450D CD3747          17      CALL    INIT_PARAM
000510 4510 7E               7      LD  A,(HL)
000511 4511 FE2C             7      CP  ','
000513 4513 2003            12      JR  NZ,ROM_LOAD0
000515 4515 23               6      INC HL
000516 4516 7E               7      LD  A,(HL)
000517 4517 2B               6      DEC HL
       4518                     ROM_LOAD0:
000518 4518 32BEFC          13      LD  (RUNBNF),A
00051B 451B CD2A4A          17      CALL    FILE_B
00051E 451E 3AECF2          13      LD  A,(FNAME)
000521 4521 FE20             7      CP  020H
000523 4523 CA254A          10      JP  Z,ROM_ORG
                                
000526 4526 CDA94B          17      CALL    ROM_OPEN
000529 4529 DAE245          10      JP  C,ERROR_FILE_NOT_FOUND
       452C                     ROM_LOAD1:
00052C 452C 21CCF2          10      LD  HL,_BUF
00052F 452F 22C7F2          16      LD  (_DTA),HL
000532 4532 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000535 4535 CD8949          17      CALL    ROM_READ
000538 4538 3ACCF2          13      LD  A,(_BUF)
00053B 453B 3C               4      INC A
00053C 453C C26444          10      JP  NZ,ROM_LOAD_ASCII
00053F 453F 2A76F6          16      LD  HL,(TXTTAB)
000542 4542 22C7F2          16      LD  (_DTA),HL
000545 4545 EB               4      EX  DE,HL
000546 4546 2100FF          10      LD  HL,-256
000549 4549 39              11      ADD HL,SP
00054A 454A ED52            15      SBC HL,DE
00054C 454C CD8949          17      CALL    ROM_READ
00054F 454F ED5BC7F2        20      LD  DE,(_DTA)
000553 4553 19              11      ADD HL,DE
000554 4554 E5              11      PUSH    HL
000555 4555 2A76F6          16      LD  HL,(TXTTAB)
       4558                     ROM_LOAD2:          ;リンクポインタをFIX
000558 4558 E5              11      PUSH    HL
000559 4559 DDE1            14      POP IX
00055B 455B 7E               7      LD  A,(HL)      ;リンクポインタL
00055C 455C 23               6      INC HL
00055D 455D B6               7      OR  (HL)        ;リンクポインタH
00055E 455E 23               6      INC HL
00055F 455F 2837            12      JR  Z,RLOAD_END0
000561 4561 23               6      INC HL      ;行番号
000562 4562 23               6      INC HL      ;行番号
       4563                     ROM_LOAD3:
000563 4563 7E               7      LD  A,(HL)
000564 4564 23               6      INC HL
000565 4565 FE0B             7      CP  00BH        ;8進数(&O)
000567 4567 2822            12      JR  Z,INC_HL2
000569 4569 FE0C             7      CP  00CH        ;16進数(&H)
00056B 456B 281E            12      JR  Z,INC_HL2
00056D 456D FE0D             7      CP  00DH        ;行番号(RUN後)
00056F 456F 281A            12      JR  Z,INC_HL2
000571 4571 FE0E             7      CP  00EH        ;行番号(RUN前)
000573 4573 2816            12      JR  Z,INC_HL2
000575 4575 FE0F             7      CP  00FH        ;10～255の整数(%)
000577 4577 2813            12      JR  Z,INC_HL1
000579 4579 FE1C             7      CP  01CH        ;256～65535の整数(%)
00057B 457B 280E            12      JR  Z,INC_HL2
00057D 457D FE1D             7      CP  01DH        ;単精度実数(!)
00057F 457F 2808            12      JR  Z,INC_HL4
000581 4581 FE1F             7      CP  01FH        ;倍制度実数(#)
000583 4583 2008            12      JR  NZ,INC_HL0
000585 4585 23               6      INC HL
000586 4586 23               6      INC HL
000587 4587 23               6      INC HL
000588 4588 23               6      INC HL
       4589                     INC_HL4:
000589 4589 23               6      INC HL
00058A 458A 23               6      INC HL
       458B                     INC_HL2:
00058B 458B 23               6      INC HL
       458C                     INC_HL1:
00058C 458C 23               6      INC HL
       458D                     INC_HL0:
00058D 458D B7               4      OR  A
00058E 458E 20D3            12      JR  NZ,ROM_LOAD3
000590 4590 DD7500          19      LD  (IX+0),L
000593 4593 DD7401          19      LD  (IX+1),H
000596 4596 18C0            12      JR  ROM_LOAD2
       4598                     RLOAD_END0:
000598 4598 E1              10      POP HL
       4599                     RLOAD_END1:
000599 4599 22C2F6          16      LD  (VARTAB),HL
00059C 459C 22C4F6          16      LD  (ARYTAB),HL
00059F 459F 22C6F6          16      LD  (STREND),HL
                                
0005A2 45A2 3ABEFC          13      LD  A,(RUNBNF)
0005A5 45A5 CD934B          17      CALL    CAP
0005A8 45A8 FE52             7      CP  'R'
0005AA 45AA 280E            12      JR  Z,RLOAD_END2
0005AC 45AC AF               4      XOR A
0005AD 45AD 21CFF2          10      LD  HL,_BUF+3
0005B0 45B0 77               7      LD  (HL),A      ;3
0005B1 45B1 2B               6      DEC HL
0005B2 45B2 77               7      LD  (HL),A      ;2
0005B3 45B3 2B               6      DEC HL
0005B4 45B4 77               7      LD  (HL),A      ;1
0005B5 45B5 2B               6      DEC HL
0005B6 45B6 3E8F             7      LD  A,08FH      ;REM
0005B8 45B8 77               7      LD  (HL),A      ;0
0005B9 45B9 C9              10      RET
       45BA                     RLOAD_END2:
0005BA 45BA D5              11      PUSH    DE
0005BB 45BB ED5B76F6        20      LD  DE,(TXTTAB)
0005BF 45BF 1B               6      DEC DE
0005C0 45C0 AF               4      XOR A
0005C1 45C1 21D2F2          10      LD  HL,_BUF+6
0005C4 45C4 77               7      LD  (HL),A      ;6
0005C5 45C5 2B               6      DEC HL
0005C6 45C6 77               7      LD  (HL),A      ;5
0005C7 45C7 2B               6      DEC HL
0005C8 45C8 77               7      LD  (HL),A      ;4
0005C9 45C9 2B               6      DEC HL
0005CA 45CA 72               7      LD  (HL),D      ;3 行番号H
0005CB 45CB 2B               6      DEC HL
0005CC 45CC 73               7      LD  (HL),E      ;2 行番号L
0005CD 45CD 2B               6      DEC HL
0005CE 45CE 360D            10      LD  (HL),00DH   ;1 行番号(RUN後)
0005D0 45D0 2B               6      DEC HL
0005D1 45D1 3E89             7      LD  A,089H      ;GOTO
0005D3 45D3 77               7      LD  (HL),A      ;0
0005D4 45D4 D1              10      POP DE
0005D5 45D5 C9              10      RET
                                
       45D6                     ERROR_DIRECT_IN_FILE:
0005D6 45D6 1E39             7      LD  E,57            ;Direct statement in file
0005D8 45D8 01                      DB  1           ;LD BC,
       45D9                     ERROR_DEVICE_IO_ERROR:
0005D9 45D9 1E13             7      LD  E,19            ;Device I/O error
0005DB 45DB 01                      DB  1           ;LD BC,
       45DC                     ERROR_INTERNAL_ERROR:
0005DC 45DC 1E33             7      LD  E,51            ;Internal error
0005DE 45DE 01                      DB  1           ;LD BC,
       45DF                     ERROR_FILE_NOT_OPEN:
0005DF 45DF 1E3B             7      LD  E,59            ;File not OPEN
0005E1 45E1 01                      DB  1           ;LD BC,
       45E2                     ERROR_FILE_NOT_FOUND:
0005E2 45E2 1E35             7      LD  E,53            ;File not found
       45E4                     ERROR:
0005E4 45E4 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005E8 45E8 DD216F40        14      LD  IX,ERRHAND
0005EC 45EC C31C00          10      JP  _CALSLT
                                
       45EF                     ROM_BLOAD:
0005EF 45EF CD3747          17      CALL    INIT_PARAM
0005F2 45F2 CD2A4A          17      CALL    FILE_B
0005F5 45F5 CDA94B          17      CALL    ROM_OPEN
0005F8 45F8 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005FA 45FA 21CCF2          10      LD  HL,_BUF
0005FD 45FD 22C7F2          16      LD  (_DTA),HL
000600 4600 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000603 4603 CD8949          17      CALL    ROM_READ
000606 4606 3ACCF2          13      LD  A,(_BUF)
000609 4609 FEFE             7      CP  0FEH
00060B 460B 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00060D 460D 21A5F2          10      LD  HL,BLOAD_RET
000610 4610 229DF2          16      LD  (SWC_BLOAD),HL
                                
000613 4613 2AE7F2          16      LD  HL,(PARAM1)
000616 4616 7E               7      LD  A,(HL)
000617 4617 FE2C             7      CP  ','
000619 4619 2048            12      JR  NZ,RBREAD_MEM
00061B 461B 23               6      INC HL
00061C 461C 7E               7      LD  A,(HL)
00061D 461D CD934B          17      CALL    CAP
000620 4620 32BEFC          13      LD  (RUNBNF),A
       4623                     RBOS1:
000623 4623 7E               7      LD  A,(HL)
000624 4624 23               6      INC HL
000625 4625 B7               4      OR  A
000626 4626 282F            12      JR  Z,RBREAD_OSE
000628 4628 FE3A             7      CP  ':'
00062A 462A 282B            12      JR  Z,RBREAD_OSE
00062C 462C FE2C             7      CP  ','     ;次のパラメータを探す
00062E 462E 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000630 4630 22E7F2          16      LD  (PARAM1),HL
000633 4633 7E               7      LD  A,(HL)
000634 4634 B7               4      OR  A
000635 4635 2820            12      JR  Z,RBREAD_OSE
000637 4637 DD21644C        14      LD  IX,FRMEVL
00063B 463B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00063F 463F CD1C00          17      CALL    _CALSLT
000642 4642 22E7F2          16      LD  (PARAM1),HL
000645 4645 3A63F6          13      LD  A,(VALTYP)
000648 4648 FE02             7      CP  2
00064A 464A 200B            12      JR  NZ,RBREAD_OSE
00064C 464C 2ACDF2          16      LD  HL,(_BUF_ST)
00064F 464F ED5BF8F7        20      LD  DE,(DACDAT)
000653 4653 19              11      ADD HL,DE
000654 4654 22CDF2          16      LD  (_BUF_ST),HL
       4657                     RBREAD_OSE:
000657 4657 3ABEFC          13      LD  A,(RUNBNF)
00065A 465A FE53             7      CP  'S'
00065C 465C 2005            12      JR  NZ,RBREAD_MEM
00065E 465E 3E01             7      LD  A,1
000660 4660 32C9F2          13      LD  (FLG_LDIR),A
       4663                     RBREAD_MEM:
000663 4663 2ACDF2          16      LD  HL,(_BUF_ST)
000666 4666 22BFFC          16      LD  (SAVENT),HL
000669 4669 22C7F2          16      LD  (_DTA),HL
00066C 466C 21FFFF          10      LD  HL,0FFFFH
00066F 466F CD8949          17      CALL    ROM_READ
000672 4672 AF               4      XOR A
000673 4673 32C9F2          13      LD  (FLG_LDIR),A
000676 4676 3ABEFC          13      LD  A,(RUNBNF)
000679 4679 FE52             7      CP  'R'
00067B 467B 2006            12      JR  NZ,RBREAD1
00067D 467D 2AD1F2          16      LD  HL,(_BUF_EX)
000680 4680 229DF2          16      LD  (SWC_BLOAD),HL
       4683                     RBREAD1:
       4683                     ROM_NEXT:
000683 4683 2AE7F2          16      LD  HL,(PARAM1)
000686 4686 7E               7      LD  A,(HL)
000687 4687 2B               6      DEC HL
000688 4688 B7               4      OR  A
000689 4689 2805            12      JR  Z,RN1
00068B 468B FE3A             7      CP  ':'
00068D 468D 2801            12      JR  Z,RN1
00068F 468F 23               6      INC HL
       4690                     RN1:
000690 4690 5D               4      LD  E,L
000691 4691 54               4      LD  D,H
                                
000692 4692 CD694B          17      CALL    SEARCH_END
000695 4695 B7               4      OR  A
000696 4696 2821            12      JR  Z,REM
       4698                     RN3:                    ;マルチステートメントの処理
000698 4698 7E               7      LD  A,(HL)
                                
000699 4699 FEB5             7      CP  0B5H            ;LOAD
00069B 469B CA0D45          10      JP  Z,ROM_LOAD
00069E 469E FE8A             7      CP  08AH            ;RUN
0006A0 46A0 281B            12      JR  Z,ROM_RUN
0006A2 46A2 FEB7             7      CP  0B7H            ;FILES
0006A4 46A4 2825            12      JR  Z,ROM_FILES
0006A6 46A6 FED6             7      CP  0D6H            ;COPY
0006A8 46A8 CA6947          10      JP  Z,ROM_COPY
0006AB 46AB FE20             7      CP  020H
0006AD 46AD 2807            12      JR  Z,RN_SP
                                
0006AF 46AF 3E28             7      LD  A,028H          ;JR Z,
0006B1 46B1 32A3F2          13      LD  (SWC_BLOAD_M),A
0006B4 46B4 7E               7      LD  A,(HL)
0006B5 46B5 C9              10      RET
       46B6                     RN_SP:
0006B6 46B6 23               6      INC HL
0006B7 46B7 18DF            12      JR  RN3
                                
       46B9                     REM:
0006B9 46B9 EB               4      EX  DE,HL
0006BA 46BA 3E8F             7      LD  A,08FH          ;REM
0006BC 46BC C9              10      RET
                                
       46BD                     ROM_RUN:
0006BD 46BD 23               6      INC HL
0006BE 46BE 7E               7      LD  A,(HL)
0006BF 46BF 2B               6      DEC HL
0006C0 46C0 B7               4      OR  A
0006C1 46C1 C40D45          17      CALL    NZ,ROM_LOAD
0006C4 46C4 FE8F             7      CP  08FH            ;REM
0006C6 46C6 3E8A             7      LD  A,08AH          ;RUN
0006C8 46C8 C0              11      RET NZ
0006C9 46C9 77               7      LD  (HL),A
0006CA 46CA C9              10      RET
                                
       46CB                     ROM_FILES:
0006CB 46CB CD3747          17      CALL    INIT_PARAM
0006CE 46CE CD2A4A          17      CALL    FILE_B
0006D1 46D1 CD9C51          17      CALL    GET_DISK_BANK_FDRV
0006D4 46D4 3ABCF2          13      LD  A,(SECSZ_H)
0006D7 46D7 CD5A50          17      CALL    IS_BPB1
0006DA 46DA DAD945          10      JP  C,ERROR_DEVICE_IO_ERROR
0006DD 46DD 3AECF2          13      LD  A,(FNAME)
0006E0 46E0 FE21             7      CP  021H
0006E2 46E2 3005            12      JR  NC,RFILES0
0006E4 46E4 060B             7      LD  B,11
0006E6 46E6 CDFD4A          17      CALL    FILE10
       46E9                     RFILES0:
0006E9 46E9 CD074E          17      CALL    GET_DIR_DAT
       46EC                     RFILES1:
0006EC 46EC CDC54B          17      CALL    FILESE
0006EF 46EF 3041            12      JR  NC,RFILES_NOT_MATCH
       46F1                     RFILES_DISP:
0006F1 46F1 E5              11      PUSH    HL
0006F2 46F2 110B00          10      LD  DE,0000BH   ;属性
0006F5 46F5 19              11      ADD HL,DE
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
0006F6 46F6 7E               7      LD  A,(HL)
                                #endif
0006F7 46F7 E1              10      POP HL
0006F8 46F8 CB4F             8      BIT 1,A     ;不可視属性
0006FA 46FA 2033            12      JR  NZ,RFILES_NEXT
0006FC 46FC E5              11      PUSH    HL
0006FD 46FD 0608             7      LD  B,8
0006FF 46FF CD7D43          17      CALL    MSN
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000702 4702 7E               7      LD  A,(HL)
                                #endif
000703 4703 FE20             7      CP  020H
000705 4705 F5              11      PUSH    AF
000706 4706 3E2E             7      LD  A,'.'
000708 4708 C41152          17      CALL    NZ,MSG_A
00070B 470B 0603             7      LD  B,3
00070D 470D CD7D43          17      CALL    MSN
000710 4710 F1              10      POP AF
000711 4711 CC1152          17      CALL    Z,MSG_A
000714 4714 3ADDF3          13      LD  A,(CSRX)
000717 4717 47               4      LD  B,A
000718 4718 3AB0F3          13      LD  A,(LINLEN)
00071B 471B 90               4      SUB B
00071C 471C FE0C             7      CP  12
00071E 471E 3009            12      JR  NC,RFILES2
000720 4720 3E0D             7      LD  A,00DH      ;改行
000722 4722 CD1152          17      CALL    MSG_A
000725 4725 3E0A             7      LD  A,00AH
000727 4727 1802            12      JR  RFILES3
       4729                     RFILES2:
000729 4729 3E20             7      LD  A,020H
       472B                     RFILES3:
00072B 472B CD1152          17      CALL    MSG_A
00072E 472E E1              10      POP HL
       472F                     RFILES_NEXT:
00072F 472F CDE14B          17      CALL    FNEXT
       4732                     RFILES_NOT_MATCH:
000732 4732 20B8            12      JR  NZ,RFILES1
000734 4734 C38346          10      JP  ROM_NEXT
                                
       4737                     INIT_PARAM:
000737 4737 22E5F2          16      LD  (PARAM0),HL
00073A 473A 22E7F2          16      LD  (PARAM1),HL
00073D 473D EB               4      EX  DE,HL
00073E 473E 32BEFC          13      LD  (RUNBNF),A
000741 4741 3263F6          13      LD  (VALTYP),A
000744 4744 E5              11      PUSH    HL
000745 4745 2ADEF2          16      LD  HL,(_CD)
000748 4748 22E9F2          16      LD  (_CDX),HL
00074B 474B E1              10      POP HL
00074C 474C 13               6      INC DE
00074D 474D CD394B          17      CALL    SPCUT
000750 4750 1A               7      LD  A,(DE)
000751 4751 B7               4      OR  A
000752 4752 C8              11      RET Z
000753 4753 FE3A             7      CP  ':'
000755 4755 C8              11      RET Z
000756 4756 FE28             7      CP  '('
000758 4758 C8              11      RET Z
000759 4759 EB               4      EX  DE,HL
00075A 475A DD21644C        14      LD  IX,FRMEVL
00075E 475E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000762 4762 CD1C00          17      CALL    _CALSLT
000765 4765 22E7F2          16      LD  (PARAM1),HL
000768 4768 C9              10      RET
                                
       4769                     ROM_COPY:
000769 4769 CD3747          17      CALL    INIT_PARAM
00076C 476C 3A63F6          13      LD  A,(VALTYP)
00076F 476F FE03             7      CP  3       ;string
000771 4771 C2254A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000774 4774 CD2A4A          17      CALL    FILE_B
000777 4777 CDA94B          17      CALL    ROM_OPEN
00077A 477A DAE245          10      JP  C,ERROR_FILE_NOT_FOUND
                                
00077D 477D 21D1F2          10      LD  HL,_BUF_W
000780 4780 22C7F2          16      LD  (_DTA),HL
000783 4783 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000786 4786 CD8949          17      CALL    ROM_READ
                                
000789 4789 AF               4      XOR A
00078A 478A 32CCF2          13      LD  (_BUF_LO),A     ;PSET
00078D 478D 32D9F2          13      LD  (_BUF_O),A      ;向き
                                
000790 4790 2AE7F2          16      LD  HL,(PARAM1)
       4793                     RCP_PARAM1:
000793 4793 7E               7      LD  A,(HL)
000794 4794 23               6      INC HL
000795 4795 B7               4      OR  A
000796 4796 CA254A          10      JP  Z,ROM_ORG
000799 4799 FE3A             7      CP  ':'
00079B 479B CA254A          10      JP  Z,ROM_ORG
00079E 479E FE2C             7      CP  ','
0007A0 47A0 2012            12      JR  NZ,RCP_PARAM1_
                                
0007A2 47A2 DD212F54        14      LD  IX,FRMQNT
0007A6 47A6 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007AA 47AA CD1C00          17      CALL    _CALSLT
0007AD 47AD 7B               4      LD  A,E
0007AE 47AE 87               4      ADD A,A
0007AF 47AF 87               4      ADD A,A
0007B0 47B0 32D9F2          13      LD  (_BUF_O),A
0007B3 47B3 7E               7      LD  A,(HL)
       47B4                     RCP_PARAM1_:
0007B4 47B4 FE28             7      CP  '('
0007B6 47B6 20DB            12      JR  NZ,RCP_PARAM1
                                
0007B8 47B8 DD212F54        14      LD  IX,FRMQNT
0007BC 47BC FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007C0 47C0 CD1C00          17      CALL    _CALSLT
                                
0007C3 47C3 ED53D5F2        20      LD  (_BUF_X),DE
                                
       47C7                     RCP_PARAM2:
0007C7 47C7 23               6      INC HL
0007C8 47C8 7E               7      LD  A,(HL)
0007C9 47C9 FE20             7      CP  020H
0007CB 47CB 28FA            12      JR  Z,RCP_PARAM2
0007CD 47CD FE2C             7      CP  ','
0007CF 47CF 28F6            12      JR  Z,RCP_PARAM2
                                
0007D1 47D1 DD212F54        14      LD  IX,FRMQNT
0007D5 47D5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007D9 47D9 CD1C00          17      CALL    _CALSLT
                                
0007DC 47DC 3AF6FA          13      LD  A,(ACPAGE)
0007DF 47DF 57               4      LD  D,A
0007E0 47E0 ED53D7F2        20      LD  (_BUF_Y),DE
       47E4                     RCP_PARAM3:
0007E4 47E4 23               6      INC HL
0007E5 47E5 7E               7      LD  A,(HL)
0007E6 47E6 FE20             7      CP  020H
0007E8 47E8 28FA            12      JR  Z,RCP_PARAM3
0007EA 47EA FE29             7      CP  ')'
0007EC 47EC 28F6            12      JR  Z,RCP_PARAM3
0007EE 47EE FE2C             7      CP  ','
0007F0 47F0 2033            12      JR  NZ,RCP_ST
                                
0007F2 47F2 23               6      INC HL
0007F3 47F3 DD212F54        14      LD  IX,FRMQNT
0007F7 47F7 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007FB 47FB CD1C00          17      CALL    _CALSLT
                                
0007FE 47FE 7B               4      LD  A,E
0007FF 47FF 32D8F2          13      LD  (_BUF_P),A
                                
       4802                     RCP_PARAM4:
000802 4802 7E               7      LD  A,(HL)
000803 4803 23               6      INC HL
000804 4804 FE20             7      CP  020H
000806 4806 28FA            12      JR  Z,RCP_PARAM4
                                
000808 4808 FE2C             7      CP  ','
00080A 480A 2019            12      JR  NZ,RCP_ST
                                
00080C 480C 7E               7      LD  A,(HL)
00080D 480D 0604             7      LD  B,4
00080F 480F FEC3             7      CP  0C3H        ;PRESET
000811 4811 280E            12      JR  Z,RCP_LO
000813 4813 05               4      DEC B       ;3
000814 4814 D6F8             7      SUB 0F8H        ;XOR
000816 4816 2809            12      JR  Z,RCP_LO
000818 4818 05               4      DEC B       ;2
000819 4819 3C               4      INC A       ;OR
00081A 481A 2805            12      JR  Z,RCP_LO
00081C 481C 05               4      DEC B       ;1
00081D 481D 3C               4      INC A       ;AND
00081E 481E 2801            12      JR  Z,RCP_LO
000820 4820 05               4      DEC B       ;0
                                                ;PSET
       4821                     RCP_LO:
000821 4821 78               4      LD  A,B
000822 4822 32CCF2          13      LD  (_BUF_LO),A
       4825                     RCP_ST:
000825 4825 2AC6F6          16      LD  HL,(STREND)
000828 4828 22C7F2          16      LD  (_DTA),HL
00082B 482B EB               4      EX  DE,HL
00082C 482C 2100FE          10      LD  HL,-512
00082F 482F 39              11      ADD HL,SP
000830 4830 AF               4      XOR A
000831 4831 ED52            15      SBC HL,DE
000833 4833 3008            12      JR  NC,RCP0
000835 4835 215EF5          10      LD  HL,BUF
000838 4838 22C7F2          16      LD  (_DTA),HL
00083B 483B 6F               4      LD  L,A ;0
00083C 483C 67               4      LD  H,A ;0
       483D                     RCP0:
00083D 483D 24               4      INC H
00083E 483E 22CFF2          16      LD  (_BUF_EN),HL
       4841                     RCP1:
000841 4841 F3               4      DI
000842 4842 CD1749          17      CALL    WAIT_VDP
                                
000845 4845 3A0700          13      LD  A,(WRVDP)
000848 4848 4F               4      LD  C,A
000849 4849 0C               4      INC C       ;C := PORT#1's address(WR)
00084A 484A 3E24             7      LD  A,36
00084C 484C ED79            12      OUT (C),A
00084E 484E 3E91             7      LD  A,080H+17
000850 4850 ED79            12      OUT (C),A       ;R#17 := 36
                                
000852 4852 0C               4      INC C
000853 4853 0C               4      INC C       ;C := PORT#3's address(WR)
000854 4854 2AD5F2          16      LD  HL,(_BUF_X)
000857 4857 ED69            12      OUT (C),L       ;R#36 DX
000859 4859 ED61            12      OUT (C),H       ;R#37
00085B 485B 2AD7F2          16      LD  HL,(_BUF_Y)
00085E 485E ED69            12      OUT (C),L       ;R#38 DY
000860 4860 ED61            12      OUT (C),H       ;R#39
000862 4862 2AD1F2          16      LD  HL,(_BUF_W)
000865 4865 ED69            12      OUT (C),L       ;R#40 NX
000867 4867 ED61            12      OUT (C),H       ;R#41
000869 4869 2AD3F2          16      LD  HL,(_BUF_H)
00086C 486C ED69            12      OUT (C),L       ;R#42 NY
00086E 486E ED61            12      OUT (C),H       ;R#43
                                
000870 4870 DD2AAFFC        20      LD  IX,(SCRMOD)
000874 4874 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000877 4877 B7               4      OR  A
000878 4878 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
00087A 487A DD7D             9      LD  A,IXL
00087C 487C FE08             7      CP  8
00087E 487E 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000880 4880 FE06             7      CP  6
000882 4882 2AD5F2          16      LD  HL,(_BUF_X)
000885 4885 3AD1F2          13      LD  A,(_BUF_W)
000888 4888 2005            12      JR  NZ,SCR57
00088A 488A B5               4      OR  L       ;スクリーン6
00088B 488B E603             7      AND 3
00088D 488D 200D            12      JR  NZ,USE_LMMC
       488F                     SCR57:              ;スクリーン5,7
00088F 488F B5               4      OR  L
000890 4890 E601             7      AND 1
000892 4892 2008            12      JR  NZ,USE_LMMC
       4894                     USE_HMMC:
000894 4894 DD2E08          10      LD  IXL,8
       4897                     USE_HMMC8:
000897 4897 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000899 4899 32CCF2          13      LD  (_BUF_LO),A
       489C                     USE_LMMC:
00089C 489C 110000          10      LD  DE,0
00089F 489F 06FF             7      LD  B,-1
0008A1 48A1 CD4249          17      CALL    GET_PIXEL
0008A4 48A4 ED79            12      OUT (C),A       ;R#44 first DATA
0008A6 48A6 3AD9F2          13      LD  A,(_BUF_O)
0008A9 48A9 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
0008AB 48AB 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008AE 48AE F6B0             7      OR  0B0H        ;R#46 LMMC command
0008B0 48B0 ED79            12      OUT (C),A
                                
0008B2 48B2 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008B4 48B4 0D               4      DEC C
0008B5 48B5 0D               4      DEC C       ;C := PORT#1's address(WR)
0008B6 48B6 3EAC             7      LD  A,080H+44
0008B8 48B8 ED79            12      OUT (C),A
0008BA 48BA 3E91             7      LD  A,080H+17
0008BC 48BC ED79            12      OUT (C),A       ;R#17 := 44
                                
0008BE 48BE 3A0600          13      LD  A,(RDVDP)
0008C1 48C1 3C               4      INC A
0008C2 48C2 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
0008C4 48C4 3E02             7      LD  A,2
0008C6 48C6 ED79            12      OUT (C),A
0008C8 48C8 3E8F             7      LD  A,08FH
0008CA 48CA ED79            12      OUT (C),A
0008CC 48CC 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008CF 48CF E640             7      AND 040H
0008D1 48D1 201C            12      JR  NZ,LOOP_HMMC
       48D3                     LOOP_COPY:
0008D3 48D3 CD4249          17      CALL    GET_PIXEL
0008D6 48D6 08               4      EX  AF,AF'
0008D7 48D7 FD4C             9      LD  C,IYH
       48D9                     LOOP_COPY1:
0008D9 48D9 ED78            12      IN  A,(C)
0008DB 48DB 0F               4      RRCA            ;RRCAではサインフラグは変化しない
0008DC 48DC 300A            12      JR  NC,EXIT_COPY    ;check CE bit
0008DE 48DE F2D948          10      JP  P,LOOP_COPY1    ;check TR bit
0008E1 48E1 08               4      EX  AF,AF'
0008E2 48E2 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008E4 48E4 ED79            12      OUT (C),A
0008E6 48E6 18EB            12      JR  LOOP_COPY
                                
       48E8                     EXIT_COPY:
0008E8 48E8 CD1F49          17      CALL    GET_STATUS_0
0008EB 48EB FB               4      EI
0008EC 48EC C38346          10      JP  ROM_NEXT
                                
       48EF                     LOOP_HMMC:
0008EF 48EF F3               4      DI          ;必要
0008F0 48F0 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008F2 48F2 43               4      LD  B,E
0008F3 48F3 7B               4      LD  A,E
0008F4 48F4 B7               4      OR  A
0008F5 48F5 2802            12      JR  Z,LOOP_HMMC1
0008F7 48F7 EDB3                    OTIR
       48F9                     LOOP_HMMC1:
0008F9 48F9 14               4      INC D
       48FA                     LOOP_HMMC2:
0008FA 48FA 15               4      DEC D
0008FB 48FB 2805            12      JR  Z,LOOP_HMMC3
0008FD 48FD EDB3                    OTIR
0008FF 48FF C3FA48          10      JP  LOOP_HMMC2
       4902                     LOOP_HMMC3:
000902 4902 ED78            12      IN  A,(C)
000904 4904 0F               4      RRCA
000905 4905 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
000907 4907 2ACFF2          16      LD  HL,(_BUF_EN)
00090A 490A CD8949          17      CALL    ROM_READ
00090D 490D EB               4      EX  DE,HL
00090E 490E 2AC7F2          16      LD  HL,(_DTA)
000911 4911 7A               4      LD  A,D
000912 4912 B3               4      OR  E
000913 4913 20DA            12      JR  NZ,LOOP_HMMC
000915 4915 18C2            12      JR  LOOP_COPY1
                                    
       4917                     WAIT_VDP:
000917 4917 3E02             7      LD  A,2
000919 4919 CD2049          17      CALL    GET_STATUS
00091C 491C 0F               4      RRCA
00091D 491D 38F8            12      JR  C,WAIT_VDP
       491F                     GET_STATUS_0:
00091F 491F AF               4      XOR A
       4920                     GET_STATUS:
000920 4920 C5              11      PUSH    BC
000921 4921 ED4B0600        20      LD  BC,(RDVDP)
000925 4925 0C               4      INC C
000926 4926 ED79            12      OUT (C),A
000928 4928 3E8F             7      LD  A,08FH
00092A 492A ED79            12      OUT (C),A
00092C 492C ED78            12      IN  A,(C)
00092E 492E C1              10      POP BC
00092F 492F C9              10      RET
                                
       4930                     GET_PIXEL256:
000930 4930 7A               4      LD  A,D
000931 4931 B3               4      OR  E
000932 4932 200A            12      JR  NZ,GET_PIXEL1
000934 4934 2ACFF2          16      LD  HL,(_BUF_EN)
000937 4937 CD8949          17      CALL    ROM_READ
00093A 493A EB               4      EX  DE,HL
00093B 493B 2AC7F2          16      LD  HL,(_DTA)
       493E                     GET_PIXEL1:
00093E 493E 7E               7      LD  A,(HL)
00093F 493F 23               6      INC HL
000940 4940 1B               6      DEC DE
000941 4941 C9              10      RET
                                
       4942                     GET_PIXEL:
000942 4942 DD7D             9      LD  A,IXL
000944 4944 FE08             7      CP  8
000946 4946 28E8            12      JR  Z,GET_PIXEL256
000948 4948 04               4      INC B
000949 4949 FE06             7      CP  6
00094B 494B 282E            12      JR  Z,GET_PIXEL4
                                
00094D 494D CB40             8      BIT 0,B
00094F 494F 20ED            12      JR  NZ,GET_PIXEL1
                                
000951 4951 7A               4      LD  A,D
000952 4952 B3               4      OR  E
000953 4953 200A            12      JR  NZ,GET_PIXEL2
                                
000955 4955 2ACFF2          16      LD  HL,(_BUF_EN)
000958 4958 CD8949          17      CALL    ROM_READ
00095B 495B EB               4      EX  DE,HL
00095C 495C 2AC7F2          16      LD  HL,(_DTA)
                                
       495F                     GET_PIXEL2:
00095F 495F 7E               7      LD  A,(HL)
000960 4960 0F               4      RRCA
000961 4961 0F               4      RRCA
000962 4962 0F               4      RRCA
000963 4963 0F               4      RRCA
000964 4964 C9              10      RET
                                
       4965                     GET_PIXEL3:
000965 4965 7A               4      LD  A,D
000966 4966 B3               4      OR  E
000967 4967 200A            12      JR  NZ,GET_PIXEL5
                                
000969 4969 2ACFF2          16      LD  HL,(_BUF_EN)
00096C 496C CD8949          17      CALL    ROM_READ
00096F 496F EB               4      EX  DE,HL
000970 4970 2AC7F2          16      LD  HL,(_DTA)
       4973                     GET_PIXEL5:
000973 4973 7E               7      LD  A,(HL)
000974 4974 0F               4      RRCA
000975 4975 0F               4      RRCA
000976 4976 0F               4      RRCA
000977 4977 0F               4      RRCA
000978 4978 0F               4      RRCA
000979 4979 0F               4      RRCA
00097A 497A C9              10      RET
                                
       497B                     GET_PIXEL4:
00097B 497B 78               4      LD  A,B
00097C 497C E603             7      AND 3   ;+0
00097E 497E 28E5            12      JR  Z,GET_PIXEL3
000980 4980 3D               4      DEC A   ;+1
000981 4981 28DC            12      JR  Z,GET_PIXEL2
000983 4983 3D               4      DEC A   ;+2
000984 4984 7E               7      LD  A,(HL)
000985 4985 C0              11      RET NZ
000986 4986 0F               4      RRCA        ;+3
000987 4987 0F               4      RRCA
000988 4988 C9              10      RET
                                
       4989                     ROM_READ:
000989 4989 E5              11      PUSH    HL
00098A 498A D5              11      PUSH    DE
00098B 498B C5              11      PUSH    BC
00098C 498C FDE5            15      PUSH    IY
00098E 498E 22E3F2          16      LD  (LEFTX),HL
000991 4991 2AC7F2          16      LD  HL,(_DTA)
000994 4994 22DAF2          16      LD  (DTAX),HL
000997 4997 2AE3F2          16      LD  HL,(LEFTX)
                                
00099A 499A CD3B4C          17      CALL    RBX1
00099D 499D 3870            12      JR  C,RBRERR1
00099F 499F 79               4      LD  A,C
0009A0 49A0 EB               4      EX  DE,HL
0009A1 49A1 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0009A3 49A3 19              11      ADD HL,DE
0009A4 49A4 DE00             7      SBC A,000H
0009A6 49A6 3801            12      JR  C,RBR1
0009A8 49A8 EB               4      EX  DE,HL
       49A9                     RBR1:
0009A9 49A9 9F               4      SBC A,A
0009AA 49AA E601             7      AND 1
0009AC 49AC 32B6F2          13      LD  (_RESULT),A
0009AF 49AF 7C               4      LD  A,H
0009B0 49B0 B5               4      OR  L
0009B1 49B1 CA054A          10      JP  Z,RBREND0
                                
0009B4 49B4 22C3F2          16      LD  (_LEFT),HL  ;Read record byte
0009B7 49B7 22E3F2          16      LD  (LEFTX),HL
                                
0009BA 49BA CD674C          17      CALL    RBX2
0009BD 49BD 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009BF 49BF CD7A4C          17      CALL    RBXA
0009C2 49C2 DA1B4A          10      JP  C,RBRERR
0009C5 49C5 C5              11      PUSH    BC
0009C6 49C6 CD0344          17      CALL    ROM_LDIR
0009C9 49C9 ED53DAF2        20      LD  (DTAX),DE
0009CD 49CD 2AE3F2          16      LD  HL,(LEFTX)
0009D0 49D0 D1              10      POP DE
0009D1 49D1 A7               4      AND A
0009D2 49D2 ED52            15      SBC HL,DE
0009D4 49D4 22E3F2          16      LD  (LEFTX),HL
0009D7 49D7 2829            12      JR  Z,RBREND
                                
       49D9                     RBRB:
0009D9 49D9 CDB64C          17      CALL    RBXB
0009DC 49DC 2818            12      JR  Z,RBRC
       49DE                     RBRB1:
0009DE 49DE C5              11      PUSH    BC
0009DF 49DF D5              11      PUSH    DE
0009E0 49E0 CD614D          17      CALL    CLUST
0009E3 49E3 EB               4      EX  DE,HL
0009E4 49E4 ED4BB9F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
0009E8 49E8 CD0344          17      CALL    ROM_LDIR
0009EB 49EB EB               4      EX  DE,HL
0009EC 49EC D1              10      POP DE
0009ED 49ED C1              10      POP BC
0009EE 49EE CD3E4D          17      CALL    GNCL
0009F1 49F1 DA1B4A          10      JP  C,RBRERR
0009F4 49F4 10E8            13      DJNZ    RBRB1
       49F6                     RBRC:
0009F6 49F6 CDCE4C          17      CALL    RBXC
0009F9 49F9 2807            12      JR  Z,RBREND
                                
0009FB 49FB CD614D          17      CALL    CLUST
0009FE 49FE EB               4      EX  DE,HL
0009FF 49FF CD0344          17      CALL    ROM_LDIR
       4A02                     RBREND:
000A02 4A02 CDDA4C          17      CALL    RBXEND
       4A05                     RBREND0:
000A05 4A05 FDE1            14      POP IY
000A07 4A07 C1              10      POP BC
000A08 4A08 D1              10      POP DE
000A09 4A09 F1              10      POP AF  ;(HL)
000A0A 4A0A AF               4      XOR A
000A0B 4A0B 3AB6F2          13      LD  A,(_RESULT)
000A0E 4A0E C9              10      RET
                                
       4A0F                     RBRERR1:
000A0F 4A0F 3E01             7      LD  A,001H
       4A11                     RBRERR2:
000A11 4A11 FDE1            14      POP IY
000A13 4A13 C1              10      POP BC
000A14 4A14 D1              10      POP DE
000A15 4A15 E1              10      POP HL
000A16 4A16 37               4      SCF
000A17 4A17 210000          10      LD  HL,0
000A1A 4A1A C9              10      RET
       4A1B                     RBRERR:
000A1B 4A1B 3EFF             7      LD  A,0FFH
000A1D 4A1D 18F2            12      JR  RBRERR2
                                
       4A1F                     FILE_DD:
000A1F 4A1F E1              10      POP HL
000A20 4A20 3E                      DB  03EH
000A21 4A21 C9              10      RET
000A22 4A22 32A3F2          13      LD  (SWC_BLOAD_M),A
       4A25                     ROM_ORG:
000A25 4A25 2AE5F2          16      LD  HL,(PARAM0)
000A28 4A28 7E               7      LD  A,(HL)
000A29 4A29 C9              10      RET
       4A2A                     FILE_B:
000A2A 4A2A AF               4      XOR A
000A2B 4A2B 32EBF2          13      LD  (FDRV),A
000A2E 4A2E 1E00             7      LD  E,0
000A30 4A30 3A63F6          13      LD  A,(VALTYP)
000A33 4A33 FE03             7      CP  3       ;string
000A35 4A35 C2BA4A          10      JP  NZ,FILED
                                
000A38 4A38 DD21D067        14      LD  IX,FRESTR
000A3C 4A3C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A40 4A40 CD1C00          17      CALL    _CALSLT
000A43 4A43 E5              11      PUSH    HL
000A44 4A44 DDE1            14      POP IX
                                
000A46 4A46 DD5E00          19      LD  E,(IX+0)
000A49 4A49 DD7E01          19      LD  A,(IX+1)
000A4C 4A4C DD5602          19      LD  D,(IX+2)
000A4F 4A4F DD62             9      LD  IXH,D
000A51 4A51 DD6F             9      LD  IXL,A
000A53 4A53 7B               4      LD  A,E
       4A54                     FILE_BDOS:
000A54 4A54 FE04             7      CP  4
000A56 4A56 3808            12      JR  C,FILEB1
000A58 4A58 DD7E03          19      LD  A,(IX+3)
000A5B 4A5B FE3A             7      CP  ':'
000A5D 4A5D 28C0            12      JR  Z,FILE_DD
000A5F 4A5F 7B               4      LD  A,E
       4A60                     FILEB1:
000A60 4A60 FE02             7      CP  2
000A62 4A62 3818            12      JR  C,DEVI1
000A64 4A64 DD7E01          19      LD  A,(IX+1)
000A67 4A67 FE3A             7      CP  ':'
000A69 4A69 2011            12      JR  NZ,DEVI1
000A6B 4A6B DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A6E 4A6E CD934B          17      CALL    CAP
000A71 4A71 D640             7      SUB '@'
000A73 4A73 DD23            10      INC IX
000A75 4A75 DD23            10      INC IX
000A77 4A77 1D               4      DEC E
000A78 4A78 1D               4      DEC E
000A79 4A79 32EBF2          13      LD  (FDRV),A
       4A7C                     DEVI1:
000A7C 4A7C DD7E00          19      LD  A,(IX+0)
000A7F 4A7F D65C             7      SUB 05CH        ;\
000A81 4A81 2008            12      JR  NZ,NOROOT
000A83 4A83 6F               4      LD  L,A
000A84 4A84 67               4      LD  H,A
000A85 4A85 22E9F2          16      LD  (_CDX),HL
000A88 4A88 DD23            10      INC IX
000A8A 4A8A 1D               4      DEC E
       4A8B                     NOROOT:
                                
       4A8B                     SETDIR:
000A8B 4A8B CDBA4A          17      CALL    FILED
000A8E 4A8E DD7E00          19      LD  A,(IX+0)
000A91 4A91 FE5C             7      CP  05CH        ;\
000A93 4A93 C0              11      RET NZ
000A94 4A94 DD23            10      INC IX
000A96 4A96 1D               4      DEC E
000A97 4A97 3AECF2          13      LD  A,(FNAME)
000A9A 4A9A FE20             7      CP  020H        ;. の処理
000A9C 4A9C 28ED            12      JR  Z,SETDIR
                                
000A9E 4A9E CDA94B          17      CALL    ROM_OPEN
000AA1 4AA1 B7               4      OR  A
000AA2 4AA2 C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0000BH   ;属性(アトリビュート)
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    POP DE
                                    BIT 4,A     ;ディレクトリ
                                #else
000AA3 4AA3 FD2AE0F2        20      LD  IY,(DIRENT1)
000AA7 4AA7 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000AAB 4AAB C8              11      RET Z
000AAC 4AAC CD014B          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    LD  D,A
                                    EX  DE,HL
                                    POP DE
                                #else
000AAF 4AAF FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000AB2 4AB2 FD661B          19      LD  H,(IY+01BH)
                                #endif
000AB5 4AB5 22E9F2          16      LD  (_CDX),HL
000AB8 4AB8 18D1            12      JR  SETDIR
                                
       4ABA                     FILED:
000ABA 4ABA CD014B          17      CALL    FILEI
000ABD 4ABD 21ECF2          10      LD  HL,FNAME
                                
000AC0 4AC0 0608             7      LD  B,8
       4AC2                     FILE2:
000AC2 4AC2 CD0E4B          17      CALL    CCHKF
000AC5 4AC5 C8              11      RET Z
000AC6 4AC6 FE2A             7      CP  '*'
000AC8 4AC8 282E            12      JR  Z,FILE9
000ACA 4ACA FE2E             7      CP  '.'
000ACC 4ACC 280C            12      JR  Z,FILE4
000ACE 4ACE 77               7      LD  (HL),A
000ACF 4ACF 23               6      INC HL
000AD0 4AD0 10F0            13      DJNZ    FILE2
                                
       4AD2                     FILE3:
000AD2 4AD2 CD0E4B          17      CALL    CCHKF
000AD5 4AD5 C8              11      RET Z
000AD6 4AD6 FE2E             7      CP  '.'
000AD8 4AD8 20F8            12      JR  NZ,FILE3
                                
       4ADA                     FILE4:
000ADA 4ADA 21F4F2          10      LD  HL,FNAME+8
000ADD 4ADD 0603             7      LD  B,3
                                
       4ADF                     FILE4L:
000ADF 4ADF CD0E4B          17      CALL    CCHKF
000AE2 4AE2 C8              11      RET Z
000AE3 4AE3 FE2E             7      CP  '.'
000AE5 4AE5 2008            12      JR  NZ,FILE12
000AE7 4AE7 32ECF2          13      LD  (FNAME),A   ;Parent directory(..)
000AEA 4AEA 32EDF2          13      LD  (FNAME+1),A
000AED 4AED 3E20             7      LD  A,020H
       4AEF                     FILE12:
000AEF 4AEF FE2A             7      CP  '*'
000AF1 4AF1 280A            12      JR  Z,FILE10
000AF3 4AF3 77               7      LD  (HL),A
000AF4 4AF4 23               6      INC HL
000AF5 4AF5 10E8            13      DJNZ    FILE4L
000AF7 4AF7 C9              10      RET
                                
       4AF8                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000AF8 4AF8 CDFD4A          17      CALL    FILE10
000AFB 4AFB 18D5            12      JR  FILE3
                                
       4AFD                     FILE10:
000AFD 4AFD 3E3F             7      LD  A,'?'
000AFF 4AFF 1808            12      JR  FILL_MEMORY
       4B01                     FILEI:              ;名前＋拡張子をスペースで初期化
000B01 4B01 3E20             7      LD  A,020H
000B03 4B03 01000B          10      LD  BC,11*256   ;C=0にしておく
000B06 4B06 21ECF2          10      LD  HL,FNAME
       4B09                     FILL_MEMORY:            ;HLからBバイトAで埋める
000B09 4B09 77               7      LD  (HL),A
000B0A 4B0A 23               6      INC HL
000B0B 4B0B 10FC            13      DJNZ    FILL_MEMORY
000B0D 4B0D C9              10      RET
                                
       4B0E                     CCHKF:
000B0E 4B0E 7B               4      LD  A,E
000B0F 4B0F B7               4      OR  A
000B10 4B10 C8              11      RET Z
000B11 4B11 DD7E00          19      LD  A,(IX+0)
000B14 4B14 CD1B4B          17      CALL    CCHK2
000B17 4B17 C8              11      RET Z
000B18 4B18 C37E4B          10      JP  FKAN
                                
       4B1B                     CCHK2:
000B1B 4B1B 0C               4      INC C
000B1C 4B1C 0D               4      DEC C
000B1D 4B1D C0              11      RET NZ
       4B1E                     CCHK3:              ;ZF=1 で使えない文字
000B1E 4B1E FE2B             7      CP  '+'
000B20 4B20 C8              11      RET Z
000B21 4B21 FE2C             7      CP  ','
000B23 4B23 C8              11      RET Z
000B24 4B24 FE2F             7      CP  '/'
000B26 4B26 C8              11      RET Z
000B27 4B27 FE3A             7      CP  ':'
000B29 4B29 C8              11      RET Z
000B2A 4B2A FE3B             7      CP  ';'
000B2C 4B2C C8              11      RET Z
000B2D 4B2D FE3D             7      CP  '='
000B2F 4B2F C8              11      RET Z
000B30 4B30 FE5C             7      CP  05CH    ;\
000B32 4B32 C8              11      RET Z
000B33 4B33 FE1F             7      CP  01FH
000B35 4B35 D0              11      RET NC
000B36 4B36 BF               4      CP  A       ;Z=1
000B37 4B37 C9              10      RET
                                
       4B38                     SS1:
000B38 4B38 13               6      INC DE
       4B39                     SPCUT:              ;スペースをカット
000B39 4B39 1A               7      LD  A,(DE)
000B3A 4B3A FE20             7      CP  020H
000B3C 4B3C 28FA            12      JR  Z,SS1
000B3E 4B3E C9              10      RET
                                
       4B3F                     SCREOF1:
000B3F 4B3F 13               6      INC DE
       4B40                     SPCUTEX:            ;スペース改行などをカット
000B40 4B40 1A               7      LD  A,(DE)
000B41 4B41 FE20             7      CP  020H
000B43 4B43 28FA            12      JR  Z,SCREOF1
000B45 4B45 FE0D             7      CP  00DH
000B47 4B47 28F6            12      JR  Z,SCREOF1
000B49 4B49 FE0A             7      CP  00AH
000B4B 4B4B 28F2            12      JR  Z,SCREOF1
000B4D 4B4D FE1A             7      CP  01AH
000B4F 4B4F 28EE            12      JR  Z,SCREOF1
000B51 4B51 C9              10      RET
                                
       4B52                     GETNUM:
000B52 4B52 210000          10      LD  HL,0
       4B55                     GETNUM1:
000B55 4B55 1A               7      LD  A,(DE)
000B56 4B56 13               6      INC DE
000B57 4B57 D630             7      SUB '0'
000B59 4B59 D8              11      RET C
000B5A 4B5A FE0A             7      CP  10
000B5C 4B5C D0              11      RET NC
000B5D 4B5D 4D               4      LD  C,L
000B5E 4B5E 44               4      LD  B,H
000B5F 4B5F 29              11      ADD HL,HL   ;*2
000B60 4B60 29              11      ADD HL,HL   ;*4
000B61 4B61 09              11      ADD HL,BC   ;*5
000B62 4B62 29              11      ADD HL,HL   ;*10
000B63 4B63 4F               4      LD  C,A
000B64 4B64 0600             7      LD  B,0
000B66 4B66 09              11      ADD HL,BC
000B67 4B67 18EC            12      JR  GETNUM1
                                
       4B69                     SEARCH_END:
000B69 4B69 7E               7      LD  A,(HL)
       4B6A                     SEARCH_END1:
000B6A 4B6A 23               6      INC HL
000B6B 4B6B B7               4      OR  A
000B6C 4B6C C8              11      RET Z
000B6D 4B6D FE3A             7      CP  ':'
000B6F 4B6F 20F8            12      JR  NZ,SEARCH_END
000B71 4B71 7E               7      LD  A,(HL)
000B72 4B72 FE3A             7      CP  ':'
000B74 4B74 28F4            12      JR  Z,SEARCH_END1
000B76 4B76 C9              10      RET
                                
       4B77                     FKANC:
000B77 4B77 CB41             8      BIT 0,C
000B79 4B79 CC9C4B          17      CALL    Z,CAP2
000B7C 4B7C 1803            12      JR  FKANX
       4B7E                     FKAN:           ;漢字チェック
000B7E 4B7E DD23            10      INC IX
000B80 4B80 1D               4      DEC E
       4B81                     FKANX:
000B81 4B81 CB41             8      BIT 0,C
000B83 4B83 CB81             8      RES 0,C
000B85 4B85 C0              11      RET NZ
000B86 4B86 FE80             7      CP  080H
000B88 4B88 D8              11      RET C
000B89 4B89 FEA0             7      CP  0A0H
000B8B 4B8B 3803            12      JR  C,FKAN1
000B8D 4B8D FEE0             7      CP  0E0H
000B8F 4B8F D8              11      RET C
       4B90                     FKAN1:
000B90 4B90 0C               4      INC C
000B91 4B91 A7               4      AND A
000B92 4B92 C9              10      RET
                                
       4B93                     CAP:
000B93 4B93 FE61             7      CP  'a'
000B95 4B95 D8              11      RET C
000B96 4B96 FE7B             7      CP  'z'+1
000B98 4B98 D0              11      RET NC
000B99 4B99 D620             7      SUB 020H
000B9B 4B9B C9              10      RET
       4B9C                     CAP2:
000B9C 4B9C CD934B          17      CALL    CAP
       4B9F                     CAP3:               ;
000B9F 4B9F FE05             7      CP  5
000BA1 4BA1 2803            12      JR  Z,CAP4
000BA3 4BA3 FE21             7      CP  021H
000BA5 4BA5 C9              10      RET
       4BA6                     CAP4:
000BA6 4BA6 3EE5             7      LD  A,0E5H
000BA8 4BA8 C9              10      RET
                                
       4BA9                     ROM_OPEN:
000BA9 4BA9 CD9C51          17      CALL    GET_DISK_BANK_FDRV
                                
000BAC 4BAC CD074E          17      CALL    GET_DIR_DAT
000BAF 4BAF D5              11      PUSH    DE
000BB0 4BB0 CDC54B          17      CALL    FILESE
000BB3 4BB3 D1              10      POP DE
000BB4 4BB4 3F               4      CCF
000BB5 4BB5 D8              11      RET C
000BB6 4BB6 22E0F2          16      LD  (DIRENT1),HL
000BB9 4BB9 E5              11      PUSH    HL
000BBA 4BBA 210000          10      LD  HL,0
000BBD 4BBD 22BDF2          16      LD  (RR_LOW),HL
000BC0 4BC0 22BFF2          16      LD  (RR_HIGH),HL
000BC3 4BC3 E1              10      POP HL
000BC4 4BC4 C9              10      RET
                                
       4BC5                     FILESE:
       4BC5                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000BC5 4BC5 7E               7      LD  A,(HL)
                                #endif
000BC6 4BC6 B7               4      OR  A
000BC7 4BC7 C8              11      RET Z       ;END:ZF=1 CF=0
000BC8 4BC8 FEE5             7      CP  0E5H
000BCA 4BCA 280D            12      JR  Z,FILESE1
000BCC 4BCC 11ECF2          10      LD  DE,FNAME
000BCF 4BCF E5              11      PUSH    HL
000BD0 4BD0 CD164C          17      CALL    CPFILE
000BD3 4BD3 CC374C          17      CALL    Z,CPFILE2
000BD6 4BD6 E1              10      POP HL
000BD7 4BD7 37               4      SCF
000BD8 4BD8 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4BD9                     FILESE1:
000BD9 4BD9 CDE14B          17      CALL    FNEXT
000BDC 4BDC 20E7            12      JR  NZ,FILESE0
000BDE 4BDE F6FF             7      OR  0FFH        ;ZF=0 CF=0
000BE0 4BE0 C9              10      RET
                                
       4BE1                     FNEXT:
000BE1 4BE1 112000          10      LD  DE,020H
000BE4 4BE4 19              11      ADD HL,DE
000BE5 4BE5 ED5BE9F2        20      LD  DE,(_CDX)
000BE9 4BE9 7A               4      LD  A,D
000BEA 4BEA B3               4      OR  E
000BEB 4BEB 2019            12      JR  NZ,FNEXT_SUBDIR
000BED 4BED 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
       4BEE                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000BEE 4BEE F5              11      PUSH    AF      ;※フラグを保存する必要あり
000BEF 4BEF CB7C             8      BIT 7,H
000BF1 4BF1 2811            12      JR  Z,CHECK_DIR_PAGE1
000BF3 4BF3 7C               4      LD  A,H
000BF4 4BF4 D620             7      SUB 020H
000BF6 4BF6 67               4      LD  H,A
000BF7 4BF7 3AE2F2          13      LD  A,(_DIR_BANK)
000BFA 4BFA 3C               4      INC A
000BFB 4BFB 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BFE 4BFE 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000C01 4C01 32E2F2          13      LD  (_DIR_BANK),A
       4C04                     CHECK_DIR_PAGE1:
000C04 4C04 F1              10      POP AF
                                #endif
000C05 4C05 C9              10      RET
                                
       4C06                     FNEXT_SUBDIR:           ;サブディレクトリ
000C06 4C06 0D               4      DEC C
000C07 4C07 C0              11      RET NZ
                                
000C08 4C08 ED5BE9F2        20      LD  DE,(_CDX)
000C0C 4C0C CD3E4D          17      CALL    GNCL
000C0F 4C0F EB               4      EX  DE,HL
000C10 4C10 22E9F2          16      LD  (_CDX),HL
000C13 4C13 C3434E          10      JP  GET_SUBDIR
                                
       4C16                     CPFILE:
000C16 4C16 C5              11      PUSH    BC
000C17 4C17 01000B          10      LD  BC,00B00H
       4C1A                     CPSTR1:
000C1A 4C1A 1A               7      LD  A,(DE)
000C1B 4C1B FE3F             7      CP  '?'     ;Wild card
000C1D 4C1D 2812            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000C1F 4C1F 7E               7      LD  A,(HL)
                                #endif
000C20 4C20 CD774B          17      CALL    FKANC
000C23 4C23 E5              11      PUSH    HL
000C24 4C24 67               4      LD  H,A
000C25 4C25 1A               7      LD  A,(DE)
000C26 4C26 CB01             4      RLC C
000C28 4C28 CD774B          17      CALL    FKANC
000C2B 4C2B CB09             4      RRC C
000C2D 4C2D BC               4      CP  H       ;CP (HL),(DE)
000C2E 4C2E E1              10      POP HL
000C2F 4C2F 2004            12      JR  NZ,CPSTR3
       4C31                     CPSTR2:
000C31 4C31 13               6      INC DE
000C32 4C32 23               6      INC HL
000C33 4C33 10E5            13      DJNZ    CPSTR1
       4C35                     CPSTR3:
000C35 4C35 C1              10      POP BC
000C36 4C36 C9              10      RET
                                
       4C37                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000C37 4C37 7E               7      LD  A,(HL)
                                #endif
000C38 4C38 E608             7      AND 008H    ;~0F7H
000C3A 4C3A C9              10      RET
                                
       4C3B                     RBX1:
000C3B 4C3B E5              11      PUSH    HL      ;Record byte
                                
000C3C 4C3C ED5BBDF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000C40 4C40 3AC0F2          13      LD  A,(RR_HIGH+1)
000C43 4C43 4F               4      LD  C,A
                                
000C44 4C44 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001CH
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  D,A
                                    CALL    RDSLT_ROM
                                    EX  DE,HL       ;AHL=File size
                                    POP DE
                                #else
000C47 4C47 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C4A 4C4A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000C4D 4C4D FD2AE0F2        20      LD  IY,(DIRENT1)
000C51 4C51 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000C54 4C54 FD661D          19      LD  H,(IY+01DH)
000C57 4C57 FD7E1E          19      LD  A,(IY+01EH)
                                #endif
                                
000C5A 4C5A A7               4      AND A
000C5B 4C5B ED52            15      SBC HL,DE
000C5D 4C5D 99               4      SBC A,C
000C5E 4C5E D1              10      POP DE
                                
000C5F 4C5F D8              11      RET C
000C60 4C60 4F               4      LD  C,A
000C61 4C61 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000C62 4C62 B2               4      OR  D
000C63 4C63 B3               4      OR  E
000C64 4C64 C0              11      RET NZ
000C65 4C65 37               4      SCF
000C66 4C66 C9              10      RET
                                
       4C67                     RBX2:
000C67 4C67 ED4BBEF2        20      LD  BC,(RR_LOW+1)
000C6B 4C6B CDEF4C          17      CALL    RWXR
000C6E 4C6E 3ABAF2          13      LD  A,(CLSZ_H)
000C71 4C71 3D               4      DEC A
000C72 4C72 E5              11      PUSH    HL
000C73 4C73 2ABDF2          16      LD  HL,(RR_LOW)
000C76 4C76 A4               4      AND H
000C77 4C77 B5               4      OR  L
000C78 4C78 E1              10      POP HL
000C79 4C79 C9              10      RET
                                
       4C7A                     RBXA:
000C7A 4C7A D5              11      PUSH    DE
000C7B 4C7B CD614D          17      CALL    CLUST
000C7E 4C7E ED53C5F2        20      LD  (_DTPS),DE
000C82 4C82 D1              10      POP DE
000C83 4C83 CD3E4D          17      CALL    GNCL
000C86 4C86 D8              11      RET C
000C87 4C87 ED53C1F2        20      LD  (_CLPS),DE
                                
000C8B 4C8B ED4BBDF2        20      LD  BC,(RR_LOW)
000C8F 4C8F 2AB9F2          16      LD  HL,(CLSZ)
000C92 4C92 7C               4      LD  A,H
000C93 4C93 3D               4      DEC A
000C94 4C94 A0               4      AND B
000C95 4C95 47               4      LD  B,A
000C96 4C96 ED42            15      SBC HL,BC       ;remaining cluster
                                
000C98 4C98 ED5BE3F2        20      LD  DE,(LEFTX)
000C9C 4C9C ED52            15      SBC HL,DE       ;CP HL,DE
000C9E 4C9E 19              11      ADD HL,DE
000C9F 4C9F 3801            12      JR  C,RBXA1
000CA1 4CA1 EB               4      EX  DE,HL
       4CA2                     RBXA1:
000CA2 4CA2 3AB7F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000CA5 4CA5 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000CA8 4CA8 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000CAB 4CAB E5              11      PUSH    HL
000CAC 4CAC 2AC5F2          16      LD  HL,(_DTPS)
000CAF 4CAF 09              11      ADD HL,BC
000CB0 4CB0 ED5BDAF2        20      LD  DE,(DTAX)
000CB4 4CB4 C1              10      POP BC
000CB5 4CB5 C9              10      RET
                                
       4CB6                     RBXB:
000CB6 4CB6 2ADAF2          16      LD  HL,(DTAX)
000CB9 4CB9 ED5BC1F2        20      LD  DE,(_CLPS)
000CBD 4CBD 3AE4F2          13      LD  A,(LEFTX+1)
000CC0 4CC0 47               4      LD  B,A
000CC1 4CC1 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CC4                     RBXB1:
000CC4 4CC4 1F               4      RRA     ;->CF
000CC5 4CC5 3804            12      JR  C,RBXB2
000CC7 4CC7 CB38             8      SRL B   ;B=B/2
000CC9 4CC9 18F9            12      JR  RBXB1
       4CCB                     RBXB2:
000CCB 4CCB 78               4      LD  A,B
000CCC 4CCC B7               4      OR  A
000CCD 4CCD C9              10      RET
                                
       4CCE                     RBXC:
000CCE 4CCE ED4BE3F2        20      LD  BC,(LEFTX)
000CD2 4CD2 3ABAF2          13      LD  A,(CLSZ_H)
000CD5 4CD5 3D               4      DEC A
000CD6 4CD6 A0               4      AND B
000CD7 4CD7 47               4      LD  B,A
000CD8 4CD8 B1               4      OR  C
000CD9 4CD9 C9              10      RET
                                
       4CDA                     RBXEND:
000CDA 4CDA ED5BC3F2        20      LD  DE,(_LEFT)
000CDE 4CDE 2ABDF2          16      LD  HL,(RR_LOW)
000CE1 4CE1 3AC0F2          13      LD  A,(RR_HIGH+1)
000CE4 4CE4 19              11      ADD HL,DE
000CE5 4CE5 CE00             7      ADC A,0
000CE7 4CE7 22BDF2          16      LD  (RR_LOW),HL
000CEA 4CEA 32C0F2          13      LD  (RR_HIGH+1),A
000CED 4CED EB               4      EX  DE,HL       ;HL=Read byte
000CEE 4CEE C9              10      RET 
                                
       4CEF                     RWXR:
000CEF 4CEF 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CF2                     L_RWX:
000CF2 4CF2 1F               4      RRA     ;->CF
000CF3 4CF3 3806            12      JR  C,E_RWX
000CF5 4CF5 CB38             8      SRL B   ;BC=BC/2
000CF7 4CF7 CB19             8      RR  C   ;
000CF9 4CF9 18F7            12      JR  L_RWX
       4CFB                     E_RWX:
000CFB 4CFB 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
                                    PUSH    HL
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  D,A
                                    POP HL
                                #else
000CFE 4CFE 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D01 4D01 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D04 4D04 FD2AE0F2        20      LD  IY,(DIRENT1)
000D08 4D08 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000D0B 4D0B FD561B          19      LD  D,(IY+01BH)
                                #endif
000D0E 4D0E CD9C51          17      CALL    GET_DISK_BANK_FDRV
       4D11                     RWX1:
000D11 4D11 ED53C1F2        20      LD  (_CLPS),DE
000D15 4D15 7A               4      LD  A,D
000D16 4D16 B3               4      OR  E
000D17 4D17 37               4      SCF
000D18 4D18 C8              11      RET Z
                                
000D19 4D19 78               4      LD  A,B
000D1A 4D1A B1               4      OR  C
000D1B 4D1B C8              11      RET Z
                                
000D1C 4D1C CD3E4D          17      CALL    GNCL
000D1F 4D1F D8              11      RET C
000D20 4D20 0B               6      DEC BC
000D21 4D21 CDA04D          17      CALL    ENDCL
000D24 4D24 38EB            12      JR  C,RWX1
000D26 4D26 37               4      SCF
000D27 4D27 C9              10      RET
                                
       4D28                     NCL3:
000D28 4D28 CD9C51          17      CALL    GET_DISK_BANK_FDRV
000D2B 4D2B 6B               4      LD  L,E
000D2C 4D2C 62               4      LD  H,D
000D2D 4D2D CB3C             8      SRL H
000D2F 4D2F CB1D             8      RR  L
000D31 4D31 1F               4      RRA
000D32 4D32 19              11      ADD HL,DE
000D33 4D33 010060          10      LD  BC,BANK1_ADR
000D36 4D36 09              11      ADD HL,BC
000D37 4D37 ED4BBBF2        20      LD  BC,(SECSZ)
000D3B 4D3B 09              11      ADD HL,BC
000D3C 4D3C 17               4      RLA
000D3D 4D3D C9              10      RET
                                
       4D3E                     GNCL:
000D3E 4D3E 7A               4      LD  A,D
000D3F 4D3F B3               4      OR  E
000D40 4D40 37               4      SCF
000D41 4D41 C8              11      RET Z
000D42 4D42 C5              11      PUSH    BC
000D43 4D43 E5              11      PUSH    HL
000D44 4D44 CD284D          17      CALL    NCL3
000D47 4D47 3809            12      JR  C,GNC1
000D49 4D49 5E               7      LD  E,(HL)
000D4A 4D4A 23               6      INC HL
000D4B 4D4B 7E               7      LD  A,(HL)
000D4C 4D4C E60F             7      AND 00FH
000D4E 4D4E 57               4      LD  D,A
000D4F 4D4F E1              10      POP HL
000D50 4D50 C1              10      POP BC
000D51 4D51 C9              10      RET
       4D52                     GNC1:
000D52 4D52 7E               7      LD  A,(HL)
000D53 4D53 23               6      INC HL
000D54 4D54 56               7      LD  D,(HL)
000D55 4D55 0604             7      LD  B,4
       4D57                     GNC1L:
000D57 4D57 CB3A             8      SRL D
000D59 4D59 1F               4      RRA
000D5A 4D5A 10FB            13      DJNZ    GNC1L
                                
000D5C 4D5C 5F               4      LD  E,A
000D5D 4D5D E1              10      POP HL
000D5E 4D5E C1              10      POP BC
000D5F 4D5F A7               4      AND A
000D60 4D60 C9              10      RET
                                
       4D61                     CLUST:
000D61 4D61 EB               4      EX  DE,HL
       4D62                     CLUST_HL:
000D62 4D62 2B               6      DEC HL
000D63 4D63 2B               6      DEC HL
000D64 4D64 C5              11      PUSH    BC
000D65 4D65 3ABAF2          13      LD  A,(CLSZ_H)
000D68 4D68 CDC851          17      CALL    MUL_AHL
                                
000D6B 4D6B CD244E          17      CALL    GET_DIR_POS
000D6E 4D6E 4F               4      LD  C,A
000D6F 4D6F 0600             7      LD  B,0
000D71 4D71 09              11      ADD HL,BC
                                
000D72 4D72 ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000D76 4D76 CB38             8      SRL B
000D78 4D78 CB19             8      RR  C           ;/2
000D7A 4D7A CB38             8      SRL B
000D7C 4D7C CB19             8      RR  C           ;/4
000D7E 4D7E CB38             8      SRL B
000D80 4D80 CB19             8      RR  C           ;/8
000D82 4D82 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000D83 4D83 4D               4      LD  C,L     ;C=読み出し元
000D84 4D84 29              11      ADD HL,HL   ;64KB→32KB
000D85 4D85 29              11      ADD HL,HL   ;32KB→16KB
000D86 4D86 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D87 4D87 CD9C51          17      CALL    GET_DISK_BANK_FDRV
000D8A 4D8A 84               4      ADD A,H
000D8B 4D8B 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D8E 4D8E 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D91 4D91 32B7F2          13      LD  (_BANK),A
000D94 4D94 69               4      LD  L,C     ;C=読み出し元
000D95 4D95 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D97 4D97 A5               4      AND L
                                #endif
       4D98                     CLUST2:
000D98 4D98 C660             7      ADD A,high BANK1_ADR
000D9A 4D9A 67               4      LD  H,A
000D9B 4D9B 2E00             7      LD  L,0
000D9D 4D9D EB               4      EX  DE,HL
000D9E 4D9E C1              10      POP BC
000D9F 4D9F C9              10      RET
                                
       4DA0                     ENDCL:
000DA0 4DA0 7A               4      LD  A,D ;END CLUSTER
000DA1 4DA1 FE0F             7      CP  00FH    ;FAT12の最大値
000DA3 4DA3 C0              11      RET NZ
000DA4 4DA4 7B               4      LD  A,E
000DA5 4DA5 FEF7             7      CP  0F7H
000DA7 4DA7 C9              10      RET
                                
       4DA8                     RB_READ:
000DA8 4DA8 AF               4      XOR A   ;HLA = HL*128
000DA9 4DA9 CB3C             8      SRL H
000DAB 4DAB CB1D             8      RR  L
000DAD 4DAD 1F               4      RRA
000DAE 4DAE 32BDF2          13      LD  (RR_LOW),A
000DB1 4DB1 22BEF2          16      LD  (RR_MID),HL
000DB4 4DB4 218000          10      LD  HL,128
                                
000DB7 4DB7 CD8949          17      CALL    ROM_READ
000DBA 4DBA C9              10      RET
                                
       4DBB                     GETSEQ:
000DBB 4DBB FD6E20          19      LD  L,(IY+32)
000DBE 4DBE FD660C          19      LD  H,(IY+12)
                                
000DC1 4DC1 CB25             8      SLA L
                                
000DC3 4DC3 CB3C             8      SRL H
000DC5 4DC5 CB1D             8      RR  L
000DC7 4DC7 C9              10      RET
                                
       4DC8                     SETSEQ:
000DC8 4DC8 F5              11      PUSH    AF
000DC9 4DC9 3ABDF2          13      LD  A,(RR_LOW)
000DCC 4DCC 2ABEF2          16      LD  HL,(RR_MID)
                                
000DCF 4DCF CDE64D          17      CALL    SSQ1
                                
000DD2 4DD2 29              11      ADD HL,HL
000DD3 4DD3 CB3D             8      SRL L
000DD5 4DD5 FD7520          19      LD  (IY+32),L
000DD8 4DD8 FD740C          19      LD  (IY+12),H
000DDB 4DDB F1              10      POP AF
000DDC 4DDC C9              10      RET
                                
       4DDD                     GETSIZE:
000DDD 4DDD FD7E10          19      LD  A,(IY+16)
000DE0 4DE0 FD6E11          19      LD  L,(IY+17)
000DE3 4DE3 FD6612          19      LD  H,(IY+18)
       4DE6                     SSQ1:
000DE6 4DE6 87               4      ADD A,A
000DE7 4DE7 ED6A            15      ADC HL,HL
000DE9 4DE9 B7               4      OR  A
000DEA 4DEA C8              11      RET Z
000DEB 4DEB 23               6      INC HL
000DEC 4DEC C9              10      RET
                                
       4DED                     SET_FCB:
000DED 4DED D5              11      PUSH    DE
000DEE 4DEE FDE1            14      POP IY
000DF0 4DF0 FD7E1C          19      LD  A,(IY+28)
000DF3 4DF3 FEFF             7      CP  0FFH
000DF5 4DF5 200C            12      JR  NZ,POPAF_SCF_FF_RET
000DF7 4DF7 E5              11      PUSH    HL
000DF8 4DF8 FD6E1A          19      LD  L,(IY+26)
000DFB 4DFB FD661B          19      LD  H,(IY+27)
000DFE 4DFE 22C1F2          16      LD  (_CLPS),HL
000E01 4E01 E1              10      POP HL
000E02 4E02 C9              10      RET
                                
       4E03                     POPAF_SCF_FF_RET:
000E03 4E03 F1              10      POP AF
000E04 4E04 37               4      SCF
000E05 4E05 9F               4      SBC A,A
000E06 4E06 C9              10      RET
                                
       4E07                     GET_DIR_DAT:
000E07 4E07 2AE9F2          16      LD  HL,(_CDX)
000E0A 4E0A 7C               4      LD  A,H
000E0B 4E0B B5               4      OR  L
000E0C 4E0C 2035            12      JR  NZ,GET_SUBDIR
000E0E 4E0E CD244E          17      CALL    GET_DIR_POS
000E11 4E11 C660             7      ADD A,high BANK1_ADR
000E13 4E13 2E00             7      LD  L,0
000E15 4E15 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
000E16 4E16 CDEE4B          17      CALL    CHECK_DIR_PAGE
                                #endif
000E19 4E19 3AB8F2          13      LD  A,(_BANK1)
000E1C 4E1C 32E2F2          13      LD  (_DIR_BANK),A
                                
000E1F 4E1F 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000E22 4E22 4F               4      LD  C,A
000E23 4E23 C9              10      RET
                                
       4E24                     GET_DIR_POS:                ;ルートディレクトリ
000E24 4E24 CD9C51          17      CALL    GET_DISK_BANK_FDRV
000E27 4E27 32B8F2          13      LD  (_BANK1),A
000E2A 4E2A 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000E2D 4E2D 47               4      LD  B,A
000E2E 4E2E 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000E31 4E31 4F               4      LD  C,A
000E32 4E32 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4E35                     GET_DIR_POS1:
000E35 4E35 81               4      ADD A,C
000E36 4E36 10FD            13      DJNZ    GET_DIR_POS1
                                
000E38 4E38 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
000E3C 4E3C 37               4      SCF     ;無限ループ回避
       4E3D                     L_MDP:
000E3D 4E3D CB18             8      RR  B   ;->CF
000E3F 4E3F D8              11      RET C
000E40 4E40 87               4      ADD A,A
000E41 4E41 18FA            12      JR  L_MDP
                                
       4E43                     GET_SUBDIR:             ;サブディレクトリ
000E43 4E43 CD624D          17      CALL    CLUST_HL
000E46 4E46 EB               4      EX  DE,HL
000E47 4E47 3AB7F2          13      LD  A,(_BANK)
000E4A 4E4A 32E2F2          13      LD  (_DIR_BANK),A
000E4D 4E4D 3ABAF2          13      LD  A,(CLSZ_H)
000E50 4E50 87               4      ADD A,A     ;*2
000E51 4E51 87               4      ADD A,A     ;*4
000E52 4E52 87               4      ADD A,A     ;*8
000E53 4E53 4F               4      LD  C,A
000E54 4E54 C9              10      RET
                                
       4E55                     STATEMENT:
000E55 4E55 11BD4F          10      LD  DE,STR_CHDIR
000E58 4E58 CDA34F          17      CALL    CPPROCNM
000E5B 4E5B 280A            12      JR  Z,_CHDIR
000E5D 4E5D 11C34F          10      LD  DE,STR_RAMDISK
000E60 4E60 CDA34F          17      CALL    CPPROCNM
000E63 4E63 2814            12      JR  Z,_RAMDISK
000E65 4E65 37               4      SCF
000E66 4E66 C9              10      RET
       4E67                     _CHDIR:
000E67 4E67 7E               7      LD  A,(HL)
000E68 4E68 FE28             7      CP  '('
000E6A 4E6A 37               4      SCF
000E6B 4E6B C0              11      RET NZ
000E6C 4E6C CD3747          17      CALL    INIT_PARAM
000E6F 4E6F CD2A4A          17      CALL    FILE_B
000E72 4E72 CD914E          17      CALL    ROM_CD
000E75 4E75 DAE245          10      JP  C,ERROR_FILE_NOT_FOUND
000E78 4E78 C9              10      RET
                                
       4E79                     _RAMDISK:
000E79 4E79 7E               7      LD  A,(HL)
000E7A 4E7A FE28             7      CP  '('
000E7C 4E7C 37               4      SCF
000E7D 4E7D C0              11      RET NZ
000E7E 4E7E 23               6      INC HL
000E7F 4E7F DD212F54        14      LD  IX,FRMQNT
000E83 4E83 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E87 4E87 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E8A 4E8A 7A               4      LD  A,D
000E8B 4E8B B3               4      OR  E
000E8C 4E8C C2DC45          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E8F 4E8F 23               6      INC HL
000E90 4E90 C9              10      RET
                                
       4E91                     ROM_CD:
000E91 4E91 3AECF2          13      LD  A,(FNAME)
000E94 4E94 FE20             7      CP  020H
000E96 4E96 2822            12      JR  Z,CD1
000E98 4E98 CDA94B          17      CALL    ROM_OPEN
000E9B 4E9B D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0000BH   ;属性(アトリビュート)
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    POP DE
                                    BIT 4,A     ;ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    LD  D,A
                                    EX  DE,HL
                                    POP DE
                                #else
000E9C 4E9C FD2AE0F2        20      LD  IY,(DIRENT1)
000EA0 4EA0 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000EA4 4EA4 CAE245          10      JP  Z,ERROR_FILE_NOT_FOUND
000EA7 4EA7 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000EAA 4EAA FD661B          19      LD  H,(IY+01BH)
                                #endif
       4EAD                     CD2:
000EAD 4EAD 22DEF2          16      LD  (_CD),HL
000EB0 4EB0 2AE7F2          16      LD  HL,(PARAM1)
       4EB3                     CD_SKIP:
000EB3 4EB3 7E               7      LD  A,(HL)
000EB4 4EB4 23               6      INC HL
000EB5 4EB5 FE21             7      CP  021H
000EB7 4EB7 38FA            12      JR  C,CD_SKIP
000EB9 4EB9 C9              10      RET
       4EBA                     CD1:
000EBA 4EBA 2AE9F2          16      LD  HL,(_CDX)
000EBD 4EBD 18EE            12      JR  CD2
                                
       4EBF                     GET_BASIC_FCB:
000EBF 4EBF D5              11      PUSH    DE
000EC0 4EC0 23               6      INC HL  ;+1
000EC1 4EC1 5E               7      LD  E,(HL)  ;FCB[1]
000EC2 4EC2 23               6      INC HL  ;+2
000EC3 4EC3 56               7      LD  D,(HL)  ;FCB[2]
000EC4 4EC4 23               6      INC HL  ;+3
000EC5 4EC5 ED53E0F2        20      LD  (DIRENT1),DE
                                            ;FCB[3]
000EC9 4EC9 23               6      INC HL  ;+4
                                            ;FCB[4]
000ECA 4ECA 23               6      INC HL  ;+5
000ECB 4ECB 7E               7      LD  A,(HL)  ;FCB[5]
000ECC 4ECC 23               6      INC HL  ;+6
000ECD 4ECD 32E2F2          13      LD  (_DIR_BANK),A
000ED0 4ED0 5E               7      LD  E,(HL)  ;FCB[6]
000ED1 4ED1 23               6      INC HL  ;+7
000ED2 4ED2 56               7      LD  D,(HL)  ;FCB[7]
000ED3 4ED3 23               6      INC HL  ;+8
000ED4 4ED4 ED53BDF2        20      LD  (RR_LOW),DE
000ED8 4ED8 7E               7      LD  A,(HL)  ;FCB[8]
000ED9 4ED9 23               6      INC HL  ;+9
000EDA 4EDA 32BFF2          13      LD  (RR_HIGH),A
000EDD 4EDD 7E               7      LD  A,(HL)  ;FCB[9]
000EDE 4EDE 23               6      INC HL  ;+10
000EDF 4EDF 22C7F2          16      LD  (_DTA),HL   ;FCB[10]
000EE2 4EE2 D1              10      POP DE
000EE3 4EE3 C9              10      RET
                                
       4EE4                     SET_BASIC_FCB:
000EE4 4EE4 E5              11      PUSH    HL
000EE5 4EE5 2A64F8          16      LD  HL,(PTRFIL)
000EE8 4EE8 23               6      INC HL  ;+1
000EE9 4EE9 D5              11      PUSH    DE
000EEA 4EEA ED5BE0F2        20      LD  DE,(DIRENT1)
000EEE 4EEE 73               7      LD  (HL),E  ;FCB[1]
000EEF 4EEF 23               6      INC HL  ;+2
000EF0 4EF0 72               7      LD  (HL),D  ;FCB[2]
000EF1 4EF1 23               6      INC HL  ;+3
000EF2 4EF2 AF               4      XOR A
000EF3 4EF3 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
000EF4 4EF4 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
000EF5 4EF5 23               6      INC HL  ;+5
000EF6 4EF6 3AE2F2          13      LD  A,(_DIR_BANK)
000EF9 4EF9 77               7      LD  (HL),A  ;FCB[5]
000EFA 4EFA 23               6      INC HL  ;+6
000EFB 4EFB ED5BBDF2        20      LD  DE,(RR_LOW)
000EFF 4EFF 73               7      LD  (HL),E  ;FCB[6]
000F00 4F00 23               6      INC HL  ;+7
000F01 4F01 72               7      LD  (HL),D  ;FCB[7]
000F02 4F02 23               6      INC HL  ;+8
000F03 4F03 3ABFF2          13      LD  A,(RR_HIGH)
000F06 4F06 77               7      LD  (HL),A  ;FCB[8]
000F07 4F07 23               6      INC HL  ;+9
000F08 4F08 3600            10      LD  (HL),0  ;FCB[9]
000F0A 4F0A D1              10      POP DE
000F0B 4F0B E1              10      POP HL
000F0C 4F0C C9              10      RET
                                
       4F0D                     DEVICE_CHECK:
000F0D 4F0D 11CB4F          10      LD  DE,STR_A
000F10 4F10 CDA34F          17      CALL    CPPROCNM
000F13 4F13 280A            12      JR  Z,DEVICE_OK
000F15 4F15 11CD4F          10      LD  DE,STR_ROM
000F18 4F18 CDA34F          17      CALL    CPPROCNM
000F1B 4F1B 2802            12      JR  Z,DEVICE_OK
000F1D 4F1D 37               4      SCF
000F1E 4F1E C9              10      RET
       4F1F                     DEVICE_OK:
000F1F 4F1F AF               4      XOR A
000F20 4F20 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファインデックス
                                ; +10: バッファ
                                
       4F21                     DEVICE_0_OPEN:
000F21 4F21 D5              11      PUSH    DE
000F22 4F22 E5              11      push    hl
                                ;
000F23 4F23 3E01             7      LD  A,1     ;ドライブA
000F25 4F25 32EBF2          13      LD  (FDRV),A
000F28 4F28 2166F8          10      LD  HL,FILNAM
000F2B 4F2B 11ECF2          10      LD  DE,FNAME
000F2E 4F2E 010B00          10      LD  BC,8+3
000F31 4F31 CD7D55          17      CALL    INIT_FILE1
000F34 4F34 CDA94B          17      CALL    ROM_OPEN
000F37 4F37 DAE245          10      JP  C,ERROR_FILE_NOT_FOUND
000F3A 4F3A E1              10      pop hl
000F3B 4F3B D1              10      POP DE
000F3C 4F3C 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
000F3F 4F3F 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
000F40 4F40 AF               4      XOR A
000F41 4F41 32E3F2          13      LD  (LEFTX),A
000F44 4F44 CDE44E          17      CALL    SET_BASIC_FCB
000F47 4F47 7B               4      ld  a,e
000F48 4F48 FE08             7      cp  8
000F4A 4F4A 3F               4      ccf
000F4B 4F4B C9              10      ret
                                
       4F4C                     DEVICE_2_CLOSE:
000F4C 4F4C AF               4      XOR A
                                ;   LD  (HL),A
000F4D 4F4D 6F               4      LD  L,A
000F4E 4F4E 67               4      LD  H,A
000F4F 4F4F 2264F8          16      LD  (PTRFIL),HL
000F52 4F52 C9              10      RET
                                
       4F53                     DEVICE_ENTRY:
000F53 4F53 FE08             7      CP  8
000F55 4F55 280C            12      JR  Z,DEVICE_8_SIN
000F57 4F57 3C               4      INC A
000F58 4F58 28B3            12      JR  Z,DEVICE_CHECK:
000F5A 4F5A 3D               4      DEC A
000F5B 4F5B 28C4            12      JR  Z,DEVICE_0_OPEN
000F5D 4F5D FE02             7      CP  2
000F5F 4F5F 28EB            12      JR  Z,DEVICE_2_CLOSE
000F61 4F61 37               4      SCF
000F62 4F62 C9              10      RET
                                
       4F63                     DEVICE_8_SIN:
000F63 4F63 CDBF4E          17      CALL    GET_BASIC_FCB
000F66 4F66 E67F             7      AND 127
000F68 4F68 281D            12      JR  Z,SIN_READ_DISK
000F6A 4F6A 2AC7F2          16      LD  HL,(_DTA)
000F6D 4F6D 2B               6      DEC HL
000F6E 4F6E 34              11      INC (HL)
000F6F 4F6F 3C               4      INC A   ;(INC HL)
000F70 4F70 85               4      ADD A,L ;ADD HL,A
000F71 4F71 6F               4      LD  L,A ;
000F72 4F72 8C               4      ADC A,H ;
000F73 4F73 95               4      SUB L   ;
000F74 4F74 67               4      LD  H,A ;
       4F75                     SIN_READ1:
000F75 4F75 7E               7      LD  A,(HL)
000F76 4F76 FE0A             7      CP  00AH
000F78 4F78 C8              11      RET Z   ;ZF=separate
000F79 4F79 FE1A             7      CP  01AH
000F7B 4F7B 2803            12      JR  Z,SIN_EOF
000F7D 4F7D 37               4      SCF
000F7E 4F7E 3F               4      CCF     ;ZF=0 CF=0にしたい
000F7F 4F7F C9              10      RET
       4F80                     SIN_EOF:
000F80 4F80 2AC7F2          16      LD  HL,(_DTA)
000F83 4F83 2B               6      DEC HL
000F84 4F84 35              11      DEC (HL)
       4F85                     SCF_RET:
000F85 4F85 37               4      SCF
000F86 4F86 C9              10      RET
                                
       4F87                     SIN_READ_DISK:
000F87 4F87 218000          10      LD  HL,128
000F8A 4F8A CD8949          17      CALL    ROM_READ
000F8D 4F8D CDE44E          17      CALL    SET_BASIC_FCB
000F90 4F90 7C               4      LD  A,H
000F91 4F91 B5               4      OR  L
000F92 4F92 28F1            12      JR  Z,SCF_RET
000F94 4F94 ED5BC7F2        20      LD  DE,(_DTA)
000F98 4F98 19              11      ADD HL,DE
000F99 4F99 361A            10      LD  (HL),01AH
000F9B 4F9B 2AC7F2          16      LD  HL,(_DTA)
000F9E 4F9E 2B               6      DEC HL
000F9F 4F9F 34              11      INC (HL)
000FA0 4FA0 23               6      INC HL
000FA1 4FA1 18D2            12      JR  SIN_READ1
                                
       4FA3                     CPPROCNM:
000FA3 4FA3 E5              11      PUSH    HL
000FA4 4FA4 2189FD          10      LD  HL,PROCNM
       4FA7                     CPPROCNM1:
000FA7 4FA7 1A               7      LD  A,(DE)
000FA8 4FA8 13               6      INC DE
000FA9 4FA9 BE               7      CP  (HL)
000FAA 4FAA 23               6      INC HL
000FAB 4FAB 2003            12      JR  NZ,CPPROCNM2
000FAD 4FAD B7               4      OR  A
000FAE 4FAE 20F7            12      JR  NZ,CPPROCNM1
       4FB0                     CPPROCNM2:
000FB0 4FB0 E1              10      POP HL
000FB1 4FB1 C9              10      RET
                                
       4FB2                     WILDCARD:
000FB2 4FB2 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4FBD                     STR_CHDIR:
000FBD 4FBD 434844495200            DB  "CHDIR",0
       4FC3                     STR_RAMDISK:
000FC3 4FC3 52414D4449534B00        DB  "RAMDISK",0
       4FCB                     STR_A:
000FCB 4FCB 4100                    DB  "A",0
       4FCD                     STR_ROM:
000FCD 4FCD 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4FD1                     ERROR_WRITE_PROTECTED:
000FD1 4FD1 3E00             7      LD  A,0     ;Write protected
000FD3 4FD3 C9              10      RET
       4FD4                     DISKIO:
000FD4 4FD4 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000FD6 4FD6 48               4      LD  C,B
000FD7 4FD7 CDA651          17      CALL    GET_DISK_BANK
       4FDA                     SETMAP1:        
000FDA 4FDA E5              11      PUSH    HL
       4FDB                     DISKIO1:
000FDB 4FDB C5              11      PUSH    BC      ;B=残りのセクタ数
000FDC 4FDC D5              11      PUSH    DE      ;DE=セクタ番号
000FDD 4FDD F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000FDE 4FDE EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000FDF 4FDF F5              11      PUSH    AF
000FE0 4FE0 3ABCF2          13      LD  A,(SECSZ_H)
000FE3 4FE3 CDC851          17      CALL    MUL_AHL
000FE6 4FE6 F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000FE7 4FE7 4D               4      LD  C,L     ;C=読み出し元
000FE8 4FE8 29              11      ADD HL,HL       ;64KB→32KB
000FE9 4FE9 29              11      ADD HL,HL       ;32KB→16KB
000FEA 4FEA 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000FEB 4FEB 84               4      ADD A,H
000FEC 4FEC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000FEF 4FEF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000FF2 4FF2 32B7F2          13      LD  (_BANK),A
000FF5 4FF5 79               4      LD  A,C     ;C=読み出し元
000FF6 4FF6 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4FF8                     DISKIO2:
000FF8 4FF8 C660             7      ADD A,high BANK1_ADR
000FFA 4FFA 67               4      LD  H,A
000FFB 4FFB ED4BBBF2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000FFF 4FFF 69               4      LD  L,C     ;C=0
001000 5000 CD0344          17      CALL    ROM_LDIR
001003 5003 EB               4      EX  DE,HL
001004 5004 F1              10      POP AF
001005 5005 D1              10      POP DE
001006 5006 13               6      INC DE
001007 5007 C1              10      POP BC
001008 5008 10D1            13      DJNZ    DISKIO1
00100A 500A 41               4      LD  B,C
                                
00100B 500B E1              10      POP HL
00100C 500C AF               4      XOR A
                                
00100D 500D FB               4      EI
00100E 500E C9              10      RET
                                
       500F                     DSKCHG:
00100F 500F CD4850          17      CALL    IS_BPB
001012 5012 3824            12      JR  C,NOTREADY
001014 5014 3A23FB          13      LD  A,(DRVTBL+2)
001017 5017 B7               4      OR  A
001018 5018 201A            12      JR  NZ,DSKCHG1
00101A 501A 3A21FB          13      LD  A,(DRVTBL)
00101D 501D FE02             7      CP  2
00101F 501F 2013            12      JR  NZ,DSKCHG1
001021 5021 CD4850          17      CALL    IS_BPB
001024 5024 300E            12      JR  NC,DSKCHG1
001026 5026 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
001028 5028 3221FB          13      LD  (DRVTBL),A
00102B 502B 3223FB          13      LD  (DRVTBL+2),A
00102E 502E 3A48F3          13      LD  A,(MASTERS)
001031 5031 3224FB          13      LD  (DRVTBL+3),A
       5034                     DSKCHG1:
001034 5034 AF               4      XOR A
001035 5035 0601             7      LD  B,1
001037 5037 C9              10      RET
       5038                     NOTREADY:
001038 5038 3E02             7      LD  A,2
00103A 503A 37               4      SCF
00103B 503B C9              10      RET
                                
       503C                     NO_BPB:
00103C 503C E1              10      POP HL
00103D 503D 23               6      INC HL
00103E 503E 11CE51          10      LD  DE,DPB2DD
001041 5041 011200          10      LD  BC,DPB2DD_E-DPB2DD
001044 5044 EDB0                    LDIR
001046 5046 AF               4      XOR A
001047 5047 C9              10      RET
                                
       5048                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
001048 5048 CDA651          17      CALL    GET_DISK_BANK
                                
00104B 504B 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
00104E 504E FE01             7      CP  1
001050 5050 D8              11      RET C
                                
001051 5051 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
001054 5054 C6FF             7      ADD A,0FFH
001056 5056 D8              11      RET C
                                
001057 5057 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       505A                     IS_BPB1:
00105A 505A FE01             7      CP  1
00105C 505C C8              11      RET Z
00105D 505D FE02             7      CP  2
00105F 505F C8              11      RET Z
001060 5060 FE04             7      CP  4
001062 5062 C8              11      RET Z
001063 5063 37               4      SCF
001064 5064 C9              10      RET
                                
       5065                     GETDPB:
001065 5065 E5              11      PUSH    HL
001066 5066 CDA651          17      CALL    GET_DISK_BANK
                                
001069 5069 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
00106C 506C B7               4      OR  A
00106D 506D 28CD            12      JR  Z,NO_BPB
00106F 506F DDE1            14      POP IX
001071 5071 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
001074 5074 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
001077 5077 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
00107A 507A 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
00107D 507D DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
001080 5080 87               4      ADD A,A
001081 5081 87               4      ADD A,A
001082 5082 87               4      ADD A,A
001083 5083 3D               4      DEC A
001084 5084 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
001087 5087 06FF             7      LD  B,-1
001089 5089 A7               4      AND A           ;無限ループ阻止
       508A                     GETDPB1:
00108A 508A 04               4      INC B
00108B 508B 1F               4      RRA
00108C 508C 38FC            12      JR  C,GETDPB1
00108E 508E DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
001091 5091 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001094 5094 3D               4      DEC A
001095 5095 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
001098 5098 A7               4      AND A           ;無限ループ阻止
001099 5099 06FF             7      LD  B,-1
       509B                     GETDPB2:
00109B 509B 04               4      INC B
00109C 509C 1F               4      RRA
00109D 509D 38FC            12      JR  C,GETDPB2
00109F 509F 04               4      INC B
0010A0 50A0 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
0010A3 50A3 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
0010A6 50A6 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
0010A9 50A9 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
0010AC 50AC 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
0010AF 50AF DD770A          19      LD  (IX+10),A       ;FATCNT
                                
0010B2 50B2 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
0010B5 50B5 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
0010B8 50B8 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
0010BC 50BC DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
0010BF 50BF DD460A          19      LD  B,(IX+10)       ;FATCNT
0010C2 50C2 210000          10      LD  HL,0
       50C5                     GETDPB3:
0010C5 50C5 19              11      ADD HL,DE
0010C6 50C6 10FD            13      DJNZ    GETDPB3
       50C8                     GETDPB4:
0010C8 50C8 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
0010CB 50CB DD5609          19      LD  D,(IX+9)        ;FIRFAT
0010CE 50CE 19              11      ADD HL,DE
0010CF 50CF DD7511          19      LD  (IX+17),L       ;FIRDIR
0010D2 50D2 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
0010D5 50D5 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0010D8 50D8 87               4      ADD A,A
0010D9 50D9 87               4      ADD A,A
0010DA 50DA DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       50DD                     GETDPB5:
0010DD 50DD CB3B             8      SRL E
0010DF 50DF 1F               4      RRA
0010E0 50E0 30FB            12      JR  NC,GETDPB5
0010E2 50E2 1600             7      LD  D,0
0010E4 50E4 19              11      ADD HL,DE
0010E5 50E5 DD750C          19      LD  (IX+12),L       ;FIRREC
0010E8 50E8 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
0010EB 50EB 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
0010EE 50EE DD5E0C          19      LD  E,(IX+12)       ;FIRREC
0010F1 50F1 DD560D          19      LD  D,(IX+13)       ;FIRREC
0010F4 50F4 A7               4      AND A
0010F5 50F5 ED52            15      SBC HL,DE
                                
0010F7 50F7 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
0010FA 50FA 3C               4      INC A
0010FB 50FB 37               4      SCF             ;無限ループ阻止
       50FC                     GETDPB6:
0010FC 50FC 1F               4      RRA
0010FD 50FD 3806            12      JR  C,GETDPB7
0010FF 50FF CB3C             8      SRL H
001101 5101 CB1D             8      RR  L
001103 5103 18F7            12      JR  GETDPB6
       5105                     GETDPB7:
001105 5105 23               6      INC HL
001106 5106 DD750E          19      LD  (IX+14),L       ;MAXCLUS
001109 5109 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       510C                     GETDPBD1:
00110C 510C DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00110F 510F E6FC             7      AND 0FCH
001111 5111 C8              11      RET Z
                                
001112 5112 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
001116 5116 37               4      SCF
001117 5117 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
00111B 511B DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
00111E 511E DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
001122 5122 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001126 5126 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
00112A 512A DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
00112E 512E DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
001132 5132 DDCB1126        23      SLA (IX+17)         ;FIRDIR
001136 5136 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
00113A 513A DD6E11          19      LD  L,(IX+17)       ;FIRDIR
00113D 513D DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
001140 5140 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001143 5143 87               4      ADD A,A
001144 5144 87               4      ADD A,A
001145 5145 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5148                     GETDPBD5:
001148 5148 CB3B             8      SRL E
00114A 514A 1F               4      RRA
00114B 514B 30FB            12      JR  NC,GETDPBD5
00114D 514D 1600             7      LD  D,0
00114F 514F 19              11      ADD HL,DE
001150 5150 DD750C          19      LD  (IX+12),L       ;FIRREC
001153 5153 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001156 5156 18B4            12      JR  GETDPBD1
                                
       5158                     CHOICE:
001158 5158 210000          10      LD  HL,0
00115B 515B C9              10      RET
                                
       515C                     DSKFMT:
00115C 515C AF               4      XOR A
00115D 515D 37               4      SCF
       515E                     DSKSTP:
00115E 515E C9              10      RET
                                
       515F                     BASENT:
00115F 515F 2A74F6          16      LD  HL,(STKTOP)
001162 5162 3A40F3          13      LD  A,(REBOOT)
001165 5165 C6FF             7      ADD A,0FFH
001167 5167 3811            12      JR  C,REBOOT1
001169 5169 21E051          10      LD  HL,AUTOEXEC
00116C 516C 11EBF2          10      LD  DE,FDRV
00116F 516F 010C00          10      LD  BC,1+8+3
001172 5172 EDB0                    LDIR
001174 5174 CDA94B          17      CALL    ROM_OPEN
001177 5177 D42C45          17      CALL    NC,ROM_LOAD1
       517A                     REBOOT1:
00117A 517A 21EC51          10      LD  HL,CMD_RUN
00117D 517D 111FF4          10      LD  DE,KBUF
001180 5180 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
001183 5183 D5              11      PUSH    DE
001184 5184 EDB0                    LDIR
001186 5186 3004            12      JR  NC,REBOOT2
001188 5188 AF               4      XOR A
001189 5189 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       518C                     REBOOT2:
00118C 518C E1              10      POP HL
00118D 518D FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001191 5191 DD210146        14      LD  IX,NEWSTT
001195 5195 C31C00          10      JP  _CALSLT
                                
       5198                     GETSLT:
001198 5198 3A22FB          13      LD  A,(DRVTBL+1)
00119B 519B C9              10      RET
                                
       519C                     GET_DISK_BANK_FDRV:
00119C 519C 3AEBF2          13      LD  A,(FDRV)
00119F 519F D601             7      SUB 1
0011A1 51A1 3003            12      JR  NC,GET_DISK_BANK
0011A3 51A3 3ADDF2          13      LD  A,(_DVSW)
       51A6                     GET_DISK_BANK:
0011A6 51A6 B7               4      OR  A       ;A=DRIVE
0011A7 51A7 3E01             7      LD  A,DISK_BANK
0011A9 51A9 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
0011AB 51AB 3ADCF2          13      LD  A,(B_DRIVE)
                                #endif
       51AE                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0011AE 51AE 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0011B1 51B1 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0011B4 51B4 F5              11      PUSH    AF
0011B5 51B5 E5              11      PUSH    HL
0011B6 51B6 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
0011B9 51B9 22BBF2          16      LD  (SECSZ),HL
0011BC 51BC 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0011BF 51BF CDC851          17      CALL    MUL_AHL
0011C2 51C2 22B9F2          16      LD  (CLSZ),HL
0011C5 51C5 E1              10      POP HL
0011C6 51C6 F1              10      POP AF
0011C7 51C7 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       51C8                     MUL_AHL:
0011C8 51C8 37               4      SCF     ;無限ループ回避
       51C9                     MUL_AHL1:
0011C9 51C9 1F               4      RRA     ;->CF
0011CA 51CA D8              11      RET C
0011CB 51CB 29              11      ADD HL,HL
0011CC 51CC 18FB            12      JR  MUL_AHL1
                                
       51CE                     DPB2DD:
0011CE 51CE F9                      DB  0F9H    ;MEDIA
0011CF 51CF 0002                    DW  00200H  ;SECSIZ
0011D1 51D1 0F                      DB  00FH    ;DIRMSK
0011D2 51D2 04                      DB  004H    ;DIRSHFT
0011D3 51D3 01                      DB  001H    ;CLUSMSK
0011D4 51D4 02                      DB  002H    ;CLUSSHFT
0011D5 51D5 0100                    DW  00001H  ;FIRFAT
0011D7 51D7 02                      DB  002H    ;FATCNT
0011D8 51D8 70                      DB  070H    ;MAXENT
0011D9 51D9 0E00                    DW  0000EH  ;FIRREC
0011DB 51DB CA02                    DW  002CAH  ;MAXCLUS
0011DD 51DD 03                      DB  003H    ;FATSIZ
0011DE 51DE 0700                    DW  0007H   ;FIRDIR
       51E0                     DPB2DD_E:
                                
       51E0                     AUTOEXEC:
0011E0 51E0 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       51EC                     CMD_RUN:
0011EC 51EC 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DW  0F280H
                                #else
0011F2 51F2 40F2                    DW  0F240H
                                #endif
       51F4                     CMD_CLEAR_E:
0011F4 51F4 3A8A00                  DB  03AH,08AH,0         ;RUN
       51F7                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       51F7                     POP_HL_ERROR:
0011F7 51F7 E1              10      POP     HL
       51F8                     _ERROR:
0011F8 51F8 0600             7      LD  B,0
0011FA 51FA A7               4      AND A
0011FB 51FB C9              10      RET
                                
       51FC                     ROM_BDOS:
0011FC 51FC E5              11      PUSH    HL
0011FD 51FD 79               4      LD  A,C
0011FE 51FE 87               4      ADD A,A
0011FF 51FF 38F7            12      JR  C,_ERROR
001201 5201 6F               4      LD  L,A
001202 5202 265F             7      LD  H,high STABLE
001204 5204 7E               7      LD  A,(HL)
001205 5205 2C               4      INC L
001206 5206 66               7      LD  H,(HL)
001207 5207 6F               4      LD  L,A
001208 5208 E3              19      EX  (SP),HL
001209 5209 79               4      LD  A,C
00120A 520A C9              10      RET
                                
       520B                     _PRINT:
       520B                     PRINT:
00120B 520B 7B               4      LD  A,E
00120C 520C 1803            12      JR  MSG_A
                                
       520E                     _SYS01:     ;(BDOS)コンソール入力
00120E 520E CD8552          17      CALL    _SYS07
       5211                     MSG_A:
001211 5211 FE03             7      CP  3
001213 5213 2814            12      JR  Z,MSG_BR
       5215                     MSGA1:
001215 5215 F5              11      PUSH    AF
001216 5216 C5              11      PUSH    BC
001217 5217 D5              11      PUSH    DE
001218 5218 E5              11      PUSH    HL
001219 5219 DDE5            15      PUSH    IX
00121B 521B DD21A200        14      LD  IX,CHPUT
00121F 521F CDD442          17      CALL    CALSLT_R
001222 5222 DDE1            14      POP IX
001224 5224 E1              10      POP HL
001225 5225 D1              10      POP DE
001226 5226 C1              10      POP BC
       5227                     MSGA2:
001227 5227 F1              10      POP AF
001228 5228 C9              10      RET
       5229                     MSG_BR:
001229 5229 F5              11      PUSH    AF
00122A 522A 3ADDF3          13      LD  A,(CSRX)
00122D 522D FE02             7      CP  2
00122F 522F 38F6            12      JR  C,MSGA2
001231 5231 F1              10      POP AF
       5232                     MSG_CR:
001232 5232 F5              11      PUSH    AF
001233 5233 3E0D             7      LD  A,00DH
001235 5235 CD1552          17      CALL    MSGA1
001238 5238 3E0A             7      LD  A,00AH
00123A 523A CD1552          17      CALL    MSGA1
00123D 523D F1              10      POP AF
00123E 523E C9              10      RET
                                
       523F                     _SYS02:     ;(BDOS)コンソール出力
00123F 523F CD5A52          17      CALL    BREAK
001242 5242 1805            12      JR  PRINTX
                                
       5244                     _SYS06:     ;(BDOS)コンソール直接入出力
001244 5244 7B               4      LD  A,E
001245 5245 3C               4      INC A
001246 5246 CA9952          10      JP  Z,_INKEY
       5249                     PRINTX:
001249 5249 C30B52          10      JP  _PRINT
                                
       524C                     _SYS08:     ;(BDOS)エコーなしコンソール入力
00124C 524C CD8552          17      CALL    _SYS07
00124F 524F FE03             7      CP  3
001251 5251 CC5A52          17      CALL    Z,_BREAK
001254 5254 FE13             7      CP  013H        ;CTRL+S
001256 5256 C0              11      RET NZ
       5257                     PAUSE:
001257 5257 CD7152          17      CALL    KEYBC
                                
       525A                     _BREAK:
       525A                     BREAK:
00125A 525A F5              11      PUSH    AF
00125B 525B C5              11      PUSH    BC
00125C 525C D5              11      PUSH    DE
00125D 525D E5              11      PUSH    HL
00125E 525E DDE5            15      PUSH    IX
001260 5260 DD21B700        14      LD  IX,BREAKX
001264 5264 CDD442          17      CALL    CALSLT_R
001267 5267 DDE1            14      POP IX
001269 5269 E1              10      POP HL
00126A 526A D1              10      POP DE
00126B 526B C1              10      POP BC
00126C 526C DC5A52          17      CALL    C,_BREAK
00126F 526F F1              10      POP AF
001270 5270 C9              10      RET
       5271                     KEYBC:
001271 5271 F5              11      PUSH    AF
001272 5272 C5              11      PUSH    BC
001273 5273 D5              11      PUSH    DE
001274 5274 E5              11      PUSH    HL
001275 5275 DDE5            15      PUSH    IX
001277 5277 DD215601        14      LD  IX,KILBUF
00127B 527B CDD442          17      CALL    CALSLT_R
00127E 527E DDE1            14      POP IX
001280 5280 E1              10      POP HL
001281 5281 D1              10      POP DE
001282 5282 C1              10      POP BC
001283 5283 F1              10      POP AF
001284 5284 C9              10      RET
                                
       5285                     _SYS07:
       5285                     FLGET:
001285 5285 C5              11      PUSH    BC
001286 5286 D5              11      PUSH    DE
001287 5287 E5              11      PUSH    HL
001288 5288 DDE5            15      PUSH    IX
00128A 528A DD219F00        14      LD  IX,CHGET
00128E 528E CDD442          17      CALL    CALSLT_R
001291 5291 DDE1            14      POP IX
001293 5293 E1              10      POP HL
001294 5294 D1              10      POP DE
001295 5295 C1              10      POP BC
001296 5296 FE03             7      CP  3
001298 5298 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5299                     _INKEY:
       5299                     INKEY:
001299 5299 CD3353          17      CALL    CPM_CONST
00129C 529C C8              11      RET Z
00129D 529D 18E6            12      JR  FLGET
                                
       529F                     _SYS0A:     ;(BDOS)文字列入力
00129F 529F C5              11      PUSH    BC
0012A0 52A0 E5              11      PUSH    HL
0012A1 52A1 D5              11      PUSH    DE
0012A2 52A2 CDCB52          17      CALL    GETL
0012A5 52A5 111FF4          10      LD  DE,KBUF
0012A8 52A8 E1              10      POP HL
0012A9 52A9 E5              11      PUSH    HL
0012AA 52AA 0E00             7      LD  C,0
0012AC 52AC 3004            12      JR  NC,SAX0
0012AE 52AE 23               6      INC HL
0012AF 52AF 23               6      INC HL
0012B0 52B0 1808            12      JR  SAX4
       52B2                     SAX0:
0012B2 52B2 46               7      LD  B,(HL)
0012B3 52B3 23               6      INC HL
       52B4                     SAX1:
0012B4 52B4 23               6      INC HL
0012B5 52B5 1A               7      LD  A,(DE)
0012B6 52B6 13               6      INC DE
0012B7 52B7 B7               4      OR  A
0012B8 52B8 2004            12      JR  NZ,SAX2
       52BA                     SAX4:
0012BA 52BA 360D            10      LD  (HL),00DH
0012BC 52BC 1804            12      JR  SAX3
       52BE                     SAX2:
0012BE 52BE 77               7      LD  (HL),A
0012BF 52BF 0C               4      INC C
0012C0 52C0 10F2            13      DJNZ    SAX1
       52C2                     SAX3:
0012C2 52C2 D1              10      POP DE
0012C3 52C3 79               4      LD  A,C
0012C4 52C4 13               6      INC DE
0012C5 52C5 12               7      LD  (DE),A
0012C6 52C6 1B               6      DEC DE
0012C7 52C7 E1              10      POP HL
0012C8 52C8 C1              10      POP BC
0012C9 52C9 A7               4      AND A
0012CA 52CA C9              10      RET
       52CB                     GETL:
0012CB 52CB DDE5            15      PUSH    IX
0012CD 52CD FDE5            15      PUSH    IY
                                
0012CF 52CF 2ADCF3          16      LD  HL,(CSRY)
0012D2 52D2 22CAFB          16      LD  (FSTPOS),HL
       52D5                     GETL1:
0012D5 52D5 CD4C52          17      CALL    _SYS08
0012D8 52D8 FE09             7      CP  9
0012DA 52DA 2008            12      JR  NZ,GETL1V
0012DC 52DC 211FF4          10      LD  HL,KBUF
0012DF 52DF CD5E43          17      CALL    MSX
0012E2 52E2 18F1            12      JR  GETL1
       52E4                     GETL1V:
0012E4 52E4 5F               4      LD  E,A
0012E5 52E5 FE08             7      CP  8
0012E7 52E7 CC8153          17      CALL    Z,CTRL02
0012EA 52EA FE20             7      CP  020H
0012EC 52EC D4AD53          17      CALL    NC,INSERT
0012EF 52EF CD1552          17      CALL    MSGA1
                                
0012F2 52F2 7B               4      LD  A,E
0012F3 52F3 FE0D             7      CP  00DH
0012F5 52F5 20DE            12      JR  NZ,GETL1
                                
0012F7 52F7 111FF4          10      LD  DE,KBUF
0012FA 52FA 3AB0F3          13      LD  A,(LINLEN)
0012FD 52FD 47               4      LD  B,A
0012FE 52FE CD8F55          17      CALL    ZERO_MEMORY_DE
                                
001301 5301 2ACAFB          16      LD  HL,(FSTPOS)
001304 5304 3ADCF3          13      LD  A,(CSRY)
001307 5307 6F               4      LD  L,A
001308 5308 E5              11      PUSH    HL
001309 5309 CDDE53          17      CALL    LOC0
00130C 530C 4D               4      LD  C,L
00130D 530D 44               4      LD  B,H
00130E 530E E1              10      POP HL
00130F 530F 3AB0F3          13      LD  A,(LINLEN)
001312 5312 94               4      SUB H
001313 5313 3D               4      DEC A
001314 5314 5F               4      LD  E,A
001315 5315 211FF4          10      LD  HL,KBUF
       5318                     GETL2:
001318 5318 CD7153          17      CALL    _SCRN
00131B 531B 03               6      INC BC
00131C 531C 77               7      LD  (HL),A
00131D 531D 23               6      INC HL
00131E 531E 1D               4      DEC E
00131F 531F 20F7            12      JR  NZ,GETL2
001321 5321 CD3252          17      CALL    MSG_CR
                                
001324 5324 FDE1            14      POP IY
001326 5326 DDE1            14      POP IX
       5328                     GETL3:
001328 5328 2B               6      DEC HL
001329 5329 7E               7      LD  A,(HL)
00132A 532A FE21             7      CP  021H
00132C 532C D0              11      RET NC
00132D 532D 3600            10      LD  (HL),0
00132F 532F 15               4      DEC D
001330 5330 20F6            12      JR  NZ,GETL3
001332 5332 C9              10      RET
                                
       5333                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       5333                     CONSTX:
       5333                     CPM_CONST:
001333 5333 C5              11      PUSH    BC
001334 5334 D5              11      PUSH    DE
001335 5335 E5              11      PUSH    HL
001336 5336 DDE5            15      PUSH    IX
001338 5338 DD219C00        14      LD  IX,CHSNS
00133C 533C CDD442          17      CALL    CALSLT_R
00133F 533F DDE1            14      POP IX
001341 5341 E1              10      POP HL
001342 5342 D1              10      POP DE
001343 5343 C1              10      POP BC
001344 5344 C9              10      RET
                                
       5345                     _SYS2A:     ;(BDOS)日付の獲得
001345 5345 AF               4      XOR A
001346 5346 57               4      LD  D,A
001347 5347 5F               4      LD  E,A
001348 5348 67               4      LD  H,A
001349 5349 6F               4      LD  L,A
00134A 534A C9              10      RET
                                
       534B                     _SYS2C:     ;(BDOS)時刻の獲得
00134B 534B AF               4      XOR A
00134C 534C 57               4      LD  D,A
00134D 534D 5F               4      LD  E,A
00134E 534E 67               4      LD  H,A
00134F 534F 6F               4      LD  L,A
001350 5350 C9              10      RET
                                
       5351                     POS:
001351 5351 F5              11      PUSH    AF
001352 5352 2ADCF3          16      LD  HL,(CSRY)
001355 5355 7D               4      LD  A,L
001356 5356 6C               4      LD  L,H
001357 5357 67               4      LD  H,A
001358 5358 2C               4      INC L
001359 5359 24               4      INC H
00135A 535A F1              10      POP AF
00135B 535B C9              10      RET
                                
       535C                     LOC:
00135C 535C F5              11      PUSH    AF
00135D 535D E5              11      PUSH    HL
00135E 535E 7D               4      LD  A,L
00135F 535F 6C               4      LD  L,H
001360 5360 67               4      LD  H,A
001361 5361 2D               4      DEC L
001362 5362 25               4      DEC H
001363 5363 DDE5            15      PUSH    IX
001365 5365 DD21C600        14      LD  IX,POSIT
001369 5369 CDD442          17      CALL    CALSLT_R
00136C 536C DDE1            14      POP IX
00136E 536E E1              10      POP HL
00136F 536F F1              10      POP AF
001370 5370 C9              10      RET
                                
       5371                     _SCRN:
       5371                     SCRN:
001371 5371 E5              11      PUSH    HL
001372 5372 DDE5            15      PUSH    IX
                                
001374 5374 69               4      LD  L,C
001375 5375 60               4      LD  H,B
001376 5376 DD214A00        14      LD  IX,RDVRM
00137A 537A CDD442          17      CALL    CALSLT_R
                                
00137D 537D DDE1            14      POP IX
00137F 537F E1              10      POP HL
001380 5380 C9              10      RET
                                
       5381                     CTRL02:
001381 5381 F5              11      PUSH    AF
001382 5382 D5              11      PUSH    DE
001383 5383 2ADCF3          16      LD  HL,(CSRY)
001386 5386 3AB0F3          13      LD  A,(LINLEN)
001389 5389 4F               4      LD  C,A
00138A 538A 94               4      SUB H   ;CSRX
00138B 538B C602             7      ADD A,2
00138D 538D 47               4      LD  B,A ;カーソルより右の文字数
00138E 538E 61               4      LD  H,C ;LINLEN
00138F 538F C5              11      PUSH    BC
001390 5390 CDDE53          17      CALL    LOC0
001393 5393 C1              10      POP BC
                                
001394 5394 1620             7      LD  D,020H
       5396                     C8X1:
001396 5396 DD214A00        14      LD  IX,RDVRM
00139A 539A CDD442          17      CALL    CALSLT_R
00139D 539D 4F               4      LD  C,A
00139E 539E 7A               4      LD  A,D
00139F 539F DD214D00        14      LD  IX,WRTVRM
0013A3 53A3 CDD442          17      CALL    CALSLT_R
0013A6 53A6 2B               6      DEC HL
0013A7 53A7 51               4      LD  D,C
0013A8 53A8 10EC            13      DJNZ    C8X1
0013AA 53AA D1              10      POP DE
0013AB 53AB F1              10      POP AF
0013AC 53AC C9              10      RET
                                
       53AD                     INSERT:
0013AD 53AD F5              11      PUSH    AF
0013AE 53AE D5              11      PUSH    DE
0013AF 53AF 2ADCF3          16      LD  HL,(CSRY)
0013B2 53B2 3AB0F3          13      LD  A,(LINLEN)
0013B5 53B5 4F               4      LD  C,A
0013B6 53B6 94               4      SUB H   ;CSRX
0013B7 53B7 3C               4      INC A
0013B8 53B8 47               4      LD  B,A ;カーソルより右の文字数
0013B9 53B9 C5              11      PUSH    BC
0013BA 53BA CDDE53          17      CALL    LOC0
0013BD 53BD C1              10      POP BC
                                
0013BE 53BE 1620             7      LD  D,020H
       53C0                     INS1:
0013C0 53C0 DD214A00        14      LD  IX,RDVRM
0013C4 53C4 CDD442          17      CALL    CALSLT_R
0013C7 53C7 4F               4      LD  C,A
0013C8 53C8 7A               4      LD  A,D
0013C9 53C9 DD214D00        14      LD  IX,WRTVRM
0013CD 53CD CDD442          17      CALL    CALSLT_R
0013D0 53D0 23               6      INC HL
0013D1 53D1 51               4      LD  D,C
0013D2 53D2 10EC            13      DJNZ    INS1
0013D4 53D4 D1              10      POP DE
0013D5 53D5 F1              10      POP AF
0013D6 53D6 C9              10      RET
                                
       53D7                     CONOUT1:
0013D7 53D7 59               4      LD  E,C
0013D8 53D8 C30B52          10      JP  _PRINT
                                
       53DB                     GETVRAM:
0013DB 53DB 2ADCF3          16      LD  HL,(CSRY)
       53DE                     LOC0:
0013DE 53DE 2D               4      DEC L
0013DF 53DF 25               4      DEC H
0013E0 53E0 4C               4      LD  C,H ;CSRX-1
0013E1 53E1 5D               4      LD  E,L ;CSRY-1
       53E2                     LOC1:
0013E2 53E2 3AB0F3          13      LD  A,(LINLEN)
0013E5 53E5 67               4      LD  H,A
0013E6 53E6 1600             7      LD  D,0
0013E8 53E8 6A               4      LD  L,D ;0
0013E9 53E9 0608             7      LD  B,8
       53EB                     LOC2:
0013EB 53EB 29              11      ADD HL,HL
0013EC 53EC 3001            12      JR  NC,LOC3
0013EE 53EE 19              11      ADD HL,DE
       53EF                     LOC3:
0013EF 53EF 10FA            13      DJNZ    LOC2
0013F1 53F1 09              11      ADD HL,BC
0013F2 53F2 C9              10      RET
                                
       53F3                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0013F3 53F3 212200          10      LD  HL,00022H
0013F6 53F6 AF               4      XOR A
0013F7 53F7 7D               4      LD  A,L
0013F8 53F8 C9              10      RET
                                
       53F9                     _SYS0D:     ;(BDOS)ディスク・リセット
0013F9 53F9 218000          10      LD  HL,00080H
0013FC 53FC 22C7F2          16      LD  (_DTA),HL
0013FF 53FF C9              10      RET
                                
       5400                     _SYS0E:     ;(BDOS)カレントドライブの設定
001400 5400 7B               4      LD  A,E
001401 5401 FE02             7      CP  2
001403 5403 D0              11      RET NC
001404 5404 32DDF2          13      LD  (_DVSW),A
001407 5407 C9              10      RET
                                
       5408                     _SYS0F:     ;(BDOS)ファイルのオープン
001408 5408 D5              11      PUSH    DE
001409 5409 FDE1            14      POP IY
00140B 540B CD7655          17      CALL    INIT_FILE
00140E 540E CDA94B          17      CALL    ROM_OPEN
001411 5411 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001413 5413 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
001417 5417 FDE5            15      PUSH    IY
001419 5419 D1              10      POP DE
00141A 541A 13               6      INC DE
00141B 541B 010B00          10      LD  BC,11
00141E 541E EDB0                    LDIR
                                ;               Attribute
001420 5420 7E               7      LD  A,(HL)
001421 5421 FD770D          19      LD  (IY+13),A
                                ;               TIME
001424 5424 110B00          10      LD  DE,11
001427 5427 19              11      ADD HL,DE
001428 5428 7E               7      LD  A,(HL)
001429 5429 23               6      INC HL
00142A 542A FD7716          19      LD  (IY+22),A
00142D 542D 7E               7      LD  A,(HL)
00142E 542E 23               6      INC HL
00142F 542F FD7717          19      LD  (IY+23),A
                                ;               DATE
001432 5432 7E               7      LD  A,(HL)
001433 5433 23               6      INC HL
001434 5434 FD7714          19      LD  (IY+20),A
001437 5437 7E               7      LD  A,(HL)
001438 5438 23               6      INC HL
001439 5439 FD7715          19      LD  (IY+21),A
                                ;               First cluster
00143C 543C 7E               7      LD  A,(HL)
00143D 543D 23               6      INC HL
00143E 543E FD771A          19      LD  (IY+26),A
001441 5441 7E               7      LD  A,(HL)
001442 5442 23               6      INC HL
001443 5443 FD771B          19      LD  (IY+27),A
                                ;               SIZE
001446 5446 7E               7      LD  A,(HL)
001447 5447 23               6      INC HL
001448 5448 FD7710          19      LD  (IY+16),A
00144B 544B 7E               7      LD  A,(HL)
00144C 544C 23               6      INC HL
00144D 544D FD7711          19      LD  (IY+17),A
001450 5450 7E               7      LD  A,(HL)
001451 5451 23               6      INC HL
001452 5452 FD7712          19      LD  (IY+18),A
001455 5455 7E               7      LD  A,(HL)
001456 5456 FD7713          19      LD  (IY+19),A
001459 5459 AF               4      XOR A
00145A 545A FD770C          19      LD  (IY+12),A
00145D 545D C9              10      RET
                                
       545E                     _SYS10:     ;(BDOS)ファイルのクローズ
00145E 545E AF               4      XOR A
00145F 545F C9              10      RET
                                
       5460                     S11X1:
001460 5460 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001463 5463 FD750E          19      LD  (IY+14),L
001466 5466 FD740F          19      LD  (IY+15),H
       5469                     SCF_FF_RET:
001469 5469 37               4      SCF
00146A 546A 9F               4      SBC A,A
00146B 546B C9              10      RET
                                
       546C                     _SYS11:     ;(BDOS)最初のファイルの検索
00146C 546C ED53CAF2        20      LD  (_FCB),DE
001470 5470 D5              11      PUSH    DE
001471 5471 FDE1            14      POP IY
001473 5473 CD7655          17      CALL    INIT_FILE
001476 5476 CD074E          17      CALL    GET_DIR_DAT
       5479                     S12X1:
001479 5479 CDC54B          17      CALL    FILESE
00147C 547C 30E2            12      JR  NC,S11X1
00147E 547E 0D               4      DEC C
00147F 547F FD7119          19      LD  (IY+25),C       ;RootEntCnt
001482 5482 FDCB0D66        20      BIT 4,(IY+13)
001486 5486 2809            12      JR  Z,S12X2
001488 5488 E5              11      PUSH    HL
001489 5489 DDE1            14      POP IX
00148B 548B DDCB0E66        20      BIT 4,(IX+1+13)
00148F 548F 28E8            12      JR  Z,S12X1
       5491                     S12X2:
001491 5491 012000          10      LD  BC,32
001494 5494 ED5BC7F2        20      LD  DE,(_DTA)
001498 5498 AF               4      XOR A
001499 5499 12               7      LD  (DE),A      ;ドライブ番号
00149A 549A 13               6      INC DE
00149B 549B EDB0                    LDIR            ;ディレクトリエントリ
00149D 549D FD750E          19      LD  (IY+14),L
0014A0 54A0 FD740F          19      LD  (IY+15),H
0014A3 54A3 C9              10      RET
                                
       54A4                     _SYS12:
0014A4 54A4 FD2ACAF2        20      LD  IY,(_FCB)
0014A8 54A8 FDE5            15      PUSH    IY
0014AA 54AA D1              10      POP DE
0014AB 54AB CD7655          17      CALL    INIT_FILE
                                
0014AE 54AE FD6E0E          19      LD  L,(IY+14)
0014B1 54B1 FD660F          19      LD  H,(IY+15)
0014B4 54B4 FD4E19          19      LD  C,(IY+25)
0014B7 54B7 18C0            12      JR  S12X1
                                
       54B9                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0014B9 54B9 CDED4D          17      CALL    SET_FCB
0014BC 54BC CDBB4D          17      CALL    GETSEQ
0014BF 54BF CDA84D          17      CALL    RB_READ
0014C2 54C2 E5              11      PUSH    HL
0014C3 54C3 CDC84D          17      CALL    SETSEQ
0014C6 54C6 E1              10      POP HL
       54C7                     SREAD:
0014C7 54C7 C601             7      ADD A,001H
0014C9 54C9 D8              11      RET C
                                
0014CA 54CA 7D               4      LD  A,L
0014CB 54CB D601             7      SUB 001H
0014CD 54CD 9F               4      SBC A,A
0014CE 54CE E603             7      AND 3
0014D0 54D0 1F               4      RRA
0014D1 54D1 C9              10      RET
                                
       54D2                     _SYS18:     ;(BDOS)ログインベクトルの獲得
0014D2 54D2 210100          10      LD  HL,00001H
0014D5 54D5 AF               4      XOR A
0014D6 54D6 C9              10      RET
                                
       54D7                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
0014D7 54D7 3ADDF2          13      LD  A,(_DVSW)
0014DA 54DA C9              10      RET
                                
       54DB                     _SYS1A:     ;(BDOS)DTAの設定
0014DB 54DB ED53C7F2        20      LD  (_DTA),DE
0014DF 54DF AF               4      XOR A
0014E0 54E0 C9              10      RET
                                
       54E1                     _SYS1B:     ;(BDOS)ディスク情報の獲得
0014E1 54E1 010002          10      LD  BC,512
0014E4 54E4 11C302          10      LD  DE,707
0014E7 54E7 210000          10      LD  HL,0
0014EA 54EA DD21CCF2        14      LD  IX,_BUF
0014EE 54EE FD21CCF2        14      LD  IY,_BUF
0014F2 54F2 FD3600F9        19      LD  (IY+0),0F9H
0014F6 54F6 3E02             7      LD  A,2
0014F8 54F8 C9              10      RET
                                
       54F9                     _SYS21:     ;(BDOS)ランダムな読み出し
0014F9 54F9 CDED4D          17      CALL    SET_FCB
                                
0014FC 54FC FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0014FF 54FF FD6622          19      LD  H,(IY+34)
                                
001502 5502 CDA84D          17      CALL    RB_READ
001505 5505 18C0            12      JR  SREAD
                                
       5507                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001507 5507 CD0854          17      CALL    _SYS0F
00150A 550A D8              11      RET C
                                
00150B 550B D5              11      PUSH    DE      ;EX DE,IY
00150C 550C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00150E 550E CDDD4D          17      CALL    GETSIZE
       5511                     _S24X1:
001511 5511 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001514 5514 FD7422          19      LD  (IY+34),H
001517 5517 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00151B 551B FDE3            23      EX  (SP),IY     ;
00151D 551D D1              10      POP DE      ;
                                
00151E 551E AF               4      XOR A
00151F 551F C9              10      RET
                                
       5520                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001520 5520 E5              11      PUSH    HL
001521 5521 D5              11      PUSH    DE      ;EX DE,IY
001522 5522 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001524 5524 CDBB4D          17      CALL    GETSEQ
001527 5527 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5529                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001529 5529 CDED4D          17      CALL    SET_FCB
00152C 552C E5              11      PUSH    HL
00152D 552D FD6E21          19      LD  L,(IY+33)
001530 5530 FD6622          19      LD  H,(IY+34)
001533 5533 22BDF2          16      LD  (RR_LOW),HL
001536 5536 FD6E23          19      LD  L,(IY+35)
001539 5539 FD6624          19      LD  H,(IY+36)
00153C 553C 22BFF2          16      LD  (RR_HIGH),HL
00153F 553F E1              10      POP HL
001540 5540 CD8949          17      CALL    ROM_READ
001543 5543 ED5BBDF2        20      LD  DE,(RR_LOW)
001547 5547 FD7321          19      LD  (IY+33),E
00154A 554A FD7222          19      LD  (IY+34),D
00154D 554D ED5BBFF2        20      LD  DE,(RR_HIGH)
001551 5551 FD7323          19      LD  (IY+35),E
001554 5554 FD7224          19      LD  (IY+36),D
001557 5557 9F               4      SBC A,A
001558 5558 C9              10      RET
                                
       5559                     _SYS2F:
001559 5559 44               4      LD  B,H
00155A 555A 2AC7F2          16      LD  HL,(_DTA)
00155D 555D C3D44F          10      JP  DISKIO
                                
       5560                     _SYS5A:
001560 5560 0600             7      LD  B,0
001562 5562 D5              11      PUSH    DE
001563 5563 DDE1            14      POP IX
       5565                     _SX5A1:
001565 5565 1A               7      LD  A,(DE)
001566 5566 B7               4      OR  A
001567 5567 2804            12      JR  Z,_SX5A2
001569 5569 13               6      INC DE
00156A 556A 04               4      INC B
00156B 556B 18F8            12      JR  _SX5A1
                                
       556D                     _SX5A2:
00156D 556D 78               4      LD  A,B
00156E 556E CD544A          17      CALL    FILE_BDOS
001571 5571 CD914E          17      CALL    ROM_CD
001574 5574 9F               4      SBC A,A
001575 5575 C9              10      RET
                                
       5576                     INIT_FILE:
001576 5576 EB               4      EX  DE,HL
001577 5577 11EBF2          10      LD  DE,FDRV
00157A 557A 010C00          10      LD  BC,1+8+3
       557D                     INIT_FILE1:
00157D 557D EDB0                    LDIR
00157F 557F CD9C51          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
001582 5582 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001585 5585 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001588 5588 2ADEF2          16      LD  HL,(_CD)
00158B 558B 22E9F2          16      LD  (_CDX),HL           ;カレントディレクトリ
00158E 558E C9              10      RET
                                
       558F                     ZERO_MEMORY_DE:
00158F 558F AF               4      XOR A
       5590                     FILL_MEMORY_DE:
001590 5590 12               7      LD  (DE),A
001591 5591 13               6      INC DE
001592 5592 10FC            13      DJNZ    FILL_MEMORY_DE
001594 5594 C9              10      RET
                                
001595 5595                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 F8510E523F52F851        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 F851F85144528552        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 4C52F8519F523353        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 F353F95300540854        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 5E546C54A454F851        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 B954F851F851F851        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 D254D754DB54E154        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 F851F851F8510755        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 2055F851F8512955        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 F851F8514553F851        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 4B53F851F8515955        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 F851F8516055F851        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 F851F851F851F851        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
