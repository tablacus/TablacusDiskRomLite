                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 F24D                    DW  STATEMENT  ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3664E          10      JP  DISKIO
000013 4013 C3A14E          10      JP  DSKCHG
000016 4016 C3F74E          10      JP  GETDPB
000019 4019 C3EA4F          10      JP  CHOICE
00001C 401C C3EE4F          10      JP  DSKFMT
00001F 401F C3F04F          10      JP  DSKSTP
000022 4022 C3F14F          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3EE4F          10      JP  DSKFMT
000029 4029 C3F04F          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3F84F          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.0",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3000    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2260F1          16      LD  (BASSTK),HL
000129 4129 ED7B60F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210743          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017D00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4742          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DBFE          13      LD  (H_STKE+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 214045          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 216F46          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 217C46          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 214550          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AE43          10      LD  HL,ROM_STKE
0001BC 41BC 22DCFE          16      LD  (H_STKE+2),HL
0001BF 41BF 21664E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DEFE          13      LD  (H_STKE+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001E5 41E5 204F            12      JR  NZ,NOT_BANK_TYPE
0001E7 41E7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001EA 41EA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001ED 41ED CD3801          17      CALL    RSLREG      ;read primary slot #
0001F0 41F0 07               4      RLCA
0001F1 41F1 07               4      RLCA
0001F2 41F2 F5              11      PUSH    AF
0001F3 41F3 1605             7      LD  D,4+1
0001F5 41F5 CD4E42          17      CALL    GTSL2_
0001F8 41F8 3244F3          13      LD  (RAMAD3),A
0001FB 41FB F1              10      POP AF
0001FC 41FC 07               4      RLCA
0001FD 41FD 07               4      RLCA
0001FE 41FE 1603             7      LD  D,2+1
000200 4200 CD4E42          17      CALL    GTSL2_
000203 4203 2680             7      LD  H,080H
000205 4205 CD6B42          17      CALL    CHK_RAM
000208 4208 3243F3          13      LD  (RAMAD2),A
       420B                     RAMCHK2:
00020B 420B 3A44F3          13      LD  A,(RAMAD3)
00020E 420E 2640             7      LD  H,040H
000210 4210 CD6B42          17      CALL    CHK_RAM
000213 4213 3242F3          13      LD  (RAMAD1),A
       4216                     RAMCHK1:
000216 4216 3A44F3          13      LD  A,(RAMAD3)
000219 4219 2600             7      LD  H,00H
00021B 421B CD6B42          17      CALL    CHK_RAM
00021E 421E 3241F3          13      LD  (RAMAD0),A
       4221                     RAMCHK0:
000221 4221 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000224 4224 010F00          10      LD  BC,0000FH       ;切り上げ
000227 4227 09              11      ADD HL,BC
000228 4228 7D               4      LD  A,L
                                
000229 4229 0604             7      LD  B,4
       422B                     B_DRIVE1:
00022B 422B CB3C             8      SRL H
00022D 422D 1F               4      RRA
00022E 422E 10FB            13      DJNZ    B_DRIVE1
                                
000230 4230 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000232 4232 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000235 4235 C9              10      RET
                                
       4236                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000236 4236 21FC43          10      LD  HL,MSG_ERROR_ROM_MODE
000239 4239 CD8743          17      CALL    MSX
00023C 423C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000240 4240 DD219F00        14      LD  IX,CHGET
000244 4244 C31C00          10      JP  _CALSLT
                                
       4247                     GTSL1_:             ;自分のいるスロットを知る
000247 4247 CD3801          17      CALL    RSLREG      ;read primary slot #
00024A 424A 0F               4      RRCA
00024B 424B 0F               4      RRCA
00024C 424C 1601             7      LD  D,1
       424E                     GTSL2_:
00024E 424E E603             7      AND 3       ;[A]=000000PP
000250 4250 5F               4      LD  E,A     ;[E]=000000PP
000251 4251 21C1FC          10      LD  HL,EXPTBL
000254 4254 85               4      ADD A,L     ;桁上りは無い
000255 4255 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000256 4256 7B               4      LD  A,E     ;[A]=000000PP
000257 4257 CB7E            13      BIT 7,(HL)
000259 4259 C8              11      RET Z
00025A 425A 7D               4      LD  A,L     ;point to SLTTBL entry
00025B 425B C604             7      ADD A,4     ;桁上りは無い
00025D 425D 6F               4      LD  L,A
00025E 425E 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425F                     GTSL3_:
00025F 425F 15               4      DEC D
000260 4260 2803            12      JR  Z,GTSL4_:
000262 4262 0F               4      RRCA
000263 4263 18FA            12      JR  GTSL3_:
       4265                     GTSL4_:
000265 4265 E60C             7      AND 00CH        ;[A] = 0000SS00
000267 4267 B3               4      OR  E       ;[A] = 0000SSPP
000268 4268 F680             7      OR  080H        ;[A] = 1000SSPP
00026A 426A C9              10      RET
                                
       426B                     CHK_RAM:
00026B 426B E5              11      PUSH    HL
00026C 426C CDC042          17      CALL    CHK_RAM0
00026F 426F E1              10      POP HL
000270 4270 C8              11      RET Z
000271 4271 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000274 4274 E680             7      AND 080H
000276 4276 CD9742          17      CALL    CHK_RAM_SLT
000279 4279 C8              11      RET Z
00027A 427A 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027D 427D E680             7      AND 080H
00027F 427F C601             7      ADD A,1
000281 4281 CD9742          17      CALL    CHK_RAM_SLT
000284 4284 C8              11      RET Z
000285 4285 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000288 4288 E680             7      AND 080H
00028A 428A C602             7      ADD A,2
00028C 428C CD9742          17      CALL    CHK_RAM_SLT
00028F 428F C8              11      RET Z
000290 4290 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000293 4293 E680             7      AND 080H
000295 4295 C603             7      ADD A,3
       4297                     CHK_RAM_SLT:
000297 4297 E5              11      PUSH    HL
000298 4298 CDC042          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029B 429B E1              10      POP HL
00029C 429C C8              11      RET Z
00029D 429D CB79             8      BIT 7,C
00029F 429F 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A1 42A1 79               4      LD  A,C
0002A2 42A2 C604             7      ADD A,4*1           ;スロット#X-1
0002A4 42A4 E5              11      PUSH    HL
0002A5 42A5 CDC042          17      CALL    CHK_RAM0
0002A8 42A8 E1              10      POP HL
0002A9 42A9 C8              11      RET Z
0002AA 42AA 79               4      LD  A,C
0002AB 42AB C608             7      ADD A,4*2           ;スロット#X-2
0002AD 42AD E5              11      PUSH    HL
0002AE 42AE CDC042          17      CALL    CHK_RAM0
0002B1 42B1 E1              10      POP HL
0002B2 42B2 C8              11      RET Z
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 C60C             7      ADD A,4*3           ;スロット#X-3
0002B6 42B6 E5              11      PUSH    HL
0002B7 42B7 CDC042          17      CALL    CHK_RAM0
0002BA 42BA E1              10      POP HL
       42BB                     CHK_RAM_E:
0002BB 42BB AF               4      XOR A
0002BC 42BC 3C               4      INC A           ;ZF=0にする
0002BD 42BD 3E00             7      LD  A,0
0002BF 42BF C9              10      RET
                                
       42C0                     CHK_RAM0:
0002C0 42C0 4F               4      LD  C,A
0002C1 42C1 3A00F1          13      LD  A,(ROM_SLT)
0002C4 42C4 B9               4      CP  C
0002C5 42C5 28F4            12      JR  Z,CHK_RAM_E
0002C7 42C7 2E00             7      LD  L,0
       42C9                     CHK_RAM1:
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDFB42          17      CALL    CALSLT_R
0002D1 42D1 C6E5             7      ADD A,0E5H
0002D3 42D3 47               4      LD  B,A
0002D4 42D4 5F               4      LD  E,A
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 DD211400        14      LD  IX,_WRSLT
0002DA 42DA CDFB42          17      CALL    CALSLT_R
0002DD 42DD 79               4      LD  A,C
0002DE 42DE DD210C00        14      LD  IX,_RDSLT
0002E2 42E2 CDFB42          17      CALL    CALSLT_R
0002E5 42E5 B8               4      CP  B
0002E6 42E6 C0              11      RET NZ
0002E7 42E7 D6E5             7      SUB 0E5H
0002E9 42E9 79               4      LD  A,C
0002EA 42EA 5F               4      LD  E,A
0002EB 42EB DD211400        14      LD  IX,_WRSLT
0002EF 42EF CDFB42          17      CALL    CALSLT_R
0002F2 42F2 24               4      INC H
0002F3 42F3 7D               4      LD  A,L
0002F4 42F4 C604             7      ADD A,4
0002F6 42F6 6F               4      LD  L,A
0002F7 42F7 20D0            12      JR  NZ,CHK_RAM1
0002F9 42F9 79               4      LD  A,C     ;ZF=1のハズ
0002FA 42FA C9              10      RET
                                
       42FB                     CALSLT_R:
0002FB 42FB C5              11      PUSH    BC
0002FC 42FC E5              11      PUSH    HL
0002FD 42FD FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000301 4301 CD1C00          17      CALL    _CALSLT
000304 4304 E1              10      POP HL
000305 4305 C1              10      POP BC
000306 4306 C9              10      RET
                                
       4307                     AT_ISC:
000307 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000307 F0E9 FEB7             7      CP  0B7H            ;FILES
000309 F0EB CC7BFE          17      CALL    Z,H_FILE
00030C F0EE FEB5             7      CP  0B5H            ;LOAD
00030E F0F0 CA71FE          10      JP  Z,H_BINS
000311 F0F3 FE8A             7      CP  08AH            ;RUN
000313 F0F5 CA76FE          10      JP  Z,H_BINL
000316 F0F8 FED6             7      CP  0D6H            ;COPY
000318 F0FA 2813            12      JR  Z,FIX_COPY
00031A F0FC FECF             7      CP  0CFH            ;BLOAD
00031C F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031D F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031E F100 00                      DB  0
00031F F101 A545                    DW  ROM_BLOAD
000321 F103 F5              11      PUSH    AF
000322 F104 E5              11      PUSH    HL
000323 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000326 F108 E1              10      POP HL
000327 F109 F1              10      POP AF
000328 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
00032A F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032C F10E C9              10      RET
       F10F                     FIX_COPY:
00032D F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032E F110 00                      DB  0
00032F F111 0247                    DW  ROM_COPY
000331 F113 C9              10      RET
       F114                     ROMUSE1:
000332 F114 3A00F1          13      LD  A,(ROM_SLT)
000335 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000337 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
00033A F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033D F11F 00                      DB  0
       F120                     _BANK:
00033E F120 00                      DB  0
       F121                     _BANK1:
00033F F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
000340 F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000342 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000344 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000346 F128 0000                    DW  0
       F12A                     _CLPS:
000348 F12A 0000                    DW  0
       F12C                     _LEFT:
00034A F12C 0000                    DW  0
       F12E                     _DTPS:
00034C F12E 0000                    DW  0
       F130                     _DTA:
00034E F130 0000                    DW  0
       F132                     FLG_LDIR:
000350 F132 00                      DB  0
       F133                     _FCB:
000351 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000353 F135 00                      DB  0
       F136                     _BUF_ST:
000354 F136 0000                    DW  0
       F138                     _BUF_EN:
000356 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000358 F13A 0000                    DW  0
       F13C                     _BUF_H:
00035A F13C 0000                    DW  0
       F13E                     _BUF_X:
00035C F13E 0000                    DW  0
       F140                     _BUF_Y:
00035E F140 00                      DB  0
       F141                     _BUF_P:
00035F F141 00                      DB  0
       F142                     _BUF_O:
000360 F142 00                      DB  0
       F143                     DTAX:
000361 F143 0000                    DW  0
       F145                     B_DRIVE:
000363 F145 00                      DB  0
       F146                     _DVSW:
000364 F146 00                      DB  0
       F147                     DIRENT1:
000365 F147 0000                    DW  0
       F149                     _DIR_BANK:
000367 F149 00                      DB  0
       F14A                     LEFTX:
000368 F14A 0000                    DW  0
       F14C                     PARAM0:
00036A F14C 0000                    DW  0
       F14E                     PARAM1:
00036C F14E 0000                    DW  0
       F150                     FDRV:
00036E F150 00                      DB  0
       F151                     FNAME:
00036F F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
00037A F15C 0000                    DW  0
       F15E                     _CDX:
00037C F15E 0000                    DW  0
       F160                     BASSTK:
00037E F160 0000                    DW  0
       F162                     _HL:
000380 F162 0000                    DW  0
       F164                     _SP:
000382 F164 0000                    DW  0
                                
       F166                     ISC_E:
000384 4384                         ORG $$+RUN          ;$DEPHASE
                                
       4384                     MSX1:
000384 4384 CD5E50          17      CALL    MSGA1
       4387                     MSX:
000387 4387 7E               7      LD  A,(HL)
000388 4388 23               6      INC HL
000389 4389 B7               4      OR  A
00038A 438A 20F8            12      JR  NZ,MSX1
00038C 438C C9              10      RET
                                
       438D                     PRTHX:
00038D 438D F5              11      PUSH    AF
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 07               4      RLCA
000391 4391 07               4      RLCA
000392 4392 CD9643          17      CALL    PRTA2
000395 4395 F1              10      POP AF
       4396                     PRTA2:
000396 4396 CD9C43          17      CALL    ASC
000399 4399 C35A50          10      JP  MSG_A
                                    
       439C                     ASC:
00039C 439C E60F             7      AND $0F
00039E 439E F630             7      OR  $30
0003A0 43A0 FE3A             7      CP  $3A
0003A2 43A2 D8              11      RET C
0003A3 43A3 C607             7      ADD A,7
0003A5 43A5 C9              10      RET
                                
       43A6                     MSN:
0003A6 43A6 7E               7      LD  A,(HL)
0003A7 43A7 23               6      INC HL
0003A8 43A8 CD5A50          17      CALL    MSG_A
0003AB 43AB 10F9            13      DJNZ    MSN
0003AD 43AD C9              10      RET
                                
       43AE                     ROM_STKE:
0003AE 43AE 3E                      DB  03EH
0003AF 43AF C9              10      RET
0003B0 43B0 32DAFE          13      LD  (H_STKE),A
0003B3 43B3 E5              11      PUSH    HL
0003B4 43B4 D5              11      PUSH    DE
0003B5 43B5 C5              11      PUSH    BC
0003B6 43B6 181D            12      JR  BASAUTO
                                
0003B8 43B8 AF               4      XOR A
0003B9 43B9 5F               4      LD  E,A
0003BA 43BA 57               4      LD  D,A
0003BB 43BB 0601             7      LD  B,1
0003BD 43BD 2100C0          10      LD  HL,0C000H
0003C0 43C0 CD664E          17      CALL    DISKIO
                                
0003C3 43C3 ED7360F1        20      LD  (BASSTK),SP
0003C7 43C7 116BF3          10      LD  DE,RAMUSE
0003CA 43CA AF               4      XOR A
0003CB 43CB CD1EC0          17      CALL    0C01EH
0003CE 43CE 116BF3          10      LD  DE,RAMUSE
0003D1 43D1 37               4      SCF
0003D2 43D2 CD1EC0          17      CALL    0C01EH
       43D5                     BASAUTO:
0003D5 43D5 212244          10      LD  HL,AUTOEXEC
0003D8 43D8 1150F1          10      LD  DE,FDRV
0003DB 43DB 010C00          10      LD  BC,1+8+3
0003DE 43DE EDB0                    LDIR
0003E0 43E0 CD384B          17      CALL    ROM_OPEN
0003E3 43E3 3813            12      JR  C,RSTKEE
0003E5 43E5 212E44          10      LD  HL,RUN_AUTOEXEC
0003E8 43E8 11F0FB          10      LD  DE,KEYBUF
0003EB 43EB ED53FAF3        20      LD  (GETPNT),DE
0003EF 43EF 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003F2 43F2 EDB0                    LDIR
0003F4 43F4 ED53F8F3        20      LD  (PUTPNT),DE
       43F8                     RSTKEE:
0003F8 43F8 C1              10      POP BC
0003F9 43F9 D1              10      POP DE
0003FA 43FA E1              10      POP HL
0003FB 43FB C9              10      RET
                                
       43FC                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003FC 43FC 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       4421                     NULL:
000421 4421 00                      DB  0
                                
       4422                     AUTOEXEC:
000422 4422 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       442E                     RUN_AUTOEXEC:
00042E 442E 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4441                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4441                     ROM_LDIR:
000441 4441 3A32F1          13      LD  A,(FLG_LDIR)
000444 4444 B7               4      OR  A
000445 4445 2008            12      JR  NZ,ROM_LDIRVM
000447 4447 CB7A             8      BIT 7,D
000449 4449 CA6144          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
00044C 444C EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                    EI
                                #endif
00044E 444E C9              10      RET
                                
       444F                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
00044F 444F C5              11      PUSH    BC
000450 4450 D5              11      PUSH    DE
000451 4451 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000455 4455 DD215C00        14      LD  IX,LDIRVM
000459 4459 CD1C00          17      CALL    _CALSLT
00045C 445C E1              10      POP HL
00045D 445D C1              10      POP BC
00045E 445E 09              11      ADD HL,BC
00045F 445F EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000460 4460 C9              10      RET
                                #endif
                                
       4461                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4461                     ROM_LDIRSLT1:
000461 4461 EB               4      EX  DE,HL
       4462                     RLDIRSLT1:
000462 4462 1A               7      LD  A,(DE)
000463 4463 13               6      INC DE
000464 4464 C5              11      PUSH    BC
000465 4465 D5              11      PUSH    DE
000466 4466 E5              11      PUSH    HL
000467 4467 5F               4      LD  E,A
                                
000468 4468 0141F3          10      LD  BC,RAMAD0
00046B 446B 7C               4      LD  A,H
00046C 446C 07               4      RLCA
00046D 446D 07               4      RLCA
00046E 446E E603             7      AND 3
000470 4470 81               4      ADD A,C
000471 4471 4F               4      LD  C,A
000472 4472 0A               7      LD  A,(BC)
       4473                     RLDIRSLT2:
000473 4473 CD1400          17      CALL    _WRSLT
000476 4476 08               4      EX  AF,AF'
000477 4477 E1              10      POP HL
000478 4478 D1              10      POP DE
000479 4479 C1              10      POP BC
00047A 447A EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00047C 447C EA6244          10      JP  PE,RLDIRSLT1
00047F 447F EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000480 4480 C9              10      RET
                                #endif
                                
       4481                     END_OF_LINE:
000481 4481 215EF5          10      LD  HL,BUF
       4484                     EOL1:
000484 4484 7E               7      LD  A,(HL)
000485 4485 C8              11      RET Z
000486 4486 FE0D             7      CP  00DH
000488 4488 2807            12      JR  Z,EOLE
00048A 448A FE0A             7      CP  00AH
00048C 448C 2803            12      JR  Z,EOLE
00048E 448E 23               6      INC HL
00048F 448F 18F3            12      JR  EOL1
       4491                     EOLE:
000491 4491 3600            10      LD  (HL),0
000493 4493 23               6      INC HL
000494 4494 7E               7      LD  A,(HL)
000495 4495 FE0A             7      CP  00AH
000497 4497 C0              11      RET NZ
000498 4498 23               6      INC HL
000499 4499 C9              10      RET
                                
       449A                     ROM_LOAD_ASCII:
00049A 449A 210000          10      LD  HL,0
00049D 449D 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
0004A0 44A0 2A76F6          16      LD  HL,(TXTTAB)
0004A3 44A3 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
0004A6 44A6 215EF5          10      LD  HL,BUF
0004A9 44A9 2230F1          16      LD  (_DTA),HL
       44AC                     RLOAD_A1:
0004AC 44AC 2A36F1          16      LD  HL,(_BUF_ST)
0004AF 44AF 2226F1          16      LD  (RR_LOW),HL
0004B2 44B2 210201          10      LD  HL,258
0004B5 44B5 CD1D49          17      CALL    ROM_READ
0004B8 44B8 7C               4      LD  A,H
0004B9 44B9 B5               4      OR  L
0004BA 44BA 2877            12      JR  Z,RLOAD_AEND
0004BC 44BC 015EF5          10      LD  BC,BUF
0004BF 44BF 09              11      ADD HL,BC
0004C0 44C0 3600            10      LD  (HL),0
0004C2 44C2 CD8144          17      CALL    END_OF_LINE
0004C5 44C5 015EF5          10      LD  BC,BUF
0004C8 44C8 A7               4      AND A
0004C9 44C9 ED42            15      SBC HL,BC
0004CB 44CB 2810            12      JR  Z,RLOAD_A2
0004CD 44CD 4D               4      LD  C,L
0004CE 44CE 44               4      LD  B,H
0004CF 44CF ED5B36F1        20      LD  DE,(_BUF_ST)
0004D3 44D3 19              11      ADD HL,DE
0004D4 44D4 2236F1          16      LD  (_BUF_ST),HL
0004D7 44D7 3A5EF5          13      LD  A,(BUF)
0004DA 44DA B7               4      OR  A
0004DB 44DB 28CF            12      JR  Z,RLOAD_A1
       44DD                     RLOAD_A2:
0004DD 44DD 115EF5          10      LD  DE,BUF
0004E0 44E0 CDCF4A          17      CALL    SPCUTEX
0004E3 44E3 1A               7      LD  A,(DE)
0004E4 44E4 B7               4      OR  A
0004E5 44E5 284C            12      JR  Z,RLOAD_AEND
0004E7 44E7 CDE14A          17      CALL    GETNUM
0004EA 44EA 7C               4      LD  A,H
0004EB 44EB B5               4      OR  L
0004EC 44EC CA9245          10      JP  Z,ERROR_DIRECT_IN_FILE
0004EF 44EF DD2A38F1        20      LD  IX,(_BUF_EN)
0004F3 44F3 DD7502          19      LD  (IX+2),L
0004F6 44F6 DD7403          19      LD  (IX+3),H
                                
0004F9 44F9 CDC84A          17      CALL    SPCUT
0004FC 44FC EB               4      EX  DE,HL
0004FD 44FD DDE5            15      PUSH    IX
0004FF 44FF DD21B242        14      LD  IX,CRUNCH
000503 4503 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000507 4507 CD1C00          17      CALL    _CALSLT
00050A 450A DDE1            14      POP IX
00050C 450C EB               4      EX  DE,HL
00050D 450D 111FF4          10      LD  DE,KBUF
000510 4510 37               4      SCF
000511 4511 ED52            15      SBC HL,DE
000513 4513 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
000515 4515 387B            12      JR  C,ERROR_DIRECT_IN_FILE
000517 4517 4D               4      LD  C,L
000518 4518 44               4      LD  B,H
000519 4519 2A38F1          16      LD  HL,(_BUF_EN)
00051C 451C 110400          10      LD  DE,4
00051F 451F 19              11      ADD HL,DE
000520 4520 111FF4          10      LD  DE,KBUF
                                
000523 4523 EB               4      EX  DE,HL
000524 4524 EDB0                    LDIR
000526 4526 EB               4      EX  DE,HL
                                
000527 4527 DD7500          19      LD  (IX+0),L
00052A 452A DD7401          19      LD  (IX+1),H
00052D 452D 2238F1          16      LD  (_BUF_EN),HL
000530 4530 C3AC44          10      JP  RLOAD_A1
                                
       4533                     RLOAD_AEND:
000533 4533 2A38F1          16      LD  HL,(_BUF_EN)
000536 4536 AF               4      XOR A
000537 4537 77               7      LD  (HL),A
000538 4538 23               6      INC HL
000539 4539 77               7      LD  (HL),A
00053A 453A 23               6      INC HL
00053B 453B 2238F1          16      LD  (_BUF_EN),HL
00053E 453E 183B            12      JR  RLOAD_END1
                                
       4540                     ROM_LOAD:
000540 4540 CDCC46          17      CALL    INIT_PARAM
000543 4543 CDBD49          17      CALL    FILE_B
000546 4546 3A51F1          13      LD  A,(FNAME)
000549 4549 FE20             7      CP  020H
00054B 454B CAB849          10      JP  Z,ROM_ORG
                                
00054E 454E CD384B          17      CALL    ROM_OPEN
000551 4551 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000553 4553 2135F1          10      LD  HL,_BUF
000556 4556 2230F1          16      LD  (_DTA),HL
000559 4559 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
00055C 455C CD1D49          17      CALL    ROM_READ
00055F 455F 3A35F1          13      LD  A,(_BUF)
000562 4562 3C               4      INC A
000563 4563 C29A44          10      JP  NZ,ROM_LOAD_ASCII
000566 4566 2A76F6          16      LD  HL,(TXTTAB)
000569 4569 2230F1          16      LD  (_DTA),HL
00056C 456C EB               4      EX  DE,HL
00056D 456D 2100FF          10      LD  HL,-256
000570 4570 39              11      ADD HL,SP
000571 4571 ED52            15      SBC HL,DE
000573 4573 CD1D49          17      CALL    ROM_READ
000576 4576 ED5B30F1        20      LD  DE,(_DTA)
00057A 457A 19              11      ADD HL,DE
       457B                     RLOAD_END1:
00057B 457B 22C2F6          16      LD  (VARTAB),HL
00057E 457E 22C4F6          16      LD  (ARYTAB),HL
000581 4581 22C6F6          16      LD  (STREND),HL
                                
000584 4584 AF               4      XOR A
000585 4585 2138F1          10      LD  HL,_BUF+3
000588 4588 77               7      LD  (HL),A
000589 4589 2B               6      DEC HL
00058A 458A 77               7      LD  (HL),A
00058B 458B 2B               6      DEC HL
00058C 458C 77               7      LD  (HL),A
00058D 458D 2B               6      DEC HL
00058E 458E 3E8F             7      LD  A,08FH          ;REM
000590 4590 77               7      LD  (HL),A
000591 4591 C9              10      RET
                                
       4592                     ERROR_DIRECT_IN_FILE:
000592 4592 1E39             7      LD  E,57            ;Direct statement in file
000594 4594 01                      DB  1           ;LD BC,
       4595                     ERROR_FILE_NOT_OPEN:
000595 4595 1E3B             7      LD  E,59            ;File not OPEN
000597 4597 01                      DB  1           ;LD BC,
       4598                     ERROR_FILE_NOT_FOUND:
000598 4598 1E35             7      LD  E,53            ;File not found
       459A                     ERROR:
00059A 459A FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00059E 459E DD216F40        14      LD  IX,ERRHAND
0005A2 45A2 C31C00          10      JP  _CALSLT
                                
       45A5                     ROM_BLOAD:
0005A5 45A5 CDCC46          17      CALL    INIT_PARAM
0005A8 45A8 CDBD49          17      CALL    FILE_B
0005AB 45AB CD384B          17      CALL    ROM_OPEN
0005AE 45AE 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005B0 45B0 2135F1          10      LD  HL,_BUF
0005B3 45B3 2230F1          16      LD  (_DTA),HL
0005B6 45B6 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005B9 45B9 CD1D49          17      CALL    ROM_READ
0005BC 45BC 3A35F1          13      LD  A,(_BUF)
0005BF 45BF FEFE             7      CP  0FEH
0005C1 45C1 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0005C3 45C3 210EF1          10      LD  HL,BLOAD_RET
0005C6 45C6 2206F1          16      LD  (SWC_BLOAD),HL
                                
0005C9 45C9 2A4EF1          16      LD  HL,(PARAM1)
0005CC 45CC 7E               7      LD  A,(HL)
0005CD 45CD FE2C             7      CP  ','
0005CF 45CF 2048            12      JR  NZ,RBREAD_MEM
0005D1 45D1 23               6      INC HL
0005D2 45D2 7E               7      LD  A,(HL)
0005D3 45D3 CD224B          17      CALL    CAP
0005D6 45D6 32BEFC          13      LD  (RUNBNF),A
       45D9                     RBOS1:
0005D9 45D9 7E               7      LD  A,(HL)
0005DA 45DA 23               6      INC HL
0005DB 45DB B7               4      OR  A
0005DC 45DC 282F            12      JR  Z,RBREAD_OSE
0005DE 45DE FE3A             7      CP  ':'
0005E0 45E0 282B            12      JR  Z,RBREAD_OSE
0005E2 45E2 FE2C             7      CP  ','     ;次のパラメータを探す
0005E4 45E4 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005E6 45E6 224EF1          16      LD  (PARAM1),HL
0005E9 45E9 7E               7      LD  A,(HL)
0005EA 45EA B7               4      OR  A
0005EB 45EB 2820            12      JR  Z,RBREAD_OSE
0005ED 45ED DD21644C        14      LD  IX,FRMEVL
0005F1 45F1 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005F5 45F5 CD1C00          17      CALL    _CALSLT
0005F8 45F8 224EF1          16      LD  (PARAM1),HL
0005FB 45FB 3A63F6          13      LD  A,(VALTYP)
0005FE 45FE FE02             7      CP  2
000600 4600 200B            12      JR  NZ,RBREAD_OSE
000602 4602 2A36F1          16      LD  HL,(_BUF_ST)
000605 4605 ED5BF8F7        20      LD  DE,(DACDAT)
000609 4609 19              11      ADD HL,DE
00060A 460A 2236F1          16      LD  (_BUF_ST),HL
       460D                     RBREAD_OSE:
00060D 460D 3ABEFC          13      LD  A,(RUNBNF)
000610 4610 FE53             7      CP  'S'
000612 4612 2005            12      JR  NZ,RBREAD_MEM
000614 4614 3E01             7      LD  A,1
000616 4616 3232F1          13      LD  (FLG_LDIR),A
       4619                     RBREAD_MEM:
000619 4619 2A36F1          16      LD  HL,(_BUF_ST)
00061C 461C 22BFFC          16      LD  (SAVENT),HL
00061F 461F 2230F1          16      LD  (_DTA),HL
000622 4622 21FFFF          10      LD  HL,0FFFFH
000625 4625 CD1D49          17      CALL    ROM_READ
000628 4628 3ABEFC          13      LD  A,(RUNBNF)
00062B 462B FE52             7      CP  'R'
00062D 462D 2006            12      JR  NZ,RBREAD1
00062F 462F 2A3AF1          16      LD  HL,(_BUF_EX)
000632 4632 2206F1          16      LD  (SWC_BLOAD),HL
       4635                     RBREAD1:
       4635                     ROM_NEXT:
000635 4635 2A4EF1          16      LD  HL,(PARAM1)
000638 4638 7E               7      LD  A,(HL)
000639 4639 2B               6      DEC HL
00063A 463A B7               4      OR  A
00063B 463B 2805            12      JR  Z,RN1
00063D 463D FE3A             7      CP  ':'
00063F 463F 2801            12      JR  Z,RN1
000641 4641 23               6      INC HL
       4642                     RN1:
000642 4642 5D               4      LD  E,L
000643 4643 54               4      LD  D,H
                                
000644 4644 CDF84A          17      CALL    SEARCH_END
000647 4647 B7               4      OR  A
000648 4648 2821            12      JR  Z,REM
       464A                     RN3:                    ;マルチステートメントの処理
00064A 464A 7E               7      LD  A,(HL)
                                
00064B 464B FEB5             7      CP  0B5H            ;LOAD
00064D 464D CA4045          10      JP  Z,ROM_LOAD
000650 4650 FE8A             7      CP  08AH            ;RUN
000652 4652 281B            12      JR  Z,ROM_RUN
000654 4654 FEB7             7      CP  0B7H            ;FILES
000656 4656 2824            12      JR  Z,ROM_FILES
000658 4658 FED6             7      CP  0D6H            ;COPY
00065A 465A CA0247          10      JP  Z,ROM_COPY
00065D 465D FE20             7      CP  020H
00065F 465F 2807            12      JR  Z,RN_SP
                                
000661 4661 3E28             7      LD  A,028H          ;JR Z,
000663 4663 320CF1          13      LD  (SWC_BLOAD_M),A
000666 4666 7E               7      LD  A,(HL)
000667 4667 C9              10      RET
       4668                     RN_SP:
000668 4668 23               6      INC HL
000669 4669 18DF            12      JR  RN3
                                
       466B                     REM:
00066B 466B EB               4      EX  DE,HL
00066C 466C 3E8F             7      LD  A,08FH          ;REM
00066E 466E C9              10      RET
                                
       466F                     ROM_RUN:
00066F 466F 23               6      INC HL
000670 4670 7E               7      LD  A,(HL)
000671 4671 2B               6      DEC HL
000672 4672 B7               4      OR  A
000673 4673 2803            12      JR  Z,ROM_RUN1
000675 4675 CD4045          17      CALL    ROM_LOAD
       4678                     ROM_RUN1:
000678 4678 3E8A             7      LD  A,08AH          ;RUN
00067A 467A 77               7      LD  (HL),A
00067B 467B C9              10      RET
                                
       467C                     ROM_FILES:
00067C 467C CDCC46          17      CALL    INIT_PARAM
00067F 467F CDBD49          17      CALL    FILE_B
000682 4682 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
000685 4685 3A51F1          13      LD  A,(FNAME)
000688 4688 FE21             7      CP  021H
00068A 468A 3005            12      JR  NC,RFILES0
00068C 468C 060B             7      LD  B,11
00068E 468E CD8C4A          17      CALL    FILE10
       4691                     RFILES0:
000691 4691 CDA54D          17      CALL    GET_DIR_DAT
       4694                     RFILES1:
000694 4694 CD544B          17      CALL    FILESE
000697 4697 302E            12      JR  NC,RFILES_NOT_MATCH
       4699                     RFILES_DISP:
000699 4699 E5              11      PUSH    HL
00069A 469A 0608             7      LD  B,8
00069C 469C CDA643          17      CALL    MSN
00069F 469F 3E2E             7      LD  A,'.'
0006A1 46A1 CD5A50          17      CALL    MSG_A
0006A4 46A4 0603             7      LD  B,3
0006A6 46A6 CDA643          17      CALL    MSN
0006A9 46A9 3ADDF3          13      LD  A,(CSRX)
0006AC 46AC 47               4      LD  B,A
0006AD 46AD 3AB0F3          13      LD  A,(LINLEN)
0006B0 46B0 90               4      SUB B
0006B1 46B1 FE0C             7      CP  12
0006B3 46B3 3009            12      JR  NC,RFILES2
0006B5 46B5 3E0D             7      LD  A,00DH      ;改行
0006B7 46B7 CD5A50          17      CALL    MSG_A
0006BA 46BA 3E0A             7      LD  A,00AH
0006BC 46BC 1802            12      JR  RFILES3
       46BE                     RFILES2:
0006BE 46BE 3E20             7      LD  A,020H
       46C0                     RFILES3:
0006C0 46C0 CD5A50          17      CALL    MSG_A
0006C3 46C3 E1              10      POP HL
0006C4 46C4 CD704B          17      CALL    FNEXT
       46C7                     RFILES_NOT_MATCH:
0006C7 46C7 20CB            12      JR  NZ,RFILES1
0006C9 46C9 C33546          10      JP  ROM_NEXT
                                
       46CC                     INIT_PARAM:
0006CC 46CC 224CF1          16      LD  (PARAM0),HL
0006CF 46CF 224EF1          16      LD  (PARAM1),HL
0006D2 46D2 EB               4      EX  DE,HL
0006D3 46D3 AF               4      XOR A
0006D4 46D4 3232F1          13      LD  (FLG_LDIR),A
0006D7 46D7 32BEFC          13      LD  (RUNBNF),A
0006DA 46DA 3263F6          13      LD  (VALTYP),A
0006DD 46DD E5              11      PUSH    HL
0006DE 46DE 2A5CF1          16      LD  HL,(_CD)
0006E1 46E1 225EF1          16      LD  (_CDX),HL
0006E4 46E4 E1              10      POP HL
0006E5 46E5 13               6      INC DE
0006E6 46E6 CDC84A          17      CALL    SPCUT
0006E9 46E9 1A               7      LD  A,(DE)
0006EA 46EA B7               4      OR  A
0006EB 46EB C8              11      RET Z
0006EC 46EC FE3A             7      CP  ':'
0006EE 46EE C8              11      RET Z
0006EF 46EF FE28             7      CP  '('
0006F1 46F1 C8              11      RET Z
0006F2 46F2 EB               4      EX  DE,HL
0006F3 46F3 DD21644C        14      LD  IX,FRMEVL
0006F7 46F7 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006FB 46FB CD1C00          17      CALL    _CALSLT
0006FE 46FE 224EF1          16      LD  (PARAM1),HL
000701 4701 C9              10      RET
                                
       4702                     ROM_COPY:
000702 4702 CDCC46          17      CALL    INIT_PARAM
000705 4705 3A63F6          13      LD  A,(VALTYP)
000708 4708 FE03             7      CP  3       ;string
00070A 470A C2B849          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
00070D 470D CDBD49          17      CALL    FILE_B
000710 4710 CD384B          17      CALL    ROM_OPEN
000713 4713 DA9845          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000716 4716 213AF1          10      LD  HL,_BUF_W
000719 4719 2230F1          16      LD  (_DTA),HL
00071C 471C 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
00071F 471F CD1D49          17      CALL    ROM_READ
                                
000722 4722 AF               4      XOR A
000723 4723 3235F1          13      LD  (_BUF_LO),A     ;PSET
000726 4726 3242F1          13      LD  (_BUF_O),A      ;向き
                                
000729 4729 2A4EF1          16      LD  HL,(PARAM1)
       472C                     RCP_PARAM1:
00072C 472C 7E               7      LD  A,(HL)
00072D 472D 23               6      INC HL
00072E 472E B7               4      OR  A
00072F 472F CAB849          10      JP  Z,ROM_ORG
000732 4732 FE3A             7      CP  ':'
000734 4734 CAB849          10      JP  Z,ROM_ORG
000737 4737 FE2C             7      CP  ','
000739 4739 2012            12      JR  NZ,RCP_PARAM1_
                                
00073B 473B DD212F54        14      LD  IX,FRMQNT
00073F 473F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000743 4743 CD1C00          17      CALL    _CALSLT
000746 4746 7B               4      LD  A,E
000747 4747 87               4      ADD A,A
000748 4748 87               4      ADD A,A
000749 4749 3242F1          13      LD  (_BUF_O),A
00074C 474C 7E               7      LD  A,(HL)
       474D                     RCP_PARAM1_:
00074D 474D FE28             7      CP  '('
00074F 474F 20DB            12      JR  NZ,RCP_PARAM1
                                
000751 4751 DD212F54        14      LD  IX,FRMQNT
000755 4755 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000759 4759 CD1C00          17      CALL    _CALSLT
                                
00075C 475C ED533EF1        20      LD  (_BUF_X),DE
                                
       4760                     RCP_PARAM2:
000760 4760 23               6      INC HL
000761 4761 7E               7      LD  A,(HL)
000762 4762 FE20             7      CP  020H
000764 4764 28FA            12      JR  Z,RCP_PARAM2
000766 4766 FE2C             7      CP  ','
000768 4768 28F6            12      JR  Z,RCP_PARAM2
                                
00076A 476A DD212F54        14      LD  IX,FRMQNT
00076E 476E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000772 4772 CD1C00          17      CALL    _CALSLT
                                
000775 4775 ED5340F1        20      LD  (_BUF_Y),DE
       4779                     RCP_PARAM3:
000779 4779 23               6      INC HL
00077A 477A 7E               7      LD  A,(HL)
00077B 477B FE20             7      CP  020H
00077D 477D 28FA            12      JR  Z,RCP_PARAM3
00077F 477F FE29             7      CP  ')'
000781 4781 28F6            12      JR  Z,RCP_PARAM3
000783 4783 FE2C             7      CP  ','
000785 4785 2033            12      JR  NZ,RCP_ST
                                
000787 4787 23               6      INC HL
000788 4788 DD212F54        14      LD  IX,FRMQNT
00078C 478C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000790 4790 CD1C00          17      CALL    _CALSLT
                                
000793 4793 7B               4      LD  A,E
000794 4794 3241F1          13      LD  (_BUF_P),A
                                
       4797                     RCP_PARAM4:
000797 4797 7E               7      LD  A,(HL)
000798 4798 23               6      INC HL
000799 4799 FE20             7      CP  020H
00079B 479B 28FA            12      JR  Z,RCP_PARAM4
                                
00079D 479D FE2C             7      CP  ','
00079F 479F 2019            12      JR  NZ,RCP_ST
                                
0007A1 47A1 7E               7      LD  A,(HL)
0007A2 47A2 0604             7      LD  B,4
0007A4 47A4 FEC3             7      CP  0C3H        ;PRESET
0007A6 47A6 280E            12      JR  Z,RCP_LO
0007A8 47A8 05               4      DEC B       ;3
0007A9 47A9 D6F8             7      SUB 0F8H        ;XOR
0007AB 47AB 2809            12      JR  Z,RCP_LO
0007AD 47AD 05               4      DEC B       ;2
0007AE 47AE 3C               4      INC A       ;OR
0007AF 47AF 2805            12      JR  Z,RCP_LO
0007B1 47B1 05               4      DEC B       ;1
0007B2 47B2 3C               4      INC A       ;AND
0007B3 47B3 2801            12      JR  Z,RCP_LO
0007B5 47B5 05               4      DEC B       ;0
                                                ;PSET
       47B6                     RCP_LO:
0007B6 47B6 78               4      LD  A,B
0007B7 47B7 3235F1          13      LD  (_BUF_LO),A
       47BA                     RCP_ST:
0007BA 47BA 2AC6F6          16      LD  HL,(STREND)
0007BD 47BD 2230F1          16      LD  (_DTA),HL
0007C0 47C0 EB               4      EX  DE,HL
0007C1 47C1 2100FE          10      LD  HL,-512
0007C4 47C4 39              11      ADD HL,SP
0007C5 47C5 AF               4      XOR A
0007C6 47C6 ED52            15      SBC HL,DE
0007C8 47C8 3008            12      JR  NC,RCP0
0007CA 47CA 215EF5          10      LD  HL,BUF
0007CD 47CD 2230F1          16      LD  (_DTA),HL
0007D0 47D0 6F               4      LD  L,A ;0
0007D1 47D1 67               4      LD  H,A ;0
       47D2                     RCP0:
0007D2 47D2 24               4      INC H
0007D3 47D3 2238F1          16      LD  (_BUF_EN),HL
       47D6                     RCP1:
0007D6 47D6 F3               4      DI
0007D7 47D7 CDAB48          17      CALL    WAIT_VDP
                                
0007DA 47DA 3A0700          13      LD  A,(WRVDP)
0007DD 47DD 4F               4      LD  C,A
0007DE 47DE 0C               4      INC C       ;C := PORT#1's address(WR)
0007DF 47DF 3E24             7      LD  A,36
0007E1 47E1 ED79            12      OUT (C),A
0007E3 47E3 3E91             7      LD  A,080H+17
0007E5 47E5 ED79            12      OUT (C),A       ;R#17 := 36
                                
0007E7 47E7 0C               4      INC C
0007E8 47E8 0C               4      INC C       ;C := PORT#3's address(WR)
0007E9 47E9 2A3EF1          16      LD  HL,(_BUF_X)
0007EC 47EC ED69            12      OUT (C),L       ;R#36 DX
0007EE 47EE ED61            12      OUT (C),H       ;R#37
0007F0 47F0 2A40F1          16      LD  HL,(_BUF_Y)
0007F3 47F3 ED69            12      OUT (C),L       ;R#38 DY
0007F5 47F5 ED61            12      OUT (C),H       ;R#39
0007F7 47F7 2A3AF1          16      LD  HL,(_BUF_W)
0007FA 47FA ED69            12      OUT (C),L       ;R#40 NX
0007FC 47FC ED61            12      OUT (C),H       ;R#41
0007FE 47FE 2A3CF1          16      LD  HL,(_BUF_H)
000801 4801 ED69            12      OUT (C),L       ;R#42 NY
000803 4803 ED61            12      OUT (C),H       ;R#43
                                
000805 4805 DD2AAFFC        20      LD  IX,(SCRMOD)
000809 4809 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00080C 480C B7               4      OR  A
00080D 480D 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
00080F 480F DD7D             9      LD  A,IXL
000811 4811 FE08             7      CP  8
000813 4813 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000815 4815 FE06             7      CP  6
000817 4817 2A3EF1          16      LD  HL,(_BUF_X)
00081A 481A 3A3AF1          13      LD  A,(_BUF_W)
00081D 481D 2005            12      JR  NZ,SCR57
00081F 481F B5               4      OR  L       ;スクリーン6
000820 4820 E603             7      AND 3
000822 4822 200D            12      JR  NZ,USE_LMMC
       4824                     SCR57:              ;スクリーン5,7
000824 4824 B5               4      OR  L
000825 4825 E601             7      AND 1
000827 4827 2008            12      JR  NZ,USE_LMMC
       4829                     USE_HMMC:
000829 4829 DD2E08          10      LD  IXL,8
       482C                     USE_HMMC8:
00082C 482C 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
00082E 482E 3235F1          13      LD  (_BUF_LO),A
       4831                     USE_LMMC:
000831 4831 110000          10      LD  DE,0
000834 4834 06FF             7      LD  B,-1
000836 4836 CDD648          17      CALL    GET_PIXEL
000839 4839 ED79            12      OUT (C),A       ;R#44 first DATA
00083B 483B 3A42F1          13      LD  A,(_BUF_O)
00083E 483E ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000840 4840 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000843 4843 F6B0             7      OR  0B0H        ;R#46 LMMC command
000845 4845 ED79            12      OUT (C),A
                                
000847 4847 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000849 4849 0D               4      DEC C
00084A 484A 0D               4      DEC C       ;C := PORT#1's address(WR)
00084B 484B 3EAC             7      LD  A,080H+44
00084D 484D ED79            12      OUT (C),A
00084F 484F 3E91             7      LD  A,080H+17
000851 4851 ED79            12      OUT (C),A       ;R#17 := 44
                                
000853 4853 3A0600          13      LD  A,(RDVDP)
000856 4856 3C               4      INC A
000857 4857 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000859 4859 3E02             7      LD  A,2
00085B 485B ED79            12      OUT (C),A
00085D 485D 3E8F             7      LD  A,08FH
00085F 485F ED79            12      OUT (C),A
000861 4861 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000864 4864 E640             7      AND 040H
000866 4866 201C            12      JR  NZ,LOOP_HMMC
       4868                     LOOP_COPY:
000868 4868 CDD648          17      CALL    GET_PIXEL
00086B 486B 08               4      EX  AF,AF'
00086C 486C FD4C             9      LD  C,IYH
       486E                     LOOP_COPY1:
00086E 486E ED78            12      IN  A,(C)
000870 4870 0F               4      RRCA            ;RRCAではサインフラグは変化しない
000871 4871 300A            12      JR  NC,EXIT_COPY    ;check CE bit
000873 4873 F26E48          10      JP  P,LOOP_COPY1    ;check TR bit
000876 4876 08               4      EX  AF,AF'
000877 4877 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000879 4879 ED79            12      OUT (C),A
00087B 487B 18EB            12      JR  LOOP_COPY
                                
       487D                     EXIT_COPY:
00087D 487D CDB348          17      CALL    GET_STATUS_0
000880 4880 FB               4      EI
000881 4881 C33546          10      JP  ROM_NEXT
                                
       4884                     LOOP_HMMC:
000884 4884 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000886 4886 43               4      LD  B,E
000887 4887 7B               4      LD  A,E
000888 4888 B7               4      OR  A
000889 4889 2802            12      JR  Z,LOOP_HMMC1
00088B 488B EDB3                    OTIR
       488D                     LOOP_HMMC1:
00088D 488D 14               4      INC D
       488E                     LOOP_HMMC2:
00088E 488E 15               4      DEC D
00088F 488F 2805            12      JR  Z,LOOP_HMMC3
000891 4891 EDB3                    OTIR
000893 4893 C38E48          10      JP  LOOP_HMMC2
       4896                     LOOP_HMMC3:
000896 4896 ED78            12      IN  A,(C)
000898 4898 0F               4      RRCA
000899 4899 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
00089B 489B 2A38F1          16      LD  HL,(_BUF_EN)
00089E 489E CD1D49          17      CALL    ROM_READ
0008A1 48A1 EB               4      EX  DE,HL
0008A2 48A2 2A30F1          16      LD  HL,(_DTA)
0008A5 48A5 7A               4      LD  A,D
0008A6 48A6 B3               4      OR  E
0008A7 48A7 20DB            12      JR  NZ,LOOP_HMMC
0008A9 48A9 18C3            12      JR  LOOP_COPY1
                                    
       48AB                     WAIT_VDP:
0008AB 48AB 3E02             7      LD  A,2
0008AD 48AD CDB448          17      CALL    GET_STATUS
0008B0 48B0 0F               4      RRCA
0008B1 48B1 38F8            12      JR  C,WAIT_VDP
       48B3                     GET_STATUS_0:
0008B3 48B3 AF               4      XOR A
       48B4                     GET_STATUS:
0008B4 48B4 C5              11      PUSH    BC
0008B5 48B5 ED4B0600        20      LD  BC,(RDVDP)
0008B9 48B9 0C               4      INC C
0008BA 48BA ED79            12      OUT (C),A
0008BC 48BC 3E8F             7      LD  A,08FH
0008BE 48BE ED79            12      OUT (C),A
0008C0 48C0 ED78            12      IN  A,(C)
0008C2 48C2 C1              10      POP BC
0008C3 48C3 C9              10      RET
                                
       48C4                     GET_PIXEL256:
0008C4 48C4 7A               4      LD  A,D
0008C5 48C5 B3               4      OR  E
0008C6 48C6 200A            12      JR  NZ,GET_PIXEL1
0008C8 48C8 2A38F1          16      LD  HL,(_BUF_EN)
0008CB 48CB CD1D49          17      CALL    ROM_READ
0008CE 48CE EB               4      EX  DE,HL
0008CF 48CF 2A30F1          16      LD  HL,(_DTA)
       48D2                     GET_PIXEL1:
0008D2 48D2 7E               7      LD  A,(HL)
0008D3 48D3 23               6      INC HL
0008D4 48D4 1B               6      DEC DE
0008D5 48D5 C9              10      RET
                                
       48D6                     GET_PIXEL:
0008D6 48D6 04               4      INC B
0008D7 48D7 DD7D             9      LD  A,IXL
0008D9 48D9 FE08             7      CP  8
0008DB 48DB 28E7            12      JR  Z,GET_PIXEL256
0008DD 48DD FE06             7      CP  6
0008DF 48DF 282E            12      JR  Z,GET_PIXEL4
                                
0008E1 48E1 CB40             8      BIT 0,B
0008E3 48E3 20ED            12      JR  NZ,GET_PIXEL1
                                
0008E5 48E5 7A               4      LD  A,D
0008E6 48E6 B3               4      OR  E
0008E7 48E7 200A            12      JR  NZ,GET_PIXEL2
                                
0008E9 48E9 2A38F1          16      LD  HL,(_BUF_EN)
0008EC 48EC CD1D49          17      CALL    ROM_READ
0008EF 48EF EB               4      EX  DE,HL
0008F0 48F0 2A30F1          16      LD  HL,(_DTA)
                                
       48F3                     GET_PIXEL2:
0008F3 48F3 7E               7      LD  A,(HL)
0008F4 48F4 0F               4      RRCA
0008F5 48F5 0F               4      RRCA
0008F6 48F6 0F               4      RRCA
0008F7 48F7 0F               4      RRCA
0008F8 48F8 C9              10      RET
                                
       48F9                     GET_PIXEL3:
0008F9 48F9 7A               4      LD  A,D
0008FA 48FA B3               4      OR  E
0008FB 48FB 200A            12      JR  NZ,GET_PIXEL5
                                
0008FD 48FD 2A38F1          16      LD  HL,(_BUF_EN)
000900 4900 CD1D49          17      CALL    ROM_READ
000903 4903 EB               4      EX  DE,HL
000904 4904 2A30F1          16      LD  HL,(_DTA)
       4907                     GET_PIXEL5:
000907 4907 7E               7      LD  A,(HL)
000908 4908 0F               4      RRCA
000909 4909 0F               4      RRCA
00090A 490A 0F               4      RRCA
00090B 490B 0F               4      RRCA
00090C 490C 0F               4      RRCA
00090D 490D 0F               4      RRCA
00090E 490E C9              10      RET
                                
       490F                     GET_PIXEL4:
00090F 490F 78               4      LD  A,B
000910 4910 E603             7      AND 3   ;+0
000912 4912 28E5            12      JR  Z,GET_PIXEL3
000914 4914 3D               4      DEC A   ;+1
000915 4915 28DC            12      JR  Z,GET_PIXEL2
000917 4917 3D               4      DEC A   ;+2
000918 4918 7E               7      LD  A,(HL)
000919 4919 C0              11      RET NZ
00091A 491A 0F               4      RRCA        ;+3
00091B 491B 0F               4      RRCA
00091C 491C C9              10      RET
                                
       491D                     ROM_READ:
00091D 491D E5              11      PUSH    HL
00091E 491E D5              11      PUSH    DE
00091F 491F C5              11      PUSH    BC
000920 4920 FDE5            15      PUSH    IY
000922 4922 224AF1          16      LD  (LEFTX),HL
000925 4925 2A30F1          16      LD  HL,(_DTA)
000928 4928 2243F1          16      LD  (DTAX),HL
00092B 492B 2A4AF1          16      LD  HL,(LEFTX)
                                
00092E 492E CDCB4B          17      CALL    RBX1
000931 4931 3870            12      JR  C,RBRERR1
000933 4933 79               4      LD  A,C
000934 4934 EB               4      EX  DE,HL
000935 4935 ED52            15      SBC HL,DE       ;CP 0HL,CDE
000937 4937 19              11      ADD HL,DE
000938 4938 DE00             7      SBC A,000H
00093A 493A 3801            12      JR  C,RBR1
00093C 493C EB               4      EX  DE,HL
       493D                     RBR1:
00093D 493D 9F               4      SBC A,A
00093E 493E E601             7      AND 1
000940 4940 321FF1          13      LD  (_RESULT),A
000943 4943 7C               4      LD  A,H
000944 4944 B5               4      OR  L
000945 4945 CA9949          10      JP  Z,RBREND0
                                
000948 4948 222CF1          16      LD  (_LEFT),HL  ;Read record byte
00094B 494B 224AF1          16      LD  (LEFTX),HL
                                
00094E 494E CDF74B          17      CALL    RBX2
000951 4951 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000953 4953 CD0A4C          17      CALL    RBXA
000956 4956 DAAF49          10      JP  C,RBRERR
000959 4959 C5              11      PUSH    BC
00095A 495A CD4144          17      CALL    ROM_LDIR
00095D 495D ED5343F1        20      LD  (DTAX),DE
000961 4961 2A4AF1          16      LD  HL,(LEFTX)
000964 4964 D1              10      POP DE
000965 4965 A7               4      AND A
000966 4966 ED52            15      SBC HL,DE
000968 4968 224AF1          16      LD  (LEFTX),HL
00096B 496B 2829            12      JR  Z,RBREND
                                
       496D                     RBRB:
00096D 496D CD464C          17      CALL    RBXB
000970 4970 2818            12      JR  Z,RBRC
       4972                     RBRB1:
000972 4972 C5              11      PUSH    BC
000973 4973 D5              11      PUSH    DE
000974 4974 CDF14C          17      CALL    CLUST
000977 4977 EB               4      EX  DE,HL
000978 4978 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
00097C 497C CD4144          17      CALL    ROM_LDIR
00097F 497F EB               4      EX  DE,HL
000980 4980 D1              10      POP DE
000981 4981 C1              10      POP BC
000982 4982 CDCE4C          17      CALL    GNCL
000985 4985 DAAF49          10      JP  C,RBRERR
000988 4988 10E8            13      DJNZ    RBRB1
       498A                     RBRC:
00098A 498A CD5E4C          17      CALL    RBXC
00098D 498D 2807            12      JR  Z,RBREND
                                
00098F 498F CDF14C          17      CALL    CLUST
000992 4992 EB               4      EX  DE,HL
000993 4993 CD4144          17      CALL    ROM_LDIR
       4996                     RBREND:
000996 4996 CD6A4C          17      CALL    RBXEND
       4999                     RBREND0:
000999 4999 FDE1            14      POP IY
00099B 499B C1              10      POP BC
00099C 499C D1              10      POP DE
00099D 499D F1              10      POP AF  ;(HL)
00099E 499E AF               4      XOR A
00099F 499F 3A1FF1          13      LD  A,(_RESULT)
0009A2 49A2 C9              10      RET
                                
       49A3                     RBRERR1:
0009A3 49A3 3E01             7      LD  A,001H
       49A5                     RBRERR2:
0009A5 49A5 FDE1            14      POP IY
0009A7 49A7 C1              10      POP BC
0009A8 49A8 D1              10      POP DE
0009A9 49A9 E1              10      POP HL
0009AA 49AA 37               4      SCF
0009AB 49AB 210000          10      LD  HL,0
0009AE 49AE C9              10      RET
       49AF                     RBRERR:
0009AF 49AF 3EFF             7      LD  A,0FFH
0009B1 49B1 18F2            12      JR  RBRERR2
                                
       49B3                     FILE_DD:
0009B3 49B3 3E                      DB  03EH
0009B4 49B4 C9              10      RET
0009B5 49B5 320CF1          13      LD  (SWC_BLOAD_M),A
       49B8                     ROM_ORG:
0009B8 49B8 2A4CF1          16      LD  HL,(PARAM0)
0009BB 49BB 7E               7      LD  A,(HL)
0009BC 49BC C9              10      RET
       49BD                     FILE_B:
0009BD 49BD AF               4      XOR A
0009BE 49BE 3250F1          13      LD  (FDRV),A
0009C1 49C1 1E00             7      LD  E,0
0009C3 49C3 3A63F6          13      LD  A,(VALTYP)
0009C6 49C6 FE03             7      CP  3       ;string
0009C8 49C8 207F            12      JR  NZ,FILED
                                
0009CA 49CA DD21D067        14      LD  IX,FRESTR
0009CE 49CE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009D2 49D2 CD1C00          17      CALL    _CALSLT
0009D5 49D5 E5              11      PUSH    HL
0009D6 49D6 DDE1            14      POP IX
                                
0009D8 49D8 DD5E00          19      LD  E,(IX+0)
0009DB 49DB DD7E01          19      LD  A,(IX+1)
0009DE 49DE DD5602          19      LD  D,(IX+2)
0009E1 49E1 DD62             9      LD  IXH,D
0009E3 49E3 DD6F             9      LD  IXL,A
0009E5 49E5 7B               4      LD  A,E
       49E6                     FILE_BDOS:
0009E6 49E6 FE04             7      CP  4
0009E8 49E8 3808            12      JR  C,FILEB1
0009EA 49EA DD7E03          19      LD  A,(IX+3)
0009ED 49ED FE3A             7      CP  ':'
0009EF 49EF 28C2            12      JR  Z,FILE_DD
0009F1 49F1 7B               4      LD  A,E
       49F2                     FILEB1:
0009F2 49F2 FE02             7      CP  2
0009F4 49F4 3818            12      JR  C,DEVI1
0009F6 49F6 DD7E01          19      LD  A,(IX+1)
0009F9 49F9 FE3A             7      CP  ':'
0009FB 49FB 2011            12      JR  NZ,DEVI1
0009FD 49FD DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A00 4A00 CD224B          17      CALL    CAP
000A03 4A03 D640             7      SUB '@'
000A05 4A05 DD23            10      INC IX
000A07 4A07 DD23            10      INC IX
000A09 4A09 1D               4      DEC E
000A0A 4A0A 1D               4      DEC E
000A0B 4A0B 3250F1          13      LD  (FDRV),A
       4A0E                     DEVI1:
000A0E 4A0E DD7E00          19      LD  A,(IX+0)
000A11 4A11 D65C             7      SUB 05CH        ;\
000A13 4A13 2008            12      JR  NZ,NOROOT
000A15 4A15 6F               4      LD  L,A
000A16 4A16 67               4      LD  H,A
000A17 4A17 225EF1          16      LD  (_CDX),HL
000A1A 4A1A DD23            10      INC IX
000A1C 4A1C 1D               4      DEC E
       4A1D                     NOROOT:
                                
       4A1D                     SETDIR:
000A1D 4A1D CD494A          17      CALL    FILED
000A20 4A20 DD7E00          19      LD  A,(IX+0)
000A23 4A23 FE5C             7      CP  05CH        ;\
000A25 4A25 C0              11      RET NZ
000A26 4A26 DD23            10      INC IX
000A28 4A28 1D               4      DEC E
       4A29                     SETDIR1:
000A29 4A29 DDE5            15      PUSH    IX
000A2B 4A2B CD384B          17      CALL    ROM_OPEN
000A2E 4A2E DDE1            14      POP IX
000A30 4A30 B7               4      OR  A
000A31 4A31 C0              11      RET NZ
                                
000A32 4A32 FD2A47F1        20      LD  IY,(DIRENT1)
000A36 4A36 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000A3A 4A3A C8              11      RET Z
000A3B 4A3B CD904A          17      CALL    FILEI
000A3E 4A3E FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A41 4A41 FD661B          19      LD  H,(IY+01BH)
000A44 4A44 225EF1          16      LD  (_CDX),HL
000A47 4A47 18D4            12      JR  SETDIR
                                
       4A49                     FILED:
000A49 4A49 CD904A          17      CALL    FILEI
000A4C 4A4C 2151F1          10      LD  HL,FNAME
                                
000A4F 4A4F 0608             7      LD  B,8
       4A51                     FILE2:
000A51 4A51 CD9D4A          17      CALL    CCHKF
000A54 4A54 C8              11      RET Z
000A55 4A55 FE2A             7      CP  '*'
000A57 4A57 282E            12      JR  Z,FILE9
000A59 4A59 FE2E             7      CP  '.'
000A5B 4A5B 280C            12      JR  Z,FILE4
000A5D 4A5D 77               7      LD  (HL),A
000A5E 4A5E 23               6      INC HL
000A5F 4A5F 10F0            13      DJNZ    FILE2
                                
       4A61                     FILE3:
000A61 4A61 CD9D4A          17      CALL    CCHKF
000A64 4A64 C8              11      RET Z
000A65 4A65 FE2E             7      CP  '.'
000A67 4A67 20F8            12      JR  NZ,FILE3
                                
       4A69                     FILE4:
000A69 4A69 2159F1          10      LD  HL,FNAME+8
000A6C 4A6C 0603             7      LD  B,3
                                
       4A6E                     FILE4L:
000A6E 4A6E CD9D4A          17      CALL    CCHKF
000A71 4A71 C8              11      RET Z
000A72 4A72 FE2E             7      CP  '.'
000A74 4A74 2008            12      JR  NZ,FILE12
000A76 4A76 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000A79 4A79 3252F1          13      LD  (FNAME+1),A
000A7C 4A7C 3E20             7      LD  A,020H
       4A7E                     FILE12:
000A7E 4A7E FE2A             7      CP  '*'
000A80 4A80 280A            12      JR  Z,FILE10
000A82 4A82 77               7      LD  (HL),A
000A83 4A83 23               6      INC HL
000A84 4A84 10E8            13      DJNZ    FILE4L
000A86 4A86 C9              10      RET
                                
       4A87                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A87 4A87 CD8C4A          17      CALL    FILE10
000A8A 4A8A 18D5            12      JR  FILE3
                                
       4A8C                     FILE10:
000A8C 4A8C 3E3F             7      LD  A,'?'
000A8E 4A8E 1808            12      JR  FILL_MEMORY
       4A90                     FILEI:              ;名前＋拡張子をスペースで初期化
000A90 4A90 3E20             7      LD  A,020H
000A92 4A92 01000B          10      LD  BC,11*256   ;C=0にしておく
000A95 4A95 2151F1          10      LD  HL,FNAME
       4A98                     FILL_MEMORY:            ;HLからBバイトAで埋める
000A98 4A98 77               7      LD  (HL),A
000A99 4A99 23               6      INC HL
000A9A 4A9A 10FC            13      DJNZ    FILL_MEMORY
000A9C 4A9C C9              10      RET
                                
       4A9D                     CCHKF:
000A9D 4A9D 7B               4      LD  A,E
000A9E 4A9E B7               4      OR  A
000A9F 4A9F C8              11      RET Z
000AA0 4AA0 DD7E00          19      LD  A,(IX+0)
000AA3 4AA3 CDAA4A          17      CALL    CCHK2
000AA6 4AA6 C8              11      RET Z
000AA7 4AA7 C30D4B          10      JP  FKAN
                                
       4AAA                     CCHK2:
000AAA 4AAA 0C               4      INC C
000AAB 4AAB 0D               4      DEC C
000AAC 4AAC C0              11      RET NZ
       4AAD                     CCHK3:              ;ZF=1 で使えない文字
000AAD 4AAD FE2B             7      CP  '+'
000AAF 4AAF C8              11      RET Z
000AB0 4AB0 FE2C             7      CP  ','
000AB2 4AB2 C8              11      RET Z
000AB3 4AB3 FE2F             7      CP  '/'
000AB5 4AB5 C8              11      RET Z
000AB6 4AB6 FE3A             7      CP  ':'
000AB8 4AB8 C8              11      RET Z
000AB9 4AB9 FE3B             7      CP  ';'
000ABB 4ABB C8              11      RET Z
000ABC 4ABC FE3D             7      CP  '='
000ABE 4ABE C8              11      RET Z
000ABF 4ABF FE5C             7      CP  05CH    ;\
000AC1 4AC1 C8              11      RET Z
000AC2 4AC2 FE1F             7      CP  01FH
000AC4 4AC4 D0              11      RET NC
000AC5 4AC5 BF               4      CP  A       ;Z=1
000AC6 4AC6 C9              10      RET
                                
       4AC7                     SS1:
000AC7 4AC7 13               6      INC DE
       4AC8                     SPCUT:              ;スペースをカット
000AC8 4AC8 1A               7      LD  A,(DE)
000AC9 4AC9 FE20             7      CP  020H
000ACB 4ACB 28FA            12      JR  Z,SS1
000ACD 4ACD C9              10      RET
                                
       4ACE                     SCREOF1:
000ACE 4ACE 13               6      INC DE
       4ACF                     SPCUTEX:            ;スペース改行などをカット
000ACF 4ACF 1A               7      LD  A,(DE)
000AD0 4AD0 FE20             7      CP  020H
000AD2 4AD2 28FA            12      JR  Z,SCREOF1
000AD4 4AD4 FE0D             7      CP  00DH
000AD6 4AD6 28F6            12      JR  Z,SCREOF1
000AD8 4AD8 FE0A             7      CP  00AH
000ADA 4ADA 28F2            12      JR  Z,SCREOF1
000ADC 4ADC FE1A             7      CP  01AH
000ADE 4ADE 28EE            12      JR  Z,SCREOF1
000AE0 4AE0 C9              10      RET
                                
       4AE1                     GETNUM:
000AE1 4AE1 210000          10      LD  HL,0
       4AE4                     GETNUM1:
000AE4 4AE4 1A               7      LD  A,(DE)
000AE5 4AE5 13               6      INC DE
000AE6 4AE6 D630             7      SUB '0'
000AE8 4AE8 D8              11      RET C
000AE9 4AE9 FE0A             7      CP  10
000AEB 4AEB D0              11      RET NC
000AEC 4AEC 4D               4      LD  C,L
000AED 4AED 44               4      LD  B,H
000AEE 4AEE 29              11      ADD HL,HL   ;*2
000AEF 4AEF 29              11      ADD HL,HL   ;*4
000AF0 4AF0 09              11      ADD HL,BC   ;*5
000AF1 4AF1 29              11      ADD HL,HL   ;*10
000AF2 4AF2 4F               4      LD  C,A
000AF3 4AF3 0600             7      LD  B,0
000AF5 4AF5 09              11      ADD HL,BC
000AF6 4AF6 18EC            12      JR  GETNUM1
                                
       4AF8                     SEARCH_END:
000AF8 4AF8 7E               7      LD  A,(HL)
       4AF9                     SEARCH_END1:
000AF9 4AF9 23               6      INC HL
000AFA 4AFA B7               4      OR  A
000AFB 4AFB C8              11      RET Z
000AFC 4AFC FE3A             7      CP  ':'
000AFE 4AFE 20F8            12      JR  NZ,SEARCH_END
000B00 4B00 7E               7      LD  A,(HL)
000B01 4B01 FE3A             7      CP  ':'
000B03 4B03 28F4            12      JR  Z,SEARCH_END1
000B05 4B05 C9              10      RET
                                
       4B06                     FKANC:
000B06 4B06 CB41             8      BIT 0,C
000B08 4B08 CC2B4B          17      CALL    Z,CAP2
000B0B 4B0B 1803            12      JR  FKANX
       4B0D                     FKAN:           ;漢字チェック
000B0D 4B0D DD23            10      INC IX
000B0F 4B0F 1D               4      DEC E
       4B10                     FKANX:
000B10 4B10 CB41             8      BIT 0,C
000B12 4B12 CB81             8      RES 0,C
000B14 4B14 C0              11      RET NZ
000B15 4B15 FE80             7      CP  080H
000B17 4B17 D8              11      RET C
000B18 4B18 FEA0             7      CP  0A0H
000B1A 4B1A 3803            12      JR  C,FKAN1
000B1C 4B1C FEE0             7      CP  0E0H
000B1E 4B1E D8              11      RET C
       4B1F                     FKAN1:
000B1F 4B1F 0C               4      INC C
000B20 4B20 A7               4      AND A
000B21 4B21 C9              10      RET
                                
       4B22                     CAP:
000B22 4B22 FE61             7      CP  'a'
000B24 4B24 D8              11      RET C
000B25 4B25 FE7B             7      CP  'z'+1
000B27 4B27 D0              11      RET NC
000B28 4B28 D620             7      SUB 020H
000B2A 4B2A C9              10      RET
       4B2B                     CAP2:
000B2B 4B2B CD224B          17      CALL    CAP
       4B2E                     CAP3:               ;
000B2E 4B2E FE05             7      CP  5
000B30 4B30 2803            12      JR  Z,CAP4
000B32 4B32 FE21             7      CP  021H
000B34 4B34 C9              10      RET
       4B35                     CAP4:
000B35 4B35 3EE5             7      LD  A,0E5H
000B37 4B37 C9              10      RET
                                
       4B38                     ROM_OPEN:
000B38 4B38 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
                                
000B3B 4B3B CDA54D          17      CALL    GET_DIR_DAT
000B3E 4B3E D5              11      PUSH    DE
000B3F 4B3F CD544B          17      CALL    FILESE
000B42 4B42 D1              10      POP DE
000B43 4B43 3F               4      CCF
000B44 4B44 D8              11      RET C
000B45 4B45 2247F1          16      LD  (DIRENT1),HL
000B48 4B48 E5              11      PUSH    HL
000B49 4B49 210000          10      LD  HL,0
000B4C 4B4C 2226F1          16      LD  (RR_LOW),HL
000B4F 4B4F 2228F1          16      LD  (RR_HIGH),HL
000B52 4B52 E1              10      POP HL
000B53 4B53 C9              10      RET
                                
       4B54                     FILESE:
000B54 4B54 7E               7      LD  A,(HL)
000B55 4B55 B7               4      OR  A
000B56 4B56 C8              11      RET Z       ;END:ZF=1 CF=0
000B57 4B57 FEE5             7      CP  0E5H
000B59 4B59 280D            12      JR  Z,FILESE1
000B5B 4B5B 1151F1          10      LD  DE,FNAME
000B5E 4B5E E5              11      PUSH    HL
000B5F 4B5F CDA54B          17      CALL    CPFILE
000B62 4B62 CCC64B          17      CALL    Z,CPFILE2
000B65 4B65 E1              10      POP HL
000B66 4B66 37               4      SCF
000B67 4B67 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B68                     FILESE1:
000B68 4B68 CD704B          17      CALL    FNEXT
000B6B 4B6B 20E7            12      JR  NZ,FILESE
000B6D 4B6D F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B6F 4B6F C9              10      RET
                                
       4B70                     FNEXT:
000B70 4B70 112000          10      LD  DE,020H
000B73 4B73 19              11      ADD HL,DE
000B74 4B74 ED5B5EF1        20      LD  DE,(_CDX)
000B78 4B78 7A               4      LD  A,D
000B79 4B79 B3               4      OR  E
000B7A 4B7A 2019            12      JR  NZ,FNEXT_SUBDIR
000B7C 4B7C 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       4B7D                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B7D 4B7D F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B7E 4B7E CB7C             8      BIT 7,H
000B80 4B80 2811            12      JR  Z,CHECK_DIR_PAGE1
000B82 4B82 7C               4      LD  A,H
000B83 4B83 D620             7      SUB 020H
000B85 4B85 67               4      LD  H,A
000B86 4B86 3A49F1          13      LD  A,(_DIR_BANK)
000B89 4B89 3C               4      INC A
000B8A 4B8A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B8D 4B8D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B90 4B90 3249F1          13      LD  (_DIR_BANK),A
       4B93                     CHECK_DIR_PAGE1:
000B93 4B93 F1              10      POP AF
                                #endif
000B94 4B94 C9              10      RET
                                
       4B95                     FNEXT_SUBDIR:           ;サブディレクトリ
000B95 4B95 0D               4      DEC C
000B96 4B96 C0              11      RET NZ
                                
000B97 4B97 ED5B5EF1        20      LD  DE,(_CDX)
000B9B 4B9B CDCE4C          17      CALL    GNCL
000B9E 4B9E EB               4      EX  DE,HL
000B9F 4B9F 225EF1          16      LD  (_CDX),HL
000BA2 4BA2 C3E04D          10      JP  GET_SUBDIR
                                
       4BA5                     CPFILE:
000BA5 4BA5 C5              11      PUSH    BC
000BA6 4BA6 01000B          10      LD  BC,00B00H
       4BA9                     CPSTR1:
000BA9 4BA9 1A               7      LD  A,(DE)
000BAA 4BAA FE3F             7      CP  '?'     ;Wild card
000BAC 4BAC 2812            12      JR  Z,CPSTR2
000BAE 4BAE 7E               7      LD  A,(HL)
000BAF 4BAF CD064B          17      CALL    FKANC
000BB2 4BB2 E5              11      PUSH    HL
000BB3 4BB3 67               4      LD  H,A
000BB4 4BB4 1A               7      LD  A,(DE)
000BB5 4BB5 CB01             4      RLC C
000BB7 4BB7 CD064B          17      CALL    FKANC
000BBA 4BBA CB09             4      RRC C
000BBC 4BBC BC               4      CP  H       ;CP (HL),(DE)
000BBD 4BBD E1              10      POP HL
000BBE 4BBE 2004            12      JR  NZ,CPSTR3
       4BC0                     CPSTR2:
000BC0 4BC0 13               6      INC DE
000BC1 4BC1 23               6      INC HL
000BC2 4BC2 10E5            13      DJNZ    CPSTR1
       4BC4                     CPSTR3:
000BC4 4BC4 C1              10      POP BC
000BC5 4BC5 C9              10      RET
                                
       4BC6                     CPFILE2:
                                ;   LD  A,0E1H
000BC6 4BC6 3EF1             7      LD  A,0F1H
000BC8 4BC8 2F               4      CPL
000BC9 4BC9 A6               7      AND (HL)
000BCA 4BCA C9              10      RET
                                
       4BCB                     RBX1:
000BCB 4BCB E5              11      PUSH    HL      ;Record byte
                                
000BCC 4BCC ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000BD0 4BD0 3A29F1          13      LD  A,(RR_HIGH+1)
000BD3 4BD3 4F               4      LD  C,A
                                
000BD4 4BD4 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000BD7 4BD7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BDA 4BDA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000BDD 4BDD FD2A47F1        20      LD  IY,(DIRENT1)
000BE1 4BE1 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BE4 4BE4 FD661D          19      LD  H,(IY+01DH)
000BE7 4BE7 FD7E1E          19      LD  A,(IY+01EH)
                                
000BEA 4BEA A7               4      AND A
000BEB 4BEB ED52            15      SBC HL,DE
000BED 4BED 99               4      SBC A,C
000BEE 4BEE D1              10      POP DE
                                
000BEF 4BEF D8              11      RET C
000BF0 4BF0 4F               4      LD  C,A
000BF1 4BF1 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BF2 4BF2 B2               4      OR  D
000BF3 4BF3 B3               4      OR  E
000BF4 4BF4 C0              11      RET NZ
000BF5 4BF5 37               4      SCF
000BF6 4BF6 C9              10      RET
                                
       4BF7                     RBX2:
000BF7 4BF7 ED4B27F1        20      LD  BC,(RR_LOW+1)
000BFB 4BFB CD7F4C          17      CALL    RWXR
000BFE 4BFE 3A23F1          13      LD  A,(CLSZ_H)
000C01 4C01 3D               4      DEC A
000C02 4C02 E5              11      PUSH    HL
000C03 4C03 2A26F1          16      LD  HL,(RR_LOW)
000C06 4C06 A4               4      AND H
000C07 4C07 B5               4      OR  L
000C08 4C08 E1              10      POP HL
000C09 4C09 C9              10      RET
                                
       4C0A                     RBXA:
000C0A 4C0A D5              11      PUSH    DE
000C0B 4C0B CDF14C          17      CALL    CLUST
000C0E 4C0E ED532EF1        20      LD  (_DTPS),DE
000C12 4C12 D1              10      POP DE
000C13 4C13 CDCE4C          17      CALL    GNCL
000C16 4C16 D8              11      RET C
000C17 4C17 ED532AF1        20      LD  (_CLPS),DE
                                
000C1B 4C1B ED4B26F1        20      LD  BC,(RR_LOW)
000C1F 4C1F 2A22F1          16      LD  HL,(CLSZ)
000C22 4C22 7C               4      LD  A,H
000C23 4C23 3D               4      DEC A
000C24 4C24 A0               4      AND B
000C25 4C25 47               4      LD  B,A
000C26 4C26 ED42            15      SBC HL,BC       ;remaining cluster
                                
000C28 4C28 ED5B4AF1        20      LD  DE,(LEFTX)
000C2C 4C2C ED52            15      SBC HL,DE       ;CP HL,DE
000C2E 4C2E 19              11      ADD HL,DE
000C2F 4C2F 3801            12      JR  C,RBXA1
000C31 4C31 EB               4      EX  DE,HL
       4C32                     RBXA1:
000C32 4C32 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C35 4C35 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C38 4C38 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C3B 4C3B E5              11      PUSH    HL
000C3C 4C3C 2A2EF1          16      LD  HL,(_DTPS)
000C3F 4C3F 09              11      ADD HL,BC
000C40 4C40 ED5B43F1        20      LD  DE,(DTAX)
000C44 4C44 C1              10      POP BC
000C45 4C45 C9              10      RET
                                
       4C46                     RBXB:
000C46 4C46 2A43F1          16      LD  HL,(DTAX)
000C49 4C49 ED5B2AF1        20      LD  DE,(_CLPS)
000C4D 4C4D 3A4BF1          13      LD  A,(LEFTX+1)
000C50 4C50 47               4      LD  B,A
000C51 4C51 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C54                     RBXB1:
000C54 4C54 1F               4      RRA     ;->CF
000C55 4C55 3804            12      JR  C,RBXB2
000C57 4C57 CB38             8      SRL B   ;B=B/2
000C59 4C59 18F9            12      JR  RBXB1
       4C5B                     RBXB2:
000C5B 4C5B 78               4      LD  A,B
000C5C 4C5C B7               4      OR  A
000C5D 4C5D C9              10      RET
                                
       4C5E                     RBXC:
000C5E 4C5E ED4B4AF1        20      LD  BC,(LEFTX)
000C62 4C62 3A23F1          13      LD  A,(CLSZ_H)
000C65 4C65 3D               4      DEC A
000C66 4C66 A0               4      AND B
000C67 4C67 47               4      LD  B,A
000C68 4C68 B1               4      OR  C
000C69 4C69 C9              10      RET
                                
       4C6A                     RBXEND:
000C6A 4C6A ED5B2CF1        20      LD  DE,(_LEFT)
000C6E 4C6E 2A26F1          16      LD  HL,(RR_LOW)
000C71 4C71 3A29F1          13      LD  A,(RR_HIGH+1)
000C74 4C74 19              11      ADD HL,DE
000C75 4C75 CE00             7      ADC A,0
000C77 4C77 2226F1          16      LD  (RR_LOW),HL
000C7A 4C7A 3229F1          13      LD  (RR_HIGH+1),A
000C7D 4C7D EB               4      EX  DE,HL       ;HL=Read byte
000C7E 4C7E C9              10      RET 
                                
       4C7F                     RWXR:
000C7F 4C7F 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C82                     L_RWX:
000C82 4C82 1F               4      RRA     ;->CF
000C83 4C83 3806            12      JR  C,E_RWX
000C85 4C85 CB38             8      SRL B   ;BC=BC/2
000C87 4C87 CB19             8      RR  C   ;
000C89 4C89 18F7            12      JR  L_RWX
       4C8B                     E_RWX:
000C8B 4C8B 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C8E 4C8E 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C91 4C91 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C94 4C94 FD2A47F1        20      LD  IY,(DIRENT1)
000C98 4C98 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C9B 4C9B FD561B          19      LD  D,(IY+01BH)
000C9E 4C9E CDFC4F          17      CALL    GET_DISK_BANK_FDRV
       4CA1                     RWX1:
000CA1 4CA1 ED532AF1        20      LD  (_CLPS),DE
000CA5 4CA5 7A               4      LD  A,D
000CA6 4CA6 B3               4      OR  E
000CA7 4CA7 37               4      SCF
000CA8 4CA8 C8              11      RET Z
                                
000CA9 4CA9 78               4      LD  A,B
000CAA 4CAA B1               4      OR  C
000CAB 4CAB C8              11      RET Z
                                
000CAC 4CAC CDCE4C          17      CALL    GNCL
000CAF 4CAF D8              11      RET C
000CB0 4CB0 0B               6      DEC BC
000CB1 4CB1 CD3E4D          17      CALL    ENDCL
000CB4 4CB4 38EB            12      JR  C,RWX1
000CB6 4CB6 37               4      SCF
000CB7 4CB7 C9              10      RET
                                
       4CB8                     NCL3:
000CB8 4CB8 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
000CBB 4CBB 6B               4      LD  L,E
000CBC 4CBC 62               4      LD  H,D
000CBD 4CBD CB3C             8      SRL H
000CBF 4CBF CB1D             8      RR  L
000CC1 4CC1 1F               4      RRA
000CC2 4CC2 19              11      ADD HL,DE
000CC3 4CC3 010060          10      LD  BC,BANK1_ADR
000CC6 4CC6 09              11      ADD HL,BC
000CC7 4CC7 ED4B24F1        20      LD  BC,(SECSZ)
000CCB 4CCB 09              11      ADD HL,BC
000CCC 4CCC 17               4      RLA
000CCD 4CCD C9              10      RET
                                
       4CCE                     GNCL:
000CCE 4CCE 7A               4      LD  A,D
000CCF 4CCF B3               4      OR  E
000CD0 4CD0 37               4      SCF
000CD1 4CD1 C8              11      RET Z
000CD2 4CD2 C5              11      PUSH    BC
000CD3 4CD3 E5              11      PUSH    HL
000CD4 4CD4 CDB84C          17      CALL    NCL3
000CD7 4CD7 3809            12      JR  C,GNC1
000CD9 4CD9 5E               7      LD  E,(HL)
000CDA 4CDA 23               6      INC HL
000CDB 4CDB 7E               7      LD  A,(HL)
000CDC 4CDC E60F             7      AND 00FH
000CDE 4CDE 57               4      LD  D,A
000CDF 4CDF E1              10      POP HL
000CE0 4CE0 C1              10      POP BC
000CE1 4CE1 C9              10      RET
       4CE2                     GNC1:
000CE2 4CE2 7E               7      LD  A,(HL)
000CE3 4CE3 23               6      INC HL
000CE4 4CE4 56               7      LD  D,(HL)
000CE5 4CE5 0604             7      LD  B,4
       4CE7                     GNC1L:
000CE7 4CE7 CB3A             8      SRL D
000CE9 4CE9 1F               4      RRA
000CEA 4CEA 10FB            13      DJNZ    GNC1L
                                
000CEC 4CEC 5F               4      LD  E,A
000CED 4CED E1              10      POP HL
000CEE 4CEE C1              10      POP BC
000CEF 4CEF A7               4      AND A
000CF0 4CF0 C9              10      RET
                                
       4CF1                     CLUST:
000CF1 4CF1 EB               4      EX  DE,HL
       4CF2                     CLUST_HL:
000CF2 4CF2 C5              11      PUSH    BC
000CF3 4CF3 3A23F1          13      LD  A,(CLSZ_H)
000CF6 4CF6 CD2850          17      CALL    MUL_AHL
                                
000CF9 4CF9 CDC24D          17      CALL    GET_DIR_POS
000CFC 4CFC 4F               4      LD  C,A
000CFD 4CFD 0600             7      LD  B,0
000CFF 4CFF 09              11      ADD HL,BC
                                
000D00 4D00 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000D03 4D03 1F               4      RRA
000D04 4D04 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D07 4D07 1F               4      RRA
000D08 4D08 0F               4      RRCA
000D09 4D09 0F               4      RRCA
000D0A 4D0A 0F               4      RRCA
000D0B 4D0B 4F               4      LD  C,A
                                
000D0C 4D0C 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D0F 4D0F FE02             7      CP  2
000D11 4D11 280C            12      JR  Z,CLUST1
000D13 4D13 CB01             4      RLC C
000D15 4D15 0D               4      DEC C
000D16 4D16 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000D19 4D19 FE02             7      CP  2
000D1B 4D1B 2002            12      JR  NZ,CLUST1
000D1D 4D1D 0D               4      DEC C
000D1E 4D1E 0D               4      DEC C
       4D1F                     CLUST1:
000D1F 4D1F 0D               4      DEC C
000D20 4D20 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000D21 4D21 4D               4      LD  C,L     ;C=読み出し元
000D22 4D22 29              11      ADD HL,HL   ;64KB→32KB
000D23 4D23 29              11      ADD HL,HL   ;32KB→16KB
000D24 4D24 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D25 4D25 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
000D28 4D28 84               4      ADD A,H
000D29 4D29 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D2C 4D2C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D2F 4D2F 3220F1          13      LD  (_BANK),A
000D32 4D32 69               4      LD  L,C     ;C=読み出し元
000D33 4D33 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D35 4D35 A5               4      AND L
                                #endif
       4D36                     CLUST2:
000D36 4D36 C660             7      ADD A,high BANK1_ADR
000D38 4D38 67               4      LD  H,A
000D39 4D39 2E00             7      LD  L,0
000D3B 4D3B EB               4      EX  DE,HL
000D3C 4D3C C1              10      POP BC
000D3D 4D3D C9              10      RET
                                
       4D3E                     ENDCL:
000D3E 4D3E 7A               4      LD  A,D ;END CLUSTER
000D3F 4D3F FE0F             7      CP  00FH    ;FAT12の最大値
000D41 4D41 C0              11      RET NZ
000D42 4D42 7B               4      LD  A,E
000D43 4D43 FEF7             7      CP  0F7H
000D45 4D45 C9              10      RET
                                
       4D46                     RB_READ:
000D46 4D46 AF               4      XOR A   ;HLA = HL*128
000D47 4D47 CB3C             8      SRL H
000D49 4D49 CB1D             8      RR  L
000D4B 4D4B 1F               4      RRA
000D4C 4D4C 3226F1          13      LD  (RR_LOW),A
000D4F 4D4F 2227F1          16      LD  (RR_MID),HL
000D52 4D52 218000          10      LD  HL,128
                                
000D55 4D55 CD1D49          17      CALL    ROM_READ
000D58 4D58 C9              10      RET
                                
       4D59                     GETSEQ:
000D59 4D59 FD6E20          19      LD  L,(IY+32)
000D5C 4D5C FD660C          19      LD  H,(IY+12)
                                
000D5F 4D5F CB25             8      SLA L
                                
000D61 4D61 CB3C             8      SRL H
000D63 4D63 CB1D             8      RR  L
000D65 4D65 C9              10      RET
                                
       4D66                     SETSEQ:
000D66 4D66 F5              11      PUSH    AF
000D67 4D67 3A26F1          13      LD  A,(RR_LOW)
000D6A 4D6A 2A27F1          16      LD  HL,(RR_MID)
                                
000D6D 4D6D CD844D          17      CALL    SSQ1
                                
000D70 4D70 29              11      ADD HL,HL
000D71 4D71 CB3D             8      SRL L
000D73 4D73 FD7520          19      LD  (IY+32),L
000D76 4D76 FD740C          19      LD  (IY+12),H
000D79 4D79 F1              10      POP AF
000D7A 4D7A C9              10      RET
                                
       4D7B                     GETSIZE:
000D7B 4D7B FD7E10          19      LD  A,(IY+16)
000D7E 4D7E FD6E11          19      LD  L,(IY+17)
000D81 4D81 FD6612          19      LD  H,(IY+18)
       4D84                     SSQ1:
000D84 4D84 87               4      ADD A,A
000D85 4D85 ED6A            15      ADC HL,HL
000D87 4D87 B7               4      OR  A
000D88 4D88 C8              11      RET Z
000D89 4D89 23               6      INC HL
000D8A 4D8A C9              10      RET
                                
       4D8B                     SET_FCB:
000D8B 4D8B D5              11      PUSH    DE
000D8C 4D8C FDE1            14      POP IY
000D8E 4D8E FD7E1C          19      LD  A,(IY+28)
000D91 4D91 FEFF             7      CP  0FFH
000D93 4D93 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D95 4D95 E5              11      PUSH    HL
000D96 4D96 FD6E1A          19      LD  L,(IY+26)
000D99 4D99 FD661B          19      LD  H,(IY+27)
000D9C 4D9C 222AF1          16      LD  (_CLPS),HL
000D9F 4D9F E1              10      POP HL
000DA0 4DA0 C9              10      RET
                                
       4DA1                     POPAF_SCF_FF_RET:
000DA1 4DA1 F1              10      POP AF
000DA2 4DA2 37               4      SCF
000DA3 4DA3 9F               4      SBC A,A
000DA4 4DA4 C9              10      RET
                                
       4DA5                     GET_DIR_DAT:
000DA5 4DA5 2A5EF1          16      LD  HL,(_CDX)
000DA8 4DA8 7C               4      LD  A,H
000DA9 4DA9 B5               4      OR  L
000DAA 4DAA 2034            12      JR  NZ,GET_SUBDIR
000DAC 4DAC CDC24D          17      CALL    GET_DIR_POS
000DAF 4DAF C660             7      ADD A,high BANK1_ADR
000DB1 4DB1 2E00             7      LD  L,0
000DB3 4DB3 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000DB4 4DB4 CD7D4B          17      CALL    CHECK_DIR_PAGE
                                #endif
000DB7 4DB7 3A21F1          13      LD  A,(_BANK1)
000DBA 4DBA 3249F1          13      LD  (_DIR_BANK),A
                                
000DBD 4DBD 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000DC0 4DC0 4F               4      LD  C,A
000DC1 4DC1 C9              10      RET
                                
       4DC2                     GET_DIR_POS:                ;ルートディレクトリ
000DC2 4DC2 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
000DC5 4DC5 3221F1          13      LD  (_BANK1),A
000DC8 4DC8 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000DCB 4DCB 47               4      LD  B,A
000DCC 4DCC 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000DCF 4DCF 4F               4      LD  C,A
000DD0 4DD0 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DD3                     GET_DIR_POS1:
000DD3 4DD3 81               4      ADD A,C
000DD4 4DD4 10FD            13      DJNZ    GET_DIR_POS1
                                
000DD6 4DD6 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4DDA                     L_MDP:
000DDA 4DDA CB18             8      RR  B   ;->CF
000DDC 4DDC D8              11      RET C
000DDD 4DDD 87               4      ADD A,A
000DDE 4DDE 18FA            12      JR  L_MDP
                                
       4DE0                     GET_SUBDIR:             ;サブディレクトリ
000DE0 4DE0 CDF24C          17      CALL    CLUST_HL
000DE3 4DE3 EB               4      EX  DE,HL
000DE4 4DE4 3A20F1          13      LD  A,(_BANK)
000DE7 4DE7 3249F1          13      LD  (_DIR_BANK),A
000DEA 4DEA 3A23F1          13      LD  A,(CLSZ_H)
000DED 4DED 87               4      ADD A,A     ;*2
000DEE 4DEE 87               4      ADD A,A     ;*4
000DEF 4DEF 87               4      ADD A,A     ;*8
000DF0 4DF0 4F               4      LD  C,A
000DF1 4DF1 C9              10      RET
                                
       4DF2                     STATEMENT:
000DF2 4DF2 1189FD          10      LD  DE,PROCNM
000DF5 4DF5 1A               7      LD  A,(DE)
000DF6 4DF6 FE43             7      CP  'C'
000DF8 4DF8 37               4      SCF
000DF9 4DF9 C0              11      RET NZ
000DFA 4DFA 13               6      INC DE
000DFB 4DFB 1A               7      LD  A,(DE)
000DFC 4DFC FE48             7      CP  'H'
000DFE 4DFE 37               4      SCF
000DFF 4DFF C0              11      RET NZ
000E00 4E00 13               6      INC DE
000E01 4E01 1A               7      LD  A,(DE)
000E02 4E02 FE44             7      CP  'D'
000E04 4E04 37               4      SCF
000E05 4E05 C0              11      RET NZ
000E06 4E06 13               6      INC DE
000E07 4E07 1A               7      LD  A,(DE)
000E08 4E08 FE49             7      CP  'I'
000E0A 4E0A 37               4      SCF
000E0B 4E0B C0              11      RET NZ
000E0C 4E0C 13               6      INC DE
000E0D 4E0D 1A               7      LD  A,(DE)
000E0E 4E0E FE52             7      CP  'R'
000E10 4E10 37               4      SCF
000E11 4E11 C0              11      RET NZ
000E12 4E12 13               6      INC DE
000E13 4E13 1A               7      LD  A,(DE)
000E14 4E14 C6FF             7      ADD A,0FFH
000E16 4E16 D8              11      RET C
000E17 4E17 7E               7      LD  A,(HL)
000E18 4E18 FE28             7      CP  '('
000E1A 4E1A 37               4      SCF
000E1B 4E1B C0              11      RET NZ
000E1C 4E1C CDCC46          17      CALL    INIT_PARAM
000E1F 4E1F CDBD49          17      CALL    FILE_B
000E22 4E22 CD294E          17      CALL    ROM_CD
000E25 4E25 DA9845          10      JP  C,ERROR_FILE_NOT_FOUND
000E28 4E28 C9              10      RET
                                
       4E29                     ROM_CD:
000E29 4E29 3A51F1          13      LD  A,(FNAME)
000E2C 4E2C FE20             7      CP  020H
000E2E 4E2E 2822            12      JR  Z,CD1
000E30 4E30 CD384B          17      CALL    ROM_OPEN
000E33 4E33 D8              11      RET C
000E34 4E34 FD2A47F1        20      LD  IY,(DIRENT1)
000E38 4E38 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E3C 4E3C CA9845          10      JP  Z,ERROR_FILE_NOT_FOUND
000E3F 4E3F FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E42 4E42 FD661B          19      LD  H,(IY+01BH)
       4E45                     CD2:
000E45 4E45 225CF1          16      LD  (_CD),HL
000E48 4E48 2A4EF1          16      LD  HL,(PARAM1)
       4E4B                     CD_SKIP:
000E4B 4E4B 7E               7      LD  A,(HL)
000E4C 4E4C 23               6      INC HL
000E4D 4E4D FE21             7      CP  021H
000E4F 4E4F 38FA            12      JR  C,CD_SKIP
000E51 4E51 C9              10      RET
       4E52                     CD1:
000E52 4E52 2A5EF1          16      LD  HL,(_CDX)
000E55 4E55 18EE            12      JR  CD2
                                
       4E57                     ERROR_ST:
000E57 4E57 C9              10      RET
                                
       4E58                     WILDCARD:
000E58 4E58 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4E63                     ERROR_WRITE_PROTECTED:
000E63 4E63 3E00             7      LD  A,0     ;Write protected
000E65 4E65 C9              10      RET
       4E66                     DISKIO:
000E66 4E66 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000E68 4E68 48               4      LD  C,B
000E69 4E69 CD0650          17      CALL    GET_DISK_BANK
       4E6C                     SETMAP1:        
000E6C 4E6C E5              11      PUSH    HL
       4E6D                     DISKIO1:
000E6D 4E6D C5              11      PUSH    BC      ;B=残りのセクタ数
000E6E 4E6E D5              11      PUSH    DE      ;DE=セクタ番号
000E6F 4E6F F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000E70 4E70 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000E71 4E71 F5              11      PUSH    AF
000E72 4E72 3A25F1          13      LD  A,(SECSZ_H)
000E75 4E75 CD2850          17      CALL    MUL_AHL
000E78 4E78 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000E79 4E79 4D               4      LD  C,L     ;C=読み出し元
000E7A 4E7A 29              11      ADD HL,HL       ;64KB→32KB
000E7B 4E7B 29              11      ADD HL,HL       ;32KB→16KB
000E7C 4E7C 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000E7D 4E7D 84               4      ADD A,H
000E7E 4E7E 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000E81 4E81 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000E84 4E84 3220F1          13      LD  (_BANK),A
000E87 4E87 79               4      LD  A,C     ;C=読み出し元
000E88 4E88 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4E8A                     DISKIO2:
000E8A 4E8A C660             7      ADD A,high BANK1_ADR
000E8C 4E8C 67               4      LD  H,A
000E8D 4E8D ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000E91 4E91 69               4      LD  L,C     ;C=0
000E92 4E92 CD4144          17      CALL    ROM_LDIR
000E95 4E95 EB               4      EX  DE,HL
000E96 4E96 F1              10      POP AF
000E97 4E97 D1              10      POP DE
000E98 4E98 13               6      INC DE
000E99 4E99 C1              10      POP BC
000E9A 4E9A 10D1            13      DJNZ    DISKIO1
000E9C 4E9C 41               4      LD  B,C
                                
000E9D 4E9D E1              10      POP HL
000E9E 4E9E AF               4      XOR A
                                
000E9F 4E9F FB               4      EI
000EA0 4EA0 C9              10      RET
                                
       4EA1                     DSKCHG:
000EA1 4EA1 CDDA4E          17      CALL    IS_BPB
000EA4 4EA4 3824            12      JR  C,NOTREADY
000EA6 4EA6 3A23FB          13      LD  A,(DRVTBL+2)
000EA9 4EA9 B7               4      OR  A
000EAA 4EAA 201A            12      JR  NZ,DSKCHG1
000EAC 4EAC 3A21FB          13      LD  A,(DRVTBL)
000EAF 4EAF FE02             7      CP  2
000EB1 4EB1 2013            12      JR  NZ,DSKCHG1
000EB3 4EB3 CDDA4E          17      CALL    IS_BPB
000EB6 4EB6 300E            12      JR  NC,DSKCHG1
000EB8 4EB8 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000EBA 4EBA 3221FB          13      LD  (DRVTBL),A
000EBD 4EBD 3223FB          13      LD  (DRVTBL+2),A
000EC0 4EC0 3A48F3          13      LD  A,(MASTERS)
000EC3 4EC3 3224FB          13      LD  (DRVTBL+3),A
       4EC6                     DSKCHG1:
000EC6 4EC6 AF               4      XOR A
000EC7 4EC7 0601             7      LD  B,1
000EC9 4EC9 C9              10      RET
       4ECA                     NOTREADY:
000ECA 4ECA 3E02             7      LD  A,2
000ECC 4ECC 37               4      SCF
000ECD 4ECD C9              10      RET
                                
       4ECE                     NO_BPB:
000ECE 4ECE E1              10      POP HL
000ECF 4ECF 23               6      INC HL
000ED0 4ED0 112E50          10      LD  DE,DPB2DD
000ED3 4ED3 011200          10      LD  BC,DPB2DD_E-DPB2DD
000ED6 4ED6 EDB0                    LDIR
000ED8 4ED8 AF               4      XOR A
000ED9 4ED9 C9              10      RET
                                
       4EDA                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000EDA 4EDA CD0650          17      CALL    GET_DISK_BANK
                                
000EDD 4EDD 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000EE0 4EE0 FE01             7      CP  1
000EE2 4EE2 D8              11      RET C
                                
000EE3 4EE3 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000EE6 4EE6 C6FF             7      ADD A,0FFH
000EE8 4EE8 D8              11      RET C
                                
000EE9 4EE9 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000EEC 4EEC FE01             7      CP  1
000EEE 4EEE C8              11      RET Z
000EEF 4EEF FE02             7      CP  2
000EF1 4EF1 C8              11      RET Z
000EF2 4EF2 FE04             7      CP  4
000EF4 4EF4 C8              11      RET Z
000EF5 4EF5 37               4      SCF
000EF6 4EF6 C9              10      RET
                                
       4EF7                     GETDPB:
000EF7 4EF7 E5              11      PUSH    HL
000EF8 4EF8 CD0650          17      CALL    GET_DISK_BANK
                                
000EFB 4EFB 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000EFE 4EFE B7               4      OR  A
000EFF 4EFF 28CD            12      JR  Z,NO_BPB
000F01 4F01 DDE1            14      POP IX
000F03 4F03 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F06 4F06 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F09 4F09 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F0C 4F0C 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F0F 4F0F DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F12 4F12 87               4      ADD A,A
000F13 4F13 87               4      ADD A,A
000F14 4F14 87               4      ADD A,A
000F15 4F15 3D               4      DEC A
000F16 4F16 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F19 4F19 06FF             7      LD  B,-1
000F1B 4F1B A7               4      AND A           ;無限ループ阻止
       4F1C                     GETDPB1:
000F1C 4F1C 04               4      INC B
000F1D 4F1D 1F               4      RRA
000F1E 4F1E 38FC            12      JR  C,GETDPB1
000F20 4F20 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F23 4F23 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F26 4F26 3D               4      DEC A
000F27 4F27 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F2A 4F2A A7               4      AND A           ;無限ループ阻止
000F2B 4F2B 06FF             7      LD  B,-1
       4F2D                     GETDPB2:
000F2D 4F2D 04               4      INC B
000F2E 4F2E 1F               4      RRA
000F2F 4F2F 38FC            12      JR  C,GETDPB2
000F31 4F31 04               4      INC B
000F32 4F32 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000F35 4F35 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000F38 4F38 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000F3B 4F3B DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000F3E 4F3E 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000F41 4F41 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000F44 4F44 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000F47 4F47 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000F4A 4F4A ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000F4E 4F4E DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000F51 4F51 DD460A          19      LD  B,(IX+10)       ;FATCNT
000F54 4F54 210000          10      LD  HL,0
       4F57                     GETDPB3:
000F57 4F57 19              11      ADD HL,DE
000F58 4F58 10FD            13      DJNZ    GETDPB3
       4F5A                     GETDPB4:
000F5A 4F5A DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000F5D 4F5D DD5609          19      LD  D,(IX+9)        ;FIRFAT
000F60 4F60 19              11      ADD HL,DE
000F61 4F61 DD7511          19      LD  (IX+17),L       ;FIRDIR
000F64 4F64 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000F67 4F67 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F6A 4F6A 87               4      ADD A,A
000F6B 4F6B 87               4      ADD A,A
000F6C 4F6C DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F6F                     GETDPB5:
000F6F 4F6F CB3B             8      SRL E
000F71 4F71 1F               4      RRA
000F72 4F72 30FB            12      JR  NC,GETDPB5
000F74 4F74 1600             7      LD  D,0
000F76 4F76 19              11      ADD HL,DE
000F77 4F77 DD750C          19      LD  (IX+12),L       ;FIRREC
000F7A 4F7A DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000F7D 4F7D 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000F80 4F80 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000F83 4F83 DD560D          19      LD  D,(IX+13)       ;FIRREC
000F86 4F86 A7               4      AND A
000F87 4F87 ED52            15      SBC HL,DE
                                
000F89 4F89 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000F8C 4F8C 3C               4      INC A
000F8D 4F8D 37               4      SCF             ;無限ループ阻止
       4F8E                     GETDPB6:
000F8E 4F8E 1F               4      RRA
000F8F 4F8F 3806            12      JR  C,GETDPB7
000F91 4F91 CB3C             8      SRL H
000F93 4F93 CB1D             8      RR  L
000F95 4F95 18F7            12      JR  GETDPB6
       4F97                     GETDPB7:
000F97 4F97 23               6      INC HL
000F98 4F98 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000F9B 4F9B DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4F9E                     GETDPBD1:
000F9E 4F9E DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FA1 4FA1 E6FC             7      AND 0FCH
000FA3 4FA3 C8              11      RET Z
                                
000FA4 4FA4 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000FA8 4FA8 37               4      SCF
000FA9 4FA9 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000FAD 4FAD DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000FB0 4FB0 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000FB4 4FB4 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000FB8 4FB8 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000FBC 4FBC DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000FC0 4FC0 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000FC4 4FC4 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000FC8 4FC8 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000FCC 4FCC DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000FCF 4FCF DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000FD2 4FD2 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FD5 4FD5 87               4      ADD A,A
000FD6 4FD6 87               4      ADD A,A
000FD7 4FD7 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4FDA                     GETDPBD5:
000FDA 4FDA CB3B             8      SRL E
000FDC 4FDC 1F               4      RRA
000FDD 4FDD 30FB            12      JR  NC,GETDPBD5
000FDF 4FDF 1600             7      LD  D,0
000FE1 4FE1 19              11      ADD HL,DE
000FE2 4FE2 DD750C          19      LD  (IX+12),L       ;FIRREC
000FE5 4FE5 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FE8 4FE8 18B4            12      JR  GETDPBD1
                                
       4FEA                     CHOICE:
000FEA 4FEA 210000          10      LD  HL,0
000FED 4FED C9              10      RET
                                
       4FEE                     DSKFMT:
000FEE 4FEE AF               4      XOR A
000FEF 4FEF 37               4      SCF
       4FF0                     DSKSTP:
000FF0 4FF0 C9              10      RET
                                
       4FF1                     BASENT:
000FF1 4FF1 ED7B60F1        20      LD  SP,(BASSTK)
000FF5 4FF5 C3D543          10      JP  BASAUTO
                                
       4FF8                     GETSLT:
000FF8 4FF8 3A22FB          13      LD  A,(DRVTBL+1)
000FFB 4FFB C9              10      RET
                                
       4FFC                     GET_DISK_BANK_FDRV:
000FFC 4FFC 3A50F1          13      LD  A,(FDRV)
000FFF 4FFF D601             7      SUB 1
001001 5001 3003            12      JR  NC,GET_DISK_BANK
001003 5003 3A46F1          13      LD  A,(_DVSW)
       5006                     GET_DISK_BANK:
001006 5006 B7               4      OR  A       ;A=DRIVE
001007 5007 3E01             7      LD  A,DISK_BANK
001009 5009 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
00100B 500B 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       500E                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
00100E 500E 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001011 5011 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001014 5014 F5              11      PUSH    AF
001015 5015 E5              11      PUSH    HL
001016 5016 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001019 5019 2224F1          16      LD  (SECSZ),HL
00101C 501C 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
00101F 501F CD2850          17      CALL    MUL_AHL
001022 5022 2222F1          16      LD  (CLSZ),HL
001025 5025 E1              10      POP HL
001026 5026 F1              10      POP AF
001027 5027 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5028                     MUL_AHL:
001028 5028 37               4      SCF     ;無限ループ回避
       5029                     MUL_AHL1:
001029 5029 1F               4      RRA     ;->CF
00102A 502A D8              11      RET C
00102B 502B 29              11      ADD HL,HL
00102C 502C 18FB            12      JR  MUL_AHL1
                                
       502E                     DPB2DD:
00102E 502E F9                      DB  0F9H    ;MEDIA
00102F 502F 0002                    DW  00200H  ;SECSIZ
001031 5031 0F                      DB  00FH    ;DIRMSK
001032 5032 04                      DB  004H    ;DIRSHFT
001033 5033 01                      DB  001H    ;CLUSMSK
001034 5034 02                      DB  002H    ;CLUSSHFT
001035 5035 0100                    DW  00001H  ;FIRFAT
001037 5037 02                      DB  002H    ;FATCNT
001038 5038 70                      DB  070H    ;MAXENT
001039 5039 0E00                    DW  0000EH  ;FIRREC
00103B 503B CA02                    DW  002CAH  ;MAXCLUS
00103D 503D 03                      DB  003H    ;FATSIZ
00103E 503E 0700                    DW  0007H   ;FIRDIR
       5040                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       5040                     POP_HL_ERROR:
001040 5040 E1              10      POP     HL
       5041                     _ERROR:
001041 5041 0600             7      LD  B,0
001043 5043 A7               4      AND A
001044 5044 C9              10      RET
                                
       5045                     ROM_BDOS:
001045 5045 E5              11      PUSH    HL
001046 5046 79               4      LD  A,C
001047 5047 87               4      ADD A,A
001048 5048 38F7            12      JR  C,_ERROR
00104A 504A 6F               4      LD  L,A
00104B 504B 265F             7      LD  H,high STABLE
00104D 504D 7E               7      LD  A,(HL)
00104E 504E 2C               4      INC L
00104F 504F 66               7      LD  H,(HL)
001050 5050 6F               4      LD  L,A
001051 5051 E3              19      EX  (SP),HL
001052 5052 79               4      LD  A,C
001053 5053 C9              10      RET
                                
       5054                     _PRINT:
       5054                     PRINT:
001054 5054 7B               4      LD  A,E
001055 5055 1803            12      JR  MSG_A
                                
       5057                     _SYS01:     ;(BDOS)コンソール入力
001057 5057 CDCE50          17      CALL    _SYS07
       505A                     MSG_A:
00105A 505A FE03             7      CP  3
00105C 505C 2814            12      JR  Z,MSG_BR
       505E                     MSGA1:
00105E 505E F5              11      PUSH    AF
00105F 505F C5              11      PUSH    BC
001060 5060 D5              11      PUSH    DE
001061 5061 E5              11      PUSH    HL
001062 5062 DDE5            15      PUSH    IX
001064 5064 DD21A200        14      LD  IX,CHPUT
001068 5068 CDFB42          17      CALL    CALSLT_R
00106B 506B DDE1            14      POP IX
00106D 506D E1              10      POP HL
00106E 506E D1              10      POP DE
00106F 506F C1              10      POP BC
       5070                     MSGA2:
001070 5070 F1              10      POP AF
001071 5071 C9              10      RET
       5072                     MSG_BR:
001072 5072 F5              11      PUSH    AF
001073 5073 3ADDF3          13      LD  A,(CSRX)
001076 5076 FE02             7      CP  2
001078 5078 38F6            12      JR  C,MSGA2
00107A 507A F1              10      POP AF
       507B                     MSG_CR:
00107B 507B F5              11      PUSH    AF
00107C 507C 3E0D             7      LD  A,00DH
00107E 507E CD5E50          17      CALL    MSGA1
001081 5081 3E0A             7      LD  A,00AH
001083 5083 CD5E50          17      CALL    MSGA1
001086 5086 F1              10      POP AF
001087 5087 C9              10      RET
                                
       5088                     _SYS02:     ;(BDOS)コンソール出力
001088 5088 CDA350          17      CALL    BREAK
00108B 508B 1805            12      JR  PRINTX
                                
       508D                     _SYS06:     ;(BDOS)コンソール直接入出力
00108D 508D 7B               4      LD  A,E
00108E 508E 3C               4      INC A
00108F 508F CAE250          10      JP  Z,_INKEY
       5092                     PRINTX:
001092 5092 C35450          10      JP  _PRINT
                                
       5095                     _SYS08:     ;(BDOS)エコーなしコンソール入力
001095 5095 CDCE50          17      CALL    _SYS07
001098 5098 FE03             7      CP  3
00109A 509A CCA350          17      CALL    Z,_BREAK
00109D 509D FE13             7      CP  013H        ;CTRL+S
00109F 509F C0              11      RET NZ
       50A0                     PAUSE:
0010A0 50A0 CDBA50          17      CALL    KEYBC
                                
       50A3                     _BREAK:
       50A3                     BREAK:
0010A3 50A3 F5              11      PUSH    AF
0010A4 50A4 C5              11      PUSH    BC
0010A5 50A5 D5              11      PUSH    DE
0010A6 50A6 E5              11      PUSH    HL
0010A7 50A7 DDE5            15      PUSH    IX
0010A9 50A9 DD21B700        14      LD  IX,BREAKX
0010AD 50AD CDFB42          17      CALL    CALSLT_R
0010B0 50B0 DDE1            14      POP IX
0010B2 50B2 E1              10      POP HL
0010B3 50B3 D1              10      POP DE
0010B4 50B4 C1              10      POP BC
0010B5 50B5 DCA350          17      CALL    C,_BREAK
0010B8 50B8 F1              10      POP AF
0010B9 50B9 C9              10      RET
       50BA                     KEYBC:
0010BA 50BA F5              11      PUSH    AF
0010BB 50BB C5              11      PUSH    BC
0010BC 50BC D5              11      PUSH    DE
0010BD 50BD E5              11      PUSH    HL
0010BE 50BE DDE5            15      PUSH    IX
0010C0 50C0 DD215601        14      LD  IX,KILBUF
0010C4 50C4 CDFB42          17      CALL    CALSLT_R
0010C7 50C7 DDE1            14      POP IX
0010C9 50C9 E1              10      POP HL
0010CA 50CA D1              10      POP DE
0010CB 50CB C1              10      POP BC
0010CC 50CC F1              10      POP AF
0010CD 50CD C9              10      RET
                                
       50CE                     _SYS07:
       50CE                     FLGET:
0010CE 50CE C5              11      PUSH    BC
0010CF 50CF D5              11      PUSH    DE
0010D0 50D0 E5              11      PUSH    HL
0010D1 50D1 DDE5            15      PUSH    IX
0010D3 50D3 DD219F00        14      LD  IX,CHGET
0010D7 50D7 CDFB42          17      CALL    CALSLT_R
0010DA 50DA DDE1            14      POP IX
0010DC 50DC E1              10      POP HL
0010DD 50DD D1              10      POP DE
0010DE 50DE C1              10      POP BC
0010DF 50DF FE03             7      CP  3
0010E1 50E1 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       50E2                     _INKEY:
       50E2                     INKEY:
0010E2 50E2 CD7C51          17      CALL    CPM_CONST
0010E5 50E5 C8              11      RET Z
0010E6 50E6 18E6            12      JR  FLGET
                                
       50E8                     _SYS0A:     ;(BDOS)文字列入力
0010E8 50E8 C5              11      PUSH    BC
0010E9 50E9 E5              11      PUSH    HL
0010EA 50EA D5              11      PUSH    DE
0010EB 50EB CD1451          17      CALL    GETL
0010EE 50EE 111FF4          10      LD  DE,KBUF
0010F1 50F1 E1              10      POP HL
0010F2 50F2 E5              11      PUSH    HL
0010F3 50F3 0E00             7      LD  C,0
0010F5 50F5 3004            12      JR  NC,SAX0
0010F7 50F7 23               6      INC HL
0010F8 50F8 23               6      INC HL
0010F9 50F9 1808            12      JR  SAX4
       50FB                     SAX0:
0010FB 50FB 46               7      LD  B,(HL)
0010FC 50FC 23               6      INC HL
       50FD                     SAX1:
0010FD 50FD 23               6      INC HL
0010FE 50FE 1A               7      LD  A,(DE)
0010FF 50FF 13               6      INC DE
001100 5100 B7               4      OR  A
001101 5101 2004            12      JR  NZ,SAX2
       5103                     SAX4:
001103 5103 360D            10      LD  (HL),00DH
001105 5105 1804            12      JR  SAX3
       5107                     SAX2:
001107 5107 77               7      LD  (HL),A
001108 5108 0C               4      INC C
001109 5109 10F2            13      DJNZ    SAX1
       510B                     SAX3:
00110B 510B D1              10      POP DE
00110C 510C 79               4      LD  A,C
00110D 510D 13               6      INC DE
00110E 510E 12               7      LD  (DE),A
00110F 510F 1B               6      DEC DE
001110 5110 E1              10      POP HL
001111 5111 C1              10      POP BC
001112 5112 A7               4      AND A
001113 5113 C9              10      RET
       5114                     GETL:
001114 5114 DDE5            15      PUSH    IX
001116 5116 FDE5            15      PUSH    IY
                                
001118 5118 2ADCF3          16      LD  HL,(CSRY)
00111B 511B 22CAFB          16      LD  (FSTPOS),HL
       511E                     GETL1:
00111E 511E CD9550          17      CALL    _SYS08
001121 5121 FE09             7      CP  9
001123 5123 2008            12      JR  NZ,GETL1V
001125 5125 211FF4          10      LD  HL,KBUF
001128 5128 CD8743          17      CALL    MSX
00112B 512B 18F1            12      JR  GETL1
       512D                     GETL1V:
00112D 512D 5F               4      LD  E,A
00112E 512E FE08             7      CP  8
001130 5130 CCCA51          17      CALL    Z,CTRL02
001133 5133 FE20             7      CP  020H
001135 5135 D4F651          17      CALL    NC,INSERT
001138 5138 CD5E50          17      CALL    MSGA1
                                
00113B 513B 7B               4      LD  A,E
00113C 513C FE0D             7      CP  00DH
00113E 513E 20DE            12      JR  NZ,GETL1
                                
001140 5140 111FF4          10      LD  DE,KBUF
001143 5143 3AB0F3          13      LD  A,(LINLEN)
001146 5146 47               4      LD  B,A
001147 5147 CDD453          17      CALL    ZERO_MEMORY_DE
                                
00114A 514A 2ACAFB          16      LD  HL,(FSTPOS)
00114D 514D 3ADCF3          13      LD  A,(CSRY)
001150 5150 6F               4      LD  L,A
001151 5151 E5              11      PUSH    HL
001152 5152 CD2752          17      CALL    LOC0
001155 5155 4D               4      LD  C,L
001156 5156 44               4      LD  B,H
001157 5157 E1              10      POP HL
001158 5158 3AB0F3          13      LD  A,(LINLEN)
00115B 515B 94               4      SUB H
00115C 515C 3D               4      DEC A
00115D 515D 5F               4      LD  E,A
00115E 515E 211FF4          10      LD  HL,KBUF
       5161                     GETL2:
001161 5161 CDBA51          17      CALL    _SCRN
001164 5164 03               6      INC BC
001165 5165 77               7      LD  (HL),A
001166 5166 23               6      INC HL
001167 5167 1D               4      DEC E
001168 5168 20F7            12      JR  NZ,GETL2
00116A 516A CD7B50          17      CALL    MSG_CR
                                
00116D 516D FDE1            14      POP IY
00116F 516F DDE1            14      POP IX
       5171                     GETL3:
001171 5171 2B               6      DEC HL
001172 5172 7E               7      LD  A,(HL)
001173 5173 FE21             7      CP  021H
001175 5175 D0              11      RET NC
001176 5176 3600            10      LD  (HL),0
001178 5178 15               4      DEC D
001179 5179 20F6            12      JR  NZ,GETL3
00117B 517B C9              10      RET
                                
       517C                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       517C                     CONSTX:
       517C                     CPM_CONST:
00117C 517C C5              11      PUSH    BC
00117D 517D D5              11      PUSH    DE
00117E 517E E5              11      PUSH    HL
00117F 517F DDE5            15      PUSH    IX
001181 5181 DD219C00        14      LD  IX,CHSNS
001185 5185 CDFB42          17      CALL    CALSLT_R
001188 5188 DDE1            14      POP IX
00118A 518A E1              10      POP HL
00118B 518B D1              10      POP DE
00118C 518C C1              10      POP BC
00118D 518D C9              10      RET
                                
       518E                     _SYS2A:     ;(BDOS)日付の獲得
00118E 518E AF               4      XOR A
00118F 518F 57               4      LD  D,A
001190 5190 5F               4      LD  E,A
001191 5191 67               4      LD  H,A
001192 5192 6F               4      LD  L,A
001193 5193 C9              10      RET
                                
       5194                     _SYS2C:     ;(BDOS)時刻の獲得
001194 5194 AF               4      XOR A
001195 5195 57               4      LD  D,A
001196 5196 5F               4      LD  E,A
001197 5197 67               4      LD  H,A
001198 5198 6F               4      LD  L,A
001199 5199 C9              10      RET
                                
       519A                     POS:
00119A 519A F5              11      PUSH    AF
00119B 519B 2ADCF3          16      LD  HL,(CSRY)
00119E 519E 7D               4      LD  A,L
00119F 519F 6C               4      LD  L,H
0011A0 51A0 67               4      LD  H,A
0011A1 51A1 2C               4      INC L
0011A2 51A2 24               4      INC H
0011A3 51A3 F1              10      POP AF
0011A4 51A4 C9              10      RET
                                
       51A5                     LOC:
0011A5 51A5 F5              11      PUSH    AF
0011A6 51A6 E5              11      PUSH    HL
0011A7 51A7 7D               4      LD  A,L
0011A8 51A8 6C               4      LD  L,H
0011A9 51A9 67               4      LD  H,A
0011AA 51AA 2D               4      DEC L
0011AB 51AB 25               4      DEC H
0011AC 51AC DDE5            15      PUSH    IX
0011AE 51AE DD21C600        14      LD  IX,POSIT
0011B2 51B2 CDFB42          17      CALL    CALSLT_R
0011B5 51B5 DDE1            14      POP IX
0011B7 51B7 E1              10      POP HL
0011B8 51B8 F1              10      POP AF
0011B9 51B9 C9              10      RET
                                
       51BA                     _SCRN:
       51BA                     SCRN:
0011BA 51BA E5              11      PUSH    HL
0011BB 51BB DDE5            15      PUSH    IX
                                
0011BD 51BD 69               4      LD  L,C
0011BE 51BE 60               4      LD  H,B
0011BF 51BF DD214A00        14      LD  IX,RDVRM
0011C3 51C3 CDFB42          17      CALL    CALSLT_R
                                
0011C6 51C6 DDE1            14      POP IX
0011C8 51C8 E1              10      POP HL
0011C9 51C9 C9              10      RET
                                
       51CA                     CTRL02:
0011CA 51CA F5              11      PUSH    AF
0011CB 51CB D5              11      PUSH    DE
0011CC 51CC 2ADCF3          16      LD  HL,(CSRY)
0011CF 51CF 3AB0F3          13      LD  A,(LINLEN)
0011D2 51D2 4F               4      LD  C,A
0011D3 51D3 94               4      SUB H   ;CSRX
0011D4 51D4 C602             7      ADD A,2
0011D6 51D6 47               4      LD  B,A ;カーソルより右の文字数
0011D7 51D7 61               4      LD  H,C ;LINLEN
0011D8 51D8 C5              11      PUSH    BC
0011D9 51D9 CD2752          17      CALL    LOC0
0011DC 51DC C1              10      POP BC
                                
0011DD 51DD 1620             7      LD  D,020H
       51DF                     C8X1:
0011DF 51DF DD214A00        14      LD  IX,RDVRM
0011E3 51E3 CDFB42          17      CALL    CALSLT_R
0011E6 51E6 4F               4      LD  C,A
0011E7 51E7 7A               4      LD  A,D
0011E8 51E8 DD214D00        14      LD  IX,WRTVRM
0011EC 51EC CDFB42          17      CALL    CALSLT_R
0011EF 51EF 2B               6      DEC HL
0011F0 51F0 51               4      LD  D,C
0011F1 51F1 10EC            13      DJNZ    C8X1
0011F3 51F3 D1              10      POP DE
0011F4 51F4 F1              10      POP AF
0011F5 51F5 C9              10      RET
                                
       51F6                     INSERT:
0011F6 51F6 F5              11      PUSH    AF
0011F7 51F7 D5              11      PUSH    DE
0011F8 51F8 2ADCF3          16      LD  HL,(CSRY)
0011FB 51FB 3AB0F3          13      LD  A,(LINLEN)
0011FE 51FE 4F               4      LD  C,A
0011FF 51FF 94               4      SUB H   ;CSRX
001200 5200 3C               4      INC A
001201 5201 47               4      LD  B,A ;カーソルより右の文字数
001202 5202 C5              11      PUSH    BC
001203 5203 CD2752          17      CALL    LOC0
001206 5206 C1              10      POP BC
                                
001207 5207 1620             7      LD  D,020H
       5209                     INS1:
001209 5209 DD214A00        14      LD  IX,RDVRM
00120D 520D CDFB42          17      CALL    CALSLT_R
001210 5210 4F               4      LD  C,A
001211 5211 7A               4      LD  A,D
001212 5212 DD214D00        14      LD  IX,WRTVRM
001216 5216 CDFB42          17      CALL    CALSLT_R
001219 5219 23               6      INC HL
00121A 521A 51               4      LD  D,C
00121B 521B 10EC            13      DJNZ    INS1
00121D 521D D1              10      POP DE
00121E 521E F1              10      POP AF
00121F 521F C9              10      RET
                                
       5220                     CONOUT1:
001220 5220 59               4      LD  E,C
001221 5221 C35450          10      JP  _PRINT
                                
       5224                     GETVRAM:
001224 5224 2ADCF3          16      LD  HL,(CSRY)
       5227                     LOC0:
001227 5227 2D               4      DEC L
001228 5228 25               4      DEC H
001229 5229 4C               4      LD  C,H ;CSRX-1
00122A 522A 5D               4      LD  E,L ;CSRY-1
       522B                     LOC1:
00122B 522B 3AB0F3          13      LD  A,(LINLEN)
00122E 522E 67               4      LD  H,A
00122F 522F 1600             7      LD  D,0
001231 5231 6A               4      LD  L,D ;0
001232 5232 0608             7      LD  B,8
       5234                     LOC2:
001234 5234 29              11      ADD HL,HL
001235 5235 3001            12      JR  NC,LOC3
001237 5237 19              11      ADD HL,DE
       5238                     LOC3:
001238 5238 10FA            13      DJNZ    LOC2
00123A 523A 09              11      ADD HL,BC
00123B 523B C9              10      RET
                                
       523C                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00123C 523C 212200          10      LD  HL,00022H
00123F 523F AF               4      XOR A
001240 5240 7D               4      LD  A,L
001241 5241 C9              10      RET
                                
       5242                     _SYS0D:     ;(BDOS)ディスク・リセット
001242 5242 218000          10      LD  HL,00080H
001245 5245 2230F1          16      LD  (_DTA),HL
001248 5248 C9              10      RET
                                
       5249                     _SYS0E:     ;(BDOS)カレントドライブの設定
001249 5249 3246F1          13      LD  (_DVSW),A
00124C 524C C9              10      RET
                                
       524D                     _SYS0F:     ;(BDOS)ファイルのオープン
00124D 524D D5              11      PUSH    DE
00124E 524E FDE1            14      POP IY
001250 5250 CDBB53          17      CALL    INIT_FILE
001253 5253 CD384B          17      CALL    ROM_OPEN
001256 5256 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001258 5258 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
00125C 525C FDE5            15      PUSH    IY
00125E 525E D1              10      POP DE
00125F 525F 13               6      INC DE
001260 5260 010B00          10      LD  BC,11
001263 5263 EDB0                    LDIR
                                ;               Attribute
001265 5265 7E               7      LD  A,(HL)
001266 5266 FD770D          19      LD  (IY+13),A
                                ;               TIME
001269 5269 110B00          10      LD  DE,11
00126C 526C 19              11      ADD HL,DE
00126D 526D 7E               7      LD  A,(HL)
00126E 526E 23               6      INC HL
00126F 526F FD7716          19      LD  (IY+22),A
001272 5272 7E               7      LD  A,(HL)
001273 5273 23               6      INC HL
001274 5274 FD7717          19      LD  (IY+23),A
                                ;               DATE
001277 5277 7E               7      LD  A,(HL)
001278 5278 23               6      INC HL
001279 5279 FD7714          19      LD  (IY+20),A
00127C 527C 7E               7      LD  A,(HL)
00127D 527D 23               6      INC HL
00127E 527E FD7715          19      LD  (IY+21),A
                                ;               First cluster
001281 5281 7E               7      LD  A,(HL)
001282 5282 23               6      INC HL
001283 5283 FD771A          19      LD  (IY+26),A
001286 5286 7E               7      LD  A,(HL)
001287 5287 23               6      INC HL
001288 5288 FD771B          19      LD  (IY+27),A
                                ;               SIZE
00128B 528B 7E               7      LD  A,(HL)
00128C 528C 23               6      INC HL
00128D 528D FD7710          19      LD  (IY+16),A
001290 5290 7E               7      LD  A,(HL)
001291 5291 23               6      INC HL
001292 5292 FD7711          19      LD  (IY+17),A
001295 5295 7E               7      LD  A,(HL)
001296 5296 23               6      INC HL
001297 5297 FD7712          19      LD  (IY+18),A
00129A 529A 7E               7      LD  A,(HL)
00129B 529B FD7713          19      LD  (IY+19),A
00129E 529E AF               4      XOR A
00129F 529F FD770C          19      LD  (IY+12),A
0012A2 52A2 C9              10      RET
                                
       52A3                     _SYS10:     ;(BDOS)ファイルのクローズ
0012A3 52A3 AF               4      XOR A
0012A4 52A4 C9              10      RET
                                
       52A5                     S11X1:
0012A5 52A5 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012A8 52A8 FD750E          19      LD  (IY+14),L
0012AB 52AB FD740F          19      LD  (IY+15),H
       52AE                     SCF_FF_RET:
0012AE 52AE 37               4      SCF
0012AF 52AF 9F               4      SBC A,A
0012B0 52B0 C9              10      RET
                                
       52B1                     _SYS11:     ;(BDOS)最初のファイルの検索
0012B1 52B1 ED5333F1        20      LD  (_FCB),DE
0012B5 52B5 D5              11      PUSH    DE
0012B6 52B6 FDE1            14      POP IY
0012B8 52B8 CDBB53          17      CALL    INIT_FILE
0012BB 52BB CDA54D          17      CALL    GET_DIR_DAT
       52BE                     S12X1:
0012BE 52BE CD544B          17      CALL    FILESE
0012C1 52C1 30E2            12      JR  NC,S11X1
0012C3 52C3 0D               4      DEC C
0012C4 52C4 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012C7 52C7 FDCB0D66        20      BIT 4,(IY+13)
0012CB 52CB 2809            12      JR  Z,S12X2
0012CD 52CD E5              11      PUSH    HL
0012CE 52CE DDE1            14      POP IX
0012D0 52D0 DDCB0E66        20      BIT 4,(IX+1+13)
0012D4 52D4 28E8            12      JR  Z,S12X1
       52D6                     S12X2:
0012D6 52D6 012000          10      LD  BC,32
0012D9 52D9 ED5B30F1        20      LD  DE,(_DTA)
0012DD 52DD AF               4      XOR A
0012DE 52DE 12               7      LD  (DE),A      ;ドライブ番号
0012DF 52DF 13               6      INC DE
0012E0 52E0 EDB0                    LDIR            ;ディレクトリエントリ
0012E2 52E2 FD750E          19      LD  (IY+14),L
0012E5 52E5 FD740F          19      LD  (IY+15),H
0012E8 52E8 C9              10      RET
                                
       52E9                     _SYS12:
0012E9 52E9 FD2A33F1        20      LD  IY,(_FCB)
0012ED 52ED FDE5            15      PUSH    IY
0012EF 52EF D1              10      POP DE
0012F0 52F0 CDBB53          17      CALL    INIT_FILE
                                
0012F3 52F3 FD6E0E          19      LD  L,(IY+14)
0012F6 52F6 FD660F          19      LD  H,(IY+15)
0012F9 52F9 FD4E19          19      LD  C,(IY+25)
0012FC 52FC 18C0            12      JR  S12X1
                                
       52FE                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0012FE 52FE CD8B4D          17      CALL    SET_FCB
001301 5301 CD594D          17      CALL    GETSEQ
001304 5304 CD464D          17      CALL    RB_READ
001307 5307 E5              11      PUSH    HL
001308 5308 CD664D          17      CALL    SETSEQ
00130B 530B E1              10      POP HL
       530C                     SREAD:
00130C 530C C601             7      ADD A,001H
00130E 530E D8              11      RET C
                                
00130F 530F 7D               4      LD  A,L
001310 5310 D601             7      SUB 001H
001312 5312 9F               4      SBC A,A
001313 5313 E603             7      AND 3
001315 5315 1F               4      RRA
001316 5316 C9              10      RET
                                
       5317                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001317 5317 210100          10      LD  HL,00001H
00131A 531A AF               4      XOR A
00131B 531B C9              10      RET
                                
       531C                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00131C 531C 3A46F1          13      LD  A,(_DVSW)
00131F 531F C9              10      RET
                                
       5320                     _SYS1A:     ;(BDOS)DTAの設定
001320 5320 ED5330F1        20      LD  (_DTA),DE
001324 5324 AF               4      XOR A
001325 5325 C9              10      RET
                                
       5326                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001326 5326 010002          10      LD  BC,512
001329 5329 11C302          10      LD  DE,707
00132C 532C 210000          10      LD  HL,0
00132F 532F DD2135F1        14      LD  IX,_BUF
001333 5333 FD2135F1        14      LD  IY,_BUF
001337 5337 FD3600F9        19      LD  (IY+0),0F9H
00133B 533B 3E02             7      LD  A,2
00133D 533D C9              10      RET
                                
       533E                     _SYS21:     ;(BDOS)ランダムな読み出し
00133E 533E CD8B4D          17      CALL    SET_FCB
                                
001341 5341 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001344 5344 FD6622          19      LD  H,(IY+34)
                                
001347 5347 CD464D          17      CALL    RB_READ
00134A 534A 18C0            12      JR  SREAD
                                
       534C                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00134C 534C CD4D52          17      CALL    _SYS0F
00134F 534F D8              11      RET C
                                
001350 5350 D5              11      PUSH    DE      ;EX DE,IY
001351 5351 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001353 5353 CD7B4D          17      CALL    GETSIZE
       5356                     _S24X1:
001356 5356 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001359 5359 FD7422          19      LD  (IY+34),H
00135C 535C FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
001360 5360 FDE3            23      EX  (SP),IY     ;
001362 5362 D1              10      POP DE      ;
                                
001363 5363 AF               4      XOR A
001364 5364 C9              10      RET
                                
       5365                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001365 5365 E5              11      PUSH    HL
001366 5366 D5              11      PUSH    DE      ;EX DE,IY
001367 5367 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001369 5369 CD594D          17      CALL    GETSEQ
00136C 536C 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       536E                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00136E 536E CD8B4D          17      CALL    SET_FCB
001371 5371 E5              11      PUSH    HL
001372 5372 FD6E21          19      LD  L,(IY+33)
001375 5375 FD6622          19      LD  H,(IY+34)
001378 5378 2226F1          16      LD  (RR_LOW),HL
00137B 537B FD6E23          19      LD  L,(IY+35)
00137E 537E FD6624          19      LD  H,(IY+36)
001381 5381 2228F1          16      LD  (RR_HIGH),HL
001384 5384 E1              10      POP HL
001385 5385 CD1D49          17      CALL    ROM_READ
001388 5388 ED5B26F1        20      LD  DE,(RR_LOW)
00138C 538C FD7321          19      LD  (IY+33),E
00138F 538F FD7222          19      LD  (IY+34),D
001392 5392 ED5B28F1        20      LD  DE,(RR_HIGH)
001396 5396 FD7323          19      LD  (IY+35),E
001399 5399 FD7224          19      LD  (IY+36),D
00139C 539C 9F               4      SBC A,A
00139D 539D C9              10      RET
                                
       539E                     _SYS2F:
00139E 539E 44               4      LD  B,H
00139F 539F 2A30F1          16      LD  HL,(_DTA)
0013A2 53A2 C3664E          10      JP  DISKIO
                                
       53A5                     _SYS5A:
0013A5 53A5 0600             7      LD  B,0
0013A7 53A7 D5              11      PUSH    DE
0013A8 53A8 DDE1            14      POP IX
       53AA                     _SX5A1:
0013AA 53AA 1A               7      LD  A,(DE)
0013AB 53AB B7               4      OR  A
0013AC 53AC 2804            12      JR  Z,_SX5A2
0013AE 53AE 13               6      INC DE
0013AF 53AF 04               4      INC B
0013B0 53B0 18F8            12      JR  _SX5A1
                                
       53B2                     _SX5A2:
0013B2 53B2 78               4      LD  A,B
0013B3 53B3 CDE649          17      CALL    FILE_BDOS
0013B6 53B6 CD294E          17      CALL    ROM_CD
0013B9 53B9 9F               4      SBC A,A
0013BA 53BA C9              10      RET
                                
       53BB                     INIT_FILE:
0013BB 53BB EB               4      EX  DE,HL
0013BC 53BC 1150F1          10      LD  DE,FDRV
0013BF 53BF 010C00          10      LD  BC,1+8+3
0013C2 53C2 EDB0                    LDIR
0013C4 53C4 CDFC4F          17      CALL    GET_DISK_BANK_FDRV
0013C7 53C7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0013CA 53CA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0013CD 53CD 2A5CF1          16      LD  HL,(_CD)
0013D0 53D0 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
0013D3 53D3 C9              10      RET
                                
       53D4                     ZERO_MEMORY_DE:
0013D4 53D4 AF               4      XOR A
       53D5                     FILL_MEMORY_DE:
0013D5 53D5 12               7      LD  (DE),A
0013D6 53D6 13               6      INC DE
0013D7 53D7 10FC            13      DJNZ    FILL_MEMORY_DE
0013D9 53D9 C9              10      RET
                                
0013DA 53DA                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 4150575088504150        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 415041508D50CE50        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 95504150E8507C51        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 3C52425249524D52        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 A352B152E9524150        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 FE52415041504150        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 17531C5320532653        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 4150415041504C53        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 6553415041506E53        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 415041508E514150        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 9451415041509E53        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 41504150A5534150        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 4150415041504150        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
