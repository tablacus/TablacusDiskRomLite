                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 CD4D                    DW  STATEMENT   ; STATEMENT
000006 4006 374E                    DW  DEVICE1     ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C36E4E          10      JP  DISKIO
000013 4013 C3A94E          10      JP  DSKCHG
000016 4016 C3FF4E          10      JP  GETDPB
000019 4019 C3F24F          10      JP  CHOICE
00001C 401C C3F64F          10      JP  DSKFMT
00001F 401F C3F84F          10      JP  DSKSTP
000022 4022 C3F94F          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3F64F          10      JP  DSKFMT
000029 4029 C3F84F          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C33550          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.3",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3300    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2262F1          16      LD  (_SP),HL
000129 4129 ED7B62F1        20      LD  SP,(_SP)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210743          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017B00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DBFD          13      LD  (H_PINL),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4742          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DCFD          13      LD  (H_PINL+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 210745          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 213C46          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 214946          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 219150          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AC43          10      LD  HL,ROM_BOOT
0001BC 41BC 22DDFD          16      LD  (H_PINL+2),HL
0001BF 41BF 216E4E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DFFD          13      LD  (H_PINL+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001E5 41E5 204F            12      JR  NZ,NOT_BANK_TYPE
0001E7 41E7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001EA 41EA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001ED 41ED CD3801          17      CALL    RSLREG      ;read primary slot #
0001F0 41F0 07               4      RLCA
0001F1 41F1 07               4      RLCA
0001F2 41F2 F5              11      PUSH    AF
0001F3 41F3 1605             7      LD  D,4+1
0001F5 41F5 CD4E42          17      CALL    GTSL2_
0001F8 41F8 3244F3          13      LD  (RAMAD3),A
0001FB 41FB F1              10      POP AF
0001FC 41FC 07               4      RLCA
0001FD 41FD 07               4      RLCA
0001FE 41FE 1603             7      LD  D,2+1
000200 4200 CD4E42          17      CALL    GTSL2_
000203 4203 2680             7      LD  H,080H
000205 4205 CD6B42          17      CALL    CHK_RAM
000208 4208 3243F3          13      LD  (RAMAD2),A
       420B                     RAMCHK2:
00020B 420B 3A44F3          13      LD  A,(RAMAD3)
00020E 420E 2640             7      LD  H,040H
000210 4210 CD6B42          17      CALL    CHK_RAM
000213 4213 3242F3          13      LD  (RAMAD1),A
       4216                     RAMCHK1:
000216 4216 3A44F3          13      LD  A,(RAMAD3)
000219 4219 2600             7      LD  H,00H
00021B 421B CD6B42          17      CALL    CHK_RAM
00021E 421E 3241F3          13      LD  (RAMAD0),A
       4221                     RAMCHK0:
000221 4221 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000224 4224 010F00          10      LD  BC,0000FH       ;切り上げ
000227 4227 09              11      ADD HL,BC
000228 4228 7D               4      LD  A,L
                                
000229 4229 0604             7      LD  B,4
       422B                     B_DRIVE1:
00022B 422B CB3C             8      SRL H
00022D 422D 1F               4      RRA
00022E 422E 10FB            13      DJNZ    B_DRIVE1
                                
000230 4230 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000232 4232 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000235 4235 C9              10      RET
                                
       4236                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000236 4236 21DE43          10      LD  HL,MSG_ERROR_ROM_MODE
000239 4239 CD8543          17      CALL    MSX
00023C 423C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000240 4240 DD219F00        14      LD  IX,CHGET
000244 4244 C31C00          10      JP  _CALSLT
                                
       4247                     GTSL1_:             ;自分のいるスロットを知る
000247 4247 CD3801          17      CALL    RSLREG      ;read primary slot #
00024A 424A 0F               4      RRCA
00024B 424B 0F               4      RRCA
00024C 424C 1601             7      LD  D,1
       424E                     GTSL2_:
00024E 424E E603             7      AND 3       ;[A]=000000PP
000250 4250 5F               4      LD  E,A     ;[E]=000000PP
000251 4251 21C1FC          10      LD  HL,EXPTBL
000254 4254 85               4      ADD A,L     ;桁上りは無い
000255 4255 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000256 4256 7B               4      LD  A,E     ;[A]=000000PP
000257 4257 CB7E            13      BIT 7,(HL)
000259 4259 C8              11      RET Z
00025A 425A 7D               4      LD  A,L     ;point to SLTTBL entry
00025B 425B C604             7      ADD A,4     ;桁上りは無い
00025D 425D 6F               4      LD  L,A
00025E 425E 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425F                     GTSL3_:
00025F 425F 15               4      DEC D
000260 4260 2803            12      JR  Z,GTSL4_:
000262 4262 0F               4      RRCA
000263 4263 18FA            12      JR  GTSL3_:
       4265                     GTSL4_:
000265 4265 E60C             7      AND 00CH        ;[A] = 0000SS00
000267 4267 B3               4      OR  E       ;[A] = 0000SSPP
000268 4268 F680             7      OR  080H        ;[A] = 1000SSPP
00026A 426A C9              10      RET
                                
       426B                     CHK_RAM:
00026B 426B E5              11      PUSH    HL
00026C 426C CDC042          17      CALL    CHK_RAM0
00026F 426F E1              10      POP HL
000270 4270 C8              11      RET Z
000271 4271 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000274 4274 E680             7      AND 080H
000276 4276 CD9742          17      CALL    CHK_RAM_SLT
000279 4279 C8              11      RET Z
00027A 427A 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027D 427D E680             7      AND 080H
00027F 427F C601             7      ADD A,1
000281 4281 CD9742          17      CALL    CHK_RAM_SLT
000284 4284 C8              11      RET Z
000285 4285 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000288 4288 E680             7      AND 080H
00028A 428A C602             7      ADD A,2
00028C 428C CD9742          17      CALL    CHK_RAM_SLT
00028F 428F C8              11      RET Z
000290 4290 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000293 4293 E680             7      AND 080H
000295 4295 C603             7      ADD A,3
       4297                     CHK_RAM_SLT:
000297 4297 E5              11      PUSH    HL
000298 4298 CDC042          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029B 429B E1              10      POP HL
00029C 429C C8              11      RET Z
00029D 429D CB79             8      BIT 7,C
00029F 429F 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A1 42A1 79               4      LD  A,C
0002A2 42A2 C604             7      ADD A,4*1           ;スロット#X-1
0002A4 42A4 E5              11      PUSH    HL
0002A5 42A5 CDC042          17      CALL    CHK_RAM0
0002A8 42A8 E1              10      POP HL
0002A9 42A9 C8              11      RET Z
0002AA 42AA 79               4      LD  A,C
0002AB 42AB C608             7      ADD A,4*2           ;スロット#X-2
0002AD 42AD E5              11      PUSH    HL
0002AE 42AE CDC042          17      CALL    CHK_RAM0
0002B1 42B1 E1              10      POP HL
0002B2 42B2 C8              11      RET Z
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 C60C             7      ADD A,4*3           ;スロット#X-3
0002B6 42B6 E5              11      PUSH    HL
0002B7 42B7 CDC042          17      CALL    CHK_RAM0
0002BA 42BA E1              10      POP HL
       42BB                     CHK_RAM_E:
0002BB 42BB AF               4      XOR A
0002BC 42BC 3C               4      INC A           ;ZF=0にする
0002BD 42BD 3E00             7      LD  A,0
0002BF 42BF C9              10      RET
                                
       42C0                     CHK_RAM0:
0002C0 42C0 4F               4      LD  C,A
0002C1 42C1 3A00F1          13      LD  A,(ROM_SLT)
0002C4 42C4 B9               4      CP  C
0002C5 42C5 28F4            12      JR  Z,CHK_RAM_E
0002C7 42C7 2E00             7      LD  L,0
       42C9                     CHK_RAM1:
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDFB42          17      CALL    CALSLT_R
0002D1 42D1 C6E5             7      ADD A,0E5H
0002D3 42D3 47               4      LD  B,A
0002D4 42D4 5F               4      LD  E,A
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 DD211400        14      LD  IX,_WRSLT
0002DA 42DA CDFB42          17      CALL    CALSLT_R
0002DD 42DD 79               4      LD  A,C
0002DE 42DE DD210C00        14      LD  IX,_RDSLT
0002E2 42E2 CDFB42          17      CALL    CALSLT_R
0002E5 42E5 B8               4      CP  B
0002E6 42E6 C0              11      RET NZ
0002E7 42E7 D6E5             7      SUB 0E5H
0002E9 42E9 79               4      LD  A,C
0002EA 42EA 5F               4      LD  E,A
0002EB 42EB DD211400        14      LD  IX,_WRSLT
0002EF 42EF CDFB42          17      CALL    CALSLT_R
0002F2 42F2 24               4      INC H
0002F3 42F3 7D               4      LD  A,L
0002F4 42F4 C604             7      ADD A,4
0002F6 42F6 6F               4      LD  L,A
0002F7 42F7 20D0            12      JR  NZ,CHK_RAM1
0002F9 42F9 79               4      LD  A,C     ;ZF=1のハズ
0002FA 42FA C9              10      RET
                                
       42FB                     CALSLT_R:
0002FB 42FB C5              11      PUSH    BC
0002FC 42FC E5              11      PUSH    HL
0002FD 42FD FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000301 4301 CD1C00          17      CALL    _CALSLT
000304 4304 E1              10      POP HL
000305 4305 C1              10      POP BC
000306 4306 C9              10      RET
                                
       4307                     AT_ISC:
000307 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000307 F0E9 FEB7             7      CP  0B7H            ;FILES
000309 F0EB CC7BFE          17      CALL    Z,H_FILE
00030C F0EE FEB5             7      CP  0B5H            ;LOAD
00030E F0F0 CA71FE          10      JP  Z,H_BINS
000311 F0F3 FE8A             7      CP  08AH            ;RUN
000313 F0F5 CA76FE          10      JP  Z,H_BINL
000316 F0F8 FED6             7      CP  0D6H            ;COPY
000318 F0FA 2813            12      JR  Z,FIX_COPY
00031A F0FC FECF             7      CP  0CFH            ;BLOAD
00031C F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031D F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031E F100 00                      DB  0
00031F F101 7245                    DW  ROM_BLOAD
000321 F103 F5              11      PUSH    AF
000322 F104 E5              11      PUSH    HL
000323 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000326 F108 E1              10      POP HL
000327 F109 F1              10      POP AF
000328 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
00032A F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032C F10E C9              10      RET
       F10F                     FIX_COPY:
00032D F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032E F110 00                      DB  0
00032F F111 D846                    DW  ROM_COPY
000331 F113 C9              10      RET
       F114                     ROMUSE1:
000332 F114 3A00F1          13      LD  A,(ROM_SLT)
000335 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000337 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
00033A F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033D F11F 00                      DB  0
       F120                     _BANK:
00033E F120 00                      DB  0
       F121                     _BANK1:
00033F F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
000340 F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000342 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000344 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000346 F128 0000                    DW  0
       F12A                     _CLPS:
000348 F12A 0000                    DW  0
       F12C                     _LEFT:
00034A F12C 0000                    DW  0
       F12E                     _DTPS:
00034C F12E 0000                    DW  0
       F130                     _DTA:
00034E F130 0000                    DW  0
       F132                     FLG_LDIR:
000350 F132 00                      DB  0
       F133                     _FCB:
000351 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000353 F135 00                      DB  0
       F136                     _BUF_ST:
000354 F136 0000                    DW  0
       F138                     _BUF_EN:
000356 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000358 F13A 0000                    DW  0
       F13C                     _BUF_H:
00035A F13C 0000                    DW  0
       F13E                     _BUF_X:
00035C F13E 0000                    DW  0
       F140                     _BUF_Y:
00035E F140 00                      DB  0
       F141                     _BUF_P:
00035F F141 00                      DB  0
       F142                     _BUF_O:
000360 F142 00                      DB  0
       F143                     DTAX:
000361 F143 0000                    DW  0
       F145                     B_DRIVE:
000363 F145 00                      DB  0
       F146                     _DVSW:
000364 F146 00                      DB  0
       F147                     DIRENT1:
000365 F147 0000                    DW  0
       F149                     _DIR_BANK:
000367 F149 00                      DB  0
       F14A                     LEFTX:
000368 F14A 0000                    DW  0
       F14C                     PARAM0:
00036A F14C 0000                    DW  0
       F14E                     PARAM1:
00036C F14E 0000                    DW  0
       F150                     FDRV:
00036E F150 00                      DB  0
       F151                     FNAME:
00036F F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
00037A F15C 0000                    DW  0
       F15E                     _CDX:
00037C F15E 0000                    DW  0
       F160                     _HL:
00037E F160 0000                    DW  0
       F162                     _SP:
000380 F162 0000                    DW  0
                                
       F164                     ISC_E:
000382 4382                         ORG $$+RUN          ;$DEPHASE
                                
       4382                     MSX1:
000382 4382 CDAA50          17      CALL    MSGA1
       4385                     MSX:
000385 4385 7E               7      LD  A,(HL)
000386 4386 23               6      INC HL
000387 4387 B7               4      OR  A
000388 4388 20F8            12      JR  NZ,MSX1
00038A 438A C9              10      RET
                                
       438B                     PRTHX:
00038B 438B F5              11      PUSH    AF
00038C 438C 07               4      RLCA
00038D 438D 07               4      RLCA
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 CD9443          17      CALL    PRTA2
000393 4393 F1              10      POP AF
       4394                     PRTA2:
000394 4394 CD9A43          17      CALL    ASC
000397 4397 C3A650          10      JP  MSG_A
                                    
       439A                     ASC:
00039A 439A E60F             7      AND $0F
00039C 439C F630             7      OR  $30
00039E 439E FE3A             7      CP  $3A
0003A0 43A0 D8              11      RET C
0003A1 43A1 C607             7      ADD A,7
0003A3 43A3 C9              10      RET
                                
       43A4                     MSN:
0003A4 43A4 7E               7      LD  A,(HL)
0003A5 43A5 23               6      INC HL
0003A6 43A6 CDA650          17      CALL    MSG_A
0003A9 43A9 10F9            13      DJNZ    MSN
0003AB 43AB C9              10      RET
                                
       43AC                     ROM_BOOT:
0003AC 43AC 3E                      DB  03EH
0003AD 43AD C9              10      RET
0003AE 43AE 32DBFD          13      LD  (H_PINL),A
                                
0003B1 43B1 210444          10      LD  HL,DELOK
0003B4 43B4 CD8543          17      CALL    MSX
                                
0003B7 43B7 AF               4      XOR A
0003B8 43B8 3240F3          13      LD  (REBOOT),A
0003BB 43BB 2A48FC          16      LD  HL,(BOTTOM)
0003BE 43BE 110040          10      LD  DE,16384
0003C1 43C1 19              11      ADD HL,DE
0003C2 43C2 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003C4 43C4 57               4      LD  D,A
0003C5 43C5 0601             7      LD  B,1
0003C7 43C7 2100C0          10      LD  HL,0C000H
0003CA 43CA CD6E4E          17      CALL    DISKIO
                                
0003CD 43CD 116BF3          10      LD  DE,RAMUSE
0003D0 43D0 AF               4      XOR A
0003D1 43D1 CD1EC0          17      CALL    0C01EH
0003D4 43D4 116BF3          10      LD  DE,RAMUSE
0003D7 43D7 37               4      SCF
0003D8 43D8 CD1EC0          17      CALL    0C01EH
       43DB                     BOOT1:
0003DB 43DB C3F94F          10      JP  BASENT
                                
       43DE                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003DE 43DE 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       4403                     NULL:
000403 4403 00                      DB  0
       4404                     DELOK:
000404 4404 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4408                     ROM_LDIR:
000408 4408 3A32F1          13      LD  A,(FLG_LDIR)
00040B 440B B7               4      OR  A
00040C 440C 2008            12      JR  NZ,ROM_LDIRVM
00040E 440E CB7A             8      BIT 7,D
000410 4410 CA2844          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
000413 4413 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                    EI
                                #endif
000415 4415 C9              10      RET
                                
       4416                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000416 4416 C5              11      PUSH    BC
000417 4417 D5              11      PUSH    DE
000418 4418 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00041C 441C DD215C00        14      LD  IX,LDIRVM
000420 4420 CD1C00          17      CALL    _CALSLT
000423 4423 E1              10      POP HL
000424 4424 C1              10      POP BC
000425 4425 09              11      ADD HL,BC
000426 4426 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000427 4427 C9              10      RET
                                #endif
                                
       4428                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4428                     ROM_LDIRSLT1:
000428 4428 EB               4      EX  DE,HL
       4429                     RLDIRSLT1:
000429 4429 1A               7      LD  A,(DE)
00042A 442A 13               6      INC DE
00042B 442B C5              11      PUSH    BC
00042C 442C D5              11      PUSH    DE
00042D 442D E5              11      PUSH    HL
00042E 442E 5F               4      LD  E,A
                                
00042F 442F 0141F3          10      LD  BC,RAMAD0
000432 4432 7C               4      LD  A,H
000433 4433 07               4      RLCA
000434 4434 07               4      RLCA
000435 4435 E603             7      AND 3
000437 4437 81               4      ADD A,C
000438 4438 4F               4      LD  C,A
000439 4439 0A               7      LD  A,(BC)
       443A                     RLDIRSLT2:
00043A 443A CD1400          17      CALL    _WRSLT
00043D 443D 08               4      EX  AF,AF'
00043E 443E E1              10      POP HL
00043F 443F D1              10      POP DE
000440 4440 C1              10      POP BC
000441 4441 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000443 4443 EA2944          10      JP  PE,RLDIRSLT1
000446 4446 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000447 4447 C9              10      RET
                                #endif
                                
       4448                     END_OF_LINE:
000448 4448 215EF5          10      LD  HL,BUF
       444B                     EOL1:
00044B 444B 7E               7      LD  A,(HL)
00044C 444C C8              11      RET Z
00044D 444D FE0D             7      CP  00DH
00044F 444F 2807            12      JR  Z,EOLE
000451 4451 FE0A             7      CP  00AH
000453 4453 2803            12      JR  Z,EOLE
000455 4455 23               6      INC HL
000456 4456 18F3            12      JR  EOL1
       4458                     EOLE:
000458 4458 3600            10      LD  (HL),0
00045A 445A 23               6      INC HL
00045B 445B 7E               7      LD  A,(HL)
00045C 445C FE0A             7      CP  00AH
00045E 445E C0              11      RET NZ
00045F 445F 23               6      INC HL
000460 4460 C9              10      RET
                                
       4461                     ROM_LOAD_ASCII:
000461 4461 210000          10      LD  HL,0
000464 4464 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000467 4467 2A76F6          16      LD  HL,(TXTTAB)
00046A 446A 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00046D 446D 215EF5          10      LD  HL,BUF
000470 4470 2230F1          16      LD  (_DTA),HL
       4473                     RLOAD_A1:
000473 4473 2A36F1          16      LD  HL,(_BUF_ST)
000476 4476 2226F1          16      LD  (RR_LOW),HL
000479 4479 210201          10      LD  HL,258
00047C 447C CDF348          17      CALL    ROM_READ
00047F 447F 7C               4      LD  A,H
000480 4480 B5               4      OR  L
000481 4481 2877            12      JR  Z,RLOAD_AEND
000483 4483 015EF5          10      LD  BC,BUF
000486 4486 09              11      ADD HL,BC
000487 4487 3600            10      LD  (HL),0
000489 4489 CD4844          17      CALL    END_OF_LINE
00048C 448C 015EF5          10      LD  BC,BUF
00048F 448F A7               4      AND A
000490 4490 ED42            15      SBC HL,BC
000492 4492 2810            12      JR  Z,RLOAD_A2
000494 4494 4D               4      LD  C,L
000495 4495 44               4      LD  B,H
000496 4496 ED5B36F1        20      LD  DE,(_BUF_ST)
00049A 449A 19              11      ADD HL,DE
00049B 449B 2236F1          16      LD  (_BUF_ST),HL
00049E 449E 3A5EF5          13      LD  A,(BUF)
0004A1 44A1 B7               4      OR  A
0004A2 44A2 28CF            12      JR  Z,RLOAD_A1
       44A4                     RLOAD_A2:
0004A4 44A4 115EF5          10      LD  DE,BUF
0004A7 44A7 CDAA4A          17      CALL    SPCUTEX
0004AA 44AA 1A               7      LD  A,(DE)
0004AB 44AB B7               4      OR  A
0004AC 44AC 284C            12      JR  Z,RLOAD_AEND
0004AE 44AE CDBC4A          17      CALL    GETNUM
0004B1 44B1 7C               4      LD  A,H
0004B2 44B2 B5               4      OR  L
0004B3 44B3 CA5945          10      JP  Z,ERROR_DIRECT_IN_FILE
0004B6 44B6 DD2A38F1        20      LD  IX,(_BUF_EN)
0004BA 44BA DD7502          19      LD  (IX+2),L
0004BD 44BD DD7403          19      LD  (IX+3),H
                                
0004C0 44C0 CDA34A          17      CALL    SPCUT
0004C3 44C3 EB               4      EX  DE,HL
0004C4 44C4 DDE5            15      PUSH    IX
0004C6 44C6 DD21B242        14      LD  IX,CRUNCH
0004CA 44CA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004CE 44CE CD1C00          17      CALL    _CALSLT
0004D1 44D1 DDE1            14      POP IX
0004D3 44D3 EB               4      EX  DE,HL
0004D4 44D4 111FF4          10      LD  DE,KBUF
0004D7 44D7 37               4      SCF
0004D8 44D8 ED52            15      SBC HL,DE
0004DA 44DA 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
0004DC 44DC 387B            12      JR  C,ERROR_DIRECT_IN_FILE
0004DE 44DE 4D               4      LD  C,L
0004DF 44DF 44               4      LD  B,H
0004E0 44E0 2A38F1          16      LD  HL,(_BUF_EN)
0004E3 44E3 110400          10      LD  DE,4
0004E6 44E6 19              11      ADD HL,DE
0004E7 44E7 111FF4          10      LD  DE,KBUF
                                
0004EA 44EA EB               4      EX  DE,HL
0004EB 44EB EDB0                    LDIR
0004ED 44ED EB               4      EX  DE,HL
                                
0004EE 44EE DD7500          19      LD  (IX+0),L
0004F1 44F1 DD7401          19      LD  (IX+1),H
0004F4 44F4 2238F1          16      LD  (_BUF_EN),HL
0004F7 44F7 C37344          10      JP  RLOAD_A1
                                
       44FA                     RLOAD_AEND:
0004FA 44FA 2A38F1          16      LD  HL,(_BUF_EN)
0004FD 44FD AF               4      XOR A
0004FE 44FE 77               7      LD  (HL),A
0004FF 44FF 23               6      INC HL
000500 4500 77               7      LD  (HL),A
000501 4501 23               6      INC HL
000502 4502 2238F1          16      LD  (_BUF_EN),HL
000505 4505 183B            12      JR  RLOAD_END1
                                
       4507                     ROM_LOAD:
000507 4507 CDA246          17      CALL    INIT_PARAM
00050A 450A CD9449          17      CALL    FILE_B
00050D 450D 3A51F1          13      LD  A,(FNAME)
000510 4510 FE20             7      CP  020H
000512 4512 CA8F49          10      JP  Z,ROM_ORG
                                
000515 4515 CD134B          17      CALL    ROM_OPEN
000518 4518 384B            12      JR  C,ERROR_FILE_NOT_FOUND
       451A                     ROM_LOAD1:
00051A 451A 2135F1          10      LD  HL,_BUF
00051D 451D 2230F1          16      LD  (_DTA),HL
000520 4520 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000523 4523 CDF348          17      CALL    ROM_READ
000526 4526 3A35F1          13      LD  A,(_BUF)
000529 4529 3C               4      INC A
00052A 452A C26144          10      JP  NZ,ROM_LOAD_ASCII
00052D 452D 2A76F6          16      LD  HL,(TXTTAB)
000530 4530 2230F1          16      LD  (_DTA),HL
000533 4533 EB               4      EX  DE,HL
000534 4534 2100FF          10      LD  HL,-256
000537 4537 39              11      ADD HL,SP
000538 4538 ED52            15      SBC HL,DE
00053A 453A CDF348          17      CALL    ROM_READ
00053D 453D ED5B30F1        20      LD  DE,(_DTA)
000541 4541 19              11      ADD HL,DE
       4542                     RLOAD_END1:
000542 4542 22C2F6          16      LD  (VARTAB),HL
000545 4545 22C4F6          16      LD  (ARYTAB),HL
000548 4548 22C6F6          16      LD  (STREND),HL
                                
00054B 454B AF               4      XOR A
00054C 454C 2138F1          10      LD  HL,_BUF+3
00054F 454F 77               7      LD  (HL),A
000550 4550 2B               6      DEC HL
000551 4551 77               7      LD  (HL),A
000552 4552 2B               6      DEC HL
000553 4553 77               7      LD  (HL),A
000554 4554 2B               6      DEC HL
000555 4555 3E8F             7      LD  A,08FH          ;REM
000557 4557 77               7      LD  (HL),A
000558 4558 C9              10      RET
                                
       4559                     ERROR_DIRECT_IN_FILE:
000559 4559 1E39             7      LD  E,57            ;Direct statement in file
00055B 455B 01                      DB  1           ;LD BC,
       455C                     ERROR_DEVICE_IO_ERROR:
00055C 455C 1E13             7      LD  E,19            ;Device I/O error
00055E 455E 01                      DB  1           ;LD BC,
       455F                     ERROR_INTERNAL_ERROR:
00055F 455F 1E33             7      LD  E,51            ;Internal error
000561 4561 01                      DB  1           ;LD BC,
       4562                     ERROR_FILE_NOT_OPEN:
000562 4562 1E3B             7      LD  E,59            ;File not OPEN
000564 4564 01                      DB  1           ;LD BC,
       4565                     ERROR_FILE_NOT_FOUND:
000565 4565 1E35             7      LD  E,53            ;File not found
       4567                     ERROR:
000567 4567 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00056B 456B DD216F40        14      LD  IX,ERRHAND
00056F 456F C31C00          10      JP  _CALSLT
                                
       4572                     ROM_BLOAD:
000572 4572 CDA246          17      CALL    INIT_PARAM
000575 4575 CD9449          17      CALL    FILE_B
000578 4578 CD134B          17      CALL    ROM_OPEN
00057B 457B 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00057D 457D 2135F1          10      LD  HL,_BUF
000580 4580 2230F1          16      LD  (_DTA),HL
000583 4583 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000586 4586 CDF348          17      CALL    ROM_READ
000589 4589 3A35F1          13      LD  A,(_BUF)
00058C 458C FEFE             7      CP  0FEH
00058E 458E 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
000590 4590 210EF1          10      LD  HL,BLOAD_RET
000593 4593 2206F1          16      LD  (SWC_BLOAD),HL
                                
000596 4596 2A4EF1          16      LD  HL,(PARAM1)
000599 4599 7E               7      LD  A,(HL)
00059A 459A FE2C             7      CP  ','
00059C 459C 2048            12      JR  NZ,RBREAD_MEM
00059E 459E 23               6      INC HL
00059F 459F 7E               7      LD  A,(HL)
0005A0 45A0 CDFD4A          17      CALL    CAP
0005A3 45A3 32BEFC          13      LD  (RUNBNF),A
       45A6                     RBOS1:
0005A6 45A6 7E               7      LD  A,(HL)
0005A7 45A7 23               6      INC HL
0005A8 45A8 B7               4      OR  A
0005A9 45A9 282F            12      JR  Z,RBREAD_OSE
0005AB 45AB FE3A             7      CP  ':'
0005AD 45AD 282B            12      JR  Z,RBREAD_OSE
0005AF 45AF FE2C             7      CP  ','     ;次のパラメータを探す
0005B1 45B1 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005B3 45B3 224EF1          16      LD  (PARAM1),HL
0005B6 45B6 7E               7      LD  A,(HL)
0005B7 45B7 B7               4      OR  A
0005B8 45B8 2820            12      JR  Z,RBREAD_OSE
0005BA 45BA DD21644C        14      LD  IX,FRMEVL
0005BE 45BE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005C2 45C2 CD1C00          17      CALL    _CALSLT
0005C5 45C5 224EF1          16      LD  (PARAM1),HL
0005C8 45C8 3A63F6          13      LD  A,(VALTYP)
0005CB 45CB FE02             7      CP  2
0005CD 45CD 200B            12      JR  NZ,RBREAD_OSE
0005CF 45CF 2A36F1          16      LD  HL,(_BUF_ST)
0005D2 45D2 ED5BF8F7        20      LD  DE,(DACDAT)
0005D6 45D6 19              11      ADD HL,DE
0005D7 45D7 2236F1          16      LD  (_BUF_ST),HL
       45DA                     RBREAD_OSE:
0005DA 45DA 3ABEFC          13      LD  A,(RUNBNF)
0005DD 45DD FE53             7      CP  'S'
0005DF 45DF 2005            12      JR  NZ,RBREAD_MEM
0005E1 45E1 3E01             7      LD  A,1
0005E3 45E3 3232F1          13      LD  (FLG_LDIR),A
       45E6                     RBREAD_MEM:
0005E6 45E6 2A36F1          16      LD  HL,(_BUF_ST)
0005E9 45E9 22BFFC          16      LD  (SAVENT),HL
0005EC 45EC 2230F1          16      LD  (_DTA),HL
0005EF 45EF 21FFFF          10      LD  HL,0FFFFH
0005F2 45F2 CDF348          17      CALL    ROM_READ
0005F5 45F5 3ABEFC          13      LD  A,(RUNBNF)
0005F8 45F8 FE52             7      CP  'R'
0005FA 45FA 2006            12      JR  NZ,RBREAD1
0005FC 45FC 2A3AF1          16      LD  HL,(_BUF_EX)
0005FF 45FF 2206F1          16      LD  (SWC_BLOAD),HL
       4602                     RBREAD1:
       4602                     ROM_NEXT:
000602 4602 2A4EF1          16      LD  HL,(PARAM1)
000605 4605 7E               7      LD  A,(HL)
000606 4606 2B               6      DEC HL
000607 4607 B7               4      OR  A
000608 4608 2805            12      JR  Z,RN1
00060A 460A FE3A             7      CP  ':'
00060C 460C 2801            12      JR  Z,RN1
00060E 460E 23               6      INC HL
       460F                     RN1:
00060F 460F 5D               4      LD  E,L
000610 4610 54               4      LD  D,H
                                
000611 4611 CDD34A          17      CALL    SEARCH_END
000614 4614 B7               4      OR  A
000615 4615 2821            12      JR  Z,REM
       4617                     RN3:                    ;マルチステートメントの処理
000617 4617 7E               7      LD  A,(HL)
                                
000618 4618 FEB5             7      CP  0B5H            ;LOAD
00061A 461A CA0745          10      JP  Z,ROM_LOAD
00061D 461D FE8A             7      CP  08AH            ;RUN
00061F 461F 281B            12      JR  Z,ROM_RUN
000621 4621 FEB7             7      CP  0B7H            ;FILES
000623 4623 2824            12      JR  Z,ROM_FILES
000625 4625 FED6             7      CP  0D6H            ;COPY
000627 4627 CAD846          10      JP  Z,ROM_COPY
00062A 462A FE20             7      CP  020H
00062C 462C 2807            12      JR  Z,RN_SP
                                
00062E 462E 3E28             7      LD  A,028H          ;JR Z,
000630 4630 320CF1          13      LD  (SWC_BLOAD_M),A
000633 4633 7E               7      LD  A,(HL)
000634 4634 C9              10      RET
       4635                     RN_SP:
000635 4635 23               6      INC HL
000636 4636 18DF            12      JR  RN3
                                
       4638                     REM:
000638 4638 EB               4      EX  DE,HL
000639 4639 3E8F             7      LD  A,08FH          ;REM
00063B 463B C9              10      RET
                                
       463C                     ROM_RUN:
00063C 463C 23               6      INC HL
00063D 463D 7E               7      LD  A,(HL)
00063E 463E 2B               6      DEC HL
00063F 463F B7               4      OR  A
000640 4640 2803            12      JR  Z,ROM_RUN1
000642 4642 CD0745          17      CALL    ROM_LOAD
       4645                     ROM_RUN1:
000645 4645 3E8A             7      LD  A,08AH          ;RUN
000647 4647 77               7      LD  (HL),A
000648 4648 C9              10      RET
                                
       4649                     ROM_FILES:
000649 4649 CDA246          17      CALL    INIT_PARAM
00064C 464C CD9449          17      CALL    FILE_B
00064F 464F CD3950          17      CALL    GET_DISK_BANK_FDRV
000652 4652 3A25F1          13      LD  A,(SECSZ_H)
000655 4655 CDF44E          17      CALL    IS_BPB1
000658 4658 DA5C45          10      JP  C,ERROR_DEVICE_IO_ERROR
00065B 465B 3A51F1          13      LD  A,(FNAME)
00065E 465E FE21             7      CP  021H
000660 4660 3005            12      JR  NC,RFILES0
000662 4662 060B             7      LD  B,11
000664 4664 CD674A          17      CALL    FILE10
       4667                     RFILES0:
000667 4667 CD804D          17      CALL    GET_DIR_DAT
       466A                     RFILES1:
00066A 466A CD2F4B          17      CALL    FILESE
00066D 466D 302E            12      JR  NC,RFILES_NOT_MATCH
       466F                     RFILES_DISP:
00066F 466F E5              11      PUSH    HL
000670 4670 0608             7      LD  B,8
000672 4672 CDA443          17      CALL    MSN
000675 4675 3E2E             7      LD  A,'.'
000677 4677 CDA650          17      CALL    MSG_A
00067A 467A 0603             7      LD  B,3
00067C 467C CDA443          17      CALL    MSN
00067F 467F 3ADDF3          13      LD  A,(CSRX)
000682 4682 47               4      LD  B,A
000683 4683 3AB0F3          13      LD  A,(LINLEN)
000686 4686 90               4      SUB B
000687 4687 FE0C             7      CP  12
000689 4689 3009            12      JR  NC,RFILES2
00068B 468B 3E0D             7      LD  A,00DH      ;改行
00068D 468D CDA650          17      CALL    MSG_A
000690 4690 3E0A             7      LD  A,00AH
000692 4692 1802            12      JR  RFILES3
       4694                     RFILES2:
000694 4694 3E20             7      LD  A,020H
       4696                     RFILES3:
000696 4696 CDA650          17      CALL    MSG_A
000699 4699 E1              10      POP HL
00069A 469A CD4B4B          17      CALL    FNEXT
       469D                     RFILES_NOT_MATCH:
00069D 469D 20CB            12      JR  NZ,RFILES1
00069F 469F C30246          10      JP  ROM_NEXT
                                
       46A2                     INIT_PARAM:
0006A2 46A2 224CF1          16      LD  (PARAM0),HL
0006A5 46A5 224EF1          16      LD  (PARAM1),HL
0006A8 46A8 EB               4      EX  DE,HL
0006A9 46A9 AF               4      XOR A
0006AA 46AA 3232F1          13      LD  (FLG_LDIR),A
0006AD 46AD 32BEFC          13      LD  (RUNBNF),A
0006B0 46B0 3263F6          13      LD  (VALTYP),A
0006B3 46B3 E5              11      PUSH    HL
0006B4 46B4 2A5CF1          16      LD  HL,(_CD)
0006B7 46B7 225EF1          16      LD  (_CDX),HL
0006BA 46BA E1              10      POP HL
0006BB 46BB 13               6      INC DE
0006BC 46BC CDA34A          17      CALL    SPCUT
0006BF 46BF 1A               7      LD  A,(DE)
0006C0 46C0 B7               4      OR  A
0006C1 46C1 C8              11      RET Z
0006C2 46C2 FE3A             7      CP  ':'
0006C4 46C4 C8              11      RET Z
0006C5 46C5 FE28             7      CP  '('
0006C7 46C7 C8              11      RET Z
0006C8 46C8 EB               4      EX  DE,HL
0006C9 46C9 DD21644C        14      LD  IX,FRMEVL
0006CD 46CD FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006D1 46D1 CD1C00          17      CALL    _CALSLT
0006D4 46D4 224EF1          16      LD  (PARAM1),HL
0006D7 46D7 C9              10      RET
                                
       46D8                     ROM_COPY:
0006D8 46D8 CDA246          17      CALL    INIT_PARAM
0006DB 46DB 3A63F6          13      LD  A,(VALTYP)
0006DE 46DE FE03             7      CP  3       ;string
0006E0 46E0 C28F49          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
0006E3 46E3 CD9449          17      CALL    FILE_B
0006E6 46E6 CD134B          17      CALL    ROM_OPEN
0006E9 46E9 DA6545          10      JP  C,ERROR_FILE_NOT_FOUND
                                
0006EC 46EC 213AF1          10      LD  HL,_BUF_W
0006EF 46EF 2230F1          16      LD  (_DTA),HL
0006F2 46F2 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
0006F5 46F5 CDF348          17      CALL    ROM_READ
                                
0006F8 46F8 AF               4      XOR A
0006F9 46F9 3235F1          13      LD  (_BUF_LO),A     ;PSET
0006FC 46FC 3242F1          13      LD  (_BUF_O),A      ;向き
                                
0006FF 46FF 2A4EF1          16      LD  HL,(PARAM1)
       4702                     RCP_PARAM1:
000702 4702 7E               7      LD  A,(HL)
000703 4703 23               6      INC HL
000704 4704 B7               4      OR  A
000705 4705 CA8F49          10      JP  Z,ROM_ORG
000708 4708 FE3A             7      CP  ':'
00070A 470A CA8F49          10      JP  Z,ROM_ORG
00070D 470D FE2C             7      CP  ','
00070F 470F 2012            12      JR  NZ,RCP_PARAM1_
                                
000711 4711 DD212F54        14      LD  IX,FRMQNT
000715 4715 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000719 4719 CD1C00          17      CALL    _CALSLT
00071C 471C 7B               4      LD  A,E
00071D 471D 87               4      ADD A,A
00071E 471E 87               4      ADD A,A
00071F 471F 3242F1          13      LD  (_BUF_O),A
000722 4722 7E               7      LD  A,(HL)
       4723                     RCP_PARAM1_:
000723 4723 FE28             7      CP  '('
000725 4725 20DB            12      JR  NZ,RCP_PARAM1
                                
000727 4727 DD212F54        14      LD  IX,FRMQNT
00072B 472B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00072F 472F CD1C00          17      CALL    _CALSLT
                                
000732 4732 ED533EF1        20      LD  (_BUF_X),DE
                                
       4736                     RCP_PARAM2:
000736 4736 23               6      INC HL
000737 4737 7E               7      LD  A,(HL)
000738 4738 FE20             7      CP  020H
00073A 473A 28FA            12      JR  Z,RCP_PARAM2
00073C 473C FE2C             7      CP  ','
00073E 473E 28F6            12      JR  Z,RCP_PARAM2
                                
000740 4740 DD212F54        14      LD  IX,FRMQNT
000744 4744 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000748 4748 CD1C00          17      CALL    _CALSLT
                                
00074B 474B ED5340F1        20      LD  (_BUF_Y),DE
       474F                     RCP_PARAM3:
00074F 474F 23               6      INC HL
000750 4750 7E               7      LD  A,(HL)
000751 4751 FE20             7      CP  020H
000753 4753 28FA            12      JR  Z,RCP_PARAM3
000755 4755 FE29             7      CP  ')'
000757 4757 28F6            12      JR  Z,RCP_PARAM3
000759 4759 FE2C             7      CP  ','
00075B 475B 2033            12      JR  NZ,RCP_ST
                                
00075D 475D 23               6      INC HL
00075E 475E DD212F54        14      LD  IX,FRMQNT
000762 4762 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000766 4766 CD1C00          17      CALL    _CALSLT
                                
000769 4769 7B               4      LD  A,E
00076A 476A 3241F1          13      LD  (_BUF_P),A
                                
       476D                     RCP_PARAM4:
00076D 476D 7E               7      LD  A,(HL)
00076E 476E 23               6      INC HL
00076F 476F FE20             7      CP  020H
000771 4771 28FA            12      JR  Z,RCP_PARAM4
                                
000773 4773 FE2C             7      CP  ','
000775 4775 2019            12      JR  NZ,RCP_ST
                                
000777 4777 7E               7      LD  A,(HL)
000778 4778 0604             7      LD  B,4
00077A 477A FEC3             7      CP  0C3H        ;PRESET
00077C 477C 280E            12      JR  Z,RCP_LO
00077E 477E 05               4      DEC B       ;3
00077F 477F D6F8             7      SUB 0F8H        ;XOR
000781 4781 2809            12      JR  Z,RCP_LO
000783 4783 05               4      DEC B       ;2
000784 4784 3C               4      INC A       ;OR
000785 4785 2805            12      JR  Z,RCP_LO
000787 4787 05               4      DEC B       ;1
000788 4788 3C               4      INC A       ;AND
000789 4789 2801            12      JR  Z,RCP_LO
00078B 478B 05               4      DEC B       ;0
                                                ;PSET
       478C                     RCP_LO:
00078C 478C 78               4      LD  A,B
00078D 478D 3235F1          13      LD  (_BUF_LO),A
       4790                     RCP_ST:
000790 4790 2AC6F6          16      LD  HL,(STREND)
000793 4793 2230F1          16      LD  (_DTA),HL
000796 4796 EB               4      EX  DE,HL
000797 4797 2100FE          10      LD  HL,-512
00079A 479A 39              11      ADD HL,SP
00079B 479B AF               4      XOR A
00079C 479C ED52            15      SBC HL,DE
00079E 479E 3008            12      JR  NC,RCP0
0007A0 47A0 215EF5          10      LD  HL,BUF
0007A3 47A3 2230F1          16      LD  (_DTA),HL
0007A6 47A6 6F               4      LD  L,A ;0
0007A7 47A7 67               4      LD  H,A ;0
       47A8                     RCP0:
0007A8 47A8 24               4      INC H
0007A9 47A9 2238F1          16      LD  (_BUF_EN),HL
       47AC                     RCP1:
0007AC 47AC F3               4      DI
0007AD 47AD CD8148          17      CALL    WAIT_VDP
                                
0007B0 47B0 3A0700          13      LD  A,(WRVDP)
0007B3 47B3 4F               4      LD  C,A
0007B4 47B4 0C               4      INC C       ;C := PORT#1's address(WR)
0007B5 47B5 3E24             7      LD  A,36
0007B7 47B7 ED79            12      OUT (C),A
0007B9 47B9 3E91             7      LD  A,080H+17
0007BB 47BB ED79            12      OUT (C),A       ;R#17 := 36
                                
0007BD 47BD 0C               4      INC C
0007BE 47BE 0C               4      INC C       ;C := PORT#3's address(WR)
0007BF 47BF 2A3EF1          16      LD  HL,(_BUF_X)
0007C2 47C2 ED69            12      OUT (C),L       ;R#36 DX
0007C4 47C4 ED61            12      OUT (C),H       ;R#37
0007C6 47C6 2A40F1          16      LD  HL,(_BUF_Y)
0007C9 47C9 ED69            12      OUT (C),L       ;R#38 DY
0007CB 47CB ED61            12      OUT (C),H       ;R#39
0007CD 47CD 2A3AF1          16      LD  HL,(_BUF_W)
0007D0 47D0 ED69            12      OUT (C),L       ;R#40 NX
0007D2 47D2 ED61            12      OUT (C),H       ;R#41
0007D4 47D4 2A3CF1          16      LD  HL,(_BUF_H)
0007D7 47D7 ED69            12      OUT (C),L       ;R#42 NY
0007D9 47D9 ED61            12      OUT (C),H       ;R#43
                                
0007DB 47DB DD2AAFFC        20      LD  IX,(SCRMOD)
0007DF 47DF 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0007E2 47E2 B7               4      OR  A
0007E3 47E3 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
0007E5 47E5 DD7D             9      LD  A,IXL
0007E7 47E7 FE08             7      CP  8
0007E9 47E9 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
0007EB 47EB FE06             7      CP  6
0007ED 47ED 2A3EF1          16      LD  HL,(_BUF_X)
0007F0 47F0 3A3AF1          13      LD  A,(_BUF_W)
0007F3 47F3 2005            12      JR  NZ,SCR57
0007F5 47F5 B5               4      OR  L       ;スクリーン6
0007F6 47F6 E603             7      AND 3
0007F8 47F8 200D            12      JR  NZ,USE_LMMC
       47FA                     SCR57:              ;スクリーン5,7
0007FA 47FA B5               4      OR  L
0007FB 47FB E601             7      AND 1
0007FD 47FD 2008            12      JR  NZ,USE_LMMC
       47FF                     USE_HMMC:
0007FF 47FF DD2E08          10      LD  IXL,8
       4802                     USE_HMMC8:
000802 4802 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000804 4804 3235F1          13      LD  (_BUF_LO),A
       4807                     USE_LMMC:
000807 4807 110000          10      LD  DE,0
00080A 480A 06FF             7      LD  B,-1
00080C 480C CDAC48          17      CALL    GET_PIXEL
00080F 480F ED79            12      OUT (C),A       ;R#44 first DATA
000811 4811 3A42F1          13      LD  A,(_BUF_O)
000814 4814 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000816 4816 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000819 4819 F6B0             7      OR  0B0H        ;R#46 LMMC command
00081B 481B ED79            12      OUT (C),A
                                
00081D 481D FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
00081F 481F 0D               4      DEC C
000820 4820 0D               4      DEC C       ;C := PORT#1's address(WR)
000821 4821 3EAC             7      LD  A,080H+44
000823 4823 ED79            12      OUT (C),A
000825 4825 3E91             7      LD  A,080H+17
000827 4827 ED79            12      OUT (C),A       ;R#17 := 44
                                
000829 4829 3A0600          13      LD  A,(RDVDP)
00082C 482C 3C               4      INC A
00082D 482D FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
00082F 482F 3E02             7      LD  A,2
000831 4831 ED79            12      OUT (C),A
000833 4833 3E8F             7      LD  A,08FH
000835 4835 ED79            12      OUT (C),A
000837 4837 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00083A 483A E640             7      AND 040H
00083C 483C 201C            12      JR  NZ,LOOP_HMMC
       483E                     LOOP_COPY:
00083E 483E CDAC48          17      CALL    GET_PIXEL
000841 4841 08               4      EX  AF,AF'
000842 4842 FD4C             9      LD  C,IYH
       4844                     LOOP_COPY1:
000844 4844 ED78            12      IN  A,(C)
000846 4846 0F               4      RRCA            ;RRCAではサインフラグは変化しない
000847 4847 300A            12      JR  NC,EXIT_COPY    ;check CE bit
000849 4849 F24448          10      JP  P,LOOP_COPY1    ;check TR bit
00084C 484C 08               4      EX  AF,AF'
00084D 484D FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
00084F 484F ED79            12      OUT (C),A
000851 4851 18EB            12      JR  LOOP_COPY
                                
       4853                     EXIT_COPY:
000853 4853 CD8948          17      CALL    GET_STATUS_0
000856 4856 FB               4      EI
000857 4857 C30246          10      JP  ROM_NEXT
                                
       485A                     LOOP_HMMC:
00085A 485A FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
00085C 485C 43               4      LD  B,E
00085D 485D 7B               4      LD  A,E
00085E 485E B7               4      OR  A
00085F 485F 2802            12      JR  Z,LOOP_HMMC1
000861 4861 EDB3                    OTIR
       4863                     LOOP_HMMC1:
000863 4863 14               4      INC D
       4864                     LOOP_HMMC2:
000864 4864 15               4      DEC D
000865 4865 2805            12      JR  Z,LOOP_HMMC3
000867 4867 EDB3                    OTIR
000869 4869 C36448          10      JP  LOOP_HMMC2
       486C                     LOOP_HMMC3:
00086C 486C ED78            12      IN  A,(C)
00086E 486E 0F               4      RRCA
00086F 486F 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
000871 4871 2A38F1          16      LD  HL,(_BUF_EN)
000874 4874 CDF348          17      CALL    ROM_READ
000877 4877 EB               4      EX  DE,HL
000878 4878 2A30F1          16      LD  HL,(_DTA)
00087B 487B 7A               4      LD  A,D
00087C 487C B3               4      OR  E
00087D 487D 20DB            12      JR  NZ,LOOP_HMMC
00087F 487F 18C3            12      JR  LOOP_COPY1
                                    
       4881                     WAIT_VDP:
000881 4881 3E02             7      LD  A,2
000883 4883 CD8A48          17      CALL    GET_STATUS
000886 4886 0F               4      RRCA
000887 4887 38F8            12      JR  C,WAIT_VDP
       4889                     GET_STATUS_0:
000889 4889 AF               4      XOR A
       488A                     GET_STATUS:
00088A 488A C5              11      PUSH    BC
00088B 488B ED4B0600        20      LD  BC,(RDVDP)
00088F 488F 0C               4      INC C
000890 4890 ED79            12      OUT (C),A
000892 4892 3E8F             7      LD  A,08FH
000894 4894 ED79            12      OUT (C),A
000896 4896 ED78            12      IN  A,(C)
000898 4898 C1              10      POP BC
000899 4899 C9              10      RET
                                
       489A                     GET_PIXEL256:
00089A 489A 7A               4      LD  A,D
00089B 489B B3               4      OR  E
00089C 489C 200A            12      JR  NZ,GET_PIXEL1
00089E 489E 2A38F1          16      LD  HL,(_BUF_EN)
0008A1 48A1 CDF348          17      CALL    ROM_READ
0008A4 48A4 EB               4      EX  DE,HL
0008A5 48A5 2A30F1          16      LD  HL,(_DTA)
       48A8                     GET_PIXEL1:
0008A8 48A8 7E               7      LD  A,(HL)
0008A9 48A9 23               6      INC HL
0008AA 48AA 1B               6      DEC DE
0008AB 48AB C9              10      RET
                                
       48AC                     GET_PIXEL:
0008AC 48AC 04               4      INC B
0008AD 48AD DD7D             9      LD  A,IXL
0008AF 48AF FE08             7      CP  8
0008B1 48B1 28E7            12      JR  Z,GET_PIXEL256
0008B3 48B3 FE06             7      CP  6
0008B5 48B5 282E            12      JR  Z,GET_PIXEL4
                                
0008B7 48B7 CB40             8      BIT 0,B
0008B9 48B9 20ED            12      JR  NZ,GET_PIXEL1
                                
0008BB 48BB 7A               4      LD  A,D
0008BC 48BC B3               4      OR  E
0008BD 48BD 200A            12      JR  NZ,GET_PIXEL2
                                
0008BF 48BF 2A38F1          16      LD  HL,(_BUF_EN)
0008C2 48C2 CDF348          17      CALL    ROM_READ
0008C5 48C5 EB               4      EX  DE,HL
0008C6 48C6 2A30F1          16      LD  HL,(_DTA)
                                
       48C9                     GET_PIXEL2:
0008C9 48C9 7E               7      LD  A,(HL)
0008CA 48CA 0F               4      RRCA
0008CB 48CB 0F               4      RRCA
0008CC 48CC 0F               4      RRCA
0008CD 48CD 0F               4      RRCA
0008CE 48CE C9              10      RET
                                
       48CF                     GET_PIXEL3:
0008CF 48CF 7A               4      LD  A,D
0008D0 48D0 B3               4      OR  E
0008D1 48D1 200A            12      JR  NZ,GET_PIXEL5
                                
0008D3 48D3 2A38F1          16      LD  HL,(_BUF_EN)
0008D6 48D6 CDF348          17      CALL    ROM_READ
0008D9 48D9 EB               4      EX  DE,HL
0008DA 48DA 2A30F1          16      LD  HL,(_DTA)
       48DD                     GET_PIXEL5:
0008DD 48DD 7E               7      LD  A,(HL)
0008DE 48DE 0F               4      RRCA
0008DF 48DF 0F               4      RRCA
0008E0 48E0 0F               4      RRCA
0008E1 48E1 0F               4      RRCA
0008E2 48E2 0F               4      RRCA
0008E3 48E3 0F               4      RRCA
0008E4 48E4 C9              10      RET
                                
       48E5                     GET_PIXEL4:
0008E5 48E5 78               4      LD  A,B
0008E6 48E6 E603             7      AND 3   ;+0
0008E8 48E8 28E5            12      JR  Z,GET_PIXEL3
0008EA 48EA 3D               4      DEC A   ;+1
0008EB 48EB 28DC            12      JR  Z,GET_PIXEL2
0008ED 48ED 3D               4      DEC A   ;+2
0008EE 48EE 7E               7      LD  A,(HL)
0008EF 48EF C0              11      RET NZ
0008F0 48F0 0F               4      RRCA        ;+3
0008F1 48F1 0F               4      RRCA
0008F2 48F2 C9              10      RET
                                
       48F3                     ROM_READ:
0008F3 48F3 E5              11      PUSH    HL
0008F4 48F4 D5              11      PUSH    DE
0008F5 48F5 C5              11      PUSH    BC
0008F6 48F6 FDE5            15      PUSH    IY
0008F8 48F8 224AF1          16      LD  (LEFTX),HL
0008FB 48FB 2A30F1          16      LD  HL,(_DTA)
0008FE 48FE 2243F1          16      LD  (DTAX),HL
000901 4901 2A4AF1          16      LD  HL,(LEFTX)
                                
000904 4904 CDA64B          17      CALL    RBX1
000907 4907 3870            12      JR  C,RBRERR1
000909 4909 79               4      LD  A,C
00090A 490A EB               4      EX  DE,HL
00090B 490B ED52            15      SBC HL,DE       ;CP 0HL,CDE
00090D 490D 19              11      ADD HL,DE
00090E 490E DE00             7      SBC A,000H
000910 4910 3801            12      JR  C,RBR1
000912 4912 EB               4      EX  DE,HL
       4913                     RBR1:
000913 4913 9F               4      SBC A,A
000914 4914 E601             7      AND 1
000916 4916 321FF1          13      LD  (_RESULT),A
000919 4919 7C               4      LD  A,H
00091A 491A B5               4      OR  L
00091B 491B CA6F49          10      JP  Z,RBREND0
                                
00091E 491E 222CF1          16      LD  (_LEFT),HL  ;Read record byte
000921 4921 224AF1          16      LD  (LEFTX),HL
                                
000924 4924 CDD24B          17      CALL    RBX2
000927 4927 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000929 4929 CDE54B          17      CALL    RBXA
00092C 492C DA8549          10      JP  C,RBRERR
00092F 492F C5              11      PUSH    BC
000930 4930 CD0844          17      CALL    ROM_LDIR
000933 4933 ED5343F1        20      LD  (DTAX),DE
000937 4937 2A4AF1          16      LD  HL,(LEFTX)
00093A 493A D1              10      POP DE
00093B 493B A7               4      AND A
00093C 493C ED52            15      SBC HL,DE
00093E 493E 224AF1          16      LD  (LEFTX),HL
000941 4941 2829            12      JR  Z,RBREND
                                
       4943                     RBRB:
000943 4943 CD214C          17      CALL    RBXB
000946 4946 2818            12      JR  Z,RBRC
       4948                     RBRB1:
000948 4948 C5              11      PUSH    BC
000949 4949 D5              11      PUSH    DE
00094A 494A CDCC4C          17      CALL    CLUST
00094D 494D EB               4      EX  DE,HL
00094E 494E ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000952 4952 CD0844          17      CALL    ROM_LDIR
000955 4955 EB               4      EX  DE,HL
000956 4956 D1              10      POP DE
000957 4957 C1              10      POP BC
000958 4958 CDA94C          17      CALL    GNCL
00095B 495B DA8549          10      JP  C,RBRERR
00095E 495E 10E8            13      DJNZ    RBRB1
       4960                     RBRC:
000960 4960 CD394C          17      CALL    RBXC
000963 4963 2807            12      JR  Z,RBREND
                                
000965 4965 CDCC4C          17      CALL    CLUST
000968 4968 EB               4      EX  DE,HL
000969 4969 CD0844          17      CALL    ROM_LDIR
       496C                     RBREND:
00096C 496C CD454C          17      CALL    RBXEND
       496F                     RBREND0:
00096F 496F FDE1            14      POP IY
000971 4971 C1              10      POP BC
000972 4972 D1              10      POP DE
000973 4973 F1              10      POP AF  ;(HL)
000974 4974 AF               4      XOR A
000975 4975 3A1FF1          13      LD  A,(_RESULT)
000978 4978 C9              10      RET
                                
       4979                     RBRERR1:
000979 4979 3E01             7      LD  A,001H
       497B                     RBRERR2:
00097B 497B FDE1            14      POP IY
00097D 497D C1              10      POP BC
00097E 497E D1              10      POP DE
00097F 497F E1              10      POP HL
000980 4980 37               4      SCF
000981 4981 210000          10      LD  HL,0
000984 4984 C9              10      RET
       4985                     RBRERR:
000985 4985 3EFF             7      LD  A,0FFH
000987 4987 18F2            12      JR  RBRERR2
                                
       4989                     FILE_DD:
000989 4989 E1              10      POP HL
00098A 498A 3E                      DB  03EH
00098B 498B C9              10      RET
00098C 498C 320CF1          13      LD  (SWC_BLOAD_M),A
       498F                     ROM_ORG:
00098F 498F 2A4CF1          16      LD  HL,(PARAM0)
000992 4992 7E               7      LD  A,(HL)
000993 4993 C9              10      RET
       4994                     FILE_B:
000994 4994 AF               4      XOR A
000995 4995 3250F1          13      LD  (FDRV),A
000998 4998 1E00             7      LD  E,0
00099A 499A 3A63F6          13      LD  A,(VALTYP)
00099D 499D FE03             7      CP  3       ;string
00099F 499F C2244A          10      JP  NZ,FILED
                                
0009A2 49A2 DD21D067        14      LD  IX,FRESTR
0009A6 49A6 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009AA 49AA CD1C00          17      CALL    _CALSLT
0009AD 49AD E5              11      PUSH    HL
0009AE 49AE DDE1            14      POP IX
                                
0009B0 49B0 DD5E00          19      LD  E,(IX+0)
0009B3 49B3 DD7E01          19      LD  A,(IX+1)
0009B6 49B6 DD5602          19      LD  D,(IX+2)
0009B9 49B9 DD62             9      LD  IXH,D
0009BB 49BB DD6F             9      LD  IXL,A
0009BD 49BD 7B               4      LD  A,E
       49BE                     FILE_BDOS:
0009BE 49BE FE04             7      CP  4
0009C0 49C0 3808            12      JR  C,FILEB1
0009C2 49C2 DD7E03          19      LD  A,(IX+3)
0009C5 49C5 FE3A             7      CP  ':'
0009C7 49C7 28C0            12      JR  Z,FILE_DD
0009C9 49C9 7B               4      LD  A,E
       49CA                     FILEB1:
0009CA 49CA FE02             7      CP  2
0009CC 49CC 3818            12      JR  C,DEVI1
0009CE 49CE DD7E01          19      LD  A,(IX+1)
0009D1 49D1 FE3A             7      CP  ':'
0009D3 49D3 2011            12      JR  NZ,DEVI1
0009D5 49D5 DD7E00          19      LD  A,(IX+0)        ;DRIVE
0009D8 49D8 CDFD4A          17      CALL    CAP
0009DB 49DB D640             7      SUB '@'
0009DD 49DD DD23            10      INC IX
0009DF 49DF DD23            10      INC IX
0009E1 49E1 1D               4      DEC E
0009E2 49E2 1D               4      DEC E
0009E3 49E3 3250F1          13      LD  (FDRV),A
       49E6                     DEVI1:
0009E6 49E6 DD7E00          19      LD  A,(IX+0)
0009E9 49E9 D65C             7      SUB 05CH        ;\
0009EB 49EB 2008            12      JR  NZ,NOROOT
0009ED 49ED 6F               4      LD  L,A
0009EE 49EE 67               4      LD  H,A
0009EF 49EF 225EF1          16      LD  (_CDX),HL
0009F2 49F2 DD23            10      INC IX
0009F4 49F4 1D               4      DEC E
       49F5                     NOROOT:
                                
       49F5                     SETDIR:
0009F5 49F5 CD244A          17      CALL    FILED
0009F8 49F8 DD7E00          19      LD  A,(IX+0)
0009FB 49FB FE5C             7      CP  05CH        ;\
0009FD 49FD C0              11      RET NZ
0009FE 49FE DD23            10      INC IX
000A00 4A00 1D               4      DEC E
000A01 4A01 3A51F1          13      LD  A,(FNAME)
000A04 4A04 FE20             7      CP  020H        ;. の処理
000A06 4A06 28ED            12      JR  Z,SETDIR
                                
000A08 4A08 CD134B          17      CALL    ROM_OPEN
000A0B 4A0B B7               4      OR  A
000A0C 4A0C C0              11      RET NZ
                                
000A0D 4A0D FD2A47F1        20      LD  IY,(DIRENT1)
000A11 4A11 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000A15 4A15 C8              11      RET Z
000A16 4A16 CD6B4A          17      CALL    FILEI
000A19 4A19 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A1C 4A1C FD661B          19      LD  H,(IY+01BH)
000A1F 4A1F 225EF1          16      LD  (_CDX),HL
000A22 4A22 18D1            12      JR  SETDIR
                                
       4A24                     FILED:
000A24 4A24 CD6B4A          17      CALL    FILEI
000A27 4A27 2151F1          10      LD  HL,FNAME
                                
000A2A 4A2A 0608             7      LD  B,8
       4A2C                     FILE2:
000A2C 4A2C CD784A          17      CALL    CCHKF
000A2F 4A2F C8              11      RET Z
000A30 4A30 FE2A             7      CP  '*'
000A32 4A32 282E            12      JR  Z,FILE9
000A34 4A34 FE2E             7      CP  '.'
000A36 4A36 280C            12      JR  Z,FILE4
000A38 4A38 77               7      LD  (HL),A
000A39 4A39 23               6      INC HL
000A3A 4A3A 10F0            13      DJNZ    FILE2
                                
       4A3C                     FILE3:
000A3C 4A3C CD784A          17      CALL    CCHKF
000A3F 4A3F C8              11      RET Z
000A40 4A40 FE2E             7      CP  '.'
000A42 4A42 20F8            12      JR  NZ,FILE3
                                
       4A44                     FILE4:
000A44 4A44 2159F1          10      LD  HL,FNAME+8
000A47 4A47 0603             7      LD  B,3
                                
       4A49                     FILE4L:
000A49 4A49 CD784A          17      CALL    CCHKF
000A4C 4A4C C8              11      RET Z
000A4D 4A4D FE2E             7      CP  '.'
000A4F 4A4F 2008            12      JR  NZ,FILE12
000A51 4A51 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000A54 4A54 3252F1          13      LD  (FNAME+1),A
000A57 4A57 3E20             7      LD  A,020H
       4A59                     FILE12:
000A59 4A59 FE2A             7      CP  '*'
000A5B 4A5B 280A            12      JR  Z,FILE10
000A5D 4A5D 77               7      LD  (HL),A
000A5E 4A5E 23               6      INC HL
000A5F 4A5F 10E8            13      DJNZ    FILE4L
000A61 4A61 C9              10      RET
                                
       4A62                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A62 4A62 CD674A          17      CALL    FILE10
000A65 4A65 18D5            12      JR  FILE3
                                
       4A67                     FILE10:
000A67 4A67 3E3F             7      LD  A,'?'
000A69 4A69 1808            12      JR  FILL_MEMORY
       4A6B                     FILEI:              ;名前＋拡張子をスペースで初期化
000A6B 4A6B 3E20             7      LD  A,020H
000A6D 4A6D 01000B          10      LD  BC,11*256   ;C=0にしておく
000A70 4A70 2151F1          10      LD  HL,FNAME
       4A73                     FILL_MEMORY:            ;HLからBバイトAで埋める
000A73 4A73 77               7      LD  (HL),A
000A74 4A74 23               6      INC HL
000A75 4A75 10FC            13      DJNZ    FILL_MEMORY
000A77 4A77 C9              10      RET
                                
       4A78                     CCHKF:
000A78 4A78 7B               4      LD  A,E
000A79 4A79 B7               4      OR  A
000A7A 4A7A C8              11      RET Z
000A7B 4A7B DD7E00          19      LD  A,(IX+0)
000A7E 4A7E CD854A          17      CALL    CCHK2
000A81 4A81 C8              11      RET Z
000A82 4A82 C3E84A          10      JP  FKAN
                                
       4A85                     CCHK2:
000A85 4A85 0C               4      INC C
000A86 4A86 0D               4      DEC C
000A87 4A87 C0              11      RET NZ
       4A88                     CCHK3:              ;ZF=1 で使えない文字
000A88 4A88 FE2B             7      CP  '+'
000A8A 4A8A C8              11      RET Z
000A8B 4A8B FE2C             7      CP  ','
000A8D 4A8D C8              11      RET Z
000A8E 4A8E FE2F             7      CP  '/'
000A90 4A90 C8              11      RET Z
000A91 4A91 FE3A             7      CP  ':'
000A93 4A93 C8              11      RET Z
000A94 4A94 FE3B             7      CP  ';'
000A96 4A96 C8              11      RET Z
000A97 4A97 FE3D             7      CP  '='
000A99 4A99 C8              11      RET Z
000A9A 4A9A FE5C             7      CP  05CH    ;\
000A9C 4A9C C8              11      RET Z
000A9D 4A9D FE1F             7      CP  01FH
000A9F 4A9F D0              11      RET NC
000AA0 4AA0 BF               4      CP  A       ;Z=1
000AA1 4AA1 C9              10      RET
                                
       4AA2                     SS1:
000AA2 4AA2 13               6      INC DE
       4AA3                     SPCUT:              ;スペースをカット
000AA3 4AA3 1A               7      LD  A,(DE)
000AA4 4AA4 FE20             7      CP  020H
000AA6 4AA6 28FA            12      JR  Z,SS1
000AA8 4AA8 C9              10      RET
                                
       4AA9                     SCREOF1:
000AA9 4AA9 13               6      INC DE
       4AAA                     SPCUTEX:            ;スペース改行などをカット
000AAA 4AAA 1A               7      LD  A,(DE)
000AAB 4AAB FE20             7      CP  020H
000AAD 4AAD 28FA            12      JR  Z,SCREOF1
000AAF 4AAF FE0D             7      CP  00DH
000AB1 4AB1 28F6            12      JR  Z,SCREOF1
000AB3 4AB3 FE0A             7      CP  00AH
000AB5 4AB5 28F2            12      JR  Z,SCREOF1
000AB7 4AB7 FE1A             7      CP  01AH
000AB9 4AB9 28EE            12      JR  Z,SCREOF1
000ABB 4ABB C9              10      RET
                                
       4ABC                     GETNUM:
000ABC 4ABC 210000          10      LD  HL,0
       4ABF                     GETNUM1:
000ABF 4ABF 1A               7      LD  A,(DE)
000AC0 4AC0 13               6      INC DE
000AC1 4AC1 D630             7      SUB '0'
000AC3 4AC3 D8              11      RET C
000AC4 4AC4 FE0A             7      CP  10
000AC6 4AC6 D0              11      RET NC
000AC7 4AC7 4D               4      LD  C,L
000AC8 4AC8 44               4      LD  B,H
000AC9 4AC9 29              11      ADD HL,HL   ;*2
000ACA 4ACA 29              11      ADD HL,HL   ;*4
000ACB 4ACB 09              11      ADD HL,BC   ;*5
000ACC 4ACC 29              11      ADD HL,HL   ;*10
000ACD 4ACD 4F               4      LD  C,A
000ACE 4ACE 0600             7      LD  B,0
000AD0 4AD0 09              11      ADD HL,BC
000AD1 4AD1 18EC            12      JR  GETNUM1
                                
       4AD3                     SEARCH_END:
000AD3 4AD3 7E               7      LD  A,(HL)
       4AD4                     SEARCH_END1:
000AD4 4AD4 23               6      INC HL
000AD5 4AD5 B7               4      OR  A
000AD6 4AD6 C8              11      RET Z
000AD7 4AD7 FE3A             7      CP  ':'
000AD9 4AD9 20F8            12      JR  NZ,SEARCH_END
000ADB 4ADB 7E               7      LD  A,(HL)
000ADC 4ADC FE3A             7      CP  ':'
000ADE 4ADE 28F4            12      JR  Z,SEARCH_END1
000AE0 4AE0 C9              10      RET
                                
       4AE1                     FKANC:
000AE1 4AE1 CB41             8      BIT 0,C
000AE3 4AE3 CC064B          17      CALL    Z,CAP2
000AE6 4AE6 1803            12      JR  FKANX
       4AE8                     FKAN:           ;漢字チェック
000AE8 4AE8 DD23            10      INC IX
000AEA 4AEA 1D               4      DEC E
       4AEB                     FKANX:
000AEB 4AEB CB41             8      BIT 0,C
000AED 4AED CB81             8      RES 0,C
000AEF 4AEF C0              11      RET NZ
000AF0 4AF0 FE80             7      CP  080H
000AF2 4AF2 D8              11      RET C
000AF3 4AF3 FEA0             7      CP  0A0H
000AF5 4AF5 3803            12      JR  C,FKAN1
000AF7 4AF7 FEE0             7      CP  0E0H
000AF9 4AF9 D8              11      RET C
       4AFA                     FKAN1:
000AFA 4AFA 0C               4      INC C
000AFB 4AFB A7               4      AND A
000AFC 4AFC C9              10      RET
                                
       4AFD                     CAP:
000AFD 4AFD FE61             7      CP  'a'
000AFF 4AFF D8              11      RET C
000B00 4B00 FE7B             7      CP  'z'+1
000B02 4B02 D0              11      RET NC
000B03 4B03 D620             7      SUB 020H
000B05 4B05 C9              10      RET
       4B06                     CAP2:
000B06 4B06 CDFD4A          17      CALL    CAP
       4B09                     CAP3:               ;
000B09 4B09 FE05             7      CP  5
000B0B 4B0B 2803            12      JR  Z,CAP4
000B0D 4B0D FE21             7      CP  021H
000B0F 4B0F C9              10      RET
       4B10                     CAP4:
000B10 4B10 3EE5             7      LD  A,0E5H
000B12 4B12 C9              10      RET
                                
       4B13                     ROM_OPEN:
000B13 4B13 CD3950          17      CALL    GET_DISK_BANK_FDRV
                                
000B16 4B16 CD804D          17      CALL    GET_DIR_DAT
000B19 4B19 D5              11      PUSH    DE
000B1A 4B1A CD2F4B          17      CALL    FILESE
000B1D 4B1D D1              10      POP DE
000B1E 4B1E 3F               4      CCF
000B1F 4B1F D8              11      RET C
000B20 4B20 2247F1          16      LD  (DIRENT1),HL
000B23 4B23 E5              11      PUSH    HL
000B24 4B24 210000          10      LD  HL,0
000B27 4B27 2226F1          16      LD  (RR_LOW),HL
000B2A 4B2A 2228F1          16      LD  (RR_HIGH),HL
000B2D 4B2D E1              10      POP HL
000B2E 4B2E C9              10      RET
                                
       4B2F                     FILESE:
000B2F 4B2F 7E               7      LD  A,(HL)
000B30 4B30 B7               4      OR  A
000B31 4B31 C8              11      RET Z       ;END:ZF=1 CF=0
000B32 4B32 FEE5             7      CP  0E5H
000B34 4B34 280D            12      JR  Z,FILESE1
000B36 4B36 1151F1          10      LD  DE,FNAME
000B39 4B39 E5              11      PUSH    HL
000B3A 4B3A CD804B          17      CALL    CPFILE
000B3D 4B3D CCA14B          17      CALL    Z,CPFILE2
000B40 4B40 E1              10      POP HL
000B41 4B41 37               4      SCF
000B42 4B42 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B43                     FILESE1:
000B43 4B43 CD4B4B          17      CALL    FNEXT
000B46 4B46 20E7            12      JR  NZ,FILESE
000B48 4B48 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B4A 4B4A C9              10      RET
                                
       4B4B                     FNEXT:
000B4B 4B4B 112000          10      LD  DE,020H
000B4E 4B4E 19              11      ADD HL,DE
000B4F 4B4F ED5B5EF1        20      LD  DE,(_CDX)
000B53 4B53 7A               4      LD  A,D
000B54 4B54 B3               4      OR  E
000B55 4B55 2019            12      JR  NZ,FNEXT_SUBDIR
000B57 4B57 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       4B58                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B58 4B58 F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B59 4B59 CB7C             8      BIT 7,H
000B5B 4B5B 2811            12      JR  Z,CHECK_DIR_PAGE1
000B5D 4B5D 7C               4      LD  A,H
000B5E 4B5E D620             7      SUB 020H
000B60 4B60 67               4      LD  H,A
000B61 4B61 3A49F1          13      LD  A,(_DIR_BANK)
000B64 4B64 3C               4      INC A
000B65 4B65 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B68 4B68 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B6B 4B6B 3249F1          13      LD  (_DIR_BANK),A
       4B6E                     CHECK_DIR_PAGE1:
000B6E 4B6E F1              10      POP AF
                                #endif
000B6F 4B6F C9              10      RET
                                
       4B70                     FNEXT_SUBDIR:           ;サブディレクトリ
000B70 4B70 0D               4      DEC C
000B71 4B71 C0              11      RET NZ
                                
000B72 4B72 ED5B5EF1        20      LD  DE,(_CDX)
000B76 4B76 CDA94C          17      CALL    GNCL
000B79 4B79 EB               4      EX  DE,HL
000B7A 4B7A 225EF1          16      LD  (_CDX),HL
000B7D 4B7D C3BB4D          10      JP  GET_SUBDIR
                                
       4B80                     CPFILE:
000B80 4B80 C5              11      PUSH    BC
000B81 4B81 01000B          10      LD  BC,00B00H
       4B84                     CPSTR1:
000B84 4B84 1A               7      LD  A,(DE)
000B85 4B85 FE3F             7      CP  '?'     ;Wild card
000B87 4B87 2812            12      JR  Z,CPSTR2
000B89 4B89 7E               7      LD  A,(HL)
000B8A 4B8A CDE14A          17      CALL    FKANC
000B8D 4B8D E5              11      PUSH    HL
000B8E 4B8E 67               4      LD  H,A
000B8F 4B8F 1A               7      LD  A,(DE)
000B90 4B90 CB01             4      RLC C
000B92 4B92 CDE14A          17      CALL    FKANC
000B95 4B95 CB09             4      RRC C
000B97 4B97 BC               4      CP  H       ;CP (HL),(DE)
000B98 4B98 E1              10      POP HL
000B99 4B99 2004            12      JR  NZ,CPSTR3
       4B9B                     CPSTR2:
000B9B 4B9B 13               6      INC DE
000B9C 4B9C 23               6      INC HL
000B9D 4B9D 10E5            13      DJNZ    CPSTR1
       4B9F                     CPSTR3:
000B9F 4B9F C1              10      POP BC
000BA0 4BA0 C9              10      RET
                                
       4BA1                     CPFILE2:
                                ;   LD  A,0E1H
000BA1 4BA1 3EF1             7      LD  A,0F1H
000BA3 4BA3 2F               4      CPL
000BA4 4BA4 A6               7      AND (HL)
000BA5 4BA5 C9              10      RET
                                
       4BA6                     RBX1:
000BA6 4BA6 E5              11      PUSH    HL      ;Record byte
                                
000BA7 4BA7 ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000BAB 4BAB 3A29F1          13      LD  A,(RR_HIGH+1)
000BAE 4BAE 4F               4      LD  C,A
                                
000BAF 4BAF 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000BB2 4BB2 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BB5 4BB5 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000BB8 4BB8 FD2A47F1        20      LD  IY,(DIRENT1)
000BBC 4BBC FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BBF 4BBF FD661D          19      LD  H,(IY+01DH)
000BC2 4BC2 FD7E1E          19      LD  A,(IY+01EH)
                                
000BC5 4BC5 A7               4      AND A
000BC6 4BC6 ED52            15      SBC HL,DE
000BC8 4BC8 99               4      SBC A,C
000BC9 4BC9 D1              10      POP DE
                                
000BCA 4BCA D8              11      RET C
000BCB 4BCB 4F               4      LD  C,A
000BCC 4BCC EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BCD 4BCD B2               4      OR  D
000BCE 4BCE B3               4      OR  E
000BCF 4BCF C0              11      RET NZ
000BD0 4BD0 37               4      SCF
000BD1 4BD1 C9              10      RET
                                
       4BD2                     RBX2:
000BD2 4BD2 ED4B27F1        20      LD  BC,(RR_LOW+1)
000BD6 4BD6 CD5A4C          17      CALL    RWXR
000BD9 4BD9 3A23F1          13      LD  A,(CLSZ_H)
000BDC 4BDC 3D               4      DEC A
000BDD 4BDD E5              11      PUSH    HL
000BDE 4BDE 2A26F1          16      LD  HL,(RR_LOW)
000BE1 4BE1 A4               4      AND H
000BE2 4BE2 B5               4      OR  L
000BE3 4BE3 E1              10      POP HL
000BE4 4BE4 C9              10      RET
                                
       4BE5                     RBXA:
000BE5 4BE5 D5              11      PUSH    DE
000BE6 4BE6 CDCC4C          17      CALL    CLUST
000BE9 4BE9 ED532EF1        20      LD  (_DTPS),DE
000BED 4BED D1              10      POP DE
000BEE 4BEE CDA94C          17      CALL    GNCL
000BF1 4BF1 D8              11      RET C
000BF2 4BF2 ED532AF1        20      LD  (_CLPS),DE
                                
000BF6 4BF6 ED4B26F1        20      LD  BC,(RR_LOW)
000BFA 4BFA 2A22F1          16      LD  HL,(CLSZ)
000BFD 4BFD 7C               4      LD  A,H
000BFE 4BFE 3D               4      DEC A
000BFF 4BFF A0               4      AND B
000C00 4C00 47               4      LD  B,A
000C01 4C01 ED42            15      SBC HL,BC       ;remaining cluster
                                
000C03 4C03 ED5B4AF1        20      LD  DE,(LEFTX)
000C07 4C07 ED52            15      SBC HL,DE       ;CP HL,DE
000C09 4C09 19              11      ADD HL,DE
000C0A 4C0A 3801            12      JR  C,RBXA1
000C0C 4C0C EB               4      EX  DE,HL
       4C0D                     RBXA1:
000C0D 4C0D 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C10 4C10 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C13 4C13 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C16 4C16 E5              11      PUSH    HL
000C17 4C17 2A2EF1          16      LD  HL,(_DTPS)
000C1A 4C1A 09              11      ADD HL,BC
000C1B 4C1B ED5B43F1        20      LD  DE,(DTAX)
000C1F 4C1F C1              10      POP BC
000C20 4C20 C9              10      RET
                                
       4C21                     RBXB:
000C21 4C21 2A43F1          16      LD  HL,(DTAX)
000C24 4C24 ED5B2AF1        20      LD  DE,(_CLPS)
000C28 4C28 3A4BF1          13      LD  A,(LEFTX+1)
000C2B 4C2B 47               4      LD  B,A
000C2C 4C2C 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C2F                     RBXB1:
000C2F 4C2F 1F               4      RRA     ;->CF
000C30 4C30 3804            12      JR  C,RBXB2
000C32 4C32 CB38             8      SRL B   ;B=B/2
000C34 4C34 18F9            12      JR  RBXB1
       4C36                     RBXB2:
000C36 4C36 78               4      LD  A,B
000C37 4C37 B7               4      OR  A
000C38 4C38 C9              10      RET
                                
       4C39                     RBXC:
000C39 4C39 ED4B4AF1        20      LD  BC,(LEFTX)
000C3D 4C3D 3A23F1          13      LD  A,(CLSZ_H)
000C40 4C40 3D               4      DEC A
000C41 4C41 A0               4      AND B
000C42 4C42 47               4      LD  B,A
000C43 4C43 B1               4      OR  C
000C44 4C44 C9              10      RET
                                
       4C45                     RBXEND:
000C45 4C45 ED5B2CF1        20      LD  DE,(_LEFT)
000C49 4C49 2A26F1          16      LD  HL,(RR_LOW)
000C4C 4C4C 3A29F1          13      LD  A,(RR_HIGH+1)
000C4F 4C4F 19              11      ADD HL,DE
000C50 4C50 CE00             7      ADC A,0
000C52 4C52 2226F1          16      LD  (RR_LOW),HL
000C55 4C55 3229F1          13      LD  (RR_HIGH+1),A
000C58 4C58 EB               4      EX  DE,HL       ;HL=Read byte
000C59 4C59 C9              10      RET 
                                
       4C5A                     RWXR:
000C5A 4C5A 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C5D                     L_RWX:
000C5D 4C5D 1F               4      RRA     ;->CF
000C5E 4C5E 3806            12      JR  C,E_RWX
000C60 4C60 CB38             8      SRL B   ;BC=BC/2
000C62 4C62 CB19             8      RR  C   ;
000C64 4C64 18F7            12      JR  L_RWX
       4C66                     E_RWX:
000C66 4C66 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C69 4C69 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C6C 4C6C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C6F 4C6F FD2A47F1        20      LD  IY,(DIRENT1)
000C73 4C73 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C76 4C76 FD561B          19      LD  D,(IY+01BH)
000C79 4C79 CD3950          17      CALL    GET_DISK_BANK_FDRV
       4C7C                     RWX1:
000C7C 4C7C ED532AF1        20      LD  (_CLPS),DE
000C80 4C80 7A               4      LD  A,D
000C81 4C81 B3               4      OR  E
000C82 4C82 37               4      SCF
000C83 4C83 C8              11      RET Z
                                
000C84 4C84 78               4      LD  A,B
000C85 4C85 B1               4      OR  C
000C86 4C86 C8              11      RET Z
                                
000C87 4C87 CDA94C          17      CALL    GNCL
000C8A 4C8A D8              11      RET C
000C8B 4C8B 0B               6      DEC BC
000C8C 4C8C CD194D          17      CALL    ENDCL
000C8F 4C8F 38EB            12      JR  C,RWX1
000C91 4C91 37               4      SCF
000C92 4C92 C9              10      RET
                                
       4C93                     NCL3:
000C93 4C93 CD3950          17      CALL    GET_DISK_BANK_FDRV
000C96 4C96 6B               4      LD  L,E
000C97 4C97 62               4      LD  H,D
000C98 4C98 CB3C             8      SRL H
000C9A 4C9A CB1D             8      RR  L
000C9C 4C9C 1F               4      RRA
000C9D 4C9D 19              11      ADD HL,DE
000C9E 4C9E 010060          10      LD  BC,BANK1_ADR
000CA1 4CA1 09              11      ADD HL,BC
000CA2 4CA2 ED4B24F1        20      LD  BC,(SECSZ)
000CA6 4CA6 09              11      ADD HL,BC
000CA7 4CA7 17               4      RLA
000CA8 4CA8 C9              10      RET
                                
       4CA9                     GNCL:
000CA9 4CA9 7A               4      LD  A,D
000CAA 4CAA B3               4      OR  E
000CAB 4CAB 37               4      SCF
000CAC 4CAC C8              11      RET Z
000CAD 4CAD C5              11      PUSH    BC
000CAE 4CAE E5              11      PUSH    HL
000CAF 4CAF CD934C          17      CALL    NCL3
000CB2 4CB2 3809            12      JR  C,GNC1
000CB4 4CB4 5E               7      LD  E,(HL)
000CB5 4CB5 23               6      INC HL
000CB6 4CB6 7E               7      LD  A,(HL)
000CB7 4CB7 E60F             7      AND 00FH
000CB9 4CB9 57               4      LD  D,A
000CBA 4CBA E1              10      POP HL
000CBB 4CBB C1              10      POP BC
000CBC 4CBC C9              10      RET
       4CBD                     GNC1:
000CBD 4CBD 7E               7      LD  A,(HL)
000CBE 4CBE 23               6      INC HL
000CBF 4CBF 56               7      LD  D,(HL)
000CC0 4CC0 0604             7      LD  B,4
       4CC2                     GNC1L:
000CC2 4CC2 CB3A             8      SRL D
000CC4 4CC4 1F               4      RRA
000CC5 4CC5 10FB            13      DJNZ    GNC1L
                                
000CC7 4CC7 5F               4      LD  E,A
000CC8 4CC8 E1              10      POP HL
000CC9 4CC9 C1              10      POP BC
000CCA 4CCA A7               4      AND A
000CCB 4CCB C9              10      RET
                                
       4CCC                     CLUST:
000CCC 4CCC EB               4      EX  DE,HL
       4CCD                     CLUST_HL:
000CCD 4CCD C5              11      PUSH    BC
000CCE 4CCE 3A23F1          13      LD  A,(CLSZ_H)
000CD1 4CD1 CD6550          17      CALL    MUL_AHL
                                
000CD4 4CD4 CD9D4D          17      CALL    GET_DIR_POS
000CD7 4CD7 4F               4      LD  C,A
000CD8 4CD8 0600             7      LD  B,0
000CDA 4CDA 09              11      ADD HL,BC
                                
000CDB 4CDB 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000CDE 4CDE 1F               4      RRA
000CDF 4CDF 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000CE2 4CE2 1F               4      RRA
000CE3 4CE3 0F               4      RRCA
000CE4 4CE4 0F               4      RRCA
000CE5 4CE5 0F               4      RRCA
000CE6 4CE6 4F               4      LD  C,A
                                
000CE7 4CE7 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000CEA 4CEA FE02             7      CP  2
000CEC 4CEC 280C            12      JR  Z,CLUST1
000CEE 4CEE CB01             4      RLC C
000CF0 4CF0 0D               4      DEC C
000CF1 4CF1 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000CF4 4CF4 FE02             7      CP  2
000CF6 4CF6 2002            12      JR  NZ,CLUST1
000CF8 4CF8 0D               4      DEC C
000CF9 4CF9 0D               4      DEC C
       4CFA                     CLUST1:
000CFA 4CFA 0D               4      DEC C
000CFB 4CFB 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000CFC 4CFC 4D               4      LD  C,L     ;C=読み出し元
000CFD 4CFD 29              11      ADD HL,HL   ;64KB→32KB
000CFE 4CFE 29              11      ADD HL,HL   ;32KB→16KB
000CFF 4CFF 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D00 4D00 CD3950          17      CALL    GET_DISK_BANK_FDRV
000D03 4D03 84               4      ADD A,H
000D04 4D04 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D07 4D07 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D0A 4D0A 3220F1          13      LD  (_BANK),A
000D0D 4D0D 69               4      LD  L,C     ;C=読み出し元
000D0E 4D0E 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D10 4D10 A5               4      AND L
                                #endif
       4D11                     CLUST2:
000D11 4D11 C660             7      ADD A,high BANK1_ADR
000D13 4D13 67               4      LD  H,A
000D14 4D14 2E00             7      LD  L,0
000D16 4D16 EB               4      EX  DE,HL
000D17 4D17 C1              10      POP BC
000D18 4D18 C9              10      RET
                                
       4D19                     ENDCL:
000D19 4D19 7A               4      LD  A,D ;END CLUSTER
000D1A 4D1A FE0F             7      CP  00FH    ;FAT12の最大値
000D1C 4D1C C0              11      RET NZ
000D1D 4D1D 7B               4      LD  A,E
000D1E 4D1E FEF7             7      CP  0F7H
000D20 4D20 C9              10      RET
                                
       4D21                     RB_READ:
000D21 4D21 AF               4      XOR A   ;HLA = HL*128
000D22 4D22 CB3C             8      SRL H
000D24 4D24 CB1D             8      RR  L
000D26 4D26 1F               4      RRA
000D27 4D27 3226F1          13      LD  (RR_LOW),A
000D2A 4D2A 2227F1          16      LD  (RR_MID),HL
000D2D 4D2D 218000          10      LD  HL,128
                                
000D30 4D30 CDF348          17      CALL    ROM_READ
000D33 4D33 C9              10      RET
                                
       4D34                     GETSEQ:
000D34 4D34 FD6E20          19      LD  L,(IY+32)
000D37 4D37 FD660C          19      LD  H,(IY+12)
                                
000D3A 4D3A CB25             8      SLA L
                                
000D3C 4D3C CB3C             8      SRL H
000D3E 4D3E CB1D             8      RR  L
000D40 4D40 C9              10      RET
                                
       4D41                     SETSEQ:
000D41 4D41 F5              11      PUSH    AF
000D42 4D42 3A26F1          13      LD  A,(RR_LOW)
000D45 4D45 2A27F1          16      LD  HL,(RR_MID)
                                
000D48 4D48 CD5F4D          17      CALL    SSQ1
                                
000D4B 4D4B 29              11      ADD HL,HL
000D4C 4D4C CB3D             8      SRL L
000D4E 4D4E FD7520          19      LD  (IY+32),L
000D51 4D51 FD740C          19      LD  (IY+12),H
000D54 4D54 F1              10      POP AF
000D55 4D55 C9              10      RET
                                
       4D56                     GETSIZE:
000D56 4D56 FD7E10          19      LD  A,(IY+16)
000D59 4D59 FD6E11          19      LD  L,(IY+17)
000D5C 4D5C FD6612          19      LD  H,(IY+18)
       4D5F                     SSQ1:
000D5F 4D5F 87               4      ADD A,A
000D60 4D60 ED6A            15      ADC HL,HL
000D62 4D62 B7               4      OR  A
000D63 4D63 C8              11      RET Z
000D64 4D64 23               6      INC HL
000D65 4D65 C9              10      RET
                                
       4D66                     SET_FCB:
000D66 4D66 D5              11      PUSH    DE
000D67 4D67 FDE1            14      POP IY
000D69 4D69 FD7E1C          19      LD  A,(IY+28)
000D6C 4D6C FEFF             7      CP  0FFH
000D6E 4D6E 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D70 4D70 E5              11      PUSH    HL
000D71 4D71 FD6E1A          19      LD  L,(IY+26)
000D74 4D74 FD661B          19      LD  H,(IY+27)
000D77 4D77 222AF1          16      LD  (_CLPS),HL
000D7A 4D7A E1              10      POP HL
000D7B 4D7B C9              10      RET
                                
       4D7C                     POPAF_SCF_FF_RET:
000D7C 4D7C F1              10      POP AF
000D7D 4D7D 37               4      SCF
000D7E 4D7E 9F               4      SBC A,A
000D7F 4D7F C9              10      RET
                                
       4D80                     GET_DIR_DAT:
000D80 4D80 2A5EF1          16      LD  HL,(_CDX)
000D83 4D83 7C               4      LD  A,H
000D84 4D84 B5               4      OR  L
000D85 4D85 2034            12      JR  NZ,GET_SUBDIR
000D87 4D87 CD9D4D          17      CALL    GET_DIR_POS
000D8A 4D8A C660             7      ADD A,high BANK1_ADR
000D8C 4D8C 2E00             7      LD  L,0
000D8E 4D8E 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000D8F 4D8F CD584B          17      CALL    CHECK_DIR_PAGE
                                #endif
000D92 4D92 3A21F1          13      LD  A,(_BANK1)
000D95 4D95 3249F1          13      LD  (_DIR_BANK),A
                                
000D98 4D98 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D9B 4D9B 4F               4      LD  C,A
000D9C 4D9C C9              10      RET
                                
       4D9D                     GET_DIR_POS:                ;ルートディレクトリ
000D9D 4D9D CD3950          17      CALL    GET_DISK_BANK_FDRV
000DA0 4DA0 3221F1          13      LD  (_BANK1),A
000DA3 4DA3 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000DA6 4DA6 47               4      LD  B,A
000DA7 4DA7 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000DAA 4DAA 4F               4      LD  C,A
000DAB 4DAB 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DAE                     GET_DIR_POS1:
000DAE 4DAE 81               4      ADD A,C
000DAF 4DAF 10FD            13      DJNZ    GET_DIR_POS1
                                
000DB1 4DB1 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4DB5                     L_MDP:
000DB5 4DB5 CB18             8      RR  B   ;->CF
000DB7 4DB7 D8              11      RET C
000DB8 4DB8 87               4      ADD A,A
000DB9 4DB9 18FA            12      JR  L_MDP
                                
       4DBB                     GET_SUBDIR:             ;サブディレクトリ
000DBB 4DBB CDCD4C          17      CALL    CLUST_HL
000DBE 4DBE EB               4      EX  DE,HL
000DBF 4DBF 3A20F1          13      LD  A,(_BANK)
000DC2 4DC2 3249F1          13      LD  (_DIR_BANK),A
000DC5 4DC5 3A23F1          13      LD  A,(CLSZ_H)
000DC8 4DC8 87               4      ADD A,A     ;*2
000DC9 4DC9 87               4      ADD A,A     ;*4
000DCA 4DCA 87               4      ADD A,A     ;*8
000DCB 4DCB 4F               4      LD  C,A
000DCC 4DCC C9              10      RET
                                
       4DCD                     STATEMENT:
000DCD 4DCD 115B4E          10      LD  DE,STR_CHDIR
000DD0 4DD0 CD414E          17      CALL    CPPROCNM
000DD3 4DD3 280A            12      JR  Z,_CHDIR
000DD5 4DD5 11614E          10      LD  DE,STR_RAMDISK
000DD8 4DD8 CD414E          17      CALL    CPPROCNM
000DDB 4DDB 2814            12      JR  Z,_RAMDISK
000DDD 4DDD 37               4      SCF
000DDE 4DDE C9              10      RET
       4DDF                     _CHDIR:
000DDF 4DDF 7E               7      LD  A,(HL)
000DE0 4DE0 FE28             7      CP  '('
000DE2 4DE2 37               4      SCF
000DE3 4DE3 C0              11      RET NZ
000DE4 4DE4 CDA246          17      CALL    INIT_PARAM
000DE7 4DE7 CD9449          17      CALL    FILE_B
000DEA 4DEA CD094E          17      CALL    ROM_CD
000DED 4DED DA6545          10      JP  C,ERROR_FILE_NOT_FOUND
000DF0 4DF0 C9              10      RET
                                
       4DF1                     _RAMDISK:
000DF1 4DF1 7E               7      LD  A,(HL)
000DF2 4DF2 FE28             7      CP  '('
000DF4 4DF4 37               4      SCF
000DF5 4DF5 C0              11      RET NZ
000DF6 4DF6 23               6      INC HL
000DF7 4DF7 DD212F54        14      LD  IX,FRMQNT
000DFB 4DFB FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000DFF 4DFF CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E02 4E02 7A               4      LD  A,D
000E03 4E03 B3               4      OR  E
000E04 4E04 C25F45          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E07 4E07 23               6      INC HL
000E08 4E08 C9              10      RET
                                
       4E09                     ROM_CD:
000E09 4E09 3A51F1          13      LD  A,(FNAME)
000E0C 4E0C FE20             7      CP  020H
000E0E 4E0E 2822            12      JR  Z,CD1
000E10 4E10 CD134B          17      CALL    ROM_OPEN
000E13 4E13 D8              11      RET C
000E14 4E14 FD2A47F1        20      LD  IY,(DIRENT1)
000E18 4E18 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E1C 4E1C CA6545          10      JP  Z,ERROR_FILE_NOT_FOUND
000E1F 4E1F FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E22 4E22 FD661B          19      LD  H,(IY+01BH)
       4E25                     CD2:
000E25 4E25 225CF1          16      LD  (_CD),HL
000E28 4E28 2A4EF1          16      LD  HL,(PARAM1)
       4E2B                     CD_SKIP:
000E2B 4E2B 7E               7      LD  A,(HL)
000E2C 4E2C 23               6      INC HL
000E2D 4E2D FE21             7      CP  021H
000E2F 4E2F 38FA            12      JR  C,CD_SKIP
000E31 4E31 C9              10      RET
       4E32                     CD1:
000E32 4E32 2A5EF1          16      LD  HL,(_CDX)
000E35 4E35 18EE            12      JR  CD2
                                
       4E37                     DEVICE1:
000E37 4E37 11694E          10      LD  DE,STR_A
000E3A 4E3A CD414E          17      CALL    CPPROCNM
000E3D 4E3D 37               4      SCF
000E3E 4E3E C0              11      RET NZ
000E3F 4E3F AF               4      XOR A
000E40 4E40 C9              10      RET
                                
       4E41                     CPPROCNM:
000E41 4E41 E5              11      PUSH    HL
000E42 4E42 2189FD          10      LD  HL,PROCNM
       4E45                     CPPROCNM1:
000E45 4E45 1A               7      LD  A,(DE)
000E46 4E46 13               6      INC DE
000E47 4E47 BE               7      CP  (HL)
000E48 4E48 23               6      INC HL
000E49 4E49 2003            12      JR  NZ,CPPROCNM2
000E4B 4E4B B7               4      OR  A
000E4C 4E4C 20F7            12      JR  NZ,CPPROCNM1
       4E4E                     CPPROCNM2:
000E4E 4E4E E1              10      POP HL
000E4F 4E4F C9              10      RET
                                
       4E50                     WILDCARD:
000E50 4E50 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4E5B                     STR_CHDIR:
000E5B 4E5B 434844495200            DB  "CHDIR",0
       4E61                     STR_RAMDISK:
000E61 4E61 52414D4449534B00        DB  "RAMDISK",0
       4E69                     STR_A:
000E69 4E69 4100                    DB  "A",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4E6B                     ERROR_WRITE_PROTECTED:
000E6B 4E6B 3E00             7      LD  A,0     ;Write protected
000E6D 4E6D C9              10      RET
       4E6E                     DISKIO:
000E6E 4E6E 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000E70 4E70 48               4      LD  C,B
000E71 4E71 CD4350          17      CALL    GET_DISK_BANK
       4E74                     SETMAP1:        
000E74 4E74 E5              11      PUSH    HL
       4E75                     DISKIO1:
000E75 4E75 C5              11      PUSH    BC      ;B=残りのセクタ数
000E76 4E76 D5              11      PUSH    DE      ;DE=セクタ番号
000E77 4E77 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000E78 4E78 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000E79 4E79 F5              11      PUSH    AF
000E7A 4E7A 3A25F1          13      LD  A,(SECSZ_H)
000E7D 4E7D CD6550          17      CALL    MUL_AHL
000E80 4E80 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000E81 4E81 4D               4      LD  C,L     ;C=読み出し元
000E82 4E82 29              11      ADD HL,HL       ;64KB→32KB
000E83 4E83 29              11      ADD HL,HL       ;32KB→16KB
000E84 4E84 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000E85 4E85 84               4      ADD A,H
000E86 4E86 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000E89 4E89 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000E8C 4E8C 3220F1          13      LD  (_BANK),A
000E8F 4E8F 79               4      LD  A,C     ;C=読み出し元
000E90 4E90 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4E92                     DISKIO2:
000E92 4E92 C660             7      ADD A,high BANK1_ADR
000E94 4E94 67               4      LD  H,A
000E95 4E95 ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000E99 4E99 69               4      LD  L,C     ;C=0
000E9A 4E9A CD0844          17      CALL    ROM_LDIR
000E9D 4E9D EB               4      EX  DE,HL
000E9E 4E9E F1              10      POP AF
000E9F 4E9F D1              10      POP DE
000EA0 4EA0 13               6      INC DE
000EA1 4EA1 C1              10      POP BC
000EA2 4EA2 10D1            13      DJNZ    DISKIO1
000EA4 4EA4 41               4      LD  B,C
                                
000EA5 4EA5 E1              10      POP HL
000EA6 4EA6 AF               4      XOR A
                                
000EA7 4EA7 FB               4      EI
000EA8 4EA8 C9              10      RET
                                
       4EA9                     DSKCHG:
000EA9 4EA9 CDE24E          17      CALL    IS_BPB
000EAC 4EAC 3824            12      JR  C,NOTREADY
000EAE 4EAE 3A23FB          13      LD  A,(DRVTBL+2)
000EB1 4EB1 B7               4      OR  A
000EB2 4EB2 201A            12      JR  NZ,DSKCHG1
000EB4 4EB4 3A21FB          13      LD  A,(DRVTBL)
000EB7 4EB7 FE02             7      CP  2
000EB9 4EB9 2013            12      JR  NZ,DSKCHG1
000EBB 4EBB CDE24E          17      CALL    IS_BPB
000EBE 4EBE 300E            12      JR  NC,DSKCHG1
000EC0 4EC0 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000EC2 4EC2 3221FB          13      LD  (DRVTBL),A
000EC5 4EC5 3223FB          13      LD  (DRVTBL+2),A
000EC8 4EC8 3A48F3          13      LD  A,(MASTERS)
000ECB 4ECB 3224FB          13      LD  (DRVTBL+3),A
       4ECE                     DSKCHG1:
000ECE 4ECE AF               4      XOR A
000ECF 4ECF 0601             7      LD  B,1
000ED1 4ED1 C9              10      RET
       4ED2                     NOTREADY:
000ED2 4ED2 3E02             7      LD  A,2
000ED4 4ED4 37               4      SCF
000ED5 4ED5 C9              10      RET
                                
       4ED6                     NO_BPB:
000ED6 4ED6 E1              10      POP HL
000ED7 4ED7 23               6      INC HL
000ED8 4ED8 116B50          10      LD  DE,DPB2DD
000EDB 4EDB 011200          10      LD  BC,DPB2DD_E-DPB2DD
000EDE 4EDE EDB0                    LDIR
000EE0 4EE0 AF               4      XOR A
000EE1 4EE1 C9              10      RET
                                
       4EE2                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000EE2 4EE2 CD4350          17      CALL    GET_DISK_BANK
                                
000EE5 4EE5 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000EE8 4EE8 FE01             7      CP  1
000EEA 4EEA D8              11      RET C
                                
000EEB 4EEB 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000EEE 4EEE C6FF             7      ADD A,0FFH
000EF0 4EF0 D8              11      RET C
                                
000EF1 4EF1 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       4EF4                     IS_BPB1:
000EF4 4EF4 FE01             7      CP  1
000EF6 4EF6 C8              11      RET Z
000EF7 4EF7 FE02             7      CP  2
000EF9 4EF9 C8              11      RET Z
000EFA 4EFA FE04             7      CP  4
000EFC 4EFC C8              11      RET Z
000EFD 4EFD 37               4      SCF
000EFE 4EFE C9              10      RET
                                
       4EFF                     GETDPB:
000EFF 4EFF E5              11      PUSH    HL
000F00 4F00 CD4350          17      CALL    GET_DISK_BANK
                                
000F03 4F03 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000F06 4F06 B7               4      OR  A
000F07 4F07 28CD            12      JR  Z,NO_BPB
000F09 4F09 DDE1            14      POP IX
000F0B 4F0B DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F0E 4F0E 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F11 4F11 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F14 4F14 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F17 4F17 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F1A 4F1A 87               4      ADD A,A
000F1B 4F1B 87               4      ADD A,A
000F1C 4F1C 87               4      ADD A,A
000F1D 4F1D 3D               4      DEC A
000F1E 4F1E DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F21 4F21 06FF             7      LD  B,-1
000F23 4F23 A7               4      AND A           ;無限ループ阻止
       4F24                     GETDPB1:
000F24 4F24 04               4      INC B
000F25 4F25 1F               4      RRA
000F26 4F26 38FC            12      JR  C,GETDPB1
000F28 4F28 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F2B 4F2B 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F2E 4F2E 3D               4      DEC A
000F2F 4F2F DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F32 4F32 A7               4      AND A           ;無限ループ阻止
000F33 4F33 06FF             7      LD  B,-1
       4F35                     GETDPB2:
000F35 4F35 04               4      INC B
000F36 4F36 1F               4      RRA
000F37 4F37 38FC            12      JR  C,GETDPB2
000F39 4F39 04               4      INC B
000F3A 4F3A DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000F3D 4F3D 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000F40 4F40 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000F43 4F43 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000F46 4F46 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000F49 4F49 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000F4C 4F4C 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000F4F 4F4F DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000F52 4F52 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000F56 4F56 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000F59 4F59 DD460A          19      LD  B,(IX+10)       ;FATCNT
000F5C 4F5C 210000          10      LD  HL,0
       4F5F                     GETDPB3:
000F5F 4F5F 19              11      ADD HL,DE
000F60 4F60 10FD            13      DJNZ    GETDPB3
       4F62                     GETDPB4:
000F62 4F62 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000F65 4F65 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000F68 4F68 19              11      ADD HL,DE
000F69 4F69 DD7511          19      LD  (IX+17),L       ;FIRDIR
000F6C 4F6C DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000F6F 4F6F DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F72 4F72 87               4      ADD A,A
000F73 4F73 87               4      ADD A,A
000F74 4F74 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F77                     GETDPB5:
000F77 4F77 CB3B             8      SRL E
000F79 4F79 1F               4      RRA
000F7A 4F7A 30FB            12      JR  NC,GETDPB5
000F7C 4F7C 1600             7      LD  D,0
000F7E 4F7E 19              11      ADD HL,DE
000F7F 4F7F DD750C          19      LD  (IX+12),L       ;FIRREC
000F82 4F82 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000F85 4F85 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000F88 4F88 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000F8B 4F8B DD560D          19      LD  D,(IX+13)       ;FIRREC
000F8E 4F8E A7               4      AND A
000F8F 4F8F ED52            15      SBC HL,DE
                                
000F91 4F91 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000F94 4F94 3C               4      INC A
000F95 4F95 37               4      SCF             ;無限ループ阻止
       4F96                     GETDPB6:
000F96 4F96 1F               4      RRA
000F97 4F97 3806            12      JR  C,GETDPB7
000F99 4F99 CB3C             8      SRL H
000F9B 4F9B CB1D             8      RR  L
000F9D 4F9D 18F7            12      JR  GETDPB6
       4F9F                     GETDPB7:
000F9F 4F9F 23               6      INC HL
000FA0 4FA0 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000FA3 4FA3 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4FA6                     GETDPBD1:
000FA6 4FA6 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FA9 4FA9 E6FC             7      AND 0FCH
000FAB 4FAB C8              11      RET Z
                                
000FAC 4FAC DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000FB0 4FB0 37               4      SCF
000FB1 4FB1 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000FB5 4FB5 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000FB8 4FB8 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000FBC 4FBC DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000FC0 4FC0 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000FC4 4FC4 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000FC8 4FC8 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000FCC 4FCC DDCB1126        23      SLA (IX+17)         ;FIRDIR
000FD0 4FD0 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000FD4 4FD4 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000FD7 4FD7 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000FDA 4FDA DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FDD 4FDD 87               4      ADD A,A
000FDE 4FDE 87               4      ADD A,A
000FDF 4FDF DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4FE2                     GETDPBD5:
000FE2 4FE2 CB3B             8      SRL E
000FE4 4FE4 1F               4      RRA
000FE5 4FE5 30FB            12      JR  NC,GETDPBD5
000FE7 4FE7 1600             7      LD  D,0
000FE9 4FE9 19              11      ADD HL,DE
000FEA 4FEA DD750C          19      LD  (IX+12),L       ;FIRREC
000FED 4FED DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FF0 4FF0 18B4            12      JR  GETDPBD1
                                
       4FF2                     CHOICE:
000FF2 4FF2 210000          10      LD  HL,0
000FF5 4FF5 C9              10      RET
                                
       4FF6                     DSKFMT:
000FF6 4FF6 AF               4      XOR A
000FF7 4FF7 37               4      SCF
       4FF8                     DSKSTP:
000FF8 4FF8 C9              10      RET
                                
       4FF9                     BASENT:
000FF9 4FF9 3A40F3          13      LD  A,(REBOOT)
000FFC 4FFC B7               4      OR  A
000FFD 4FFD 202B            12      JR  NZ,REBOOT1
000FFF 4FFF 217D50          10      LD  HL,AUTOEXEC
001002 5002 1150F1          10      LD  DE,FDRV
001005 5005 010C00          10      LD  BC,1+8+3
001008 5008 EDB0                    LDIR
00100A 500A CD134B          17      CALL    ROM_OPEN
00100D 500D 381B            12      JR  C,REBOOT1
00100F 500F CD1A45          17      CALL    ROM_LOAD1
001012 5012 218950          10      LD  HL,CMD_RUN
001015 5015 111FF4          10      LD  DE,KBUF
001018 5018 D5              11      PUSH    DE
001019 5019 010300          10      LD  BC,3
00101C 501C EDB0                    LDIR
00101E 501E E1              10      POP HL
00101F 501F FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001023 5023 DD210146        14      LD  IX,NEWSTT
001027 5027 CD1C00          17      CALL    _CALSLT
       502A                     REBOOT1:
00102A 502A FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00102E 502E DD219B40        14      LD  IX,READYR
001032 5032 C31C00          10      JP  _CALSLT
                                
       5035                     GETSLT:
001035 5035 3A22FB          13      LD  A,(DRVTBL+1)
001038 5038 C9              10      RET
                                
       5039                     GET_DISK_BANK_FDRV:
001039 5039 3A50F1          13      LD  A,(FDRV)
00103C 503C D601             7      SUB 1
00103E 503E 3003            12      JR  NC,GET_DISK_BANK
001040 5040 3A46F1          13      LD  A,(_DVSW)
       5043                     GET_DISK_BANK:
001043 5043 B7               4      OR  A       ;A=DRIVE
001044 5044 3E01             7      LD  A,DISK_BANK
001046 5046 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001048 5048 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       504B                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
00104B 504B 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00104E 504E 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001051 5051 F5              11      PUSH    AF
001052 5052 E5              11      PUSH    HL
001053 5053 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001056 5056 2224F1          16      LD  (SECSZ),HL
001059 5059 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
00105C 505C CD6550          17      CALL    MUL_AHL
00105F 505F 2222F1          16      LD  (CLSZ),HL
001062 5062 E1              10      POP HL
001063 5063 F1              10      POP AF
001064 5064 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5065                     MUL_AHL:
001065 5065 37               4      SCF     ;無限ループ回避
       5066                     MUL_AHL1:
001066 5066 1F               4      RRA     ;->CF
001067 5067 D8              11      RET C
001068 5068 29              11      ADD HL,HL
001069 5069 18FB            12      JR  MUL_AHL1
                                
       506B                     DPB2DD:
00106B 506B F9                      DB  0F9H    ;MEDIA
00106C 506C 0002                    DW  00200H  ;SECSIZ
00106E 506E 0F                      DB  00FH    ;DIRMSK
00106F 506F 04                      DB  004H    ;DIRSHFT
001070 5070 01                      DB  001H    ;CLUSMSK
001071 5071 02                      DB  002H    ;CLUSSHFT
001072 5072 0100                    DW  00001H  ;FIRFAT
001074 5074 02                      DB  002H    ;FATCNT
001075 5075 70                      DB  070H    ;MAXENT
001076 5076 0E00                    DW  0000EH  ;FIRREC
001078 5078 CA02                    DW  002CAH  ;MAXCLUS
00107A 507A 03                      DB  003H    ;FATSIZ
00107B 507B 0700                    DW  0007H   ;FIRDIR
       507D                     DPB2DD_E:
                                
       507D                     AUTOEXEC:
00107D 507D 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       5089                     CMD_RUN:
001089 5089 3A8A00                  DB  03AH,08AH,0
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       508C                     POP_HL_ERROR:
00108C 508C E1              10      POP     HL
       508D                     _ERROR:
00108D 508D 0600             7      LD  B,0
00108F 508F A7               4      AND A
001090 5090 C9              10      RET
                                
       5091                     ROM_BDOS:
001091 5091 E5              11      PUSH    HL
001092 5092 79               4      LD  A,C
001093 5093 87               4      ADD A,A
001094 5094 38F7            12      JR  C,_ERROR
001096 5096 6F               4      LD  L,A
001097 5097 265F             7      LD  H,high STABLE
001099 5099 7E               7      LD  A,(HL)
00109A 509A 2C               4      INC L
00109B 509B 66               7      LD  H,(HL)
00109C 509C 6F               4      LD  L,A
00109D 509D E3              19      EX  (SP),HL
00109E 509E 79               4      LD  A,C
00109F 509F C9              10      RET
                                
       50A0                     _PRINT:
       50A0                     PRINT:
0010A0 50A0 7B               4      LD  A,E
0010A1 50A1 1803            12      JR  MSG_A
                                
       50A3                     _SYS01:     ;(BDOS)コンソール入力
0010A3 50A3 CD1A51          17      CALL    _SYS07
       50A6                     MSG_A:
0010A6 50A6 FE03             7      CP  3
0010A8 50A8 2814            12      JR  Z,MSG_BR
       50AA                     MSGA1:
0010AA 50AA F5              11      PUSH    AF
0010AB 50AB C5              11      PUSH    BC
0010AC 50AC D5              11      PUSH    DE
0010AD 50AD E5              11      PUSH    HL
0010AE 50AE DDE5            15      PUSH    IX
0010B0 50B0 DD21A200        14      LD  IX,CHPUT
0010B4 50B4 CDFB42          17      CALL    CALSLT_R
0010B7 50B7 DDE1            14      POP IX
0010B9 50B9 E1              10      POP HL
0010BA 50BA D1              10      POP DE
0010BB 50BB C1              10      POP BC
       50BC                     MSGA2:
0010BC 50BC F1              10      POP AF
0010BD 50BD C9              10      RET
       50BE                     MSG_BR:
0010BE 50BE F5              11      PUSH    AF
0010BF 50BF 3ADDF3          13      LD  A,(CSRX)
0010C2 50C2 FE02             7      CP  2
0010C4 50C4 38F6            12      JR  C,MSGA2
0010C6 50C6 F1              10      POP AF
       50C7                     MSG_CR:
0010C7 50C7 F5              11      PUSH    AF
0010C8 50C8 3E0D             7      LD  A,00DH
0010CA 50CA CDAA50          17      CALL    MSGA1
0010CD 50CD 3E0A             7      LD  A,00AH
0010CF 50CF CDAA50          17      CALL    MSGA1
0010D2 50D2 F1              10      POP AF
0010D3 50D3 C9              10      RET
                                
       50D4                     _SYS02:     ;(BDOS)コンソール出力
0010D4 50D4 CDEF50          17      CALL    BREAK
0010D7 50D7 1805            12      JR  PRINTX
                                
       50D9                     _SYS06:     ;(BDOS)コンソール直接入出力
0010D9 50D9 7B               4      LD  A,E
0010DA 50DA 3C               4      INC A
0010DB 50DB CA2E51          10      JP  Z,_INKEY
       50DE                     PRINTX:
0010DE 50DE C3A050          10      JP  _PRINT
                                
       50E1                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0010E1 50E1 CD1A51          17      CALL    _SYS07
0010E4 50E4 FE03             7      CP  3
0010E6 50E6 CCEF50          17      CALL    Z,_BREAK
0010E9 50E9 FE13             7      CP  013H        ;CTRL+S
0010EB 50EB C0              11      RET NZ
       50EC                     PAUSE:
0010EC 50EC CD0651          17      CALL    KEYBC
                                
       50EF                     _BREAK:
       50EF                     BREAK:
0010EF 50EF F5              11      PUSH    AF
0010F0 50F0 C5              11      PUSH    BC
0010F1 50F1 D5              11      PUSH    DE
0010F2 50F2 E5              11      PUSH    HL
0010F3 50F3 DDE5            15      PUSH    IX
0010F5 50F5 DD21B700        14      LD  IX,BREAKX
0010F9 50F9 CDFB42          17      CALL    CALSLT_R
0010FC 50FC DDE1            14      POP IX
0010FE 50FE E1              10      POP HL
0010FF 50FF D1              10      POP DE
001100 5100 C1              10      POP BC
001101 5101 DCEF50          17      CALL    C,_BREAK
001104 5104 F1              10      POP AF
001105 5105 C9              10      RET
       5106                     KEYBC:
001106 5106 F5              11      PUSH    AF
001107 5107 C5              11      PUSH    BC
001108 5108 D5              11      PUSH    DE
001109 5109 E5              11      PUSH    HL
00110A 510A DDE5            15      PUSH    IX
00110C 510C DD215601        14      LD  IX,KILBUF
001110 5110 CDFB42          17      CALL    CALSLT_R
001113 5113 DDE1            14      POP IX
001115 5115 E1              10      POP HL
001116 5116 D1              10      POP DE
001117 5117 C1              10      POP BC
001118 5118 F1              10      POP AF
001119 5119 C9              10      RET
                                
       511A                     _SYS07:
       511A                     FLGET:
00111A 511A C5              11      PUSH    BC
00111B 511B D5              11      PUSH    DE
00111C 511C E5              11      PUSH    HL
00111D 511D DDE5            15      PUSH    IX
00111F 511F DD219F00        14      LD  IX,CHGET
001123 5123 CDFB42          17      CALL    CALSLT_R
001126 5126 DDE1            14      POP IX
001128 5128 E1              10      POP HL
001129 5129 D1              10      POP DE
00112A 512A C1              10      POP BC
00112B 512B FE03             7      CP  3
00112D 512D C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       512E                     _INKEY:
       512E                     INKEY:
00112E 512E CDC851          17      CALL    CPM_CONST
001131 5131 C8              11      RET Z
001132 5132 18E6            12      JR  FLGET
                                
       5134                     _SYS0A:     ;(BDOS)文字列入力
001134 5134 C5              11      PUSH    BC
001135 5135 E5              11      PUSH    HL
001136 5136 D5              11      PUSH    DE
001137 5137 CD6051          17      CALL    GETL
00113A 513A 111FF4          10      LD  DE,KBUF
00113D 513D E1              10      POP HL
00113E 513E E5              11      PUSH    HL
00113F 513F 0E00             7      LD  C,0
001141 5141 3004            12      JR  NC,SAX0
001143 5143 23               6      INC HL
001144 5144 23               6      INC HL
001145 5145 1808            12      JR  SAX4
       5147                     SAX0:
001147 5147 46               7      LD  B,(HL)
001148 5148 23               6      INC HL
       5149                     SAX1:
001149 5149 23               6      INC HL
00114A 514A 1A               7      LD  A,(DE)
00114B 514B 13               6      INC DE
00114C 514C B7               4      OR  A
00114D 514D 2004            12      JR  NZ,SAX2
       514F                     SAX4:
00114F 514F 360D            10      LD  (HL),00DH
001151 5151 1804            12      JR  SAX3
       5153                     SAX2:
001153 5153 77               7      LD  (HL),A
001154 5154 0C               4      INC C
001155 5155 10F2            13      DJNZ    SAX1
       5157                     SAX3:
001157 5157 D1              10      POP DE
001158 5158 79               4      LD  A,C
001159 5159 13               6      INC DE
00115A 515A 12               7      LD  (DE),A
00115B 515B 1B               6      DEC DE
00115C 515C E1              10      POP HL
00115D 515D C1              10      POP BC
00115E 515E A7               4      AND A
00115F 515F C9              10      RET
       5160                     GETL:
001160 5160 DDE5            15      PUSH    IX
001162 5162 FDE5            15      PUSH    IY
                                
001164 5164 2ADCF3          16      LD  HL,(CSRY)
001167 5167 22CAFB          16      LD  (FSTPOS),HL
       516A                     GETL1:
00116A 516A CDE150          17      CALL    _SYS08
00116D 516D FE09             7      CP  9
00116F 516F 2008            12      JR  NZ,GETL1V
001171 5171 211FF4          10      LD  HL,KBUF
001174 5174 CD8543          17      CALL    MSX
001177 5177 18F1            12      JR  GETL1
       5179                     GETL1V:
001179 5179 5F               4      LD  E,A
00117A 517A FE08             7      CP  8
00117C 517C CC1652          17      CALL    Z,CTRL02
00117F 517F FE20             7      CP  020H
001181 5181 D44252          17      CALL    NC,INSERT
001184 5184 CDAA50          17      CALL    MSGA1
                                
001187 5187 7B               4      LD  A,E
001188 5188 FE0D             7      CP  00DH
00118A 518A 20DE            12      JR  NZ,GETL1
                                
00118C 518C 111FF4          10      LD  DE,KBUF
00118F 518F 3AB0F3          13      LD  A,(LINLEN)
001192 5192 47               4      LD  B,A
001193 5193 CD2454          17      CALL    ZERO_MEMORY_DE
                                
001196 5196 2ACAFB          16      LD  HL,(FSTPOS)
001199 5199 3ADCF3          13      LD  A,(CSRY)
00119C 519C 6F               4      LD  L,A
00119D 519D E5              11      PUSH    HL
00119E 519E CD7352          17      CALL    LOC0
0011A1 51A1 4D               4      LD  C,L
0011A2 51A2 44               4      LD  B,H
0011A3 51A3 E1              10      POP HL
0011A4 51A4 3AB0F3          13      LD  A,(LINLEN)
0011A7 51A7 94               4      SUB H
0011A8 51A8 3D               4      DEC A
0011A9 51A9 5F               4      LD  E,A
0011AA 51AA 211FF4          10      LD  HL,KBUF
       51AD                     GETL2:
0011AD 51AD CD0652          17      CALL    _SCRN
0011B0 51B0 03               6      INC BC
0011B1 51B1 77               7      LD  (HL),A
0011B2 51B2 23               6      INC HL
0011B3 51B3 1D               4      DEC E
0011B4 51B4 20F7            12      JR  NZ,GETL2
0011B6 51B6 CDC750          17      CALL    MSG_CR
                                
0011B9 51B9 FDE1            14      POP IY
0011BB 51BB DDE1            14      POP IX
       51BD                     GETL3:
0011BD 51BD 2B               6      DEC HL
0011BE 51BE 7E               7      LD  A,(HL)
0011BF 51BF FE21             7      CP  021H
0011C1 51C1 D0              11      RET NC
0011C2 51C2 3600            10      LD  (HL),0
0011C4 51C4 15               4      DEC D
0011C5 51C5 20F6            12      JR  NZ,GETL3
0011C7 51C7 C9              10      RET
                                
       51C8                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       51C8                     CONSTX:
       51C8                     CPM_CONST:
0011C8 51C8 C5              11      PUSH    BC
0011C9 51C9 D5              11      PUSH    DE
0011CA 51CA E5              11      PUSH    HL
0011CB 51CB DDE5            15      PUSH    IX
0011CD 51CD DD219C00        14      LD  IX,CHSNS
0011D1 51D1 CDFB42          17      CALL    CALSLT_R
0011D4 51D4 DDE1            14      POP IX
0011D6 51D6 E1              10      POP HL
0011D7 51D7 D1              10      POP DE
0011D8 51D8 C1              10      POP BC
0011D9 51D9 C9              10      RET
                                
       51DA                     _SYS2A:     ;(BDOS)日付の獲得
0011DA 51DA AF               4      XOR A
0011DB 51DB 57               4      LD  D,A
0011DC 51DC 5F               4      LD  E,A
0011DD 51DD 67               4      LD  H,A
0011DE 51DE 6F               4      LD  L,A
0011DF 51DF C9              10      RET
                                
       51E0                     _SYS2C:     ;(BDOS)時刻の獲得
0011E0 51E0 AF               4      XOR A
0011E1 51E1 57               4      LD  D,A
0011E2 51E2 5F               4      LD  E,A
0011E3 51E3 67               4      LD  H,A
0011E4 51E4 6F               4      LD  L,A
0011E5 51E5 C9              10      RET
                                
       51E6                     POS:
0011E6 51E6 F5              11      PUSH    AF
0011E7 51E7 2ADCF3          16      LD  HL,(CSRY)
0011EA 51EA 7D               4      LD  A,L
0011EB 51EB 6C               4      LD  L,H
0011EC 51EC 67               4      LD  H,A
0011ED 51ED 2C               4      INC L
0011EE 51EE 24               4      INC H
0011EF 51EF F1              10      POP AF
0011F0 51F0 C9              10      RET
                                
       51F1                     LOC:
0011F1 51F1 F5              11      PUSH    AF
0011F2 51F2 E5              11      PUSH    HL
0011F3 51F3 7D               4      LD  A,L
0011F4 51F4 6C               4      LD  L,H
0011F5 51F5 67               4      LD  H,A
0011F6 51F6 2D               4      DEC L
0011F7 51F7 25               4      DEC H
0011F8 51F8 DDE5            15      PUSH    IX
0011FA 51FA DD21C600        14      LD  IX,POSIT
0011FE 51FE CDFB42          17      CALL    CALSLT_R
001201 5201 DDE1            14      POP IX
001203 5203 E1              10      POP HL
001204 5204 F1              10      POP AF
001205 5205 C9              10      RET
                                
       5206                     _SCRN:
       5206                     SCRN:
001206 5206 E5              11      PUSH    HL
001207 5207 DDE5            15      PUSH    IX
                                
001209 5209 69               4      LD  L,C
00120A 520A 60               4      LD  H,B
00120B 520B DD214A00        14      LD  IX,RDVRM
00120F 520F CDFB42          17      CALL    CALSLT_R
                                
001212 5212 DDE1            14      POP IX
001214 5214 E1              10      POP HL
001215 5215 C9              10      RET
                                
       5216                     CTRL02:
001216 5216 F5              11      PUSH    AF
001217 5217 D5              11      PUSH    DE
001218 5218 2ADCF3          16      LD  HL,(CSRY)
00121B 521B 3AB0F3          13      LD  A,(LINLEN)
00121E 521E 4F               4      LD  C,A
00121F 521F 94               4      SUB H   ;CSRX
001220 5220 C602             7      ADD A,2
001222 5222 47               4      LD  B,A ;カーソルより右の文字数
001223 5223 61               4      LD  H,C ;LINLEN
001224 5224 C5              11      PUSH    BC
001225 5225 CD7352          17      CALL    LOC0
001228 5228 C1              10      POP BC
                                
001229 5229 1620             7      LD  D,020H
       522B                     C8X1:
00122B 522B DD214A00        14      LD  IX,RDVRM
00122F 522F CDFB42          17      CALL    CALSLT_R
001232 5232 4F               4      LD  C,A
001233 5233 7A               4      LD  A,D
001234 5234 DD214D00        14      LD  IX,WRTVRM
001238 5238 CDFB42          17      CALL    CALSLT_R
00123B 523B 2B               6      DEC HL
00123C 523C 51               4      LD  D,C
00123D 523D 10EC            13      DJNZ    C8X1
00123F 523F D1              10      POP DE
001240 5240 F1              10      POP AF
001241 5241 C9              10      RET
                                
       5242                     INSERT:
001242 5242 F5              11      PUSH    AF
001243 5243 D5              11      PUSH    DE
001244 5244 2ADCF3          16      LD  HL,(CSRY)
001247 5247 3AB0F3          13      LD  A,(LINLEN)
00124A 524A 4F               4      LD  C,A
00124B 524B 94               4      SUB H   ;CSRX
00124C 524C 3C               4      INC A
00124D 524D 47               4      LD  B,A ;カーソルより右の文字数
00124E 524E C5              11      PUSH    BC
00124F 524F CD7352          17      CALL    LOC0
001252 5252 C1              10      POP BC
                                
001253 5253 1620             7      LD  D,020H
       5255                     INS1:
001255 5255 DD214A00        14      LD  IX,RDVRM
001259 5259 CDFB42          17      CALL    CALSLT_R
00125C 525C 4F               4      LD  C,A
00125D 525D 7A               4      LD  A,D
00125E 525E DD214D00        14      LD  IX,WRTVRM
001262 5262 CDFB42          17      CALL    CALSLT_R
001265 5265 23               6      INC HL
001266 5266 51               4      LD  D,C
001267 5267 10EC            13      DJNZ    INS1
001269 5269 D1              10      POP DE
00126A 526A F1              10      POP AF
00126B 526B C9              10      RET
                                
       526C                     CONOUT1:
00126C 526C 59               4      LD  E,C
00126D 526D C3A050          10      JP  _PRINT
                                
       5270                     GETVRAM:
001270 5270 2ADCF3          16      LD  HL,(CSRY)
       5273                     LOC0:
001273 5273 2D               4      DEC L
001274 5274 25               4      DEC H
001275 5275 4C               4      LD  C,H ;CSRX-1
001276 5276 5D               4      LD  E,L ;CSRY-1
       5277                     LOC1:
001277 5277 3AB0F3          13      LD  A,(LINLEN)
00127A 527A 67               4      LD  H,A
00127B 527B 1600             7      LD  D,0
00127D 527D 6A               4      LD  L,D ;0
00127E 527E 0608             7      LD  B,8
       5280                     LOC2:
001280 5280 29              11      ADD HL,HL
001281 5281 3001            12      JR  NC,LOC3
001283 5283 19              11      ADD HL,DE
       5284                     LOC3:
001284 5284 10FA            13      DJNZ    LOC2
001286 5286 09              11      ADD HL,BC
001287 5287 C9              10      RET
                                
       5288                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001288 5288 212200          10      LD  HL,00022H
00128B 528B AF               4      XOR A
00128C 528C 7D               4      LD  A,L
00128D 528D C9              10      RET
                                
       528E                     _SYS0D:     ;(BDOS)ディスク・リセット
00128E 528E 218000          10      LD  HL,00080H
001291 5291 2230F1          16      LD  (_DTA),HL
001294 5294 C9              10      RET
                                
       5295                     _SYS0E:     ;(BDOS)カレントドライブの設定
001295 5295 7B               4      LD  A,E
001296 5296 FE02             7      CP  2
001298 5298 D0              11      RET NC
001299 5299 3246F1          13      LD  (_DVSW),A
00129C 529C C9              10      RET
                                
       529D                     _SYS0F:     ;(BDOS)ファイルのオープン
00129D 529D D5              11      PUSH    DE
00129E 529E FDE1            14      POP IY
0012A0 52A0 CD0B54          17      CALL    INIT_FILE
0012A3 52A3 CD134B          17      CALL    ROM_OPEN
0012A6 52A6 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0012A8 52A8 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0012AC 52AC FDE5            15      PUSH    IY
0012AE 52AE D1              10      POP DE
0012AF 52AF 13               6      INC DE
0012B0 52B0 010B00          10      LD  BC,11
0012B3 52B3 EDB0                    LDIR
                                ;               Attribute
0012B5 52B5 7E               7      LD  A,(HL)
0012B6 52B6 FD770D          19      LD  (IY+13),A
                                ;               TIME
0012B9 52B9 110B00          10      LD  DE,11
0012BC 52BC 19              11      ADD HL,DE
0012BD 52BD 7E               7      LD  A,(HL)
0012BE 52BE 23               6      INC HL
0012BF 52BF FD7716          19      LD  (IY+22),A
0012C2 52C2 7E               7      LD  A,(HL)
0012C3 52C3 23               6      INC HL
0012C4 52C4 FD7717          19      LD  (IY+23),A
                                ;               DATE
0012C7 52C7 7E               7      LD  A,(HL)
0012C8 52C8 23               6      INC HL
0012C9 52C9 FD7714          19      LD  (IY+20),A
0012CC 52CC 7E               7      LD  A,(HL)
0012CD 52CD 23               6      INC HL
0012CE 52CE FD7715          19      LD  (IY+21),A
                                ;               First cluster
0012D1 52D1 7E               7      LD  A,(HL)
0012D2 52D2 23               6      INC HL
0012D3 52D3 FD771A          19      LD  (IY+26),A
0012D6 52D6 7E               7      LD  A,(HL)
0012D7 52D7 23               6      INC HL
0012D8 52D8 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0012DB 52DB 7E               7      LD  A,(HL)
0012DC 52DC 23               6      INC HL
0012DD 52DD FD7710          19      LD  (IY+16),A
0012E0 52E0 7E               7      LD  A,(HL)
0012E1 52E1 23               6      INC HL
0012E2 52E2 FD7711          19      LD  (IY+17),A
0012E5 52E5 7E               7      LD  A,(HL)
0012E6 52E6 23               6      INC HL
0012E7 52E7 FD7712          19      LD  (IY+18),A
0012EA 52EA 7E               7      LD  A,(HL)
0012EB 52EB FD7713          19      LD  (IY+19),A
0012EE 52EE AF               4      XOR A
0012EF 52EF FD770C          19      LD  (IY+12),A
0012F2 52F2 C9              10      RET
                                
       52F3                     _SYS10:     ;(BDOS)ファイルのクローズ
0012F3 52F3 AF               4      XOR A
0012F4 52F4 C9              10      RET
                                
       52F5                     S11X1:
0012F5 52F5 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012F8 52F8 FD750E          19      LD  (IY+14),L
0012FB 52FB FD740F          19      LD  (IY+15),H
       52FE                     SCF_FF_RET:
0012FE 52FE 37               4      SCF
0012FF 52FF 9F               4      SBC A,A
001300 5300 C9              10      RET
                                
       5301                     _SYS11:     ;(BDOS)最初のファイルの検索
001301 5301 ED5333F1        20      LD  (_FCB),DE
001305 5305 D5              11      PUSH    DE
001306 5306 FDE1            14      POP IY
001308 5308 CD0B54          17      CALL    INIT_FILE
00130B 530B CD804D          17      CALL    GET_DIR_DAT
       530E                     S12X1:
00130E 530E CD2F4B          17      CALL    FILESE
001311 5311 30E2            12      JR  NC,S11X1
001313 5313 0D               4      DEC C
001314 5314 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001317 5317 FDCB0D66        20      BIT 4,(IY+13)
00131B 531B 2809            12      JR  Z,S12X2
00131D 531D E5              11      PUSH    HL
00131E 531E DDE1            14      POP IX
001320 5320 DDCB0E66        20      BIT 4,(IX+1+13)
001324 5324 28E8            12      JR  Z,S12X1
       5326                     S12X2:
001326 5326 012000          10      LD  BC,32
001329 5329 ED5B30F1        20      LD  DE,(_DTA)
00132D 532D AF               4      XOR A
00132E 532E 12               7      LD  (DE),A      ;ドライブ番号
00132F 532F 13               6      INC DE
001330 5330 EDB0                    LDIR            ;ディレクトリエントリ
001332 5332 FD750E          19      LD  (IY+14),L
001335 5335 FD740F          19      LD  (IY+15),H
001338 5338 C9              10      RET
                                
       5339                     _SYS12:
001339 5339 FD2A33F1        20      LD  IY,(_FCB)
00133D 533D FDE5            15      PUSH    IY
00133F 533F D1              10      POP DE
001340 5340 CD0B54          17      CALL    INIT_FILE
                                
001343 5343 FD6E0E          19      LD  L,(IY+14)
001346 5346 FD660F          19      LD  H,(IY+15)
001349 5349 FD4E19          19      LD  C,(IY+25)
00134C 534C 18C0            12      JR  S12X1
                                
       534E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00134E 534E CD664D          17      CALL    SET_FCB
001351 5351 CD344D          17      CALL    GETSEQ
001354 5354 CD214D          17      CALL    RB_READ
001357 5357 E5              11      PUSH    HL
001358 5358 CD414D          17      CALL    SETSEQ
00135B 535B E1              10      POP HL
       535C                     SREAD:
00135C 535C C601             7      ADD A,001H
00135E 535E D8              11      RET C
                                
00135F 535F 7D               4      LD  A,L
001360 5360 D601             7      SUB 001H
001362 5362 9F               4      SBC A,A
001363 5363 E603             7      AND 3
001365 5365 1F               4      RRA
001366 5366 C9              10      RET
                                
       5367                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001367 5367 210100          10      LD  HL,00001H
00136A 536A AF               4      XOR A
00136B 536B C9              10      RET
                                
       536C                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00136C 536C 3A46F1          13      LD  A,(_DVSW)
00136F 536F C9              10      RET
                                
       5370                     _SYS1A:     ;(BDOS)DTAの設定
001370 5370 ED5330F1        20      LD  (_DTA),DE
001374 5374 AF               4      XOR A
001375 5375 C9              10      RET
                                
       5376                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001376 5376 010002          10      LD  BC,512
001379 5379 11C302          10      LD  DE,707
00137C 537C 210000          10      LD  HL,0
00137F 537F DD2135F1        14      LD  IX,_BUF
001383 5383 FD2135F1        14      LD  IY,_BUF
001387 5387 FD3600F9        19      LD  (IY+0),0F9H
00138B 538B 3E02             7      LD  A,2
00138D 538D C9              10      RET
                                
       538E                     _SYS21:     ;(BDOS)ランダムな読み出し
00138E 538E CD664D          17      CALL    SET_FCB
                                
001391 5391 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001394 5394 FD6622          19      LD  H,(IY+34)
                                
001397 5397 CD214D          17      CALL    RB_READ
00139A 539A 18C0            12      JR  SREAD
                                
       539C                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00139C 539C CD9D52          17      CALL    _SYS0F
00139F 539F D8              11      RET C
                                
0013A0 53A0 D5              11      PUSH    DE      ;EX DE,IY
0013A1 53A1 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013A3 53A3 CD564D          17      CALL    GETSIZE
       53A6                     _S24X1:
0013A6 53A6 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013A9 53A9 FD7422          19      LD  (IY+34),H
0013AC 53AC FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0013B0 53B0 FDE3            23      EX  (SP),IY     ;
0013B2 53B2 D1              10      POP DE      ;
                                
0013B3 53B3 AF               4      XOR A
0013B4 53B4 C9              10      RET
                                
       53B5                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0013B5 53B5 E5              11      PUSH    HL
0013B6 53B6 D5              11      PUSH    DE      ;EX DE,IY
0013B7 53B7 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013B9 53B9 CD344D          17      CALL    GETSEQ
0013BC 53BC 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       53BE                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0013BE 53BE CD664D          17      CALL    SET_FCB
0013C1 53C1 E5              11      PUSH    HL
0013C2 53C2 FD6E21          19      LD  L,(IY+33)
0013C5 53C5 FD6622          19      LD  H,(IY+34)
0013C8 53C8 2226F1          16      LD  (RR_LOW),HL
0013CB 53CB FD6E23          19      LD  L,(IY+35)
0013CE 53CE FD6624          19      LD  H,(IY+36)
0013D1 53D1 2228F1          16      LD  (RR_HIGH),HL
0013D4 53D4 E1              10      POP HL
0013D5 53D5 CDF348          17      CALL    ROM_READ
0013D8 53D8 ED5B26F1        20      LD  DE,(RR_LOW)
0013DC 53DC FD7321          19      LD  (IY+33),E
0013DF 53DF FD7222          19      LD  (IY+34),D
0013E2 53E2 ED5B28F1        20      LD  DE,(RR_HIGH)
0013E6 53E6 FD7323          19      LD  (IY+35),E
0013E9 53E9 FD7224          19      LD  (IY+36),D
0013EC 53EC 9F               4      SBC A,A
0013ED 53ED C9              10      RET
                                
       53EE                     _SYS2F:
0013EE 53EE 44               4      LD  B,H
0013EF 53EF 2A30F1          16      LD  HL,(_DTA)
0013F2 53F2 C36E4E          10      JP  DISKIO
                                
       53F5                     _SYS5A:
0013F5 53F5 0600             7      LD  B,0
0013F7 53F7 D5              11      PUSH    DE
0013F8 53F8 DDE1            14      POP IX
       53FA                     _SX5A1:
0013FA 53FA 1A               7      LD  A,(DE)
0013FB 53FB B7               4      OR  A
0013FC 53FC 2804            12      JR  Z,_SX5A2
0013FE 53FE 13               6      INC DE
0013FF 53FF 04               4      INC B
001400 5400 18F8            12      JR  _SX5A1
                                
       5402                     _SX5A2:
001402 5402 78               4      LD  A,B
001403 5403 CDBE49          17      CALL    FILE_BDOS
001406 5406 CD094E          17      CALL    ROM_CD
001409 5409 9F               4      SBC A,A
00140A 540A C9              10      RET
                                
       540B                     INIT_FILE:
00140B 540B EB               4      EX  DE,HL
00140C 540C 1150F1          10      LD  DE,FDRV
00140F 540F 010C00          10      LD  BC,1+8+3
001412 5412 EDB0                    LDIR
001414 5414 CD3950          17      CALL    GET_DISK_BANK_FDRV
001417 5417 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00141A 541A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
00141D 541D 2A5CF1          16      LD  HL,(_CD)
001420 5420 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
001423 5423 C9              10      RET
                                
       5424                     ZERO_MEMORY_DE:
001424 5424 AF               4      XOR A
       5425                     FILL_MEMORY_DE:
001425 5425 12               7      LD  (DE),A
001426 5426 13               6      INC DE
001427 5427 10FC            13      DJNZ    FILL_MEMORY_DE
001429 5429 C9              10      RET
                                
00142A 542A                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 8D50A350D4508D50        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 8D508D50D9501A51        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 E1508D503451C851        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 88528E5295529D52        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 F352015339538D50        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 4E538D508D508D50        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 67536C5370537653        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 8D508D508D509C53        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 B5538D508D50BE53        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 8D508D50DA518D50        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 E0518D508D50EE53        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 8D508D50F5538D50        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 8D508D508D508D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
