                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
                                ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
                                ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
       F280                     ISC EQU 0F280H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU 0F280H
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 FA4D                    DW  STATEMENT   ; STATEMENT
000006 4006 F84E                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3794F          10      JP  DISKIO
000013 4013 C3B44F          10      JP  DSKCHG
000016 4016 C30A50          10      JP  GETDPB
000019 4019 C3FD50          10      JP  CHOICE
00001C 401C C30151          10      JP  DSKFMT
00001F 401F C30351          10      JP  DSKSTP
000022 4022 C30451          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C30151          10      JP  DSKFMT
000029 4029 C30351          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C33D51          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.4.0.1",0
            204449534B20524F    
            4D204C6974652076    
            302E342E302E3100    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 AF               4      XOR A
000107 4107 2100F3          10      LD  HL,0F300H
00010A 410A 0668             7      LD  B,068H
00010C 410C CDAE4A          17      CALL    FILL_MEMORY
                                
00010F 410F 3E01             7      LD  A,1
000111 4111 3221FB          13      LD  (DRVTBL),A
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  HL,(STKTOP) ;起動時の空き容量表示の為
                                    LD  BC,-00140H
                                    ADD HL,BC
                                    LD  (STKTOP),HL
                                #else
000114 4114 2175F6          10      LD  HL,STKTOP+1 ;起動時の空き容量表示の為
000117 4117 35              11      DEC (HL)
                                #endif
                                
000118 4118 AF               4      XOR A
000119 4119 32DDF2          13      LD  (_DVSW),A
00011C 411C 3D               4      DEC A       ;0FFH
00011D 411D 3299FD          13      LD  (DEVICE),A
                                
000120 4120 21E042          10      LD  HL,AT_ISC
000123 4123 1180F2          10      LD  DE,ISC
000126 4126 017B00          10      LD  BC,ISC_E-ISC
000129 4129 EDB0                    LDIR
                                    
00012B 412B 3EC3             7      LD  A,0C3H      ;JP
00012D 412D 3243FF          13      LD  (H_GONE),A
000130 4130 327DF3          13      LD  (BDOS),A
000133 4133 326BF3          13      LD  (RAMUSE),A
000136 4136 3268F3          13      LD  (ROMUSE),A
000139 4139 2180F2          10      LD  HL,REPLACE_COMMAND
00013C 413C 2244FF          16      LD  (H_GONE+1),HL
00013F 413F 2131F3          10      LD  HL,H_BDOS
000142 4142 227EF3          16      LD  (BDOS+1),HL
000145 4145 21B0F2          10      LD  HL,RAMUSE1
000148 4148 226CF3          16      LD  (RAMUSE+1),HL
00014B 414B 21ABF2          10      LD  HL,ROMUSE1
00014E 414E 2269F3          16      LD  (ROMUSE+1),HL
                                
000151 4151 3E                      DB  03EH
000152 4152 F7              12      RST 30H
000153 4153 3271FE          13      LD  (H_BINS),A
000156 4156 3276FE          13      LD  (H_BINL),A
000159 4159 327BFE          13      LD  (H_FILE),A
00015C 415C 3231F3          13      LD  (H_BDOS),A
00015F 415F 32DBFD          13      LD  (H_PINL),A
000162 4162 32A7FF          13      LD  (H_PHYD),A
                                
000165 4165 CD2C42          17      CALL    GTSL1_
000168 4168 3297F2          13      LD  (ROM_SLT),A
00016B 416B 32A7F2          13      LD  (ROM_SLT_COPY),A
00016E 416E 3272FE          13      LD  (H_BINS+1),A
000171 4171 3277FE          13      LD  (H_BINL+1),A
000174 4174 327CFE          13      LD  (H_FILE+1),A
000177 4177 3232F3          13      LD  (H_BDOS+1),A
00017A 417A 32DCFD          13      LD  (H_PINL+1),A
00017D 417D 32A8FF          13      LD  (H_PHYD+1),A
000180 4180 3222FB          13      LD  (DRVTBL+1),A
000183 4183 3248F3          13      LD  (MASTERS),A
                                
000186 4186 210745          10      LD  HL,ROM_LOAD
000189 4189 2273FE          16      LD  (H_BINS+2),HL
00018C 418C 217546          10      LD  HL,ROM_RUN
00018F 418F 2278FE          16      LD  (H_BINL+2),HL
000192 4192 218346          10      LD  HL,ROM_FILES
000195 4195 227DFE          16      LD  (H_FILE+2),HL
000198 4198 21A151          10      LD  HL,ROM_BDOS
00019B 419B 2233F3          16      LD  (H_BDOS+2),HL
00019E 419E 219643          10      LD  HL,ROM_BOOT
0001A1 41A1 22DDFD          16      LD  (H_PINL+2),HL
0001A4 41A4 21794F          10      LD  HL,DISKIO
0001A7 41A7 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001AA 41AA 3E                      DB  03EH
0001AB 41AB C9              10      RET
0001AC 41AC 327FFE          13      LD  (H_FILE+4),A
0001AF 41AF 3275FE          13      LD  (H_BINS+4),A
0001B2 41B2 327AFE          13      LD  (H_BINL+4),A
0001B5 41B5 3235F3          13      LD  (H_BDOS+4),A
0001B8 41B8 32DFFD          13      LD  (H_PINL+4),A
0001BB 41BB 32ABFF          13      LD  (H_PHYD+4),A
                                
0001BE 41BE AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001BF 41BF 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001C2 41C2 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001C5 41C5 3A0060          13      LD  A,(BANK1_ADR)
0001C8 41C8 FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001CA 41CA 204F            12      JR  NZ,NOT_BANK_TYPE
0001CC 41CC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001CF 41CF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D2 41D2 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D5 41D5 07               4      RLCA
0001D6 41D6 07               4      RLCA
0001D7 41D7 F5              11      PUSH    AF
0001D8 41D8 1605             7      LD  D,4+1
0001DA 41DA CD3342          17      CALL    GTSL2_
0001DD 41DD 3244F3          13      LD  (RAMAD3),A
0001E0 41E0 F1              10      POP AF
0001E1 41E1 07               4      RLCA
0001E2 41E2 07               4      RLCA
0001E3 41E3 1603             7      LD  D,2+1
0001E5 41E5 CD3342          17      CALL    GTSL2_
0001E8 41E8 2680             7      LD  H,080H
0001EA 41EA CD5042          17      CALL    CHK_RAM
0001ED 41ED 3243F3          13      LD  (RAMAD2),A
       41F0                     RAMCHK2:
0001F0 41F0 3A44F3          13      LD  A,(RAMAD3)
0001F3 41F3 2640             7      LD  H,040H
0001F5 41F5 CD5042          17      CALL    CHK_RAM
0001F8 41F8 3242F3          13      LD  (RAMAD1),A
       41FB                     RAMCHK1:
0001FB 41FB 3A44F3          13      LD  A,(RAMAD3)
0001FE 41FE 2600             7      LD  H,00H
000200 4200 CD5042          17      CALL    CHK_RAM
000203 4203 3241F3          13      LD  (RAMAD0),A
       4206                     RAMCHK0:
000206 4206 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000209 4209 010F00          10      LD  BC,0000FH       ;切り上げ
00020C 420C 09              11      ADD HL,BC
00020D 420D 7D               4      LD  A,L
                                
00020E 420E 0604             7      LD  B,4
       4210                     B_DRIVE1:
000210 4210 CB3C             8      SRL H
000212 4212 1F               4      RRA
000213 4213 10FB            13      DJNZ    B_DRIVE1
                                
000215 4215 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000217 4217 32DCF2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
00021A 421A C9              10      RET
                                
       421B                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
00021B 421B 21D443          10      LD  HL,MSG_ERROR_ROM_MODE
00021E 421E CD5E43          17      CALL    MSX
000221 4221 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000225 4225 DD219F00        14      LD  IX,CHGET
000229 4229 C31C00          10      JP  _CALSLT
                                
       422C                     GTSL1_:             ;自分のいるスロットを知る
00022C 422C CD3801          17      CALL    RSLREG      ;read primary slot #
00022F 422F 0F               4      RRCA
000230 4230 0F               4      RRCA
000231 4231 1601             7      LD  D,1
       4233                     GTSL2_:
000233 4233 E603             7      AND 3       ;[A]=000000PP
000235 4235 5F               4      LD  E,A     ;[E]=000000PP
000236 4236 21C1FC          10      LD  HL,EXPTBL
000239 4239 85               4      ADD A,L     ;桁上りは無い
00023A 423A 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00023B 423B 7B               4      LD  A,E     ;[A]=000000PP
00023C 423C CB7E            13      BIT 7,(HL)
00023E 423E C8              11      RET Z
00023F 423F 7D               4      LD  A,L     ;point to SLTTBL entry
000240 4240 C604             7      ADD A,4     ;桁上りは無い
000242 4242 6F               4      LD  L,A
000243 4243 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4244                     GTSL3_:
000244 4244 15               4      DEC D
000245 4245 2803            12      JR  Z,GTSL4_:
000247 4247 0F               4      RRCA
000248 4248 18FA            12      JR  GTSL3_:
       424A                     GTSL4_:
00024A 424A E60C             7      AND 00CH        ;[A] = 0000SS00
00024C 424C B3               4      OR  E       ;[A] = 0000SSPP
00024D 424D F680             7      OR  080H        ;[A] = 1000SSPP
00024F 424F C9              10      RET
                                
       4250                     CHK_RAM:
000250 4250 E5              11      PUSH    HL
000251 4251 CDA542          17      CALL    CHK_RAM0
000254 4254 E1              10      POP HL
000255 4255 C8              11      RET Z
000256 4256 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000259 4259 E680             7      AND 080H
00025B 425B CD7C42          17      CALL    CHK_RAM_SLT
00025E 425E C8              11      RET Z
00025F 425F 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000262 4262 E680             7      AND 080H
000264 4264 C601             7      ADD A,1
000266 4266 CD7C42          17      CALL    CHK_RAM_SLT
000269 4269 C8              11      RET Z
00026A 426A 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00026D 426D E680             7      AND 080H
00026F 426F C602             7      ADD A,2
000271 4271 CD7C42          17      CALL    CHK_RAM_SLT
000274 4274 C8              11      RET Z
000275 4275 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000278 4278 E680             7      AND 080H
00027A 427A C603             7      ADD A,3
       427C                     CHK_RAM_SLT:
00027C 427C E5              11      PUSH    HL
00027D 427D CDA542          17      CALL    CHK_RAM0        ;スロット#X or X-0
000280 4280 E1              10      POP HL
000281 4281 C8              11      RET Z
000282 4282 CB79             8      BIT 7,C
000284 4284 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
000286 4286 79               4      LD  A,C
000287 4287 C604             7      ADD A,4*1           ;スロット#X-1
000289 4289 E5              11      PUSH    HL
00028A 428A CDA542          17      CALL    CHK_RAM0
00028D 428D E1              10      POP HL
00028E 428E C8              11      RET Z
00028F 428F 79               4      LD  A,C
000290 4290 C608             7      ADD A,4*2           ;スロット#X-2
000292 4292 E5              11      PUSH    HL
000293 4293 CDA542          17      CALL    CHK_RAM0
000296 4296 E1              10      POP HL
000297 4297 C8              11      RET Z
000298 4298 79               4      LD  A,C
000299 4299 C60C             7      ADD A,4*3           ;スロット#X-3
00029B 429B E5              11      PUSH    HL
00029C 429C CDA542          17      CALL    CHK_RAM0
00029F 429F E1              10      POP HL
       42A0                     CHK_RAM_E:
0002A0 42A0 AF               4      XOR A
0002A1 42A1 3C               4      INC A           ;ZF=0にする
0002A2 42A2 3E00             7      LD  A,0
0002A4 42A4 C9              10      RET
                                
       42A5                     CHK_RAM0:
0002A5 42A5 4F               4      LD  C,A
0002A6 42A6 3A97F2          13      LD  A,(ROM_SLT)
0002A9 42A9 B9               4      CP  C
0002AA 42AA 28F4            12      JR  Z,CHK_RAM_E
0002AC 42AC 2E00             7      LD  L,0
       42AE                     CHK_RAM1:
0002AE 42AE 79               4      LD  A,C
0002AF 42AF CD8E43          17      CALL    RDSLTX
0002B2 42B2 C6E5             7      ADD A,0E5H
0002B4 42B4 47               4      LD  B,A
0002B5 42B5 5F               4      LD  E,A
0002B6 42B6 79               4      LD  A,C
0002B7 42B7 C5              11      PUSH    BC
0002B8 42B8 CD1400          17      CALL    _WRSLT
0002BB 42BB C1              10      POP BC
0002BC 42BC 79               4      LD  A,C
0002BD 42BD CD8E43          17      CALL    RDSLTX
0002C0 42C0 B8               4      CP  B
0002C1 42C1 C0              11      RET NZ
0002C2 42C2 D6E5             7      SUB 0E5H
0002C4 42C4 79               4      LD  A,C
0002C5 42C5 5F               4      LD  E,A
0002C6 42C6 C5              11      PUSH    BC
0002C7 42C7 CD1400          17      CALL    _WRSLT
0002CA 42CA C1              10      POP BC
0002CB 42CB 24               4      INC H
0002CC 42CC 7D               4      LD  A,L
0002CD 42CD C604             7      ADD A,4
0002CF 42CF 6F               4      LD  L,A
0002D0 42D0 20DC            12      JR  NZ,CHK_RAM1
0002D2 42D2 79               4      LD  A,C     ;ZF=1のハズ
0002D3 42D3 C9              10      RET
                                
       42D4                     CALSLT_R:
0002D4 42D4 C5              11      PUSH    BC
0002D5 42D5 E5              11      PUSH    HL
0002D6 42D6 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DA 42DA CD1C00          17      CALL    _CALSLT
0002DD 42DD E1              10      POP HL
0002DE 42DE C1              10      POP BC
0002DF 42DF C9              10      RET
                                
       42E0                     AT_ISC:
0002E0 F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
0002E0 F280 FEB7             7      CP  0B7H            ;FILES
0002E2 F282 CC7BFE          17      CALL    Z,H_FILE
0002E5 F285 FEB5             7      CP  0B5H            ;LOAD
0002E7 F287 CA71FE          10      JP  Z,H_BINS
0002EA F28A FE8A             7      CP  08AH            ;RUN
0002EC F28C CA76FE          10      JP  Z,H_BINL
0002EF F28F FED6             7      CP  0D6H            ;COPY
0002F1 F291 2813            12      JR  Z,FIX_COPY
0002F3 F293 FECF             7      CP  0CFH            ;BLOAD
0002F5 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
0002F6 F296 F7              12      RST 30H
       F297                     ROM_SLT:
0002F7 F297 00                      DB  0
0002F8 F298 A745                    DW  ROM_BLOAD
0002FA F29A F5              11      PUSH    AF
0002FB F29B E5              11      PUSH    HL
0002FC F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
0002FF F29F E1              10      POP HL
000300 F2A0 F1              10      POP AF
000301 F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000303 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000305 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000306 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000307 F2A7 00                      DB  0
000308 F2A8 0E47                    DW  ROM_COPY
00030A F2AA C9              10      RET
       F2AB                     ROMUSE1:
00030B F2AB 3A97F2          13      LD  A,(ROM_SLT)
00030E F2AE 1803            12      JR  ROMUSE2
       F2B0                     RAMUSE1:
000310 F2B0 3A42F3          13      LD  A,(RAMAD1)
       F2B3                     ROMUSE2:
000313 F2B3 C32400          10      JP  _ENASLT
                                
       F2B6                     _RESULT:
000316 F2B6 00                      DB  0
       F2B7                     _BANK:
000317 F2B7 00                      DB  0
       F2B8                     _BANK1:
000318 F2B8 00                      DB  0
       F2B9                     CLSZ:               ;クラスタサイズ
000319 F2B9 0004                    DW  1024
       F2BA                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2BB                     SECSZ:              ;セクタサイズ
00031B F2BB 0002                    DW  512
       F2BC                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2BD                     RR_LOW:
00031D F2BD 0000                    DW  0
       F2BE                     RR_MID  EQU $-1
       F2BF                     RR_HIGH:
00031F F2BF 0000                    DW  0
       F2C1                     _CLPS:
000321 F2C1 0000                    DW  0
       F2C3                     _LEFT:
000323 F2C3 0000                    DW  0
       F2C5                     _DTPS:
000325 F2C5 0000                    DW  0
       F2C7                     _DTA:
000327 F2C7 0000                    DW  0
       F2C9                     FLG_LDIR:
000329 F2C9 00                      DB  0
       F2CA                     _FCB:
00032A F2CA 0000                    DW  0
       F2CC                     _BUF:
       F2CC                     _BUF_LO:        ;LOGICAL OPERATION
00032C F2CC 00                      DB  0
       F2CD                     _BUF_ST:
00032D F2CD 0000                    DW  0
       F2CF                     _BUF_EN:
00032F F2CF 0000                    DW  0
       F2D1                     _BUF_EX:
       F2D1                     _BUF_W:
000331 F2D1 0000                    DW  0
       F2D3                     _BUF_H:
000333 F2D3 0000                    DW  0
       F2D5                     _BUF_X:
000335 F2D5 0000                    DW  0
       F2D7                     _BUF_Y:
000337 F2D7 00                      DB  0
       F2D8                     _BUF_P:
000338 F2D8 00                      DB  0
       F2D9                     _BUF_O:
000339 F2D9 00                      DB  0
       F2DA                     DTAX:
00033A F2DA 0000                    DW  0
       F2DC                     B_DRIVE:
00033C F2DC 00                      DB  0
       F2DD                     _DVSW:          ;カレントドライブ
00033D F2DD 00                      DB  0
       F2DE                     _CD:            ;カレントディレクトリ
00033E F2DE 0000                    DW  0
       F2E0                     DIRENT1:
000340 F2E0 0000                    DW  0
       F2E2                     _DIR_BANK:
000342 F2E2 00                      DB  0
       F2E3                     LEFTX:
000343 F2E3 0000                    DW  0
       F2E5                     PARAM0:
000345 F2E5 0000                    DW  0
       F2E7                     PARAM1:
000347 F2E7 0000                    DW  0
       F2E9                     _CDX:
000349 F2E9 0000                    DW  0
       F2EB                     FDRV:
00034B F2EB 00                      DB  0
       F2EC                     FNAME:
00034C F2EC                         DS  8+3
       F2F7                     _HL:
000357 F2F7 0000                    DW  0
       F2F9                     _SP:
000359 F2F9 0000                    DW  0
       F2FA                     _SP_H   EQU $-1
       F2FB                     ISC_E:
00035B 435B                         ORG $$+RUN          ;$DEPHASE
                                
       435B                     MSX1:
00035B 435B CDBA51          17      CALL    MSGA1
       435E                     MSX:
00035E 435E 7E               7      LD  A,(HL)
00035F 435F 23               6      INC HL
000360 4360 B7               4      OR  A
000361 4361 20F8            12      JR  NZ,MSX1
000363 4363 C9              10      RET
                                
       4364                     PRTHX:
000364 4364 F5              11      PUSH    AF
000365 4365 07               4      RLCA
000366 4366 07               4      RLCA
000367 4367 07               4      RLCA
000368 4368 07               4      RLCA
000369 4369 CD6D43          17      CALL    PRTA2
00036C 436C F1              10      POP AF
       436D                     PRTA2:
00036D 436D CD7343          17      CALL    ASC
000370 4370 C3B651          10      JP  MSG_A
                                    
       4373                     ASC:
000373 4373 E60F             7      AND $0F
000375 4375 F630             7      OR  $30
000377 4377 FE3A             7      CP  $3A
000379 4379 D8              11      RET C
00037A 437A C607             7      ADD A,7
00037C 437C C9              10      RET
                                
       437D                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
00037D 437D 7E               7      LD  A,(HL)
                                #endif
00037E 437E 23               6      INC HL
00037F 437F CDB651          17      CALL    MSG_A
000382 4382 10F9            13      DJNZ    MSN
000384 4384 C9              10      RET
                                
       4385                     RDSLT_ROM3:
000385 4385 7E               7      LD  A,(HL)
000386 4386 C9              10      RET
       4387                     RDSLT_ROM:
000387 4387 CB7C             8      BIT 7,H
000389 4389 28FA            12      JR  Z,RDSLT_ROM3
       438B                     RDSLT_ROM2:
00038B 438B 3A97F2          13      LD  A,(ROM_SLT)
       438E                     RDSLTX:
00038E 438E C5              11      PUSH    BC
00038F 438F D5              11      PUSH    DE
000390 4390 CD0C00          17      CALL    _RDSLT
000393 4393 D1              10      POP DE
000394 4394 C1              10      POP BC
000395 4395 C9              10      RET
                                
       4396                     ROM_BOOT:
000396 4396 3E                      DB  03EH
000397 4397 C9              10      RET
000398 4398 32DBFD          13      LD  (H_PINL),A
00039B 439B 3ACAFF          13      LD  A,(EXTBIO)
00039E 439E FEF7             7      CP  0F7H        ;RST 30H
0003A0 43A0 2805            12      JR  Z,EXTBIO_OK
0003A2 43A2 3E                      DB  03EH
0003A3 43A3 C9              10      RET
0003A4 43A4 32CAFF          13      LD  (EXTBIO),A
       43A7                     EXTBIO_OK:
0003A7 43A7 21FA43          10      LD  HL,DELOK
0003AA 43AA CD5E43          17      CALL    MSX
                                
0003AD 43AD AF               4      XOR A
0003AE 43AE 3240F3          13      LD  (REBOOT),A
0003B1 43B1 2A48FC          16      LD  HL,(BOTTOM)
0003B4 43B4 110040          10      LD  DE,16384
0003B7 43B7 19              11      ADD HL,DE
0003B8 43B8 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003BA 43BA 57               4      LD  D,A
0003BB 43BB 0601             7      LD  B,1
0003BD 43BD 2100C0          10      LD  HL,0C000H
0003C0 43C0 CD794F          17      CALL    DISKIO
                                
0003C3 43C3 116BF3          10      LD  DE,RAMUSE
0003C6 43C6 AF               4      XOR A
0003C7 43C7 CD1EC0          17      CALL    0C01EH
0003CA 43CA 116BF3          10      LD  DE,RAMUSE
0003CD 43CD 37               4      SCF
0003CE 43CE CD1EC0          17      CALL    0C01EH
       43D1                     BOOT1:
0003D1 43D1 C30451          10      JP  BASENT
                                
       43D4                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003D4 43D4 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       43F9                     NULL:
0003F9 43F9 00                      DB  0
       43FA                     DELOK:
0003FA 43FA 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       43FE                     ROM_LDIR:
0003FE 43FE 3AC9F2          13      LD  A,(FLG_LDIR)
000401 4401 B7               4      OR  A
000402 4402 2008            12      JR  NZ,ROM_LDIRVM
000404 4404 CB7A             8      BIT 7,D
000406 4406 CA1E44          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ1
                                    LD  SP,SP32
                                SPJ1:
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
000409 4409 EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                #endif
00040B 440B C9              10      RET
                                
       440C                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ2
                                    LD  SP,SP32
                                SPJ2:
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
00040C 440C C5              11      PUSH    BC
00040D 440D D5              11      PUSH    DE
00040E 440E FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000412 4412 DD215C00        14      LD  IX,LDIRVM
000416 4416 CD1C00          17      CALL    _CALSLT
000419 4419 E1              10      POP HL
00041A 441A C1              10      POP BC
00041B 441B 09              11      ADD HL,BC
00041C 441C EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JR  LDIRE2
                                #else
00041D 441D C9              10      RET
                                #endif
                                
       441E                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DI
                                    LD  (_SP),SP
                                    LD  A,(_SP_H)
                                    CP  0C0H
                                    JR  NC,SPJ3
                                    LD  SP,SP32
                                SPJ3:
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       441E                     ROM_LDIRSLT1:
00041E 441E EB               4      EX  DE,HL
       441F                     RLDIRSLT1:
00041F 441F CB7C             8      BIT 7,H
000421 4421 201F            12      JR  NZ,RLDIRSLT_EXIT
000423 4423 1A               7      LD  A,(DE)
000424 4424 13               6      INC DE
000425 4425 C5              11      PUSH    BC
000426 4426 D5              11      PUSH    DE
000427 4427 E5              11      PUSH    HL
000428 4428 5F               4      LD  E,A
                                
000429 4429 0141F3          10      LD  BC,RAMAD0
00042C 442C 7C               4      LD  A,H
00042D 442D 07               4      RLCA
00042E 442E 07               4      RLCA
00042F 442F E603             7      AND 3
000431 4431 81               4      ADD A,C
000432 4432 4F               4      LD  C,A
000433 4433 0A               7      LD  A,(BC)
       4434                     RLDIRSLT2:
000434 4434 CD1400          17      CALL    _WRSLT
000437 4437 08               4      EX  AF,AF'
000438 4438 E1              10      POP HL
000439 4439 D1              10      POP DE
00043A 443A C1              10      POP BC
00043B 443B EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
00043D 443D EA1F44          10      JP  PE,RLDIRSLT1
000440 4440 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    JP  LDIRE2
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    JP  LDIR1
                                #else
000441 4441 C9              10      RET
       4442                     RLDIRSLT_EXIT:
000442 4442 EB               4      EX  DE,HL
000443 4443 EDB0                    LDIR
000445 4445 C9              10      RET
                                #endif
                                
       4446                     END_OF_LINE:
000446 4446 215EF5          10      LD  HL,BUF
       4449                     EOL1:
000449 4449 7E               7      LD  A,(HL)
00044A 444A C8              11      RET Z
00044B 444B FE0D             7      CP  00DH
00044D 444D 2807            12      JR  Z,EOLE
00044F 444F FE0A             7      CP  00AH
000451 4451 2803            12      JR  Z,EOLE
000453 4453 23               6      INC HL
000454 4454 18F3            12      JR  EOL1
       4456                     EOLE:
000456 4456 3600            10      LD  (HL),0
000458 4458 23               6      INC HL
000459 4459 7E               7      LD  A,(HL)
00045A 445A FE0A             7      CP  00AH
00045C 445C C0              11      RET NZ
00045D 445D 23               6      INC HL
00045E 445E C9              10      RET
                                
       445F                     ROM_LOAD_ASCII:
00045F 445F 210000          10      LD  HL,0
000462 4462 22CDF2          16      LD  (_BUF_ST),HL    ;読み出し位置
000465 4465 2A76F6          16      LD  HL,(TXTTAB)
000468 4468 22CFF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00046B 446B 215EF5          10      LD  HL,BUF
00046E 446E 22C7F2          16      LD  (_DTA),HL
       4471                     RLOAD_A1:
000471 4471 2ACDF2          16      LD  HL,(_BUF_ST)
000474 4474 22BDF2          16      LD  (RR_LOW),HL
000477 4477 210201          10      LD  HL,258
00047A 447A CD2E49          17      CALL    ROM_READ
00047D 447D 7C               4      LD  A,H
00047E 447E B5               4      OR  L
00047F 447F 2879            12      JR  Z,RLOAD_AEND
000481 4481 015EF5          10      LD  BC,BUF
000484 4484 09              11      ADD HL,BC
000485 4485 3600            10      LD  (HL),0
000487 4487 CD4644          17      CALL    END_OF_LINE
00048A 448A 015EF5          10      LD  BC,BUF
00048D 448D A7               4      AND A
00048E 448E ED42            15      SBC HL,BC
000490 4490 2810            12      JR  Z,RLOAD_A2
000492 4492 4D               4      LD  C,L
000493 4493 44               4      LD  B,H
000494 4494 ED5BCDF2        20      LD  DE,(_BUF_ST)
000498 4498 19              11      ADD HL,DE
000499 4499 22CDF2          16      LD  (_BUF_ST),HL
00049C 449C 3A5EF5          13      LD  A,(BUF)
00049F 449F B7               4      OR  A
0004A0 44A0 28CF            12      JR  Z,RLOAD_A1
       44A2                     RLOAD_A2:
0004A2 44A2 115EF5          10      LD  DE,BUF
0004A5 44A5 CDE54A          17      CALL    SPCUTEX
0004A8 44A8 1A               7      LD  A,(DE)
0004A9 44A9 B7               4      OR  A
0004AA 44AA 284E            12      JR  Z,RLOAD_AEND
0004AC 44AC CDF74A          17      CALL    GETNUM
0004AF 44AF 7C               4      LD  A,H
0004B0 44B0 B5               4      OR  L
0004B1 44B1 CA8E45          10      JP  Z,ERROR_DIRECT_IN_FILE
0004B4 44B4 DD2ACFF2        20      LD  IX,(_BUF_EN)
0004B8 44B8 DD7502          19      LD  (IX+2),L
0004BB 44BB DD7403          19      LD  (IX+3),H
                                
0004BE 44BE CDDE4A          17      CALL    SPCUT
0004C1 44C1 EB               4      EX  DE,HL
0004C2 44C2 DDE5            15      PUSH    IX
0004C4 44C4 DD21B242        14      LD  IX,CRUNCH
0004C8 44C8 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004CC 44CC CD1C00          17      CALL    _CALSLT
0004CF 44CF DDE1            14      POP IX
0004D1 44D1 EB               4      EX  DE,HL
0004D2 44D2 111FF4          10      LD  DE,KBUF
0004D5 44D5 37               4      SCF
0004D6 44D6 ED52            15      SBC HL,DE
0004D8 44D8 CA8E45          10      JP  Z,ERROR_DIRECT_IN_FILE
0004DB 44DB DA8E45          10      JP  C,ERROR_DIRECT_IN_FILE
0004DE 44DE 4D               4      LD  C,L
0004DF 44DF 44               4      LD  B,H
0004E0 44E0 2ACFF2          16      LD  HL,(_BUF_EN)
0004E3 44E3 110400          10      LD  DE,4
0004E6 44E6 19              11      ADD HL,DE
0004E7 44E7 111FF4          10      LD  DE,KBUF
                                
0004EA 44EA EB               4      EX  DE,HL
0004EB 44EB EDB0                    LDIR
0004ED 44ED EB               4      EX  DE,HL
                                
0004EE 44EE DD7500          19      LD  (IX+0),L
0004F1 44F1 DD7401          19      LD  (IX+1),H
0004F4 44F4 22CFF2          16      LD  (_BUF_EN),HL
0004F7 44F7 C37144          10      JP  RLOAD_A1
                                
       44FA                     RLOAD_AEND:
0004FA 44FA 2ACFF2          16      LD  HL,(_BUF_EN)
0004FD 44FD AF               4      XOR A
0004FE 44FE 77               7      LD  (HL),A
0004FF 44FF 23               6      INC HL
000500 4500 77               7      LD  (HL),A
000501 4501 23               6      INC HL
000502 4502 22CFF2          16      LD  (_BUF_EN),HL
000505 4505 1847            12      JR  RLOAD_END1
                                
       4507                     ROM_LOAD:
000507 4507 CDDC46          17      CALL    INIT_PARAM
00050A 450A 7E               7      LD  A,(HL)
00050B 450B FE2C             7      CP  ','
00050D 450D 2003            12      JR  NZ,ROM_LOAD0
00050F 450F 23               6      INC HL
000510 4510 7E               7      LD  A,(HL)
000511 4511 2B               6      DEC HL
       4512                     ROM_LOAD0:
000512 4512 32BEFC          13      LD  (RUNBNF),A
000515 4515 CDCF49          17      CALL    FILE_B
000518 4518 3AECF2          13      LD  A,(FNAME)
00051B 451B FE20             7      CP  020H
00051D 451D CACA49          10      JP  Z,ROM_ORG
                                
000520 4520 CD4E4B          17      CALL    ROM_OPEN
000523 4523 DA9A45          10      JP  C,ERROR_FILE_NOT_FOUND
       4526                     ROM_LOAD1:
000526 4526 21CCF2          10      LD  HL,_BUF
000529 4529 22C7F2          16      LD  (_DTA),HL
00052C 452C 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
00052F 452F CD2E49          17      CALL    ROM_READ
000532 4532 3ACCF2          13      LD  A,(_BUF)
000535 4535 3C               4      INC A
000536 4536 C25F44          10      JP  NZ,ROM_LOAD_ASCII
000539 4539 2A76F6          16      LD  HL,(TXTTAB)
00053C 453C 22C7F2          16      LD  (_DTA),HL
00053F 453F EB               4      EX  DE,HL
000540 4540 2100FF          10      LD  HL,-256
000543 4543 39              11      ADD HL,SP
000544 4544 ED52            15      SBC HL,DE
000546 4546 CD2E49          17      CALL    ROM_READ
000549 4549 ED5BC7F2        20      LD  DE,(_DTA)
00054D 454D 19              11      ADD HL,DE
       454E                     RLOAD_END1:
00054E 454E 22C2F6          16      LD  (VARTAB),HL
000551 4551 22C4F6          16      LD  (ARYTAB),HL
000554 4554 22C6F6          16      LD  (STREND),HL
                                
000557 4557 3ABEFC          13      LD  A,(RUNBNF)
00055A 455A CD384B          17      CALL    CAP
00055D 455D FE52             7      CP  'R'
00055F 455F 280E            12      JR  Z,RLOAD_END2
000561 4561 AF               4      XOR A
000562 4562 21CFF2          10      LD  HL,_BUF+3
000565 4565 77               7      LD  (HL),A      ;3
000566 4566 2B               6      DEC HL
000567 4567 77               7      LD  (HL),A      ;2
000568 4568 2B               6      DEC HL
000569 4569 77               7      LD  (HL),A      ;1
00056A 456A 2B               6      DEC HL
00056B 456B 3E8F             7      LD  A,08FH      ;REM
00056D 456D 77               7      LD  (HL),A      ;0
00056E 456E C9              10      RET
       456F                     RLOAD_END2:
00056F 456F D5              11      PUSH    DE
000570 4570 2A76F6          16      LD  HL,(TXTTAB)
000573 4573 23               6      INC HL
000574 4574 23               6      INC HL
000575 4575 5E               7      LD  E,(HL)
000576 4576 23               6      INC HL
000577 4577 56               7      LD  D,(HL)
000578 4578 AF               4      XOR A
000579 4579 21D2F2          10      LD  HL,_BUF+6
00057C 457C 77               7      LD  (HL),A      ;6
00057D 457D 2B               6      DEC HL
00057E 457E 77               7      LD  (HL),A      ;5
00057F 457F 2B               6      DEC HL
000580 4580 77               7      LD  (HL),A      ;4
000581 4581 2B               6      DEC HL
000582 4582 72               7      LD  (HL),D      ;3 行番号H
000583 4583 2B               6      DEC HL
000584 4584 73               7      LD  (HL),E      ;2 行番号L
000585 4585 2B               6      DEC HL
000586 4586 360E            10      LD  (HL),00EH   ;1 2桁INT
000588 4588 2B               6      DEC HL
000589 4589 3E89             7      LD  A,089H      ;GOTO
00058B 458B 77               7      LD  (HL),A      ;0
00058C 458C D1              10      POP DE
00058D 458D C9              10      RET
                                
       458E                     ERROR_DIRECT_IN_FILE:
00058E 458E 1E39             7      LD  E,57            ;Direct statement in file
000590 4590 01                      DB  1           ;LD BC,
       4591                     ERROR_DEVICE_IO_ERROR:
000591 4591 1E13             7      LD  E,19            ;Device I/O error
000593 4593 01                      DB  1           ;LD BC,
       4594                     ERROR_INTERNAL_ERROR:
000594 4594 1E33             7      LD  E,51            ;Internal error
000596 4596 01                      DB  1           ;LD BC,
       4597                     ERROR_FILE_NOT_OPEN:
000597 4597 1E3B             7      LD  E,59            ;File not OPEN
000599 4599 01                      DB  1           ;LD BC,
       459A                     ERROR_FILE_NOT_FOUND:
00059A 459A 1E35             7      LD  E,53            ;File not found
       459C                     ERROR:
00059C 459C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005A0 45A0 DD216F40        14      LD  IX,ERRHAND
0005A4 45A4 C31C00          10      JP  _CALSLT
                                
       45A7                     ROM_BLOAD:
0005A7 45A7 CDDC46          17      CALL    INIT_PARAM
0005AA 45AA CDCF49          17      CALL    FILE_B
0005AD 45AD CD4E4B          17      CALL    ROM_OPEN
0005B0 45B0 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005B2 45B2 21CCF2          10      LD  HL,_BUF
0005B5 45B5 22C7F2          16      LD  (_DTA),HL
0005B8 45B8 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005BB 45BB CD2E49          17      CALL    ROM_READ
0005BE 45BE 3ACCF2          13      LD  A,(_BUF)
0005C1 45C1 FEFE             7      CP  0FEH
0005C3 45C3 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0005C5 45C5 21A5F2          10      LD  HL,BLOAD_RET
0005C8 45C8 229DF2          16      LD  (SWC_BLOAD),HL
                                
0005CB 45CB 2AE7F2          16      LD  HL,(PARAM1)
0005CE 45CE 7E               7      LD  A,(HL)
0005CF 45CF FE2C             7      CP  ','
0005D1 45D1 2048            12      JR  NZ,RBREAD_MEM
0005D3 45D3 23               6      INC HL
0005D4 45D4 7E               7      LD  A,(HL)
0005D5 45D5 CD384B          17      CALL    CAP
0005D8 45D8 32BEFC          13      LD  (RUNBNF),A
       45DB                     RBOS1:
0005DB 45DB 7E               7      LD  A,(HL)
0005DC 45DC 23               6      INC HL
0005DD 45DD B7               4      OR  A
0005DE 45DE 282F            12      JR  Z,RBREAD_OSE
0005E0 45E0 FE3A             7      CP  ':'
0005E2 45E2 282B            12      JR  Z,RBREAD_OSE
0005E4 45E4 FE2C             7      CP  ','     ;次のパラメータを探す
0005E6 45E6 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005E8 45E8 22E7F2          16      LD  (PARAM1),HL
0005EB 45EB 7E               7      LD  A,(HL)
0005EC 45EC B7               4      OR  A
0005ED 45ED 2820            12      JR  Z,RBREAD_OSE
0005EF 45EF DD21644C        14      LD  IX,FRMEVL
0005F3 45F3 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005F7 45F7 CD1C00          17      CALL    _CALSLT
0005FA 45FA 22E7F2          16      LD  (PARAM1),HL
0005FD 45FD 3A63F6          13      LD  A,(VALTYP)
000600 4600 FE02             7      CP  2
000602 4602 200B            12      JR  NZ,RBREAD_OSE
000604 4604 2ACDF2          16      LD  HL,(_BUF_ST)
000607 4607 ED5BF8F7        20      LD  DE,(DACDAT)
00060B 460B 19              11      ADD HL,DE
00060C 460C 22CDF2          16      LD  (_BUF_ST),HL
       460F                     RBREAD_OSE:
00060F 460F 3ABEFC          13      LD  A,(RUNBNF)
000612 4612 FE53             7      CP  'S'
000614 4614 2005            12      JR  NZ,RBREAD_MEM
000616 4616 3E01             7      LD  A,1
000618 4618 32C9F2          13      LD  (FLG_LDIR),A
       461B                     RBREAD_MEM:
00061B 461B 2ACDF2          16      LD  HL,(_BUF_ST)
00061E 461E 22BFFC          16      LD  (SAVENT),HL
000621 4621 22C7F2          16      LD  (_DTA),HL
000624 4624 21FFFF          10      LD  HL,0FFFFH
000627 4627 CD2E49          17      CALL    ROM_READ
00062A 462A AF               4      XOR A
00062B 462B 32C9F2          13      LD  (FLG_LDIR),A
00062E 462E 3ABEFC          13      LD  A,(RUNBNF)
000631 4631 FE52             7      CP  'R'
000633 4633 2006            12      JR  NZ,RBREAD1
000635 4635 2AD1F2          16      LD  HL,(_BUF_EX)
000638 4638 229DF2          16      LD  (SWC_BLOAD),HL
       463B                     RBREAD1:
       463B                     ROM_NEXT:
00063B 463B 2AE7F2          16      LD  HL,(PARAM1)
00063E 463E 7E               7      LD  A,(HL)
00063F 463F 2B               6      DEC HL
000640 4640 B7               4      OR  A
000641 4641 2805            12      JR  Z,RN1
000643 4643 FE3A             7      CP  ':'
000645 4645 2801            12      JR  Z,RN1
000647 4647 23               6      INC HL
       4648                     RN1:
000648 4648 5D               4      LD  E,L
000649 4649 54               4      LD  D,H
                                
00064A 464A CD0E4B          17      CALL    SEARCH_END
00064D 464D B7               4      OR  A
00064E 464E 2821            12      JR  Z,REM
       4650                     RN3:                    ;マルチステートメントの処理
000650 4650 7E               7      LD  A,(HL)
                                
000651 4651 FEB5             7      CP  0B5H            ;LOAD
000653 4653 CA0745          10      JP  Z,ROM_LOAD
000656 4656 FE8A             7      CP  08AH            ;RUN
000658 4658 281B            12      JR  Z,ROM_RUN
00065A 465A FEB7             7      CP  0B7H            ;FILES
00065C 465C 2825            12      JR  Z,ROM_FILES
00065E 465E FED6             7      CP  0D6H            ;COPY
000660 4660 CA0E47          10      JP  Z,ROM_COPY
000663 4663 FE20             7      CP  020H
000665 4665 2807            12      JR  Z,RN_SP
                                
000667 4667 3E28             7      LD  A,028H          ;JR Z,
000669 4669 32A3F2          13      LD  (SWC_BLOAD_M),A
00066C 466C 7E               7      LD  A,(HL)
00066D 466D C9              10      RET
       466E                     RN_SP:
00066E 466E 23               6      INC HL
00066F 466F 18DF            12      JR  RN3
                                
       4671                     REM:
000671 4671 EB               4      EX  DE,HL
000672 4672 3E8F             7      LD  A,08FH          ;REM
000674 4674 C9              10      RET
                                
       4675                     ROM_RUN:
000675 4675 23               6      INC HL
000676 4676 7E               7      LD  A,(HL)
000677 4677 2B               6      DEC HL
000678 4678 B7               4      OR  A
000679 4679 C40745          17      CALL    NZ,ROM_LOAD
00067C 467C FE8F             7      CP  08FH            ;REM
00067E 467E 3E8A             7      LD  A,08AH          ;RUN
000680 4680 C0              11      RET NZ
000681 4681 77               7      LD  (HL),A
000682 4682 C9              10      RET
                                
       4683                     ROM_FILES:
000683 4683 CDDC46          17      CALL    INIT_PARAM
000686 4686 CDCF49          17      CALL    FILE_B
000689 4689 CD4151          17      CALL    GET_DISK_BANK_FDRV
00068C 468C 3ABCF2          13      LD  A,(SECSZ_H)
00068F 468F CDFF4F          17      CALL    IS_BPB1
000692 4692 DA9145          10      JP  C,ERROR_DEVICE_IO_ERROR
000695 4695 3AECF2          13      LD  A,(FNAME)
000698 4698 FE21             7      CP  021H
00069A 469A 3005            12      JR  NC,RFILES0
00069C 469C 060B             7      LD  B,11
00069E 469E CDA24A          17      CALL    FILE10
       46A1                     RFILES0:
0006A1 46A1 CDAC4D          17      CALL    GET_DIR_DAT
       46A4                     RFILES1:
0006A4 46A4 CD6A4B          17      CALL    FILESE
0006A7 46A7 302E            12      JR  NC,RFILES_NOT_MATCH
       46A9                     RFILES_DISP:
0006A9 46A9 E5              11      PUSH    HL
0006AA 46AA 0608             7      LD  B,8
0006AC 46AC CD7D43          17      CALL    MSN
0006AF 46AF 3E2E             7      LD  A,'.'
0006B1 46B1 CDB651          17      CALL    MSG_A
0006B4 46B4 0603             7      LD  B,3
0006B6 46B6 CD7D43          17      CALL    MSN
0006B9 46B9 3ADDF3          13      LD  A,(CSRX)
0006BC 46BC 47               4      LD  B,A
0006BD 46BD 3AB0F3          13      LD  A,(LINLEN)
0006C0 46C0 90               4      SUB B
0006C1 46C1 FE0C             7      CP  12
0006C3 46C3 3009            12      JR  NC,RFILES2
0006C5 46C5 3E0D             7      LD  A,00DH      ;改行
0006C7 46C7 CDB651          17      CALL    MSG_A
0006CA 46CA 3E0A             7      LD  A,00AH
0006CC 46CC 1802            12      JR  RFILES3
       46CE                     RFILES2:
0006CE 46CE 3E20             7      LD  A,020H
       46D0                     RFILES3:
0006D0 46D0 CDB651          17      CALL    MSG_A
0006D3 46D3 E1              10      POP HL
0006D4 46D4 CD864B          17      CALL    FNEXT
       46D7                     RFILES_NOT_MATCH:
0006D7 46D7 20CB            12      JR  NZ,RFILES1
0006D9 46D9 C33B46          10      JP  ROM_NEXT
                                
       46DC                     INIT_PARAM:
0006DC 46DC 22E5F2          16      LD  (PARAM0),HL
0006DF 46DF 22E7F2          16      LD  (PARAM1),HL
0006E2 46E2 EB               4      EX  DE,HL
0006E3 46E3 32BEFC          13      LD  (RUNBNF),A
0006E6 46E6 3263F6          13      LD  (VALTYP),A
0006E9 46E9 E5              11      PUSH    HL
0006EA 46EA 2ADEF2          16      LD  HL,(_CD)
0006ED 46ED 22E9F2          16      LD  (_CDX),HL
0006F0 46F0 E1              10      POP HL
0006F1 46F1 13               6      INC DE
0006F2 46F2 CDDE4A          17      CALL    SPCUT
0006F5 46F5 1A               7      LD  A,(DE)
0006F6 46F6 B7               4      OR  A
0006F7 46F7 C8              11      RET Z
0006F8 46F8 FE3A             7      CP  ':'
0006FA 46FA C8              11      RET Z
0006FB 46FB FE28             7      CP  '('
0006FD 46FD C8              11      RET Z
0006FE 46FE EB               4      EX  DE,HL
0006FF 46FF DD21644C        14      LD  IX,FRMEVL
000703 4703 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000707 4707 CD1C00          17      CALL    _CALSLT
00070A 470A 22E7F2          16      LD  (PARAM1),HL
00070D 470D C9              10      RET
                                
       470E                     ROM_COPY:
00070E 470E CDDC46          17      CALL    INIT_PARAM
000711 4711 3A63F6          13      LD  A,(VALTYP)
000714 4714 FE03             7      CP  3       ;string
000716 4716 C2CA49          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000719 4719 CDCF49          17      CALL    FILE_B
00071C 471C CD4E4B          17      CALL    ROM_OPEN
00071F 471F DA9A45          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000722 4722 21D1F2          10      LD  HL,_BUF_W
000725 4725 22C7F2          16      LD  (_DTA),HL
000728 4728 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
00072B 472B CD2E49          17      CALL    ROM_READ
                                
00072E 472E AF               4      XOR A
00072F 472F 32CCF2          13      LD  (_BUF_LO),A     ;PSET
000732 4732 32D9F2          13      LD  (_BUF_O),A      ;向き
                                
000735 4735 2AE7F2          16      LD  HL,(PARAM1)
       4738                     RCP_PARAM1:
000738 4738 7E               7      LD  A,(HL)
000739 4739 23               6      INC HL
00073A 473A B7               4      OR  A
00073B 473B CACA49          10      JP  Z,ROM_ORG
00073E 473E FE3A             7      CP  ':'
000740 4740 CACA49          10      JP  Z,ROM_ORG
000743 4743 FE2C             7      CP  ','
000745 4745 2012            12      JR  NZ,RCP_PARAM1_
                                
000747 4747 DD212F54        14      LD  IX,FRMQNT
00074B 474B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00074F 474F CD1C00          17      CALL    _CALSLT
000752 4752 7B               4      LD  A,E
000753 4753 87               4      ADD A,A
000754 4754 87               4      ADD A,A
000755 4755 32D9F2          13      LD  (_BUF_O),A
000758 4758 7E               7      LD  A,(HL)
       4759                     RCP_PARAM1_:
000759 4759 FE28             7      CP  '('
00075B 475B 20DB            12      JR  NZ,RCP_PARAM1
                                
00075D 475D DD212F54        14      LD  IX,FRMQNT
000761 4761 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000765 4765 CD1C00          17      CALL    _CALSLT
                                
000768 4768 ED53D5F2        20      LD  (_BUF_X),DE
                                
       476C                     RCP_PARAM2:
00076C 476C 23               6      INC HL
00076D 476D 7E               7      LD  A,(HL)
00076E 476E FE20             7      CP  020H
000770 4770 28FA            12      JR  Z,RCP_PARAM2
000772 4772 FE2C             7      CP  ','
000774 4774 28F6            12      JR  Z,RCP_PARAM2
                                
000776 4776 DD212F54        14      LD  IX,FRMQNT
00077A 477A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00077E 477E CD1C00          17      CALL    _CALSLT
                                
000781 4781 3AF6FA          13      LD  A,(ACPAGE)
000784 4784 57               4      LD  D,A
000785 4785 ED53D7F2        20      LD  (_BUF_Y),DE
       4789                     RCP_PARAM3:
000789 4789 23               6      INC HL
00078A 478A 7E               7      LD  A,(HL)
00078B 478B FE20             7      CP  020H
00078D 478D 28FA            12      JR  Z,RCP_PARAM3
00078F 478F FE29             7      CP  ')'
000791 4791 28F6            12      JR  Z,RCP_PARAM3
000793 4793 FE2C             7      CP  ','
000795 4795 2033            12      JR  NZ,RCP_ST
                                
000797 4797 23               6      INC HL
000798 4798 DD212F54        14      LD  IX,FRMQNT
00079C 479C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007A0 47A0 CD1C00          17      CALL    _CALSLT
                                
0007A3 47A3 7B               4      LD  A,E
0007A4 47A4 32D8F2          13      LD  (_BUF_P),A
                                
       47A7                     RCP_PARAM4:
0007A7 47A7 7E               7      LD  A,(HL)
0007A8 47A8 23               6      INC HL
0007A9 47A9 FE20             7      CP  020H
0007AB 47AB 28FA            12      JR  Z,RCP_PARAM4
                                
0007AD 47AD FE2C             7      CP  ','
0007AF 47AF 2019            12      JR  NZ,RCP_ST
                                
0007B1 47B1 7E               7      LD  A,(HL)
0007B2 47B2 0604             7      LD  B,4
0007B4 47B4 FEC3             7      CP  0C3H        ;PRESET
0007B6 47B6 280E            12      JR  Z,RCP_LO
0007B8 47B8 05               4      DEC B       ;3
0007B9 47B9 D6F8             7      SUB 0F8H        ;XOR
0007BB 47BB 2809            12      JR  Z,RCP_LO
0007BD 47BD 05               4      DEC B       ;2
0007BE 47BE 3C               4      INC A       ;OR
0007BF 47BF 2805            12      JR  Z,RCP_LO
0007C1 47C1 05               4      DEC B       ;1
0007C2 47C2 3C               4      INC A       ;AND
0007C3 47C3 2801            12      JR  Z,RCP_LO
0007C5 47C5 05               4      DEC B       ;0
                                                ;PSET
       47C6                     RCP_LO:
0007C6 47C6 78               4      LD  A,B
0007C7 47C7 32CCF2          13      LD  (_BUF_LO),A
       47CA                     RCP_ST:
0007CA 47CA 2AC6F6          16      LD  HL,(STREND)
0007CD 47CD 22C7F2          16      LD  (_DTA),HL
0007D0 47D0 EB               4      EX  DE,HL
0007D1 47D1 2100FE          10      LD  HL,-512
0007D4 47D4 39              11      ADD HL,SP
0007D5 47D5 AF               4      XOR A
0007D6 47D6 ED52            15      SBC HL,DE
0007D8 47D8 3008            12      JR  NC,RCP0
0007DA 47DA 215EF5          10      LD  HL,BUF
0007DD 47DD 22C7F2          16      LD  (_DTA),HL
0007E0 47E0 6F               4      LD  L,A ;0
0007E1 47E1 67               4      LD  H,A ;0
       47E2                     RCP0:
0007E2 47E2 24               4      INC H
0007E3 47E3 22CFF2          16      LD  (_BUF_EN),HL
       47E6                     RCP1:
0007E6 47E6 F3               4      DI
0007E7 47E7 CDBC48          17      CALL    WAIT_VDP
                                
0007EA 47EA 3A0700          13      LD  A,(WRVDP)
0007ED 47ED 4F               4      LD  C,A
0007EE 47EE 0C               4      INC C       ;C := PORT#1's address(WR)
0007EF 47EF 3E24             7      LD  A,36
0007F1 47F1 ED79            12      OUT (C),A
0007F3 47F3 3E91             7      LD  A,080H+17
0007F5 47F5 ED79            12      OUT (C),A       ;R#17 := 36
                                
0007F7 47F7 0C               4      INC C
0007F8 47F8 0C               4      INC C       ;C := PORT#3's address(WR)
0007F9 47F9 2AD5F2          16      LD  HL,(_BUF_X)
0007FC 47FC ED69            12      OUT (C),L       ;R#36 DX
0007FE 47FE ED61            12      OUT (C),H       ;R#37
000800 4800 2AD7F2          16      LD  HL,(_BUF_Y)
000803 4803 ED69            12      OUT (C),L       ;R#38 DY
000805 4805 ED61            12      OUT (C),H       ;R#39
000807 4807 2AD1F2          16      LD  HL,(_BUF_W)
00080A 480A ED69            12      OUT (C),L       ;R#40 NX
00080C 480C ED61            12      OUT (C),H       ;R#41
00080E 480E 2AD3F2          16      LD  HL,(_BUF_H)
000811 4811 ED69            12      OUT (C),L       ;R#42 NY
000813 4813 ED61            12      OUT (C),H       ;R#43
                                
000815 4815 DD2AAFFC        20      LD  IX,(SCRMOD)
000819 4819 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00081C 481C B7               4      OR  A
00081D 481D 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
00081F 481F DD7D             9      LD  A,IXL
000821 4821 FE08             7      CP  8
000823 4823 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000825 4825 FE06             7      CP  6
000827 4827 2AD5F2          16      LD  HL,(_BUF_X)
00082A 482A 3AD1F2          13      LD  A,(_BUF_W)
00082D 482D 2005            12      JR  NZ,SCR57
00082F 482F B5               4      OR  L       ;スクリーン6
000830 4830 E603             7      AND 3
000832 4832 200D            12      JR  NZ,USE_LMMC
       4834                     SCR57:              ;スクリーン5,7
000834 4834 B5               4      OR  L
000835 4835 E601             7      AND 1
000837 4837 2008            12      JR  NZ,USE_LMMC
       4839                     USE_HMMC:
000839 4839 DD2E08          10      LD  IXL,8
       483C                     USE_HMMC8:
00083C 483C 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
00083E 483E 32CCF2          13      LD  (_BUF_LO),A
       4841                     USE_LMMC:
000841 4841 110000          10      LD  DE,0
000844 4844 06FF             7      LD  B,-1
000846 4846 CDE748          17      CALL    GET_PIXEL
000849 4849 ED79            12      OUT (C),A       ;R#44 first DATA
00084B 484B 3AD9F2          13      LD  A,(_BUF_O)
00084E 484E ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000850 4850 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000853 4853 F6B0             7      OR  0B0H        ;R#46 LMMC command
000855 4855 ED79            12      OUT (C),A
                                
000857 4857 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000859 4859 0D               4      DEC C
00085A 485A 0D               4      DEC C       ;C := PORT#1's address(WR)
00085B 485B 3EAC             7      LD  A,080H+44
00085D 485D ED79            12      OUT (C),A
00085F 485F 3E91             7      LD  A,080H+17
000861 4861 ED79            12      OUT (C),A       ;R#17 := 44
                                
000863 4863 3A0600          13      LD  A,(RDVDP)
000866 4866 3C               4      INC A
000867 4867 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000869 4869 3E02             7      LD  A,2
00086B 486B ED79            12      OUT (C),A
00086D 486D 3E8F             7      LD  A,08FH
00086F 486F ED79            12      OUT (C),A
000871 4871 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000874 4874 E640             7      AND 040H
000876 4876 201C            12      JR  NZ,LOOP_HMMC
       4878                     LOOP_COPY:
000878 4878 CDE748          17      CALL    GET_PIXEL
00087B 487B 08               4      EX  AF,AF'
00087C 487C FD4C             9      LD  C,IYH
       487E                     LOOP_COPY1:
00087E 487E ED78            12      IN  A,(C)
000880 4880 0F               4      RRCA            ;RRCAではサインフラグは変化しない
000881 4881 300A            12      JR  NC,EXIT_COPY    ;check CE bit
000883 4883 F27E48          10      JP  P,LOOP_COPY1    ;check TR bit
000886 4886 08               4      EX  AF,AF'
000887 4887 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000889 4889 ED79            12      OUT (C),A
00088B 488B 18EB            12      JR  LOOP_COPY
                                
       488D                     EXIT_COPY:
00088D 488D CDC448          17      CALL    GET_STATUS_0
000890 4890 FB               4      EI
000891 4891 C33B46          10      JP  ROM_NEXT
                                
       4894                     LOOP_HMMC:
000894 4894 F3               4      DI          ;必要
000895 4895 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000897 4897 43               4      LD  B,E
000898 4898 7B               4      LD  A,E
000899 4899 B7               4      OR  A
00089A 489A 2802            12      JR  Z,LOOP_HMMC1
00089C 489C EDB3                    OTIR
       489E                     LOOP_HMMC1:
00089E 489E 14               4      INC D
       489F                     LOOP_HMMC2:
00089F 489F 15               4      DEC D
0008A0 48A0 2805            12      JR  Z,LOOP_HMMC3
0008A2 48A2 EDB3                    OTIR
0008A4 48A4 C39F48          10      JP  LOOP_HMMC2
       48A7                     LOOP_HMMC3:
0008A7 48A7 ED78            12      IN  A,(C)
0008A9 48A9 0F               4      RRCA
0008AA 48AA 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
0008AC 48AC 2ACFF2          16      LD  HL,(_BUF_EN)
0008AF 48AF CD2E49          17      CALL    ROM_READ
0008B2 48B2 EB               4      EX  DE,HL
0008B3 48B3 2AC7F2          16      LD  HL,(_DTA)
0008B6 48B6 7A               4      LD  A,D
0008B7 48B7 B3               4      OR  E
0008B8 48B8 20DA            12      JR  NZ,LOOP_HMMC
0008BA 48BA 18C2            12      JR  LOOP_COPY1
                                    
       48BC                     WAIT_VDP:
0008BC 48BC 3E02             7      LD  A,2
0008BE 48BE CDC548          17      CALL    GET_STATUS
0008C1 48C1 0F               4      RRCA
0008C2 48C2 38F8            12      JR  C,WAIT_VDP
       48C4                     GET_STATUS_0:
0008C4 48C4 AF               4      XOR A
       48C5                     GET_STATUS:
0008C5 48C5 C5              11      PUSH    BC
0008C6 48C6 ED4B0600        20      LD  BC,(RDVDP)
0008CA 48CA 0C               4      INC C
0008CB 48CB ED79            12      OUT (C),A
0008CD 48CD 3E8F             7      LD  A,08FH
0008CF 48CF ED79            12      OUT (C),A
0008D1 48D1 ED78            12      IN  A,(C)
0008D3 48D3 C1              10      POP BC
0008D4 48D4 C9              10      RET
                                
       48D5                     GET_PIXEL256:
0008D5 48D5 7A               4      LD  A,D
0008D6 48D6 B3               4      OR  E
0008D7 48D7 200A            12      JR  NZ,GET_PIXEL1
0008D9 48D9 2ACFF2          16      LD  HL,(_BUF_EN)
0008DC 48DC CD2E49          17      CALL    ROM_READ
0008DF 48DF EB               4      EX  DE,HL
0008E0 48E0 2AC7F2          16      LD  HL,(_DTA)
       48E3                     GET_PIXEL1:
0008E3 48E3 7E               7      LD  A,(HL)
0008E4 48E4 23               6      INC HL
0008E5 48E5 1B               6      DEC DE
0008E6 48E6 C9              10      RET
                                
       48E7                     GET_PIXEL:
0008E7 48E7 DD7D             9      LD  A,IXL
0008E9 48E9 FE08             7      CP  8
0008EB 48EB 28E8            12      JR  Z,GET_PIXEL256
0008ED 48ED 04               4      INC B
0008EE 48EE FE06             7      CP  6
0008F0 48F0 282E            12      JR  Z,GET_PIXEL4
                                
0008F2 48F2 CB40             8      BIT 0,B
0008F4 48F4 20ED            12      JR  NZ,GET_PIXEL1
                                
0008F6 48F6 7A               4      LD  A,D
0008F7 48F7 B3               4      OR  E
0008F8 48F8 200A            12      JR  NZ,GET_PIXEL2
                                
0008FA 48FA 2ACFF2          16      LD  HL,(_BUF_EN)
0008FD 48FD CD2E49          17      CALL    ROM_READ
000900 4900 EB               4      EX  DE,HL
000901 4901 2AC7F2          16      LD  HL,(_DTA)
                                
       4904                     GET_PIXEL2:
000904 4904 7E               7      LD  A,(HL)
000905 4905 0F               4      RRCA
000906 4906 0F               4      RRCA
000907 4907 0F               4      RRCA
000908 4908 0F               4      RRCA
000909 4909 C9              10      RET
                                
       490A                     GET_PIXEL3:
00090A 490A 7A               4      LD  A,D
00090B 490B B3               4      OR  E
00090C 490C 200A            12      JR  NZ,GET_PIXEL5
                                
00090E 490E 2ACFF2          16      LD  HL,(_BUF_EN)
000911 4911 CD2E49          17      CALL    ROM_READ
000914 4914 EB               4      EX  DE,HL
000915 4915 2AC7F2          16      LD  HL,(_DTA)
       4918                     GET_PIXEL5:
000918 4918 7E               7      LD  A,(HL)
000919 4919 0F               4      RRCA
00091A 491A 0F               4      RRCA
00091B 491B 0F               4      RRCA
00091C 491C 0F               4      RRCA
00091D 491D 0F               4      RRCA
00091E 491E 0F               4      RRCA
00091F 491F C9              10      RET
                                
       4920                     GET_PIXEL4:
000920 4920 78               4      LD  A,B
000921 4921 E603             7      AND 3   ;+0
000923 4923 28E5            12      JR  Z,GET_PIXEL3
000925 4925 3D               4      DEC A   ;+1
000926 4926 28DC            12      JR  Z,GET_PIXEL2
000928 4928 3D               4      DEC A   ;+2
000929 4929 7E               7      LD  A,(HL)
00092A 492A C0              11      RET NZ
00092B 492B 0F               4      RRCA        ;+3
00092C 492C 0F               4      RRCA
00092D 492D C9              10      RET
                                
       492E                     ROM_READ:
00092E 492E E5              11      PUSH    HL
00092F 492F D5              11      PUSH    DE
000930 4930 C5              11      PUSH    BC
000931 4931 FDE5            15      PUSH    IY
000933 4933 22E3F2          16      LD  (LEFTX),HL
000936 4936 2AC7F2          16      LD  HL,(_DTA)
000939 4939 22DAF2          16      LD  (DTAX),HL
00093C 493C 2AE3F2          16      LD  HL,(LEFTX)
                                
00093F 493F CDE04B          17      CALL    RBX1
000942 4942 3870            12      JR  C,RBRERR1
000944 4944 79               4      LD  A,C
000945 4945 EB               4      EX  DE,HL
000946 4946 ED52            15      SBC HL,DE       ;CP 0HL,CDE
000948 4948 19              11      ADD HL,DE
000949 4949 DE00             7      SBC A,000H
00094B 494B 3801            12      JR  C,RBR1
00094D 494D EB               4      EX  DE,HL
       494E                     RBR1:
00094E 494E 9F               4      SBC A,A
00094F 494F E601             7      AND 1
000951 4951 32B6F2          13      LD  (_RESULT),A
000954 4954 7C               4      LD  A,H
000955 4955 B5               4      OR  L
000956 4956 CAAA49          10      JP  Z,RBREND0
                                
000959 4959 22C3F2          16      LD  (_LEFT),HL  ;Read record byte
00095C 495C 22E3F2          16      LD  (LEFTX),HL
                                
00095F 495F CD0C4C          17      CALL    RBX2
000962 4962 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000964 4964 CD1F4C          17      CALL    RBXA
000967 4967 DAC049          10      JP  C,RBRERR
00096A 496A C5              11      PUSH    BC
00096B 496B CDFE43          17      CALL    ROM_LDIR
00096E 496E ED53DAF2        20      LD  (DTAX),DE
000972 4972 2AE3F2          16      LD  HL,(LEFTX)
000975 4975 D1              10      POP DE
000976 4976 A7               4      AND A
000977 4977 ED52            15      SBC HL,DE
000979 4979 22E3F2          16      LD  (LEFTX),HL
00097C 497C 2829            12      JR  Z,RBREND
                                
       497E                     RBRB:
00097E 497E CD5B4C          17      CALL    RBXB
000981 4981 2818            12      JR  Z,RBRC
       4983                     RBRB1:
000983 4983 C5              11      PUSH    BC
000984 4984 D5              11      PUSH    DE
000985 4985 CD064D          17      CALL    CLUST
000988 4988 EB               4      EX  DE,HL
000989 4989 ED4BB9F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
00098D 498D CDFE43          17      CALL    ROM_LDIR
000990 4990 EB               4      EX  DE,HL
000991 4991 D1              10      POP DE
000992 4992 C1              10      POP BC
000993 4993 CDE34C          17      CALL    GNCL
000996 4996 DAC049          10      JP  C,RBRERR
000999 4999 10E8            13      DJNZ    RBRB1
       499B                     RBRC:
00099B 499B CD734C          17      CALL    RBXC
00099E 499E 2807            12      JR  Z,RBREND
                                
0009A0 49A0 CD064D          17      CALL    CLUST
0009A3 49A3 EB               4      EX  DE,HL
0009A4 49A4 CDFE43          17      CALL    ROM_LDIR
       49A7                     RBREND:
0009A7 49A7 CD7F4C          17      CALL    RBXEND
       49AA                     RBREND0:
0009AA 49AA FDE1            14      POP IY
0009AC 49AC C1              10      POP BC
0009AD 49AD D1              10      POP DE
0009AE 49AE F1              10      POP AF  ;(HL)
0009AF 49AF AF               4      XOR A
0009B0 49B0 3AB6F2          13      LD  A,(_RESULT)
0009B3 49B3 C9              10      RET
                                
       49B4                     RBRERR1:
0009B4 49B4 3E01             7      LD  A,001H
       49B6                     RBRERR2:
0009B6 49B6 FDE1            14      POP IY
0009B8 49B8 C1              10      POP BC
0009B9 49B9 D1              10      POP DE
0009BA 49BA E1              10      POP HL
0009BB 49BB 37               4      SCF
0009BC 49BC 210000          10      LD  HL,0
0009BF 49BF C9              10      RET
       49C0                     RBRERR:
0009C0 49C0 3EFF             7      LD  A,0FFH
0009C2 49C2 18F2            12      JR  RBRERR2
                                
       49C4                     FILE_DD:
0009C4 49C4 E1              10      POP HL
0009C5 49C5 3E                      DB  03EH
0009C6 49C6 C9              10      RET
0009C7 49C7 32A3F2          13      LD  (SWC_BLOAD_M),A
       49CA                     ROM_ORG:
0009CA 49CA 2AE5F2          16      LD  HL,(PARAM0)
0009CD 49CD 7E               7      LD  A,(HL)
0009CE 49CE C9              10      RET
       49CF                     FILE_B:
0009CF 49CF AF               4      XOR A
0009D0 49D0 32EBF2          13      LD  (FDRV),A
0009D3 49D3 1E00             7      LD  E,0
0009D5 49D5 3A63F6          13      LD  A,(VALTYP)
0009D8 49D8 FE03             7      CP  3       ;string
0009DA 49DA C25F4A          10      JP  NZ,FILED
                                
0009DD 49DD DD21D067        14      LD  IX,FRESTR
0009E1 49E1 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009E5 49E5 CD1C00          17      CALL    _CALSLT
0009E8 49E8 E5              11      PUSH    HL
0009E9 49E9 DDE1            14      POP IX
                                
0009EB 49EB DD5E00          19      LD  E,(IX+0)
0009EE 49EE DD7E01          19      LD  A,(IX+1)
0009F1 49F1 DD5602          19      LD  D,(IX+2)
0009F4 49F4 DD62             9      LD  IXH,D
0009F6 49F6 DD6F             9      LD  IXL,A
0009F8 49F8 7B               4      LD  A,E
       49F9                     FILE_BDOS:
0009F9 49F9 FE04             7      CP  4
0009FB 49FB 3808            12      JR  C,FILEB1
0009FD 49FD DD7E03          19      LD  A,(IX+3)
000A00 4A00 FE3A             7      CP  ':'
000A02 4A02 28C0            12      JR  Z,FILE_DD
000A04 4A04 7B               4      LD  A,E
       4A05                     FILEB1:
000A05 4A05 FE02             7      CP  2
000A07 4A07 3818            12      JR  C,DEVI1
000A09 4A09 DD7E01          19      LD  A,(IX+1)
000A0C 4A0C FE3A             7      CP  ':'
000A0E 4A0E 2011            12      JR  NZ,DEVI1
000A10 4A10 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A13 4A13 CD384B          17      CALL    CAP
000A16 4A16 D640             7      SUB '@'
000A18 4A18 DD23            10      INC IX
000A1A 4A1A DD23            10      INC IX
000A1C 4A1C 1D               4      DEC E
000A1D 4A1D 1D               4      DEC E
000A1E 4A1E 32EBF2          13      LD  (FDRV),A
       4A21                     DEVI1:
000A21 4A21 DD7E00          19      LD  A,(IX+0)
000A24 4A24 D65C             7      SUB 05CH        ;\
000A26 4A26 2008            12      JR  NZ,NOROOT
000A28 4A28 6F               4      LD  L,A
000A29 4A29 67               4      LD  H,A
000A2A 4A2A 22E9F2          16      LD  (_CDX),HL
000A2D 4A2D DD23            10      INC IX
000A2F 4A2F 1D               4      DEC E
       4A30                     NOROOT:
                                
       4A30                     SETDIR:
000A30 4A30 CD5F4A          17      CALL    FILED
000A33 4A33 DD7E00          19      LD  A,(IX+0)
000A36 4A36 FE5C             7      CP  05CH        ;\
000A38 4A38 C0              11      RET NZ
000A39 4A39 DD23            10      INC IX
000A3B 4A3B 1D               4      DEC E
000A3C 4A3C 3AECF2          13      LD  A,(FNAME)
000A3F 4A3F FE20             7      CP  020H        ;. の処理
000A41 4A41 28ED            12      JR  Z,SETDIR
                                
000A43 4A43 CD4E4B          17      CALL    ROM_OPEN
000A46 4A46 B7               4      OR  A
000A47 4A47 C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0000BH   ;属性(アトリビュート)
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    POP DE
                                    BIT 4,A     ;ディレクトリ
                                #else
000A48 4A48 FD2AE0F2        20      LD  IY,(DIRENT1)
000A4C 4A4C FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000A50 4A50 C8              11      RET Z
000A51 4A51 CDA64A          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    LD  D,A
                                    EX  DE,HL
                                    POP DE
                                #else
000A54 4A54 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A57 4A57 FD661B          19      LD  H,(IY+01BH)
                                #endif
000A5A 4A5A 22E9F2          16      LD  (_CDX),HL
000A5D 4A5D 18D1            12      JR  SETDIR
                                
       4A5F                     FILED:
000A5F 4A5F CDA64A          17      CALL    FILEI
000A62 4A62 21ECF2          10      LD  HL,FNAME
                                
000A65 4A65 0608             7      LD  B,8
       4A67                     FILE2:
000A67 4A67 CDB34A          17      CALL    CCHKF
000A6A 4A6A C8              11      RET Z
000A6B 4A6B FE2A             7      CP  '*'
000A6D 4A6D 282E            12      JR  Z,FILE9
000A6F 4A6F FE2E             7      CP  '.'
000A71 4A71 280C            12      JR  Z,FILE4
000A73 4A73 77               7      LD  (HL),A
000A74 4A74 23               6      INC HL
000A75 4A75 10F0            13      DJNZ    FILE2
                                
       4A77                     FILE3:
000A77 4A77 CDB34A          17      CALL    CCHKF
000A7A 4A7A C8              11      RET Z
000A7B 4A7B FE2E             7      CP  '.'
000A7D 4A7D 20F8            12      JR  NZ,FILE3
                                
       4A7F                     FILE4:
000A7F 4A7F 21F4F2          10      LD  HL,FNAME+8
000A82 4A82 0603             7      LD  B,3
                                
       4A84                     FILE4L:
000A84 4A84 CDB34A          17      CALL    CCHKF
000A87 4A87 C8              11      RET Z
000A88 4A88 FE2E             7      CP  '.'
000A8A 4A8A 2008            12      JR  NZ,FILE12
000A8C 4A8C 32ECF2          13      LD  (FNAME),A   ;Parent directory(..)
000A8F 4A8F 32EDF2          13      LD  (FNAME+1),A
000A92 4A92 3E20             7      LD  A,020H
       4A94                     FILE12:
000A94 4A94 FE2A             7      CP  '*'
000A96 4A96 280A            12      JR  Z,FILE10
000A98 4A98 77               7      LD  (HL),A
000A99 4A99 23               6      INC HL
000A9A 4A9A 10E8            13      DJNZ    FILE4L
000A9C 4A9C C9              10      RET
                                
       4A9D                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A9D 4A9D CDA24A          17      CALL    FILE10
000AA0 4AA0 18D5            12      JR  FILE3
                                
       4AA2                     FILE10:
000AA2 4AA2 3E3F             7      LD  A,'?'
000AA4 4AA4 1808            12      JR  FILL_MEMORY
       4AA6                     FILEI:              ;名前＋拡張子をスペースで初期化
000AA6 4AA6 3E20             7      LD  A,020H
000AA8 4AA8 01000B          10      LD  BC,11*256   ;C=0にしておく
000AAB 4AAB 21ECF2          10      LD  HL,FNAME
       4AAE                     FILL_MEMORY:            ;HLからBバイトAで埋める
000AAE 4AAE 77               7      LD  (HL),A
000AAF 4AAF 23               6      INC HL
000AB0 4AB0 10FC            13      DJNZ    FILL_MEMORY
000AB2 4AB2 C9              10      RET
                                
       4AB3                     CCHKF:
000AB3 4AB3 7B               4      LD  A,E
000AB4 4AB4 B7               4      OR  A
000AB5 4AB5 C8              11      RET Z
000AB6 4AB6 DD7E00          19      LD  A,(IX+0)
000AB9 4AB9 CDC04A          17      CALL    CCHK2
000ABC 4ABC C8              11      RET Z
000ABD 4ABD C3234B          10      JP  FKAN
                                
       4AC0                     CCHK2:
000AC0 4AC0 0C               4      INC C
000AC1 4AC1 0D               4      DEC C
000AC2 4AC2 C0              11      RET NZ
       4AC3                     CCHK3:              ;ZF=1 で使えない文字
000AC3 4AC3 FE2B             7      CP  '+'
000AC5 4AC5 C8              11      RET Z
000AC6 4AC6 FE2C             7      CP  ','
000AC8 4AC8 C8              11      RET Z
000AC9 4AC9 FE2F             7      CP  '/'
000ACB 4ACB C8              11      RET Z
000ACC 4ACC FE3A             7      CP  ':'
000ACE 4ACE C8              11      RET Z
000ACF 4ACF FE3B             7      CP  ';'
000AD1 4AD1 C8              11      RET Z
000AD2 4AD2 FE3D             7      CP  '='
000AD4 4AD4 C8              11      RET Z
000AD5 4AD5 FE5C             7      CP  05CH    ;\
000AD7 4AD7 C8              11      RET Z
000AD8 4AD8 FE1F             7      CP  01FH
000ADA 4ADA D0              11      RET NC
000ADB 4ADB BF               4      CP  A       ;Z=1
000ADC 4ADC C9              10      RET
                                
       4ADD                     SS1:
000ADD 4ADD 13               6      INC DE
       4ADE                     SPCUT:              ;スペースをカット
000ADE 4ADE 1A               7      LD  A,(DE)
000ADF 4ADF FE20             7      CP  020H
000AE1 4AE1 28FA            12      JR  Z,SS1
000AE3 4AE3 C9              10      RET
                                
       4AE4                     SCREOF1:
000AE4 4AE4 13               6      INC DE
       4AE5                     SPCUTEX:            ;スペース改行などをカット
000AE5 4AE5 1A               7      LD  A,(DE)
000AE6 4AE6 FE20             7      CP  020H
000AE8 4AE8 28FA            12      JR  Z,SCREOF1
000AEA 4AEA FE0D             7      CP  00DH
000AEC 4AEC 28F6            12      JR  Z,SCREOF1
000AEE 4AEE FE0A             7      CP  00AH
000AF0 4AF0 28F2            12      JR  Z,SCREOF1
000AF2 4AF2 FE1A             7      CP  01AH
000AF4 4AF4 28EE            12      JR  Z,SCREOF1
000AF6 4AF6 C9              10      RET
                                
       4AF7                     GETNUM:
000AF7 4AF7 210000          10      LD  HL,0
       4AFA                     GETNUM1:
000AFA 4AFA 1A               7      LD  A,(DE)
000AFB 4AFB 13               6      INC DE
000AFC 4AFC D630             7      SUB '0'
000AFE 4AFE D8              11      RET C
000AFF 4AFF FE0A             7      CP  10
000B01 4B01 D0              11      RET NC
000B02 4B02 4D               4      LD  C,L
000B03 4B03 44               4      LD  B,H
000B04 4B04 29              11      ADD HL,HL   ;*2
000B05 4B05 29              11      ADD HL,HL   ;*4
000B06 4B06 09              11      ADD HL,BC   ;*5
000B07 4B07 29              11      ADD HL,HL   ;*10
000B08 4B08 4F               4      LD  C,A
000B09 4B09 0600             7      LD  B,0
000B0B 4B0B 09              11      ADD HL,BC
000B0C 4B0C 18EC            12      JR  GETNUM1
                                
       4B0E                     SEARCH_END:
000B0E 4B0E 7E               7      LD  A,(HL)
       4B0F                     SEARCH_END1:
000B0F 4B0F 23               6      INC HL
000B10 4B10 B7               4      OR  A
000B11 4B11 C8              11      RET Z
000B12 4B12 FE3A             7      CP  ':'
000B14 4B14 20F8            12      JR  NZ,SEARCH_END
000B16 4B16 7E               7      LD  A,(HL)
000B17 4B17 FE3A             7      CP  ':'
000B19 4B19 28F4            12      JR  Z,SEARCH_END1
000B1B 4B1B C9              10      RET
                                
       4B1C                     FKANC:
000B1C 4B1C CB41             8      BIT 0,C
000B1E 4B1E CC414B          17      CALL    Z,CAP2
000B21 4B21 1803            12      JR  FKANX
       4B23                     FKAN:           ;漢字チェック
000B23 4B23 DD23            10      INC IX
000B25 4B25 1D               4      DEC E
       4B26                     FKANX:
000B26 4B26 CB41             8      BIT 0,C
000B28 4B28 CB81             8      RES 0,C
000B2A 4B2A C0              11      RET NZ
000B2B 4B2B FE80             7      CP  080H
000B2D 4B2D D8              11      RET C
000B2E 4B2E FEA0             7      CP  0A0H
000B30 4B30 3803            12      JR  C,FKAN1
000B32 4B32 FEE0             7      CP  0E0H
000B34 4B34 D8              11      RET C
       4B35                     FKAN1:
000B35 4B35 0C               4      INC C
000B36 4B36 A7               4      AND A
000B37 4B37 C9              10      RET
                                
       4B38                     CAP:
000B38 4B38 FE61             7      CP  'a'
000B3A 4B3A D8              11      RET C
000B3B 4B3B FE7B             7      CP  'z'+1
000B3D 4B3D D0              11      RET NC
000B3E 4B3E D620             7      SUB 020H
000B40 4B40 C9              10      RET
       4B41                     CAP2:
000B41 4B41 CD384B          17      CALL    CAP
       4B44                     CAP3:               ;
000B44 4B44 FE05             7      CP  5
000B46 4B46 2803            12      JR  Z,CAP4
000B48 4B48 FE21             7      CP  021H
000B4A 4B4A C9              10      RET
       4B4B                     CAP4:
000B4B 4B4B 3EE5             7      LD  A,0E5H
000B4D 4B4D C9              10      RET
                                
       4B4E                     ROM_OPEN:
000B4E 4B4E CD4151          17      CALL    GET_DISK_BANK_FDRV
                                
000B51 4B51 CDAC4D          17      CALL    GET_DIR_DAT
000B54 4B54 D5              11      PUSH    DE
000B55 4B55 CD6A4B          17      CALL    FILESE
000B58 4B58 D1              10      POP DE
000B59 4B59 3F               4      CCF
000B5A 4B5A D8              11      RET C
000B5B 4B5B 22E0F2          16      LD  (DIRENT1),HL
000B5E 4B5E E5              11      PUSH    HL
000B5F 4B5F 210000          10      LD  HL,0
000B62 4B62 22BDF2          16      LD  (RR_LOW),HL
000B65 4B65 22BFF2          16      LD  (RR_HIGH),HL
000B68 4B68 E1              10      POP HL
000B69 4B69 C9              10      RET
                                
       4B6A                     FILESE:
       4B6A                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000B6A 4B6A 7E               7      LD  A,(HL)
                                #endif
000B6B 4B6B B7               4      OR  A
000B6C 4B6C C8              11      RET Z       ;END:ZF=1 CF=0
000B6D 4B6D FEE5             7      CP  0E5H
000B6F 4B6F 280D            12      JR  Z,FILESE1
000B71 4B71 11ECF2          10      LD  DE,FNAME
000B74 4B74 E5              11      PUSH    HL
000B75 4B75 CDBB4B          17      CALL    CPFILE
000B78 4B78 CCDC4B          17      CALL    Z,CPFILE2
000B7B 4B7B E1              10      POP HL
000B7C 4B7C 37               4      SCF
000B7D 4B7D C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B7E                     FILESE1:
000B7E 4B7E CD864B          17      CALL    FNEXT
000B81 4B81 20E7            12      JR  NZ,FILESE0
000B83 4B83 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B85 4B85 C9              10      RET
                                
       4B86                     FNEXT:
000B86 4B86 112000          10      LD  DE,020H
000B89 4B89 19              11      ADD HL,DE
000B8A 4B8A ED5BE9F2        20      LD  DE,(_CDX)
000B8E 4B8E 7A               4      LD  A,D
000B8F 4B8F B3               4      OR  E
000B90 4B90 2019            12      JR  NZ,FNEXT_SUBDIR
000B92 4B92 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
       4B93                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B93 4B93 F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B94 4B94 CB7C             8      BIT 7,H
000B96 4B96 2811            12      JR  Z,CHECK_DIR_PAGE1
000B98 4B98 7C               4      LD  A,H
000B99 4B99 D620             7      SUB 020H
000B9B 4B9B 67               4      LD  H,A
000B9C 4B9C 3AE2F2          13      LD  A,(_DIR_BANK)
000B9F 4B9F 3C               4      INC A
000BA0 4BA0 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BA3 4BA3 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000BA6 4BA6 32E2F2          13      LD  (_DIR_BANK),A
       4BA9                     CHECK_DIR_PAGE1:
000BA9 4BA9 F1              10      POP AF
                                #endif
000BAA 4BAA C9              10      RET
                                
       4BAB                     FNEXT_SUBDIR:           ;サブディレクトリ
000BAB 4BAB 0D               4      DEC C
000BAC 4BAC C0              11      RET NZ
                                
000BAD 4BAD ED5BE9F2        20      LD  DE,(_CDX)
000BB1 4BB1 CDE34C          17      CALL    GNCL
000BB4 4BB4 EB               4      EX  DE,HL
000BB5 4BB5 22E9F2          16      LD  (_CDX),HL
000BB8 4BB8 C3E84D          10      JP  GET_SUBDIR
                                
       4BBB                     CPFILE:
000BBB 4BBB C5              11      PUSH    BC
000BBC 4BBC 01000B          10      LD  BC,00B00H
       4BBF                     CPSTR1:
000BBF 4BBF 1A               7      LD  A,(DE)
000BC0 4BC0 FE3F             7      CP  '?'     ;Wild card
000BC2 4BC2 2812            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000BC4 4BC4 7E               7      LD  A,(HL)
                                #endif
000BC5 4BC5 CD1C4B          17      CALL    FKANC
000BC8 4BC8 E5              11      PUSH    HL
000BC9 4BC9 67               4      LD  H,A
000BCA 4BCA 1A               7      LD  A,(DE)
000BCB 4BCB CB01             4      RLC C
000BCD 4BCD CD1C4B          17      CALL    FKANC
000BD0 4BD0 CB09             4      RRC C
000BD2 4BD2 BC               4      CP  H       ;CP (HL),(DE)
000BD3 4BD3 E1              10      POP HL
000BD4 4BD4 2004            12      JR  NZ,CPSTR3
       4BD6                     CPSTR2:
000BD6 4BD6 13               6      INC DE
000BD7 4BD7 23               6      INC HL
000BD8 4BD8 10E5            13      DJNZ    CPSTR1
       4BDA                     CPSTR3:
000BDA 4BDA C1              10      POP BC
000BDB 4BDB C9              10      RET
                                
       4BDC                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    CALL    RDSLT_ROM
                                #else
000BDC 4BDC 7E               7      LD  A,(HL)
                                #endif
000BDD 4BDD E60E             7      AND 00EH    ;~0F1H
000BDF 4BDF C9              10      RET
                                
       4BE0                     RBX1:
000BE0 4BE0 E5              11      PUSH    HL      ;Record byte
                                
000BE1 4BE1 ED5BBDF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000BE5 4BE5 3AC0F2          13      LD  A,(RR_HIGH+1)
000BE8 4BE8 4F               4      LD  C,A
                                
000BE9 4BE9 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001CH
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  D,A
                                    CALL    RDSLT_ROM
                                    EX  DE,HL       ;AHL=File size
                                    POP DE
                                #else
000BEC 4BEC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BEF 4BEF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000BF2 4BF2 FD2AE0F2        20      LD  IY,(DIRENT1)
000BF6 4BF6 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BF9 4BF9 FD661D          19      LD  H,(IY+01DH)
000BFC 4BFC FD7E1E          19      LD  A,(IY+01EH)
                                #endif
                                
000BFF 4BFF A7               4      AND A
000C00 4C00 ED52            15      SBC HL,DE
000C02 4C02 99               4      SBC A,C
000C03 4C03 D1              10      POP DE
                                
000C04 4C04 D8              11      RET C
000C05 4C05 4F               4      LD  C,A
000C06 4C06 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000C07 4C07 B2               4      OR  D
000C08 4C08 B3               4      OR  E
000C09 4C09 C0              11      RET NZ
000C0A 4C0A 37               4      SCF
000C0B 4C0B C9              10      RET
                                
       4C0C                     RBX2:
000C0C 4C0C ED4BBEF2        20      LD  BC,(RR_LOW+1)
000C10 4C10 CD944C          17      CALL    RWXR
000C13 4C13 3ABAF2          13      LD  A,(CLSZ_H)
000C16 4C16 3D               4      DEC A
000C17 4C17 E5              11      PUSH    HL
000C18 4C18 2ABDF2          16      LD  HL,(RR_LOW)
000C1B 4C1B A4               4      AND H
000C1C 4C1C B5               4      OR  L
000C1D 4C1D E1              10      POP HL
000C1E 4C1E C9              10      RET
                                
       4C1F                     RBXA:
000C1F 4C1F D5              11      PUSH    DE
000C20 4C20 CD064D          17      CALL    CLUST
000C23 4C23 ED53C5F2        20      LD  (_DTPS),DE
000C27 4C27 D1              10      POP DE
000C28 4C28 CDE34C          17      CALL    GNCL
000C2B 4C2B D8              11      RET C
000C2C 4C2C ED53C1F2        20      LD  (_CLPS),DE
                                
000C30 4C30 ED4BBDF2        20      LD  BC,(RR_LOW)
000C34 4C34 2AB9F2          16      LD  HL,(CLSZ)
000C37 4C37 7C               4      LD  A,H
000C38 4C38 3D               4      DEC A
000C39 4C39 A0               4      AND B
000C3A 4C3A 47               4      LD  B,A
000C3B 4C3B ED42            15      SBC HL,BC       ;remaining cluster
                                
000C3D 4C3D ED5BE3F2        20      LD  DE,(LEFTX)
000C41 4C41 ED52            15      SBC HL,DE       ;CP HL,DE
000C43 4C43 19              11      ADD HL,DE
000C44 4C44 3801            12      JR  C,RBXA1
000C46 4C46 EB               4      EX  DE,HL
       4C47                     RBXA1:
000C47 4C47 3AB7F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C4A 4C4A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C4D 4C4D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C50 4C50 E5              11      PUSH    HL
000C51 4C51 2AC5F2          16      LD  HL,(_DTPS)
000C54 4C54 09              11      ADD HL,BC
000C55 4C55 ED5BDAF2        20      LD  DE,(DTAX)
000C59 4C59 C1              10      POP BC
000C5A 4C5A C9              10      RET
                                
       4C5B                     RBXB:
000C5B 4C5B 2ADAF2          16      LD  HL,(DTAX)
000C5E 4C5E ED5BC1F2        20      LD  DE,(_CLPS)
000C62 4C62 3AE4F2          13      LD  A,(LEFTX+1)
000C65 4C65 47               4      LD  B,A
000C66 4C66 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C69                     RBXB1:
000C69 4C69 1F               4      RRA     ;->CF
000C6A 4C6A 3804            12      JR  C,RBXB2
000C6C 4C6C CB38             8      SRL B   ;B=B/2
000C6E 4C6E 18F9            12      JR  RBXB1
       4C70                     RBXB2:
000C70 4C70 78               4      LD  A,B
000C71 4C71 B7               4      OR  A
000C72 4C72 C9              10      RET
                                
       4C73                     RBXC:
000C73 4C73 ED4BE3F2        20      LD  BC,(LEFTX)
000C77 4C77 3ABAF2          13      LD  A,(CLSZ_H)
000C7A 4C7A 3D               4      DEC A
000C7B 4C7B A0               4      AND B
000C7C 4C7C 47               4      LD  B,A
000C7D 4C7D B1               4      OR  C
000C7E 4C7E C9              10      RET
                                
       4C7F                     RBXEND:
000C7F 4C7F ED5BC3F2        20      LD  DE,(_LEFT)
000C83 4C83 2ABDF2          16      LD  HL,(RR_LOW)
000C86 4C86 3AC0F2          13      LD  A,(RR_HIGH+1)
000C89 4C89 19              11      ADD HL,DE
000C8A 4C8A CE00             7      ADC A,0
000C8C 4C8C 22BDF2          16      LD  (RR_LOW),HL
000C8F 4C8F 32C0F2          13      LD  (RR_HIGH+1),A
000C92 4C92 EB               4      EX  DE,HL       ;HL=Read byte
000C93 4C93 C9              10      RET 
                                
       4C94                     RWXR:
000C94 4C94 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C97                     L_RWX:
000C97 4C97 1F               4      RRA     ;->CF
000C98 4C98 3806            12      JR  C,E_RWX
000C9A 4C9A CB38             8      SRL B   ;BC=BC/2
000C9C 4C9C CB19             8      RR  C   ;
000C9E 4C9E 18F7            12      JR  L_RWX
       4CA0                     E_RWX:
000CA0 4CA0 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
                                    PUSH    HL
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  D,A
                                    POP HL
                                #else
000CA3 4CA3 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000CA6 4CA6 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000CA9 4CA9 FD2AE0F2        20      LD  IY,(DIRENT1)
000CAD 4CAD FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000CB0 4CB0 FD561B          19      LD  D,(IY+01BH)
                                #endif
000CB3 4CB3 CD4151          17      CALL    GET_DISK_BANK_FDRV
       4CB6                     RWX1:
000CB6 4CB6 ED53C1F2        20      LD  (_CLPS),DE
000CBA 4CBA 7A               4      LD  A,D
000CBB 4CBB B3               4      OR  E
000CBC 4CBC 37               4      SCF
000CBD 4CBD C8              11      RET Z
                                
000CBE 4CBE 78               4      LD  A,B
000CBF 4CBF B1               4      OR  C
000CC0 4CC0 C8              11      RET Z
                                
000CC1 4CC1 CDE34C          17      CALL    GNCL
000CC4 4CC4 D8              11      RET C
000CC5 4CC5 0B               6      DEC BC
000CC6 4CC6 CD454D          17      CALL    ENDCL
000CC9 4CC9 38EB            12      JR  C,RWX1
000CCB 4CCB 37               4      SCF
000CCC 4CCC C9              10      RET
                                
       4CCD                     NCL3:
000CCD 4CCD CD4151          17      CALL    GET_DISK_BANK_FDRV
000CD0 4CD0 6B               4      LD  L,E
000CD1 4CD1 62               4      LD  H,D
000CD2 4CD2 CB3C             8      SRL H
000CD4 4CD4 CB1D             8      RR  L
000CD6 4CD6 1F               4      RRA
000CD7 4CD7 19              11      ADD HL,DE
000CD8 4CD8 010060          10      LD  BC,BANK1_ADR
000CDB 4CDB 09              11      ADD HL,BC
000CDC 4CDC ED4BBBF2        20      LD  BC,(SECSZ)
000CE0 4CE0 09              11      ADD HL,BC
000CE1 4CE1 17               4      RLA
000CE2 4CE2 C9              10      RET
                                
       4CE3                     GNCL:
000CE3 4CE3 7A               4      LD  A,D
000CE4 4CE4 B3               4      OR  E
000CE5 4CE5 37               4      SCF
000CE6 4CE6 C8              11      RET Z
000CE7 4CE7 C5              11      PUSH    BC
000CE8 4CE8 E5              11      PUSH    HL
000CE9 4CE9 CDCD4C          17      CALL    NCL3
000CEC 4CEC 3809            12      JR  C,GNC1
000CEE 4CEE 5E               7      LD  E,(HL)
000CEF 4CEF 23               6      INC HL
000CF0 4CF0 7E               7      LD  A,(HL)
000CF1 4CF1 E60F             7      AND 00FH
000CF3 4CF3 57               4      LD  D,A
000CF4 4CF4 E1              10      POP HL
000CF5 4CF5 C1              10      POP BC
000CF6 4CF6 C9              10      RET
       4CF7                     GNC1:
000CF7 4CF7 7E               7      LD  A,(HL)
000CF8 4CF8 23               6      INC HL
000CF9 4CF9 56               7      LD  D,(HL)
000CFA 4CFA 0604             7      LD  B,4
       4CFC                     GNC1L:
000CFC 4CFC CB3A             8      SRL D
000CFE 4CFE 1F               4      RRA
000CFF 4CFF 10FB            13      DJNZ    GNC1L
                                
000D01 4D01 5F               4      LD  E,A
000D02 4D02 E1              10      POP HL
000D03 4D03 C1              10      POP BC
000D04 4D04 A7               4      AND A
000D05 4D05 C9              10      RET
                                
       4D06                     CLUST:
000D06 4D06 EB               4      EX  DE,HL
       4D07                     CLUST_HL:
000D07 4D07 2B               6      DEC HL
000D08 4D08 2B               6      DEC HL
000D09 4D09 C5              11      PUSH    BC
000D0A 4D0A 3ABAF2          13      LD  A,(CLSZ_H)
000D0D 4D0D CD6D51          17      CALL    MUL_AHL
                                
000D10 4D10 CDC94D          17      CALL    GET_DIR_POS
000D13 4D13 4F               4      LD  C,A
000D14 4D14 0600             7      LD  B,0
000D16 4D16 09              11      ADD HL,BC
                                
000D17 4D17 ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000D1B 4D1B CB38             8      SRL B
000D1D 4D1D CB19             8      RR  C           ;/2
000D1F 4D1F CB38             8      SRL B
000D21 4D21 CB19             8      RR  C           ;/4
000D23 4D23 CB38             8      SRL B
000D25 4D25 CB19             8      RR  C           ;/8
000D27 4D27 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000D28 4D28 4D               4      LD  C,L     ;C=読み出し元
000D29 4D29 29              11      ADD HL,HL   ;64KB→32KB
000D2A 4D2A 29              11      ADD HL,HL   ;32KB→16KB
000D2B 4D2B 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D2C 4D2C CD4151          17      CALL    GET_DISK_BANK_FDRV
000D2F 4D2F 84               4      ADD A,H
000D30 4D30 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D33 4D33 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D36 4D36 32B7F2          13      LD  (_BANK),A
000D39 4D39 69               4      LD  L,C     ;C=読み出し元
000D3A 4D3A 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D3C 4D3C A5               4      AND L
                                #endif
       4D3D                     CLUST2:
000D3D 4D3D C660             7      ADD A,high BANK1_ADR
000D3F 4D3F 67               4      LD  H,A
000D40 4D40 2E00             7      LD  L,0
000D42 4D42 EB               4      EX  DE,HL
000D43 4D43 C1              10      POP BC
000D44 4D44 C9              10      RET
                                
       4D45                     ENDCL:
000D45 4D45 7A               4      LD  A,D ;END CLUSTER
000D46 4D46 FE0F             7      CP  00FH    ;FAT12の最大値
000D48 4D48 C0              11      RET NZ
000D49 4D49 7B               4      LD  A,E
000D4A 4D4A FEF7             7      CP  0F7H
000D4C 4D4C C9              10      RET
                                
       4D4D                     RB_READ:
000D4D 4D4D AF               4      XOR A   ;HLA = HL*128
000D4E 4D4E CB3C             8      SRL H
000D50 4D50 CB1D             8      RR  L
000D52 4D52 1F               4      RRA
000D53 4D53 32BDF2          13      LD  (RR_LOW),A
000D56 4D56 22BEF2          16      LD  (RR_MID),HL
000D59 4D59 218000          10      LD  HL,128
                                
000D5C 4D5C CD2E49          17      CALL    ROM_READ
000D5F 4D5F C9              10      RET
                                
       4D60                     GETSEQ:
000D60 4D60 FD6E20          19      LD  L,(IY+32)
000D63 4D63 FD660C          19      LD  H,(IY+12)
                                
000D66 4D66 CB25             8      SLA L
                                
000D68 4D68 CB3C             8      SRL H
000D6A 4D6A CB1D             8      RR  L
000D6C 4D6C C9              10      RET
                                
       4D6D                     SETSEQ:
000D6D 4D6D F5              11      PUSH    AF
000D6E 4D6E 3ABDF2          13      LD  A,(RR_LOW)
000D71 4D71 2ABEF2          16      LD  HL,(RR_MID)
                                
000D74 4D74 CD8B4D          17      CALL    SSQ1
                                
000D77 4D77 29              11      ADD HL,HL
000D78 4D78 CB3D             8      SRL L
000D7A 4D7A FD7520          19      LD  (IY+32),L
000D7D 4D7D FD740C          19      LD  (IY+12),H
000D80 4D80 F1              10      POP AF
000D81 4D81 C9              10      RET
                                
       4D82                     GETSIZE:
000D82 4D82 FD7E10          19      LD  A,(IY+16)
000D85 4D85 FD6E11          19      LD  L,(IY+17)
000D88 4D88 FD6612          19      LD  H,(IY+18)
       4D8B                     SSQ1:
000D8B 4D8B 87               4      ADD A,A
000D8C 4D8C ED6A            15      ADC HL,HL
000D8E 4D8E B7               4      OR  A
000D8F 4D8F C8              11      RET Z
000D90 4D90 23               6      INC HL
000D91 4D91 C9              10      RET
                                
       4D92                     SET_FCB:
000D92 4D92 D5              11      PUSH    DE
000D93 4D93 FDE1            14      POP IY
000D95 4D95 FD7E1C          19      LD  A,(IY+28)
000D98 4D98 FEFF             7      CP  0FFH
000D9A 4D9A 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D9C 4D9C E5              11      PUSH    HL
000D9D 4D9D FD6E1A          19      LD  L,(IY+26)
000DA0 4DA0 FD661B          19      LD  H,(IY+27)
000DA3 4DA3 22C1F2          16      LD  (_CLPS),HL
000DA6 4DA6 E1              10      POP HL
000DA7 4DA7 C9              10      RET
                                
       4DA8                     POPAF_SCF_FF_RET:
000DA8 4DA8 F1              10      POP AF
000DA9 4DA9 37               4      SCF
000DAA 4DAA 9F               4      SBC A,A
000DAB 4DAB C9              10      RET
                                
       4DAC                     GET_DIR_DAT:
000DAC 4DAC 2AE9F2          16      LD  HL,(_CDX)
000DAF 4DAF 7C               4      LD  A,H
000DB0 4DB0 B5               4      OR  L
000DB1 4DB1 2035            12      JR  NZ,GET_SUBDIR
000DB3 4DB3 CDC94D          17      CALL    GET_DIR_POS
000DB6 4DB6 C660             7      ADD A,high BANK1_ADR
000DB8 4DB8 2E00             7      LD  L,0
000DBA 4DBA 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
000DBB 4DBB CD934B          17      CALL    CHECK_DIR_PAGE
                                #endif
000DBE 4DBE 3AB8F2          13      LD  A,(_BANK1)
000DC1 4DC1 32E2F2          13      LD  (_DIR_BANK),A
                                
000DC4 4DC4 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000DC7 4DC7 4F               4      LD  C,A
000DC8 4DC8 C9              10      RET
                                
       4DC9                     GET_DIR_POS:                ;ルートディレクトリ
000DC9 4DC9 CD4151          17      CALL    GET_DISK_BANK_FDRV
000DCC 4DCC 32B8F2          13      LD  (_BANK1),A
000DCF 4DCF 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000DD2 4DD2 47               4      LD  B,A
000DD3 4DD3 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000DD6 4DD6 4F               4      LD  C,A
000DD7 4DD7 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DDA                     GET_DIR_POS1:
000DDA 4DDA 81               4      ADD A,C
000DDB 4DDB 10FD            13      DJNZ    GET_DIR_POS1
                                
000DDD 4DDD ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
000DE1 4DE1 37               4      SCF     ;無限ループ回避
       4DE2                     L_MDP:
000DE2 4DE2 CB18             8      RR  B   ;->CF
000DE4 4DE4 D8              11      RET C
000DE5 4DE5 87               4      ADD A,A
000DE6 4DE6 18FA            12      JR  L_MDP
                                
       4DE8                     GET_SUBDIR:             ;サブディレクトリ
000DE8 4DE8 CD074D          17      CALL    CLUST_HL
000DEB 4DEB EB               4      EX  DE,HL
000DEC 4DEC 3AB7F2          13      LD  A,(_BANK)
000DEF 4DEF 32E2F2          13      LD  (_DIR_BANK),A
000DF2 4DF2 3ABAF2          13      LD  A,(CLSZ_H)
000DF5 4DF5 87               4      ADD A,A     ;*2
000DF6 4DF6 87               4      ADD A,A     ;*4
000DF7 4DF7 87               4      ADD A,A     ;*8
000DF8 4DF8 4F               4      LD  C,A
000DF9 4DF9 C9              10      RET
                                
       4DFA                     STATEMENT:
000DFA 4DFA 11624F          10      LD  DE,STR_CHDIR
000DFD 4DFD CD484F          17      CALL    CPPROCNM
000E00 4E00 280A            12      JR  Z,_CHDIR
000E02 4E02 11684F          10      LD  DE,STR_RAMDISK
000E05 4E05 CD484F          17      CALL    CPPROCNM
000E08 4E08 2814            12      JR  Z,_RAMDISK
000E0A 4E0A 37               4      SCF
000E0B 4E0B C9              10      RET
       4E0C                     _CHDIR:
000E0C 4E0C 7E               7      LD  A,(HL)
000E0D 4E0D FE28             7      CP  '('
000E0F 4E0F 37               4      SCF
000E10 4E10 C0              11      RET NZ
000E11 4E11 CDDC46          17      CALL    INIT_PARAM
000E14 4E14 CDCF49          17      CALL    FILE_B
000E17 4E17 CD364E          17      CALL    ROM_CD
000E1A 4E1A DA9A45          10      JP  C,ERROR_FILE_NOT_FOUND
000E1D 4E1D C9              10      RET
                                
       4E1E                     _RAMDISK:
000E1E 4E1E 7E               7      LD  A,(HL)
000E1F 4E1F FE28             7      CP  '('
000E21 4E21 37               4      SCF
000E22 4E22 C0              11      RET NZ
000E23 4E23 23               6      INC HL
000E24 4E24 DD212F54        14      LD  IX,FRMQNT
000E28 4E28 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E2C 4E2C CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E2F 4E2F 7A               4      LD  A,D
000E30 4E30 B3               4      OR  E
000E31 4E31 C29445          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E34 4E34 23               6      INC HL
000E35 4E35 C9              10      RET
                                
       4E36                     ROM_CD:
000E36 4E36 3AECF2          13      LD  A,(FNAME)
000E39 4E39 FE20             7      CP  020H
000E3B 4E3B 2822            12      JR  Z,CD1
000E3D 4E3D CD4E4B          17      CALL    ROM_OPEN
000E40 4E40 D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0000BH   ;属性(アトリビュート)
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    POP DE
                                    BIT 4,A     ;ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    PUSH    DE
                                    LD  HL,(DIRENT1)
                                    LD  DE,0001AH   ;ファイルの先頭クラスタ
                                    ADD HL,DE
                                    CALL    RDSLT_ROM
                                    INC HL
                                    LD  E,A
                                    CALL    RDSLT_ROM
                                    LD  D,A
                                    EX  DE,HL
                                    POP DE
                                #else
000E41 4E41 FD2AE0F2        20      LD  IY,(DIRENT1)
000E45 4E45 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E49 4E49 CA9A45          10      JP  Z,ERROR_FILE_NOT_FOUND
000E4C 4E4C FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E4F 4E4F FD661B          19      LD  H,(IY+01BH)
                                #endif
       4E52                     CD2:
000E52 4E52 22DEF2          16      LD  (_CD),HL
000E55 4E55 2AE7F2          16      LD  HL,(PARAM1)
       4E58                     CD_SKIP:
000E58 4E58 7E               7      LD  A,(HL)
000E59 4E59 23               6      INC HL
000E5A 4E5A FE21             7      CP  021H
000E5C 4E5C 38FA            12      JR  C,CD_SKIP
000E5E 4E5E C9              10      RET
       4E5F                     CD1:
000E5F 4E5F 2AE9F2          16      LD  HL,(_CDX)
000E62 4E62 18EE            12      JR  CD2
                                
       4E64                     GET_BASIC_FCB:
000E64 4E64 D5              11      PUSH    DE
000E65 4E65 23               6      INC HL  ;+1
000E66 4E66 5E               7      LD  E,(HL)  ;FCB[1]
000E67 4E67 23               6      INC HL  ;+2
000E68 4E68 56               7      LD  D,(HL)  ;FCB[2]
000E69 4E69 23               6      INC HL  ;+3
000E6A 4E6A ED53E0F2        20      LD  (DIRENT1),DE
                                            ;FCB[3]
000E6E 4E6E 23               6      INC HL  ;+4
                                            ;FCB[4]
000E6F 4E6F 23               6      INC HL  ;+5
000E70 4E70 7E               7      LD  A,(HL)  ;FCB[5]
000E71 4E71 23               6      INC HL  ;+6
000E72 4E72 32E2F2          13      LD  (_DIR_BANK),A
000E75 4E75 5E               7      LD  E,(HL)  ;FCB[6]
000E76 4E76 23               6      INC HL  ;+7
000E77 4E77 56               7      LD  D,(HL)  ;FCB[7]
000E78 4E78 23               6      INC HL  ;+8
000E79 4E79 ED53BDF2        20      LD  (RR_LOW),DE
000E7D 4E7D 7E               7      LD  A,(HL)  ;FCB[8]
000E7E 4E7E 23               6      INC HL  ;+9
000E7F 4E7F 32BFF2          13      LD  (RR_HIGH),A
000E82 4E82 7E               7      LD  A,(HL)  ;FCB[9]
000E83 4E83 23               6      INC HL  ;+10
000E84 4E84 22C7F2          16      LD  (_DTA),HL   ;FCB[10]
000E87 4E87 D1              10      POP DE
000E88 4E88 C9              10      RET
                                
       4E89                     SET_BASIC_FCB:
000E89 4E89 E5              11      PUSH    HL
000E8A 4E8A 2A64F8          16      LD  HL,(PTRFIL)
000E8D 4E8D 23               6      INC HL  ;+1
000E8E 4E8E D5              11      PUSH    DE
000E8F 4E8F ED5BE0F2        20      LD  DE,(DIRENT1)
000E93 4E93 73               7      LD  (HL),E  ;FCB[1]
000E94 4E94 23               6      INC HL  ;+2
000E95 4E95 72               7      LD  (HL),D  ;FCB[2]
000E96 4E96 23               6      INC HL  ;+3
000E97 4E97 AF               4      XOR A
000E98 4E98 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
000E99 4E99 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
000E9A 4E9A 23               6      INC HL  ;+5
000E9B 4E9B 3AE2F2          13      LD  A,(_DIR_BANK)
000E9E 4E9E 77               7      LD  (HL),A  ;FCB[5]
000E9F 4E9F 23               6      INC HL  ;+6
000EA0 4EA0 ED5BBDF2        20      LD  DE,(RR_LOW)
000EA4 4EA4 73               7      LD  (HL),E  ;FCB[6]
000EA5 4EA5 23               6      INC HL  ;+7
000EA6 4EA6 72               7      LD  (HL),D  ;FCB[7]
000EA7 4EA7 23               6      INC HL  ;+8
000EA8 4EA8 3ABFF2          13      LD  A,(RR_HIGH)
000EAB 4EAB 77               7      LD  (HL),A  ;FCB[8]
000EAC 4EAC 23               6      INC HL  ;+9
000EAD 4EAD 3600            10      LD  (HL),0  ;FCB[9]
000EAF 4EAF D1              10      POP DE
000EB0 4EB0 E1              10      POP HL
000EB1 4EB1 C9              10      RET
                                
       4EB2                     DEVICE_CHECK:
000EB2 4EB2 11704F          10      LD  DE,STR_A
000EB5 4EB5 CD484F          17      CALL    CPPROCNM
000EB8 4EB8 280A            12      JR  Z,DEVICE_OK
000EBA 4EBA 11724F          10      LD  DE,STR_ROM
000EBD 4EBD CD484F          17      CALL    CPPROCNM
000EC0 4EC0 2802            12      JR  Z,DEVICE_OK
000EC2 4EC2 37               4      SCF
000EC3 4EC3 C9              10      RET
       4EC4                     DEVICE_OK:
000EC4 4EC4 AF               4      XOR A
000EC5 4EC5 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファインデックス
                                ; +10: バッファ
                                
       4EC6                     DEVICE_0_OPEN:
000EC6 4EC6 D5              11      PUSH    DE
000EC7 4EC7 E5              11      push    hl
                                ;
000EC8 4EC8 3E01             7      LD  A,1     ;ドライブA
000ECA 4ECA 32EBF2          13      LD  (FDRV),A
000ECD 4ECD 2166F8          10      LD  HL,FILNAM
000ED0 4ED0 11ECF2          10      LD  DE,FNAME
000ED3 4ED3 010B00          10      LD  BC,8+3
000ED6 4ED6 CD2255          17      CALL    INIT_FILE1
000ED9 4ED9 CD4E4B          17      CALL    ROM_OPEN
000EDC 4EDC DA9A45          10      JP  C,ERROR_FILE_NOT_FOUND
000EDF 4EDF E1              10      pop hl
000EE0 4EE0 D1              10      POP DE
000EE1 4EE1 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
000EE4 4EE4 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
000EE5 4EE5 AF               4      XOR A
000EE6 4EE6 32E3F2          13      LD  (LEFTX),A
000EE9 4EE9 CD894E          17      CALL    SET_BASIC_FCB
000EEC 4EEC 7B               4      ld  a,e
000EED 4EED FE08             7      cp  8
000EEF 4EEF 3F               4      ccf
000EF0 4EF0 C9              10      ret
                                
       4EF1                     DEVICE_2_CLOSE:
000EF1 4EF1 AF               4      XOR A
                                ;   LD  (HL),A
000EF2 4EF2 6F               4      LD  L,A
000EF3 4EF3 67               4      LD  H,A
000EF4 4EF4 2264F8          16      LD  (PTRFIL),HL
000EF7 4EF7 C9              10      RET
                                
       4EF8                     DEVICE_ENTRY:
000EF8 4EF8 FE08             7      CP  8
000EFA 4EFA 280C            12      JR  Z,DEVICE_8_SIN
000EFC 4EFC 3C               4      INC A
000EFD 4EFD 28B3            12      JR  Z,DEVICE_CHECK:
000EFF 4EFF 3D               4      DEC A
000F00 4F00 28C4            12      JR  Z,DEVICE_0_OPEN
000F02 4F02 FE02             7      CP  2
000F04 4F04 28EB            12      JR  Z,DEVICE_2_CLOSE
000F06 4F06 37               4      SCF
000F07 4F07 C9              10      RET
                                
       4F08                     DEVICE_8_SIN:
000F08 4F08 CD644E          17      CALL    GET_BASIC_FCB
000F0B 4F0B E67F             7      AND 127
000F0D 4F0D 281D            12      JR  Z,SIN_READ_DISK
000F0F 4F0F 2AC7F2          16      LD  HL,(_DTA)
000F12 4F12 2B               6      DEC HL
000F13 4F13 34              11      INC (HL)
000F14 4F14 3C               4      INC A   ;(INC HL)
000F15 4F15 85               4      ADD A,L ;ADD HL,A
000F16 4F16 6F               4      LD  L,A ;
000F17 4F17 8C               4      ADC A,H ;
000F18 4F18 95               4      SUB L   ;
000F19 4F19 67               4      LD  H,A ;
       4F1A                     SIN_READ1:
000F1A 4F1A 7E               7      LD  A,(HL)
000F1B 4F1B FE0A             7      CP  00AH
000F1D 4F1D C8              11      RET Z   ;ZF=separate
000F1E 4F1E FE1A             7      CP  01AH
000F20 4F20 2803            12      JR  Z,SIN_EOF
000F22 4F22 37               4      SCF
000F23 4F23 3F               4      CCF     ;ZF=0 CF=0にしたい
000F24 4F24 C9              10      RET
       4F25                     SIN_EOF:
000F25 4F25 2AC7F2          16      LD  HL,(_DTA)
000F28 4F28 2B               6      DEC HL
000F29 4F29 35              11      DEC (HL)
       4F2A                     SCF_RET:
000F2A 4F2A 37               4      SCF
000F2B 4F2B C9              10      RET
                                
       4F2C                     SIN_READ_DISK:
000F2C 4F2C 218000          10      LD  HL,128
000F2F 4F2F CD2E49          17      CALL    ROM_READ
000F32 4F32 CD894E          17      CALL    SET_BASIC_FCB
000F35 4F35 7C               4      LD  A,H
000F36 4F36 B5               4      OR  L
000F37 4F37 28F1            12      JR  Z,SCF_RET
000F39 4F39 ED5BC7F2        20      LD  DE,(_DTA)
000F3D 4F3D 19              11      ADD HL,DE
000F3E 4F3E 361A            10      LD  (HL),01AH
000F40 4F40 2AC7F2          16      LD  HL,(_DTA)
000F43 4F43 2B               6      DEC HL
000F44 4F44 34              11      INC (HL)
000F45 4F45 23               6      INC HL
000F46 4F46 18D2            12      JR  SIN_READ1
                                
       4F48                     CPPROCNM:
000F48 4F48 E5              11      PUSH    HL
000F49 4F49 2189FD          10      LD  HL,PROCNM
       4F4C                     CPPROCNM1:
000F4C 4F4C 1A               7      LD  A,(DE)
000F4D 4F4D 13               6      INC DE
000F4E 4F4E BE               7      CP  (HL)
000F4F 4F4F 23               6      INC HL
000F50 4F50 2003            12      JR  NZ,CPPROCNM2
000F52 4F52 B7               4      OR  A
000F53 4F53 20F7            12      JR  NZ,CPPROCNM1
       4F55                     CPPROCNM2:
000F55 4F55 E1              10      POP HL
000F56 4F56 C9              10      RET
                                
       4F57                     WILDCARD:
000F57 4F57 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4F62                     STR_CHDIR:
000F62 4F62 434844495200            DB  "CHDIR",0
       4F68                     STR_RAMDISK:
000F68 4F68 52414D4449534B00        DB  "RAMDISK",0
       4F70                     STR_A:
000F70 4F70 4100                    DB  "A",0
       4F72                     STR_ROM:
000F72 4F72 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4F76                     ERROR_WRITE_PROTECTED:
000F76 4F76 3E00             7      LD  A,0     ;Write protected
000F78 4F78 C9              10      RET
       4F79                     DISKIO:
000F79 4F79 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000F7B 4F7B 48               4      LD  C,B
000F7C 4F7C CD4B51          17      CALL    GET_DISK_BANK
       4F7F                     SETMAP1:        
000F7F 4F7F E5              11      PUSH    HL
       4F80                     DISKIO1:
000F80 4F80 C5              11      PUSH    BC      ;B=残りのセクタ数
000F81 4F81 D5              11      PUSH    DE      ;DE=セクタ番号
000F82 4F82 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000F83 4F83 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000F84 4F84 F5              11      PUSH    AF
000F85 4F85 3ABCF2          13      LD  A,(SECSZ_H)
000F88 4F88 CD6D51          17      CALL    MUL_AHL
000F8B 4F8B F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000F8C 4F8C 4D               4      LD  C,L     ;C=読み出し元
000F8D 4F8D 29              11      ADD HL,HL       ;64KB→32KB
000F8E 4F8E 29              11      ADD HL,HL       ;32KB→16KB
000F8F 4F8F 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000F90 4F90 84               4      ADD A,H
000F91 4F91 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000F94 4F94 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000F97 4F97 32B7F2          13      LD  (_BANK),A
000F9A 4F9A 79               4      LD  A,C     ;C=読み出し元
000F9B 4F9B E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4F9D                     DISKIO2:
000F9D 4F9D C660             7      ADD A,high BANK1_ADR
000F9F 4F9F 67               4      LD  H,A
000FA0 4FA0 ED4BBBF2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000FA4 4FA4 69               4      LD  L,C     ;C=0
000FA5 4FA5 CDFE43          17      CALL    ROM_LDIR
000FA8 4FA8 EB               4      EX  DE,HL
000FA9 4FA9 F1              10      POP AF
000FAA 4FAA D1              10      POP DE
000FAB 4FAB 13               6      INC DE
000FAC 4FAC C1              10      POP BC
000FAD 4FAD 10D1            13      DJNZ    DISKIO1
000FAF 4FAF 41               4      LD  B,C
                                
000FB0 4FB0 E1              10      POP HL
000FB1 4FB1 AF               4      XOR A
                                
000FB2 4FB2 FB               4      EI
000FB3 4FB3 C9              10      RET
                                
       4FB4                     DSKCHG:
000FB4 4FB4 CDED4F          17      CALL    IS_BPB
000FB7 4FB7 3824            12      JR  C,NOTREADY
000FB9 4FB9 3A23FB          13      LD  A,(DRVTBL+2)
000FBC 4FBC B7               4      OR  A
000FBD 4FBD 201A            12      JR  NZ,DSKCHG1
000FBF 4FBF 3A21FB          13      LD  A,(DRVTBL)
000FC2 4FC2 FE02             7      CP  2
000FC4 4FC4 2013            12      JR  NZ,DSKCHG1
000FC6 4FC6 CDED4F          17      CALL    IS_BPB
000FC9 4FC9 300E            12      JR  NC,DSKCHG1
000FCB 4FCB 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000FCD 4FCD 3221FB          13      LD  (DRVTBL),A
000FD0 4FD0 3223FB          13      LD  (DRVTBL+2),A
000FD3 4FD3 3A48F3          13      LD  A,(MASTERS)
000FD6 4FD6 3224FB          13      LD  (DRVTBL+3),A
       4FD9                     DSKCHG1:
000FD9 4FD9 AF               4      XOR A
000FDA 4FDA 0601             7      LD  B,1
000FDC 4FDC C9              10      RET
       4FDD                     NOTREADY:
000FDD 4FDD 3E02             7      LD  A,2
000FDF 4FDF 37               4      SCF
000FE0 4FE0 C9              10      RET
                                
       4FE1                     NO_BPB:
000FE1 4FE1 E1              10      POP HL
000FE2 4FE2 23               6      INC HL
000FE3 4FE3 117351          10      LD  DE,DPB2DD
000FE6 4FE6 011200          10      LD  BC,DPB2DD_E-DPB2DD
000FE9 4FE9 EDB0                    LDIR
000FEB 4FEB AF               4      XOR A
000FEC 4FEC C9              10      RET
                                
       4FED                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000FED 4FED CD4B51          17      CALL    GET_DISK_BANK
                                
000FF0 4FF0 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000FF3 4FF3 FE01             7      CP  1
000FF5 4FF5 D8              11      RET C
                                
000FF6 4FF6 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000FF9 4FF9 C6FF             7      ADD A,0FFH
000FFB 4FFB D8              11      RET C
                                
000FFC 4FFC 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       4FFF                     IS_BPB1:
000FFF 4FFF FE01             7      CP  1
001001 5001 C8              11      RET Z
001002 5002 FE02             7      CP  2
001004 5004 C8              11      RET Z
001005 5005 FE04             7      CP  4
001007 5007 C8              11      RET Z
001008 5008 37               4      SCF
001009 5009 C9              10      RET
                                
       500A                     GETDPB:
00100A 500A E5              11      PUSH    HL
00100B 500B CD4B51          17      CALL    GET_DISK_BANK
                                
00100E 500E 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
001011 5011 B7               4      OR  A
001012 5012 28CD            12      JR  Z,NO_BPB
001014 5014 DDE1            14      POP IX
001016 5016 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
001019 5019 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
00101C 501C DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
00101F 501F 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
001022 5022 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
001025 5025 87               4      ADD A,A
001026 5026 87               4      ADD A,A
001027 5027 87               4      ADD A,A
001028 5028 3D               4      DEC A
001029 5029 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
00102C 502C 06FF             7      LD  B,-1
00102E 502E A7               4      AND A           ;無限ループ阻止
       502F                     GETDPB1:
00102F 502F 04               4      INC B
001030 5030 1F               4      RRA
001031 5031 38FC            12      JR  C,GETDPB1
001033 5033 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
001036 5036 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001039 5039 3D               4      DEC A
00103A 503A DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
00103D 503D A7               4      AND A           ;無限ループ阻止
00103E 503E 06FF             7      LD  B,-1
       5040                     GETDPB2:
001040 5040 04               4      INC B
001041 5041 1F               4      RRA
001042 5042 38FC            12      JR  C,GETDPB2
001044 5044 04               4      INC B
001045 5045 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
001048 5048 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
00104B 504B DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
00104E 504E DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
001051 5051 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
001054 5054 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
001057 5057 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
00105A 505A DD770B          19      LD  (IX+11),A       ;MAXENT
                                
00105D 505D ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
001061 5061 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
001064 5064 DD460A          19      LD  B,(IX+10)       ;FATCNT
001067 5067 210000          10      LD  HL,0
       506A                     GETDPB3:
00106A 506A 19              11      ADD HL,DE
00106B 506B 10FD            13      DJNZ    GETDPB3
       506D                     GETDPB4:
00106D 506D DD5E08          19      LD  E,(IX+8)        ;FIRFAT
001070 5070 DD5609          19      LD  D,(IX+9)        ;FIRFAT
001073 5073 19              11      ADD HL,DE
001074 5074 DD7511          19      LD  (IX+17),L       ;FIRDIR
001077 5077 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
00107A 507A DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00107D 507D 87               4      ADD A,A
00107E 507E 87               4      ADD A,A
00107F 507F DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5082                     GETDPB5:
001082 5082 CB3B             8      SRL E
001084 5084 1F               4      RRA
001085 5085 30FB            12      JR  NC,GETDPB5
001087 5087 1600             7      LD  D,0
001089 5089 19              11      ADD HL,DE
00108A 508A DD750C          19      LD  (IX+12),L       ;FIRREC
00108D 508D DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001090 5090 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
001093 5093 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
001096 5096 DD560D          19      LD  D,(IX+13)       ;FIRREC
001099 5099 A7               4      AND A
00109A 509A ED52            15      SBC HL,DE
                                
00109C 509C DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
00109F 509F 3C               4      INC A
0010A0 50A0 37               4      SCF             ;無限ループ阻止
       50A1                     GETDPB6:
0010A1 50A1 1F               4      RRA
0010A2 50A2 3806            12      JR  C,GETDPB7
0010A4 50A4 CB3C             8      SRL H
0010A6 50A6 CB1D             8      RR  L
0010A8 50A8 18F7            12      JR  GETDPB6
       50AA                     GETDPB7:
0010AA 50AA 23               6      INC HL
0010AB 50AB DD750E          19      LD  (IX+14),L       ;MAXCLUS
0010AE 50AE DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       50B1                     GETDPBD1:
0010B1 50B1 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0010B4 50B4 E6FC             7      AND 0FCH
0010B6 50B6 C8              11      RET Z
                                
0010B7 50B7 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
0010BB 50BB 37               4      SCF
0010BC 50BC DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
0010C0 50C0 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
0010C3 50C3 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
0010C7 50C7 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
0010CB 50CB DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
0010CF 50CF DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
0010D3 50D3 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
0010D7 50D7 DDCB1126        23      SLA (IX+17)         ;FIRDIR
0010DB 50DB DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
0010DF 50DF DD6E11          19      LD  L,(IX+17)       ;FIRDIR
0010E2 50E2 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
0010E5 50E5 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0010E8 50E8 87               4      ADD A,A
0010E9 50E9 87               4      ADD A,A
0010EA 50EA DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       50ED                     GETDPBD5:
0010ED 50ED CB3B             8      SRL E
0010EF 50EF 1F               4      RRA
0010F0 50F0 30FB            12      JR  NC,GETDPBD5
0010F2 50F2 1600             7      LD  D,0
0010F4 50F4 19              11      ADD HL,DE
0010F5 50F5 DD750C          19      LD  (IX+12),L       ;FIRREC
0010F8 50F8 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
0010FB 50FB 18B4            12      JR  GETDPBD1
                                
       50FD                     CHOICE:
0010FD 50FD 210000          10      LD  HL,0
001100 5100 C9              10      RET
                                
       5101                     DSKFMT:
001101 5101 AF               4      XOR A
001102 5102 37               4      SCF
       5103                     DSKSTP:
001103 5103 C9              10      RET
                                
       5104                     BASENT:
001104 5104 2A74F6          16      LD  HL,(STKTOP)
001107 5107 3A40F3          13      LD  A,(REBOOT)
00110A 510A C6FF             7      ADD A,0FFH
00110C 510C 3811            12      JR  C,REBOOT1
00110E 510E 218551          10      LD  HL,AUTOEXEC
001111 5111 11EBF2          10      LD  DE,FDRV
001114 5114 010C00          10      LD  BC,1+8+3
001117 5117 EDB0                    LDIR
001119 5119 CD4E4B          17      CALL    ROM_OPEN
00111C 511C D42645          17      CALL    NC,ROM_LOAD1
       511F                     REBOOT1:
00111F 511F 219151          10      LD  HL,CMD_RUN
001122 5122 111FF4          10      LD  DE,KBUF
001125 5125 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
001128 5128 D5              11      PUSH    DE
001129 5129 EDB0                    LDIR
00112B 512B 3004            12      JR  NC,REBOOT2
00112D 512D AF               4      XOR A
00112E 512E 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       5131                     REBOOT2:
001131 5131 E1              10      POP HL
001132 5132 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001136 5136 DD210146        14      LD  IX,NEWSTT
00113A 513A C31C00          10      JP  _CALSLT
                                
       513D                     GETSLT:
00113D 513D 3A22FB          13      LD  A,(DRVTBL+1)
001140 5140 C9              10      RET
                                
       5141                     GET_DISK_BANK_FDRV:
001141 5141 3AEBF2          13      LD  A,(FDRV)
001144 5144 D601             7      SUB 1
001146 5146 3003            12      JR  NC,GET_DISK_BANK
001148 5148 3ADDF2          13      LD  A,(_DVSW)
       514B                     GET_DISK_BANK:
00114B 514B B7               4      OR  A       ;A=DRIVE
00114C 514C 3E01             7      LD  A,DISK_BANK
00114E 514E 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001150 5150 3ADCF2          13      LD  A,(B_DRIVE)
                                #endif
       5153                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
001153 5153 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001156 5156 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001159 5159 F5              11      PUSH    AF
00115A 515A E5              11      PUSH    HL
00115B 515B 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
00115E 515E 22BBF2          16      LD  (SECSZ),HL
001161 5161 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001164 5164 CD6D51          17      CALL    MUL_AHL
001167 5167 22B9F2          16      LD  (CLSZ),HL
00116A 516A E1              10      POP HL
00116B 516B F1              10      POP AF
00116C 516C C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       516D                     MUL_AHL:
00116D 516D 37               4      SCF     ;無限ループ回避
       516E                     MUL_AHL1:
00116E 516E 1F               4      RRA     ;->CF
00116F 516F D8              11      RET C
001170 5170 29              11      ADD HL,HL
001171 5171 18FB            12      JR  MUL_AHL1
                                
       5173                     DPB2DD:
001173 5173 F9                      DB  0F9H    ;MEDIA
001174 5174 0002                    DW  00200H  ;SECSIZ
001176 5176 0F                      DB  00FH    ;DIRMSK
001177 5177 04                      DB  004H    ;DIRSHFT
001178 5178 01                      DB  001H    ;CLUSMSK
001179 5179 02                      DB  002H    ;CLUSSHFT
00117A 517A 0100                    DW  00001H  ;FIRFAT
00117C 517C 02                      DB  002H    ;FATCNT
00117D 517D 70                      DB  070H    ;MAXENT
00117E 517E 0E00                    DW  0000EH  ;FIRREC
001180 5180 CA02                    DW  002CAH  ;MAXCLUS
001182 5182 03                      DB  003H    ;FATSIZ
001183 5183 0700                    DW  0007H   ;FIRDIR
       5185                     DPB2DD_E:
                                
       5185                     AUTOEXEC:
001185 5185 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       5191                     CMD_RUN:
001191 5191 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    DW  0F280H
                                #else
001197 5197 40F2                    DW  0F240H
                                #endif
       5199                     CMD_CLEAR_E:
001199 5199 3A8A00                  DB  03AH,08AH,0         ;RUN
       519C                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       519C                     POP_HL_ERROR:
00119C 519C E1              10      POP     HL
       519D                     _ERROR:
00119D 519D 0600             7      LD  B,0
00119F 519F A7               4      AND A
0011A0 51A0 C9              10      RET
                                
       51A1                     ROM_BDOS:
0011A1 51A1 E5              11      PUSH    HL
0011A2 51A2 79               4      LD  A,C
0011A3 51A3 87               4      ADD A,A
0011A4 51A4 38F7            12      JR  C,_ERROR
0011A6 51A6 6F               4      LD  L,A
0011A7 51A7 265F             7      LD  H,high STABLE
0011A9 51A9 7E               7      LD  A,(HL)
0011AA 51AA 2C               4      INC L
0011AB 51AB 66               7      LD  H,(HL)
0011AC 51AC 6F               4      LD  L,A
0011AD 51AD E3              19      EX  (SP),HL
0011AE 51AE 79               4      LD  A,C
0011AF 51AF C9              10      RET
                                
       51B0                     _PRINT:
       51B0                     PRINT:
0011B0 51B0 7B               4      LD  A,E
0011B1 51B1 1803            12      JR  MSG_A
                                
       51B3                     _SYS01:     ;(BDOS)コンソール入力
0011B3 51B3 CD2A52          17      CALL    _SYS07
       51B6                     MSG_A:
0011B6 51B6 FE03             7      CP  3
0011B8 51B8 2814            12      JR  Z,MSG_BR
       51BA                     MSGA1:
0011BA 51BA F5              11      PUSH    AF
0011BB 51BB C5              11      PUSH    BC
0011BC 51BC D5              11      PUSH    DE
0011BD 51BD E5              11      PUSH    HL
0011BE 51BE DDE5            15      PUSH    IX
0011C0 51C0 DD21A200        14      LD  IX,CHPUT
0011C4 51C4 CDD442          17      CALL    CALSLT_R
0011C7 51C7 DDE1            14      POP IX
0011C9 51C9 E1              10      POP HL
0011CA 51CA D1              10      POP DE
0011CB 51CB C1              10      POP BC
       51CC                     MSGA2:
0011CC 51CC F1              10      POP AF
0011CD 51CD C9              10      RET
       51CE                     MSG_BR:
0011CE 51CE F5              11      PUSH    AF
0011CF 51CF 3ADDF3          13      LD  A,(CSRX)
0011D2 51D2 FE02             7      CP  2
0011D4 51D4 38F6            12      JR  C,MSGA2
0011D6 51D6 F1              10      POP AF
       51D7                     MSG_CR:
0011D7 51D7 F5              11      PUSH    AF
0011D8 51D8 3E0D             7      LD  A,00DH
0011DA 51DA CDBA51          17      CALL    MSGA1
0011DD 51DD 3E0A             7      LD  A,00AH
0011DF 51DF CDBA51          17      CALL    MSGA1
0011E2 51E2 F1              10      POP AF
0011E3 51E3 C9              10      RET
                                
       51E4                     _SYS02:     ;(BDOS)コンソール出力
0011E4 51E4 CDFF51          17      CALL    BREAK
0011E7 51E7 1805            12      JR  PRINTX
                                
       51E9                     _SYS06:     ;(BDOS)コンソール直接入出力
0011E9 51E9 7B               4      LD  A,E
0011EA 51EA 3C               4      INC A
0011EB 51EB CA3E52          10      JP  Z,_INKEY
       51EE                     PRINTX:
0011EE 51EE C3B051          10      JP  _PRINT
                                
       51F1                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0011F1 51F1 CD2A52          17      CALL    _SYS07
0011F4 51F4 FE03             7      CP  3
0011F6 51F6 CCFF51          17      CALL    Z,_BREAK
0011F9 51F9 FE13             7      CP  013H        ;CTRL+S
0011FB 51FB C0              11      RET NZ
       51FC                     PAUSE:
0011FC 51FC CD1652          17      CALL    KEYBC
                                
       51FF                     _BREAK:
       51FF                     BREAK:
0011FF 51FF F5              11      PUSH    AF
001200 5200 C5              11      PUSH    BC
001201 5201 D5              11      PUSH    DE
001202 5202 E5              11      PUSH    HL
001203 5203 DDE5            15      PUSH    IX
001205 5205 DD21B700        14      LD  IX,BREAKX
001209 5209 CDD442          17      CALL    CALSLT_R
00120C 520C DDE1            14      POP IX
00120E 520E E1              10      POP HL
00120F 520F D1              10      POP DE
001210 5210 C1              10      POP BC
001211 5211 DCFF51          17      CALL    C,_BREAK
001214 5214 F1              10      POP AF
001215 5215 C9              10      RET
       5216                     KEYBC:
001216 5216 F5              11      PUSH    AF
001217 5217 C5              11      PUSH    BC
001218 5218 D5              11      PUSH    DE
001219 5219 E5              11      PUSH    HL
00121A 521A DDE5            15      PUSH    IX
00121C 521C DD215601        14      LD  IX,KILBUF
001220 5220 CDD442          17      CALL    CALSLT_R
001223 5223 DDE1            14      POP IX
001225 5225 E1              10      POP HL
001226 5226 D1              10      POP DE
001227 5227 C1              10      POP BC
001228 5228 F1              10      POP AF
001229 5229 C9              10      RET
                                
       522A                     _SYS07:
       522A                     FLGET:
00122A 522A C5              11      PUSH    BC
00122B 522B D5              11      PUSH    DE
00122C 522C E5              11      PUSH    HL
00122D 522D DDE5            15      PUSH    IX
00122F 522F DD219F00        14      LD  IX,CHGET
001233 5233 CDD442          17      CALL    CALSLT_R
001236 5236 DDE1            14      POP IX
001238 5238 E1              10      POP HL
001239 5239 D1              10      POP DE
00123A 523A C1              10      POP BC
00123B 523B FE03             7      CP  3
00123D 523D C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       523E                     _INKEY:
       523E                     INKEY:
00123E 523E CDD852          17      CALL    CPM_CONST
001241 5241 C8              11      RET Z
001242 5242 18E6            12      JR  FLGET
                                
       5244                     _SYS0A:     ;(BDOS)文字列入力
001244 5244 C5              11      PUSH    BC
001245 5245 E5              11      PUSH    HL
001246 5246 D5              11      PUSH    DE
001247 5247 CD7052          17      CALL    GETL
00124A 524A 111FF4          10      LD  DE,KBUF
00124D 524D E1              10      POP HL
00124E 524E E5              11      PUSH    HL
00124F 524F 0E00             7      LD  C,0
001251 5251 3004            12      JR  NC,SAX0
001253 5253 23               6      INC HL
001254 5254 23               6      INC HL
001255 5255 1808            12      JR  SAX4
       5257                     SAX0:
001257 5257 46               7      LD  B,(HL)
001258 5258 23               6      INC HL
       5259                     SAX1:
001259 5259 23               6      INC HL
00125A 525A 1A               7      LD  A,(DE)
00125B 525B 13               6      INC DE
00125C 525C B7               4      OR  A
00125D 525D 2004            12      JR  NZ,SAX2
       525F                     SAX4:
00125F 525F 360D            10      LD  (HL),00DH
001261 5261 1804            12      JR  SAX3
       5263                     SAX2:
001263 5263 77               7      LD  (HL),A
001264 5264 0C               4      INC C
001265 5265 10F2            13      DJNZ    SAX1
       5267                     SAX3:
001267 5267 D1              10      POP DE
001268 5268 79               4      LD  A,C
001269 5269 13               6      INC DE
00126A 526A 12               7      LD  (DE),A
00126B 526B 1B               6      DEC DE
00126C 526C E1              10      POP HL
00126D 526D C1              10      POP BC
00126E 526E A7               4      AND A
00126F 526F C9              10      RET
       5270                     GETL:
001270 5270 DDE5            15      PUSH    IX
001272 5272 FDE5            15      PUSH    IY
                                
001274 5274 2ADCF3          16      LD  HL,(CSRY)
001277 5277 22CAFB          16      LD  (FSTPOS),HL
       527A                     GETL1:
00127A 527A CDF151          17      CALL    _SYS08
00127D 527D FE09             7      CP  9
00127F 527F 2008            12      JR  NZ,GETL1V
001281 5281 211FF4          10      LD  HL,KBUF
001284 5284 CD5E43          17      CALL    MSX
001287 5287 18F1            12      JR  GETL1
       5289                     GETL1V:
001289 5289 5F               4      LD  E,A
00128A 528A FE08             7      CP  8
00128C 528C CC2653          17      CALL    Z,CTRL02
00128F 528F FE20             7      CP  020H
001291 5291 D45253          17      CALL    NC,INSERT
001294 5294 CDBA51          17      CALL    MSGA1
                                
001297 5297 7B               4      LD  A,E
001298 5298 FE0D             7      CP  00DH
00129A 529A 20DE            12      JR  NZ,GETL1
                                
00129C 529C 111FF4          10      LD  DE,KBUF
00129F 529F 3AB0F3          13      LD  A,(LINLEN)
0012A2 52A2 47               4      LD  B,A
0012A3 52A3 CD3455          17      CALL    ZERO_MEMORY_DE
                                
0012A6 52A6 2ACAFB          16      LD  HL,(FSTPOS)
0012A9 52A9 3ADCF3          13      LD  A,(CSRY)
0012AC 52AC 6F               4      LD  L,A
0012AD 52AD E5              11      PUSH    HL
0012AE 52AE CD8353          17      CALL    LOC0
0012B1 52B1 4D               4      LD  C,L
0012B2 52B2 44               4      LD  B,H
0012B3 52B3 E1              10      POP HL
0012B4 52B4 3AB0F3          13      LD  A,(LINLEN)
0012B7 52B7 94               4      SUB H
0012B8 52B8 3D               4      DEC A
0012B9 52B9 5F               4      LD  E,A
0012BA 52BA 211FF4          10      LD  HL,KBUF
       52BD                     GETL2:
0012BD 52BD CD1653          17      CALL    _SCRN
0012C0 52C0 03               6      INC BC
0012C1 52C1 77               7      LD  (HL),A
0012C2 52C2 23               6      INC HL
0012C3 52C3 1D               4      DEC E
0012C4 52C4 20F7            12      JR  NZ,GETL2
0012C6 52C6 CDD751          17      CALL    MSG_CR
                                
0012C9 52C9 FDE1            14      POP IY
0012CB 52CB DDE1            14      POP IX
       52CD                     GETL3:
0012CD 52CD 2B               6      DEC HL
0012CE 52CE 7E               7      LD  A,(HL)
0012CF 52CF FE21             7      CP  021H
0012D1 52D1 D0              11      RET NC
0012D2 52D2 3600            10      LD  (HL),0
0012D4 52D4 15               4      DEC D
0012D5 52D5 20F6            12      JR  NZ,GETL3
0012D7 52D7 C9              10      RET
                                
       52D8                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       52D8                     CONSTX:
       52D8                     CPM_CONST:
0012D8 52D8 C5              11      PUSH    BC
0012D9 52D9 D5              11      PUSH    DE
0012DA 52DA E5              11      PUSH    HL
0012DB 52DB DDE5            15      PUSH    IX
0012DD 52DD DD219C00        14      LD  IX,CHSNS
0012E1 52E1 CDD442          17      CALL    CALSLT_R
0012E4 52E4 DDE1            14      POP IX
0012E6 52E6 E1              10      POP HL
0012E7 52E7 D1              10      POP DE
0012E8 52E8 C1              10      POP BC
0012E9 52E9 C9              10      RET
                                
       52EA                     _SYS2A:     ;(BDOS)日付の獲得
0012EA 52EA AF               4      XOR A
0012EB 52EB 57               4      LD  D,A
0012EC 52EC 5F               4      LD  E,A
0012ED 52ED 67               4      LD  H,A
0012EE 52EE 6F               4      LD  L,A
0012EF 52EF C9              10      RET
                                
       52F0                     _SYS2C:     ;(BDOS)時刻の獲得
0012F0 52F0 AF               4      XOR A
0012F1 52F1 57               4      LD  D,A
0012F2 52F2 5F               4      LD  E,A
0012F3 52F3 67               4      LD  H,A
0012F4 52F4 6F               4      LD  L,A
0012F5 52F5 C9              10      RET
                                
       52F6                     POS:
0012F6 52F6 F5              11      PUSH    AF
0012F7 52F7 2ADCF3          16      LD  HL,(CSRY)
0012FA 52FA 7D               4      LD  A,L
0012FB 52FB 6C               4      LD  L,H
0012FC 52FC 67               4      LD  H,A
0012FD 52FD 2C               4      INC L
0012FE 52FE 24               4      INC H
0012FF 52FF F1              10      POP AF
001300 5300 C9              10      RET
                                
       5301                     LOC:
001301 5301 F5              11      PUSH    AF
001302 5302 E5              11      PUSH    HL
001303 5303 7D               4      LD  A,L
001304 5304 6C               4      LD  L,H
001305 5305 67               4      LD  H,A
001306 5306 2D               4      DEC L
001307 5307 25               4      DEC H
001308 5308 DDE5            15      PUSH    IX
00130A 530A DD21C600        14      LD  IX,POSIT
00130E 530E CDD442          17      CALL    CALSLT_R
001311 5311 DDE1            14      POP IX
001313 5313 E1              10      POP HL
001314 5314 F1              10      POP AF
001315 5315 C9              10      RET
                                
       5316                     _SCRN:
       5316                     SCRN:
001316 5316 E5              11      PUSH    HL
001317 5317 DDE5            15      PUSH    IX
                                
001319 5319 69               4      LD  L,C
00131A 531A 60               4      LD  H,B
00131B 531B DD214A00        14      LD  IX,RDVRM
00131F 531F CDD442          17      CALL    CALSLT_R
                                
001322 5322 DDE1            14      POP IX
001324 5324 E1              10      POP HL
001325 5325 C9              10      RET
                                
       5326                     CTRL02:
001326 5326 F5              11      PUSH    AF
001327 5327 D5              11      PUSH    DE
001328 5328 2ADCF3          16      LD  HL,(CSRY)
00132B 532B 3AB0F3          13      LD  A,(LINLEN)
00132E 532E 4F               4      LD  C,A
00132F 532F 94               4      SUB H   ;CSRX
001330 5330 C602             7      ADD A,2
001332 5332 47               4      LD  B,A ;カーソルより右の文字数
001333 5333 61               4      LD  H,C ;LINLEN
001334 5334 C5              11      PUSH    BC
001335 5335 CD8353          17      CALL    LOC0
001338 5338 C1              10      POP BC
                                
001339 5339 1620             7      LD  D,020H
       533B                     C8X1:
00133B 533B DD214A00        14      LD  IX,RDVRM
00133F 533F CDD442          17      CALL    CALSLT_R
001342 5342 4F               4      LD  C,A
001343 5343 7A               4      LD  A,D
001344 5344 DD214D00        14      LD  IX,WRTVRM
001348 5348 CDD442          17      CALL    CALSLT_R
00134B 534B 2B               6      DEC HL
00134C 534C 51               4      LD  D,C
00134D 534D 10EC            13      DJNZ    C8X1
00134F 534F D1              10      POP DE
001350 5350 F1              10      POP AF
001351 5351 C9              10      RET
                                
       5352                     INSERT:
001352 5352 F5              11      PUSH    AF
001353 5353 D5              11      PUSH    DE
001354 5354 2ADCF3          16      LD  HL,(CSRY)
001357 5357 3AB0F3          13      LD  A,(LINLEN)
00135A 535A 4F               4      LD  C,A
00135B 535B 94               4      SUB H   ;CSRX
00135C 535C 3C               4      INC A
00135D 535D 47               4      LD  B,A ;カーソルより右の文字数
00135E 535E C5              11      PUSH    BC
00135F 535F CD8353          17      CALL    LOC0
001362 5362 C1              10      POP BC
                                
001363 5363 1620             7      LD  D,020H
       5365                     INS1:
001365 5365 DD214A00        14      LD  IX,RDVRM
001369 5369 CDD442          17      CALL    CALSLT_R
00136C 536C 4F               4      LD  C,A
00136D 536D 7A               4      LD  A,D
00136E 536E DD214D00        14      LD  IX,WRTVRM
001372 5372 CDD442          17      CALL    CALSLT_R
001375 5375 23               6      INC HL
001376 5376 51               4      LD  D,C
001377 5377 10EC            13      DJNZ    INS1
001379 5379 D1              10      POP DE
00137A 537A F1              10      POP AF
00137B 537B C9              10      RET
                                
       537C                     CONOUT1:
00137C 537C 59               4      LD  E,C
00137D 537D C3B051          10      JP  _PRINT
                                
       5380                     GETVRAM:
001380 5380 2ADCF3          16      LD  HL,(CSRY)
       5383                     LOC0:
001383 5383 2D               4      DEC L
001384 5384 25               4      DEC H
001385 5385 4C               4      LD  C,H ;CSRX-1
001386 5386 5D               4      LD  E,L ;CSRY-1
       5387                     LOC1:
001387 5387 3AB0F3          13      LD  A,(LINLEN)
00138A 538A 67               4      LD  H,A
00138B 538B 1600             7      LD  D,0
00138D 538D 6A               4      LD  L,D ;0
00138E 538E 0608             7      LD  B,8
       5390                     LOC2:
001390 5390 29              11      ADD HL,HL
001391 5391 3001            12      JR  NC,LOC3
001393 5393 19              11      ADD HL,DE
       5394                     LOC3:
001394 5394 10FA            13      DJNZ    LOC2
001396 5396 09              11      ADD HL,BC
001397 5397 C9              10      RET
                                
       5398                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001398 5398 212200          10      LD  HL,00022H
00139B 539B AF               4      XOR A
00139C 539C 7D               4      LD  A,L
00139D 539D C9              10      RET
                                
       539E                     _SYS0D:     ;(BDOS)ディスク・リセット
00139E 539E 218000          10      LD  HL,00080H
0013A1 53A1 22C7F2          16      LD  (_DTA),HL
0013A4 53A4 C9              10      RET
                                
       53A5                     _SYS0E:     ;(BDOS)カレントドライブの設定
0013A5 53A5 7B               4      LD  A,E
0013A6 53A6 FE02             7      CP  2
0013A8 53A8 D0              11      RET NC
0013A9 53A9 32DDF2          13      LD  (_DVSW),A
0013AC 53AC C9              10      RET
                                
       53AD                     _SYS0F:     ;(BDOS)ファイルのオープン
0013AD 53AD D5              11      PUSH    DE
0013AE 53AE FDE1            14      POP IY
0013B0 53B0 CD1B55          17      CALL    INIT_FILE
0013B3 53B3 CD4E4B          17      CALL    ROM_OPEN
0013B6 53B6 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0013B8 53B8 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0013BC 53BC FDE5            15      PUSH    IY
0013BE 53BE D1              10      POP DE
0013BF 53BF 13               6      INC DE
0013C0 53C0 010B00          10      LD  BC,11
0013C3 53C3 EDB0                    LDIR
                                ;               Attribute
0013C5 53C5 7E               7      LD  A,(HL)
0013C6 53C6 FD770D          19      LD  (IY+13),A
                                ;               TIME
0013C9 53C9 110B00          10      LD  DE,11
0013CC 53CC 19              11      ADD HL,DE
0013CD 53CD 7E               7      LD  A,(HL)
0013CE 53CE 23               6      INC HL
0013CF 53CF FD7716          19      LD  (IY+22),A
0013D2 53D2 7E               7      LD  A,(HL)
0013D3 53D3 23               6      INC HL
0013D4 53D4 FD7717          19      LD  (IY+23),A
                                ;               DATE
0013D7 53D7 7E               7      LD  A,(HL)
0013D8 53D8 23               6      INC HL
0013D9 53D9 FD7714          19      LD  (IY+20),A
0013DC 53DC 7E               7      LD  A,(HL)
0013DD 53DD 23               6      INC HL
0013DE 53DE FD7715          19      LD  (IY+21),A
                                ;               First cluster
0013E1 53E1 7E               7      LD  A,(HL)
0013E2 53E2 23               6      INC HL
0013E3 53E3 FD771A          19      LD  (IY+26),A
0013E6 53E6 7E               7      LD  A,(HL)
0013E7 53E7 23               6      INC HL
0013E8 53E8 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0013EB 53EB 7E               7      LD  A,(HL)
0013EC 53EC 23               6      INC HL
0013ED 53ED FD7710          19      LD  (IY+16),A
0013F0 53F0 7E               7      LD  A,(HL)
0013F1 53F1 23               6      INC HL
0013F2 53F2 FD7711          19      LD  (IY+17),A
0013F5 53F5 7E               7      LD  A,(HL)
0013F6 53F6 23               6      INC HL
0013F7 53F7 FD7712          19      LD  (IY+18),A
0013FA 53FA 7E               7      LD  A,(HL)
0013FB 53FB FD7713          19      LD  (IY+19),A
0013FE 53FE AF               4      XOR A
0013FF 53FF FD770C          19      LD  (IY+12),A
001402 5402 C9              10      RET
                                
       5403                     _SYS10:     ;(BDOS)ファイルのクローズ
001403 5403 AF               4      XOR A
001404 5404 C9              10      RET
                                
       5405                     S11X1:
001405 5405 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001408 5408 FD750E          19      LD  (IY+14),L
00140B 540B FD740F          19      LD  (IY+15),H
       540E                     SCF_FF_RET:
00140E 540E 37               4      SCF
00140F 540F 9F               4      SBC A,A
001410 5410 C9              10      RET
                                
       5411                     _SYS11:     ;(BDOS)最初のファイルの検索
001411 5411 ED53CAF2        20      LD  (_FCB),DE
001415 5415 D5              11      PUSH    DE
001416 5416 FDE1            14      POP IY
001418 5418 CD1B55          17      CALL    INIT_FILE
00141B 541B CDAC4D          17      CALL    GET_DIR_DAT
       541E                     S12X1:
00141E 541E CD6A4B          17      CALL    FILESE
001421 5421 30E2            12      JR  NC,S11X1
001423 5423 0D               4      DEC C
001424 5424 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001427 5427 FDCB0D66        20      BIT 4,(IY+13)
00142B 542B 2809            12      JR  Z,S12X2
00142D 542D E5              11      PUSH    HL
00142E 542E DDE1            14      POP IX
001430 5430 DDCB0E66        20      BIT 4,(IX+1+13)
001434 5434 28E8            12      JR  Z,S12X1
       5436                     S12X2:
001436 5436 012000          10      LD  BC,32
001439 5439 ED5BC7F2        20      LD  DE,(_DTA)
00143D 543D AF               4      XOR A
00143E 543E 12               7      LD  (DE),A      ;ドライブ番号
00143F 543F 13               6      INC DE
001440 5440 EDB0                    LDIR            ;ディレクトリエントリ
001442 5442 FD750E          19      LD  (IY+14),L
001445 5445 FD740F          19      LD  (IY+15),H
001448 5448 C9              10      RET
                                
       5449                     _SYS12:
001449 5449 FD2ACAF2        20      LD  IY,(_FCB)
00144D 544D FDE5            15      PUSH    IY
00144F 544F D1              10      POP DE
001450 5450 CD1B55          17      CALL    INIT_FILE
                                
001453 5453 FD6E0E          19      LD  L,(IY+14)
001456 5456 FD660F          19      LD  H,(IY+15)
001459 5459 FD4E19          19      LD  C,(IY+25)
00145C 545C 18C0            12      JR  S12X1
                                
       545E                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00145E 545E CD924D          17      CALL    SET_FCB
001461 5461 CD604D          17      CALL    GETSEQ
001464 5464 CD4D4D          17      CALL    RB_READ
001467 5467 E5              11      PUSH    HL
001468 5468 CD6D4D          17      CALL    SETSEQ
00146B 546B E1              10      POP HL
       546C                     SREAD:
00146C 546C C601             7      ADD A,001H
00146E 546E D8              11      RET C
                                
00146F 546F 7D               4      LD  A,L
001470 5470 D601             7      SUB 001H
001472 5472 9F               4      SBC A,A
001473 5473 E603             7      AND 3
001475 5475 1F               4      RRA
001476 5476 C9              10      RET
                                
       5477                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001477 5477 210100          10      LD  HL,00001H
00147A 547A AF               4      XOR A
00147B 547B C9              10      RET
                                
       547C                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00147C 547C 3ADDF2          13      LD  A,(_DVSW)
00147F 547F C9              10      RET
                                
       5480                     _SYS1A:     ;(BDOS)DTAの設定
001480 5480 ED53C7F2        20      LD  (_DTA),DE
001484 5484 AF               4      XOR A
001485 5485 C9              10      RET
                                
       5486                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001486 5486 010002          10      LD  BC,512
001489 5489 11C302          10      LD  DE,707
00148C 548C 210000          10      LD  HL,0
00148F 548F DD21CCF2        14      LD  IX,_BUF
001493 5493 FD21CCF2        14      LD  IY,_BUF
001497 5497 FD3600F9        19      LD  (IY+0),0F9H
00149B 549B 3E02             7      LD  A,2
00149D 549D C9              10      RET
                                
       549E                     _SYS21:     ;(BDOS)ランダムな読み出し
00149E 549E CD924D          17      CALL    SET_FCB
                                
0014A1 54A1 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0014A4 54A4 FD6622          19      LD  H,(IY+34)
                                
0014A7 54A7 CD4D4D          17      CALL    RB_READ
0014AA 54AA 18C0            12      JR  SREAD
                                
       54AC                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
0014AC 54AC CDAD53          17      CALL    _SYS0F
0014AF 54AF D8              11      RET C
                                
0014B0 54B0 D5              11      PUSH    DE      ;EX DE,IY
0014B1 54B1 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0014B3 54B3 CD824D          17      CALL    GETSIZE
       54B6                     _S24X1:
0014B6 54B6 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0014B9 54B9 FD7422          19      LD  (IY+34),H
0014BC 54BC FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0014C0 54C0 FDE3            23      EX  (SP),IY     ;
0014C2 54C2 D1              10      POP DE      ;
                                
0014C3 54C3 AF               4      XOR A
0014C4 54C4 C9              10      RET
                                
       54C5                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0014C5 54C5 E5              11      PUSH    HL
0014C6 54C6 D5              11      PUSH    DE      ;EX DE,IY
0014C7 54C7 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0014C9 54C9 CD604D          17      CALL    GETSEQ
0014CC 54CC 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       54CE                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0014CE 54CE CD924D          17      CALL    SET_FCB
0014D1 54D1 E5              11      PUSH    HL
0014D2 54D2 FD6E21          19      LD  L,(IY+33)
0014D5 54D5 FD6622          19      LD  H,(IY+34)
0014D8 54D8 22BDF2          16      LD  (RR_LOW),HL
0014DB 54DB FD6E23          19      LD  L,(IY+35)
0014DE 54DE FD6624          19      LD  H,(IY+36)
0014E1 54E1 22BFF2          16      LD  (RR_HIGH),HL
0014E4 54E4 E1              10      POP HL
0014E5 54E5 CD2E49          17      CALL    ROM_READ
0014E8 54E8 ED5BBDF2        20      LD  DE,(RR_LOW)
0014EC 54EC FD7321          19      LD  (IY+33),E
0014EF 54EF FD7222          19      LD  (IY+34),D
0014F2 54F2 ED5BBFF2        20      LD  DE,(RR_HIGH)
0014F6 54F6 FD7323          19      LD  (IY+35),E
0014F9 54F9 FD7224          19      LD  (IY+36),D
0014FC 54FC 9F               4      SBC A,A
0014FD 54FD C9              10      RET
                                
       54FE                     _SYS2F:
0014FE 54FE 44               4      LD  B,H
0014FF 54FF 2AC7F2          16      LD  HL,(_DTA)
001502 5502 C3794F          10      JP  DISKIO
                                
       5505                     _SYS5A:
001505 5505 0600             7      LD  B,0
001507 5507 D5              11      PUSH    DE
001508 5508 DDE1            14      POP IX
       550A                     _SX5A1:
00150A 550A 1A               7      LD  A,(DE)
00150B 550B B7               4      OR  A
00150C 550C 2804            12      JR  Z,_SX5A2
00150E 550E 13               6      INC DE
00150F 550F 04               4      INC B
001510 5510 18F8            12      JR  _SX5A1
                                
       5512                     _SX5A2:
001512 5512 78               4      LD  A,B
001513 5513 CDF949          17      CALL    FILE_BDOS
001516 5516 CD364E          17      CALL    ROM_CD
001519 5519 9F               4      SBC A,A
00151A 551A C9              10      RET
                                
       551B                     INIT_FILE:
00151B 551B EB               4      EX  DE,HL
00151C 551C 11EBF2          10      LD  DE,FDRV
00151F 551F 010C00          10      LD  BC,1+8+3
       5522                     INIT_FILE1:
001522 5522 EDB0                    LDIR
001524 5524 CD4151          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
001527 5527 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00152A 552A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
00152D 552D 2ADEF2          16      LD  HL,(_CD)
001530 5530 22E9F2          16      LD  (_CDX),HL           ;カレントディレクトリ
001533 5533 C9              10      RET
                                
       5534                     ZERO_MEMORY_DE:
001534 5534 AF               4      XOR A
       5535                     FILL_MEMORY_DE:
001535 5535 12               7      LD  (DE),A
001536 5536 13               6      INC DE
001537 5537 10FC            13      DJNZ    FILL_MEMORY_DE
001539 5539 C9              10      RET
                                
00153A 553A                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 9D51B351E4519D51        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 9D519D51E9512A52        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 F1519D514452D852        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 98539E53A553AD53        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 0354115449549D51        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 5E549D519D519D51        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 77547C5480548654        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 9D519D519D51AC54        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 C5549D519D51CE54        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 9D519D51EA529D51        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 F0529D519D51FE54        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 9D519D5105559D51        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 9D519D519D519D51        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
