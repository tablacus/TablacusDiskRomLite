                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 F14D                    DW  STATEMENT   ; STATEMENT
000006 4006 5B4E                    DW  DEVICE1     ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3924E          10      JP  DISKIO
000013 4013 C3CD4E          10      JP  DSKCHG
000016 4016 C3234F          10      JP  GETDPB
000019 4019 C31650          10      JP  CHOICE
00001C 401C C31A50          10      JP  DSKFMT
00001F 401F C31C50          10      JP  DSKSTP
000022 4022 C31D50          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C31A50          10      JP  DSKFMT
000029 4029 C31C50          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C32450          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.1",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3100    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2260F1          16      LD  (BASSTK),HL
000129 4129 ED7B60F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210743          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017D00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4742          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DBFE          13      LD  (H_STKE+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 213745          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 216946          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 217646          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 217150          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AE43          10      LD  HL,ROM_STKE
0001BC 41BC 22DCFE          16      LD  (H_STKE+2),HL
0001BF 41BF 21924E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DEFE          13      LD  (H_STKE+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
                                    JR  Z,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
0001E5 41E5 204F            12      JR  NZ,NOT_BANK_TYPE
0001E7 41E7 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001EA 41EA 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001ED 41ED CD3801          17      CALL    RSLREG      ;read primary slot #
0001F0 41F0 07               4      RLCA
0001F1 41F1 07               4      RLCA
0001F2 41F2 F5              11      PUSH    AF
0001F3 41F3 1605             7      LD  D,4+1
0001F5 41F5 CD4E42          17      CALL    GTSL2_
0001F8 41F8 3244F3          13      LD  (RAMAD3),A
0001FB 41FB F1              10      POP AF
0001FC 41FC 07               4      RLCA
0001FD 41FD 07               4      RLCA
0001FE 41FE 1603             7      LD  D,2+1
000200 4200 CD4E42          17      CALL    GTSL2_
000203 4203 2680             7      LD  H,080H
000205 4205 CD6B42          17      CALL    CHK_RAM
000208 4208 3243F3          13      LD  (RAMAD2),A
       420B                     RAMCHK2:
00020B 420B 3A44F3          13      LD  A,(RAMAD3)
00020E 420E 2640             7      LD  H,040H
000210 4210 CD6B42          17      CALL    CHK_RAM
000213 4213 3242F3          13      LD  (RAMAD1),A
       4216                     RAMCHK1:
000216 4216 3A44F3          13      LD  A,(RAMAD3)
000219 4219 2600             7      LD  H,00H
00021B 421B CD6B42          17      CALL    CHK_RAM
00021E 421E 3241F3          13      LD  (RAMAD0),A
       4221                     RAMCHK0:
000221 4221 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000224 4224 010F00          10      LD  BC,0000FH       ;切り上げ
000227 4227 09              11      ADD HL,BC
000228 4228 7D               4      LD  A,L
                                
000229 4229 0604             7      LD  B,4
       422B                     B_DRIVE1:
00022B 422B CB3C             8      SRL H
00022D 422D 1F               4      RRA
00022E 422E 10FB            13      DJNZ    B_DRIVE1
                                
000230 4230 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000232 4232 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000235 4235 C9              10      RET
                                
       4236                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000236 4236 21F343          10      LD  HL,MSG_ERROR_ROM_MODE
000239 4239 CD8743          17      CALL    MSX
00023C 423C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000240 4240 DD219F00        14      LD  IX,CHGET
000244 4244 C31C00          10      JP  _CALSLT
                                
       4247                     GTSL1_:             ;自分のいるスロットを知る
000247 4247 CD3801          17      CALL    RSLREG      ;read primary slot #
00024A 424A 0F               4      RRCA
00024B 424B 0F               4      RRCA
00024C 424C 1601             7      LD  D,1
       424E                     GTSL2_:
00024E 424E E603             7      AND 3       ;[A]=000000PP
000250 4250 5F               4      LD  E,A     ;[E]=000000PP
000251 4251 21C1FC          10      LD  HL,EXPTBL
000254 4254 85               4      ADD A,L     ;桁上りは無い
000255 4255 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000256 4256 7B               4      LD  A,E     ;[A]=000000PP
000257 4257 CB7E            13      BIT 7,(HL)
000259 4259 C8              11      RET Z
00025A 425A 7D               4      LD  A,L     ;point to SLTTBL entry
00025B 425B C604             7      ADD A,4     ;桁上りは無い
00025D 425D 6F               4      LD  L,A
00025E 425E 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425F                     GTSL3_:
00025F 425F 15               4      DEC D
000260 4260 2803            12      JR  Z,GTSL4_:
000262 4262 0F               4      RRCA
000263 4263 18FA            12      JR  GTSL3_:
       4265                     GTSL4_:
000265 4265 E60C             7      AND 00CH        ;[A] = 0000SS00
000267 4267 B3               4      OR  E       ;[A] = 0000SSPP
000268 4268 F680             7      OR  080H        ;[A] = 1000SSPP
00026A 426A C9              10      RET
                                
       426B                     CHK_RAM:
00026B 426B E5              11      PUSH    HL
00026C 426C CDC042          17      CALL    CHK_RAM0
00026F 426F E1              10      POP HL
000270 4270 C8              11      RET Z
000271 4271 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000274 4274 E680             7      AND 080H
000276 4276 CD9742          17      CALL    CHK_RAM_SLT
000279 4279 C8              11      RET Z
00027A 427A 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027D 427D E680             7      AND 080H
00027F 427F C601             7      ADD A,1
000281 4281 CD9742          17      CALL    CHK_RAM_SLT
000284 4284 C8              11      RET Z
000285 4285 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000288 4288 E680             7      AND 080H
00028A 428A C602             7      ADD A,2
00028C 428C CD9742          17      CALL    CHK_RAM_SLT
00028F 428F C8              11      RET Z
000290 4290 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000293 4293 E680             7      AND 080H
000295 4295 C603             7      ADD A,3
       4297                     CHK_RAM_SLT:
000297 4297 E5              11      PUSH    HL
000298 4298 CDC042          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029B 429B E1              10      POP HL
00029C 429C C8              11      RET Z
00029D 429D CB79             8      BIT 7,C
00029F 429F 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A1 42A1 79               4      LD  A,C
0002A2 42A2 C604             7      ADD A,4*1           ;スロット#X-1
0002A4 42A4 E5              11      PUSH    HL
0002A5 42A5 CDC042          17      CALL    CHK_RAM0
0002A8 42A8 E1              10      POP HL
0002A9 42A9 C8              11      RET Z
0002AA 42AA 79               4      LD  A,C
0002AB 42AB C608             7      ADD A,4*2           ;スロット#X-2
0002AD 42AD E5              11      PUSH    HL
0002AE 42AE CDC042          17      CALL    CHK_RAM0
0002B1 42B1 E1              10      POP HL
0002B2 42B2 C8              11      RET Z
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 C60C             7      ADD A,4*3           ;スロット#X-3
0002B6 42B6 E5              11      PUSH    HL
0002B7 42B7 CDC042          17      CALL    CHK_RAM0
0002BA 42BA E1              10      POP HL
       42BB                     CHK_RAM_E:
0002BB 42BB AF               4      XOR A
0002BC 42BC 3C               4      INC A           ;ZF=0にする
0002BD 42BD 3E00             7      LD  A,0
0002BF 42BF C9              10      RET
                                
       42C0                     CHK_RAM0:
0002C0 42C0 4F               4      LD  C,A
0002C1 42C1 3A00F1          13      LD  A,(ROM_SLT)
0002C4 42C4 B9               4      CP  C
0002C5 42C5 28F4            12      JR  Z,CHK_RAM_E
0002C7 42C7 2E00             7      LD  L,0
       42C9                     CHK_RAM1:
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDFB42          17      CALL    CALSLT_R
0002D1 42D1 C6E5             7      ADD A,0E5H
0002D3 42D3 47               4      LD  B,A
0002D4 42D4 5F               4      LD  E,A
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 DD211400        14      LD  IX,_WRSLT
0002DA 42DA CDFB42          17      CALL    CALSLT_R
0002DD 42DD 79               4      LD  A,C
0002DE 42DE DD210C00        14      LD  IX,_RDSLT
0002E2 42E2 CDFB42          17      CALL    CALSLT_R
0002E5 42E5 B8               4      CP  B
0002E6 42E6 C0              11      RET NZ
0002E7 42E7 D6E5             7      SUB 0E5H
0002E9 42E9 79               4      LD  A,C
0002EA 42EA 5F               4      LD  E,A
0002EB 42EB DD211400        14      LD  IX,_WRSLT
0002EF 42EF CDFB42          17      CALL    CALSLT_R
0002F2 42F2 24               4      INC H
0002F3 42F3 7D               4      LD  A,L
0002F4 42F4 C604             7      ADD A,4
0002F6 42F6 6F               4      LD  L,A
0002F7 42F7 20D0            12      JR  NZ,CHK_RAM1
0002F9 42F9 79               4      LD  A,C     ;ZF=1のハズ
0002FA 42FA C9              10      RET
                                
       42FB                     CALSLT_R:
0002FB 42FB C5              11      PUSH    BC
0002FC 42FC E5              11      PUSH    HL
0002FD 42FD FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000301 4301 CD1C00          17      CALL    _CALSLT
000304 4304 E1              10      POP HL
000305 4305 C1              10      POP BC
000306 4306 C9              10      RET
                                
       4307                     AT_ISC:
000307 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000307 F0E9 FEB7             7      CP  0B7H            ;FILES
000309 F0EB CC7BFE          17      CALL    Z,H_FILE
00030C F0EE FEB5             7      CP  0B5H            ;LOAD
00030E F0F0 CA71FE          10      JP  Z,H_BINS
000311 F0F3 FE8A             7      CP  08AH            ;RUN
000313 F0F5 CA76FE          10      JP  Z,H_BINL
000316 F0F8 FED6             7      CP  0D6H            ;COPY
000318 F0FA 2813            12      JR  Z,FIX_COPY
00031A F0FC FECF             7      CP  0CFH            ;BLOAD
00031C F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031D F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031E F100 00                      DB  0
00031F F101 9F45                    DW  ROM_BLOAD
000321 F103 F5              11      PUSH    AF
000322 F104 E5              11      PUSH    HL
000323 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000326 F108 E1              10      POP HL
000327 F109 F1              10      POP AF
000328 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
00032A F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032C F10E C9              10      RET
       F10F                     FIX_COPY:
00032D F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032E F110 00                      DB  0
00032F F111 FC46                    DW  ROM_COPY
000331 F113 C9              10      RET
       F114                     ROMUSE1:
000332 F114 3A00F1          13      LD  A,(ROM_SLT)
000335 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000337 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
00033A F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033D F11F 00                      DB  0
       F120                     _BANK:
00033E F120 00                      DB  0
       F121                     _BANK1:
00033F F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
000340 F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000342 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000344 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000346 F128 0000                    DW  0
       F12A                     _CLPS:
000348 F12A 0000                    DW  0
       F12C                     _LEFT:
00034A F12C 0000                    DW  0
       F12E                     _DTPS:
00034C F12E 0000                    DW  0
       F130                     _DTA:
00034E F130 0000                    DW  0
       F132                     FLG_LDIR:
000350 F132 00                      DB  0
       F133                     _FCB:
000351 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000353 F135 00                      DB  0
       F136                     _BUF_ST:
000354 F136 0000                    DW  0
       F138                     _BUF_EN:
000356 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000358 F13A 0000                    DW  0
       F13C                     _BUF_H:
00035A F13C 0000                    DW  0
       F13E                     _BUF_X:
00035C F13E 0000                    DW  0
       F140                     _BUF_Y:
00035E F140 00                      DB  0
       F141                     _BUF_P:
00035F F141 00                      DB  0
       F142                     _BUF_O:
000360 F142 00                      DB  0
       F143                     DTAX:
000361 F143 0000                    DW  0
       F145                     B_DRIVE:
000363 F145 00                      DB  0
       F146                     _DVSW:
000364 F146 00                      DB  0
       F147                     DIRENT1:
000365 F147 0000                    DW  0
       F149                     _DIR_BANK:
000367 F149 00                      DB  0
       F14A                     LEFTX:
000368 F14A 0000                    DW  0
       F14C                     PARAM0:
00036A F14C 0000                    DW  0
       F14E                     PARAM1:
00036C F14E 0000                    DW  0
       F150                     FDRV:
00036E F150 00                      DB  0
       F151                     FNAME:
00036F F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
00037A F15C 0000                    DW  0
       F15E                     _CDX:
00037C F15E 0000                    DW  0
       F160                     BASSTK:
00037E F160 0000                    DW  0
       F162                     _HL:
000380 F162 0000                    DW  0
       F164                     _SP:
000382 F164 0000                    DW  0
                                
       F166                     ISC_E:
000384 4384                         ORG $$+RUN          ;$DEPHASE
                                
       4384                     MSX1:
000384 4384 CD8A50          17      CALL    MSGA1
       4387                     MSX:
000387 4387 7E               7      LD  A,(HL)
000388 4388 23               6      INC HL
000389 4389 B7               4      OR  A
00038A 438A 20F8            12      JR  NZ,MSX1
00038C 438C C9              10      RET
                                
       438D                     PRTHX:
00038D 438D F5              11      PUSH    AF
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 07               4      RLCA
000391 4391 07               4      RLCA
000392 4392 CD9643          17      CALL    PRTA2
000395 4395 F1              10      POP AF
       4396                     PRTA2:
000396 4396 CD9C43          17      CALL    ASC
000399 4399 C38650          10      JP  MSG_A
                                    
       439C                     ASC:
00039C 439C E60F             7      AND $0F
00039E 439E F630             7      OR  $30
0003A0 43A0 FE3A             7      CP  $3A
0003A2 43A2 D8              11      RET C
0003A3 43A3 C607             7      ADD A,7
0003A5 43A5 C9              10      RET
                                
       43A6                     MSN:
0003A6 43A6 7E               7      LD  A,(HL)
0003A7 43A7 23               6      INC HL
0003A8 43A8 CD8650          17      CALL    MSG_A
0003AB 43AB 10F9            13      DJNZ    MSN
0003AD 43AD C9              10      RET
                                
       43AE                     ROM_STKE:
0003AE 43AE 3E                      DB  03EH
0003AF 43AF C9              10      RET
0003B0 43B0 32DAFE          13      LD  (H_STKE),A
0003B3 43B3 E5              11      PUSH    HL
0003B4 43B4 D5              11      PUSH    DE
0003B5 43B5 C5              11      PUSH    BC
                                
0003B6 43B6 AF               4      XOR A
0003B7 43B7 5F               4      LD  E,A
0003B8 43B8 57               4      LD  D,A
0003B9 43B9 0601             7      LD  B,1
0003BB 43BB 2100C0          10      LD  HL,0C000H
0003BE 43BE CD924E          17      CALL    DISKIO
                                
0003C1 43C1 ED7360F1        20      LD  (BASSTK),SP
0003C5 43C5 116BF3          10      LD  DE,RAMUSE
0003C8 43C8 AF               4      XOR A
0003C9 43C9 CD1EC0          17      CALL    0C01EH
                                ;   LD  DE,RAMUSE
                                ;   SCF
                                ;   CALL    0C01EH
       43CC                     BASAUTO:
0003CC 43CC 211944          10      LD  HL,AUTOEXEC
0003CF 43CF 1150F1          10      LD  DE,FDRV
0003D2 43D2 010C00          10      LD  BC,1+8+3
0003D5 43D5 EDB0                    LDIR
0003D7 43D7 CD374B          17      CALL    ROM_OPEN
0003DA 43DA 3813            12      JR  C,RSTKEE
0003DC 43DC 212544          10      LD  HL,RUN_AUTOEXEC
0003DF 43DF 11F0FB          10      LD  DE,KEYBUF
0003E2 43E2 ED53FAF3        20      LD  (GETPNT),DE
0003E6 43E6 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003E9 43E9 EDB0                    LDIR
0003EB 43EB ED53F8F3        20      LD  (PUTPNT),DE
       43EF                     RSTKEE:
0003EF 43EF C1              10      POP BC
0003F0 43F0 D1              10      POP DE
0003F1 43F1 E1              10      POP HL
0003F2 43F2 C9              10      RET
                                
       43F3                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
                                    DB  "Normal ROM/ASCII-16K only!",13,10
                                #else
0003F3 43F3 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
                                #endif
       4418                     NULL:
000418 4418 00                      DB  0
                                
       4419                     AUTOEXEC:
000419 4419 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4425                     RUN_AUTOEXEC:
000425 4425 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4438                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4438                     ROM_LDIR:
000438 4438 3A32F1          13      LD  A,(FLG_LDIR)
00043B 443B B7               4      OR  A
00043C 443C 2008            12      JR  NZ,ROM_LDIRVM
00043E 443E CB7A             8      BIT 7,D
000440 4440 CA5844          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
                                LDIRA:
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                LDIR1:
                                    LD  A,B
                                    OR  C
                                    JR  Z,LDIRE
                                
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                LDIR2:
                                    LD  A,D
                                    CP  0C0H
                                    JR  NC,LDIR4
                                
                                    PUSH    BC
                                    PUSH    DE
                                    LD  DE,BUF
                                
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIR3
                                    LD  BC,00100H
                                LDIR3:
                                    PUSH    BC
                                    LDIR
                                    LD  (_HL),HL
                                
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                
                                    POP BC
                                    POP DE
                                    LD  HL,BUF
                                    LDIR
                                
                                    LD  HL,(_HL)
                                    POP BC
                                    LD  A,B
                                    OR  A
                                    JR  Z,LDIRE
                                    DEC B
                                    JR  LDIR1
                                LDIR4:
                                #endif
000443 4443 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
                                LDIRE2:
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(RAMAD2)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                LDIRE:
                                    LD  SP,(_SP)
                                    EI
                                #endif
000445 4445 C9              10      RET
                                
       4446                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
000446 4446 C5              11      PUSH    BC
000447 4447 D5              11      PUSH    DE
000448 4448 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00044C 444C DD215C00        14      LD  IX,LDIRVM
000450 4450 CD1C00          17      CALL    _CALSLT
000453 4453 E1              10      POP HL
000454 4454 C1              10      POP BC
000455 4455 09              11      ADD HL,BC
000456 4456 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000457 4457 C9              10      RET
                                #endif
                                
       4458                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
                                    DI
                                    LD  (_SP),SP
                                    LD  SP,DRVTBL
                                    PUSH    BC
                                    PUSH    DE
                                    PUSH    HL
                                    LD  A,(ROM_SLT)
                                    LD  H,080H
                                    CALL    _ENASLT
                                    POP HL
                                    POP DE
                                    POP BC
                                #endif
       4458                     ROM_LDIRSLT1:
000458 4458 EB               4      EX  DE,HL
       4459                     RLDIRSLT1:
000459 4459 1A               7      LD  A,(DE)
00045A 445A 13               6      INC DE
00045B 445B C5              11      PUSH    BC
00045C 445C D5              11      PUSH    DE
00045D 445D E5              11      PUSH    HL
00045E 445E 5F               4      LD  E,A
                                
00045F 445F 0141F3          10      LD  BC,RAMAD0
000462 4462 7C               4      LD  A,H
000463 4463 07               4      RLCA
000464 4464 07               4      RLCA
000465 4465 E603             7      AND 3
000467 4467 81               4      ADD A,C
000468 4468 4F               4      LD  C,A
000469 4469 0A               7      LD  A,(BC)
       446A                     RLDIRSLT2:
00046A 446A CD1400          17      CALL    _WRSLT
00046D 446D 08               4      EX  AF,AF'
00046E 446E E1              10      POP HL
00046F 446F D1              10      POP DE
000470 4470 C1              10      POP BC
000471 4471 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
000473 4473 EA5944          10      JP  PE,RLDIRSLT1
000476 4476 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
                                    JR  LDIRE2
                                #else
000477 4477 C9              10      RET
                                #endif
                                
       4478                     END_OF_LINE:
000478 4478 215EF5          10      LD  HL,BUF
       447B                     EOL1:
00047B 447B 7E               7      LD  A,(HL)
00047C 447C C8              11      RET Z
00047D 447D FE0D             7      CP  00DH
00047F 447F 2807            12      JR  Z,EOLE
000481 4481 FE0A             7      CP  00AH
000483 4483 2803            12      JR  Z,EOLE
000485 4485 23               6      INC HL
000486 4486 18F3            12      JR  EOL1
       4488                     EOLE:
000488 4488 3600            10      LD  (HL),0
00048A 448A 23               6      INC HL
00048B 448B 7E               7      LD  A,(HL)
00048C 448C FE0A             7      CP  00AH
00048E 448E C0              11      RET NZ
00048F 448F 23               6      INC HL
000490 4490 C9              10      RET
                                
       4491                     ROM_LOAD_ASCII:
000491 4491 210000          10      LD  HL,0
000494 4494 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000497 4497 2A76F6          16      LD  HL,(TXTTAB)
00049A 449A 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00049D 449D 215EF5          10      LD  HL,BUF
0004A0 44A0 2230F1          16      LD  (_DTA),HL
       44A3                     RLOAD_A1:
0004A3 44A3 2A36F1          16      LD  HL,(_BUF_ST)
0004A6 44A6 2226F1          16      LD  (RR_LOW),HL
0004A9 44A9 210201          10      LD  HL,258
0004AC 44AC CD1749          17      CALL    ROM_READ
0004AF 44AF 7C               4      LD  A,H
0004B0 44B0 B5               4      OR  L
0004B1 44B1 2877            12      JR  Z,RLOAD_AEND
0004B3 44B3 015EF5          10      LD  BC,BUF
0004B6 44B6 09              11      ADD HL,BC
0004B7 44B7 3600            10      LD  (HL),0
0004B9 44B9 CD7844          17      CALL    END_OF_LINE
0004BC 44BC 015EF5          10      LD  BC,BUF
0004BF 44BF A7               4      AND A
0004C0 44C0 ED42            15      SBC HL,BC
0004C2 44C2 2810            12      JR  Z,RLOAD_A2
0004C4 44C4 4D               4      LD  C,L
0004C5 44C5 44               4      LD  B,H
0004C6 44C6 ED5B36F1        20      LD  DE,(_BUF_ST)
0004CA 44CA 19              11      ADD HL,DE
0004CB 44CB 2236F1          16      LD  (_BUF_ST),HL
0004CE 44CE 3A5EF5          13      LD  A,(BUF)
0004D1 44D1 B7               4      OR  A
0004D2 44D2 28CF            12      JR  Z,RLOAD_A1
       44D4                     RLOAD_A2:
0004D4 44D4 115EF5          10      LD  DE,BUF
0004D7 44D7 CDCE4A          17      CALL    SPCUTEX
0004DA 44DA 1A               7      LD  A,(DE)
0004DB 44DB B7               4      OR  A
0004DC 44DC 284C            12      JR  Z,RLOAD_AEND
0004DE 44DE CDE04A          17      CALL    GETNUM
0004E1 44E1 7C               4      LD  A,H
0004E2 44E2 B5               4      OR  L
0004E3 44E3 CA8945          10      JP  Z,ERROR_DIRECT_IN_FILE
0004E6 44E6 DD2A38F1        20      LD  IX,(_BUF_EN)
0004EA 44EA DD7502          19      LD  (IX+2),L
0004ED 44ED DD7403          19      LD  (IX+3),H
                                
0004F0 44F0 CDC74A          17      CALL    SPCUT
0004F3 44F3 EB               4      EX  DE,HL
0004F4 44F4 DDE5            15      PUSH    IX
0004F6 44F6 DD21B242        14      LD  IX,CRUNCH
0004FA 44FA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004FE 44FE CD1C00          17      CALL    _CALSLT
000501 4501 DDE1            14      POP IX
000503 4503 EB               4      EX  DE,HL
000504 4504 111FF4          10      LD  DE,KBUF
000507 4507 37               4      SCF
000508 4508 ED52            15      SBC HL,DE
00050A 450A 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
00050C 450C 387B            12      JR  C,ERROR_DIRECT_IN_FILE
00050E 450E 4D               4      LD  C,L
00050F 450F 44               4      LD  B,H
000510 4510 2A38F1          16      LD  HL,(_BUF_EN)
000513 4513 110400          10      LD  DE,4
000516 4516 19              11      ADD HL,DE
000517 4517 111FF4          10      LD  DE,KBUF
                                
00051A 451A EB               4      EX  DE,HL
00051B 451B EDB0                    LDIR
00051D 451D EB               4      EX  DE,HL
                                
00051E 451E DD7500          19      LD  (IX+0),L
000521 4521 DD7401          19      LD  (IX+1),H
000524 4524 2238F1          16      LD  (_BUF_EN),HL
000527 4527 C3A344          10      JP  RLOAD_A1
                                
       452A                     RLOAD_AEND:
00052A 452A 2A38F1          16      LD  HL,(_BUF_EN)
00052D 452D AF               4      XOR A
00052E 452E 77               7      LD  (HL),A
00052F 452F 23               6      INC HL
000530 4530 77               7      LD  (HL),A
000531 4531 23               6      INC HL
000532 4532 2238F1          16      LD  (_BUF_EN),HL
000535 4535 183B            12      JR  RLOAD_END1
                                
       4537                     ROM_LOAD:
000537 4537 CDC646          17      CALL    INIT_PARAM
00053A 453A CDB849          17      CALL    FILE_B
00053D 453D 3A51F1          13      LD  A,(FNAME)
000540 4540 FE20             7      CP  020H
000542 4542 CAB349          10      JP  Z,ROM_ORG
                                
000545 4545 CD374B          17      CALL    ROM_OPEN
000548 4548 3848            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00054A 454A 2135F1          10      LD  HL,_BUF
00054D 454D 2230F1          16      LD  (_DTA),HL
000550 4550 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000553 4553 CD1749          17      CALL    ROM_READ
000556 4556 3A35F1          13      LD  A,(_BUF)
000559 4559 3C               4      INC A
00055A 455A C29144          10      JP  NZ,ROM_LOAD_ASCII
00055D 455D 2A76F6          16      LD  HL,(TXTTAB)
000560 4560 2230F1          16      LD  (_DTA),HL
000563 4563 EB               4      EX  DE,HL
000564 4564 2100FF          10      LD  HL,-256
000567 4567 39              11      ADD HL,SP
000568 4568 ED52            15      SBC HL,DE
00056A 456A CD1749          17      CALL    ROM_READ
00056D 456D ED5B30F1        20      LD  DE,(_DTA)
000571 4571 19              11      ADD HL,DE
       4572                     RLOAD_END1:
000572 4572 22C2F6          16      LD  (VARTAB),HL
000575 4575 22C4F6          16      LD  (ARYTAB),HL
000578 4578 22C6F6          16      LD  (STREND),HL
                                
00057B 457B AF               4      XOR A
00057C 457C 2138F1          10      LD  HL,_BUF+3
00057F 457F 77               7      LD  (HL),A
000580 4580 2B               6      DEC HL
000581 4581 77               7      LD  (HL),A
000582 4582 2B               6      DEC HL
000583 4583 77               7      LD  (HL),A
000584 4584 2B               6      DEC HL
000585 4585 3E8F             7      LD  A,08FH          ;REM
000587 4587 77               7      LD  (HL),A
000588 4588 C9              10      RET
                                
       4589                     ERROR_DIRECT_IN_FILE:
000589 4589 1E39             7      LD  E,57            ;Direct statement in file
00058B 458B 01                      DB  1           ;LD BC,
       458C                     ERROR_INTERNAL_ERROR:
00058C 458C 1E33             7      LD  E,51            ;Internal error
00058E 458E 01                      DB  1           ;LD BC,
       458F                     ERROR_FILE_NOT_OPEN:
00058F 458F 1E3B             7      LD  E,59            ;File not OPEN
000591 4591 01                      DB  1           ;LD BC,
       4592                     ERROR_FILE_NOT_FOUND:
000592 4592 1E35             7      LD  E,53            ;File not found
       4594                     ERROR:
000594 4594 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000598 4598 DD216F40        14      LD  IX,ERRHAND
00059C 459C C31C00          10      JP  _CALSLT
                                
       459F                     ROM_BLOAD:
00059F 459F CDC646          17      CALL    INIT_PARAM
0005A2 45A2 CDB849          17      CALL    FILE_B
0005A5 45A5 CD374B          17      CALL    ROM_OPEN
0005A8 45A8 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005AA 45AA 2135F1          10      LD  HL,_BUF
0005AD 45AD 2230F1          16      LD  (_DTA),HL
0005B0 45B0 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005B3 45B3 CD1749          17      CALL    ROM_READ
0005B6 45B6 3A35F1          13      LD  A,(_BUF)
0005B9 45B9 FEFE             7      CP  0FEH
0005BB 45BB 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0005BD 45BD 210EF1          10      LD  HL,BLOAD_RET
0005C0 45C0 2206F1          16      LD  (SWC_BLOAD),HL
                                
0005C3 45C3 2A4EF1          16      LD  HL,(PARAM1)
0005C6 45C6 7E               7      LD  A,(HL)
0005C7 45C7 FE2C             7      CP  ','
0005C9 45C9 2048            12      JR  NZ,RBREAD_MEM
0005CB 45CB 23               6      INC HL
0005CC 45CC 7E               7      LD  A,(HL)
0005CD 45CD CD214B          17      CALL    CAP
0005D0 45D0 32BEFC          13      LD  (RUNBNF),A
       45D3                     RBOS1:
0005D3 45D3 7E               7      LD  A,(HL)
0005D4 45D4 23               6      INC HL
0005D5 45D5 B7               4      OR  A
0005D6 45D6 282F            12      JR  Z,RBREAD_OSE
0005D8 45D8 FE3A             7      CP  ':'
0005DA 45DA 282B            12      JR  Z,RBREAD_OSE
0005DC 45DC FE2C             7      CP  ','     ;次のパラメータを探す
0005DE 45DE 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
0005E0 45E0 224EF1          16      LD  (PARAM1),HL
0005E3 45E3 7E               7      LD  A,(HL)
0005E4 45E4 B7               4      OR  A
0005E5 45E5 2820            12      JR  Z,RBREAD_OSE
0005E7 45E7 DD21644C        14      LD  IX,FRMEVL
0005EB 45EB FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0005EF 45EF CD1C00          17      CALL    _CALSLT
0005F2 45F2 224EF1          16      LD  (PARAM1),HL
0005F5 45F5 3A63F6          13      LD  A,(VALTYP)
0005F8 45F8 FE02             7      CP  2
0005FA 45FA 200B            12      JR  NZ,RBREAD_OSE
0005FC 45FC 2A36F1          16      LD  HL,(_BUF_ST)
0005FF 45FF ED5BF8F7        20      LD  DE,(DACDAT)
000603 4603 19              11      ADD HL,DE
000604 4604 2236F1          16      LD  (_BUF_ST),HL
       4607                     RBREAD_OSE:
000607 4607 3ABEFC          13      LD  A,(RUNBNF)
00060A 460A FE53             7      CP  'S'
00060C 460C 2005            12      JR  NZ,RBREAD_MEM
00060E 460E 3E01             7      LD  A,1
000610 4610 3232F1          13      LD  (FLG_LDIR),A
       4613                     RBREAD_MEM:
000613 4613 2A36F1          16      LD  HL,(_BUF_ST)
000616 4616 22BFFC          16      LD  (SAVENT),HL
000619 4619 2230F1          16      LD  (_DTA),HL
00061C 461C 21FFFF          10      LD  HL,0FFFFH
00061F 461F CD1749          17      CALL    ROM_READ
000622 4622 3ABEFC          13      LD  A,(RUNBNF)
000625 4625 FE52             7      CP  'R'
000627 4627 2006            12      JR  NZ,RBREAD1
000629 4629 2A3AF1          16      LD  HL,(_BUF_EX)
00062C 462C 2206F1          16      LD  (SWC_BLOAD),HL
       462F                     RBREAD1:
       462F                     ROM_NEXT:
00062F 462F 2A4EF1          16      LD  HL,(PARAM1)
000632 4632 7E               7      LD  A,(HL)
000633 4633 2B               6      DEC HL
000634 4634 B7               4      OR  A
000635 4635 2805            12      JR  Z,RN1
000637 4637 FE3A             7      CP  ':'
000639 4639 2801            12      JR  Z,RN1
00063B 463B 23               6      INC HL
       463C                     RN1:
00063C 463C 5D               4      LD  E,L
00063D 463D 54               4      LD  D,H
                                
00063E 463E CDF74A          17      CALL    SEARCH_END
000641 4641 B7               4      OR  A
000642 4642 2821            12      JR  Z,REM
       4644                     RN3:                    ;マルチステートメントの処理
000644 4644 7E               7      LD  A,(HL)
                                
000645 4645 FEB5             7      CP  0B5H            ;LOAD
000647 4647 CA3745          10      JP  Z,ROM_LOAD
00064A 464A FE8A             7      CP  08AH            ;RUN
00064C 464C 281B            12      JR  Z,ROM_RUN
00064E 464E FEB7             7      CP  0B7H            ;FILES
000650 4650 2824            12      JR  Z,ROM_FILES
000652 4652 FED6             7      CP  0D6H            ;COPY
000654 4654 CAFC46          10      JP  Z,ROM_COPY
000657 4657 FE20             7      CP  020H
000659 4659 2807            12      JR  Z,RN_SP
                                
00065B 465B 3E28             7      LD  A,028H          ;JR Z,
00065D 465D 320CF1          13      LD  (SWC_BLOAD_M),A
000660 4660 7E               7      LD  A,(HL)
000661 4661 C9              10      RET
       4662                     RN_SP:
000662 4662 23               6      INC HL
000663 4663 18DF            12      JR  RN3
                                
       4665                     REM:
000665 4665 EB               4      EX  DE,HL
000666 4666 3E8F             7      LD  A,08FH          ;REM
000668 4668 C9              10      RET
                                
       4669                     ROM_RUN:
000669 4669 23               6      INC HL
00066A 466A 7E               7      LD  A,(HL)
00066B 466B 2B               6      DEC HL
00066C 466C B7               4      OR  A
00066D 466D 2803            12      JR  Z,ROM_RUN1
00066F 466F CD3745          17      CALL    ROM_LOAD
       4672                     ROM_RUN1:
000672 4672 3E8A             7      LD  A,08AH          ;RUN
000674 4674 77               7      LD  (HL),A
000675 4675 C9              10      RET
                                
       4676                     ROM_FILES:
000676 4676 CDC646          17      CALL    INIT_PARAM
000679 4679 CDB849          17      CALL    FILE_B
00067C 467C CD2850          17      CALL    GET_DISK_BANK_FDRV
00067F 467F 3A51F1          13      LD  A,(FNAME)
000682 4682 FE21             7      CP  021H
000684 4684 3005            12      JR  NC,RFILES0
000686 4686 060B             7      LD  B,11
000688 4688 CD8B4A          17      CALL    FILE10
       468B                     RFILES0:
00068B 468B CDA44D          17      CALL    GET_DIR_DAT
       468E                     RFILES1:
00068E 468E CD534B          17      CALL    FILESE
000691 4691 302E            12      JR  NC,RFILES_NOT_MATCH
       4693                     RFILES_DISP:
000693 4693 E5              11      PUSH    HL
000694 4694 0608             7      LD  B,8
000696 4696 CDA643          17      CALL    MSN
000699 4699 3E2E             7      LD  A,'.'
00069B 469B CD8650          17      CALL    MSG_A
00069E 469E 0603             7      LD  B,3
0006A0 46A0 CDA643          17      CALL    MSN
0006A3 46A3 3ADDF3          13      LD  A,(CSRX)
0006A6 46A6 47               4      LD  B,A
0006A7 46A7 3AB0F3          13      LD  A,(LINLEN)
0006AA 46AA 90               4      SUB B
0006AB 46AB FE0C             7      CP  12
0006AD 46AD 3009            12      JR  NC,RFILES2
0006AF 46AF 3E0D             7      LD  A,00DH      ;改行
0006B1 46B1 CD8650          17      CALL    MSG_A
0006B4 46B4 3E0A             7      LD  A,00AH
0006B6 46B6 1802            12      JR  RFILES3
       46B8                     RFILES2:
0006B8 46B8 3E20             7      LD  A,020H
       46BA                     RFILES3:
0006BA 46BA CD8650          17      CALL    MSG_A
0006BD 46BD E1              10      POP HL
0006BE 46BE CD6F4B          17      CALL    FNEXT
       46C1                     RFILES_NOT_MATCH:
0006C1 46C1 20CB            12      JR  NZ,RFILES1
0006C3 46C3 C32F46          10      JP  ROM_NEXT
                                
       46C6                     INIT_PARAM:
0006C6 46C6 224CF1          16      LD  (PARAM0),HL
0006C9 46C9 224EF1          16      LD  (PARAM1),HL
0006CC 46CC EB               4      EX  DE,HL
0006CD 46CD AF               4      XOR A
0006CE 46CE 3232F1          13      LD  (FLG_LDIR),A
0006D1 46D1 32BEFC          13      LD  (RUNBNF),A
0006D4 46D4 3263F6          13      LD  (VALTYP),A
0006D7 46D7 E5              11      PUSH    HL
0006D8 46D8 2A5CF1          16      LD  HL,(_CD)
0006DB 46DB 225EF1          16      LD  (_CDX),HL
0006DE 46DE E1              10      POP HL
0006DF 46DF 13               6      INC DE
0006E0 46E0 CDC74A          17      CALL    SPCUT
0006E3 46E3 1A               7      LD  A,(DE)
0006E4 46E4 B7               4      OR  A
0006E5 46E5 C8              11      RET Z
0006E6 46E6 FE3A             7      CP  ':'
0006E8 46E8 C8              11      RET Z
0006E9 46E9 FE28             7      CP  '('
0006EB 46EB C8              11      RET Z
0006EC 46EC EB               4      EX  DE,HL
0006ED 46ED DD21644C        14      LD  IX,FRMEVL
0006F1 46F1 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0006F5 46F5 CD1C00          17      CALL    _CALSLT
0006F8 46F8 224EF1          16      LD  (PARAM1),HL
0006FB 46FB C9              10      RET
                                
       46FC                     ROM_COPY:
0006FC 46FC CDC646          17      CALL    INIT_PARAM
0006FF 46FF 3A63F6          13      LD  A,(VALTYP)
000702 4702 FE03             7      CP  3       ;string
000704 4704 C2B349          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000707 4707 CDB849          17      CALL    FILE_B
00070A 470A CD374B          17      CALL    ROM_OPEN
00070D 470D DA9245          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000710 4710 213AF1          10      LD  HL,_BUF_W
000713 4713 2230F1          16      LD  (_DTA),HL
000716 4716 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000719 4719 CD1749          17      CALL    ROM_READ
                                
00071C 471C AF               4      XOR A
00071D 471D 3235F1          13      LD  (_BUF_LO),A     ;PSET
000720 4720 3242F1          13      LD  (_BUF_O),A      ;向き
                                
000723 4723 2A4EF1          16      LD  HL,(PARAM1)
       4726                     RCP_PARAM1:
000726 4726 7E               7      LD  A,(HL)
000727 4727 23               6      INC HL
000728 4728 B7               4      OR  A
000729 4729 CAB349          10      JP  Z,ROM_ORG
00072C 472C FE3A             7      CP  ':'
00072E 472E CAB349          10      JP  Z,ROM_ORG
000731 4731 FE2C             7      CP  ','
000733 4733 2012            12      JR  NZ,RCP_PARAM1_
                                
000735 4735 DD212F54        14      LD  IX,FRMQNT
000739 4739 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00073D 473D CD1C00          17      CALL    _CALSLT
000740 4740 7B               4      LD  A,E
000741 4741 87               4      ADD A,A
000742 4742 87               4      ADD A,A
000743 4743 3242F1          13      LD  (_BUF_O),A
000746 4746 7E               7      LD  A,(HL)
       4747                     RCP_PARAM1_:
000747 4747 FE28             7      CP  '('
000749 4749 20DB            12      JR  NZ,RCP_PARAM1
                                
00074B 474B DD212F54        14      LD  IX,FRMQNT
00074F 474F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000753 4753 CD1C00          17      CALL    _CALSLT
                                
000756 4756 ED533EF1        20      LD  (_BUF_X),DE
                                
       475A                     RCP_PARAM2:
00075A 475A 23               6      INC HL
00075B 475B 7E               7      LD  A,(HL)
00075C 475C FE20             7      CP  020H
00075E 475E 28FA            12      JR  Z,RCP_PARAM2
000760 4760 FE2C             7      CP  ','
000762 4762 28F6            12      JR  Z,RCP_PARAM2
                                
000764 4764 DD212F54        14      LD  IX,FRMQNT
000768 4768 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00076C 476C CD1C00          17      CALL    _CALSLT
                                
00076F 476F ED5340F1        20      LD  (_BUF_Y),DE
       4773                     RCP_PARAM3:
000773 4773 23               6      INC HL
000774 4774 7E               7      LD  A,(HL)
000775 4775 FE20             7      CP  020H
000777 4777 28FA            12      JR  Z,RCP_PARAM3
000779 4779 FE29             7      CP  ')'
00077B 477B 28F6            12      JR  Z,RCP_PARAM3
00077D 477D FE2C             7      CP  ','
00077F 477F 2033            12      JR  NZ,RCP_ST
                                
000781 4781 23               6      INC HL
000782 4782 DD212F54        14      LD  IX,FRMQNT
000786 4786 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00078A 478A CD1C00          17      CALL    _CALSLT
                                
00078D 478D 7B               4      LD  A,E
00078E 478E 3241F1          13      LD  (_BUF_P),A
                                
       4791                     RCP_PARAM4:
000791 4791 7E               7      LD  A,(HL)
000792 4792 23               6      INC HL
000793 4793 FE20             7      CP  020H
000795 4795 28FA            12      JR  Z,RCP_PARAM4
                                
000797 4797 FE2C             7      CP  ','
000799 4799 2019            12      JR  NZ,RCP_ST
                                
00079B 479B 7E               7      LD  A,(HL)
00079C 479C 0604             7      LD  B,4
00079E 479E FEC3             7      CP  0C3H        ;PRESET
0007A0 47A0 280E            12      JR  Z,RCP_LO
0007A2 47A2 05               4      DEC B       ;3
0007A3 47A3 D6F8             7      SUB 0F8H        ;XOR
0007A5 47A5 2809            12      JR  Z,RCP_LO
0007A7 47A7 05               4      DEC B       ;2
0007A8 47A8 3C               4      INC A       ;OR
0007A9 47A9 2805            12      JR  Z,RCP_LO
0007AB 47AB 05               4      DEC B       ;1
0007AC 47AC 3C               4      INC A       ;AND
0007AD 47AD 2801            12      JR  Z,RCP_LO
0007AF 47AF 05               4      DEC B       ;0
                                                ;PSET
       47B0                     RCP_LO:
0007B0 47B0 78               4      LD  A,B
0007B1 47B1 3235F1          13      LD  (_BUF_LO),A
       47B4                     RCP_ST:
0007B4 47B4 2AC6F6          16      LD  HL,(STREND)
0007B7 47B7 2230F1          16      LD  (_DTA),HL
0007BA 47BA EB               4      EX  DE,HL
0007BB 47BB 2100FE          10      LD  HL,-512
0007BE 47BE 39              11      ADD HL,SP
0007BF 47BF AF               4      XOR A
0007C0 47C0 ED52            15      SBC HL,DE
0007C2 47C2 3008            12      JR  NC,RCP0
0007C4 47C4 215EF5          10      LD  HL,BUF
0007C7 47C7 2230F1          16      LD  (_DTA),HL
0007CA 47CA 6F               4      LD  L,A ;0
0007CB 47CB 67               4      LD  H,A ;0
       47CC                     RCP0:
0007CC 47CC 24               4      INC H
0007CD 47CD 2238F1          16      LD  (_BUF_EN),HL
       47D0                     RCP1:
0007D0 47D0 F3               4      DI
0007D1 47D1 CDA548          17      CALL    WAIT_VDP
                                
0007D4 47D4 3A0700          13      LD  A,(WRVDP)
0007D7 47D7 4F               4      LD  C,A
0007D8 47D8 0C               4      INC C       ;C := PORT#1's address(WR)
0007D9 47D9 3E24             7      LD  A,36
0007DB 47DB ED79            12      OUT (C),A
0007DD 47DD 3E91             7      LD  A,080H+17
0007DF 47DF ED79            12      OUT (C),A       ;R#17 := 36
                                
0007E1 47E1 0C               4      INC C
0007E2 47E2 0C               4      INC C       ;C := PORT#3's address(WR)
0007E3 47E3 2A3EF1          16      LD  HL,(_BUF_X)
0007E6 47E6 ED69            12      OUT (C),L       ;R#36 DX
0007E8 47E8 ED61            12      OUT (C),H       ;R#37
0007EA 47EA 2A40F1          16      LD  HL,(_BUF_Y)
0007ED 47ED ED69            12      OUT (C),L       ;R#38 DY
0007EF 47EF ED61            12      OUT (C),H       ;R#39
0007F1 47F1 2A3AF1          16      LD  HL,(_BUF_W)
0007F4 47F4 ED69            12      OUT (C),L       ;R#40 NX
0007F6 47F6 ED61            12      OUT (C),H       ;R#41
0007F8 47F8 2A3CF1          16      LD  HL,(_BUF_H)
0007FB 47FB ED69            12      OUT (C),L       ;R#42 NY
0007FD 47FD ED61            12      OUT (C),H       ;R#43
                                
0007FF 47FF DD2AAFFC        20      LD  IX,(SCRMOD)
000803 4803 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000806 4806 B7               4      OR  A
000807 4807 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000809 4809 DD7D             9      LD  A,IXL
00080B 480B FE08             7      CP  8
00080D 480D 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
00080F 480F FE06             7      CP  6
000811 4811 2A3EF1          16      LD  HL,(_BUF_X)
000814 4814 3A3AF1          13      LD  A,(_BUF_W)
000817 4817 2005            12      JR  NZ,SCR57
000819 4819 B5               4      OR  L       ;スクリーン6
00081A 481A E603             7      AND 3
00081C 481C 200D            12      JR  NZ,USE_LMMC
       481E                     SCR57:              ;スクリーン5,7
00081E 481E B5               4      OR  L
00081F 481F E601             7      AND 1
000821 4821 2008            12      JR  NZ,USE_LMMC
       4823                     USE_HMMC:
000823 4823 DD2E08          10      LD  IXL,8
       4826                     USE_HMMC8:
000826 4826 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000828 4828 3235F1          13      LD  (_BUF_LO),A
       482B                     USE_LMMC:
00082B 482B 110000          10      LD  DE,0
00082E 482E 06FF             7      LD  B,-1
000830 4830 CDD048          17      CALL    GET_PIXEL
000833 4833 ED79            12      OUT (C),A       ;R#44 first DATA
000835 4835 3A42F1          13      LD  A,(_BUF_O)
000838 4838 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
00083A 483A 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00083D 483D F6B0             7      OR  0B0H        ;R#46 LMMC command
00083F 483F ED79            12      OUT (C),A
                                
000841 4841 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000843 4843 0D               4      DEC C
000844 4844 0D               4      DEC C       ;C := PORT#1's address(WR)
000845 4845 3EAC             7      LD  A,080H+44
000847 4847 ED79            12      OUT (C),A
000849 4849 3E91             7      LD  A,080H+17
00084B 484B ED79            12      OUT (C),A       ;R#17 := 44
                                
00084D 484D 3A0600          13      LD  A,(RDVDP)
000850 4850 3C               4      INC A
000851 4851 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000853 4853 3E02             7      LD  A,2
000855 4855 ED79            12      OUT (C),A
000857 4857 3E8F             7      LD  A,08FH
000859 4859 ED79            12      OUT (C),A
00085B 485B 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00085E 485E E640             7      AND 040H
000860 4860 201C            12      JR  NZ,LOOP_HMMC
       4862                     LOOP_COPY:
000862 4862 CDD048          17      CALL    GET_PIXEL
000865 4865 08               4      EX  AF,AF'
000866 4866 FD4C             9      LD  C,IYH
       4868                     LOOP_COPY1:
000868 4868 ED78            12      IN  A,(C)
00086A 486A 0F               4      RRCA            ;RRCAではサインフラグは変化しない
00086B 486B 300A            12      JR  NC,EXIT_COPY    ;check CE bit
00086D 486D F26848          10      JP  P,LOOP_COPY1    ;check TR bit
000870 4870 08               4      EX  AF,AF'
000871 4871 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000873 4873 ED79            12      OUT (C),A
000875 4875 18EB            12      JR  LOOP_COPY
                                
       4877                     EXIT_COPY:
000877 4877 CDAD48          17      CALL    GET_STATUS_0
00087A 487A FB               4      EI
00087B 487B C32F46          10      JP  ROM_NEXT
                                
       487E                     LOOP_HMMC:
00087E 487E FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000880 4880 43               4      LD  B,E
000881 4881 7B               4      LD  A,E
000882 4882 B7               4      OR  A
000883 4883 2802            12      JR  Z,LOOP_HMMC1
000885 4885 EDB3                    OTIR
       4887                     LOOP_HMMC1:
000887 4887 14               4      INC D
       4888                     LOOP_HMMC2:
000888 4888 15               4      DEC D
000889 4889 2805            12      JR  Z,LOOP_HMMC3
00088B 488B EDB3                    OTIR
00088D 488D C38848          10      JP  LOOP_HMMC2
       4890                     LOOP_HMMC3:
000890 4890 ED78            12      IN  A,(C)
000892 4892 0F               4      RRCA
000893 4893 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
000895 4895 2A38F1          16      LD  HL,(_BUF_EN)
000898 4898 CD1749          17      CALL    ROM_READ
00089B 489B EB               4      EX  DE,HL
00089C 489C 2A30F1          16      LD  HL,(_DTA)
00089F 489F 7A               4      LD  A,D
0008A0 48A0 B3               4      OR  E
0008A1 48A1 20DB            12      JR  NZ,LOOP_HMMC
0008A3 48A3 18C3            12      JR  LOOP_COPY1
                                    
       48A5                     WAIT_VDP:
0008A5 48A5 3E02             7      LD  A,2
0008A7 48A7 CDAE48          17      CALL    GET_STATUS
0008AA 48AA 0F               4      RRCA
0008AB 48AB 38F8            12      JR  C,WAIT_VDP
       48AD                     GET_STATUS_0:
0008AD 48AD AF               4      XOR A
       48AE                     GET_STATUS:
0008AE 48AE C5              11      PUSH    BC
0008AF 48AF ED4B0600        20      LD  BC,(RDVDP)
0008B3 48B3 0C               4      INC C
0008B4 48B4 ED79            12      OUT (C),A
0008B6 48B6 3E8F             7      LD  A,08FH
0008B8 48B8 ED79            12      OUT (C),A
0008BA 48BA ED78            12      IN  A,(C)
0008BC 48BC C1              10      POP BC
0008BD 48BD C9              10      RET
                                
       48BE                     GET_PIXEL256:
0008BE 48BE 7A               4      LD  A,D
0008BF 48BF B3               4      OR  E
0008C0 48C0 200A            12      JR  NZ,GET_PIXEL1
0008C2 48C2 2A38F1          16      LD  HL,(_BUF_EN)
0008C5 48C5 CD1749          17      CALL    ROM_READ
0008C8 48C8 EB               4      EX  DE,HL
0008C9 48C9 2A30F1          16      LD  HL,(_DTA)
       48CC                     GET_PIXEL1:
0008CC 48CC 7E               7      LD  A,(HL)
0008CD 48CD 23               6      INC HL
0008CE 48CE 1B               6      DEC DE
0008CF 48CF C9              10      RET
                                
       48D0                     GET_PIXEL:
0008D0 48D0 04               4      INC B
0008D1 48D1 DD7D             9      LD  A,IXL
0008D3 48D3 FE08             7      CP  8
0008D5 48D5 28E7            12      JR  Z,GET_PIXEL256
0008D7 48D7 FE06             7      CP  6
0008D9 48D9 282E            12      JR  Z,GET_PIXEL4
                                
0008DB 48DB CB40             8      BIT 0,B
0008DD 48DD 20ED            12      JR  NZ,GET_PIXEL1
                                
0008DF 48DF 7A               4      LD  A,D
0008E0 48E0 B3               4      OR  E
0008E1 48E1 200A            12      JR  NZ,GET_PIXEL2
                                
0008E3 48E3 2A38F1          16      LD  HL,(_BUF_EN)
0008E6 48E6 CD1749          17      CALL    ROM_READ
0008E9 48E9 EB               4      EX  DE,HL
0008EA 48EA 2A30F1          16      LD  HL,(_DTA)
                                
       48ED                     GET_PIXEL2:
0008ED 48ED 7E               7      LD  A,(HL)
0008EE 48EE 0F               4      RRCA
0008EF 48EF 0F               4      RRCA
0008F0 48F0 0F               4      RRCA
0008F1 48F1 0F               4      RRCA
0008F2 48F2 C9              10      RET
                                
       48F3                     GET_PIXEL3:
0008F3 48F3 7A               4      LD  A,D
0008F4 48F4 B3               4      OR  E
0008F5 48F5 200A            12      JR  NZ,GET_PIXEL5
                                
0008F7 48F7 2A38F1          16      LD  HL,(_BUF_EN)
0008FA 48FA CD1749          17      CALL    ROM_READ
0008FD 48FD EB               4      EX  DE,HL
0008FE 48FE 2A30F1          16      LD  HL,(_DTA)
       4901                     GET_PIXEL5:
000901 4901 7E               7      LD  A,(HL)
000902 4902 0F               4      RRCA
000903 4903 0F               4      RRCA
000904 4904 0F               4      RRCA
000905 4905 0F               4      RRCA
000906 4906 0F               4      RRCA
000907 4907 0F               4      RRCA
000908 4908 C9              10      RET
                                
       4909                     GET_PIXEL4:
000909 4909 78               4      LD  A,B
00090A 490A E603             7      AND 3   ;+0
00090C 490C 28E5            12      JR  Z,GET_PIXEL3
00090E 490E 3D               4      DEC A   ;+1
00090F 490F 28DC            12      JR  Z,GET_PIXEL2
000911 4911 3D               4      DEC A   ;+2
000912 4912 7E               7      LD  A,(HL)
000913 4913 C0              11      RET NZ
000914 4914 0F               4      RRCA        ;+3
000915 4915 0F               4      RRCA
000916 4916 C9              10      RET
                                
       4917                     ROM_READ:
000917 4917 E5              11      PUSH    HL
000918 4918 D5              11      PUSH    DE
000919 4919 C5              11      PUSH    BC
00091A 491A FDE5            15      PUSH    IY
00091C 491C 224AF1          16      LD  (LEFTX),HL
00091F 491F 2A30F1          16      LD  HL,(_DTA)
000922 4922 2243F1          16      LD  (DTAX),HL
000925 4925 2A4AF1          16      LD  HL,(LEFTX)
                                
000928 4928 CDCA4B          17      CALL    RBX1
00092B 492B 3870            12      JR  C,RBRERR1
00092D 492D 79               4      LD  A,C
00092E 492E EB               4      EX  DE,HL
00092F 492F ED52            15      SBC HL,DE       ;CP 0HL,CDE
000931 4931 19              11      ADD HL,DE
000932 4932 DE00             7      SBC A,000H
000934 4934 3801            12      JR  C,RBR1
000936 4936 EB               4      EX  DE,HL
       4937                     RBR1:
000937 4937 9F               4      SBC A,A
000938 4938 E601             7      AND 1
00093A 493A 321FF1          13      LD  (_RESULT),A
00093D 493D 7C               4      LD  A,H
00093E 493E B5               4      OR  L
00093F 493F CA9349          10      JP  Z,RBREND0
                                
000942 4942 222CF1          16      LD  (_LEFT),HL  ;Read record byte
000945 4945 224AF1          16      LD  (LEFTX),HL
                                
000948 4948 CDF64B          17      CALL    RBX2
00094B 494B 281A            12      JR  Z,RBRB
                                                ;先頭の端数
00094D 494D CD094C          17      CALL    RBXA
000950 4950 DAA949          10      JP  C,RBRERR
000953 4953 C5              11      PUSH    BC
000954 4954 CD3844          17      CALL    ROM_LDIR
000957 4957 ED5343F1        20      LD  (DTAX),DE
00095B 495B 2A4AF1          16      LD  HL,(LEFTX)
00095E 495E D1              10      POP DE
00095F 495F A7               4      AND A
000960 4960 ED52            15      SBC HL,DE
000962 4962 224AF1          16      LD  (LEFTX),HL
000965 4965 2829            12      JR  Z,RBREND
                                
       4967                     RBRB:
000967 4967 CD454C          17      CALL    RBXB
00096A 496A 2818            12      JR  Z,RBRC
       496C                     RBRB1:
00096C 496C C5              11      PUSH    BC
00096D 496D D5              11      PUSH    DE
00096E 496E CDF04C          17      CALL    CLUST
000971 4971 EB               4      EX  DE,HL
000972 4972 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000976 4976 CD3844          17      CALL    ROM_LDIR
000979 4979 EB               4      EX  DE,HL
00097A 497A D1              10      POP DE
00097B 497B C1              10      POP BC
00097C 497C CDCD4C          17      CALL    GNCL
00097F 497F DAA949          10      JP  C,RBRERR
000982 4982 10E8            13      DJNZ    RBRB1
       4984                     RBRC:
000984 4984 CD5D4C          17      CALL    RBXC
000987 4987 2807            12      JR  Z,RBREND
                                
000989 4989 CDF04C          17      CALL    CLUST
00098C 498C EB               4      EX  DE,HL
00098D 498D CD3844          17      CALL    ROM_LDIR
       4990                     RBREND:
000990 4990 CD694C          17      CALL    RBXEND
       4993                     RBREND0:
000993 4993 FDE1            14      POP IY
000995 4995 C1              10      POP BC
000996 4996 D1              10      POP DE
000997 4997 F1              10      POP AF  ;(HL)
000998 4998 AF               4      XOR A
000999 4999 3A1FF1          13      LD  A,(_RESULT)
00099C 499C C9              10      RET
                                
       499D                     RBRERR1:
00099D 499D 3E01             7      LD  A,001H
       499F                     RBRERR2:
00099F 499F FDE1            14      POP IY
0009A1 49A1 C1              10      POP BC
0009A2 49A2 D1              10      POP DE
0009A3 49A3 E1              10      POP HL
0009A4 49A4 37               4      SCF
0009A5 49A5 210000          10      LD  HL,0
0009A8 49A8 C9              10      RET
       49A9                     RBRERR:
0009A9 49A9 3EFF             7      LD  A,0FFH
0009AB 49AB 18F2            12      JR  RBRERR2
                                
       49AD                     FILE_DD:
0009AD 49AD E1              10      POP HL
0009AE 49AE 3E                      DB  03EH
0009AF 49AF C9              10      RET
0009B0 49B0 320CF1          13      LD  (SWC_BLOAD_M),A
       49B3                     ROM_ORG:
0009B3 49B3 2A4CF1          16      LD  HL,(PARAM0)
0009B6 49B6 7E               7      LD  A,(HL)
0009B7 49B7 C9              10      RET
       49B8                     FILE_B:
0009B8 49B8 AF               4      XOR A
0009B9 49B9 3250F1          13      LD  (FDRV),A
0009BC 49BC 1E00             7      LD  E,0
0009BE 49BE 3A63F6          13      LD  A,(VALTYP)
0009C1 49C1 FE03             7      CP  3       ;string
0009C3 49C3 C2484A          10      JP  NZ,FILED
                                
0009C6 49C6 DD21D067        14      LD  IX,FRESTR
0009CA 49CA FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009CE 49CE CD1C00          17      CALL    _CALSLT
0009D1 49D1 E5              11      PUSH    HL
0009D2 49D2 DDE1            14      POP IX
                                
0009D4 49D4 DD5E00          19      LD  E,(IX+0)
0009D7 49D7 DD7E01          19      LD  A,(IX+1)
0009DA 49DA DD5602          19      LD  D,(IX+2)
0009DD 49DD DD62             9      LD  IXH,D
0009DF 49DF DD6F             9      LD  IXL,A
0009E1 49E1 7B               4      LD  A,E
       49E2                     FILE_BDOS:
0009E2 49E2 FE04             7      CP  4
0009E4 49E4 3808            12      JR  C,FILEB1
0009E6 49E6 DD7E03          19      LD  A,(IX+3)
0009E9 49E9 FE3A             7      CP  ':'
0009EB 49EB 28C0            12      JR  Z,FILE_DD
0009ED 49ED 7B               4      LD  A,E
       49EE                     FILEB1:
0009EE 49EE FE02             7      CP  2
0009F0 49F0 3818            12      JR  C,DEVI1
0009F2 49F2 DD7E01          19      LD  A,(IX+1)
0009F5 49F5 FE3A             7      CP  ':'
0009F7 49F7 2011            12      JR  NZ,DEVI1
0009F9 49F9 DD7E00          19      LD  A,(IX+0)        ;DRIVE
0009FC 49FC CD214B          17      CALL    CAP
0009FF 49FF D640             7      SUB '@'
000A01 4A01 DD23            10      INC IX
000A03 4A03 DD23            10      INC IX
000A05 4A05 1D               4      DEC E
000A06 4A06 1D               4      DEC E
000A07 4A07 3250F1          13      LD  (FDRV),A
       4A0A                     DEVI1:
000A0A 4A0A DD7E00          19      LD  A,(IX+0)
000A0D 4A0D D65C             7      SUB 05CH        ;\
000A0F 4A0F 2008            12      JR  NZ,NOROOT
000A11 4A11 6F               4      LD  L,A
000A12 4A12 67               4      LD  H,A
000A13 4A13 225EF1          16      LD  (_CDX),HL
000A16 4A16 DD23            10      INC IX
000A18 4A18 1D               4      DEC E
       4A19                     NOROOT:
                                
       4A19                     SETDIR:
000A19 4A19 CD484A          17      CALL    FILED
000A1C 4A1C DD7E00          19      LD  A,(IX+0)
000A1F 4A1F FE5C             7      CP  05CH        ;\
000A21 4A21 C0              11      RET NZ
000A22 4A22 DD23            10      INC IX
000A24 4A24 1D               4      DEC E
000A25 4A25 3A51F1          13      LD  A,(FNAME)
000A28 4A28 FE20             7      CP  020H        ;. の処理
000A2A 4A2A 28ED            12      JR  Z,SETDIR
                                
000A2C 4A2C CD374B          17      CALL    ROM_OPEN
000A2F 4A2F B7               4      OR  A
000A30 4A30 C0              11      RET NZ
                                
000A31 4A31 FD2A47F1        20      LD  IY,(DIRENT1)
000A35 4A35 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000A39 4A39 C8              11      RET Z
000A3A 4A3A CD8F4A          17      CALL    FILEI
000A3D 4A3D FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000A40 4A40 FD661B          19      LD  H,(IY+01BH)
000A43 4A43 225EF1          16      LD  (_CDX),HL
000A46 4A46 18D1            12      JR  SETDIR
                                
       4A48                     FILED:
000A48 4A48 CD8F4A          17      CALL    FILEI
000A4B 4A4B 2151F1          10      LD  HL,FNAME
                                
000A4E 4A4E 0608             7      LD  B,8
       4A50                     FILE2:
000A50 4A50 CD9C4A          17      CALL    CCHKF
000A53 4A53 C8              11      RET Z
000A54 4A54 FE2A             7      CP  '*'
000A56 4A56 282E            12      JR  Z,FILE9
000A58 4A58 FE2E             7      CP  '.'
000A5A 4A5A 280C            12      JR  Z,FILE4
000A5C 4A5C 77               7      LD  (HL),A
000A5D 4A5D 23               6      INC HL
000A5E 4A5E 10F0            13      DJNZ    FILE2
                                
       4A60                     FILE3:
000A60 4A60 CD9C4A          17      CALL    CCHKF
000A63 4A63 C8              11      RET Z
000A64 4A64 FE2E             7      CP  '.'
000A66 4A66 20F8            12      JR  NZ,FILE3
                                
       4A68                     FILE4:
000A68 4A68 2159F1          10      LD  HL,FNAME+8
000A6B 4A6B 0603             7      LD  B,3
                                
       4A6D                     FILE4L:
000A6D 4A6D CD9C4A          17      CALL    CCHKF
000A70 4A70 C8              11      RET Z
000A71 4A71 FE2E             7      CP  '.'
000A73 4A73 2008            12      JR  NZ,FILE12
000A75 4A75 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000A78 4A78 3252F1          13      LD  (FNAME+1),A
000A7B 4A7B 3E20             7      LD  A,020H
       4A7D                     FILE12:
000A7D 4A7D FE2A             7      CP  '*'
000A7F 4A7F 280A            12      JR  Z,FILE10
000A81 4A81 77               7      LD  (HL),A
000A82 4A82 23               6      INC HL
000A83 4A83 10E8            13      DJNZ    FILE4L
000A85 4A85 C9              10      RET
                                
       4A86                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000A86 4A86 CD8B4A          17      CALL    FILE10
000A89 4A89 18D5            12      JR  FILE3
                                
       4A8B                     FILE10:
000A8B 4A8B 3E3F             7      LD  A,'?'
000A8D 4A8D 1808            12      JR  FILL_MEMORY
       4A8F                     FILEI:              ;名前＋拡張子をスペースで初期化
000A8F 4A8F 3E20             7      LD  A,020H
000A91 4A91 01000B          10      LD  BC,11*256   ;C=0にしておく
000A94 4A94 2151F1          10      LD  HL,FNAME
       4A97                     FILL_MEMORY:            ;HLからBバイトAで埋める
000A97 4A97 77               7      LD  (HL),A
000A98 4A98 23               6      INC HL
000A99 4A99 10FC            13      DJNZ    FILL_MEMORY
000A9B 4A9B C9              10      RET
                                
       4A9C                     CCHKF:
000A9C 4A9C 7B               4      LD  A,E
000A9D 4A9D B7               4      OR  A
000A9E 4A9E C8              11      RET Z
000A9F 4A9F DD7E00          19      LD  A,(IX+0)
000AA2 4AA2 CDA94A          17      CALL    CCHK2
000AA5 4AA5 C8              11      RET Z
000AA6 4AA6 C30C4B          10      JP  FKAN
                                
       4AA9                     CCHK2:
000AA9 4AA9 0C               4      INC C
000AAA 4AAA 0D               4      DEC C
000AAB 4AAB C0              11      RET NZ
       4AAC                     CCHK3:              ;ZF=1 で使えない文字
000AAC 4AAC FE2B             7      CP  '+'
000AAE 4AAE C8              11      RET Z
000AAF 4AAF FE2C             7      CP  ','
000AB1 4AB1 C8              11      RET Z
000AB2 4AB2 FE2F             7      CP  '/'
000AB4 4AB4 C8              11      RET Z
000AB5 4AB5 FE3A             7      CP  ':'
000AB7 4AB7 C8              11      RET Z
000AB8 4AB8 FE3B             7      CP  ';'
000ABA 4ABA C8              11      RET Z
000ABB 4ABB FE3D             7      CP  '='
000ABD 4ABD C8              11      RET Z
000ABE 4ABE FE5C             7      CP  05CH    ;\
000AC0 4AC0 C8              11      RET Z
000AC1 4AC1 FE1F             7      CP  01FH
000AC3 4AC3 D0              11      RET NC
000AC4 4AC4 BF               4      CP  A       ;Z=1
000AC5 4AC5 C9              10      RET
                                
       4AC6                     SS1:
000AC6 4AC6 13               6      INC DE
       4AC7                     SPCUT:              ;スペースをカット
000AC7 4AC7 1A               7      LD  A,(DE)
000AC8 4AC8 FE20             7      CP  020H
000ACA 4ACA 28FA            12      JR  Z,SS1
000ACC 4ACC C9              10      RET
                                
       4ACD                     SCREOF1:
000ACD 4ACD 13               6      INC DE
       4ACE                     SPCUTEX:            ;スペース改行などをカット
000ACE 4ACE 1A               7      LD  A,(DE)
000ACF 4ACF FE20             7      CP  020H
000AD1 4AD1 28FA            12      JR  Z,SCREOF1
000AD3 4AD3 FE0D             7      CP  00DH
000AD5 4AD5 28F6            12      JR  Z,SCREOF1
000AD7 4AD7 FE0A             7      CP  00AH
000AD9 4AD9 28F2            12      JR  Z,SCREOF1
000ADB 4ADB FE1A             7      CP  01AH
000ADD 4ADD 28EE            12      JR  Z,SCREOF1
000ADF 4ADF C9              10      RET
                                
       4AE0                     GETNUM:
000AE0 4AE0 210000          10      LD  HL,0
       4AE3                     GETNUM1:
000AE3 4AE3 1A               7      LD  A,(DE)
000AE4 4AE4 13               6      INC DE
000AE5 4AE5 D630             7      SUB '0'
000AE7 4AE7 D8              11      RET C
000AE8 4AE8 FE0A             7      CP  10
000AEA 4AEA D0              11      RET NC
000AEB 4AEB 4D               4      LD  C,L
000AEC 4AEC 44               4      LD  B,H
000AED 4AED 29              11      ADD HL,HL   ;*2
000AEE 4AEE 29              11      ADD HL,HL   ;*4
000AEF 4AEF 09              11      ADD HL,BC   ;*5
000AF0 4AF0 29              11      ADD HL,HL   ;*10
000AF1 4AF1 4F               4      LD  C,A
000AF2 4AF2 0600             7      LD  B,0
000AF4 4AF4 09              11      ADD HL,BC
000AF5 4AF5 18EC            12      JR  GETNUM1
                                
       4AF7                     SEARCH_END:
000AF7 4AF7 7E               7      LD  A,(HL)
       4AF8                     SEARCH_END1:
000AF8 4AF8 23               6      INC HL
000AF9 4AF9 B7               4      OR  A
000AFA 4AFA C8              11      RET Z
000AFB 4AFB FE3A             7      CP  ':'
000AFD 4AFD 20F8            12      JR  NZ,SEARCH_END
000AFF 4AFF 7E               7      LD  A,(HL)
000B00 4B00 FE3A             7      CP  ':'
000B02 4B02 28F4            12      JR  Z,SEARCH_END1
000B04 4B04 C9              10      RET
                                
       4B05                     FKANC:
000B05 4B05 CB41             8      BIT 0,C
000B07 4B07 CC2A4B          17      CALL    Z,CAP2
000B0A 4B0A 1803            12      JR  FKANX
       4B0C                     FKAN:           ;漢字チェック
000B0C 4B0C DD23            10      INC IX
000B0E 4B0E 1D               4      DEC E
       4B0F                     FKANX:
000B0F 4B0F CB41             8      BIT 0,C
000B11 4B11 CB81             8      RES 0,C
000B13 4B13 C0              11      RET NZ
000B14 4B14 FE80             7      CP  080H
000B16 4B16 D8              11      RET C
000B17 4B17 FEA0             7      CP  0A0H
000B19 4B19 3803            12      JR  C,FKAN1
000B1B 4B1B FEE0             7      CP  0E0H
000B1D 4B1D D8              11      RET C
       4B1E                     FKAN1:
000B1E 4B1E 0C               4      INC C
000B1F 4B1F A7               4      AND A
000B20 4B20 C9              10      RET
                                
       4B21                     CAP:
000B21 4B21 FE61             7      CP  'a'
000B23 4B23 D8              11      RET C
000B24 4B24 FE7B             7      CP  'z'+1
000B26 4B26 D0              11      RET NC
000B27 4B27 D620             7      SUB 020H
000B29 4B29 C9              10      RET
       4B2A                     CAP2:
000B2A 4B2A CD214B          17      CALL    CAP
       4B2D                     CAP3:               ;
000B2D 4B2D FE05             7      CP  5
000B2F 4B2F 2803            12      JR  Z,CAP4
000B31 4B31 FE21             7      CP  021H
000B33 4B33 C9              10      RET
       4B34                     CAP4:
000B34 4B34 3EE5             7      LD  A,0E5H
000B36 4B36 C9              10      RET
                                
       4B37                     ROM_OPEN:
000B37 4B37 CD2850          17      CALL    GET_DISK_BANK_FDRV
                                
000B3A 4B3A CDA44D          17      CALL    GET_DIR_DAT
000B3D 4B3D D5              11      PUSH    DE
000B3E 4B3E CD534B          17      CALL    FILESE
000B41 4B41 D1              10      POP DE
000B42 4B42 3F               4      CCF
000B43 4B43 D8              11      RET C
000B44 4B44 2247F1          16      LD  (DIRENT1),HL
000B47 4B47 E5              11      PUSH    HL
000B48 4B48 210000          10      LD  HL,0
000B4B 4B4B 2226F1          16      LD  (RR_LOW),HL
000B4E 4B4E 2228F1          16      LD  (RR_HIGH),HL
000B51 4B51 E1              10      POP HL
000B52 4B52 C9              10      RET
                                
       4B53                     FILESE:
000B53 4B53 7E               7      LD  A,(HL)
000B54 4B54 B7               4      OR  A
000B55 4B55 C8              11      RET Z       ;END:ZF=1 CF=0
000B56 4B56 FEE5             7      CP  0E5H
000B58 4B58 280D            12      JR  Z,FILESE1
000B5A 4B5A 1151F1          10      LD  DE,FNAME
000B5D 4B5D E5              11      PUSH    HL
000B5E 4B5E CDA44B          17      CALL    CPFILE
000B61 4B61 CCC54B          17      CALL    Z,CPFILE2
000B64 4B64 E1              10      POP HL
000B65 4B65 37               4      SCF
000B66 4B66 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B67                     FILESE1:
000B67 4B67 CD6F4B          17      CALL    FNEXT
000B6A 4B6A 20E7            12      JR  NZ,FILESE
000B6C 4B6C F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B6E 4B6E C9              10      RET
                                
       4B6F                     FNEXT:
000B6F 4B6F 112000          10      LD  DE,020H
000B72 4B72 19              11      ADD HL,DE
000B73 4B73 ED5B5EF1        20      LD  DE,(_CDX)
000B77 4B77 7A               4      LD  A,D
000B78 4B78 B3               4      OR  E
000B79 4B79 2019            12      JR  NZ,FNEXT_SUBDIR
000B7B 4B7B 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
       4B7C                     CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
000B7C 4B7C F5              11      PUSH    AF      ;※フラグを保存する必要あり
000B7D 4B7D CB7C             8      BIT 7,H
000B7F 4B7F 2811            12      JR  Z,CHECK_DIR_PAGE1
000B81 4B81 7C               4      LD  A,H
000B82 4B82 D620             7      SUB 020H
000B84 4B84 67               4      LD  H,A
000B85 4B85 3A49F1          13      LD  A,(_DIR_BANK)
000B88 4B88 3C               4      INC A
000B89 4B89 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B8C 4B8C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B8F 4B8F 3249F1          13      LD  (_DIR_BANK),A
       4B92                     CHECK_DIR_PAGE1:
000B92 4B92 F1              10      POP AF
                                #endif
000B93 4B93 C9              10      RET
                                
       4B94                     FNEXT_SUBDIR:           ;サブディレクトリ
000B94 4B94 0D               4      DEC C
000B95 4B95 C0              11      RET NZ
                                
000B96 4B96 ED5B5EF1        20      LD  DE,(_CDX)
000B9A 4B9A CDCD4C          17      CALL    GNCL
000B9D 4B9D EB               4      EX  DE,HL
000B9E 4B9E 225EF1          16      LD  (_CDX),HL
000BA1 4BA1 C3DF4D          10      JP  GET_SUBDIR
                                
       4BA4                     CPFILE:
000BA4 4BA4 C5              11      PUSH    BC
000BA5 4BA5 01000B          10      LD  BC,00B00H
       4BA8                     CPSTR1:
000BA8 4BA8 1A               7      LD  A,(DE)
000BA9 4BA9 FE3F             7      CP  '?'     ;Wild card
000BAB 4BAB 2812            12      JR  Z,CPSTR2
000BAD 4BAD 7E               7      LD  A,(HL)
000BAE 4BAE CD054B          17      CALL    FKANC
000BB1 4BB1 E5              11      PUSH    HL
000BB2 4BB2 67               4      LD  H,A
000BB3 4BB3 1A               7      LD  A,(DE)
000BB4 4BB4 CB01             4      RLC C
000BB6 4BB6 CD054B          17      CALL    FKANC
000BB9 4BB9 CB09             4      RRC C
000BBB 4BBB BC               4      CP  H       ;CP (HL),(DE)
000BBC 4BBC E1              10      POP HL
000BBD 4BBD 2004            12      JR  NZ,CPSTR3
       4BBF                     CPSTR2:
000BBF 4BBF 13               6      INC DE
000BC0 4BC0 23               6      INC HL
000BC1 4BC1 10E5            13      DJNZ    CPSTR1
       4BC3                     CPSTR3:
000BC3 4BC3 C1              10      POP BC
000BC4 4BC4 C9              10      RET
                                
       4BC5                     CPFILE2:
                                ;   LD  A,0E1H
000BC5 4BC5 3EF1             7      LD  A,0F1H
000BC7 4BC7 2F               4      CPL
000BC8 4BC8 A6               7      AND (HL)
000BC9 4BC9 C9              10      RET
                                
       4BCA                     RBX1:
000BCA 4BCA E5              11      PUSH    HL      ;Record byte
                                
000BCB 4BCB ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000BCF 4BCF 3A29F1          13      LD  A,(RR_HIGH+1)
000BD2 4BD2 4F               4      LD  C,A
                                
000BD3 4BD3 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000BD6 4BD6 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000BD9 4BD9 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000BDC 4BDC FD2A47F1        20      LD  IY,(DIRENT1)
000BE0 4BE0 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BE3 4BE3 FD661D          19      LD  H,(IY+01DH)
000BE6 4BE6 FD7E1E          19      LD  A,(IY+01EH)
                                
000BE9 4BE9 A7               4      AND A
000BEA 4BEA ED52            15      SBC HL,DE
000BEC 4BEC 99               4      SBC A,C
000BED 4BED D1              10      POP DE
                                
000BEE 4BEE D8              11      RET C
000BEF 4BEF 4F               4      LD  C,A
000BF0 4BF0 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BF1 4BF1 B2               4      OR  D
000BF2 4BF2 B3               4      OR  E
000BF3 4BF3 C0              11      RET NZ
000BF4 4BF4 37               4      SCF
000BF5 4BF5 C9              10      RET
                                
       4BF6                     RBX2:
000BF6 4BF6 ED4B27F1        20      LD  BC,(RR_LOW+1)
000BFA 4BFA CD7E4C          17      CALL    RWXR
000BFD 4BFD 3A23F1          13      LD  A,(CLSZ_H)
000C00 4C00 3D               4      DEC A
000C01 4C01 E5              11      PUSH    HL
000C02 4C02 2A26F1          16      LD  HL,(RR_LOW)
000C05 4C05 A4               4      AND H
000C06 4C06 B5               4      OR  L
000C07 4C07 E1              10      POP HL
000C08 4C08 C9              10      RET
                                
       4C09                     RBXA:
000C09 4C09 D5              11      PUSH    DE
000C0A 4C0A CDF04C          17      CALL    CLUST
000C0D 4C0D ED532EF1        20      LD  (_DTPS),DE
000C11 4C11 D1              10      POP DE
000C12 4C12 CDCD4C          17      CALL    GNCL
000C15 4C15 D8              11      RET C
000C16 4C16 ED532AF1        20      LD  (_CLPS),DE
                                
000C1A 4C1A ED4B26F1        20      LD  BC,(RR_LOW)
000C1E 4C1E 2A22F1          16      LD  HL,(CLSZ)
000C21 4C21 7C               4      LD  A,H
000C22 4C22 3D               4      DEC A
000C23 4C23 A0               4      AND B
000C24 4C24 47               4      LD  B,A
000C25 4C25 ED42            15      SBC HL,BC       ;remaining cluster
                                
000C27 4C27 ED5B4AF1        20      LD  DE,(LEFTX)
000C2B 4C2B ED52            15      SBC HL,DE       ;CP HL,DE
000C2D 4C2D 19              11      ADD HL,DE
000C2E 4C2E 3801            12      JR  C,RBXA1
000C30 4C30 EB               4      EX  DE,HL
       4C31                     RBXA1:
000C31 4C31 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C34 4C34 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C37 4C37 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C3A 4C3A E5              11      PUSH    HL
000C3B 4C3B 2A2EF1          16      LD  HL,(_DTPS)
000C3E 4C3E 09              11      ADD HL,BC
000C3F 4C3F ED5B43F1        20      LD  DE,(DTAX)
000C43 4C43 C1              10      POP BC
000C44 4C44 C9              10      RET
                                
       4C45                     RBXB:
000C45 4C45 2A43F1          16      LD  HL,(DTAX)
000C48 4C48 ED5B2AF1        20      LD  DE,(_CLPS)
000C4C 4C4C 3A4BF1          13      LD  A,(LEFTX+1)
000C4F 4C4F 47               4      LD  B,A
000C50 4C50 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C53                     RBXB1:
000C53 4C53 1F               4      RRA     ;->CF
000C54 4C54 3804            12      JR  C,RBXB2
000C56 4C56 CB38             8      SRL B   ;B=B/2
000C58 4C58 18F9            12      JR  RBXB1
       4C5A                     RBXB2:
000C5A 4C5A 78               4      LD  A,B
000C5B 4C5B B7               4      OR  A
000C5C 4C5C C9              10      RET
                                
       4C5D                     RBXC:
000C5D 4C5D ED4B4AF1        20      LD  BC,(LEFTX)
000C61 4C61 3A23F1          13      LD  A,(CLSZ_H)
000C64 4C64 3D               4      DEC A
000C65 4C65 A0               4      AND B
000C66 4C66 47               4      LD  B,A
000C67 4C67 B1               4      OR  C
000C68 4C68 C9              10      RET
                                
       4C69                     RBXEND:
000C69 4C69 ED5B2CF1        20      LD  DE,(_LEFT)
000C6D 4C6D 2A26F1          16      LD  HL,(RR_LOW)
000C70 4C70 3A29F1          13      LD  A,(RR_HIGH+1)
000C73 4C73 19              11      ADD HL,DE
000C74 4C74 CE00             7      ADC A,0
000C76 4C76 2226F1          16      LD  (RR_LOW),HL
000C79 4C79 3229F1          13      LD  (RR_HIGH+1),A
000C7C 4C7C EB               4      EX  DE,HL       ;HL=Read byte
000C7D 4C7D C9              10      RET 
                                
       4C7E                     RWXR:
000C7E 4C7E 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C81                     L_RWX:
000C81 4C81 1F               4      RRA     ;->CF
000C82 4C82 3806            12      JR  C,E_RWX
000C84 4C84 CB38             8      SRL B   ;BC=BC/2
000C86 4C86 CB19             8      RR  C   ;
000C88 4C88 18F7            12      JR  L_RWX
       4C8A                     E_RWX:
000C8A 4C8A 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
000C8D 4C8D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C90 4C90 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C93 4C93 FD2A47F1        20      LD  IY,(DIRENT1)
000C97 4C97 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C9A 4C9A FD561B          19      LD  D,(IY+01BH)
000C9D 4C9D CD2850          17      CALL    GET_DISK_BANK_FDRV
       4CA0                     RWX1:
000CA0 4CA0 ED532AF1        20      LD  (_CLPS),DE
000CA4 4CA4 7A               4      LD  A,D
000CA5 4CA5 B3               4      OR  E
000CA6 4CA6 37               4      SCF
000CA7 4CA7 C8              11      RET Z
                                
000CA8 4CA8 78               4      LD  A,B
000CA9 4CA9 B1               4      OR  C
000CAA 4CAA C8              11      RET Z
                                
000CAB 4CAB CDCD4C          17      CALL    GNCL
000CAE 4CAE D8              11      RET C
000CAF 4CAF 0B               6      DEC BC
000CB0 4CB0 CD3D4D          17      CALL    ENDCL
000CB3 4CB3 38EB            12      JR  C,RWX1
000CB5 4CB5 37               4      SCF
000CB6 4CB6 C9              10      RET
                                
       4CB7                     NCL3:
000CB7 4CB7 CD2850          17      CALL    GET_DISK_BANK_FDRV
000CBA 4CBA 6B               4      LD  L,E
000CBB 4CBB 62               4      LD  H,D
000CBC 4CBC CB3C             8      SRL H
000CBE 4CBE CB1D             8      RR  L
000CC0 4CC0 1F               4      RRA
000CC1 4CC1 19              11      ADD HL,DE
000CC2 4CC2 010060          10      LD  BC,BANK1_ADR
000CC5 4CC5 09              11      ADD HL,BC
000CC6 4CC6 ED4B24F1        20      LD  BC,(SECSZ)
000CCA 4CCA 09              11      ADD HL,BC
000CCB 4CCB 17               4      RLA
000CCC 4CCC C9              10      RET
                                
       4CCD                     GNCL:
000CCD 4CCD 7A               4      LD  A,D
000CCE 4CCE B3               4      OR  E
000CCF 4CCF 37               4      SCF
000CD0 4CD0 C8              11      RET Z
000CD1 4CD1 C5              11      PUSH    BC
000CD2 4CD2 E5              11      PUSH    HL
000CD3 4CD3 CDB74C          17      CALL    NCL3
000CD6 4CD6 3809            12      JR  C,GNC1
000CD8 4CD8 5E               7      LD  E,(HL)
000CD9 4CD9 23               6      INC HL
000CDA 4CDA 7E               7      LD  A,(HL)
000CDB 4CDB E60F             7      AND 00FH
000CDD 4CDD 57               4      LD  D,A
000CDE 4CDE E1              10      POP HL
000CDF 4CDF C1              10      POP BC
000CE0 4CE0 C9              10      RET
       4CE1                     GNC1:
000CE1 4CE1 7E               7      LD  A,(HL)
000CE2 4CE2 23               6      INC HL
000CE3 4CE3 56               7      LD  D,(HL)
000CE4 4CE4 0604             7      LD  B,4
       4CE6                     GNC1L:
000CE6 4CE6 CB3A             8      SRL D
000CE8 4CE8 1F               4      RRA
000CE9 4CE9 10FB            13      DJNZ    GNC1L
                                
000CEB 4CEB 5F               4      LD  E,A
000CEC 4CEC E1              10      POP HL
000CED 4CED C1              10      POP BC
000CEE 4CEE A7               4      AND A
000CEF 4CEF C9              10      RET
                                
       4CF0                     CLUST:
000CF0 4CF0 EB               4      EX  DE,HL
       4CF1                     CLUST_HL:
000CF1 4CF1 C5              11      PUSH    BC
000CF2 4CF2 3A23F1          13      LD  A,(CLSZ_H)
000CF5 4CF5 CD5450          17      CALL    MUL_AHL
                                
000CF8 4CF8 CDC14D          17      CALL    GET_DIR_POS
000CFB 4CFB 4F               4      LD  C,A
000CFC 4CFC 0600             7      LD  B,0
000CFE 4CFE 09              11      ADD HL,BC
                                
000CFF 4CFF 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000D02 4D02 1F               4      RRA
000D03 4D03 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D06 4D06 1F               4      RRA
000D07 4D07 0F               4      RRCA
000D08 4D08 0F               4      RRCA
000D09 4D09 0F               4      RRCA
000D0A 4D0A 4F               4      LD  C,A
                                
000D0B 4D0B 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D0E 4D0E FE02             7      CP  2
000D10 4D10 280C            12      JR  Z,CLUST1
000D12 4D12 CB01             4      RLC C
000D14 4D14 0D               4      DEC C
000D15 4D15 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000D18 4D18 FE02             7      CP  2
000D1A 4D1A 2002            12      JR  NZ,CLUST1
000D1C 4D1C 0D               4      DEC C
000D1D 4D1D 0D               4      DEC C
       4D1E                     CLUST1:
000D1E 4D1E 0D               4      DEC C
000D1F 4D1F 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    JR  NC,CLUST2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000D20 4D20 4D               4      LD  C,L     ;C=読み出し元
000D21 4D21 29              11      ADD HL,HL   ;64KB→32KB
000D22 4D22 29              11      ADD HL,HL   ;32KB→16KB
000D23 4D23 29              11      ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
000D24 4D24 CD2850          17      CALL    GET_DISK_BANK_FDRV
000D27 4D27 84               4      ADD A,H
000D28 4D28 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D2B 4D2B 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D2E 4D2E 3220F1          13      LD  (_BANK),A
000D31 4D31 69               4      LD  L,C     ;C=読み出し元
000D32 4D32 3E1F             7      LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
000D34 4D34 A5               4      AND L
                                #endif
       4D35                     CLUST2:
000D35 4D35 C660             7      ADD A,high BANK1_ADR
000D37 4D37 67               4      LD  H,A
000D38 4D38 2E00             7      LD  L,0
000D3A 4D3A EB               4      EX  DE,HL
000D3B 4D3B C1              10      POP BC
000D3C 4D3C C9              10      RET
                                
       4D3D                     ENDCL:
000D3D 4D3D 7A               4      LD  A,D ;END CLUSTER
000D3E 4D3E FE0F             7      CP  00FH    ;FAT12の最大値
000D40 4D40 C0              11      RET NZ
000D41 4D41 7B               4      LD  A,E
000D42 4D42 FEF7             7      CP  0F7H
000D44 4D44 C9              10      RET
                                
       4D45                     RB_READ:
000D45 4D45 AF               4      XOR A   ;HLA = HL*128
000D46 4D46 CB3C             8      SRL H
000D48 4D48 CB1D             8      RR  L
000D4A 4D4A 1F               4      RRA
000D4B 4D4B 3226F1          13      LD  (RR_LOW),A
000D4E 4D4E 2227F1          16      LD  (RR_MID),HL
000D51 4D51 218000          10      LD  HL,128
                                
000D54 4D54 CD1749          17      CALL    ROM_READ
000D57 4D57 C9              10      RET
                                
       4D58                     GETSEQ:
000D58 4D58 FD6E20          19      LD  L,(IY+32)
000D5B 4D5B FD660C          19      LD  H,(IY+12)
                                
000D5E 4D5E CB25             8      SLA L
                                
000D60 4D60 CB3C             8      SRL H
000D62 4D62 CB1D             8      RR  L
000D64 4D64 C9              10      RET
                                
       4D65                     SETSEQ:
000D65 4D65 F5              11      PUSH    AF
000D66 4D66 3A26F1          13      LD  A,(RR_LOW)
000D69 4D69 2A27F1          16      LD  HL,(RR_MID)
                                
000D6C 4D6C CD834D          17      CALL    SSQ1
                                
000D6F 4D6F 29              11      ADD HL,HL
000D70 4D70 CB3D             8      SRL L
000D72 4D72 FD7520          19      LD  (IY+32),L
000D75 4D75 FD740C          19      LD  (IY+12),H
000D78 4D78 F1              10      POP AF
000D79 4D79 C9              10      RET
                                
       4D7A                     GETSIZE:
000D7A 4D7A FD7E10          19      LD  A,(IY+16)
000D7D 4D7D FD6E11          19      LD  L,(IY+17)
000D80 4D80 FD6612          19      LD  H,(IY+18)
       4D83                     SSQ1:
000D83 4D83 87               4      ADD A,A
000D84 4D84 ED6A            15      ADC HL,HL
000D86 4D86 B7               4      OR  A
000D87 4D87 C8              11      RET Z
000D88 4D88 23               6      INC HL
000D89 4D89 C9              10      RET
                                
       4D8A                     SET_FCB:
000D8A 4D8A D5              11      PUSH    DE
000D8B 4D8B FDE1            14      POP IY
000D8D 4D8D FD7E1C          19      LD  A,(IY+28)
000D90 4D90 FEFF             7      CP  0FFH
000D92 4D92 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D94 4D94 E5              11      PUSH    HL
000D95 4D95 FD6E1A          19      LD  L,(IY+26)
000D98 4D98 FD661B          19      LD  H,(IY+27)
000D9B 4D9B 222AF1          16      LD  (_CLPS),HL
000D9E 4D9E E1              10      POP HL
000D9F 4D9F C9              10      RET
                                
       4DA0                     POPAF_SCF_FF_RET:
000DA0 4DA0 F1              10      POP AF
000DA1 4DA1 37               4      SCF
000DA2 4DA2 9F               4      SBC A,A
000DA3 4DA3 C9              10      RET
                                
       4DA4                     GET_DIR_DAT:
000DA4 4DA4 2A5EF1          16      LD  HL,(_CDX)
000DA7 4DA7 7C               4      LD  A,H
000DA8 4DA8 B5               4      OR  L
000DA9 4DA9 2034            12      JR  NZ,GET_SUBDIR
000DAB 4DAB CDC14D          17      CALL    GET_DIR_POS
000DAE 4DAE C660             7      ADD A,high BANK1_ADR
000DB0 4DB0 2E00             7      LD  L,0
000DB2 4DB2 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
000DB3 4DB3 CD7C4B          17      CALL    CHECK_DIR_PAGE
                                #endif
000DB6 4DB6 3A21F1          13      LD  A,(_BANK1)
000DB9 4DB9 3249F1          13      LD  (_DIR_BANK),A
                                
000DBC 4DBC 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000DBF 4DBF 4F               4      LD  C,A
000DC0 4DC0 C9              10      RET
                                
       4DC1                     GET_DIR_POS:                ;ルートディレクトリ
000DC1 4DC1 CD2850          17      CALL    GET_DISK_BANK_FDRV
000DC4 4DC4 3221F1          13      LD  (_BANK1),A
000DC7 4DC7 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000DCA 4DCA 47               4      LD  B,A
000DCB 4DCB 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000DCE 4DCE 4F               4      LD  C,A
000DCF 4DCF 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4DD2                     GET_DIR_POS1:
000DD2 4DD2 81               4      ADD A,C
000DD3 4DD3 10FD            13      DJNZ    GET_DIR_POS1
                                
000DD5 4DD5 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4DD9                     L_MDP:
000DD9 4DD9 CB18             8      RR  B   ;->CF
000DDB 4DDB D8              11      RET C
000DDC 4DDC 87               4      ADD A,A
000DDD 4DDD 18FA            12      JR  L_MDP
                                
       4DDF                     GET_SUBDIR:             ;サブディレクトリ
000DDF 4DDF CDF14C          17      CALL    CLUST_HL
000DE2 4DE2 EB               4      EX  DE,HL
000DE3 4DE3 3A20F1          13      LD  A,(_BANK)
000DE6 4DE6 3249F1          13      LD  (_DIR_BANK),A
000DE9 4DE9 3A23F1          13      LD  A,(CLSZ_H)
000DEC 4DEC 87               4      ADD A,A     ;*2
000DED 4DED 87               4      ADD A,A     ;*4
000DEE 4DEE 87               4      ADD A,A     ;*8
000DEF 4DEF 4F               4      LD  C,A
000DF0 4DF0 C9              10      RET
                                
       4DF1                     STATEMENT:
000DF1 4DF1 117F4E          10      LD  DE,STR_CHDIR
000DF4 4DF4 CD654E          17      CALL    CPPROCNM
000DF7 4DF7 280A            12      JR  Z,_CHDIR
000DF9 4DF9 11854E          10      LD  DE,STR_RAMDISK
000DFC 4DFC CD654E          17      CALL    CPPROCNM
000DFF 4DFF 2814            12      JR  Z,_RAMDISK
000E01 4E01 37               4      SCF
000E02 4E02 C9              10      RET
       4E03                     _CHDIR:
000E03 4E03 7E               7      LD  A,(HL)
000E04 4E04 FE28             7      CP  '('
000E06 4E06 37               4      SCF
000E07 4E07 C0              11      RET NZ
000E08 4E08 CDC646          17      CALL    INIT_PARAM
000E0B 4E0B CDB849          17      CALL    FILE_B
000E0E 4E0E CD2D4E          17      CALL    ROM_CD
000E11 4E11 DA9245          10      JP  C,ERROR_FILE_NOT_FOUND
000E14 4E14 C9              10      RET
                                
       4E15                     _RAMDISK:
000E15 4E15 7E               7      LD  A,(HL)
000E16 4E16 FE28             7      CP  '('
000E18 4E18 37               4      SCF
000E19 4E19 C0              11      RET NZ
000E1A 4E1A 23               6      INC HL
000E1B 4E1B DD212F54        14      LD  IX,FRMQNT
000E1F 4E1F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E23 4E23 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E26 4E26 7A               4      LD  A,D
000E27 4E27 B3               4      OR  E
000E28 4E28 C28C45          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E2B 4E2B 23               6      INC HL
000E2C 4E2C C9              10      RET
                                
       4E2D                     ROM_CD:
000E2D 4E2D 3A51F1          13      LD  A,(FNAME)
000E30 4E30 FE20             7      CP  020H
000E32 4E32 2822            12      JR  Z,CD1
000E34 4E34 CD374B          17      CALL    ROM_OPEN
000E37 4E37 D8              11      RET C
000E38 4E38 FD2A47F1        20      LD  IY,(DIRENT1)
000E3C 4E3C FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E40 4E40 CA9245          10      JP  Z,ERROR_FILE_NOT_FOUND
000E43 4E43 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000E46 4E46 FD661B          19      LD  H,(IY+01BH)
       4E49                     CD2:
000E49 4E49 225CF1          16      LD  (_CD),HL
000E4C 4E4C 2A4EF1          16      LD  HL,(PARAM1)
       4E4F                     CD_SKIP:
000E4F 4E4F 7E               7      LD  A,(HL)
000E50 4E50 23               6      INC HL
000E51 4E51 FE21             7      CP  021H
000E53 4E53 38FA            12      JR  C,CD_SKIP
000E55 4E55 C9              10      RET
       4E56                     CD1:
000E56 4E56 2A5EF1          16      LD  HL,(_CDX)
000E59 4E59 18EE            12      JR  CD2
                                
       4E5B                     DEVICE1:
000E5B 4E5B 118D4E          10      LD  DE,STR_A
000E5E 4E5E CD654E          17      CALL    CPPROCNM
000E61 4E61 37               4      SCF
000E62 4E62 C0              11      RET NZ
000E63 4E63 AF               4      XOR A
000E64 4E64 C9              10      RET
                                
       4E65                     CPPROCNM:
000E65 4E65 E5              11      PUSH    HL
000E66 4E66 2189FD          10      LD  HL,PROCNM
       4E69                     CPPROCNM1:
000E69 4E69 1A               7      LD  A,(DE)
000E6A 4E6A 13               6      INC DE
000E6B 4E6B BE               7      CP  (HL)
000E6C 4E6C 23               6      INC HL
000E6D 4E6D 2003            12      JR  NZ,CPPROCNM2
000E6F 4E6F B7               4      OR  A
000E70 4E70 20F7            12      JR  NZ,CPPROCNM1
       4E72                     CPPROCNM2:
000E72 4E72 E1              10      POP HL
000E73 4E73 C9              10      RET
                                
       4E74                     WILDCARD:
000E74 4E74 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4E7F                     STR_CHDIR:
000E7F 4E7F 434844495200            DB  "CHDIR",0
       4E85                     STR_RAMDISK:
000E85 4E85 52414D4449534B00        DB  "RAMDISK",0
       4E8D                     STR_A:
000E8D 4E8D 4100                    DB  "A",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4E8F                     ERROR_WRITE_PROTECTED:
000E8F 4E8F 3E00             7      LD  A,0     ;Write protected
000E91 4E91 C9              10      RET
       4E92                     DISKIO:
000E92 4E92 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000E94 4E94 48               4      LD  C,B
000E95 4E95 CD3250          17      CALL    GET_DISK_BANK
       4E98                     SETMAP1:        
000E98 4E98 E5              11      PUSH    HL
       4E99                     DISKIO1:
000E99 4E99 C5              11      PUSH    BC      ;B=残りのセクタ数
000E9A 4E9A D5              11      PUSH    DE      ;DE=セクタ番号
000E9B 4E9B F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000E9C 4E9C EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000E9D 4E9D F5              11      PUSH    AF
000E9E 4E9E 3A25F1          13      LD  A,(SECSZ_H)
000EA1 4EA1 CD5450          17      CALL    MUL_AHL
000EA4 4EA4 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
                                    LD  A,L
                                    PUSH    BC
                                    LD  BC,-00020H  ;先頭の8KB部分
                                    ADD HL,BC
                                    POP BC
                                    JR  NC,DISKIO2
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
                                    AND L
                                    ADD A,020H
                                #else
000EA5 4EA5 4D               4      LD  C,L     ;C=読み出し元
000EA6 4EA6 29              11      ADD HL,HL       ;64KB→32KB
000EA7 4EA7 29              11      ADD HL,HL       ;32KB→16KB
000EA8 4EA8 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000EA9 4EA9 84               4      ADD A,H
000EAA 4EAA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000EAD 4EAD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000EB0 4EB0 3220F1          13      LD  (_BANK),A
000EB3 4EB3 79               4      LD  A,C     ;C=読み出し元
000EB4 4EB4 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4EB6                     DISKIO2:
000EB6 4EB6 C660             7      ADD A,high BANK1_ADR
000EB8 4EB8 67               4      LD  H,A
000EB9 4EB9 ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000EBD 4EBD 69               4      LD  L,C     ;C=0
000EBE 4EBE CD3844          17      CALL    ROM_LDIR
000EC1 4EC1 EB               4      EX  DE,HL
000EC2 4EC2 F1              10      POP AF
000EC3 4EC3 D1              10      POP DE
000EC4 4EC4 13               6      INC DE
000EC5 4EC5 C1              10      POP BC
000EC6 4EC6 10D1            13      DJNZ    DISKIO1
000EC8 4EC8 41               4      LD  B,C
                                
000EC9 4EC9 E1              10      POP HL
000ECA 4ECA AF               4      XOR A
                                
000ECB 4ECB FB               4      EI
000ECC 4ECC C9              10      RET
                                
       4ECD                     DSKCHG:
000ECD 4ECD CD064F          17      CALL    IS_BPB
000ED0 4ED0 3824            12      JR  C,NOTREADY
000ED2 4ED2 3A23FB          13      LD  A,(DRVTBL+2)
000ED5 4ED5 B7               4      OR  A
000ED6 4ED6 201A            12      JR  NZ,DSKCHG1
000ED8 4ED8 3A21FB          13      LD  A,(DRVTBL)
000EDB 4EDB FE02             7      CP  2
000EDD 4EDD 2013            12      JR  NZ,DSKCHG1
000EDF 4EDF CD064F          17      CALL    IS_BPB
000EE2 4EE2 300E            12      JR  NC,DSKCHG1
000EE4 4EE4 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000EE6 4EE6 3221FB          13      LD  (DRVTBL),A
000EE9 4EE9 3223FB          13      LD  (DRVTBL+2),A
000EEC 4EEC 3A48F3          13      LD  A,(MASTERS)
000EEF 4EEF 3224FB          13      LD  (DRVTBL+3),A
       4EF2                     DSKCHG1:
000EF2 4EF2 AF               4      XOR A
000EF3 4EF3 0601             7      LD  B,1
000EF5 4EF5 C9              10      RET
       4EF6                     NOTREADY:
000EF6 4EF6 3E02             7      LD  A,2
000EF8 4EF8 37               4      SCF
000EF9 4EF9 C9              10      RET
                                
       4EFA                     NO_BPB:
000EFA 4EFA E1              10      POP HL
000EFB 4EFB 23               6      INC HL
000EFC 4EFC 115A50          10      LD  DE,DPB2DD
000EFF 4EFF 011200          10      LD  BC,DPB2DD_E-DPB2DD
000F02 4F02 EDB0                    LDIR
000F04 4F04 AF               4      XOR A
000F05 4F05 C9              10      RET
                                
       4F06                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000F06 4F06 CD3250          17      CALL    GET_DISK_BANK
                                
000F09 4F09 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000F0C 4F0C FE01             7      CP  1
000F0E 4F0E D8              11      RET C
                                
000F0F 4F0F 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000F12 4F12 C6FF             7      ADD A,0FFH
000F14 4F14 D8              11      RET C
                                
000F15 4F15 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000F18 4F18 FE01             7      CP  1
000F1A 4F1A C8              11      RET Z
000F1B 4F1B FE02             7      CP  2
000F1D 4F1D C8              11      RET Z
000F1E 4F1E FE04             7      CP  4
000F20 4F20 C8              11      RET Z
000F21 4F21 37               4      SCF
000F22 4F22 C9              10      RET
                                
       4F23                     GETDPB:
000F23 4F23 E5              11      PUSH    HL
000F24 4F24 CD3250          17      CALL    GET_DISK_BANK
                                
000F27 4F27 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000F2A 4F2A B7               4      OR  A
000F2B 4F2B 28CD            12      JR  Z,NO_BPB
000F2D 4F2D DDE1            14      POP IX
000F2F 4F2F DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F32 4F32 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F35 4F35 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F38 4F38 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F3B 4F3B DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F3E 4F3E 87               4      ADD A,A
000F3F 4F3F 87               4      ADD A,A
000F40 4F40 87               4      ADD A,A
000F41 4F41 3D               4      DEC A
000F42 4F42 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F45 4F45 06FF             7      LD  B,-1
000F47 4F47 A7               4      AND A           ;無限ループ阻止
       4F48                     GETDPB1:
000F48 4F48 04               4      INC B
000F49 4F49 1F               4      RRA
000F4A 4F4A 38FC            12      JR  C,GETDPB1
000F4C 4F4C DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F4F 4F4F 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F52 4F52 3D               4      DEC A
000F53 4F53 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F56 4F56 A7               4      AND A           ;無限ループ阻止
000F57 4F57 06FF             7      LD  B,-1
       4F59                     GETDPB2:
000F59 4F59 04               4      INC B
000F5A 4F5A 1F               4      RRA
000F5B 4F5B 38FC            12      JR  C,GETDPB2
000F5D 4F5D 04               4      INC B
000F5E 4F5E DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000F61 4F61 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000F64 4F64 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000F67 4F67 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000F6A 4F6A 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000F6D 4F6D DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000F70 4F70 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000F73 4F73 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000F76 4F76 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000F7A 4F7A DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000F7D 4F7D DD460A          19      LD  B,(IX+10)       ;FATCNT
000F80 4F80 210000          10      LD  HL,0
       4F83                     GETDPB3:
000F83 4F83 19              11      ADD HL,DE
000F84 4F84 10FD            13      DJNZ    GETDPB3
       4F86                     GETDPB4:
000F86 4F86 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000F89 4F89 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000F8C 4F8C 19              11      ADD HL,DE
000F8D 4F8D DD7511          19      LD  (IX+17),L       ;FIRDIR
000F90 4F90 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000F93 4F93 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F96 4F96 87               4      ADD A,A
000F97 4F97 87               4      ADD A,A
000F98 4F98 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F9B                     GETDPB5:
000F9B 4F9B CB3B             8      SRL E
000F9D 4F9D 1F               4      RRA
000F9E 4F9E 30FB            12      JR  NC,GETDPB5
000FA0 4FA0 1600             7      LD  D,0
000FA2 4FA2 19              11      ADD HL,DE
000FA3 4FA3 DD750C          19      LD  (IX+12),L       ;FIRREC
000FA6 4FA6 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FA9 4FA9 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000FAC 4FAC DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000FAF 4FAF DD560D          19      LD  D,(IX+13)       ;FIRREC
000FB2 4FB2 A7               4      AND A
000FB3 4FB3 ED52            15      SBC HL,DE
                                
000FB5 4FB5 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000FB8 4FB8 3C               4      INC A
000FB9 4FB9 37               4      SCF             ;無限ループ阻止
       4FBA                     GETDPB6:
000FBA 4FBA 1F               4      RRA
000FBB 4FBB 3806            12      JR  C,GETDPB7
000FBD 4FBD CB3C             8      SRL H
000FBF 4FBF CB1D             8      RR  L
000FC1 4FC1 18F7            12      JR  GETDPB6
       4FC3                     GETDPB7:
000FC3 4FC3 23               6      INC HL
000FC4 4FC4 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000FC7 4FC7 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4FCA                     GETDPBD1:
000FCA 4FCA DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FCD 4FCD E6FC             7      AND 0FCH
000FCF 4FCF C8              11      RET Z
                                
000FD0 4FD0 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000FD4 4FD4 37               4      SCF
000FD5 4FD5 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000FD9 4FD9 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000FDC 4FDC DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000FE0 4FE0 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000FE4 4FE4 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000FE8 4FE8 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000FEC 4FEC DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000FF0 4FF0 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000FF4 4FF4 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000FF8 4FF8 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000FFB 4FFB DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000FFE 4FFE DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001001 5001 87               4      ADD A,A
001002 5002 87               4      ADD A,A
001003 5003 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5006                     GETDPBD5:
001006 5006 CB3B             8      SRL E
001008 5008 1F               4      RRA
001009 5009 30FB            12      JR  NC,GETDPBD5
00100B 500B 1600             7      LD  D,0
00100D 500D 19              11      ADD HL,DE
00100E 500E DD750C          19      LD  (IX+12),L       ;FIRREC
001011 5011 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001014 5014 18B4            12      JR  GETDPBD1
                                
       5016                     CHOICE:
001016 5016 210000          10      LD  HL,0
001019 5019 C9              10      RET
                                
       501A                     DSKFMT:
00101A 501A AF               4      XOR A
00101B 501B 37               4      SCF
       501C                     DSKSTP:
00101C 501C C9              10      RET
                                
       501D                     BASENT:
00101D 501D ED7B60F1        20      LD  SP,(BASSTK)
001021 5021 C3CC43          10      JP  BASAUTO
                                
       5024                     GETSLT:
001024 5024 3A22FB          13      LD  A,(DRVTBL+1)
001027 5027 C9              10      RET
                                
       5028                     GET_DISK_BANK_FDRV:
001028 5028 3A50F1          13      LD  A,(FDRV)
00102B 502B D601             7      SUB 1
00102D 502D 3003            12      JR  NC,GET_DISK_BANK
00102F 502F 3A46F1          13      LD  A,(_DVSW)
       5032                     GET_DISK_BANK:
001032 5032 B7               4      OR  A       ;A=DRIVE
001033 5033 3E01             7      LD  A,DISK_BANK
001035 5035 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001037 5037 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       503A                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
                                    LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
00103A 503A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00103D 503D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001040 5040 F5              11      PUSH    AF
001041 5041 E5              11      PUSH    HL
001042 5042 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001045 5045 2224F1          16      LD  (SECSZ),HL
001048 5048 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
00104B 504B CD5450          17      CALL    MUL_AHL
00104E 504E 2222F1          16      LD  (CLSZ),HL
001051 5051 E1              10      POP HL
001052 5052 F1              10      POP AF
001053 5053 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5054                     MUL_AHL:
001054 5054 37               4      SCF     ;無限ループ回避
       5055                     MUL_AHL1:
001055 5055 1F               4      RRA     ;->CF
001056 5056 D8              11      RET C
001057 5057 29              11      ADD HL,HL
001058 5058 18FB            12      JR  MUL_AHL1
                                
       505A                     DPB2DD:
00105A 505A F9                      DB  0F9H    ;MEDIA
00105B 505B 0002                    DW  00200H  ;SECSIZ
00105D 505D 0F                      DB  00FH    ;DIRMSK
00105E 505E 04                      DB  004H    ;DIRSHFT
00105F 505F 01                      DB  001H    ;CLUSMSK
001060 5060 02                      DB  002H    ;CLUSSHFT
001061 5061 0100                    DW  00001H  ;FIRFAT
001063 5063 02                      DB  002H    ;FATCNT
001064 5064 70                      DB  070H    ;MAXENT
001065 5065 0E00                    DW  0000EH  ;FIRREC
001067 5067 CA02                    DW  002CAH  ;MAXCLUS
001069 5069 03                      DB  003H    ;FATSIZ
00106A 506A 0700                    DW  0007H   ;FIRDIR
       506C                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       506C                     POP_HL_ERROR:
00106C 506C E1              10      POP     HL
       506D                     _ERROR:
00106D 506D 0600             7      LD  B,0
00106F 506F A7               4      AND A
001070 5070 C9              10      RET
                                
       5071                     ROM_BDOS:
001071 5071 E5              11      PUSH    HL
001072 5072 79               4      LD  A,C
001073 5073 87               4      ADD A,A
001074 5074 38F7            12      JR  C,_ERROR
001076 5076 6F               4      LD  L,A
001077 5077 265F             7      LD  H,high STABLE
001079 5079 7E               7      LD  A,(HL)
00107A 507A 2C               4      INC L
00107B 507B 66               7      LD  H,(HL)
00107C 507C 6F               4      LD  L,A
00107D 507D E3              19      EX  (SP),HL
00107E 507E 79               4      LD  A,C
00107F 507F C9              10      RET
                                
       5080                     _PRINT:
       5080                     PRINT:
001080 5080 7B               4      LD  A,E
001081 5081 1803            12      JR  MSG_A
                                
       5083                     _SYS01:     ;(BDOS)コンソール入力
001083 5083 CDFA50          17      CALL    _SYS07
       5086                     MSG_A:
001086 5086 FE03             7      CP  3
001088 5088 2814            12      JR  Z,MSG_BR
       508A                     MSGA1:
00108A 508A F5              11      PUSH    AF
00108B 508B C5              11      PUSH    BC
00108C 508C D5              11      PUSH    DE
00108D 508D E5              11      PUSH    HL
00108E 508E DDE5            15      PUSH    IX
001090 5090 DD21A200        14      LD  IX,CHPUT
001094 5094 CDFB42          17      CALL    CALSLT_R
001097 5097 DDE1            14      POP IX
001099 5099 E1              10      POP HL
00109A 509A D1              10      POP DE
00109B 509B C1              10      POP BC
       509C                     MSGA2:
00109C 509C F1              10      POP AF
00109D 509D C9              10      RET
       509E                     MSG_BR:
00109E 509E F5              11      PUSH    AF
00109F 509F 3ADDF3          13      LD  A,(CSRX)
0010A2 50A2 FE02             7      CP  2
0010A4 50A4 38F6            12      JR  C,MSGA2
0010A6 50A6 F1              10      POP AF
       50A7                     MSG_CR:
0010A7 50A7 F5              11      PUSH    AF
0010A8 50A8 3E0D             7      LD  A,00DH
0010AA 50AA CD8A50          17      CALL    MSGA1
0010AD 50AD 3E0A             7      LD  A,00AH
0010AF 50AF CD8A50          17      CALL    MSGA1
0010B2 50B2 F1              10      POP AF
0010B3 50B3 C9              10      RET
                                
       50B4                     _SYS02:     ;(BDOS)コンソール出力
0010B4 50B4 CDCF50          17      CALL    BREAK
0010B7 50B7 1805            12      JR  PRINTX
                                
       50B9                     _SYS06:     ;(BDOS)コンソール直接入出力
0010B9 50B9 7B               4      LD  A,E
0010BA 50BA 3C               4      INC A
0010BB 50BB CA0E51          10      JP  Z,_INKEY
       50BE                     PRINTX:
0010BE 50BE C38050          10      JP  _PRINT
                                
       50C1                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0010C1 50C1 CDFA50          17      CALL    _SYS07
0010C4 50C4 FE03             7      CP  3
0010C6 50C6 CCCF50          17      CALL    Z,_BREAK
0010C9 50C9 FE13             7      CP  013H        ;CTRL+S
0010CB 50CB C0              11      RET NZ
       50CC                     PAUSE:
0010CC 50CC CDE650          17      CALL    KEYBC
                                
       50CF                     _BREAK:
       50CF                     BREAK:
0010CF 50CF F5              11      PUSH    AF
0010D0 50D0 C5              11      PUSH    BC
0010D1 50D1 D5              11      PUSH    DE
0010D2 50D2 E5              11      PUSH    HL
0010D3 50D3 DDE5            15      PUSH    IX
0010D5 50D5 DD21B700        14      LD  IX,BREAKX
0010D9 50D9 CDFB42          17      CALL    CALSLT_R
0010DC 50DC DDE1            14      POP IX
0010DE 50DE E1              10      POP HL
0010DF 50DF D1              10      POP DE
0010E0 50E0 C1              10      POP BC
0010E1 50E1 DCCF50          17      CALL    C,_BREAK
0010E4 50E4 F1              10      POP AF
0010E5 50E5 C9              10      RET
       50E6                     KEYBC:
0010E6 50E6 F5              11      PUSH    AF
0010E7 50E7 C5              11      PUSH    BC
0010E8 50E8 D5              11      PUSH    DE
0010E9 50E9 E5              11      PUSH    HL
0010EA 50EA DDE5            15      PUSH    IX
0010EC 50EC DD215601        14      LD  IX,KILBUF
0010F0 50F0 CDFB42          17      CALL    CALSLT_R
0010F3 50F3 DDE1            14      POP IX
0010F5 50F5 E1              10      POP HL
0010F6 50F6 D1              10      POP DE
0010F7 50F7 C1              10      POP BC
0010F8 50F8 F1              10      POP AF
0010F9 50F9 C9              10      RET
                                
       50FA                     _SYS07:
       50FA                     FLGET:
0010FA 50FA C5              11      PUSH    BC
0010FB 50FB D5              11      PUSH    DE
0010FC 50FC E5              11      PUSH    HL
0010FD 50FD DDE5            15      PUSH    IX
0010FF 50FF DD219F00        14      LD  IX,CHGET
001103 5103 CDFB42          17      CALL    CALSLT_R
001106 5106 DDE1            14      POP IX
001108 5108 E1              10      POP HL
001109 5109 D1              10      POP DE
00110A 510A C1              10      POP BC
00110B 510B FE03             7      CP  3
00110D 510D C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       510E                     _INKEY:
       510E                     INKEY:
00110E 510E CDA851          17      CALL    CPM_CONST
001111 5111 C8              11      RET Z
001112 5112 18E6            12      JR  FLGET
                                
       5114                     _SYS0A:     ;(BDOS)文字列入力
001114 5114 C5              11      PUSH    BC
001115 5115 E5              11      PUSH    HL
001116 5116 D5              11      PUSH    DE
001117 5117 CD4051          17      CALL    GETL
00111A 511A 111FF4          10      LD  DE,KBUF
00111D 511D E1              10      POP HL
00111E 511E E5              11      PUSH    HL
00111F 511F 0E00             7      LD  C,0
001121 5121 3004            12      JR  NC,SAX0
001123 5123 23               6      INC HL
001124 5124 23               6      INC HL
001125 5125 1808            12      JR  SAX4
       5127                     SAX0:
001127 5127 46               7      LD  B,(HL)
001128 5128 23               6      INC HL
       5129                     SAX1:
001129 5129 23               6      INC HL
00112A 512A 1A               7      LD  A,(DE)
00112B 512B 13               6      INC DE
00112C 512C B7               4      OR  A
00112D 512D 2004            12      JR  NZ,SAX2
       512F                     SAX4:
00112F 512F 360D            10      LD  (HL),00DH
001131 5131 1804            12      JR  SAX3
       5133                     SAX2:
001133 5133 77               7      LD  (HL),A
001134 5134 0C               4      INC C
001135 5135 10F2            13      DJNZ    SAX1
       5137                     SAX3:
001137 5137 D1              10      POP DE
001138 5138 79               4      LD  A,C
001139 5139 13               6      INC DE
00113A 513A 12               7      LD  (DE),A
00113B 513B 1B               6      DEC DE
00113C 513C E1              10      POP HL
00113D 513D C1              10      POP BC
00113E 513E A7               4      AND A
00113F 513F C9              10      RET
       5140                     GETL:
001140 5140 DDE5            15      PUSH    IX
001142 5142 FDE5            15      PUSH    IY
                                
001144 5144 2ADCF3          16      LD  HL,(CSRY)
001147 5147 22CAFB          16      LD  (FSTPOS),HL
       514A                     GETL1:
00114A 514A CDC150          17      CALL    _SYS08
00114D 514D FE09             7      CP  9
00114F 514F 2008            12      JR  NZ,GETL1V
001151 5151 211FF4          10      LD  HL,KBUF
001154 5154 CD8743          17      CALL    MSX
001157 5157 18F1            12      JR  GETL1
       5159                     GETL1V:
001159 5159 5F               4      LD  E,A
00115A 515A FE08             7      CP  8
00115C 515C CCF651          17      CALL    Z,CTRL02
00115F 515F FE20             7      CP  020H
001161 5161 D42252          17      CALL    NC,INSERT
001164 5164 CD8A50          17      CALL    MSGA1
                                
001167 5167 7B               4      LD  A,E
001168 5168 FE0D             7      CP  00DH
00116A 516A 20DE            12      JR  NZ,GETL1
                                
00116C 516C 111FF4          10      LD  DE,KBUF
00116F 516F 3AB0F3          13      LD  A,(LINLEN)
001172 5172 47               4      LD  B,A
001173 5173 CD0054          17      CALL    ZERO_MEMORY_DE
                                
001176 5176 2ACAFB          16      LD  HL,(FSTPOS)
001179 5179 3ADCF3          13      LD  A,(CSRY)
00117C 517C 6F               4      LD  L,A
00117D 517D E5              11      PUSH    HL
00117E 517E CD5352          17      CALL    LOC0
001181 5181 4D               4      LD  C,L
001182 5182 44               4      LD  B,H
001183 5183 E1              10      POP HL
001184 5184 3AB0F3          13      LD  A,(LINLEN)
001187 5187 94               4      SUB H
001188 5188 3D               4      DEC A
001189 5189 5F               4      LD  E,A
00118A 518A 211FF4          10      LD  HL,KBUF
       518D                     GETL2:
00118D 518D CDE651          17      CALL    _SCRN
001190 5190 03               6      INC BC
001191 5191 77               7      LD  (HL),A
001192 5192 23               6      INC HL
001193 5193 1D               4      DEC E
001194 5194 20F7            12      JR  NZ,GETL2
001196 5196 CDA750          17      CALL    MSG_CR
                                
001199 5199 FDE1            14      POP IY
00119B 519B DDE1            14      POP IX
       519D                     GETL3:
00119D 519D 2B               6      DEC HL
00119E 519E 7E               7      LD  A,(HL)
00119F 519F FE21             7      CP  021H
0011A1 51A1 D0              11      RET NC
0011A2 51A2 3600            10      LD  (HL),0
0011A4 51A4 15               4      DEC D
0011A5 51A5 20F6            12      JR  NZ,GETL3
0011A7 51A7 C9              10      RET
                                
       51A8                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       51A8                     CONSTX:
       51A8                     CPM_CONST:
0011A8 51A8 C5              11      PUSH    BC
0011A9 51A9 D5              11      PUSH    DE
0011AA 51AA E5              11      PUSH    HL
0011AB 51AB DDE5            15      PUSH    IX
0011AD 51AD DD219C00        14      LD  IX,CHSNS
0011B1 51B1 CDFB42          17      CALL    CALSLT_R
0011B4 51B4 DDE1            14      POP IX
0011B6 51B6 E1              10      POP HL
0011B7 51B7 D1              10      POP DE
0011B8 51B8 C1              10      POP BC
0011B9 51B9 C9              10      RET
                                
       51BA                     _SYS2A:     ;(BDOS)日付の獲得
0011BA 51BA AF               4      XOR A
0011BB 51BB 57               4      LD  D,A
0011BC 51BC 5F               4      LD  E,A
0011BD 51BD 67               4      LD  H,A
0011BE 51BE 6F               4      LD  L,A
0011BF 51BF C9              10      RET
                                
       51C0                     _SYS2C:     ;(BDOS)時刻の獲得
0011C0 51C0 AF               4      XOR A
0011C1 51C1 57               4      LD  D,A
0011C2 51C2 5F               4      LD  E,A
0011C3 51C3 67               4      LD  H,A
0011C4 51C4 6F               4      LD  L,A
0011C5 51C5 C9              10      RET
                                
       51C6                     POS:
0011C6 51C6 F5              11      PUSH    AF
0011C7 51C7 2ADCF3          16      LD  HL,(CSRY)
0011CA 51CA 7D               4      LD  A,L
0011CB 51CB 6C               4      LD  L,H
0011CC 51CC 67               4      LD  H,A
0011CD 51CD 2C               4      INC L
0011CE 51CE 24               4      INC H
0011CF 51CF F1              10      POP AF
0011D0 51D0 C9              10      RET
                                
       51D1                     LOC:
0011D1 51D1 F5              11      PUSH    AF
0011D2 51D2 E5              11      PUSH    HL
0011D3 51D3 7D               4      LD  A,L
0011D4 51D4 6C               4      LD  L,H
0011D5 51D5 67               4      LD  H,A
0011D6 51D6 2D               4      DEC L
0011D7 51D7 25               4      DEC H
0011D8 51D8 DDE5            15      PUSH    IX
0011DA 51DA DD21C600        14      LD  IX,POSIT
0011DE 51DE CDFB42          17      CALL    CALSLT_R
0011E1 51E1 DDE1            14      POP IX
0011E3 51E3 E1              10      POP HL
0011E4 51E4 F1              10      POP AF
0011E5 51E5 C9              10      RET
                                
       51E6                     _SCRN:
       51E6                     SCRN:
0011E6 51E6 E5              11      PUSH    HL
0011E7 51E7 DDE5            15      PUSH    IX
                                
0011E9 51E9 69               4      LD  L,C
0011EA 51EA 60               4      LD  H,B
0011EB 51EB DD214A00        14      LD  IX,RDVRM
0011EF 51EF CDFB42          17      CALL    CALSLT_R
                                
0011F2 51F2 DDE1            14      POP IX
0011F4 51F4 E1              10      POP HL
0011F5 51F5 C9              10      RET
                                
       51F6                     CTRL02:
0011F6 51F6 F5              11      PUSH    AF
0011F7 51F7 D5              11      PUSH    DE
0011F8 51F8 2ADCF3          16      LD  HL,(CSRY)
0011FB 51FB 3AB0F3          13      LD  A,(LINLEN)
0011FE 51FE 4F               4      LD  C,A
0011FF 51FF 94               4      SUB H   ;CSRX
001200 5200 C602             7      ADD A,2
001202 5202 47               4      LD  B,A ;カーソルより右の文字数
001203 5203 61               4      LD  H,C ;LINLEN
001204 5204 C5              11      PUSH    BC
001205 5205 CD5352          17      CALL    LOC0
001208 5208 C1              10      POP BC
                                
001209 5209 1620             7      LD  D,020H
       520B                     C8X1:
00120B 520B DD214A00        14      LD  IX,RDVRM
00120F 520F CDFB42          17      CALL    CALSLT_R
001212 5212 4F               4      LD  C,A
001213 5213 7A               4      LD  A,D
001214 5214 DD214D00        14      LD  IX,WRTVRM
001218 5218 CDFB42          17      CALL    CALSLT_R
00121B 521B 2B               6      DEC HL
00121C 521C 51               4      LD  D,C
00121D 521D 10EC            13      DJNZ    C8X1
00121F 521F D1              10      POP DE
001220 5220 F1              10      POP AF
001221 5221 C9              10      RET
                                
       5222                     INSERT:
001222 5222 F5              11      PUSH    AF
001223 5223 D5              11      PUSH    DE
001224 5224 2ADCF3          16      LD  HL,(CSRY)
001227 5227 3AB0F3          13      LD  A,(LINLEN)
00122A 522A 4F               4      LD  C,A
00122B 522B 94               4      SUB H   ;CSRX
00122C 522C 3C               4      INC A
00122D 522D 47               4      LD  B,A ;カーソルより右の文字数
00122E 522E C5              11      PUSH    BC
00122F 522F CD5352          17      CALL    LOC0
001232 5232 C1              10      POP BC
                                
001233 5233 1620             7      LD  D,020H
       5235                     INS1:
001235 5235 DD214A00        14      LD  IX,RDVRM
001239 5239 CDFB42          17      CALL    CALSLT_R
00123C 523C 4F               4      LD  C,A
00123D 523D 7A               4      LD  A,D
00123E 523E DD214D00        14      LD  IX,WRTVRM
001242 5242 CDFB42          17      CALL    CALSLT_R
001245 5245 23               6      INC HL
001246 5246 51               4      LD  D,C
001247 5247 10EC            13      DJNZ    INS1
001249 5249 D1              10      POP DE
00124A 524A F1              10      POP AF
00124B 524B C9              10      RET
                                
       524C                     CONOUT1:
00124C 524C 59               4      LD  E,C
00124D 524D C38050          10      JP  _PRINT
                                
       5250                     GETVRAM:
001250 5250 2ADCF3          16      LD  HL,(CSRY)
       5253                     LOC0:
001253 5253 2D               4      DEC L
001254 5254 25               4      DEC H
001255 5255 4C               4      LD  C,H ;CSRX-1
001256 5256 5D               4      LD  E,L ;CSRY-1
       5257                     LOC1:
001257 5257 3AB0F3          13      LD  A,(LINLEN)
00125A 525A 67               4      LD  H,A
00125B 525B 1600             7      LD  D,0
00125D 525D 6A               4      LD  L,D ;0
00125E 525E 0608             7      LD  B,8
       5260                     LOC2:
001260 5260 29              11      ADD HL,HL
001261 5261 3001            12      JR  NC,LOC3
001263 5263 19              11      ADD HL,DE
       5264                     LOC3:
001264 5264 10FA            13      DJNZ    LOC2
001266 5266 09              11      ADD HL,BC
001267 5267 C9              10      RET
                                
       5268                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001268 5268 212200          10      LD  HL,00022H
00126B 526B AF               4      XOR A
00126C 526C 7D               4      LD  A,L
00126D 526D C9              10      RET
                                
       526E                     _SYS0D:     ;(BDOS)ディスク・リセット
00126E 526E 218000          10      LD  HL,00080H
001271 5271 2230F1          16      LD  (_DTA),HL
001274 5274 C9              10      RET
                                
       5275                     _SYS0E:     ;(BDOS)カレントドライブの設定
001275 5275 3246F1          13      LD  (_DVSW),A
001278 5278 C9              10      RET
                                
       5279                     _SYS0F:     ;(BDOS)ファイルのオープン
001279 5279 D5              11      PUSH    DE
00127A 527A FDE1            14      POP IY
00127C 527C CDE753          17      CALL    INIT_FILE
00127F 527F CD374B          17      CALL    ROM_OPEN
001282 5282 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001284 5284 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
001288 5288 FDE5            15      PUSH    IY
00128A 528A D1              10      POP DE
00128B 528B 13               6      INC DE
00128C 528C 010B00          10      LD  BC,11
00128F 528F EDB0                    LDIR
                                ;               Attribute
001291 5291 7E               7      LD  A,(HL)
001292 5292 FD770D          19      LD  (IY+13),A
                                ;               TIME
001295 5295 110B00          10      LD  DE,11
001298 5298 19              11      ADD HL,DE
001299 5299 7E               7      LD  A,(HL)
00129A 529A 23               6      INC HL
00129B 529B FD7716          19      LD  (IY+22),A
00129E 529E 7E               7      LD  A,(HL)
00129F 529F 23               6      INC HL
0012A0 52A0 FD7717          19      LD  (IY+23),A
                                ;               DATE
0012A3 52A3 7E               7      LD  A,(HL)
0012A4 52A4 23               6      INC HL
0012A5 52A5 FD7714          19      LD  (IY+20),A
0012A8 52A8 7E               7      LD  A,(HL)
0012A9 52A9 23               6      INC HL
0012AA 52AA FD7715          19      LD  (IY+21),A
                                ;               First cluster
0012AD 52AD 7E               7      LD  A,(HL)
0012AE 52AE 23               6      INC HL
0012AF 52AF FD771A          19      LD  (IY+26),A
0012B2 52B2 7E               7      LD  A,(HL)
0012B3 52B3 23               6      INC HL
0012B4 52B4 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0012B7 52B7 7E               7      LD  A,(HL)
0012B8 52B8 23               6      INC HL
0012B9 52B9 FD7710          19      LD  (IY+16),A
0012BC 52BC 7E               7      LD  A,(HL)
0012BD 52BD 23               6      INC HL
0012BE 52BE FD7711          19      LD  (IY+17),A
0012C1 52C1 7E               7      LD  A,(HL)
0012C2 52C2 23               6      INC HL
0012C3 52C3 FD7712          19      LD  (IY+18),A
0012C6 52C6 7E               7      LD  A,(HL)
0012C7 52C7 FD7713          19      LD  (IY+19),A
0012CA 52CA AF               4      XOR A
0012CB 52CB FD770C          19      LD  (IY+12),A
0012CE 52CE C9              10      RET
                                
       52CF                     _SYS10:     ;(BDOS)ファイルのクローズ
0012CF 52CF AF               4      XOR A
0012D0 52D0 C9              10      RET
                                
       52D1                     S11X1:
0012D1 52D1 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012D4 52D4 FD750E          19      LD  (IY+14),L
0012D7 52D7 FD740F          19      LD  (IY+15),H
       52DA                     SCF_FF_RET:
0012DA 52DA 37               4      SCF
0012DB 52DB 9F               4      SBC A,A
0012DC 52DC C9              10      RET
                                
       52DD                     _SYS11:     ;(BDOS)最初のファイルの検索
0012DD 52DD ED5333F1        20      LD  (_FCB),DE
0012E1 52E1 D5              11      PUSH    DE
0012E2 52E2 FDE1            14      POP IY
0012E4 52E4 CDE753          17      CALL    INIT_FILE
0012E7 52E7 CDA44D          17      CALL    GET_DIR_DAT
       52EA                     S12X1:
0012EA 52EA CD534B          17      CALL    FILESE
0012ED 52ED 30E2            12      JR  NC,S11X1
0012EF 52EF 0D               4      DEC C
0012F0 52F0 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0012F3 52F3 FDCB0D66        20      BIT 4,(IY+13)
0012F7 52F7 2809            12      JR  Z,S12X2
0012F9 52F9 E5              11      PUSH    HL
0012FA 52FA DDE1            14      POP IX
0012FC 52FC DDCB0E66        20      BIT 4,(IX+1+13)
001300 5300 28E8            12      JR  Z,S12X1
       5302                     S12X2:
001302 5302 012000          10      LD  BC,32
001305 5305 ED5B30F1        20      LD  DE,(_DTA)
001309 5309 AF               4      XOR A
00130A 530A 12               7      LD  (DE),A      ;ドライブ番号
00130B 530B 13               6      INC DE
00130C 530C EDB0                    LDIR            ;ディレクトリエントリ
00130E 530E FD750E          19      LD  (IY+14),L
001311 5311 FD740F          19      LD  (IY+15),H
001314 5314 C9              10      RET
                                
       5315                     _SYS12:
001315 5315 FD2A33F1        20      LD  IY,(_FCB)
001319 5319 FDE5            15      PUSH    IY
00131B 531B D1              10      POP DE
00131C 531C CDE753          17      CALL    INIT_FILE
                                
00131F 531F FD6E0E          19      LD  L,(IY+14)
001322 5322 FD660F          19      LD  H,(IY+15)
001325 5325 FD4E19          19      LD  C,(IY+25)
001328 5328 18C0            12      JR  S12X1
                                
       532A                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00132A 532A CD8A4D          17      CALL    SET_FCB
00132D 532D CD584D          17      CALL    GETSEQ
001330 5330 CD454D          17      CALL    RB_READ
001333 5333 E5              11      PUSH    HL
001334 5334 CD654D          17      CALL    SETSEQ
001337 5337 E1              10      POP HL
       5338                     SREAD:
001338 5338 C601             7      ADD A,001H
00133A 533A D8              11      RET C
                                
00133B 533B 7D               4      LD  A,L
00133C 533C D601             7      SUB 001H
00133E 533E 9F               4      SBC A,A
00133F 533F E603             7      AND 3
001341 5341 1F               4      RRA
001342 5342 C9              10      RET
                                
       5343                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001343 5343 210100          10      LD  HL,00001H
001346 5346 AF               4      XOR A
001347 5347 C9              10      RET
                                
       5348                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001348 5348 3A46F1          13      LD  A,(_DVSW)
00134B 534B C9              10      RET
                                
       534C                     _SYS1A:     ;(BDOS)DTAの設定
00134C 534C ED5330F1        20      LD  (_DTA),DE
001350 5350 AF               4      XOR A
001351 5351 C9              10      RET
                                
       5352                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001352 5352 010002          10      LD  BC,512
001355 5355 11C302          10      LD  DE,707
001358 5358 210000          10      LD  HL,0
00135B 535B DD2135F1        14      LD  IX,_BUF
00135F 535F FD2135F1        14      LD  IY,_BUF
001363 5363 FD3600F9        19      LD  (IY+0),0F9H
001367 5367 3E02             7      LD  A,2
001369 5369 C9              10      RET
                                
       536A                     _SYS21:     ;(BDOS)ランダムな読み出し
00136A 536A CD8A4D          17      CALL    SET_FCB
                                
00136D 536D FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001370 5370 FD6622          19      LD  H,(IY+34)
                                
001373 5373 CD454D          17      CALL    RB_READ
001376 5376 18C0            12      JR  SREAD
                                
       5378                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001378 5378 CD7952          17      CALL    _SYS0F
00137B 537B D8              11      RET C
                                
00137C 537C D5              11      PUSH    DE      ;EX DE,IY
00137D 537D FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00137F 537F CD7A4D          17      CALL    GETSIZE
       5382                     _S24X1:
001382 5382 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001385 5385 FD7422          19      LD  (IY+34),H
001388 5388 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00138C 538C FDE3            23      EX  (SP),IY     ;
00138E 538E D1              10      POP DE      ;
                                
00138F 538F AF               4      XOR A
001390 5390 C9              10      RET
                                
       5391                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001391 5391 E5              11      PUSH    HL
001392 5392 D5              11      PUSH    DE      ;EX DE,IY
001393 5393 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001395 5395 CD584D          17      CALL    GETSEQ
001398 5398 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       539A                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00139A 539A CD8A4D          17      CALL    SET_FCB
00139D 539D E5              11      PUSH    HL
00139E 539E FD6E21          19      LD  L,(IY+33)
0013A1 53A1 FD6622          19      LD  H,(IY+34)
0013A4 53A4 2226F1          16      LD  (RR_LOW),HL
0013A7 53A7 FD6E23          19      LD  L,(IY+35)
0013AA 53AA FD6624          19      LD  H,(IY+36)
0013AD 53AD 2228F1          16      LD  (RR_HIGH),HL
0013B0 53B0 E1              10      POP HL
0013B1 53B1 CD1749          17      CALL    ROM_READ
0013B4 53B4 ED5B26F1        20      LD  DE,(RR_LOW)
0013B8 53B8 FD7321          19      LD  (IY+33),E
0013BB 53BB FD7222          19      LD  (IY+34),D
0013BE 53BE ED5B28F1        20      LD  DE,(RR_HIGH)
0013C2 53C2 FD7323          19      LD  (IY+35),E
0013C5 53C5 FD7224          19      LD  (IY+36),D
0013C8 53C8 9F               4      SBC A,A
0013C9 53C9 C9              10      RET
                                
       53CA                     _SYS2F:
0013CA 53CA 44               4      LD  B,H
0013CB 53CB 2A30F1          16      LD  HL,(_DTA)
0013CE 53CE C3924E          10      JP  DISKIO
                                
       53D1                     _SYS5A:
0013D1 53D1 0600             7      LD  B,0
0013D3 53D3 D5              11      PUSH    DE
0013D4 53D4 DDE1            14      POP IX
       53D6                     _SX5A1:
0013D6 53D6 1A               7      LD  A,(DE)
0013D7 53D7 B7               4      OR  A
0013D8 53D8 2804            12      JR  Z,_SX5A2
0013DA 53DA 13               6      INC DE
0013DB 53DB 04               4      INC B
0013DC 53DC 18F8            12      JR  _SX5A1
                                
       53DE                     _SX5A2:
0013DE 53DE 78               4      LD  A,B
0013DF 53DF CDE249          17      CALL    FILE_BDOS
0013E2 53E2 CD2D4E          17      CALL    ROM_CD
0013E5 53E5 9F               4      SBC A,A
0013E6 53E6 C9              10      RET
                                
       53E7                     INIT_FILE:
0013E7 53E7 EB               4      EX  DE,HL
0013E8 53E8 1150F1          10      LD  DE,FDRV
0013EB 53EB 010C00          10      LD  BC,1+8+3
0013EE 53EE EDB0                    LDIR
0013F0 53F0 CD2850          17      CALL    GET_DISK_BANK_FDRV
0013F3 53F3 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0013F6 53F6 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0013F9 53F9 2A5CF1          16      LD  HL,(_CD)
0013FC 53FC 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
0013FF 53FF C9              10      RET
                                
       5400                     ZERO_MEMORY_DE:
001400 5400 AF               4      XOR A
       5401                     FILL_MEMORY_DE:
001401 5401 12               7      LD  (DE),A
001402 5402 13               6      INC DE
001403 5403 10FC            13      DJNZ    FILL_MEMORY_DE
001405 5405 C9              10      RET
                                
001406 5406                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 6D508350B4506D50        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 6D506D50B950FA50        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 C1506D501451A851        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 68526E5275527952        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 CF52DD5215536D50        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 2A536D506D506D50        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 435348534C535253        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 6D506D506D507853        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 91536D506D509A53        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 6D506D50BA516D50        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 C0516D506D50CA53        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 6D506D50D1536D50        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 6D506D506D506D50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
