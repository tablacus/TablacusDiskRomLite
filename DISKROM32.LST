                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3B24D          10      JP  DISKIO
000013 4013 C3EC4D          10      JP  DSKCHG
000016 4016 C3424E          10      JP  GETDPB
000019 4019 C3354F          10      JP  CHOICE
00001C 401C C3394F          10      JP  DSKFMT
00001F 401F C33B4F          10      JP  DSKSTP
000022 4022 C33C4F          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3394F          10      JP  DSKFMT
000029 4029 C33B4F          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3434F          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.1.5.3",0
            204449534B20524F    
            4D204C6974652076    
            302E312E352E3300    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 225FF1          16      LD  (BASSTK),HL
000129 4129 ED7B5FF1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 324AF1          13      LD  (_DVSW),A
                                
00013B 413B 21F342          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017C00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD3342          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DBFE          13      LD  (H_STKE+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 219A45          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 21C946          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 21D646          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 218F4F          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 219943          10      LD  HL,ROM_STKE
0001BC 41BC 22DCFE          16      LD  (H_STKE+2),HL
0001BF 41BF 21B24D          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DEFE          13      LD  (H_STKE+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    XOR A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  A,(BANK1_ADR)
                                    CP  'A'
                                    JR  NZ,NOT_8K_BANK
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D9 41D9 CD3801          17      CALL    RSLREG      ;read primary slot #
0001DC 41DC 07               4      RLCA
0001DD 41DD 07               4      RLCA
0001DE 41DE F5              11      PUSH    AF
0001DF 41DF 1605             7      LD  D,4+1
0001E1 41E1 CD3A42          17      CALL    GTSL2_
0001E4 41E4 3244F3          13      LD  (RAMAD3),A
0001E7 41E7 F1              10      POP AF
0001E8 41E8 07               4      RLCA
0001E9 41E9 07               4      RLCA
0001EA 41EA 1603             7      LD  D,2+1
0001EC 41EC CD3A42          17      CALL    GTSL2_
0001EF 41EF 2680             7      LD  H,080H
0001F1 41F1 CD5742          17      CALL    CHK_RAM
0001F4 41F4 3243F3          13      LD  (RAMAD2),A
       41F7                     RAMCHK2:
0001F7 41F7 3A44F3          13      LD  A,(RAMAD3)
0001FA 41FA 2640             7      LD  H,040H
0001FC 41FC CD5742          17      CALL    CHK_RAM
0001FF 41FF 3242F3          13      LD  (RAMAD1),A
       4202                     RAMCHK1:
000202 4202 3A44F3          13      LD  A,(RAMAD3)
000205 4205 2600             7      LD  H,00H
000207 4207 CD5742          17      CALL    CHK_RAM
00020A 420A 3241F3          13      LD  (RAMAD0),A
       420D                     RAMCHK0:
00020D 420D 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000210 4210 010F00          10      LD  BC,0000FH       ;切り上げ
000213 4213 09              11      ADD HL,BC
000214 4214 7D               4      LD  A,L
                                
000215 4215 0604             7      LD  B,4
       4217                     B_DRIVE1:
000217 4217 CB3C             8      SRL H
000219 4219 1F               4      RRA
00021A 421A 10FB            13      DJNZ    B_DRIVE1
                                
00021C 421C C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
00021E 421E 3249F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000221 4221 C9              10      RET
                                
       4222                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
000222 4222 21E743          10      LD  HL,MSG_ERROR_ROM_MODE
000225 4225 CD7243          17      CALL    MSX
000228 4228 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00022C 422C DD219F00        14      LD  IX,CHGET
000230 4230 C31C00          10      JP  _CALSLT
                                
       4233                     GTSL1_:             ;自分のいるスロットを知る
000233 4233 CD3801          17      CALL    RSLREG      ;read primary slot #
000236 4236 0F               4      RRCA
000237 4237 0F               4      RRCA
000238 4238 1601             7      LD  D,1
       423A                     GTSL2_:
00023A 423A E603             7      AND 3       ;[A]=000000PP
00023C 423C 5F               4      LD  E,A     ;[E]=000000PP
00023D 423D 21C1FC          10      LD  HL,EXPTBL
000240 4240 85               4      ADD A,L     ;桁上りは無い
000241 4241 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000242 4242 7B               4      LD  A,E     ;[A]=000000PP
000243 4243 CB7E            13      BIT 7,(HL)
000245 4245 C8              11      RET Z
000246 4246 7D               4      LD  A,L     ;point to SLTTBL entry
000247 4247 C604             7      ADD A,4     ;桁上りは無い
000249 4249 6F               4      LD  L,A
00024A 424A 7E               7      LD  A,(HL)      ;get currently expansion slot register
       424B                     GTSL3_:
00024B 424B 15               4      DEC D
00024C 424C 2803            12      JR  Z,GTSL4_:
00024E 424E 0F               4      RRCA
00024F 424F 18FA            12      JR  GTSL3_:
       4251                     GTSL4_:
000251 4251 E60C             7      AND 00CH        ;[A] = 0000SS00
000253 4253 B3               4      OR  E       ;[A] = 0000SSPP
000254 4254 F680             7      OR  080H        ;[A] = 1000SSPP
000256 4256 C9              10      RET
                                
       4257                     CHK_RAM:
000257 4257 E5              11      PUSH    HL
000258 4258 CDAC42          17      CALL    CHK_RAM0
00025B 425B E1              10      POP HL
00025C 425C C8              11      RET Z
00025D 425D 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000260 4260 E680             7      AND 080H
000262 4262 CD8342          17      CALL    CHK_RAM_SLT
000265 4265 C8              11      RET Z
000266 4266 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000269 4269 E680             7      AND 080H
00026B 426B C601             7      ADD A,1
00026D 426D CD8342          17      CALL    CHK_RAM_SLT
000270 4270 C8              11      RET Z
000271 4271 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000274 4274 E680             7      AND 080H
000276 4276 C602             7      ADD A,2
000278 4278 CD8342          17      CALL    CHK_RAM_SLT
00027B 427B C8              11      RET Z
00027C 427C 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00027F 427F E680             7      AND 080H
000281 4281 C603             7      ADD A,3
       4283                     CHK_RAM_SLT:
000283 4283 E5              11      PUSH    HL
000284 4284 CDAC42          17      CALL    CHK_RAM0        ;スロット#X or X-0
000287 4287 E1              10      POP HL
000288 4288 C8              11      RET Z
000289 4289 CB79             8      BIT 7,C
00028B 428B 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00028D 428D 79               4      LD  A,C
00028E 428E C604             7      ADD A,4*1           ;スロット#X-1
000290 4290 E5              11      PUSH    HL
000291 4291 CDAC42          17      CALL    CHK_RAM0
000294 4294 E1              10      POP HL
000295 4295 C8              11      RET Z
000296 4296 79               4      LD  A,C
000297 4297 C608             7      ADD A,4*2           ;スロット#X-2
000299 4299 E5              11      PUSH    HL
00029A 429A CDAC42          17      CALL    CHK_RAM0
00029D 429D E1              10      POP HL
00029E 429E C8              11      RET Z
00029F 429F 79               4      LD  A,C
0002A0 42A0 C60C             7      ADD A,4*3           ;スロット#X-3
0002A2 42A2 E5              11      PUSH    HL
0002A3 42A3 CDAC42          17      CALL    CHK_RAM0
0002A6 42A6 E1              10      POP HL
       42A7                     CHK_RAM_E:
0002A7 42A7 AF               4      XOR A
0002A8 42A8 3C               4      INC A           ;ZF=0にする
0002A9 42A9 3E00             7      LD  A,0
0002AB 42AB C9              10      RET
                                
       42AC                     CHK_RAM0:
0002AC 42AC 4F               4      LD  C,A
0002AD 42AD 3A00F1          13      LD  A,(ROM_SLT)
0002B0 42B0 B9               4      CP  C
0002B1 42B1 28F4            12      JR  Z,CHK_RAM_E
0002B3 42B3 2E00             7      LD  L,0
       42B5                     CHK_RAM1:
0002B5 42B5 79               4      LD  A,C
0002B6 42B6 DD210C00        14      LD  IX,_RDSLT
0002BA 42BA CDE742          17      CALL    CALSLT_R
0002BD 42BD C6E5             7      ADD A,0E5H
0002BF 42BF 47               4      LD  B,A
0002C0 42C0 5F               4      LD  E,A
0002C1 42C1 79               4      LD  A,C
0002C2 42C2 DD211400        14      LD  IX,_WRSLT
0002C6 42C6 CDE742          17      CALL    CALSLT_R
0002C9 42C9 79               4      LD  A,C
0002CA 42CA DD210C00        14      LD  IX,_RDSLT
0002CE 42CE CDE742          17      CALL    CALSLT_R
0002D1 42D1 B8               4      CP  B
0002D2 42D2 C0              11      RET NZ
0002D3 42D3 D6E5             7      SUB 0E5H
0002D5 42D5 79               4      LD  A,C
0002D6 42D6 5F               4      LD  E,A
0002D7 42D7 DD211400        14      LD  IX,_WRSLT
0002DB 42DB CDE742          17      CALL    CALSLT_R
0002DE 42DE 24               4      INC H
0002DF 42DF 7D               4      LD  A,L
0002E0 42E0 C604             7      ADD A,4
0002E2 42E2 6F               4      LD  L,A
0002E3 42E3 20D0            12      JR  NZ,CHK_RAM1
0002E5 42E5 79               4      LD  A,C     ;ZF=1のハズ
0002E6 42E6 C9              10      RET
                                
       42E7                     CALSLT_R:
0002E7 42E7 C5              11      PUSH    BC
0002E8 42E8 E5              11      PUSH    HL
0002E9 42E9 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002ED 42ED CD1C00          17      CALL    _CALSLT
0002F0 42F0 E1              10      POP HL
0002F1 42F1 C1              10      POP BC
0002F2 42F2 C9              10      RET
                                
       42F3                     AT_ISC:
0002F3 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
0002F3 F0E9 FEB7             7      CP  0B7H            ;FILES
0002F5 F0EB CC7BFE          17      CALL    Z,H_FILE
0002F8 F0EE FEB5             7      CP  0B5H            ;LOAD
0002FA F0F0 CA71FE          10      JP  Z,H_BINS
0002FD F0F3 FE8A             7      CP  08AH            ;RUN
0002FF F0F5 CA76FE          10      JP  Z,H_BINL
000302 F0F8 FED6             7      CP  0D6H            ;COPY
000304 F0FA 2813            12      JR  Z,FIX_COPY
000306 F0FC FECF             7      CP  0CFH            ;BLOAD
000308 F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
000309 F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00030A F100 00                      DB  0
00030B F101 FF45                    DW  ROM_BLOAD
00030D F103 F5              11      PUSH    AF
00030E F104 E5              11      PUSH    HL
00030F F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000312 F108 E1              10      POP HL
000313 F109 F1              10      POP AF
000314 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
000316 F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
000318 F10E C9              10      RET
       F10F                     FIX_COPY:
000319 F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00031A F110 00                      DB  0
00031B F111 5B47                    DW  ROM_COPY
00031D F113 C9              10      RET
       F114                     ROMUSE1:
00031E F114 3A00F1          13      LD  A,(ROM_SLT)
000321 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000323 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
000326 F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
000329 F11F 00                      DB  0
       F120                     _BANK:
00032A F120 00                      DB  0
       F121                     CLSZ:               ;クラスタサイズ
00032B F121 0004                    DW  1024
       F122                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F123                     SECSZ:              ;セクタサイズ
00032D F123 0002                    DW  512
       F124                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F125                     RR_LOW:
00032F F125 0000                    DW  0
       F126                     RR_MID  EQU $-1
       F127                     RR_HIGH:
000331 F127 0000                    DW  0
       F129                     _CLPS:
000333 F129 0000                    DW  0
       F12B                     _LEFT:
000335 F12B 0000                    DW  0
       F12D                     _DTPS:
000337 F12D 0000                    DW  0
       F12F                     _DTA:
000339 F12F 0000                    DW  0
       F131                     FLG_LDIR:
00033B F131 00                      DB  0
                                
                                ;   BDOS
00033C F132 F7              12      RST 30H
00033D F133 00                      DB  0
00033E F134 8F4F                    DW  ROM_BDOS
000340 F136 C9              10      RET 
       F137                     _FCB:
000341 F137 0000                    DW  0
       F139                     _BUF:
       F139                     _BUF_LO:        ;LOGICAL OPERATION
000343 F139 00                      DB  0
       F13A                     _BUF_ST:
000344 F13A 0000                    DW  0
       F13C                     _BUF_EN:
000346 F13C 0000                    DW  0
       F13E                     _BUF_EX:
       F13E                     _BUF_W:
000348 F13E 0000                    DW  0
       F140                     _BUF_H:
00034A F140 0000                    DW  0
       F142                     _BUF_X:
00034C F142 0000                    DW  0
       F144                     _BUF_Y:
00034E F144 00                      DB  0
       F145                     _BUF_P:
00034F F145 00                      DB  0
       F146                     _BUF_O:
000350 F146 00                      DB  0
       F147                     DTAX:
000351 F147 0000                    DW  0
       F149                     B_DRIVE:
000353 F149 00                      DB  0
       F14A                     _DVSW:
000354 F14A 00                      DB  0
       F14B                     FCBX:
000355 F14B 0000                    DW  0
       F14D                     LEFTX:
000357 F14D 0000                    DW  0
       F14F                     PARAM0:
000359 F14F 0000                    DW  0
       F151                     PARAM1:
00035B F151 0000                    DW  0
       F153                     FDRV:
00035D F153 00                      DB  0
       F154                     FNAME:
00035E F154                         DS  8+3
                                
       F15F                     BASSTK:
000369 F15F 0000                    DW  0
       F161                     _HL:
00036B F161 0000                    DW  0
       F163                     _SP:
00036D F163 0000                    DW  0
                                
       F165                     ISC_E:
00036F 436F                         ORG $$+RUN          ;$DEPHASE
                                
       436F                     MSX1:
00036F 436F CDA84F          17      CALL    MSGA1
       4372                     MSX:
000372 4372 7E               7      LD  A,(HL)
000373 4373 23               6      INC HL
000374 4374 B7               4      OR  A
000375 4375 20F8            12      JR  NZ,MSX1
000377 4377 C9              10      RET
                                
       4378                     PRTHX:
000378 4378 F5              11      PUSH    AF
000379 4379 07               4      RLCA
00037A 437A 07               4      RLCA
00037B 437B 07               4      RLCA
00037C 437C 07               4      RLCA
00037D 437D CD8143          17      CALL    PRTA2
000380 4380 F1              10      POP AF
       4381                     PRTA2:
000381 4381 CD8743          17      CALL    ASC
000384 4384 C3A44F          10      JP  MSG_A
                                    
       4387                     ASC:
000387 4387 E60F             7      AND $0F
000389 4389 F630             7      OR  $30
00038B 438B FE3A             7      CP  $3A
00038D 438D D8              11      RET C
00038E 438E C607             7      ADD A,7
000390 4390 C9              10      RET
                                
       4391                     MSN:
000391 4391 7E               7      LD  A,(HL)
000392 4392 23               6      INC HL
000393 4393 CDA44F          17      CALL    MSG_A
000396 4396 10F9            13      DJNZ    MSN
000398 4398 C9              10      RET
                                
       4399                     ROM_STKE:
000399 4399 3E                      DB  03EH
00039A 439A C9              10      RET
00039B 439B 32DAFE          13      LD  (H_STKE),A
00039E 439E E5              11      PUSH    HL
00039F 439F D5              11      PUSH    DE
0003A0 43A0 C5              11      PUSH    BC
0003A1 43A1 181D            12      JR  BASAUTO
                                
0003A3 43A3 AF               4      XOR A
0003A4 43A4 5F               4      LD  E,A
0003A5 43A5 57               4      LD  D,A
0003A6 43A6 0601             7      LD  B,1
0003A8 43A8 2100C0          10      LD  HL,0C000H
0003AB 43AB CDB24D          17      CALL    DISKIO
                                
0003AE 43AE ED735FF1        20      LD  (BASSTK),SP
0003B2 43B2 116BF3          10      LD  DE,RAMUSE
0003B5 43B5 AF               4      XOR A
0003B6 43B6 CD1EC0          17      CALL    0C01EH
0003B9 43B9 116BF3          10      LD  DE,RAMUSE
0003BC 43BC 37               4      SCF
0003BD 43BD CD1EC0          17      CALL    0C01EH
       43C0                     BASAUTO:
0003C0 43C0 210D44          10      LD  HL,AUTOEXEC
0003C3 43C3 1153F1          10      LD  DE,FDRV
0003C6 43C6 010C00          10      LD  BC,1+8+3
0003C9 43C9 EDB0                    LDIR
0003CB 43CB CD564B          17      CALL    ROM_OPEN
0003CE 43CE 3813            12      JR  C,RSTKEE
0003D0 43D0 211944          10      LD  HL,RUN_AUTOEXEC
0003D3 43D3 11F0FB          10      LD  DE,KEYBUF
0003D6 43D6 ED53FAF3        20      LD  (GETPNT),DE
0003DA 43DA 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003DD 43DD EDB0                    LDIR
0003DF 43DF ED53F8F3        20      LD  (PUTPNT),DE
       43E3                     RSTKEE:
0003E3 43E3 C1              10      POP BC
0003E4 43E4 D1              10      POP DE
0003E5 43E5 E1              10      POP HL
0003E6 43E6 C9              10      RET
                                
       43E7                     MSG_ERROR_ROM_MODE:
0003E7 43E7 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
       440C                     NULL:
00040C 440C 00                      DB  0
                                
       440D                     AUTOEXEC:
00040D 440D 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4419                     RUN_AUTOEXEC:
000419 4419 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       442C                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       442C                     ROM_LDIR:
00042C 442C 3A31F1          13      LD  A,(FLG_LDIR)
00042F 442F B7               4      OR  A
000430 4430 2062            12      JR  NZ,ROM_LDIRVM
000432 4432 CB7A             8      BIT 7,D
000434 4434 CABC44          10      JP  Z,ROM_LDIRSLT
                                
                                #if exists USE_NORMAL_32K_ROM
000437 4437 ED7363F1        20      LD  (_SP),SP
00043B 443B 3121FB          10      LD  SP,DRVTBL
       443E                     LDIR1:
00043E 443E 78               4      LD  A,B
00043F 443F B1               4      OR  C
000440 4440 2841            12      JR  Z,LDIRE
                                
000442 4442 C5              11      PUSH    BC
000443 4443 D5              11      PUSH    DE
000444 4444 E5              11      PUSH    HL
000445 4445 3A00F1          13      LD  A,(ROM_SLT)
000448 4448 2680             7      LD  H,080H
00044A 444A CD2400          17      CALL    _ENASLT
00044D 444D E1              10      POP HL
00044E 444E D1              10      POP DE
00044F 444F C1              10      POP BC
       4450                     LDIR2:
000450 4450 7A               4      LD  A,D
000451 4451 FEC0             7      CP  0C0H
000453 4453 302C            12      JR  NC,LDIR4
                                
000455 4455 C5              11      PUSH    BC
000456 4456 D5              11      PUSH    DE
000457 4457 115EF5          10      LD  DE,BUF
                                
00045A 445A 78               4      LD  A,B
00045B 445B B7               4      OR  A
00045C 445C 2803            12      JR  Z,LDIR3
00045E 445E 010001          10      LD  BC,00100H
       4461                     LDIR3:
000461 4461 C5              11      PUSH    BC
000462 4462 EDB0                    LDIR
000464 4464 2261F1          16      LD  (_HL),HL
                                
000467 4467 3A43F3          13      LD  A,(RAMAD2)
00046A 446A 2680             7      LD  H,080H
00046C 446C CD2400          17      CALL    _ENASLT
                                
00046F 446F 215EF5          10      LD  HL,BUF
000472 4472 C1              10      POP BC
000473 4473 D1              10      POP DE
000474 4474 EDB0                    LDIR
                                
000476 4476 2A61F1          16      LD  HL,(_HL)
000479 4479 C1              10      POP BC
00047A 447A 78               4      LD  A,B
00047B 447B B7               4      OR  A
00047C 447C 2805            12      JR  Z,LDIRE
00047E 447E 05               4      DEC B
00047F 447F 18BD            12      JR  LDIR1
       4481                     LDIR4:
                                #endif
000481 4481 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       4483                     LDIRE:
000483 4483 D5              11      PUSH    DE
000484 4484 E5              11      PUSH    HL
000485 4485 3A43F3          13      LD  A,(RAMAD2)
000488 4488 2680             7      LD  H,080H
00048A 448A CD2400          17      CALL    _ENASLT
00048D 448D E1              10      POP HL
00048E 448E D1              10      POP DE
00048F 448F ED7B63F1        20      LD  SP,(_SP)
                                #endif
000493 4493 C9              10      RET
                                
       4494                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
000494 4494 C5              11      PUSH    BC
000495 4495 D5              11      PUSH    DE
000496 4496 E5              11      PUSH    HL
000497 4497 3A00F1          13      LD  A,(ROM_SLT)
00049A 449A 2680             7      LD  H,080H
00049C 449C CD2400          17      CALL    _ENASLT
00049F 449F E1              10      POP HL
0004A0 44A0 D1              10      POP DE
0004A1 44A1 C1              10      POP BC
                                #endif
0004A2 44A2 C5              11      PUSH    BC
0004A3 44A3 D5              11      PUSH    DE
0004A4 44A4 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0004A8 44A8 DD215C00        14      LD  IX,LDIRVM
0004AC 44AC CD1C00          17      CALL    _CALSLT
                                #if exists USE_NORMAL_32K_ROM
0004AF 44AF 2680             7      LD  H,080H
0004B1 44B1 3A43F3          13      LD  A,(RAMAD2)
0004B4 44B4 CD2400          17      CALL    _ENASLT
                                #endif
0004B7 44B7 E1              10      POP HL
0004B8 44B8 C1              10      POP BC
0004B9 44B9 09              11      ADD HL,BC
0004BA 44BA EB               4      EX  DE,HL
0004BB 44BB C9              10      RET
                                
       44BC                     ROM_LDIRSLT:
0004BC 44BC EB               4      EX  DE,HL
       44BD                     RLDIRSLT1:
0004BD 44BD 1A               7      LD  A,(DE)
0004BE 44BE 13               6      INC DE
0004BF 44BF C5              11      PUSH    BC
0004C0 44C0 D5              11      PUSH    DE
0004C1 44C1 E5              11      PUSH    HL
0004C2 44C2 5F               4      LD  E,A
0004C3 44C3 3A42F3          13      LD  A,(RAMAD1)
0004C6 44C6 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004CA 44CA DD211400        14      LD  IX,_WRSLT
0004CE 44CE CD1C00          17      CALL    _CALSLT
0004D1 44D1 E1              10      POP HL
0004D2 44D2 D1              10      POP DE
0004D3 44D3 C1              10      POP BC
0004D4 44D4 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004D6 44D6 EABD44          10      JP  PE,RLDIRSLT1
0004D9 44D9 EB               4      EX  DE,HL
0004DA 44DA C9              10      RET
                                
       44DB                     END_OF_LINE:
0004DB 44DB 215EF5          10      LD  HL,BUF
       44DE                     EOL1:
0004DE 44DE 7E               7      LD  A,(HL)
0004DF 44DF C8              11      RET Z
0004E0 44E0 FE0D             7      CP  00DH
0004E2 44E2 2807            12      JR  Z,EOLE
0004E4 44E4 FE0A             7      CP  00AH
0004E6 44E6 2803            12      JR  Z,EOLE
0004E8 44E8 23               6      INC HL
0004E9 44E9 18F3            12      JR  EOL1
       44EB                     EOLE:
0004EB 44EB 3600            10      LD  (HL),0
0004ED 44ED 23               6      INC HL
0004EE 44EE 7E               7      LD  A,(HL)
0004EF 44EF FE0A             7      CP  00AH
0004F1 44F1 C0              11      RET NZ
0004F2 44F2 23               6      INC HL
0004F3 44F3 C9              10      RET
                                
       44F4                     ROM_LOAD_ASCII:
0004F4 44F4 210000          10      LD  HL,0
0004F7 44F7 223AF1          16      LD  (_BUF_ST),HL    ;読み出し位置
0004FA 44FA 2A76F6          16      LD  HL,(TXTTAB)
0004FD 44FD 223CF1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000500 4500 215EF5          10      LD  HL,BUF
000503 4503 222FF1          16      LD  (_DTA),HL
       4506                     RLOAD_A1:
000506 4506 2A3AF1          16      LD  HL,(_BUF_ST)
000509 4509 2225F1          16      LD  (RR_LOW),HL
00050C 450C 210201          10      LD  HL,258
00050F 450F CD7649          17      CALL    ROM_READ
000512 4512 7C               4      LD  A,H
000513 4513 B5               4      OR  L
000514 4514 2877            12      JR  Z,RLOAD_AEND
000516 4516 015EF5          10      LD  BC,BUF
000519 4519 09              11      ADD HL,BC
00051A 451A 3600            10      LD  (HL),0
00051C 451C CDDB44          17      CALL    END_OF_LINE
00051F 451F 015EF5          10      LD  BC,BUF
000522 4522 A7               4      AND A
000523 4523 ED42            15      SBC HL,BC
000525 4525 2810            12      JR  Z,RLOAD_A2
000527 4527 4D               4      LD  C,L
000528 4528 44               4      LD  B,H
000529 4529 ED5B3AF1        20      LD  DE,(_BUF_ST)
00052D 452D 19              11      ADD HL,DE
00052E 452E 223AF1          16      LD  (_BUF_ST),HL
000531 4531 3A5EF5          13      LD  A,(BUF)
000534 4534 B7               4      OR  A
000535 4535 28CF            12      JR  Z,RLOAD_A1
       4537                     RLOAD_A2:
000537 4537 115EF5          10      LD  DE,BUF
00053A 453A CDED4A          17      CALL    SPCUTEX
00053D 453D 1A               7      LD  A,(DE)
00053E 453E B7               4      OR  A
00053F 453F 284C            12      JR  Z,RLOAD_AEND
000541 4541 CDFF4A          17      CALL    GETNUM
000544 4544 7C               4      LD  A,H
000545 4545 B5               4      OR  L
000546 4546 CAEC45          10      JP  Z,ERROR_DIRECT_IN_FILE
000549 4549 DD2A3CF1        20      LD  IX,(_BUF_EN)
00054D 454D DD7502          19      LD  (IX+2),L
000550 4550 DD7403          19      LD  (IX+3),H
                                
000553 4553 CDE64A          17      CALL    SPCUT
000556 4556 EB               4      EX  DE,HL
000557 4557 DDE5            15      PUSH    IX
000559 4559 DD21B242        14      LD  IX,CRUNCH
00055D 455D FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000561 4561 CD1C00          17      CALL    _CALSLT
000564 4564 DDE1            14      POP IX
000566 4566 EB               4      EX  DE,HL
000567 4567 111FF4          10      LD  DE,KBUF
00056A 456A 37               4      SCF
00056B 456B ED52            15      SBC HL,DE
00056D 456D 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
00056F 456F 387B            12      JR  C,ERROR_DIRECT_IN_FILE
000571 4571 4D               4      LD  C,L
000572 4572 44               4      LD  B,H
000573 4573 2A3CF1          16      LD  HL,(_BUF_EN)
000576 4576 110400          10      LD  DE,4
000579 4579 19              11      ADD HL,DE
00057A 457A 111FF4          10      LD  DE,KBUF
                                
00057D 457D EB               4      EX  DE,HL
00057E 457E EDB0                    LDIR
000580 4580 EB               4      EX  DE,HL
                                
000581 4581 DD7500          19      LD  (IX+0),L
000584 4584 DD7401          19      LD  (IX+1),H
000587 4587 223CF1          16      LD  (_BUF_EN),HL
00058A 458A C30645          10      JP  RLOAD_A1
                                
       458D                     RLOAD_AEND:
00058D 458D 2A3CF1          16      LD  HL,(_BUF_EN)
000590 4590 AF               4      XOR A
000591 4591 77               7      LD  (HL),A
000592 4592 23               6      INC HL
000593 4593 77               7      LD  (HL),A
000594 4594 23               6      INC HL
000595 4595 223CF1          16      LD  (_BUF_EN),HL
000598 4598 183B            12      JR  RLOAD_END1
                                
       459A                     ROM_LOAD:
00059A 459A CD2C47          17      CALL    INIT_PARAM
00059D 459D CD164A          17      CALL    FILE_B
0005A0 45A0 3A54F1          13      LD  A,(FNAME)
0005A3 45A3 FE20             7      CP  020H
0005A5 45A5 CA114A          10      JP  Z,ROM_ORG
                                
0005A8 45A8 CD564B          17      CALL    ROM_OPEN
0005AB 45AB 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005AD 45AD 2139F1          10      LD  HL,_BUF
0005B0 45B0 222FF1          16      LD  (_DTA),HL
0005B3 45B3 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0005B6 45B6 CD7649          17      CALL    ROM_READ
0005B9 45B9 3A39F1          13      LD  A,(_BUF)
0005BC 45BC 3C               4      INC A
0005BD 45BD C2F444          10      JP  NZ,ROM_LOAD_ASCII
0005C0 45C0 2A76F6          16      LD  HL,(TXTTAB)
0005C3 45C3 222FF1          16      LD  (_DTA),HL
0005C6 45C6 EB               4      EX  DE,HL
0005C7 45C7 2100FF          10      LD  HL,-256
0005CA 45CA 39              11      ADD HL,SP
0005CB 45CB ED52            15      SBC HL,DE
0005CD 45CD CD7649          17      CALL    ROM_READ
0005D0 45D0 ED5B2FF1        20      LD  DE,(_DTA)
0005D4 45D4 19              11      ADD HL,DE
       45D5                     RLOAD_END1:
0005D5 45D5 22C2F6          16      LD  (VARTAB),HL
0005D8 45D8 22C4F6          16      LD  (ARYTAB),HL
0005DB 45DB 22C6F6          16      LD  (STREND),HL
                                
0005DE 45DE AF               4      XOR A
0005DF 45DF 213CF1          10      LD  HL,_BUF+3
0005E2 45E2 77               7      LD  (HL),A
0005E3 45E3 2B               6      DEC HL
0005E4 45E4 77               7      LD  (HL),A
0005E5 45E5 2B               6      DEC HL
0005E6 45E6 77               7      LD  (HL),A
0005E7 45E7 2B               6      DEC HL
0005E8 45E8 3E8F             7      LD  A,08FH          ;REM
0005EA 45EA 77               7      LD  (HL),A
0005EB 45EB C9              10      RET
                                
       45EC                     ERROR_DIRECT_IN_FILE:
0005EC 45EC 1E39             7      LD  E,57            ;Direct statement in file
0005EE 45EE 01                      DB  1           ;LD BC,
       45EF                     ERROR_FILE_NOT_OPEN:
0005EF 45EF 1E3B             7      LD  E,59            ;File not OPEN
0005F1 45F1 01                      DB  1           ;LD BC,
       45F2                     ERROR_FILE_NOT_FOUND:
0005F2 45F2 1E35             7      LD  E,53            ;File not found
       45F4                     ERROR:
0005F4 45F4 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005F8 45F8 DD216F40        14      LD  IX,ERRHAND
0005FC 45FC C31C00          10      JP  _CALSLT
                                
       45FF                     ROM_BLOAD:
0005FF 45FF CD2C47          17      CALL    INIT_PARAM
000602 4602 CD164A          17      CALL    FILE_B
000605 4605 CD564B          17      CALL    ROM_OPEN
000608 4608 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00060A 460A 2139F1          10      LD  HL,_BUF
00060D 460D 222FF1          16      LD  (_DTA),HL
000610 4610 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000613 4613 CD7649          17      CALL    ROM_READ
000616 4616 3A39F1          13      LD  A,(_BUF)
000619 4619 FEFE             7      CP  0FEH
00061B 461B 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00061D 461D 210EF1          10      LD  HL,BLOAD_RET
000620 4620 2206F1          16      LD  (SWC_BLOAD),HL
                                
000623 4623 2A51F1          16      LD  HL,(PARAM1)
000626 4626 7E               7      LD  A,(HL)
000627 4627 FE2C             7      CP  ','
000629 4629 2048            12      JR  NZ,RBREAD_MEM
00062B 462B 23               6      INC HL
00062C 462C 7E               7      LD  A,(HL)
00062D 462D CD404B          17      CALL    CAP
000630 4630 32BEFC          13      LD  (RUNBNF),A
       4633                     RBOS1:
000633 4633 7E               7      LD  A,(HL)
000634 4634 23               6      INC HL
000635 4635 B7               4      OR  A
000636 4636 282F            12      JR  Z,RBREAD_OSE
000638 4638 FE3A             7      CP  ':'
00063A 463A 282B            12      JR  Z,RBREAD_OSE
00063C 463C FE2C             7      CP  ','     ;次のパラメータを探す
00063E 463E 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000640 4640 2251F1          16      LD  (PARAM1),HL
000643 4643 7E               7      LD  A,(HL)
000644 4644 B7               4      OR  A
000645 4645 2820            12      JR  Z,RBREAD_OSE
000647 4647 DD21644C        14      LD  IX,FRMEVL
00064B 464B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00064F 464F CD1C00          17      CALL    _CALSLT
000652 4652 2251F1          16      LD  (PARAM1),HL
000655 4655 3A63F6          13      LD  A,(VALTYP)
000658 4658 FE02             7      CP  2
00065A 465A 200B            12      JR  NZ,RBREAD_OSE
00065C 465C 2A3AF1          16      LD  HL,(_BUF_ST)
00065F 465F ED5BF8F7        20      LD  DE,(DACDAT)
000663 4663 19              11      ADD HL,DE
000664 4664 223AF1          16      LD  (_BUF_ST),HL
       4667                     RBREAD_OSE:
000667 4667 3ABEFC          13      LD  A,(RUNBNF)
00066A 466A FE53             7      CP  'S'
00066C 466C 2005            12      JR  NZ,RBREAD_MEM
00066E 466E 3E01             7      LD  A,1
000670 4670 3231F1          13      LD  (FLG_LDIR),A
       4673                     RBREAD_MEM:
000673 4673 2A3AF1          16      LD  HL,(_BUF_ST)
000676 4676 22BFFC          16      LD  (SAVENT),HL
000679 4679 222FF1          16      LD  (_DTA),HL
00067C 467C 21FFFF          10      LD  HL,0FFFFH
00067F 467F CD7649          17      CALL    ROM_READ
000682 4682 3ABEFC          13      LD  A,(RUNBNF)
000685 4685 FE52             7      CP  'R'
000687 4687 2006            12      JR  NZ,RBREAD1
000689 4689 2A3EF1          16      LD  HL,(_BUF_EX)
00068C 468C 2206F1          16      LD  (SWC_BLOAD),HL
       468F                     RBREAD1:
       468F                     ROM_NEXT:
00068F 468F 2A51F1          16      LD  HL,(PARAM1)
000692 4692 7E               7      LD  A,(HL)
000693 4693 2B               6      DEC HL
000694 4694 B7               4      OR  A
000695 4695 2805            12      JR  Z,RN1
000697 4697 FE3A             7      CP  ':'
000699 4699 2801            12      JR  Z,RN1
00069B 469B 23               6      INC HL
       469C                     RN1:
00069C 469C 5D               4      LD  E,L
00069D 469D 54               4      LD  D,H
                                
00069E 469E CD164B          17      CALL    SEARCH_END
0006A1 46A1 B7               4      OR  A
0006A2 46A2 2821            12      JR  Z,REM
       46A4                     RN3:                    ;マルチステートメントの処理
0006A4 46A4 7E               7      LD  A,(HL)
                                
0006A5 46A5 FEB5             7      CP  0B5H            ;LOAD
0006A7 46A7 CA9A45          10      JP  Z,ROM_LOAD
0006AA 46AA FE8A             7      CP  08AH            ;RUN
0006AC 46AC 281B            12      JR  Z,ROM_RUN
0006AE 46AE FEB7             7      CP  0B7H            ;FILES
0006B0 46B0 2824            12      JR  Z,ROM_FILES
0006B2 46B2 FED6             7      CP  0D6H            ;COPY
0006B4 46B4 CA5B47          10      JP  Z,ROM_COPY
0006B7 46B7 FE20             7      CP  020H
0006B9 46B9 2807            12      JR  Z,RN_SP
                                
0006BB 46BB 3E28             7      LD  A,028H          ;JR Z,
0006BD 46BD 320CF1          13      LD  (SWC_BLOAD_M),A
0006C0 46C0 7E               7      LD  A,(HL)
0006C1 46C1 C9              10      RET
       46C2                     RN_SP:
0006C2 46C2 23               6      INC HL
0006C3 46C3 18DF            12      JR  RN3
                                
       46C5                     REM:
0006C5 46C5 EB               4      EX  DE,HL
0006C6 46C6 3E8F             7      LD  A,08FH          ;REM
0006C8 46C8 C9              10      RET
                                
       46C9                     ROM_RUN:
0006C9 46C9 23               6      INC HL
0006CA 46CA 7E               7      LD  A,(HL)
0006CB 46CB 2B               6      DEC HL
0006CC 46CC B7               4      OR  A
0006CD 46CD 2803            12      JR  Z,ROM_RUN1
0006CF 46CF CD9A45          17      CALL    ROM_LOAD
       46D2                     ROM_RUN1:
0006D2 46D2 3E8A             7      LD  A,08AH          ;RUN
0006D4 46D4 77               7      LD  (HL),A
0006D5 46D5 C9              10      RET
                                
       46D6                     ROM_FILES:
0006D6 46D6 CD2C47          17      CALL    INIT_PARAM
0006D9 46D9 CD164A          17      CALL    FILE_B
0006DC 46DC CD474F          17      CALL    GET_DISK_BANK_FDRV
0006DF 46DF 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0006E2 46E2 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0006E5 46E5 3A54F1          13      LD  A,(FNAME)
0006E8 46E8 FE21             7      CP  021H
0006EA 46EA 3005            12      JR  NC,RFILES0
0006EC 46EC 060B             7      LD  B,11
0006EE 46EE CDAA4A          17      CALL    FILE10
       46F1                     RFILES0:
0006F1 46F1 CD734D          17      CALL    GET_DIR_DAT
       46F4                     RFILES1:
0006F4 46F4 CD724B          17      CALL    FILESE
0006F7 46F7 302E            12      JR  NC,RFILES_NOT_MATCH
       46F9                     RFILES_DISP:
0006F9 46F9 E5              11      PUSH    HL
0006FA 46FA 0608             7      LD  B,8
0006FC 46FC CD9143          17      CALL    MSN
0006FF 46FF 3E2E             7      LD  A,'.'
000701 4701 CDA44F          17      CALL    MSG_A
000704 4704 0603             7      LD  B,3
000706 4706 CD9143          17      CALL    MSN
000709 4709 3ADDF3          13      LD  A,(CSRX)
00070C 470C 47               4      LD  B,A
00070D 470D 3AB0F3          13      LD  A,(LINLEN)
000710 4710 90               4      SUB B
000711 4711 FE0C             7      CP  12
000713 4713 3009            12      JR  NC,RFILES2
000715 4715 3E0D             7      LD  A,00DH      ;改行
000717 4717 CDA44F          17      CALL    MSG_A
00071A 471A 3E0A             7      LD  A,00AH
00071C 471C 1802            12      JR  RFILES3
       471E                     RFILES2:
00071E 471E 3E20             7      LD  A,020H
       4720                     RFILES3:
000720 4720 CDA44F          17      CALL    MSG_A
000723 4723 E1              10      POP HL
000724 4724 CD8E4B          17      CALL    FNEXT
       4727                     RFILES_NOT_MATCH:
000727 4727 20CB            12      JR  NZ,RFILES1
000729 4729 C38F46          10      JP  ROM_NEXT
                                
       472C                     INIT_PARAM:
00072C 472C 224FF1          16      LD  (PARAM0),HL
00072F 472F 2251F1          16      LD  (PARAM1),HL
000732 4732 EB               4      EX  DE,HL
000733 4733 AF               4      XOR A
000734 4734 3231F1          13      LD  (FLG_LDIR),A
000737 4737 32BEFC          13      LD  (RUNBNF),A
00073A 473A 3263F6          13      LD  (VALTYP),A
00073D 473D 13               6      INC DE
00073E 473E CDE64A          17      CALL    SPCUT
000741 4741 1A               7      LD  A,(DE)
000742 4742 B7               4      OR  A
000743 4743 C8              11      RET Z
000744 4744 FE3A             7      CP  ':'
000746 4746 C8              11      RET Z
000747 4747 FE28             7      CP  '('
000749 4749 C8              11      RET Z
00074A 474A EB               4      EX  DE,HL
00074B 474B DD21644C        14      LD  IX,FRMEVL
00074F 474F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000753 4753 CD1C00          17      CALL    _CALSLT
000756 4756 2251F1          16      LD  (PARAM1),HL
000759 4759 C9              10      RET
                                
00075A 475A 00               4      NOP
       475B                     ROM_COPY:
00075B 475B CD2C47          17      CALL    INIT_PARAM
00075E 475E 3A63F6          13      LD  A,(VALTYP)
000761 4761 FE03             7      CP  3       ;string
000763 4763 C2114A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000766 4766 CD164A          17      CALL    FILE_B
000769 4769 CD564B          17      CALL    ROM_OPEN
00076C 476C DAF245          10      JP  C,ERROR_FILE_NOT_FOUND
                                
00076F 476F 213EF1          10      LD  HL,_BUF_W
000772 4772 222FF1          16      LD  (_DTA),HL
000775 4775 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000778 4778 CD7649          17      CALL    ROM_READ
                                
00077B 477B AF               4      XOR A
00077C 477C 3239F1          13      LD  (_BUF_LO),A     ;PSET
00077F 477F 3246F1          13      LD  (_BUF_O),A      ;向き
                                
000782 4782 2A51F1          16      LD  HL,(PARAM1)
       4785                     RCP_PARAM1:
000785 4785 7E               7      LD  A,(HL)
000786 4786 23               6      INC HL
000787 4787 B7               4      OR  A
000788 4788 CA114A          10      JP  Z,ROM_ORG
00078B 478B FE3A             7      CP  ':'
00078D 478D CA114A          10      JP  Z,ROM_ORG
000790 4790 FE2C             7      CP  ','
000792 4792 2012            12      JR  NZ,RCP_PARAM1_
                                
000794 4794 DD212F54        14      LD  IX,FRMQNT
000798 4798 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00079C 479C CD1C00          17      CALL    _CALSLT
00079F 479F 7B               4      LD  A,E
0007A0 47A0 87               4      ADD A,A
0007A1 47A1 87               4      ADD A,A
0007A2 47A2 3246F1          13      LD  (_BUF_O),A
0007A5 47A5 7E               7      LD  A,(HL)
       47A6                     RCP_PARAM1_:
0007A6 47A6 FE28             7      CP  '('
0007A8 47A8 20DB            12      JR  NZ,RCP_PARAM1
                                
0007AA 47AA DD212F54        14      LD  IX,FRMQNT
0007AE 47AE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007B2 47B2 CD1C00          17      CALL    _CALSLT
                                
0007B5 47B5 ED5342F1        20      LD  (_BUF_X),DE
                                
       47B9                     RCP_PARAM2:
0007B9 47B9 23               6      INC HL
0007BA 47BA 7E               7      LD  A,(HL)
0007BB 47BB FE20             7      CP  020H
0007BD 47BD 28FA            12      JR  Z,RCP_PARAM2
0007BF 47BF FE2C             7      CP  ','
0007C1 47C1 28F6            12      JR  Z,RCP_PARAM2
                                
0007C3 47C3 DD212F54        14      LD  IX,FRMQNT
0007C7 47C7 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007CB 47CB CD1C00          17      CALL    _CALSLT
                                
0007CE 47CE ED5344F1        20      LD  (_BUF_Y),DE
       47D2                     RCP_PARAM3:
0007D2 47D2 23               6      INC HL
0007D3 47D3 7E               7      LD  A,(HL)
0007D4 47D4 FE20             7      CP  020H
0007D6 47D6 28FA            12      JR  Z,RCP_PARAM3
0007D8 47D8 FE29             7      CP  ')'
0007DA 47DA 28F6            12      JR  Z,RCP_PARAM3
0007DC 47DC FE2C             7      CP  ','
0007DE 47DE 2033            12      JR  NZ,RCP_ST
                                
0007E0 47E0 23               6      INC HL
0007E1 47E1 DD212F54        14      LD  IX,FRMQNT
0007E5 47E5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007E9 47E9 CD1C00          17      CALL    _CALSLT
                                
0007EC 47EC 7B               4      LD  A,E
0007ED 47ED 3245F1          13      LD  (_BUF_P),A
                                
       47F0                     RCP_PARAM4:
0007F0 47F0 7E               7      LD  A,(HL)
0007F1 47F1 23               6      INC HL
0007F2 47F2 FE20             7      CP  020H
0007F4 47F4 28FA            12      JR  Z,RCP_PARAM4
                                
0007F6 47F6 FE2C             7      CP  ','
0007F8 47F8 2019            12      JR  NZ,RCP_ST
                                
0007FA 47FA 7E               7      LD  A,(HL)
0007FB 47FB 0604             7      LD  B,4
0007FD 47FD FEC3             7      CP  0C3H        ;PRESET
0007FF 47FF 280E            12      JR  Z,RCP_LO
000801 4801 05               4      DEC B       ;3
000802 4802 D6F8             7      SUB 0F8H        ;XOR
000804 4804 2809            12      JR  Z,RCP_LO
000806 4806 05               4      DEC B       ;2
000807 4807 3C               4      INC A       ;OR
000808 4808 2805            12      JR  Z,RCP_LO
00080A 480A 05               4      DEC B       ;1
00080B 480B 3C               4      INC A       ;AND
00080C 480C 2801            12      JR  Z,RCP_LO
00080E 480E 05               4      DEC B       ;0
                                                ;PSET
       480F                     RCP_LO:
00080F 480F 78               4      LD  A,B
000810 4810 3239F1          13      LD  (_BUF_LO),A
       4813                     RCP_ST:
000813 4813 2AC6F6          16      LD  HL,(STREND)
000816 4816 222FF1          16      LD  (_DTA),HL
000819 4819 EB               4      EX  DE,HL
00081A 481A 2100FE          10      LD  HL,-512
00081D 481D 39              11      ADD HL,SP
00081E 481E AF               4      XOR A
00081F 481F ED52            15      SBC HL,DE
000821 4821 3008            12      JR  NC,RCP0
000823 4823 215EF5          10      LD  HL,BUF
000826 4826 222FF1          16      LD  (_DTA),HL
000829 4829 6F               4      LD  L,A ;0
00082A 482A 67               4      LD  H,A ;0
       482B                     RCP0:
00082B 482B 24               4      INC H
00082C 482C 223CF1          16      LD  (_BUF_EN),HL
       482F                     RCP1:
00082F 482F F3               4      DI
000830 4830 CD0449          17      CALL    WAIT_VDP
                                
000833 4833 3A0700          13      LD  A,(WRVDP)
000836 4836 4F               4      LD  C,A
000837 4837 0C               4      INC C       ;C := PORT#1's address(WR)
000838 4838 3E24             7      LD  A,36
00083A 483A ED79            12      OUT (C),A
00083C 483C 3E91             7      LD  A,080H+17
00083E 483E ED79            12      OUT (C),A       ;R#17 := 36
                                
000840 4840 0C               4      INC C
000841 4841 0C               4      INC C       ;C := PORT#3's address(WR)
000842 4842 2A42F1          16      LD  HL,(_BUF_X)
000845 4845 ED69            12      OUT (C),L       ;R#36 DX
000847 4847 ED61            12      OUT (C),H       ;R#37
000849 4849 2A44F1          16      LD  HL,(_BUF_Y)
00084C 484C ED69            12      OUT (C),L       ;R#38 DY
00084E 484E ED61            12      OUT (C),H       ;R#39
000850 4850 2A3EF1          16      LD  HL,(_BUF_W)
000853 4853 ED69            12      OUT (C),L       ;R#40 NX
000855 4855 ED61            12      OUT (C),H       ;R#41
000857 4857 2A40F1          16      LD  HL,(_BUF_H)
00085A 485A ED69            12      OUT (C),L       ;R#42 NY
00085C 485C ED61            12      OUT (C),H       ;R#43
                                
00085E 485E DD2AAFFC        20      LD  IX,(SCRMOD)
000862 4862 3A39F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000865 4865 B7               4      OR  A
000866 4866 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000868 4868 DD7D             9      LD  A,IXL
00086A 486A FE08             7      CP  8
00086C 486C 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
00086E 486E FE06             7      CP  6
000870 4870 2A42F1          16      LD  HL,(_BUF_X)
000873 4873 3A3EF1          13      LD  A,(_BUF_W)
000876 4876 2005            12      JR  NZ,SCR57
000878 4878 B5               4      OR  L       ;スクリーン6
000879 4879 E603             7      AND 3
00087B 487B 200D            12      JR  NZ,USE_LMMC
       487D                     SCR57:              ;スクリーン5,7
00087D 487D B5               4      OR  L
00087E 487E E601             7      AND 1
000880 4880 2008            12      JR  NZ,USE_LMMC
       4882                     USE_HMMC:
000882 4882 DD2E08          10      LD  IXL,8
       4885                     USE_HMMC8:
000885 4885 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000887 4887 3239F1          13      LD  (_BUF_LO),A
       488A                     USE_LMMC:
00088A 488A 110000          10      LD  DE,0
00088D 488D 06FF             7      LD  B,-1
00088F 488F CD2F49          17      CALL    GET_PIXEL
000892 4892 ED79            12      OUT (C),A       ;R#44 first DATA
000894 4894 3A46F1          13      LD  A,(_BUF_O)
000897 4897 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000899 4899 3A39F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00089C 489C F6B0             7      OR  0B0H        ;R#46 LMMC command
00089E 489E ED79            12      OUT (C),A
                                
0008A0 48A0 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008A2 48A2 0D               4      DEC C
0008A3 48A3 0D               4      DEC C       ;C := PORT#1's address(WR)
0008A4 48A4 3EAC             7      LD  A,080H+44
0008A6 48A6 ED79            12      OUT (C),A
0008A8 48A8 3E91             7      LD  A,080H+17
0008AA 48AA ED79            12      OUT (C),A       ;R#17 := 44
                                
0008AC 48AC 3A0600          13      LD  A,(RDVDP)
0008AF 48AF 3C               4      INC A
0008B0 48B0 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
0008B2 48B2 3E02             7      LD  A,2
0008B4 48B4 ED79            12      OUT (C),A
0008B6 48B6 3E8F             7      LD  A,08FH
0008B8 48B8 ED79            12      OUT (C),A
0008BA 48BA 3A39F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008BD 48BD E640             7      AND 040H
0008BF 48BF 201C            12      JR  NZ,LOOP_HMMC
       48C1                     LOOP_COPY:
0008C1 48C1 CD2F49          17      CALL    GET_PIXEL
0008C4 48C4 08               4      EX  AF,AF'
0008C5 48C5 FD4C             9      LD  C,IYH
       48C7                     LOOP_COPY1:
0008C7 48C7 ED78            12      IN  A,(C)
0008C9 48C9 0F               4      RRCA            ;RRCAではサインフラグは変化しない
0008CA 48CA 300A            12      JR  NC,EXIT_COPY    ;check CE bit
0008CC 48CC F2C748          10      JP  P,LOOP_COPY1    ;check TR bit
0008CF 48CF 08               4      EX  AF,AF'
0008D0 48D0 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008D2 48D2 ED79            12      OUT (C),A
0008D4 48D4 18EB            12      JR  LOOP_COPY
                                
       48D6                     EXIT_COPY:
0008D6 48D6 CD0C49          17      CALL    GET_STATUS_0
0008D9 48D9 FB               4      EI
0008DA 48DA C38F46          10      JP  ROM_NEXT
                                
       48DD                     LOOP_HMMC:
0008DD 48DD FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008DF 48DF 43               4      LD  B,E
0008E0 48E0 7B               4      LD  A,E
0008E1 48E1 B7               4      OR  A
0008E2 48E2 2802            12      JR  Z,LOOP_HMMC1
0008E4 48E4 EDB3                    OTIR
       48E6                     LOOP_HMMC1:
0008E6 48E6 14               4      INC D
       48E7                     LOOP_HMMC2:
0008E7 48E7 15               4      DEC D
0008E8 48E8 2805            12      JR  Z,LOOP_HMMC3
0008EA 48EA EDB3                    OTIR
0008EC 48EC C3E748          10      JP  LOOP_HMMC2
       48EF                     LOOP_HMMC3:
0008EF 48EF ED78            12      IN  A,(C)
0008F1 48F1 0F               4      RRCA
0008F2 48F2 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
0008F4 48F4 2A3CF1          16      LD  HL,(_BUF_EN)
0008F7 48F7 CD7649          17      CALL    ROM_READ
0008FA 48FA EB               4      EX  DE,HL
0008FB 48FB 2A2FF1          16      LD  HL,(_DTA)
0008FE 48FE 7A               4      LD  A,D
0008FF 48FF B3               4      OR  E
000900 4900 20DB            12      JR  NZ,LOOP_HMMC
000902 4902 18C3            12      JR  LOOP_COPY1
                                    
       4904                     WAIT_VDP:
000904 4904 3E02             7      LD  A,2
000906 4906 CD0D49          17      CALL    GET_STATUS
000909 4909 0F               4      RRCA
00090A 490A 38F8            12      JR  C,WAIT_VDP
       490C                     GET_STATUS_0:
00090C 490C AF               4      XOR A
       490D                     GET_STATUS:
00090D 490D C5              11      PUSH    BC
00090E 490E ED4B0600        20      LD  BC,(RDVDP)
000912 4912 0C               4      INC C
000913 4913 ED79            12      OUT (C),A
000915 4915 3E8F             7      LD  A,08FH
000917 4917 ED79            12      OUT (C),A
000919 4919 ED78            12      IN  A,(C)
00091B 491B C1              10      POP BC
00091C 491C C9              10      RET
                                
       491D                     GET_PIXEL256:
00091D 491D 7A               4      LD  A,D
00091E 491E B3               4      OR  E
00091F 491F 200A            12      JR  NZ,GET_PIXEL1
000921 4921 2A3CF1          16      LD  HL,(_BUF_EN)
000924 4924 CD7649          17      CALL    ROM_READ
000927 4927 EB               4      EX  DE,HL
000928 4928 2A2FF1          16      LD  HL,(_DTA)
       492B                     GET_PIXEL1:
00092B 492B 7E               7      LD  A,(HL)
00092C 492C 23               6      INC HL
00092D 492D 1B               6      DEC DE
00092E 492E C9              10      RET
                                
       492F                     GET_PIXEL:
00092F 492F 04               4      INC B
000930 4930 DD7D             9      LD  A,IXL
000932 4932 FE08             7      CP  8
000934 4934 28E7            12      JR  Z,GET_PIXEL256
000936 4936 FE06             7      CP  6
000938 4938 282E            12      JR  Z,GET_PIXEL4
                                
00093A 493A CB40             8      BIT 0,B
00093C 493C 200E            12      JR  NZ,GET_PIXEL2
                                
00093E 493E 7A               4      LD  A,D
00093F 493F B3               4      OR  E
000940 4940 20E9            12      JR  NZ,GET_PIXEL1
                                
000942 4942 2A3CF1          16      LD  HL,(_BUF_EN)
000945 4945 CD7649          17      CALL    ROM_READ
000948 4948 EB               4      EX  DE,HL
000949 4949 2A2FF1          16      LD  HL,(_DTA)
                                
       494C                     GET_PIXEL2:
00094C 494C 7E               7      LD  A,(HL)
00094D 494D 0F               4      RRCA
00094E 494E 0F               4      RRCA
00094F 494F 0F               4      RRCA
000950 4950 0F               4      RRCA
000951 4951 C9              10      RET
                                
       4952                     GET_PIXEL3:
000952 4952 7A               4      LD  A,D
000953 4953 B3               4      OR  E
000954 4954 200A            12      JR  NZ,GET_PIXEL5
                                
000956 4956 2A3CF1          16      LD  HL,(_BUF_EN)
000959 4959 CD7649          17      CALL    ROM_READ
00095C 495C EB               4      EX  DE,HL
00095D 495D 2A2FF1          16      LD  HL,(_DTA)
       4960                     GET_PIXEL5:
000960 4960 7E               7      LD  A,(HL)
000961 4961 0F               4      RRCA
000962 4962 0F               4      RRCA
000963 4963 0F               4      RRCA
000964 4964 0F               4      RRCA
000965 4965 0F               4      RRCA
000966 4966 0F               4      RRCA
000967 4967 C9              10      RET
                                
       4968                     GET_PIXEL4:
000968 4968 78               4      LD  A,B
000969 4969 E603             7      AND 3   ;+0
00096B 496B 28E5            12      JR  Z,GET_PIXEL3
00096D 496D 3D               4      DEC A   ;+1
00096E 496E 28DC            12      JR  Z,GET_PIXEL2
000970 4970 3D               4      DEC A   ;+2
000971 4971 7E               7      LD  A,(HL)
000972 4972 C0              11      RET NZ
000973 4973 0F               4      RRCA        ;+3
000974 4974 0F               4      RRCA
000975 4975 C9              10      RET
                                
       4976                     ROM_READ:
000976 4976 E5              11      PUSH    HL
000977 4977 D5              11      PUSH    DE
000978 4978 C5              11      PUSH    BC
000979 4979 FDE5            15      PUSH    IY
00097B 497B 224DF1          16      LD  (LEFTX),HL
00097E 497E 2A2FF1          16      LD  HL,(_DTA)
000981 4981 2247F1          16      LD  (DTAX),HL
000984 4984 2A4DF1          16      LD  HL,(LEFTX)
                                
000987 4987 CDBA4B          17      CALL    RBX1
00098A 498A 3870            12      JR  C,RBRERR1
00098C 498C 79               4      LD  A,C
00098D 498D EB               4      EX  DE,HL
00098E 498E ED52            15      SBC HL,DE       ;CP 0HL,CDE
000990 4990 19              11      ADD HL,DE
000991 4991 DE00             7      SBC A,000H
000993 4993 3801            12      JR  C,RBR1
000995 4995 EB               4      EX  DE,HL
       4996                     RBR1:
000996 4996 9F               4      SBC A,A
000997 4997 E601             7      AND 1
000999 4999 321FF1          13      LD  (_RESULT),A
00099C 499C 7C               4      LD  A,H
00099D 499D B5               4      OR  L
00099E 499E CAF249          10      JP  Z,RBREND0
                                
0009A1 49A1 222BF1          16      LD  (_LEFT),HL  ;Read record byte
0009A4 49A4 224DF1          16      LD  (LEFTX),HL
                                
0009A7 49A7 CDE04B          17      CALL    RBX2
0009AA 49AA 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009AC 49AC CDF34B          17      CALL    RBXA
0009AF 49AF DA084A          10      JP  C,RBRERR
0009B2 49B2 C5              11      PUSH    BC
0009B3 49B3 CD2C44          17      CALL    ROM_LDIR
0009B6 49B6 ED5347F1        20      LD  (DTAX),DE
0009BA 49BA 2A4DF1          16      LD  HL,(LEFTX)
0009BD 49BD D1              10      POP DE
0009BE 49BE A7               4      AND A
0009BF 49BF ED52            15      SBC HL,DE
0009C1 49C1 224DF1          16      LD  (LEFTX),HL
0009C4 49C4 2829            12      JR  Z,RBREND
                                
       49C6                     RBRB:
0009C6 49C6 CD2F4C          17      CALL    RBXB
0009C9 49C9 2818            12      JR  Z,RBRC
       49CB                     RBRB1:
0009CB 49CB C5              11      PUSH    BC
0009CC 49CC D5              11      PUSH    DE
0009CD 49CD CDD74C          17      CALL    CLUST
0009D0 49D0 EB               4      EX  DE,HL
0009D1 49D1 ED4B21F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
0009D5 49D5 CD2C44          17      CALL    ROM_LDIR
0009D8 49D8 EB               4      EX  DE,HL
0009D9 49D9 D1              10      POP DE
0009DA 49DA C1              10      POP BC
0009DB 49DB CDB44C          17      CALL    GNCL
0009DE 49DE DA084A          10      JP  C,RBRERR
0009E1 49E1 10E8            13      DJNZ    RBRB1
       49E3                     RBRC:
0009E3 49E3 CD474C          17      CALL    RBXC
0009E6 49E6 2807            12      JR  Z,RBREND
                                
0009E8 49E8 CDD74C          17      CALL    CLUST
0009EB 49EB EB               4      EX  DE,HL
0009EC 49EC CD2C44          17      CALL    ROM_LDIR
       49EF                     RBREND:
0009EF 49EF CD534C          17      CALL    RBXEND
       49F2                     RBREND0:
0009F2 49F2 FDE1            14      POP IY
0009F4 49F4 C1              10      POP BC
0009F5 49F5 D1              10      POP DE
0009F6 49F6 F1              10      POP AF  ;(HL)
0009F7 49F7 AF               4      XOR A
0009F8 49F8 3A1FF1          13      LD  A,(_RESULT)
0009FB 49FB C9              10      RET
                                
       49FC                     RBRERR1:
0009FC 49FC 3E01             7      LD  A,001H
       49FE                     RBRERR2:
0009FE 49FE FDE1            14      POP IY
000A00 4A00 C1              10      POP BC
000A01 4A01 D1              10      POP DE
000A02 4A02 E1              10      POP HL
000A03 4A03 37               4      SCF
000A04 4A04 210000          10      LD  HL,0
000A07 4A07 C9              10      RET
       4A08                     RBRERR:
000A08 4A08 3EFF             7      LD  A,0FFH
000A0A 4A0A 18F2            12      JR  RBRERR2
                                
       4A0C                     FILE_DD:
000A0C 4A0C 3E                      DB  03EH
000A0D 4A0D C9              10      RET
000A0E 4A0E 320CF1          13      LD  (SWC_BLOAD_M),A
       4A11                     ROM_ORG:
000A11 4A11 2A4FF1          16      LD  HL,(PARAM0)
000A14 4A14 7E               7      LD  A,(HL)
000A15 4A15 C9              10      RET
       4A16                     FILE_B:
000A16 4A16 AF               4      XOR A
000A17 4A17 3253F1          13      LD  (FDRV),A
000A1A 4A1A 1E00             7      LD  E,0
000A1C 4A1C 3A63F6          13      LD  A,(VALTYP)
000A1F 4A1F FE03             7      CP  3       ;string
000A21 4A21 2044            12      JR  NZ,FILED
                                
000A23 4A23 DD21D067        14      LD  IX,FRESTR
000A27 4A27 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A2B 4A2B CD1C00          17      CALL    _CALSLT
000A2E 4A2E E5              11      PUSH    HL
000A2F 4A2F DDE1            14      POP IX
                                
000A31 4A31 DD5E00          19      LD  E,(IX+0)
000A34 4A34 DD7E01          19      LD  A,(IX+1)
000A37 4A37 DD5602          19      LD  D,(IX+2)
000A3A 4A3A DD62             9      LD  IXH,D
000A3C 4A3C DD6F             9      LD  IXL,A
000A3E 4A3E 7B               4      LD  A,E
000A3F 4A3F FE04             7      CP  4
000A41 4A41 3808            12      JR  C,FILEB1
000A43 4A43 DD7E03          19      LD  A,(IX+3)
000A46 4A46 FE3A             7      CP  ':'
000A48 4A48 28C2            12      JR  Z,FILE_DD
000A4A 4A4A 7B               4      LD  A,E
       4A4B                     FILEB1:
000A4B 4A4B FE02             7      CP  2
000A4D 4A4D 3818            12      JR  C,FILED
000A4F 4A4F DD7E01          19      LD  A,(IX+1)
000A52 4A52 FE3A             7      CP  ':'
000A54 4A54 2011            12      JR  NZ,DEVI1
000A56 4A56 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A59 4A59 CD404B          17      CALL    CAP
000A5C 4A5C D640             7      SUB '@'
000A5E 4A5E DD23            10      INC IX
000A60 4A60 DD23            10      INC IX
000A62 4A62 1D               4      DEC E
000A63 4A63 1D               4      DEC E
000A64 4A64 3253F1          13      LD  (FDRV),A
       4A67                     DEVI1:
                                
       4A67                     FILED:
000A67 4A67 CDAE4A          17      CALL    FILEI
000A6A 4A6A 2154F1          10      LD  HL,FNAME
                                
000A6D 4A6D 0608             7      LD  B,8
       4A6F                     FILE2:
000A6F 4A6F CDBB4A          17      CALL    CCHKF
000A72 4A72 C8              11      RET Z
000A73 4A73 FE2A             7      CP  '*'
000A75 4A75 282E            12      JR  Z,FILE9
000A77 4A77 FE2E             7      CP  '.'
000A79 4A79 280C            12      JR  Z,FILE4
000A7B 4A7B 77               7      LD  (HL),A
000A7C 4A7C 23               6      INC HL
000A7D 4A7D 10F0            13      DJNZ    FILE2
                                
       4A7F                     FILE3:
000A7F 4A7F CDBB4A          17      CALL    CCHKF
000A82 4A82 C8              11      RET Z
000A83 4A83 FE2E             7      CP  '.'
000A85 4A85 20F8            12      JR  NZ,FILE3
                                
       4A87                     FILE4:
000A87 4A87 215CF1          10      LD  HL,FNAME+8
000A8A 4A8A 0603             7      LD  B,3
                                
       4A8C                     FILE4L:
000A8C 4A8C CDBB4A          17      CALL    CCHKF
000A8F 4A8F C8              11      RET Z
000A90 4A90 FE2E             7      CP  '.'
000A92 4A92 2008            12      JR  NZ,FILE12
000A94 4A94 3254F1          13      LD  (FNAME),A   ;Parent directory(..)
000A97 4A97 3255F1          13      LD  (FNAME+1),A
000A9A 4A9A 3E20             7      LD  A,020H
       4A9C                     FILE12:
000A9C 4A9C FE2A             7      CP  '*'
000A9E 4A9E 280A            12      JR  Z,FILE10
000AA0 4AA0 77               7      LD  (HL),A
000AA1 4AA1 23               6      INC HL
000AA2 4AA2 10E8            13      DJNZ    FILE4L
000AA4 4AA4 C9              10      RET
                                
       4AA5                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000AA5 4AA5 CDAA4A          17      CALL    FILE10
000AA8 4AA8 18D5            12      JR  FILE3
                                
       4AAA                     FILE10:
000AAA 4AAA 3E3F             7      LD  A,'?'
000AAC 4AAC 1808            12      JR  FILL_MEMORY
       4AAE                     FILEI:              ;名前＋拡張子をスペースで初期化
000AAE 4AAE 3E20             7      LD  A,020H
000AB0 4AB0 01000B          10      LD  BC,11*256   ;C=0にしておく
000AB3 4AB3 2154F1          10      LD  HL,FNAME
       4AB6                     FILL_MEMORY:            ;HLからBバイトAで埋める
000AB6 4AB6 77               7      LD  (HL),A
000AB7 4AB7 23               6      INC HL
000AB8 4AB8 10FC            13      DJNZ    FILL_MEMORY
000ABA 4ABA C9              10      RET
                                
       4ABB                     CCHKF:
000ABB 4ABB 7B               4      LD  A,E
000ABC 4ABC B7               4      OR  A
000ABD 4ABD C8              11      RET Z
000ABE 4ABE DD7E00          19      LD  A,(IX+0)
000AC1 4AC1 CDC84A          17      CALL    CCHK2
000AC4 4AC4 C8              11      RET Z
000AC5 4AC5 C32B4B          10      JP  FKAN
                                
       4AC8                     CCHK2:
000AC8 4AC8 0C               4      INC C
000AC9 4AC9 0D               4      DEC C
000ACA 4ACA C0              11      RET NZ
       4ACB                     CCHK3:              ;ZF=1 で使えない文字
000ACB 4ACB FE2B             7      CP  '+'
000ACD 4ACD C8              11      RET Z
000ACE 4ACE FE2C             7      CP  ','
000AD0 4AD0 C8              11      RET Z
000AD1 4AD1 FE2F             7      CP  '/'
000AD3 4AD3 C8              11      RET Z
000AD4 4AD4 FE3A             7      CP  ':'
000AD6 4AD6 C8              11      RET Z
000AD7 4AD7 FE3B             7      CP  ';'
000AD9 4AD9 C8              11      RET Z
000ADA 4ADA FE3D             7      CP  '='
000ADC 4ADC C8              11      RET Z
000ADD 4ADD FE5C             7      CP  05CH    ;\
000ADF 4ADF C8              11      RET Z
000AE0 4AE0 FE1F             7      CP  01FH
000AE2 4AE2 D0              11      RET NC
000AE3 4AE3 BF               4      CP  A       ;Z=1
000AE4 4AE4 C9              10      RET
                                
       4AE5                     SS1:
000AE5 4AE5 13               6      INC DE
       4AE6                     SPCUT:              ;スペースをカット
000AE6 4AE6 1A               7      LD  A,(DE)
000AE7 4AE7 FE20             7      CP  020H
000AE9 4AE9 28FA            12      JR  Z,SS1
000AEB 4AEB C9              10      RET
                                
       4AEC                     SCREOF1:
000AEC 4AEC 13               6      INC DE
       4AED                     SPCUTEX:            ;スペース改行などをカット
000AED 4AED 1A               7      LD  A,(DE)
000AEE 4AEE FE20             7      CP  020H
000AF0 4AF0 28FA            12      JR  Z,SCREOF1
000AF2 4AF2 FE0D             7      CP  00DH
000AF4 4AF4 28F6            12      JR  Z,SCREOF1
000AF6 4AF6 FE0A             7      CP  00AH
000AF8 4AF8 28F2            12      JR  Z,SCREOF1
000AFA 4AFA FE1A             7      CP  01AH
000AFC 4AFC 28EE            12      JR  Z,SCREOF1
000AFE 4AFE C9              10      RET
                                
       4AFF                     GETNUM:
000AFF 4AFF 210000          10      LD  HL,0
       4B02                     GETNUM1:
000B02 4B02 1A               7      LD  A,(DE)
000B03 4B03 13               6      INC DE
000B04 4B04 D630             7      SUB '0'
000B06 4B06 D8              11      RET C
000B07 4B07 FE0A             7      CP  10
000B09 4B09 D0              11      RET NC
000B0A 4B0A 4D               4      LD  C,L
000B0B 4B0B 44               4      LD  B,H
000B0C 4B0C 29              11      ADD HL,HL   ;*2
000B0D 4B0D 29              11      ADD HL,HL   ;*4
000B0E 4B0E 09              11      ADD HL,BC   ;*5
000B0F 4B0F 29              11      ADD HL,HL   ;*10
000B10 4B10 4F               4      LD  C,A
000B11 4B11 0600             7      LD  B,0
000B13 4B13 09              11      ADD HL,BC
000B14 4B14 18EC            12      JR  GETNUM1
                                
       4B16                     SEARCH_END:
000B16 4B16 7E               7      LD  A,(HL)
       4B17                     SEARCH_END1:
000B17 4B17 23               6      INC HL
000B18 4B18 B7               4      OR  A
000B19 4B19 C8              11      RET Z
000B1A 4B1A FE3A             7      CP  ':'
000B1C 4B1C 20F8            12      JR  NZ,SEARCH_END
000B1E 4B1E 7E               7      LD  A,(HL)
000B1F 4B1F FE3A             7      CP  ':'
000B21 4B21 28F4            12      JR  Z,SEARCH_END1
000B23 4B23 C9              10      RET
                                
       4B24                     FKANC:
000B24 4B24 CB41             8      BIT 0,C
000B26 4B26 CC494B          17      CALL    Z,CAP2
000B29 4B29 1803            12      JR  FKANX
       4B2B                     FKAN:           ;漢字チェック
000B2B 4B2B DD23            10      INC IX
000B2D 4B2D 1D               4      DEC E
       4B2E                     FKANX:
000B2E 4B2E CB41             8      BIT 0,C
000B30 4B30 CB81             8      RES 0,C
000B32 4B32 C0              11      RET NZ
000B33 4B33 FE80             7      CP  080H
000B35 4B35 D8              11      RET C
000B36 4B36 FEA0             7      CP  0A0H
000B38 4B38 3803            12      JR  C,FKAN1
000B3A 4B3A FEE0             7      CP  0E0H
000B3C 4B3C D8              11      RET C
       4B3D                     FKAN1:
000B3D 4B3D 0C               4      INC C
000B3E 4B3E A7               4      AND A
000B3F 4B3F C9              10      RET
                                
       4B40                     CAP:
000B40 4B40 FE61             7      CP  'a'
000B42 4B42 D8              11      RET C
000B43 4B43 FE7B             7      CP  'z'+1
000B45 4B45 D0              11      RET NC
000B46 4B46 D620             7      SUB 020H
000B48 4B48 C9              10      RET
       4B49                     CAP2:
000B49 4B49 CD404B          17      CALL    CAP
       4B4C                     CAP3:               ;
000B4C 4B4C FE05             7      CP  5
000B4E 4B4E 2803            12      JR  Z,CAP4
000B50 4B50 FE21             7      CP  021H
000B52 4B52 C9              10      RET
       4B53                     CAP4:
000B53 4B53 3EE5             7      LD  A,0E5H
000B55 4B55 C9              10      RET
                                
       4B56                     ROM_OPEN:
000B56 4B56 CD474F          17      CALL    GET_DISK_BANK_FDRV
                                
000B59 4B59 CD734D          17      CALL    GET_DIR_DAT
000B5C 4B5C D5              11      PUSH    DE
000B5D 4B5D CD724B          17      CALL    FILESE
000B60 4B60 D1              10      POP DE
000B61 4B61 3F               4      CCF
000B62 4B62 D8              11      RET C
000B63 4B63 224BF1          16      LD  (FCBX),HL
000B66 4B66 E5              11      PUSH    HL
000B67 4B67 210000          10      LD  HL,0
000B6A 4B6A 2225F1          16      LD  (RR_LOW),HL
000B6D 4B6D 2227F1          16      LD  (RR_HIGH),HL
000B70 4B70 E1              10      POP HL
000B71 4B71 C9              10      RET
                                
       4B72                     FILESE:
000B72 4B72 7E               7      LD  A,(HL)
000B73 4B73 B7               4      OR  A
000B74 4B74 C8              11      RET Z       ;END:ZF=1 CF=0
000B75 4B75 FEE5             7      CP  0E5H
000B77 4B77 280D            12      JR  Z,FILESE1
000B79 4B79 1154F1          10      LD  DE,FNAME
000B7C 4B7C E5              11      PUSH    HL
000B7D 4B7D CD944B          17      CALL    CPFILE
000B80 4B80 CCB54B          17      CALL    Z,CPFILE2
000B83 4B83 E1              10      POP HL
000B84 4B84 37               4      SCF
000B85 4B85 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4B86                     FILESE1:
000B86 4B86 CD8E4B          17      CALL    FNEXT
000B89 4B89 20E7            12      JR  NZ,FILESE
       4B8B                     ZF0_CF0_AFF_RET:
000B8B 4B8B F6FF             7      OR  0FFH        ;ZF=0 CF=0
000B8D 4B8D C9              10      RET
                                
       4B8E                     FNEXT:
000B8E 4B8E 112000          10      LD  DE,020H
000B91 4B91 19              11      ADD HL,DE
000B92 4B92 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000B93 4B93 C9              10      RET
                                
       4B94                     CPFILE:
000B94 4B94 C5              11      PUSH    BC
000B95 4B95 01000B          10      LD  BC,00B00H
       4B98                     CPSTR1:
000B98 4B98 1A               7      LD  A,(DE)
000B99 4B99 FE3F             7      CP  '?'     ;Wild card
000B9B 4B9B 2812            12      JR  Z,CPSTR2
000B9D 4B9D 7E               7      LD  A,(HL)
000B9E 4B9E CD244B          17      CALL    FKANC
000BA1 4BA1 E5              11      PUSH    HL
000BA2 4BA2 67               4      LD  H,A
000BA3 4BA3 1A               7      LD  A,(DE)
000BA4 4BA4 CB01             4      RLC C
000BA6 4BA6 CD244B          17      CALL    FKANC
000BA9 4BA9 CB09             4      RRC C
000BAB 4BAB BC               4      CP  H       ;CP (HL),(DE)
000BAC 4BAC E1              10      POP HL
000BAD 4BAD 2004            12      JR  NZ,CPSTR3
       4BAF                     CPSTR2:
000BAF 4BAF 13               6      INC DE
000BB0 4BB0 23               6      INC HL
000BB1 4BB1 10E5            13      DJNZ    CPSTR1
       4BB3                     CPSTR3:
000BB3 4BB3 C1              10      POP BC
000BB4 4BB4 C9              10      RET
                                
       4BB5                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
000BB5 4BB5 3EE1             7      LD  A,0E1H
000BB7 4BB7 2F               4      CPL
000BB8 4BB8 A6               7      AND (HL)
000BB9 4BB9 C9              10      RET
                                
       4BBA                     RBX1:
000BBA 4BBA E5              11      PUSH    HL      ;Record byte
                                
000BBB 4BBB ED5B25F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000BBF 4BBF 3A28F1          13      LD  A,(RR_HIGH+1)
000BC2 4BC2 4F               4      LD  C,A
                                
000BC3 4BC3 CD474F          17      CALL    GET_DISK_BANK_FDRV
                                
000BC6 4BC6 FD2A4BF1        20      LD  IY,(FCBX)
000BCA 4BCA FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000BCD 4BCD FD661D          19      LD  H,(IY+01DH)
000BD0 4BD0 FD7E1E          19      LD  A,(IY+01EH)
                                
000BD3 4BD3 A7               4      AND A
000BD4 4BD4 ED52            15      SBC HL,DE
000BD6 4BD6 99               4      SBC A,C
000BD7 4BD7 D1              10      POP DE
                                
000BD8 4BD8 D8              11      RET C
000BD9 4BD9 4F               4      LD  C,A
000BDA 4BDA EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000BDB 4BDB B2               4      OR  D
000BDC 4BDC B3               4      OR  E
000BDD 4BDD C0              11      RET NZ
000BDE 4BDE 37               4      SCF
000BDF 4BDF C9              10      RET
                                
       4BE0                     RBX2:
000BE0 4BE0 ED4B26F1        20      LD  BC,(RR_LOW+1)
000BE4 4BE4 CD684C          17      CALL    RWXR
000BE7 4BE7 3A22F1          13      LD  A,(CLSZ_H)
000BEA 4BEA 3D               4      DEC A
000BEB 4BEB E5              11      PUSH    HL
000BEC 4BEC 2A25F1          16      LD  HL,(RR_LOW)
000BEF 4BEF A4               4      AND H
000BF0 4BF0 B5               4      OR  L
000BF1 4BF1 E1              10      POP HL
000BF2 4BF2 C9              10      RET
                                
       4BF3                     RBXA:
000BF3 4BF3 D5              11      PUSH    DE
000BF4 4BF4 CDD74C          17      CALL    CLUST
000BF7 4BF7 ED532DF1        20      LD  (_DTPS),DE
000BFB 4BFB D1              10      POP DE
000BFC 4BFC CDB44C          17      CALL    GNCL
000BFF 4BFF D8              11      RET C
000C00 4C00 ED5329F1        20      LD  (_CLPS),DE
                                
000C04 4C04 ED4B25F1        20      LD  BC,(RR_LOW)
000C08 4C08 2A21F1          16      LD  HL,(CLSZ)
000C0B 4C0B 7C               4      LD  A,H
000C0C 4C0C 3D               4      DEC A
000C0D 4C0D A0               4      AND B
000C0E 4C0E 47               4      LD  B,A
000C0F 4C0F ED42            15      SBC HL,BC       ;remaining cluster
                                
000C11 4C11 ED5B4DF1        20      LD  DE,(LEFTX)
000C15 4C15 ED52            15      SBC HL,DE       ;CP HL,DE
000C17 4C17 19              11      ADD HL,DE
000C18 4C18 3801            12      JR  C,RBXA1
000C1A 4C1A EB               4      EX  DE,HL
       4C1B                     RBXA1:
000C1B 4C1B 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
000C1E 4C1E 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C21 4C21 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000C24 4C24 E5              11      PUSH    HL
000C25 4C25 2A2DF1          16      LD  HL,(_DTPS)
000C28 4C28 09              11      ADD HL,BC
000C29 4C29 ED5B47F1        20      LD  DE,(DTAX)
000C2D 4C2D C1              10      POP BC
000C2E 4C2E C9              10      RET
                                
       4C2F                     RBXB:
000C2F 4C2F 2A47F1          16      LD  HL,(DTAX)
000C32 4C32 ED5B29F1        20      LD  DE,(_CLPS)
000C36 4C36 3A4EF1          13      LD  A,(LEFTX+1)
000C39 4C39 47               4      LD  B,A
000C3A 4C3A 3A22F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C3D                     RBXB1:
000C3D 4C3D 1F               4      RRA     ;->CF
000C3E 4C3E 3804            12      JR  C,RBXB2
000C40 4C40 CB38             8      SRL B   ;B=B/2
000C42 4C42 18F9            12      JR  RBXB1
       4C44                     RBXB2:
000C44 4C44 78               4      LD  A,B
000C45 4C45 B7               4      OR  A
000C46 4C46 C9              10      RET
                                
       4C47                     RBXC:
000C47 4C47 ED4B4DF1        20      LD  BC,(LEFTX)
000C4B 4C4B 3A22F1          13      LD  A,(CLSZ_H)
000C4E 4C4E 3D               4      DEC A
000C4F 4C4F A0               4      AND B
000C50 4C50 47               4      LD  B,A
000C51 4C51 B1               4      OR  C
000C52 4C52 C9              10      RET
                                
       4C53                     RBXEND:
000C53 4C53 ED5B2BF1        20      LD  DE,(_LEFT)
000C57 4C57 2A25F1          16      LD  HL,(RR_LOW)
000C5A 4C5A 3A28F1          13      LD  A,(RR_HIGH+1)
000C5D 4C5D 19              11      ADD HL,DE
000C5E 4C5E CE00             7      ADC A,0
000C60 4C60 2225F1          16      LD  (RR_LOW),HL
000C63 4C63 3228F1          13      LD  (RR_HIGH+1),A
000C66 4C66 EB               4      EX  DE,HL       ;HL=Read byte
000C67 4C67 C9              10      RET 
                                
       4C68                     RWXR:
000C68 4C68 3A22F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4C6B                     L_RWX:
000C6B 4C6B 1F               4      RRA     ;->CF
000C6C 4C6C 3806            12      JR  C,E_RWX
000C6E 4C6E CB38             8      SRL B   ;BC=BC/2
000C70 4C70 CB19             8      RR  C   ;
000C72 4C72 18F7            12      JR  L_RWX
       4C74                     E_RWX:
000C74 4C74 CD474F          17      CALL    GET_DISK_BANK_FDRV
                                
000C77 4C77 FD2A4BF1        20      LD  IY,(FCBX)
000C7B 4C7B FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000C7E 4C7E FD561B          19      LD  D,(IY+01BH)
       4C81                     RWX1:
000C81 4C81 ED5329F1        20      LD  (_CLPS),DE
000C85 4C85 7A               4      LD  A,D
000C86 4C86 B3               4      OR  E
000C87 4C87 37               4      SCF
000C88 4C88 C8              11      RET Z
                                
000C89 4C89 78               4      LD  A,B
000C8A 4C8A B1               4      OR  C
000C8B 4C8B C8              11      RET Z
                                
000C8C 4C8C CDB44C          17      CALL    GNCL
000C8F 4C8F D8              11      RET C
000C90 4C90 0B               6      DEC BC
000C91 4C91 CD0C4D          17      CALL    ENDCL
000C94 4C94 38EB            12      JR  C,RWX1
000C96 4C96 37               4      SCF
000C97 4C97 C9              10      RET
                                
       4C98                     NCL3:
000C98 4C98 CD474F          17      CALL    GET_DISK_BANK_FDRV
000C9B 4C9B 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000C9E 4C9E 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000CA1 4CA1 6B               4      LD  L,E
000CA2 4CA2 62               4      LD  H,D
000CA3 4CA3 CB3C             8      SRL H
000CA5 4CA5 CB1D             8      RR  L
000CA7 4CA7 1F               4      RRA
000CA8 4CA8 19              11      ADD HL,DE
000CA9 4CA9 010060          10      LD  BC,BANK1_ADR
000CAC 4CAC 09              11      ADD HL,BC
000CAD 4CAD ED4B23F1        20      LD  BC,(SECSZ)
000CB1 4CB1 09              11      ADD HL,BC
000CB2 4CB2 17               4      RLA
000CB3 4CB3 C9              10      RET
                                
       4CB4                     GNCL:
000CB4 4CB4 7A               4      LD  A,D
000CB5 4CB5 B3               4      OR  E
000CB6 4CB6 37               4      SCF
000CB7 4CB7 C8              11      RET Z
000CB8 4CB8 C5              11      PUSH    BC
000CB9 4CB9 E5              11      PUSH    HL
000CBA 4CBA CD984C          17      CALL    NCL3
000CBD 4CBD 3809            12      JR  C,GNC1
000CBF 4CBF 5E               7      LD  E,(HL)
000CC0 4CC0 23               6      INC HL
000CC1 4CC1 7E               7      LD  A,(HL)
000CC2 4CC2 E60F             7      AND 00FH
000CC4 4CC4 57               4      LD  D,A
000CC5 4CC5 E1              10      POP HL
000CC6 4CC6 C1              10      POP BC
000CC7 4CC7 C9              10      RET
       4CC8                     GNC1:
000CC8 4CC8 7E               7      LD  A,(HL)
000CC9 4CC9 23               6      INC HL
000CCA 4CCA 56               7      LD  D,(HL)
000CCB 4CCB 0604             7      LD  B,4
       4CCD                     GNC1L:
000CCD 4CCD CB3A             8      SRL D
000CCF 4CCF 1F               4      RRA
000CD0 4CD0 10FB            13      DJNZ    GNC1L
                                
000CD2 4CD2 5F               4      LD  E,A
000CD3 4CD3 E1              10      POP HL
000CD4 4CD4 C1              10      POP BC
000CD5 4CD5 A7               4      AND A
000CD6 4CD6 C9              10      RET
                                
       4CD7                     CLUST:
000CD7 4CD7 EB               4      EX  DE,HL
000CD8 4CD8 C5              11      PUSH    BC
000CD9 4CD9 3A22F1          13      LD  A,(CLSZ_H)
000CDC 4CDC CD734F          17      CALL    MUL_AHL
                                
000CDF 4CDF CD804D          17      CALL    GET_DIR_POS
000CE2 4CE2 4F               4      LD  C,A
000CE3 4CE3 0600             7      LD  B,0
000CE5 4CE5 09              11      ADD HL,BC
                                
000CE6 4CE6 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000CE9 4CE9 0F               4      RRCA
000CEA 4CEA 0F               4      RRCA
000CEB 4CEB 0F               4      RRCA
000CEC 4CEC 0F               4      RRCA
000CED 4CED 4F               4      LD  C,A
                                
000CEE 4CEE 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000CF1 4CF1 FE02             7      CP  2
000CF3 4CF3 280C            12      JR  Z,CLUST1
000CF5 4CF5 CB01             4      RLC C
000CF7 4CF7 0D               4      DEC C
000CF8 4CF8 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000CFB 4CFB FE02             7      CP  2
000CFD 4CFD 2002            12      JR  NZ,CLUST1
000CFF 4CFF 0D               4      DEC C
000D00 4D00 0D               4      DEC C
       4D01                     CLUST1:
000D01 4D01 0D               4      DEC C
000D02 4D02 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000D03 4D03 7D               4      LD  A,L
                                #else
                                    PUSH    HL
                                    ADD HL,HL   ;*2
                                    ADD HL,HL   ;*4
                                    ADD HL,HL   ;*8
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    POP HL
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
000D04 4D04 C660             7      ADD A,high BANK1_ADR
000D06 4D06 67               4      LD  H,A
000D07 4D07 2E00             7      LD  L,0
000D09 4D09 EB               4      EX  DE,HL
000D0A 4D0A C1              10      POP BC
000D0B 4D0B C9              10      RET
                                
       4D0C                     ENDCL:
000D0C 4D0C 7A               4      LD  A,D ;END CLUSTER
000D0D 4D0D FE0F             7      CP  00FH    ;FAT12の最大値
000D0F 4D0F C0              11      RET NZ
000D10 4D10 7B               4      LD  A,E
000D11 4D11 FEF7             7      CP  0F7H
000D13 4D13 C9              10      RET
                                
       4D14                     RB_READ:
000D14 4D14 AF               4      XOR A   ;HLA = HL*128
000D15 4D15 CB3C             8      SRL H
000D17 4D17 CB1D             8      RR  L
000D19 4D19 1F               4      RRA
000D1A 4D1A 3225F1          13      LD  (RR_LOW),A
000D1D 4D1D 2226F1          16      LD  (RR_MID),HL
000D20 4D20 218000          10      LD  HL,128
                                
000D23 4D23 CD7649          17      CALL    ROM_READ
000D26 4D26 C9              10      RET
                                
       4D27                     GETSEQ:
000D27 4D27 FD6E20          19      LD  L,(IY+32)
000D2A 4D2A FD660C          19      LD  H,(IY+12)
                                
000D2D 4D2D CB25             8      SLA L
                                
000D2F 4D2F CB3C             8      SRL H
000D31 4D31 CB1D             8      RR  L
000D33 4D33 C9              10      RET
                                
       4D34                     SETSEQ:
000D34 4D34 F5              11      PUSH    AF
000D35 4D35 3A25F1          13      LD  A,(RR_LOW)
000D38 4D38 2A26F1          16      LD  HL,(RR_MID)
                                
000D3B 4D3B CD524D          17      CALL    SSQ1
                                
000D3E 4D3E 29              11      ADD HL,HL
000D3F 4D3F CB3D             8      SRL L
000D41 4D41 FD7520          19      LD  (IY+32),L
000D44 4D44 FD740C          19      LD  (IY+12),H
000D47 4D47 F1              10      POP AF
000D48 4D48 C9              10      RET
                                
       4D49                     GETSIZE:
000D49 4D49 FD7E10          19      LD  A,(IY+16)
000D4C 4D4C FD6E11          19      LD  L,(IY+17)
000D4F 4D4F FD6612          19      LD  H,(IY+18)
       4D52                     SSQ1:
000D52 4D52 87               4      ADD A,A
000D53 4D53 ED6A            15      ADC HL,HL
000D55 4D55 B7               4      OR  A
000D56 4D56 C8              11      RET Z
000D57 4D57 23               6      INC HL
000D58 4D58 C9              10      RET
                                
       4D59                     SET_FCB:
000D59 4D59 D5              11      PUSH    DE
000D5A 4D5A FDE1            14      POP IY
000D5C 4D5C FD7E1C          19      LD  A,(IY+28)
000D5F 4D5F FEFF             7      CP  0FFH
000D61 4D61 200C            12      JR  NZ,POPAF_SCF_FF_RET
000D63 4D63 E5              11      PUSH    HL
000D64 4D64 FD6E1A          19      LD  L,(IY+26)
000D67 4D67 FD661B          19      LD  H,(IY+27)
000D6A 4D6A 2229F1          16      LD  (_CLPS),HL
000D6D 4D6D E1              10      POP HL
000D6E 4D6E C9              10      RET
                                
       4D6F                     POPAF_SCF_FF_RET:
000D6F 4D6F F1              10      POP AF
000D70 4D70 37               4      SCF
000D71 4D71 9F               4      SBC A,A
000D72 4D72 C9              10      RET
                                
       4D73                     GET_DIR_DAT:
000D73 4D73 CD804D          17      CALL    GET_DIR_POS
000D76 4D76 C660             7      ADD A,high BANK1_ADR
000D78 4D78 2E00             7      LD  L,0
000D7A 4D7A 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000D7B 4D7B 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D7E 4D7E 4F               4      LD  C,A
000D7F 4D7F C9              10      RET
                                
       4D80                     GET_DIR_POS:
000D80 4D80 CD474F          17      CALL    GET_DISK_BANK_FDRV
000D83 4D83 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D86 4D86 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D89 4D89 3220F1          13      LD  (_BANK),A
000D8C 4D8C 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000D8F 4D8F 47               4      LD  B,A
000D90 4D90 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000D93 4D93 4F               4      LD  C,A
000D94 4D94 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4D97                     GET_DIR_POS1:
000D97 4D97 81               4      ADD A,C
000D98 4D98 10FD            13      DJNZ    GET_DIR_POS1
                                
000D9A 4D9A ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4D9E                     L_MDP:
000D9E 4D9E CB18             8      RR  B   ;->CF
000DA0 4DA0 D8              11      RET C
000DA1 4DA1 87               4      ADD A,A
000DA2 4DA2 18FA            12      JR  L_MDP
                                
       4DA4                     WILDCARD:
000DA4 4DA4 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4DAF                     ERROR_WRITE_PROTECTED:
000DAF 4DAF 3E00             7      LD  A,0     ;Write protected
000DB1 4DB1 C9              10      RET
       4DB2                     DISKIO:
000DB2 4DB2 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000DB4 4DB4 48               4      LD  C,B
000DB5 4DB5 CD514F          17      CALL    GET_DISK_BANK
       4DB8                     SETMAP1:        
000DB8 4DB8 E5              11      PUSH    HL
       4DB9                     DISKIO1:
000DB9 4DB9 C5              11      PUSH    BC      ;B=残りのセクタ数
000DBA 4DBA D5              11      PUSH    DE      ;DE=セクタ番号
000DBB 4DBB F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000DBC 4DBC EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000DBD 4DBD F5              11      PUSH    AF
000DBE 4DBE 3A24F1          13      LD  A,(SECSZ_H)
000DC1 4DC1 CD734F          17      CALL    MUL_AHL
000DC4 4DC4 F1              10      POP AF
000DC5 4DC5 4D               4      LD  C,L     ;C=読み出し元
000DC6 4DC6 29              11      ADD HL,HL       ;64KB→32KB
000DC7 4DC7 29              11      ADD HL,HL       ;32KB→16KB
000DC8 4DC8 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000DC9 4DC9 84               4      ADD A,H
000DCA 4DCA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000DCD 4DCD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000DD0 4DD0 3220F1          13      LD  (_BANK),A
000DD3 4DD3 79               4      LD  A,C     ;C=読み出し元
000DD4 4DD4 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
000DD6 4DD6 C660             7      ADD A,high BANK1_ADR
000DD8 4DD8 67               4      LD  H,A
000DD9 4DD9 ED4B23F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000DDD 4DDD 69               4      LD  L,C     ;C=0
000DDE 4DDE EDB0                    LDIR
000DE0 4DE0 EB               4      EX  DE,HL
000DE1 4DE1 F1              10      POP AF
000DE2 4DE2 D1              10      POP DE
000DE3 4DE3 13               6      INC DE
000DE4 4DE4 C1              10      POP BC
000DE5 4DE5 10D2            13      DJNZ    DISKIO1
000DE7 4DE7 41               4      LD  B,C
                                
000DE8 4DE8 E1              10      POP HL
000DE9 4DE9 AF               4      XOR A
000DEA 4DEA FB               4      EI
000DEB 4DEB C9              10      RET
                                
       4DEC                     DSKCHG:
000DEC 4DEC CD254E          17      CALL    IS_BPB
000DEF 4DEF 3824            12      JR  C,NOTREADY
000DF1 4DF1 3A23FB          13      LD  A,(DRVTBL+2)
000DF4 4DF4 B7               4      OR  A
000DF5 4DF5 201A            12      JR  NZ,DSKCHG1
000DF7 4DF7 3A21FB          13      LD  A,(DRVTBL)
000DFA 4DFA FE02             7      CP  2
000DFC 4DFC 2013            12      JR  NZ,DSKCHG1
000DFE 4DFE CD254E          17      CALL    IS_BPB
000E01 4E01 300E            12      JR  NC,DSKCHG1
000E03 4E03 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000E05 4E05 3221FB          13      LD  (DRVTBL),A
000E08 4E08 3223FB          13      LD  (DRVTBL+2),A
000E0B 4E0B 3A48F3          13      LD  A,(MASTERS)
000E0E 4E0E 3224FB          13      LD  (DRVTBL+3),A
       4E11                     DSKCHG1:
000E11 4E11 AF               4      XOR A
000E12 4E12 0601             7      LD  B,1
000E14 4E14 C9              10      RET
       4E15                     NOTREADY:
000E15 4E15 3E02             7      LD  A,2
000E17 4E17 37               4      SCF
000E18 4E18 C9              10      RET
                                
       4E19                     NO_BPB:
000E19 4E19 E1              10      POP HL
000E1A 4E1A 23               6      INC HL
000E1B 4E1B 11784F          10      LD  DE,DPB2DD
000E1E 4E1E 011200          10      LD  BC,DPB2DD_E-DPB2DD
000E21 4E21 EDB0                    LDIR
000E23 4E23 AF               4      XOR A
000E24 4E24 C9              10      RET
                                
       4E25                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000E25 4E25 CD514F          17      CALL    GET_DISK_BANK
                                
000E28 4E28 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000E2B 4E2B FE01             7      CP  1
000E2D 4E2D D8              11      RET C
                                
000E2E 4E2E 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000E31 4E31 C6FF             7      ADD A,0FFH
000E33 4E33 D8              11      RET C
                                
000E34 4E34 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000E37 4E37 FE01             7      CP  1
000E39 4E39 C8              11      RET Z
000E3A 4E3A FE02             7      CP  2
000E3C 4E3C C8              11      RET Z
000E3D 4E3D FE04             7      CP  4
000E3F 4E3F C8              11      RET Z
000E40 4E40 37               4      SCF
000E41 4E41 C9              10      RET
                                
       4E42                     GETDPB:
000E42 4E42 E5              11      PUSH    HL
000E43 4E43 CD514F          17      CALL    GET_DISK_BANK
                                
000E46 4E46 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000E49 4E49 B7               4      OR  A
000E4A 4E4A 28CD            12      JR  Z,NO_BPB
000E4C 4E4C DDE1            14      POP IX
000E4E 4E4E DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000E51 4E51 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000E54 4E54 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000E57 4E57 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000E5A 4E5A DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000E5D 4E5D 87               4      ADD A,A
000E5E 4E5E 87               4      ADD A,A
000E5F 4E5F 87               4      ADD A,A
000E60 4E60 3D               4      DEC A
000E61 4E61 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000E64 4E64 06FF             7      LD  B,-1
000E66 4E66 A7               4      AND A           ;無限ループ阻止
       4E67                     GETDPB1:
000E67 4E67 04               4      INC B
000E68 4E68 1F               4      RRA
000E69 4E69 38FC            12      JR  C,GETDPB1
000E6B 4E6B DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000E6E 4E6E 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000E71 4E71 3D               4      DEC A
000E72 4E72 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000E75 4E75 A7               4      AND A           ;無限ループ阻止
000E76 4E76 06FF             7      LD  B,-1
       4E78                     GETDPB2:
000E78 4E78 04               4      INC B
000E79 4E79 1F               4      RRA
000E7A 4E7A 38FC            12      JR  C,GETDPB2
000E7C 4E7C 04               4      INC B
000E7D 4E7D DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000E80 4E80 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000E83 4E83 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000E86 4E86 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000E89 4E89 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000E8C 4E8C DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000E8F 4E8F 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000E92 4E92 DD770B          19      LD  (IX+11),A       ;FATCNT
                                
000E95 4E95 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000E99 4E99 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000E9C 4E9C DD460A          19      LD  B,(IX+10)       ;FATCNT
000E9F 4E9F 210000          10      LD  HL,0
       4EA2                     GETDPB3:
000EA2 4EA2 19              11      ADD HL,DE
000EA3 4EA3 10FD            13      DJNZ    GETDPB3
       4EA5                     GETDPB4:
000EA5 4EA5 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000EA8 4EA8 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000EAB 4EAB 19              11      ADD HL,DE
000EAC 4EAC DD7511          19      LD  (IX+17),L       ;FIRDIR
000EAF 4EAF DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000EB2 4EB2 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000EB5 4EB5 87               4      ADD A,A
000EB6 4EB6 87               4      ADD A,A
000EB7 4EB7 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4EBA                     GETDPB5:
000EBA 4EBA CB3B             8      SRL E
000EBC 4EBC 1F               4      RRA
000EBD 4EBD 30FB            12      JR  NC,GETDPB5
000EBF 4EBF 1600             7      LD  D,0
000EC1 4EC1 19              11      ADD HL,DE
000EC2 4EC2 DD750C          19      LD  (IX+12),L       ;FIRREC
000EC5 4EC5 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000EC8 4EC8 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000ECB 4ECB DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000ECE 4ECE DD560D          19      LD  D,(IX+13)       ;FIRREC
000ED1 4ED1 A7               4      AND A
000ED2 4ED2 ED52            15      SBC HL,DE
                                
000ED4 4ED4 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000ED7 4ED7 3C               4      INC A
000ED8 4ED8 37               4      SCF             ;無限ループ阻止
       4ED9                     GETDPB6:
000ED9 4ED9 1F               4      RRA
000EDA 4EDA 3806            12      JR  C,GETDPB7
000EDC 4EDC CB3C             8      SRL H
000EDE 4EDE CB1D             8      RR  L
000EE0 4EE0 18F7            12      JR  GETDPB6
       4EE2                     GETDPB7:
000EE2 4EE2 23               6      INC HL
000EE3 4EE3 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000EE6 4EE6 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4EE9                     GETDPBD1:
000EE9 4EE9 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000EEC 4EEC E6FC             7      AND 0FCH
000EEE 4EEE C8              11      RET Z
                                
000EEF 4EEF DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000EF3 4EF3 37               4      SCF
000EF4 4EF4 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000EF8 4EF8 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000EFB 4EFB DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000EFF 4EFF DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000F03 4F03 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000F07 4F07 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000F0B 4F0B DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000F0F 4F0F DDCB1126        23      SLA (IX+17)         ;FIRDIR
000F13 4F13 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000F17 4F17 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000F1A 4F1A DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000F1D 4F1D DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000F20 4F20 87               4      ADD A,A
000F21 4F21 87               4      ADD A,A
000F22 4F22 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4F25                     GETDPBD5:
000F25 4F25 CB3B             8      SRL E
000F27 4F27 1F               4      RRA
000F28 4F28 30FB            12      JR  NC,GETDPBD5
000F2A 4F2A 1600             7      LD  D,0
000F2C 4F2C 19              11      ADD HL,DE
000F2D 4F2D DD750C          19      LD  (IX+12),L       ;FIRREC
000F30 4F30 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000F33 4F33 18B4            12      JR  GETDPBD1
                                
       4F35                     CHOICE:
000F35 4F35 210000          10      LD  HL,0
000F38 4F38 C9              10      RET
                                
       4F39                     DSKFMT:
000F39 4F39 AF               4      XOR A
000F3A 4F3A 37               4      SCF
       4F3B                     DSKSTP:
000F3B 4F3B C9              10      RET
                                
       4F3C                     BASENT:
000F3C 4F3C ED7B5FF1        20      LD  SP,(BASSTK)
000F40 4F40 C3C043          10      JP  BASAUTO
                                
       4F43                     GETSLT:
000F43 4F43 3A22FB          13      LD  A,(DRVTBL+1)
000F46 4F46 C9              10      RET
                                
       4F47                     GET_DISK_BANK_FDRV:
000F47 4F47 3A53F1          13      LD  A,(FDRV)
000F4A 4F4A D601             7      SUB 1
000F4C 4F4C 3003            12      JR  NC,GET_DISK_BANK
000F4E 4F4E 3A4AF1          13      LD  A,(_DVSW)
       4F51                     GET_DISK_BANK:
000F51 4F51 B7               4      OR  A       ;A=DRIVE
000F52 4F52 3E01             7      LD  A,DISK_BANK
000F54 4F54 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
000F56 4F56 3A49F1          13      LD  A,(B_DRIVE)
                                #endif
       4F59                     SET_DISK_BANK:
000F59 4F59 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000F5C 4F5C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000F5F 4F5F F5              11      PUSH    AF
000F60 4F60 E5              11      PUSH    HL
000F61 4F61 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
000F64 4F64 2223F1          16      LD  (SECSZ),HL
000F67 4F67 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F6A 4F6A CD734F          17      CALL    MUL_AHL
000F6D 4F6D 2221F1          16      LD  (CLSZ),HL
000F70 4F70 E1              10      POP HL
000F71 4F71 F1              10      POP AF
000F72 4F72 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)
       4F73                     MUL_AHL:
000F73 4F73 1F               4      RRA     ;->CF
000F74 4F74 D8              11      RET C
000F75 4F75 29              11      ADD HL,HL
000F76 4F76 18FB            12      JR  MUL_AHL
                                
       4F78                     DPB2DD:
000F78 4F78 F9                      DB  0F9H    ;MEDIA
000F79 4F79 0002                    DW  00200H  ;SECSIZ
000F7B 4F7B 0F                      DB  00FH    ;DIRMSK
000F7C 4F7C 04                      DB  004H    ;DIRSHFT
000F7D 4F7D 01                      DB  001H    ;CLUSMSK
000F7E 4F7E 02                      DB  002H    ;CLUSSHFT
000F7F 4F7F 0100                    DW  00001H  ;FIRFAT
000F81 4F81 02                      DB  002H    ;FATCNT
000F82 4F82 70                      DB  070H    ;MAXENT
000F83 4F83 0E00                    DW  0000EH  ;FIRREC
000F85 4F85 CA02                    DW  002CAH  ;MAXCLUS
000F87 4F87 03                      DB  003H    ;FATSIZ
000F88 4F88 0700                    DW  0007H   ;FIRDIR
       4F8A                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4F8A                     POP_HL_ERROR:
000F8A 4F8A E1              10      POP     HL
       4F8B                     _ERROR:
000F8B 4F8B 0600             7      LD  B,0
000F8D 4F8D A7               4      AND A
000F8E 4F8E C9              10      RET
                                
       4F8F                     ROM_BDOS:
000F8F 4F8F E5              11      PUSH    HL
000F90 4F90 79               4      LD  A,C
000F91 4F91 87               4      ADD A,A
000F92 4F92 38F7            12      JR  C,_ERROR
000F94 4F94 6F               4      LD  L,A
000F95 4F95 265F             7      LD  H,high STABLE
000F97 4F97 7E               7      LD  A,(HL)
000F98 4F98 2C               4      INC L
000F99 4F99 66               7      LD  H,(HL)
000F9A 4F9A 6F               4      LD  L,A
000F9B 4F9B E3              19      EX  (SP),HL
000F9C 4F9C 79               4      LD  A,C
000F9D 4F9D C9              10      RET
                                
       4F9E                     _PRINT:
       4F9E                     PRINT:
000F9E 4F9E 7B               4      LD  A,E
000F9F 4F9F 1803            12      JR  MSG_A
                                
       4FA1                     _SYS01:     ;(BDOS)コンソール入力
000FA1 4FA1 CD1850          17      CALL    _SYS07
       4FA4                     MSG_A:
000FA4 4FA4 FE03             7      CP  3
000FA6 4FA6 2814            12      JR  Z,MSG_BR
       4FA8                     MSGA1:
000FA8 4FA8 F5              11      PUSH    AF
000FA9 4FA9 C5              11      PUSH    BC
000FAA 4FAA D5              11      PUSH    DE
000FAB 4FAB E5              11      PUSH    HL
000FAC 4FAC DDE5            15      PUSH    IX
000FAE 4FAE DD21A200        14      LD  IX,CHPUT
000FB2 4FB2 CDE742          17      CALL    CALSLT_R
000FB5 4FB5 DDE1            14      POP IX
000FB7 4FB7 E1              10      POP HL
000FB8 4FB8 D1              10      POP DE
000FB9 4FB9 C1              10      POP BC
       4FBA                     MSGA2:
000FBA 4FBA F1              10      POP AF
000FBB 4FBB C9              10      RET
       4FBC                     MSG_BR:
000FBC 4FBC F5              11      PUSH    AF
000FBD 4FBD 3ADDF3          13      LD  A,(CSRX)
000FC0 4FC0 FE02             7      CP  2
000FC2 4FC2 38F6            12      JR  C,MSGA2
000FC4 4FC4 F1              10      POP AF
       4FC5                     MSG_CR:
000FC5 4FC5 F5              11      PUSH    AF
000FC6 4FC6 3E0D             7      LD  A,00DH
000FC8 4FC8 CDA84F          17      CALL    MSGA1
000FCB 4FCB 3E0A             7      LD  A,00AH
000FCD 4FCD CDA84F          17      CALL    MSGA1
000FD0 4FD0 F1              10      POP AF
000FD1 4FD1 C9              10      RET
                                
       4FD2                     _SYS02:     ;(BDOS)コンソール出力
000FD2 4FD2 CDED4F          17      CALL    BREAK
000FD5 4FD5 1805            12      JR  PRINTX
                                
       4FD7                     _SYS06:     ;(BDOS)コンソール直接入出力
000FD7 4FD7 7B               4      LD  A,E
000FD8 4FD8 3C               4      INC A
000FD9 4FD9 CA2C50          10      JP  Z,_INKEY
       4FDC                     PRINTX:
000FDC 4FDC C39E4F          10      JP  _PRINT
                                
       4FDF                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000FDF 4FDF CD1850          17      CALL    _SYS07
000FE2 4FE2 FE03             7      CP  3
000FE4 4FE4 CCED4F          17      CALL    Z,_BREAK
000FE7 4FE7 FE13             7      CP  013H        ;CTRL+S
000FE9 4FE9 C0              11      RET NZ
       4FEA                     PAUSE:
000FEA 4FEA CD0450          17      CALL    KEYBC
                                
       4FED                     _BREAK:
       4FED                     BREAK:
000FED 4FED F5              11      PUSH    AF
000FEE 4FEE C5              11      PUSH    BC
000FEF 4FEF D5              11      PUSH    DE
000FF0 4FF0 E5              11      PUSH    HL
000FF1 4FF1 DDE5            15      PUSH    IX
000FF3 4FF3 DD21B700        14      LD  IX,BREAKX
000FF7 4FF7 CDE742          17      CALL    CALSLT_R
000FFA 4FFA DDE1            14      POP IX
000FFC 4FFC E1              10      POP HL
000FFD 4FFD D1              10      POP DE
000FFE 4FFE C1              10      POP BC
000FFF 4FFF DCED4F          17      CALL    C,_BREAK
001002 5002 F1              10      POP AF
001003 5003 C9              10      RET
       5004                     KEYBC:
001004 5004 F5              11      PUSH    AF
001005 5005 C5              11      PUSH    BC
001006 5006 D5              11      PUSH    DE
001007 5007 E5              11      PUSH    HL
001008 5008 DDE5            15      PUSH    IX
00100A 500A DD215601        14      LD  IX,KILBUF
00100E 500E CDE742          17      CALL    CALSLT_R
001011 5011 DDE1            14      POP IX
001013 5013 E1              10      POP HL
001014 5014 D1              10      POP DE
001015 5015 C1              10      POP BC
001016 5016 F1              10      POP AF
001017 5017 C9              10      RET
                                
       5018                     _SYS07:
       5018                     FLGET:
001018 5018 C5              11      PUSH    BC
001019 5019 D5              11      PUSH    DE
00101A 501A E5              11      PUSH    HL
00101B 501B DDE5            15      PUSH    IX
00101D 501D DD219F00        14      LD  IX,CHGET
001021 5021 CDE742          17      CALL    CALSLT_R
001024 5024 DDE1            14      POP IX
001026 5026 E1              10      POP HL
001027 5027 D1              10      POP DE
001028 5028 C1              10      POP BC
001029 5029 FE03             7      CP  3
00102B 502B C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       502C                     _INKEY:
       502C                     INKEY:
00102C 502C CDC650          17      CALL    CPM_CONST
00102F 502F C8              11      RET Z
001030 5030 18E6            12      JR  FLGET
                                
       5032                     _SYS0A:     ;(BDOS)文字列入力
001032 5032 C5              11      PUSH    BC
001033 5033 E5              11      PUSH    HL
001034 5034 D5              11      PUSH    DE
001035 5035 CD5E50          17      CALL    GETL
001038 5038 111FF4          10      LD  DE,KBUF
00103B 503B E1              10      POP HL
00103C 503C E5              11      PUSH    HL
00103D 503D 0E00             7      LD  C,0
00103F 503F 3004            12      JR  NC,SAX0
001041 5041 23               6      INC HL
001042 5042 23               6      INC HL
001043 5043 1808            12      JR  SAX4
       5045                     SAX0:
001045 5045 46               7      LD  B,(HL)
001046 5046 23               6      INC HL
       5047                     SAX1:
001047 5047 23               6      INC HL
001048 5048 1A               7      LD  A,(DE)
001049 5049 13               6      INC DE
00104A 504A B7               4      OR  A
00104B 504B 2004            12      JR  NZ,SAX2
       504D                     SAX4:
00104D 504D 360D            10      LD  (HL),00DH
00104F 504F 1804            12      JR  SAX3
       5051                     SAX2:
001051 5051 77               7      LD  (HL),A
001052 5052 0C               4      INC C
001053 5053 10F2            13      DJNZ    SAX1
       5055                     SAX3:
001055 5055 D1              10      POP DE
001056 5056 79               4      LD  A,C
001057 5057 13               6      INC DE
001058 5058 12               7      LD  (DE),A
001059 5059 1B               6      DEC DE
00105A 505A E1              10      POP HL
00105B 505B C1              10      POP BC
00105C 505C A7               4      AND A
00105D 505D C9              10      RET
       505E                     GETL:
00105E 505E DDE5            15      PUSH    IX
001060 5060 FDE5            15      PUSH    IY
                                
001062 5062 2ADCF3          16      LD  HL,(CSRY)
001065 5065 22CAFB          16      LD  (FSTPOS),HL
       5068                     GETL1:
001068 5068 CDDF4F          17      CALL    _SYS08
00106B 506B FE09             7      CP  9
00106D 506D 2008            12      JR  NZ,GETL1V
00106F 506F 211FF4          10      LD  HL,KBUF
001072 5072 CD7243          17      CALL    MSX
001075 5075 18F1            12      JR  GETL1
       5077                     GETL1V:
001077 5077 5F               4      LD  E,A
001078 5078 FE08             7      CP  8
00107A 507A CC1451          17      CALL    Z,CTRL02
00107D 507D FE20             7      CP  020H
00107F 507F D44051          17      CALL    NC,INSERT
001082 5082 CDA84F          17      CALL    MSGA1
                                
001085 5085 7B               4      LD  A,E
001086 5086 FE0D             7      CP  00DH
001088 5088 20DE            12      JR  NZ,GETL1
                                
00108A 508A 111FF4          10      LD  DE,KBUF
00108D 508D 3AB0F3          13      LD  A,(LINLEN)
001090 5090 47               4      LD  B,A
001091 5091 CDF352          17      CALL    ZERO_MEMORY_DE
                                
001094 5094 2ACAFB          16      LD  HL,(FSTPOS)
001097 5097 3ADCF3          13      LD  A,(CSRY)
00109A 509A 6F               4      LD  L,A
00109B 509B E5              11      PUSH    HL
00109C 509C CD7151          17      CALL    LOC0
00109F 509F 4D               4      LD  C,L
0010A0 50A0 44               4      LD  B,H
0010A1 50A1 E1              10      POP HL
0010A2 50A2 3AB0F3          13      LD  A,(LINLEN)
0010A5 50A5 94               4      SUB H
0010A6 50A6 3D               4      DEC A
0010A7 50A7 5F               4      LD  E,A
0010A8 50A8 211FF4          10      LD  HL,KBUF
       50AB                     GETL2:
0010AB 50AB CD0451          17      CALL    _SCRN
0010AE 50AE 03               6      INC BC
0010AF 50AF 77               7      LD  (HL),A
0010B0 50B0 23               6      INC HL
0010B1 50B1 1D               4      DEC E
0010B2 50B2 20F7            12      JR  NZ,GETL2
0010B4 50B4 CDC54F          17      CALL    MSG_CR
                                
0010B7 50B7 FDE1            14      POP IY
0010B9 50B9 DDE1            14      POP IX
       50BB                     GETL3:
0010BB 50BB 2B               6      DEC HL
0010BC 50BC 7E               7      LD  A,(HL)
0010BD 50BD FE21             7      CP  021H
0010BF 50BF D0              11      RET NC
0010C0 50C0 3600            10      LD  (HL),0
0010C2 50C2 15               4      DEC D
0010C3 50C3 20F6            12      JR  NZ,GETL3
0010C5 50C5 C9              10      RET
                                
       50C6                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       50C6                     CONSTX:
       50C6                     CPM_CONST:
0010C6 50C6 C5              11      PUSH    BC
0010C7 50C7 D5              11      PUSH    DE
0010C8 50C8 E5              11      PUSH    HL
0010C9 50C9 DDE5            15      PUSH    IX
0010CB 50CB DD219C00        14      LD  IX,CHSNS
0010CF 50CF CDE742          17      CALL    CALSLT_R
0010D2 50D2 DDE1            14      POP IX
0010D4 50D4 E1              10      POP HL
0010D5 50D5 D1              10      POP DE
0010D6 50D6 C1              10      POP BC
0010D7 50D7 C9              10      RET
                                
       50D8                     _SYS2A:     ;(BDOS)日付の獲得
0010D8 50D8 AF               4      XOR A
0010D9 50D9 57               4      LD  D,A
0010DA 50DA 5F               4      LD  E,A
0010DB 50DB 67               4      LD  H,A
0010DC 50DC 6F               4      LD  L,A
0010DD 50DD C9              10      RET
                                
       50DE                     _SYS2C:     ;(BDOS)時刻の獲得
0010DE 50DE AF               4      XOR A
0010DF 50DF 57               4      LD  D,A
0010E0 50E0 5F               4      LD  E,A
0010E1 50E1 67               4      LD  H,A
0010E2 50E2 6F               4      LD  L,A
0010E3 50E3 C9              10      RET
                                
       50E4                     POS:
0010E4 50E4 F5              11      PUSH    AF
0010E5 50E5 2ADCF3          16      LD  HL,(CSRY)
0010E8 50E8 7D               4      LD  A,L
0010E9 50E9 6C               4      LD  L,H
0010EA 50EA 67               4      LD  H,A
0010EB 50EB 2C               4      INC L
0010EC 50EC 24               4      INC H
0010ED 50ED F1              10      POP AF
0010EE 50EE C9              10      RET
                                
       50EF                     LOC:
0010EF 50EF F5              11      PUSH    AF
0010F0 50F0 E5              11      PUSH    HL
0010F1 50F1 7D               4      LD  A,L
0010F2 50F2 6C               4      LD  L,H
0010F3 50F3 67               4      LD  H,A
0010F4 50F4 2D               4      DEC L
0010F5 50F5 25               4      DEC H
0010F6 50F6 DDE5            15      PUSH    IX
0010F8 50F8 DD21C600        14      LD  IX,POSIT
0010FC 50FC CDE742          17      CALL    CALSLT_R
0010FF 50FF DDE1            14      POP IX
001101 5101 E1              10      POP HL
001102 5102 F1              10      POP AF
001103 5103 C9              10      RET
                                
       5104                     _SCRN:
       5104                     SCRN:
001104 5104 E5              11      PUSH    HL
001105 5105 DDE5            15      PUSH    IX
                                
001107 5107 69               4      LD  L,C
001108 5108 60               4      LD  H,B
001109 5109 DD214A00        14      LD  IX,RDVRM
00110D 510D CDE742          17      CALL    CALSLT_R
                                
001110 5110 DDE1            14      POP IX
001112 5112 E1              10      POP HL
001113 5113 C9              10      RET
                                
       5114                     CTRL02:
001114 5114 F5              11      PUSH    AF
001115 5115 D5              11      PUSH    DE
001116 5116 2ADCF3          16      LD  HL,(CSRY)
001119 5119 3AB0F3          13      LD  A,(LINLEN)
00111C 511C 4F               4      LD  C,A
00111D 511D 94               4      SUB H   ;CSRX
00111E 511E C602             7      ADD A,2
001120 5120 47               4      LD  B,A ;カーソルより右の文字数
001121 5121 61               4      LD  H,C ;LINLEN
001122 5122 C5              11      PUSH    BC
001123 5123 CD7151          17      CALL    LOC0
001126 5126 C1              10      POP BC
                                
001127 5127 1620             7      LD  D,020H
       5129                     C8X1:
001129 5129 DD214A00        14      LD  IX,RDVRM
00112D 512D CDE742          17      CALL    CALSLT_R
001130 5130 4F               4      LD  C,A
001131 5131 7A               4      LD  A,D
001132 5132 DD214D00        14      LD  IX,WRTVRM
001136 5136 CDE742          17      CALL    CALSLT_R
001139 5139 2B               6      DEC HL
00113A 513A 51               4      LD  D,C
00113B 513B 10EC            13      DJNZ    C8X1
00113D 513D D1              10      POP DE
00113E 513E F1              10      POP AF
00113F 513F C9              10      RET
                                
       5140                     INSERT:
001140 5140 F5              11      PUSH    AF
001141 5141 D5              11      PUSH    DE
001142 5142 2ADCF3          16      LD  HL,(CSRY)
001145 5145 3AB0F3          13      LD  A,(LINLEN)
001148 5148 4F               4      LD  C,A
001149 5149 94               4      SUB H   ;CSRX
00114A 514A 3C               4      INC A
00114B 514B 47               4      LD  B,A ;カーソルより右の文字数
00114C 514C C5              11      PUSH    BC
00114D 514D CD7151          17      CALL    LOC0
001150 5150 C1              10      POP BC
                                
001151 5151 1620             7      LD  D,020H
       5153                     INS1:
001153 5153 DD214A00        14      LD  IX,RDVRM
001157 5157 CDE742          17      CALL    CALSLT_R
00115A 515A 4F               4      LD  C,A
00115B 515B 7A               4      LD  A,D
00115C 515C DD214D00        14      LD  IX,WRTVRM
001160 5160 CDE742          17      CALL    CALSLT_R
001163 5163 23               6      INC HL
001164 5164 51               4      LD  D,C
001165 5165 10EC            13      DJNZ    INS1
001167 5167 D1              10      POP DE
001168 5168 F1              10      POP AF
001169 5169 C9              10      RET
                                
       516A                     CONOUT1:
00116A 516A 59               4      LD  E,C
00116B 516B C39E4F          10      JP  _PRINT
                                
       516E                     GETVRAM:
00116E 516E 2ADCF3          16      LD  HL,(CSRY)
       5171                     LOC0:
001171 5171 2D               4      DEC L
001172 5172 25               4      DEC H
001173 5173 4C               4      LD  C,H ;CSRX-1
001174 5174 5D               4      LD  E,L ;CSRY-1
       5175                     LOC1:
001175 5175 3AB0F3          13      LD  A,(LINLEN)
001178 5178 67               4      LD  H,A
001179 5179 1600             7      LD  D,0
00117B 517B 6A               4      LD  L,D ;0
00117C 517C 0608             7      LD  B,8
       517E                     LOC2:
00117E 517E 29              11      ADD HL,HL
00117F 517F 3001            12      JR  NC,LOC3
001181 5181 19              11      ADD HL,DE
       5182                     LOC3:
001182 5182 10FA            13      DJNZ    LOC2
001184 5184 09              11      ADD HL,BC
001185 5185 C9              10      RET
                                
       5186                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001186 5186 212200          10      LD  HL,00022H
001189 5189 AF               4      XOR A
00118A 518A 7D               4      LD  A,L
00118B 518B C9              10      RET
                                
       518C                     _SYS0D:     ;(BDOS)ディスク・リセット
00118C 518C 218000          10      LD  HL,00080H
00118F 518F 222FF1          16      LD  (_DTA),HL
001192 5192 C9              10      RET
                                
       5193                     _SYS0E:     ;(BDOS)カレントドライブの設定
001193 5193 324AF1          13      LD  (_DVSW),A
001196 5196 C9              10      RET
                                
       5197                     _SYS0F:     ;(BDOS)ファイルのオープン
001197 5197 D5              11      PUSH    DE
001198 5198 FDE1            14      POP IY
00119A 519A CDE052          17      CALL    INIT_FILE
00119D 519D CD564B          17      CALL    ROM_OPEN
0011A0 51A0 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0011A2 51A2 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0011A6 51A6 FDE5            15      PUSH    IY
0011A8 51A8 D1              10      POP DE
0011A9 51A9 13               6      INC DE
0011AA 51AA 010B00          10      LD  BC,11
0011AD 51AD EDB0                    LDIR
                                ;               Attribute
0011AF 51AF 7E               7      LD  A,(HL)
0011B0 51B0 FD770D          19      LD  (IY+13),A
                                ;               TIME
0011B3 51B3 110B00          10      LD  DE,11
0011B6 51B6 19              11      ADD HL,DE
0011B7 51B7 7E               7      LD  A,(HL)
0011B8 51B8 23               6      INC HL
0011B9 51B9 FD7716          19      LD  (IY+22),A
0011BC 51BC 7E               7      LD  A,(HL)
0011BD 51BD 23               6      INC HL
0011BE 51BE FD7717          19      LD  (IY+23),A
                                ;               DATE
0011C1 51C1 7E               7      LD  A,(HL)
0011C2 51C2 23               6      INC HL
0011C3 51C3 FD7714          19      LD  (IY+20),A
0011C6 51C6 7E               7      LD  A,(HL)
0011C7 51C7 23               6      INC HL
0011C8 51C8 FD7715          19      LD  (IY+21),A
                                ;               First cluster
0011CB 51CB 7E               7      LD  A,(HL)
0011CC 51CC 23               6      INC HL
0011CD 51CD FD771A          19      LD  (IY+26),A
0011D0 51D0 7E               7      LD  A,(HL)
0011D1 51D1 23               6      INC HL
0011D2 51D2 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0011D5 51D5 7E               7      LD  A,(HL)
0011D6 51D6 23               6      INC HL
0011D7 51D7 FD7710          19      LD  (IY+16),A
0011DA 51DA 7E               7      LD  A,(HL)
0011DB 51DB 23               6      INC HL
0011DC 51DC FD7711          19      LD  (IY+17),A
0011DF 51DF 7E               7      LD  A,(HL)
0011E0 51E0 23               6      INC HL
0011E1 51E1 FD7712          19      LD  (IY+18),A
0011E4 51E4 7E               7      LD  A,(HL)
0011E5 51E5 FD7713          19      LD  (IY+19),A
0011E8 51E8 AF               4      XOR A
0011E9 51E9 FD770C          19      LD  (IY+12),A
0011EC 51EC C9              10      RET
                                
       51ED                     _SYS10:     ;(BDOS)ファイルのクローズ
0011ED 51ED AF               4      XOR A
0011EE 51EE C9              10      RET
                                
       51EF                     S11X1:
0011EF 51EF FD7119          19      LD  (IY+25),C       ;RootEntCnt
0011F2 51F2 FD750E          19      LD  (IY+14),L
0011F5 51F5 FD740F          19      LD  (IY+15),H
       51F8                     SCF_FF_RET:
0011F8 51F8 37               4      SCF
0011F9 51F9 9F               4      SBC A,A
0011FA 51FA C9              10      RET
                                
       51FB                     _SYS11:     ;(BDOS)最初のファイルの検索
0011FB 51FB ED5337F1        20      LD  (_FCB),DE
0011FF 51FF D5              11      PUSH    DE
001200 5200 FDE1            14      POP IY
001202 5202 CDE052          17      CALL    INIT_FILE
001205 5205 CD734D          17      CALL    GET_DIR_DAT
       5208                     S12X1:
001208 5208 CD724B          17      CALL    FILESE
00120B 520B 30E2            12      JR  NC,S11X1
00120D 520D 0D               4      DEC C
00120E 520E FD7119          19      LD  (IY+25),C       ;RootEntCnt
001211 5211 012000          10      LD  BC,32
001214 5214 ED5B2FF1        20      LD  DE,(_DTA)
001218 5218 AF               4      XOR A
001219 5219 12               7      LD  (DE),A      ;ドライブ番号
00121A 521A 13               6      INC DE
00121B 521B EDB0                    LDIR            ;ディレクトリエントリ
00121D 521D FD750E          19      LD  (IY+14),L
001220 5220 FD740F          19      LD  (IY+15),H
001223 5223 C9              10      RET
                                
       5224                     _SYS12:
001224 5224 FD2A37F1        20      LD  IY,(_FCB)
001228 5228 FDE5            15      PUSH    IY
00122A 522A D1              10      POP DE
00122B 522B CDE052          17      CALL    INIT_FILE
                                
00122E 522E FD6E0E          19      LD  L,(IY+14)
001231 5231 FD660F          19      LD  H,(IY+15)
001234 5234 FD4E19          19      LD  C,(IY+25)
001237 5237 18CF            12      JR  S12X1
                                
       5239                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001239 5239 CD594D          17      CALL    SET_FCB
00123C 523C CD274D          17      CALL    GETSEQ
00123F 523F CD144D          17      CALL    RB_READ
001242 5242 E5              11      PUSH    HL
001243 5243 CD344D          17      CALL    SETSEQ
001246 5246 E1              10      POP HL
       5247                     SREAD:
001247 5247 C601             7      ADD A,001H
001249 5249 D8              11      RET C
                                
00124A 524A 7D               4      LD  A,L
00124B 524B D601             7      SUB 001H
00124D 524D 9F               4      SBC A,A
00124E 524E E603             7      AND 3
001250 5250 1F               4      RRA
001251 5251 C9              10      RET
                                
       5252                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001252 5252 210100          10      LD  HL,00001H
001255 5255 AF               4      XOR A
001256 5256 C9              10      RET
                                
       5257                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001257 5257 3A4AF1          13      LD  A,(_DVSW)
00125A 525A C9              10      RET
                                
       525B                     _SYS1A:     ;(BDOS)DTAの設定
00125B 525B ED532FF1        20      LD  (_DTA),DE
00125F 525F AF               4      XOR A
001260 5260 C9              10      RET
                                
       5261                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001261 5261 010002          10      LD  BC,512
001264 5264 11C302          10      LD  DE,707
001267 5267 210000          10      LD  HL,0
00126A 526A DD2139F1        14      LD  IX,_BUF
00126E 526E FD2139F1        14      LD  IY,_BUF
001272 5272 FD3600F9        19      LD  (IY+0),0F9H
001276 5276 3E02             7      LD  A,2
001278 5278 C9              10      RET
                                
       5279                     _SYS21:     ;(BDOS)ランダムな読み出し
001279 5279 CD594D          17      CALL    SET_FCB
                                
00127C 527C FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00127F 527F FD6622          19      LD  H,(IY+34)
                                
001282 5282 CD144D          17      CALL    RB_READ
001285 5285 18C0            12      JR  SREAD
                                
       5287                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001287 5287 CD9751          17      CALL    _SYS0F
00128A 528A D8              11      RET C
                                
00128B 528B D5              11      PUSH    DE      ;EX DE,IY
00128C 528C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00128E 528E CD494D          17      CALL    GETSIZE
       5291                     _S24X1:
001291 5291 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001294 5294 FD7422          19      LD  (IY+34),H
001297 5297 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00129B 529B FDE3            23      EX  (SP),IY     ;
00129D 529D D1              10      POP DE      ;
                                
00129E 529E AF               4      XOR A
00129F 529F C9              10      RET
                                
       52A0                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0012A0 52A0 E5              11      PUSH    HL
0012A1 52A1 D5              11      PUSH    DE      ;EX DE,IY
0012A2 52A2 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0012A4 52A4 CD274D          17      CALL    GETSEQ
0012A7 52A7 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       52A9                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0012A9 52A9 CD594D          17      CALL    SET_FCB
0012AC 52AC E5              11      PUSH    HL
0012AD 52AD FD6E21          19      LD  L,(IY+33)
0012B0 52B0 FD6622          19      LD  H,(IY+34)
0012B3 52B3 2225F1          16      LD  (RR_LOW),HL
0012B6 52B6 FD6E23          19      LD  L,(IY+35)
0012B9 52B9 FD6624          19      LD  H,(IY+36)
0012BC 52BC 2227F1          16      LD  (RR_HIGH),HL
0012BF 52BF E1              10      POP HL
0012C0 52C0 CD7649          17      CALL    ROM_READ
0012C3 52C3 ED5B25F1        20      LD  DE,(RR_LOW)
0012C7 52C7 FD7321          19      LD  (IY+33),E
0012CA 52CA FD7222          19      LD  (IY+34),D
0012CD 52CD ED5B27F1        20      LD  DE,(RR_HIGH)
0012D1 52D1 FD7323          19      LD  (IY+35),E
0012D4 52D4 FD7224          19      LD  (IY+36),D
0012D7 52D7 9F               4      SBC A,A
0012D8 52D8 C9              10      RET
                                
       52D9                     _SYS2F:
0012D9 52D9 44               4      LD  B,H
0012DA 52DA 2A2FF1          16      LD  HL,(_DTA)
0012DD 52DD C3B24D          10      JP  DISKIO
                                
       52E0                     INIT_FILE:
0012E0 52E0 EB               4      EX  DE,HL
0012E1 52E1 1153F1          10      LD  DE,FDRV
0012E4 52E4 010C00          10      LD  BC,1+8+3
0012E7 52E7 EDB0                    LDIR
0012E9 52E9 CD474F          17      CALL    GET_DISK_BANK_FDRV
0012EC 52EC 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0012EF 52EF 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0012F2 52F2 C9              10      RET
                                
       52F3                     ZERO_MEMORY_DE:
0012F3 52F3 AF               4      XOR A
       52F4                     FILL_MEMORY_DE:
0012F4 52F4 12               7      LD  (DE),A
0012F5 52F5 13               6      INC DE
0012F6 52F6 10FC            13      DJNZ    FILL_MEMORY_DE
0012F8 52F8 C9              10      RET
                                
0012F9 52F9                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 8B4FA14FD24F8B4F        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 8B4F8B4FD74F1850        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 DF4F8B4F3250C650        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 86518C5193519751        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 ED51FB5124528B4F        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 39528B4F8B4F8B4F        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 525257525B526152        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 8B4F8B4F8B4F8752        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 A0528B4F8B4FA952        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 8B4F8B4FD8508B4F        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 DE508B4F8B4FD952        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 8B4F8B4F8B4F8B4F        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
