                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
       0001                     USE_MORMAL32K_OR_ASCII16        EQU 1   ;ノーマル32KB/ASCII-16K ROMを作成する
                                
                                    INCLUDE "DISKROM.ASM"
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
       0159                     CALBAS  EQU 00159H
       01F5                     REDCLK  EQU 001F5H  ;SUB
       01F9                     WRTCLK  EQU 001F9H  ;SUB
                                
       269A                     DECADD  EQU 0269AH
       27E6                     DECMUL  EQU 027E6H
       2F8A                     FRCINT  EQU 02F8AH
                                
       303A                     FRCDBL  EQU 0303AH
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
       7D17                     ST_BAS  EQU 07D17H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F847                     ARG EQU 0F847H
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
       FAF8                     EXBRSA  EQU 0FAF8H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBB1                     BASROM  EQU 0FBB1H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCC9                     SLTATR  EQU 0FCC9H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
       FD99                     DEVICE  EQU 0FD99H
                                
       FDDB                     H_PINL  EQU 0FDDBH
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
                                BANK0_SEL EQU   06000H  ;6000-67FF
                                BANK1_SEL EQU   06800H  ;6800-6FFF
                                BANK2_SEL EQU   07000H  ;7000-77FF
                                BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
                                KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
                                KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
                                KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
                                KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
                                KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
                                KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
                                KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
       F280                     ISC EQU 0F280H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU 0F280H
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0042                    DW  INIT_ROM    ; Main program execution address.
000004 4004 2050                    DW  STATEMENT   ; STATEMENT
000006 4006 5051                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3A852          10      JP  DISKIO
000013 4013 C3EE52          10      JP  DSKCHG
000016 4016 C34453          10      JP  GETDPB
000019 4019 C33754          10      JP  CHOICE
00001C 401C C33B54          10      JP  DSKFMT
00001F 401F C33D54          10      JP  DSKSTP
000022 4022 C33E54          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C33B54          10      JP  DSKFMT
000029 4029 C33D54          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C37754          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite"
            204449534B20524F    
            4D204C697465        
000096 4096                         ALIGN   32
0000A0 40A0 76302E362E302E32        DB  "v0.6.0.2"
0000A8 40A8                         ALIGN   32
       40C0                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
0000C0 40C0 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
0001BD 41BD                         ORG 041BDH
0001BD 41BD C9              10      RET
                                
                                    ;MBR_Partition1 (2DDのデータ)
0001BE 41BE 00                      DB  0       ;ブートフラグ
0001BF 41BF 000000                  DB  0,0,0       ;パーティションの最初のセクタ番号(CHS方式)
0001C2 41C2 01                      DB  1       ;識別子(FAT12)
0001C3 41C3 000000                  DB  0,0,0       ;パーティションの最後のセクタ番号(CHS方式)
0001C6 41C6 10000000                DW  16,0        ;パーティションの最初のセクタ番号(LBA方式)
0001CA 41CA A0050000                DW  1440,0      ;パーティション内のセクタ数(LBA方式)
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    ;MBR_Partition2 (2DDのデータ)
                                    DB  0       ;ブートフラグ
                                    DB  0,0,0       ;パーティションの最初のセクタ番号(CHS方式)
                                    DB  1       ;識別子(FAT12)
                                    DB  0,0,0       ;パーティションの最後のセクタ番号(CHS方式)
                                    DW  16+1440,0   ;パーティションの最初のセクタ番号(LBA方式)
                                    DW  1440,0      ;パーティション内のセクタ数(LBA方式)
                                #endif
                                
0001FE 41FE                         ORG 041FEH
0001FE 41FE 55AA                    DB  055H,0AAH   ;MBR_Sig
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4200                     INIT_ROM:
000200 4200 3A21FB          13      LD  A,(DRVTBL)
000203 4203 FE01             7      CP  1
000205 4205 C8              11      RET Z
                                
000206 4206 AF               4      XOR A
000207 4207 2100F3          10      LD  HL,0F300H
00020A 420A 0668             7      LD  B,068H
00020C 420C CDD94C          17      CALL    FILL_MEMORY
                                
00020F 420F 3E01             7      LD  A,1
000211 4211 3221FB          13      LD  (DRVTBL),A
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000214 4214 2A74F6          16      LD  HL,(STKTOP) ;起動時の空き容量表示の為
000217 4217 01C0FE          10      LD  BC,-00140H
00021A 421A 09              11      ADD HL,BC
00021B 421B 2274F6          16      LD  (STKTOP),HL
                                #else
                                    LD  HL,STKTOP+1 ;起動時の空き容量表示の為
                                    DEC (HL)
                                #endif
                                
00021E 421E AF               4      XOR A
00021F 421F 32EAF2          13      LD  (_DVSW),A
000222 4222 3D               4      DEC A       ;0FFH
000223 4223 3299FD          13      LD  (DEVICE),A
                                
000226 4226 210D44          10      LD  HL,AT_ISC
000229 4229 1180F2          10      LD  DE,ISC
00022C 422C 018800          10      LD  BC,ISC_E-ISC
00022F 422F EDB0                    LDIR
                                    
000231 4231 3EC3             7      LD  A,0C3H      ;JP
000233 4233 3243FF          13      LD  (H_GONE),A
000236 4236 327DF3          13      LD  (BDOS),A
000239 4239 326BF3          13      LD  (RAMUSE),A
00023C 423C 3268F3          13      LD  (ROMUSE),A
00023F 423F 2180F2          10      LD  HL,REPLACE_COMMAND
000242 4242 2244FF          16      LD  (H_GONE+1),HL
000245 4245 2131F3          10      LD  HL,H_BDOS
000248 4248 227EF3          16      LD  (BDOS+1),HL
00024B 424B 21ABF2          10      LD  HL,RAMUSE1
00024E 424E 226CF3          16      LD  (RAMUSE+1),HL
000251 4251 21BDF2          10      LD  HL,ROMUSE1
000254 4254 2269F3          16      LD  (ROMUSE+1),HL
                                
000257 4257 3E                      DB  03EH
000258 4258 F7              12      RST 30H
000259 4259 3271FE          13      LD  (H_BINS),A
00025C 425C 3276FE          13      LD  (H_BINL),A
00025F 425F 327BFE          13      LD  (H_FILE),A
000262 4262 3231F3          13      LD  (H_BDOS),A
000265 4265 32DBFD          13      LD  (H_PINL),A
000268 4268 32A7FF          13      LD  (H_PHYD),A
                                
00026B 426B CD5943          17      CALL    GTSL1_
00026E 426E 3297F2          13      LD  (ROM_SLT),A
000271 4271 32A7F2          13      LD  (ROM_SLT_COPY),A
000274 4274 3272FE          13      LD  (H_BINS+1),A
000277 4277 3277FE          13      LD  (H_BINL+1),A
00027A 427A 327CFE          13      LD  (H_FILE+1),A
00027D 427D 3232F3          13      LD  (H_BDOS+1),A
000280 4280 32DCFD          13      LD  (H_PINL+1),A
000283 4283 32A8FF          13      LD  (H_PHYD+1),A
000286 4286 3222FB          13      LD  (DRVTBL+1),A
000289 4289 3248F3          13      LD  (MASTERS),A
                                
00028C 428C 21C246          10      LD  HL,ROM_LOAD
00028F 428F 2273FE          16      LD  (H_BINS+2),HL
000292 4292 217648          10      LD  HL,ROM_RUN
000295 4295 2278FE          16      LD  (H_BINL+2),HL
000298 4298 218448          10      LD  HL,ROM_FILES
00029B 429B 227DFE          16      LD  (H_FILE+2),HL
00029E 429E 21DC54          10      LD  HL,ROM_BDOS
0002A1 42A1 2233F3          16      LD  (H_BDOS+2),HL
0002A4 42A4 21D244          10      LD  HL,ROM_BOOT
0002A7 42A7 22DDFD          16      LD  (H_PINL+2),HL
0002AA 42AA 21A852          10      LD  HL,DISKIO
0002AD 42AD 22A9FF          16      LD  (H_PHYD+2),HL
                                
0002B0 42B0 3E                      DB  03EH
0002B1 42B1 C9              10      RET
0002B2 42B2 327FFE          13      LD  (H_FILE+4),A
0002B5 42B5 3275FE          13      LD  (H_BINS+4),A
0002B8 42B8 327AFE          13      LD  (H_BINL+4),A
0002BB 42BB 3235F3          13      LD  (H_BDOS+4),A
0002BE 42BE 32DFFD          13      LD  (H_PINL+4),A
0002C1 42C1 32ABFF          13      LD  (H_PHYD+4),A
                                
0002C4 42C4 AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
0002C5 42C5 320060          13      LD  (ASCII16_BANK0_SEL),A       ;似非RAM対策でバンク0を設定
0002C8 42C8 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK0_SEL),A           ;似非RAM対策でバンク0を設定
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0002CB 42CB 3A0060          13      LD  A,(BANK1_ADR)
0002CE 42CE FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
0002D0 42D0 2876            12      JR  Z,NOT_BANK_TYPE
0002D2 42D2 3E01             7      LD  A,DISK_BANK
0002D4 42D4 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0002D7 42D7 CD3801          17      CALL    RSLREG      ;read primary slot #
0002DA 42DA 07               4      RLCA
0002DB 42DB 07               4      RLCA
0002DC 42DC F5              11      PUSH    AF
0002DD 42DD 1605             7      LD  D,4+1
0002DF 42DF CD6043          17      CALL    GTSL2_
0002E2 42E2 3244F3          13      LD  (RAMAD3),A
0002E5 42E5 F1              10      POP AF
0002E6 42E6 07               4      RLCA
0002E7 42E7 07               4      RLCA
0002E8 42E8 1603             7      LD  D,2+1
0002EA 42EA CD6043          17      CALL    GTSL2_
0002ED 42ED 2680             7      LD  H,080H
0002EF 42EF CD7D43          17      CALL    CHK_RAM
0002F2 42F2 3243F3          13      LD  (RAMAD2),A
       42F5                     RAMCHK2:
0002F5 42F5 3A44F3          13      LD  A,(RAMAD3)
0002F8 42F8 2640             7      LD  H,040H
0002FA 42FA CD7D43          17      CALL    CHK_RAM
0002FD 42FD 3242F3          13      LD  (RAMAD1),A
       4300                     RAMCHK1:
000300 4300 3A44F3          13      LD  A,(RAMAD3)
000303 4303 2600             7      LD  H,00H
000305 4305 CD7D43          17      CALL    CHK_RAM
000308 4308 3241F3          13      LD  (RAMAD0),A
       430B                     RAMCHK0:
00030B 430B 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
00030E 430E 010F00          10      LD  BC,0000FH       ;切り上げ
000311 4311 09              11      ADD HL,BC
000312 4312 7D               4      LD  A,L
                                
000313 4313 0604             7      LD  B,4
       4315                     B_DRIVE1:
000315 4315 CB3C             8      SRL H
000317 4317 1F               4      RRA
000318 4318 10FB            13      DJNZ    B_DRIVE1
                                
00031A 431A C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
00031C 431C 32E9F2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
                                    ;拡張スロットの選択を設定する
00031F 431F 3A97F2          13      LD  A,(ROM_SLT)
000322 4322 57               4      LD  D,A
000323 4323 E60C             7      AND 00CH
000325 4325 5F               4      LD  E,A
000326 4326 7A               4      LD  A,D
000327 4327 E603             7      AND 3
000329 4329 87               4      ADD A,A
00032A 432A 87               4      ADD A,A
00032B 432B 87               4      ADD A,A
00032C 432C 37               4      SCF
00032D 432D 8F               4      ADC A,A
00032E 432E B3               4      OR  E
00032F 432F 5F               4      LD  E,A
000330 4330 1600             7      LD  D,0
000332 4332 21C9FC          10      LD  HL,SLTATR
000335 4335 19              11      ADD HL,DE
000336 4336 3660            10      LD  (HL),060H
                                    ;CTRL+STOPを抑制する
000338 4338 3E01             7      LD  A,1
00033A 433A 32B1FB          13      LD  (BASROM),A
                                    ;BASICを起動する
00033D 433D FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000341 4341 DD21177D        14      LD  IX,ST_BAS   ;continue start of MSX-BASIC without executing BASIC programs in ROM
000345 4345 C35901          10      JP  CALBAS
                                
       4348                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000348 4348 21C040          10      LD  HL,MSG_ERROR_ROM_MODE
00034B 434B CD9844          17      CALL    MSX
00034E 434E FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000352 4352 DD219F00        14      LD  IX,CHGET
000356 4356 C31C00          10      JP  _CALSLT
                                
       4359                     GTSL1_:             ;自分のいるスロットを知る
000359 4359 CD3801          17      CALL    RSLREG      ;read primary slot #
00035C 435C 0F               4      RRCA
00035D 435D 0F               4      RRCA
00035E 435E 1601             7      LD  D,1
       4360                     GTSL2_:
000360 4360 E603             7      AND 3       ;[A]=000000PP
000362 4362 5F               4      LD  E,A     ;[E]=000000PP
000363 4363 21C1FC          10      LD  HL,EXPTBL
000366 4366 85               4      ADD A,L     ;桁上りは無い
000367 4367 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000368 4368 7B               4      LD  A,E     ;[A]=000000PP
000369 4369 CB7E            13      BIT 7,(HL)
00036B 436B C8              11      RET Z
00036C 436C 7D               4      LD  A,L     ;point to SLTTBL entry
00036D 436D C604             7      ADD A,4     ;桁上りは無い
00036F 436F 6F               4      LD  L,A
000370 4370 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4371                     GTSL3_:
000371 4371 15               4      DEC D
000372 4372 2803            12      JR  Z,GTSL4_:
000374 4374 0F               4      RRCA
000375 4375 18FA            12      JR  GTSL3_:
       4377                     GTSL4_:
000377 4377 E60C             7      AND 00CH        ;[A] = 0000SS00
000379 4379 B3               4      OR  E       ;[A] = 0000SSPP
00037A 437A F680             7      OR  080H        ;[A] = 1000SSPP
00037C 437C C9              10      RET
                                
       437D                     CHK_RAM:
00037D 437D E5              11      PUSH    HL
00037E 437E CDD243          17      CALL    CHK_RAM0
000381 4381 E1              10      POP HL
000382 4382 C8              11      RET Z
000383 4383 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000386 4386 E680             7      AND 080H
000388 4388 CDA943          17      CALL    CHK_RAM_SLT
00038B 438B C8              11      RET Z
00038C 438C 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00038F 438F E680             7      AND 080H
000391 4391 C601             7      ADD A,1
000393 4393 CDA943          17      CALL    CHK_RAM_SLT
000396 4396 C8              11      RET Z
000397 4397 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00039A 439A E680             7      AND 080H
00039C 439C C602             7      ADD A,2
00039E 439E CDA943          17      CALL    CHK_RAM_SLT
0003A1 43A1 C8              11      RET Z
0003A2 43A2 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
0003A5 43A5 E680             7      AND 080H
0003A7 43A7 C603             7      ADD A,3
       43A9                     CHK_RAM_SLT:
0003A9 43A9 E5              11      PUSH    HL
0003AA 43AA CDD243          17      CALL    CHK_RAM0        ;スロット#X or X-0
0003AD 43AD E1              10      POP HL
0003AE 43AE C8              11      RET Z
0003AF 43AF CB79             8      BIT 7,C
0003B1 43B1 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0003B3 43B3 79               4      LD  A,C
0003B4 43B4 C604             7      ADD A,4*1           ;スロット#X-1
0003B6 43B6 E5              11      PUSH    HL
0003B7 43B7 CDD243          17      CALL    CHK_RAM0
0003BA 43BA E1              10      POP HL
0003BB 43BB C8              11      RET Z
0003BC 43BC 79               4      LD  A,C
0003BD 43BD C608             7      ADD A,4*2           ;スロット#X-2
0003BF 43BF E5              11      PUSH    HL
0003C0 43C0 CDD243          17      CALL    CHK_RAM0
0003C3 43C3 E1              10      POP HL
0003C4 43C4 C8              11      RET Z
0003C5 43C5 79               4      LD  A,C
0003C6 43C6 C60C             7      ADD A,4*3           ;スロット#X-3
0003C8 43C8 E5              11      PUSH    HL
0003C9 43C9 CDD243          17      CALL    CHK_RAM0
0003CC 43CC E1              10      POP HL
       43CD                     CHK_RAM_E:
0003CD 43CD AF               4      XOR A
0003CE 43CE 3C               4      INC A           ;ZF=0にする
0003CF 43CF 3E00             7      LD  A,0
0003D1 43D1 C9              10      RET
                                
       43D2                     CHK_RAM0:
0003D2 43D2 4F               4      LD  C,A
0003D3 43D3 3A97F2          13      LD  A,(ROM_SLT)
0003D6 43D6 B9               4      CP  C
0003D7 43D7 28F4            12      JR  Z,CHK_RAM_E
0003D9 43D9 2E00             7      LD  L,0
       43DB                     CHK_RAM1:
0003DB 43DB 79               4      LD  A,C
0003DC 43DC CDCA44          17      CALL    RDSLTX
0003DF 43DF C6E5             7      ADD A,0E5H
0003E1 43E1 47               4      LD  B,A
0003E2 43E2 5F               4      LD  E,A
0003E3 43E3 79               4      LD  A,C
0003E4 43E4 C5              11      PUSH    BC
0003E5 43E5 CD1400          17      CALL    _WRSLT
0003E8 43E8 C1              10      POP BC
0003E9 43E9 79               4      LD  A,C
0003EA 43EA CDCA44          17      CALL    RDSLTX
0003ED 43ED B8               4      CP  B
0003EE 43EE C0              11      RET NZ
0003EF 43EF D6E5             7      SUB 0E5H
0003F1 43F1 79               4      LD  A,C
0003F2 43F2 5F               4      LD  E,A
0003F3 43F3 C5              11      PUSH    BC
0003F4 43F4 CD1400          17      CALL    _WRSLT
0003F7 43F7 C1              10      POP BC
0003F8 43F8 24               4      INC H
0003F9 43F9 7D               4      LD  A,L
0003FA 43FA C604             7      ADD A,4
0003FC 43FC 6F               4      LD  L,A
0003FD 43FD 20DC            12      JR  NZ,CHK_RAM1
0003FF 43FF 79               4      LD  A,C     ;ZF=1のハズ
000400 4400 C9              10      RET
                                
       4401                     CALSLT_R:
000401 4401 C5              11      PUSH    BC
000402 4402 E5              11      PUSH    HL
000403 4403 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000407 4407 CD1C00          17      CALL    _CALSLT
00040A 440A E1              10      POP HL
00040B 440B C1              10      POP BC
00040C 440C C9              10      RET
                                
       440D                     AT_ISC:
00040D F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
00040D F280 FEB7             7      CP  0B7H            ;FILES
00040F F282 CC7BFE          17      CALL    Z,H_FILE
000412 F285 FEB5             7      CP  0B5H            ;LOAD
000414 F287 CA71FE          10      JP  Z,H_BINS
000417 F28A FE8A             7      CP  08AH            ;RUN
000419 F28C CA76FE          10      JP  Z,H_BINL
00041C F28F FED6             7      CP  0D6H            ;COPY
00041E F291 2813            12      JR  Z,FIX_COPY
000420 F293 FECF             7      CP  0CFH            ;BLOAD
000422 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
000423 F296 F7              12      RST 30H
       F297                     ROM_SLT:
000424 F297 00                      DB  0
000425 F298 A447                    DW  ROM_BLOAD
000427 F29A F5              11      PUSH    AF
000428 F29B E5              11      PUSH    HL
000429 F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
00042C F29F E1              10      POP HL
00042D F2A0 F1              10      POP AF
00042E F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000430 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000432 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000433 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000434 F2A7 00                      DB  0
000435 F2A8 2649                    DW  ROM_COPY
000437 F2AA C9              10      RET
       F2AB                     RAMUSE1:
000438 F2AB 3A42F3          13      LD  A,(RAMAD1)
00043B F2AE 1810            12      JR  ENASLT2
       F2B0                     CAL_MP:
00043D F2B0 2640             7      LD  H,040H
00043F F2B2 3AC1FC          13      LD  A,(EXPTBL)
000442 F2B5 CD2400          17      CALL    _ENASLT
000445 F2B8 CD1C00          17      CALL    _CALSLT
000448 F2BB 2640             7      LD  H,040H
       F2BD                     ROMUSE1:
00044A F2BD 3A97F2          13      LD  A,(ROM_SLT)
       F2C0                     ENASLT2:
00044D F2C0 C32400          10      JP  _ENASLT
                                
       F2C3                     _RESULT:
000450 F2C3 00                      DB  0
       F2C4                     _BANK:
000451 F2C4 00                      DB  0
       F2C5                     _BANK1:
000452 F2C5 00                      DB  0
       F2C6                     CLSZ:               ;クラスタサイズ
000453 F2C6 0004                    DW  1024
       F2C7                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2C8                     SECSZ:              ;セクタサイズ
000455 F2C8 0002                    DW  512
       F2C9                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2CA                     RR_LOW:
000457 F2CA 0000                    DW  0
       F2CB                     RR_MID  EQU $-1
       F2CC                     RR_HIGH:
000459 F2CC 0000                    DW  0
       F2CE                     _CLPS:
00045B F2CE 0000                    DW  0
       F2D0                     _LEFT:
00045D F2D0 0000                    DW  0
       F2D2                     _DTPS:
00045F F2D2 0000                    DW  0
       F2D4                     _DTA:
000461 F2D4 0000                    DW  0
       F2D6                     FLG_LDIR:
000463 F2D6 00                      DB  0
       F2D7                     _FCB:
000464 F2D7 0000                    DW  0
       F2D9                     _BUF:
       F2D9                     _BUF_LO:        ;LOGICAL OPERATION
000466 F2D9 00                      DB  0
       F2DA                     _BUF_ST:
000467 F2DA 0000                    DW  0
       F2DC                     _BUF_EN:
000469 F2DC 0000                    DW  0
       F2DE                     _BUF_EX:
       F2DE                     _BUF_W:
00046B F2DE 0000                    DW  0
       F2E0                     _BUF_H:
00046D F2E0 0000                    DW  0
       F2E2                     _BUF_X:
00046F F2E2 0000                    DW  0
       F2E4                     _BUF_Y:
000471 F2E4 00                      DB  0
       F2E5                     _BUF_P:
000472 F2E5 00                      DB  0
       F2E6                     _BUF_O:
000473 F2E6 00                      DB  0
       F2E7                     DTAX:
000474 F2E7 0000                    DW  0
       F2E9                     B_DRIVE:
000476 F2E9 00                      DB  0
       F2EA                     _DVSW:          ;カレントドライブ
000477 F2EA 00                      DB  0
       F2EB                     _CD:            ;カレントディレクトリ
000478 F2EB 0000                    DW  0
       F2ED                     DIRENT1:
00047A F2ED 0000                    DW  0
       F2EF                     _DIR_BANK:
00047C F2EF 00                      DB  0
       F2F0                     LEFTX:
00047D F2F0 0000                    DW  0
       F2F2                     PARAM0:
00047F F2F2 0000                    DW  0
       F2F4                     PARAM1:
000481 F2F4 0000                    DW  0
       F2F6                     _CDX:
000483 F2F6 0000                    DW  0
       F2F8                     FDRV:
000485 F2F8 00                      DB  0
       F2F9                     FNAME:
000486 F2F9                         DS  8+3
       F304                     _HL:
000491 F304 0000                    DW  0
       F306                     _SP:
000493 F306 0000                    DW  0
       F307                     _SP_H   EQU $-1
       F308                     ISC_E:
000495 4495                         ORG $$+RUN          ;$DEPHASE
                                
       4495                     MSX1:
000495 4495 CDF554          17      CALL    MSGA1
       4498                     MSX:
000498 4498 7E               7      LD  A,(HL)
000499 4499 23               6      INC HL
00049A 449A B7               4      OR  A
00049B 449B 20F8            12      JR  NZ,MSX1
00049D 449D C9              10      RET
                                
       449E                     PRTHX:
00049E 449E F5              11      PUSH    AF
00049F 449F 07               4      RLCA
0004A0 44A0 07               4      RLCA
0004A1 44A1 07               4      RLCA
0004A2 44A2 07               4      RLCA
0004A3 44A3 CDA744          17      CALL    PRTA2
0004A6 44A6 F1              10      POP AF
       44A7                     PRTA2:
0004A7 44A7 CDAD44          17      CALL    ASC
0004AA 44AA C3F154          10      JP  MSG_A
                                    
       44AD                     ASC:
0004AD 44AD E60F             7      AND $0F
0004AF 44AF F630             7      OR  $30
0004B1 44B1 FE3A             7      CP  $3A
0004B3 44B3 D8              11      RET C
0004B4 44B4 C607             7      ADD A,7
0004B6 44B6 C9              10      RET
                                
       44B7                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
0004B7 44B7 CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0004BA 44BA 23               6      INC HL
0004BB 44BB CDF154          17      CALL    MSG_A
0004BE 44BE 10F7            13      DJNZ    MSN
0004C0 44C0 C9              10      RET
                                
       44C1                     RDSLT_ROM3:
0004C1 44C1 7E               7      LD  A,(HL)
0004C2 44C2 C9              10      RET
       44C3                     RDSLT_ROM:
0004C3 44C3 CB7C             8      BIT 7,H
0004C5 44C5 28FA            12      JR  Z,RDSLT_ROM3
       44C7                     RDSLT_ROM2:
0004C7 44C7 3A97F2          13      LD  A,(ROM_SLT)
       44CA                     RDSLTX:
0004CA 44CA C5              11      PUSH    BC
0004CB 44CB D5              11      PUSH    DE
0004CC 44CC CD0C00          17      CALL    _RDSLT
0004CF 44CF D1              10      POP DE
0004D0 44D0 C1              10      POP BC
0004D1 44D1 C9              10      RET
                                
       44D2                     ROM_BOOT:
0004D2 44D2 3E                      DB  03EH
0004D3 44D3 C9              10      RET
0004D4 44D4 32DBFD          13      LD  (H_PINL),A
0004D7 44D7 3ACAFF          13      LD  A,(EXTBIO)
0004DA 44DA FEF7             7      CP  0F7H        ;RST 30H
0004DC 44DC 280A            12      JR  Z,EXTBIO_OK
0004DE 44DE 3E                      DB  03EH
0004DF 44DF C9              10      RET
0004E0 44E0 21CAFF          10      LD  HL,EXTBIO
0004E3 44E3 061D             7      LD  B,29
0004E5 44E5 CDD94C          17      CALL    FILL_MEMORY
       44E8                     EXTBIO_OK:
0004E8 44E8 211545          10      LD  HL,DELOK
0004EB 44EB CD9844          17      CALL    MSX
                                
0004EE 44EE AF               4      XOR A
0004EF 44EF 3240F3          13      LD  (REBOOT),A
0004F2 44F2 2A48FC          16      LD  HL,(BOTTOM)
0004F5 44F5 110040          10      LD  DE,16384
0004F8 44F8 19              11      ADD HL,DE
0004F9 44F9 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0004FB 44FB 57               4      LD  D,A
0004FC 44FC 0601             7      LD  B,1
0004FE 44FE 2100C0          10      LD  HL,0C000H
000501 4501 CDA852          17      CALL    DISKIO
                                
000504 4504 116BF3          10      LD  DE,RAMUSE
000507 4507 AF               4      XOR A
000508 4508 CD1EC0          17      CALL    0C01EH
00050B 450B 116BF3          10      LD  DE,RAMUSE
00050E 450E 37               4      SCF
00050F 450F CD1EC0          17      CALL    0C01EH
       4512                     BOOT1:
000512 4512 C33E54          10      JP  BASENT
                                
       4515                     DELOK:
000515 4515 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4519                     ROM_LDIR:
000519 4519 3AD6F2          13      LD  A,(FLG_LDIR)
00051C 451C B7               4      OR  A
00051D 451D 206A            12      JR  NZ,ROM_LDIRVM
00051F 451F CB7A             8      BIT 7,D
000521 4521 CAB945          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
       4524                     LDIRA:
000524 4524 F3               4      DI
000525 4525 ED7306F3        20      LD  (_SP),SP
000529 4529 3A07F3          13      LD  A,(_SP_H)
00052C 452C FEC0             7      CP  0C0H
00052E 452E 3003            12      JR  NC,SPJ1
000530 4530 3180F2          10      LD  SP,SP32
       4533                     SPJ1:
       4533                     LDIR1:
000533 4533 78               4      LD  A,B
000534 4534 B1               4      OR  C
000535 4535 284D            12      JR  Z,LDIRE
                                
000537 4537 C5              11      PUSH    BC
000538 4538 D5              11      PUSH    DE
000539 4539 E5              11      PUSH    HL
00053A 453A 3A97F2          13      LD  A,(ROM_SLT)
00053D 453D 2680             7      LD  H,080H
00053F 453F CD2400          17      CALL    _ENASLT
000542 4542 E1              10      POP HL
000543 4543 D1              10      POP DE
000544 4544 C1              10      POP BC
       4545                     LDIR2:
000545 4545 7A               4      LD  A,D
000546 4546 FEC0             7      CP  0C0H
000548 4548 302C            12      JR  NC,LDIR4
                                
00054A 454A C5              11      PUSH    BC
00054B 454B D5              11      PUSH    DE
00054C 454C 115EF5          10      LD  DE,BUF
                                
00054F 454F 78               4      LD  A,B
000550 4550 B7               4      OR  A
000551 4551 2803            12      JR  Z,LDIR3
000553 4553 010001          10      LD  BC,00100H
       4556                     LDIR3:
000556 4556 C5              11      PUSH    BC
000557 4557 EDB0                    LDIR
000559 4559 2204F3          16      LD  (_HL),HL
                                
00055C 455C 3A43F3          13      LD  A,(RAMAD2)
00055F 455F 2680             7      LD  H,080H
000561 4561 CD2400          17      CALL    _ENASLT
                                
000564 4564 C1              10      POP BC
000565 4565 D1              10      POP DE
000566 4566 215EF5          10      LD  HL,BUF
000569 4569 EDB0                    LDIR
                                
00056B 456B 2A04F3          16      LD  HL,(_HL)
00056E 456E C1              10      POP BC
00056F 456F 78               4      LD  A,B
000570 4570 B7               4      OR  A
000571 4571 2811            12      JR  Z,LDIRE
000573 4573 05               4      DEC B
000574 4574 18BD            12      JR  LDIR1
       4576                     LDIR4:
                                #endif
000576 4576 EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
       4578                     LDIRE2:
000578 4578 D5              11      PUSH    DE
000579 4579 E5              11      PUSH    HL
00057A 457A 3A43F3          13      LD  A,(RAMAD2)
00057D 457D 2680             7      LD  H,080H
00057F 457F CD2400          17      CALL    _ENASLT
000582 4582 E1              10      POP HL
000583 4583 D1              10      POP DE
       4584                     LDIRE:
000584 4584 ED7B06F3        20      LD  SP,(_SP)
                                #endif
000588 4588 C9              10      RET
                                
       4589                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
000589 4589 F3               4      DI
00058A 458A ED7306F3        20      LD  (_SP),SP
00058E 458E 3A07F3          13      LD  A,(_SP_H)
000591 4591 FEC0             7      CP  0C0H
000593 4593 3003            12      JR  NC,SPJ2
000595 4595 3180F2          10      LD  SP,SP32
       4598                     SPJ2:
000598 4598 C5              11      PUSH    BC
000599 4599 D5              11      PUSH    DE
00059A 459A E5              11      PUSH    HL
00059B 459B 3A97F2          13      LD  A,(ROM_SLT)
00059E 459E 2680             7      LD  H,080H
0005A0 45A0 CD2400          17      CALL    _ENASLT
0005A3 45A3 E1              10      POP HL
0005A4 45A4 D1              10      POP DE
0005A5 45A5 C1              10      POP BC
                                #endif
0005A6 45A6 C5              11      PUSH    BC
0005A7 45A7 D5              11      PUSH    DE
0005A8 45A8 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005AC 45AC DD215C00        14      LD  IX,LDIRVM
0005B0 45B0 CD1C00          17      CALL    _CALSLT
0005B3 45B3 E1              10      POP HL
0005B4 45B4 C1              10      POP BC
0005B5 45B5 09              11      ADD HL,BC
0005B6 45B6 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0005B7 45B7 18BF            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       45B9                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
0005B9 45B9 F3               4      DI
0005BA 45BA ED7306F3        20      LD  (_SP),SP
0005BE 45BE 3A07F3          13      LD  A,(_SP_H)
0005C1 45C1 FEC0             7      CP  0C0H
0005C3 45C3 3003            12      JR  NC,SPJ3
0005C5 45C5 3180F2          10      LD  SP,SP32
       45C8                     SPJ3:
0005C8 45C8 C5              11      PUSH    BC
0005C9 45C9 D5              11      PUSH    DE
0005CA 45CA E5              11      PUSH    HL
0005CB 45CB 3A97F2          13      LD  A,(ROM_SLT)
0005CE 45CE 2680             7      LD  H,080H
0005D0 45D0 CD2400          17      CALL    _ENASLT
0005D3 45D3 E1              10      POP HL
0005D4 45D4 D1              10      POP DE
0005D5 45D5 C1              10      POP BC
                                #endif
       45D6                     ROM_LDIRSLT1:
0005D6 45D6 EB               4      EX  DE,HL
       45D7                     RLDIRSLT1:
0005D7 45D7 CB7C             8      BIT 7,H
0005D9 45D9 2021            12      JR  NZ,RLDIRSLT_EXIT
0005DB 45DB 1A               7      LD  A,(DE)
0005DC 45DC 13               6      INC DE
0005DD 45DD C5              11      PUSH    BC
0005DE 45DE D5              11      PUSH    DE
0005DF 45DF E5              11      PUSH    HL
0005E0 45E0 5F               4      LD  E,A
                                
0005E1 45E1 0141F3          10      LD  BC,RAMAD0
0005E4 45E4 7C               4      LD  A,H
0005E5 45E5 07               4      RLCA
0005E6 45E6 07               4      RLCA
0005E7 45E7 E603             7      AND 3
0005E9 45E9 81               4      ADD A,C
0005EA 45EA 4F               4      LD  C,A
0005EB 45EB 0A               7      LD  A,(BC)
       45EC                     RLDIRSLT2:
0005EC 45EC CD1400          17      CALL    _WRSLT
0005EF 45EF 08               4      EX  AF,AF'
0005F0 45F0 E1              10      POP HL
0005F1 45F1 D1              10      POP DE
0005F2 45F2 C1              10      POP BC
0005F3 45F3 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0005F5 45F5 EAD745          10      JP  PE,RLDIRSLT1
0005F8 45F8 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0005F9 45F9 C37845          10      JP  LDIRE2
       45FC                     RLDIRSLT_EXIT:
0005FC 45FC EB               4      EX  DE,HL
0005FD 45FD C33345          10      JP  LDIR1
                                #else
                                    RET
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    LDIR
                                    RET
                                #endif
                                
       4600                     END_OF_LINE:
000600 4600 215EF5          10      LD  HL,BUF
       4603                     EOL1:
000603 4603 7E               7      LD  A,(HL)
000604 4604 C8              11      RET Z
000605 4605 FE0D             7      CP  00DH
000607 4607 2807            12      JR  Z,EOLE
000609 4609 FE0A             7      CP  00AH
00060B 460B 2803            12      JR  Z,EOLE
00060D 460D 23               6      INC HL
00060E 460E 18F3            12      JR  EOL1
       4610                     EOLE:
000610 4610 3600            10      LD  (HL),0
000612 4612 23               6      INC HL
000613 4613 7E               7      LD  A,(HL)
000614 4614 FE0A             7      CP  00AH
000616 4616 C0              11      RET NZ
000617 4617 23               6      INC HL
000618 4618 C9              10      RET
                                
       4619                     ROM_LOAD_ASCII:
000619 4619 210000          10      LD  HL,0
00061C 461C 22DAF2          16      LD  (_BUF_ST),HL    ;読み出し位置
00061F 461F 2A76F6          16      LD  HL,(TXTTAB)
000622 4622 22DCF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000625 4625 215EF5          10      LD  HL,BUF
000628 4628 22D4F2          16      LD  (_DTA),HL
       462B                     RLOAD_A1:
00062B 462B 2ADAF2          16      LD  HL,(_BUF_ST)
00062E 462E 22CAF2          16      LD  (RR_LOW),HL
000631 4631 210201          10      LD  HL,258
000634 4634 CD464B          17      CALL    ROM_READ
000637 4637 7C               4      LD  A,H
000638 4638 B5               4      OR  L
000639 4639 2879            12      JR  Z,RLOAD_AEND
00063B 463B 015EF5          10      LD  BC,BUF
00063E 463E 09              11      ADD HL,BC
00063F 463F 3600            10      LD  (HL),0
000641 4641 CD0046          17      CALL    END_OF_LINE
000644 4644 015EF5          10      LD  BC,BUF
000647 4647 A7               4      AND A
000648 4648 ED42            15      SBC HL,BC
00064A 464A 2810            12      JR  Z,RLOAD_A2
00064C 464C 4D               4      LD  C,L
00064D 464D 44               4      LD  B,H
00064E 464E ED5BDAF2        20      LD  DE,(_BUF_ST)
000652 4652 19              11      ADD HL,DE
000653 4653 22DAF2          16      LD  (_BUF_ST),HL
000656 4656 3A5EF5          13      LD  A,(BUF)
000659 4659 B7               4      OR  A
00065A 465A 28CF            12      JR  Z,RLOAD_A1
       465C                     RLOAD_A2:
00065C 465C 115EF5          10      LD  DE,BUF
00065F 465F CD104D          17      CALL    SPCUTEX
000662 4662 1A               7      LD  A,(DE)
000663 4663 B7               4      OR  A
000664 4664 284E            12      JR  Z,RLOAD_AEND
000666 4666 CD224D          17      CALL    GETNUM
000669 4669 7C               4      LD  A,H
00066A 466A B5               4      OR  L
00066B 466B CA8B47          10      JP  Z,ERROR_DIRECT_IN_FILE
00066E 466E DD2ADCF2        20      LD  IX,(_BUF_EN)
000672 4672 DD7502          19      LD  (IX+2),L
000675 4675 DD7403          19      LD  (IX+3),H
                                
000678 4678 CD094D          17      CALL    SPCUT
00067B 467B EB               4      EX  DE,HL
00067C 467C DDE5            15      PUSH    IX
00067E 467E DD21B242        14      LD  IX,CRUNCH
000682 4682 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000686 4686 CD1C00          17      CALL    _CALSLT
000689 4689 DDE1            14      POP IX
00068B 468B EB               4      EX  DE,HL
00068C 468C 111FF4          10      LD  DE,KBUF
00068F 468F 37               4      SCF
000690 4690 ED52            15      SBC HL,DE
000692 4692 CA8B47          10      JP  Z,ERROR_DIRECT_IN_FILE
000695 4695 DA8B47          10      JP  C,ERROR_DIRECT_IN_FILE
000698 4698 4D               4      LD  C,L
000699 4699 44               4      LD  B,H
00069A 469A 2ADCF2          16      LD  HL,(_BUF_EN)
00069D 469D 110400          10      LD  DE,4
0006A0 46A0 19              11      ADD HL,DE
0006A1 46A1 111FF4          10      LD  DE,KBUF
                                
0006A4 46A4 EB               4      EX  DE,HL
0006A5 46A5 EDB0                    LDIR
0006A7 46A7 EB               4      EX  DE,HL
                                
0006A8 46A8 DD7500          19      LD  (IX+0),L
0006AB 46AB DD7401          19      LD  (IX+1),H
0006AE 46AE 22DCF2          16      LD  (_BUF_EN),HL
0006B1 46B1 C32B46          10      JP  RLOAD_A1
                                
       46B4                     RLOAD_AEND:
0006B4 46B4 2ADCF2          16      LD  HL,(_BUF_EN)
0006B7 46B7 AF               4      XOR A
0006B8 46B8 77               7      LD  (HL),A
0006B9 46B9 23               6      INC HL
0006BA 46BA 77               7      LD  (HL),A
0006BB 46BB 23               6      INC HL
0006BC 46BC 22DCF2          16      LD  (_BUF_EN),HL
0006BF 46BF C34E47          10      JP  RLOAD_END1
                                
       46C2                     ROM_LOAD:
0006C2 46C2 CDF448          17      CALL    INIT_PARAM
0006C5 46C5 7E               7      LD  A,(HL)
0006C6 46C6 FE2C             7      CP  ','
0006C8 46C8 2003            12      JR  NZ,ROM_LOAD0
0006CA 46CA 23               6      INC HL
0006CB 46CB 7E               7      LD  A,(HL)
0006CC 46CC 2B               6      DEC HL
       46CD                     ROM_LOAD0:
0006CD 46CD 32BEFC          13      LD  (RUNBNF),A
0006D0 46D0 CDE74B          17      CALL    FILE_B
0006D3 46D3 3AF9F2          13      LD  A,(FNAME)
0006D6 46D6 FE20             7      CP  020H
0006D8 46D8 CAE24B          10      JP  Z,ROM_ORG
                                
0006DB 46DB CD794D          17      CALL    ROM_OPEN
0006DE 46DE DA9747          10      JP  C,ERROR_FILE_NOT_FOUND
       46E1                     ROM_LOAD1:
0006E1 46E1 21D9F2          10      LD  HL,_BUF
0006E4 46E4 22D4F2          16      LD  (_DTA),HL
0006E7 46E7 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0006EA 46EA CD464B          17      CALL    ROM_READ
0006ED 46ED 3AD9F2          13      LD  A,(_BUF)
0006F0 46F0 3C               4      INC A
0006F1 46F1 C21946          10      JP  NZ,ROM_LOAD_ASCII
0006F4 46F4 2A76F6          16      LD  HL,(TXTTAB)
0006F7 46F7 22D4F2          16      LD  (_DTA),HL
0006FA 46FA EB               4      EX  DE,HL
0006FB 46FB 2100FF          10      LD  HL,-256
0006FE 46FE 39              11      ADD HL,SP
0006FF 46FF ED52            15      SBC HL,DE
000701 4701 CD464B          17      CALL    ROM_READ
000704 4704 ED5BD4F2        20      LD  DE,(_DTA)
000708 4708 19              11      ADD HL,DE
000709 4709 E5              11      PUSH    HL
00070A 470A 2A76F6          16      LD  HL,(TXTTAB)
       470D                     ROM_LOAD2:          ;リンクポインタをFIX
00070D 470D E5              11      PUSH    HL
00070E 470E DDE1            14      POP IX
000710 4710 7E               7      LD  A,(HL)      ;リンクポインタL
000711 4711 23               6      INC HL
000712 4712 B6               7      OR  (HL)        ;リンクポインタH
000713 4713 23               6      INC HL
000714 4714 2837            12      JR  Z,RLOAD_END0
000716 4716 23               6      INC HL      ;行番号
000717 4717 23               6      INC HL      ;行番号
       4718                     ROM_LOAD3:
000718 4718 7E               7      LD  A,(HL)
000719 4719 23               6      INC HL
00071A 471A FE0B             7      CP  00BH        ;8進数(&O)
00071C 471C 2822            12      JR  Z,INC_HL2
00071E 471E FE0C             7      CP  00CH        ;16進数(&H)
000720 4720 281E            12      JR  Z,INC_HL2
000722 4722 FE0D             7      CP  00DH        ;行番号(RUN後)
000724 4724 281A            12      JR  Z,INC_HL2
000726 4726 FE0E             7      CP  00EH        ;行番号(RUN前)
000728 4728 2816            12      JR  Z,INC_HL2
00072A 472A FE0F             7      CP  00FH        ;10～255の整数(%)
00072C 472C 2813            12      JR  Z,INC_HL1
00072E 472E FE1C             7      CP  01CH        ;256～65535の整数(%)
000730 4730 280E            12      JR  Z,INC_HL2
000732 4732 FE1D             7      CP  01DH        ;単精度実数(!)
000734 4734 2808            12      JR  Z,INC_HL4
000736 4736 FE1F             7      CP  01FH        ;倍制度実数(#)
000738 4738 2008            12      JR  NZ,INC_HL0
00073A 473A 23               6      INC HL
00073B 473B 23               6      INC HL
00073C 473C 23               6      INC HL
00073D 473D 23               6      INC HL
       473E                     INC_HL4:
00073E 473E 23               6      INC HL
00073F 473F 23               6      INC HL
       4740                     INC_HL2:
000740 4740 23               6      INC HL
       4741                     INC_HL1:
000741 4741 23               6      INC HL
       4742                     INC_HL0:
000742 4742 B7               4      OR  A
000743 4743 20D3            12      JR  NZ,ROM_LOAD3
000745 4745 DD7500          19      LD  (IX+0),L
000748 4748 DD7401          19      LD  (IX+1),H
00074B 474B 18C0            12      JR  ROM_LOAD2
       474D                     RLOAD_END0:
00074D 474D E1              10      POP HL
       474E                     RLOAD_END1:
00074E 474E 22C2F6          16      LD  (VARTAB),HL
000751 4751 22C4F6          16      LD  (ARYTAB),HL
000754 4754 22C6F6          16      LD  (STREND),HL
                                
000757 4757 3ABEFC          13      LD  A,(RUNBNF)
00075A 475A CD634D          17      CALL    CAP
00075D 475D FE52             7      CP  'R'
00075F 475F 280E            12      JR  Z,RLOAD_END2
000761 4761 AF               4      XOR A
000762 4762 21DCF2          10      LD  HL,_BUF+3
000765 4765 77               7      LD  (HL),A      ;3
000766 4766 2B               6      DEC HL
000767 4767 77               7      LD  (HL),A      ;2
000768 4768 2B               6      DEC HL
000769 4769 77               7      LD  (HL),A      ;1
00076A 476A 2B               6      DEC HL
00076B 476B 3E8F             7      LD  A,08FH      ;REM
00076D 476D 77               7      LD  (HL),A      ;0
00076E 476E C9              10      RET
       476F                     RLOAD_END2:
00076F 476F D5              11      PUSH    DE
000770 4770 ED5B76F6        20      LD  DE,(TXTTAB)
000774 4774 1B               6      DEC DE
000775 4775 AF               4      XOR A
000776 4776 21DFF2          10      LD  HL,_BUF+6
000779 4779 77               7      LD  (HL),A      ;6
00077A 477A 2B               6      DEC HL
00077B 477B 77               7      LD  (HL),A      ;5
00077C 477C 2B               6      DEC HL
00077D 477D 77               7      LD  (HL),A      ;4
00077E 477E 2B               6      DEC HL
00077F 477F 72               7      LD  (HL),D      ;3 行番号H
000780 4780 2B               6      DEC HL
000781 4781 73               7      LD  (HL),E      ;2 行番号L
000782 4782 2B               6      DEC HL
000783 4783 360D            10      LD  (HL),00DH   ;1 行番号(RUN後)
000785 4785 2B               6      DEC HL
000786 4786 3E89             7      LD  A,089H      ;GOTO
000788 4788 77               7      LD  (HL),A      ;0
000789 4789 D1              10      POP DE
00078A 478A C9              10      RET
                                
       478B                     ERROR_DIRECT_IN_FILE:
00078B 478B 1E39             7      LD  E,57            ;Direct statement in file
00078D 478D 01                      DB  1           ;LD BC,
       478E                     ERROR_DEVICE_IO_ERROR:
00078E 478E 1E13             7      LD  E,19            ;Device I/O error
000790 4790 01                      DB  1           ;LD BC,
       4791                     ERROR_INTERNAL_ERROR:
000791 4791 1E33             7      LD  E,51            ;Internal error
000793 4793 01                      DB  1           ;LD BC,
       4794                     ERROR_FILE_NOT_OPEN:
000794 4794 1E3B             7      LD  E,59            ;File not OPEN
000796 4796 01                      DB  1           ;LD BC,
       4797                     ERROR_FILE_NOT_FOUND:
000797 4797 1E35             7      LD  E,53            ;File not found
       4799                     ERROR:
000799 4799 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00079D 479D DD216F40        14      LD  IX,ERRHAND
0007A1 47A1 C31C00          10      JP  _CALSLT
                                
       47A4                     ROM_BLOAD:
0007A4 47A4 CDF448          17      CALL    INIT_PARAM
0007A7 47A7 CDE74B          17      CALL    FILE_B
0007AA 47AA CD794D          17      CALL    ROM_OPEN
0007AD 47AD 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0007AF 47AF 21D9F2          10      LD  HL,_BUF
0007B2 47B2 22D4F2          16      LD  (_DTA),HL
0007B5 47B5 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0007B8 47B8 CD464B          17      CALL    ROM_READ
0007BB 47BB 3AD9F2          13      LD  A,(_BUF)
0007BE 47BE FEFE             7      CP  0FEH
0007C0 47C0 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0007C2 47C2 21A5F2          10      LD  HL,BLOAD_RET
0007C5 47C5 229DF2          16      LD  (SWC_BLOAD),HL
                                
0007C8 47C8 2AF4F2          16      LD  HL,(PARAM1)
0007CB 47CB 7E               7      LD  A,(HL)
0007CC 47CC FE2C             7      CP  ','
0007CE 47CE 204C            12      JR  NZ,RBREAD_MEM
0007D0 47D0 23               6      INC HL
0007D1 47D1 7E               7      LD  A,(HL)
0007D2 47D2 CD634D          17      CALL    CAP
0007D5 47D5 32BEFC          13      LD  (RUNBNF),A
0007D8 47D8 FE52             7      CP  'R'     ;R,Sスイッチじゃ無い場合はオフセット値として処理する
0007DA 47DA 2808            12      JR  Z,RBOS1
0007DC 47DC FE53             7      CP  'S'
0007DE 47DE 2804            12      JR  Z,RBOS1
0007E0 47E0 FE2C             7      CP  ','
0007E2 47E2 200D            12      JR  NZ,RBOS2
       47E4                     RBOS1:
0007E4 47E4 7E               7      LD  A,(HL)
0007E5 47E5 23               6      INC HL
0007E6 47E6 B7               4      OR  A
0007E7 47E7 2824            12      JR  Z,RBREAD_OSE
0007E9 47E9 FE3A             7      CP  ':'
0007EB 47EB 2820            12      JR  Z,RBREAD_OSE
0007ED 47ED FE2C             7      CP  ','     ;次のパラメータを探す
0007EF 47EF 20F3            12      JR  NZ,RBOS1
       47F1                     RBOS2:              ;オフセット
0007F1 47F1 22F4F2          16      LD  (PARAM1),HL
0007F4 47F4 7E               7      LD  A,(HL)
0007F5 47F5 B7               4      OR  A
0007F6 47F6 2815            12      JR  Z,RBREAD_OSE
0007F8 47F8 DD212F54        14      LD  IX,FRMQNT
0007FC 47FC FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000800 4800 CD1C00          17      CALL    _CALSLT
000803 4803 22F4F2          16      LD  (PARAM1),HL
000806 4806 2ADAF2          16      LD  HL,(_BUF_ST)
000809 4809 19              11      ADD HL,DE
00080A 480A 22DAF2          16      LD  (_BUF_ST),HL
       480D                     RBREAD_OSE:
00080D 480D 3ABEFC          13      LD  A,(RUNBNF)
000810 4810 FE53             7      CP  'S'
000812 4812 2008            12      JR  NZ,RBREAD_MEM
000814 4814 CDD44A          17      CALL    WAIT_VDP
000817 4817 3E01             7      LD  A,1
000819 4819 32D6F2          13      LD  (FLG_LDIR),A
       481C                     RBREAD_MEM:
00081C 481C 2ADAF2          16      LD  HL,(_BUF_ST)
00081F 481F 22BFFC          16      LD  (SAVENT),HL
000822 4822 22D4F2          16      LD  (_DTA),HL
000825 4825 21FFFF          10      LD  HL,0FFFFH
000828 4828 CD464B          17      CALL    ROM_READ
00082B 482B AF               4      XOR A
00082C 482C 32D6F2          13      LD  (FLG_LDIR),A
00082F 482F 3ABEFC          13      LD  A,(RUNBNF)
000832 4832 FE52             7      CP  'R'
000834 4834 2006            12      JR  NZ,RBREAD1
000836 4836 2ADEF2          16      LD  HL,(_BUF_EX)
000839 4839 229DF2          16      LD  (SWC_BLOAD),HL
       483C                     RBREAD1:
       483C                     ROM_NEXT:
00083C 483C 2AF4F2          16      LD  HL,(PARAM1)
00083F 483F 7E               7      LD  A,(HL)
000840 4840 2B               6      DEC HL
000841 4841 B7               4      OR  A
000842 4842 2805            12      JR  Z,ROM_NEXT1
000844 4844 FE3A             7      CP  ':'
000846 4846 2801            12      JR  Z,ROM_NEXT1
000848 4848 23               6      INC HL
       4849                     ROM_NEXT1:
000849 4849 5D               4      LD  E,L
00084A 484A 54               4      LD  D,H
                                
00084B 484B CD394D          17      CALL    SEARCH_END
00084E 484E B7               4      OR  A
00084F 484F 2821            12      JR  Z,REM
       4851                     RN3:                    ;マルチステートメントの処理
000851 4851 7E               7      LD  A,(HL)
                                
000852 4852 FEB5             7      CP  0B5H            ;LOAD
000854 4854 CAC246          10      JP  Z,ROM_LOAD
000857 4857 FE8A             7      CP  08AH            ;RUN
000859 4859 281B            12      JR  Z,ROM_RUN
00085B 485B FEB7             7      CP  0B7H            ;FILES
00085D 485D 2825            12      JR  Z,ROM_FILES
00085F 485F FED6             7      CP  0D6H            ;COPY
000861 4861 CA2649          10      JP  Z,ROM_COPY
000864 4864 FE20             7      CP  020H
000866 4866 2807            12      JR  Z,RN_SP
                                
000868 4868 3E28             7      LD  A,028H          ;JR Z,
00086A 486A 32A3F2          13      LD  (SWC_BLOAD_M),A
00086D 486D 7E               7      LD  A,(HL)
00086E 486E C9              10      RET
       486F                     RN_SP:
00086F 486F 23               6      INC HL
000870 4870 18DF            12      JR  RN3
                                
       4872                     REM:
000872 4872 EB               4      EX  DE,HL
000873 4873 3E8F             7      LD  A,08FH          ;REM
000875 4875 C9              10      RET
                                
       4876                     ROM_RUN:
000876 4876 23               6      INC HL
000877 4877 7E               7      LD  A,(HL)
000878 4878 2B               6      DEC HL
000879 4879 B7               4      OR  A
00087A 487A C4C246          17      CALL    NZ,ROM_LOAD
00087D 487D FE8F             7      CP  08FH            ;REM
00087F 487F 3E8A             7      LD  A,08AH          ;RUN
000881 4881 C0              11      RET NZ
000882 4882 77               7      LD  (HL),A
000883 4883 C9              10      RET
                                
       4884                     ROM_FILES:
000884 4884 CDF448          17      CALL    INIT_PARAM
000887 4887 CDE74B          17      CALL    FILE_B
00088A 488A CD7B54          17      CALL    GET_DISK_BANK_FDRV
00088D 488D 3AC9F2          13      LD  A,(SECSZ_H)
000890 4890 CD3953          17      CALL    IS_BPB1
000893 4893 DA8E47          10      JP  C,ERROR_DEVICE_IO_ERROR
000896 4896 3AF9F2          13      LD  A,(FNAME)
000899 4899 FE21             7      CP  021H
00089B 489B 3005            12      JR  NC,RFILES0
00089D 489D 060B             7      LD  B,11
00089F 489F CDCD4C          17      CALL    FILE10
       48A2                     RFILES0:
0008A2 48A2 CDD54F          17      CALL    GET_DIR_DAT
       48A5                     RFILES1:
0008A5 48A5 CD954D          17      CALL    FILESE
0008A8 48A8 3045            12      JR  NC,RFILES_NOT_MATCH
       48AA                     RFILES_DISP:
0008AA 48AA E5              11      PUSH    HL
0008AB 48AB 110B00          10      LD  DE,0000BH   ;属性
0008AE 48AE 19              11      ADD HL,DE
                                #if exists USE_MORMAL32K_OR_ASCII16
0008AF 48AF CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0008B2 48B2 E1              10      POP HL
0008B3 48B3 CB4F             8      BIT 1,A     ;不可視属性
0008B5 48B5 2035            12      JR  NZ,RFILES_NEXT
0008B7 48B7 E5              11      PUSH    HL
0008B8 48B8 0608             7      LD  B,8
0008BA 48BA CDB744          17      CALL    MSN
                                #if exists USE_MORMAL32K_OR_ASCII16
0008BD 48BD CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0008C0 48C0 FE20             7      CP  020H
0008C2 48C2 F5              11      PUSH    AF
0008C3 48C3 3E2E             7      LD  A,'.'
0008C5 48C5 C4F154          17      CALL    NZ,MSG_A
0008C8 48C8 0603             7      LD  B,3
0008CA 48CA CDB744          17      CALL    MSN
0008CD 48CD F1              10      POP AF
0008CE 48CE CCF154          17      CALL    Z,MSG_A
0008D1 48D1 3ADDF3          13      LD  A,(CSRX)
0008D4 48D4 47               4      LD  B,A
0008D5 48D5 3AB0F3          13      LD  A,(LINLEN)
0008D8 48D8 90               4      SUB B
0008D9 48D9 FE0C             7      CP  12
0008DB 48DB 3009            12      JR  NC,RFILES2
0008DD 48DD 3E0D             7      LD  A,00DH      ;改行
0008DF 48DF CDF154          17      CALL    MSG_A
0008E2 48E2 3E0A             7      LD  A,00AH
0008E4 48E4 1802            12      JR  RFILES3
       48E6                     RFILES2:
0008E6 48E6 3E20             7      LD  A,020H
       48E8                     RFILES3:
0008E8 48E8 CDF154          17      CALL    MSG_A
0008EB 48EB E1              10      POP HL
       48EC                     RFILES_NEXT:
0008EC 48EC CDB34D          17      CALL    FNEXT
       48EF                     RFILES_NOT_MATCH:
0008EF 48EF 20B4            12      JR  NZ,RFILES1
0008F1 48F1 C33C48          10      JP  ROM_NEXT
                                
       48F4                     INIT_PARAM:
0008F4 48F4 22F2F2          16      LD  (PARAM0),HL
0008F7 48F7 22F4F2          16      LD  (PARAM1),HL
0008FA 48FA EB               4      EX  DE,HL
0008FB 48FB 32BEFC          13      LD  (RUNBNF),A
0008FE 48FE 3263F6          13      LD  (VALTYP),A
000901 4901 E5              11      PUSH    HL
000902 4902 2AEBF2          16      LD  HL,(_CD)
000905 4905 22F6F2          16      LD  (_CDX),HL
000908 4908 E1              10      POP HL
000909 4909 13               6      INC DE
00090A 490A CD094D          17      CALL    SPCUT
00090D 490D 1A               7      LD  A,(DE)
00090E 490E B7               4      OR  A
00090F 490F C8              11      RET Z
000910 4910 FE3A             7      CP  ':'
000912 4912 C8              11      RET Z
000913 4913 FE28             7      CP  '('
000915 4915 C8              11      RET Z
000916 4916 EB               4      EX  DE,HL
000917 4917 DD21644C        14      LD  IX,FRMEVL
00091B 491B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00091F 491F CD1C00          17      CALL    _CALSLT
000922 4922 22F4F2          16      LD  (PARAM1),HL
000925 4925 C9              10      RET
                                
       4926                     ROM_COPY:
000926 4926 CDF448          17      CALL    INIT_PARAM
000929 4929 3A63F6          13      LD  A,(VALTYP)
00092C 492C FE03             7      CP  3       ;string
00092E 492E C2E24B          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000931 4931 CDE74B          17      CALL    FILE_B
000934 4934 CD794D          17      CALL    ROM_OPEN
000937 4937 DA9747          10      JP  C,ERROR_FILE_NOT_FOUND
                                
00093A 493A 21DEF2          10      LD  HL,_BUF_W
00093D 493D 22D4F2          16      LD  (_DTA),HL
000940 4940 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000943 4943 CD464B          17      CALL    ROM_READ
                                
000946 4946 AF               4      XOR A
000947 4947 32D9F2          13      LD  (_BUF_LO),A     ;PSET
00094A 494A 32E6F2          13      LD  (_BUF_O),A      ;向き
                                
00094D 494D 2AF4F2          16      LD  HL,(PARAM1)
       4950                     RCP_PARAM1:
000950 4950 7E               7      LD  A,(HL)
000951 4951 23               6      INC HL
000952 4952 B7               4      OR  A
000953 4953 CA4948          10      JP  Z,ROM_NEXT1
000956 4956 FE3A             7      CP  ':'
000958 4958 CA4948          10      JP  Z,ROM_NEXT1
00095B 495B FE2C             7      CP  ','
00095D 495D 2012            12      JR  NZ,RCP_PARAM1_
                                
00095F 495F DD212F54        14      LD  IX,FRMQNT
000963 4963 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000967 4967 CD1C00          17      CALL    _CALSLT
00096A 496A 7B               4      LD  A,E
00096B 496B 87               4      ADD A,A
00096C 496C 87               4      ADD A,A
00096D 496D 32E6F2          13      LD  (_BUF_O),A
000970 4970 7E               7      LD  A,(HL)
       4971                     RCP_PARAM1_:
000971 4971 FE28             7      CP  '('
000973 4973 20DB            12      JR  NZ,RCP_PARAM1
000975 4975 DD212F54        14      LD  IX,FRMQNT
000979 4979 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00097D 497D CD1C00          17      CALL    _CALSLT
                                
000980 4980 ED53E2F2        20      LD  (_BUF_X),DE
                                
       4984                     RCP_PARAM2:
000984 4984 23               6      INC HL
000985 4985 7E               7      LD  A,(HL)
000986 4986 FE20             7      CP  020H
000988 4988 28FA            12      JR  Z,RCP_PARAM2
00098A 498A FE2C             7      CP  ','
00098C 498C 28F6            12      JR  Z,RCP_PARAM2
                                
00098E 498E DD212F54        14      LD  IX,FRMQNT
000992 4992 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000996 4996 CD1C00          17      CALL    _CALSLT
                                
000999 4999 3AF6FA          13      LD  A,(ACPAGE)
00099C 499C 57               4      LD  D,A
00099D 499D ED53E4F2        20      LD  (_BUF_Y),DE
       49A1                     RCP_PARAM3:
0009A1 49A1 23               6      INC HL
0009A2 49A2 7E               7      LD  A,(HL)
0009A3 49A3 FE20             7      CP  020H
0009A5 49A5 28FA            12      JR  Z,RCP_PARAM3
0009A7 49A7 FE29             7      CP  ')'
0009A9 49A9 28F6            12      JR  Z,RCP_PARAM3
0009AB 49AB FE2C             7      CP  ','
0009AD 49AD 2033            12      JR  NZ,RCP_ST
                                
0009AF 49AF 23               6      INC HL
0009B0 49B0 DD212F54        14      LD  IX,FRMQNT
0009B4 49B4 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009B8 49B8 CD1C00          17      CALL    _CALSLT
                                
0009BB 49BB 7B               4      LD  A,E
0009BC 49BC 32E5F2          13      LD  (_BUF_P),A
                                
       49BF                     RCP_PARAM4:
0009BF 49BF 7E               7      LD  A,(HL)
0009C0 49C0 23               6      INC HL
0009C1 49C1 FE20             7      CP  020H
0009C3 49C3 28FA            12      JR  Z,RCP_PARAM4
                                
0009C5 49C5 FE2C             7      CP  ','
0009C7 49C7 2019            12      JR  NZ,RCP_ST
                                
0009C9 49C9 7E               7      LD  A,(HL)
0009CA 49CA 0604             7      LD  B,4
0009CC 49CC FEC3             7      CP  0C3H        ;PRESET
0009CE 49CE 280E            12      JR  Z,RCP_LO
0009D0 49D0 05               4      DEC B       ;3
0009D1 49D1 D6F8             7      SUB 0F8H        ;XOR
0009D3 49D3 2809            12      JR  Z,RCP_LO
0009D5 49D5 05               4      DEC B       ;2
0009D6 49D6 3C               4      INC A       ;OR
0009D7 49D7 2805            12      JR  Z,RCP_LO
0009D9 49D9 05               4      DEC B       ;1
0009DA 49DA 3C               4      INC A       ;AND
0009DB 49DB 2801            12      JR  Z,RCP_LO
0009DD 49DD 05               4      DEC B       ;0
                                                ;PSET
       49DE                     RCP_LO:
0009DE 49DE 78               4      LD  A,B
0009DF 49DF 32D9F2          13      LD  (_BUF_LO),A
       49E2                     RCP_ST:
0009E2 49E2 2AC6F6          16      LD  HL,(STREND)
0009E5 49E5 22D4F2          16      LD  (_DTA),HL
0009E8 49E8 EB               4      EX  DE,HL
0009E9 49E9 2100FE          10      LD  HL,-512
0009EC 49EC 39              11      ADD HL,SP
0009ED 49ED AF               4      XOR A
0009EE 49EE ED52            15      SBC HL,DE
0009F0 49F0 3008            12      JR  NC,RCP0
0009F2 49F2 215EF5          10      LD  HL,BUF
0009F5 49F5 22D4F2          16      LD  (_DTA),HL
0009F8 49F8 6F               4      LD  L,A ;0
0009F9 49F9 67               4      LD  H,A ;0
       49FA                     RCP0:
0009FA 49FA 24               4      INC H
0009FB 49FB 22DCF2          16      LD  (_BUF_EN),HL
       49FE                     RCP1:
0009FE 49FE F3               4      DI
0009FF 49FF CDD44A          17      CALL    WAIT_VDP
                                
000A02 4A02 3A0700          13      LD  A,(WRVDP)
000A05 4A05 4F               4      LD  C,A
000A06 4A06 0C               4      INC C       ;C := PORT#1's address(WR)
000A07 4A07 3E24             7      LD  A,36
000A09 4A09 ED79            12      OUT (C),A
000A0B 4A0B 3E91             7      LD  A,080H+17
000A0D 4A0D ED79            12      OUT (C),A       ;R#17 := 36
                                
000A0F 4A0F 0C               4      INC C
000A10 4A10 0C               4      INC C       ;C := PORT#3's address(WR)
000A11 4A11 2AE2F2          16      LD  HL,(_BUF_X)
000A14 4A14 ED69            12      OUT (C),L       ;R#36 DX
000A16 4A16 ED61            12      OUT (C),H       ;R#37
000A18 4A18 2AE4F2          16      LD  HL,(_BUF_Y)
000A1B 4A1B ED69            12      OUT (C),L       ;R#38 DY
000A1D 4A1D ED61            12      OUT (C),H       ;R#39
000A1F 4A1F 2ADEF2          16      LD  HL,(_BUF_W)
000A22 4A22 ED69            12      OUT (C),L       ;R#40 NX
000A24 4A24 ED61            12      OUT (C),H       ;R#41
000A26 4A26 2AE0F2          16      LD  HL,(_BUF_H)
000A29 4A29 ED69            12      OUT (C),L       ;R#42 NY
000A2B 4A2B ED61            12      OUT (C),H       ;R#43
                                
000A2D 4A2D DD2AAFFC        20      LD  IX,(SCRMOD)
000A31 4A31 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A34 4A34 B7               4      OR  A
000A35 4A35 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000A37 4A37 DD7D             9      LD  A,IXL
000A39 4A39 FE08             7      CP  8
000A3B 4A3B 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000A3D 4A3D FE06             7      CP  6
000A3F 4A3F 2AE2F2          16      LD  HL,(_BUF_X)
000A42 4A42 3ADEF2          13      LD  A,(_BUF_W)
000A45 4A45 2005            12      JR  NZ,SCR57
000A47 4A47 B5               4      OR  L       ;スクリーン6
000A48 4A48 E603             7      AND 3
000A4A 4A4A 200D            12      JR  NZ,USE_LMMC
       4A4C                     SCR57:              ;スクリーン5,7
000A4C 4A4C B5               4      OR  L
000A4D 4A4D E601             7      AND 1
000A4F 4A4F 2008            12      JR  NZ,USE_LMMC
       4A51                     USE_HMMC:
000A51 4A51 DD2E08          10      LD  IXL,8
       4A54                     USE_HMMC8:
000A54 4A54 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000A56 4A56 32D9F2          13      LD  (_BUF_LO),A
       4A59                     USE_LMMC:
000A59 4A59 110000          10      LD  DE,0
000A5C 4A5C 06FF             7      LD  B,-1
000A5E 4A5E CDFF4A          17      CALL    GET_PIXEL
000A61 4A61 ED79            12      OUT (C),A       ;R#44 first DATA
000A63 4A63 3AE6F2          13      LD  A,(_BUF_O)
000A66 4A66 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000A68 4A68 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A6B 4A6B F6B0             7      OR  0B0H        ;R#46 LMMC command
000A6D 4A6D ED79            12      OUT (C),A
                                
000A6F 4A6F FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000A71 4A71 0D               4      DEC C
000A72 4A72 0D               4      DEC C       ;C := PORT#1's address(WR)
000A73 4A73 3EAC             7      LD  A,080H+44
000A75 4A75 ED79            12      OUT (C),A
000A77 4A77 3E91             7      LD  A,080H+17
000A79 4A79 ED79            12      OUT (C),A       ;R#17 := 44
                                
000A7B 4A7B 3A0600          13      LD  A,(RDVDP)
000A7E 4A7E 3C               4      INC A
000A7F 4A7F FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000A81 4A81 3E02             7      LD  A,2
000A83 4A83 ED79            12      OUT (C),A
000A85 4A85 3E8F             7      LD  A,08FH
000A87 4A87 ED79            12      OUT (C),A
000A89 4A89 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A8C 4A8C E640             7      AND 040H
000A8E 4A8E 201C            12      JR  NZ,LOOP_HMMC
       4A90                     LOOP_COPY:
000A90 4A90 CDFF4A          17      CALL    GET_PIXEL
000A93 4A93 08               4      EX  AF,AF'
000A94 4A94 FD4C             9      LD  C,IYH
       4A96                     LOOP_COPY1:
000A96 4A96 ED78            12      IN  A,(C)
000A98 4A98 0F               4      RRCA            ;RRCAではサインフラグは変化しない
000A99 4A99 300A            12      JR  NC,EXIT_COPY    ;check CE bit
000A9B 4A9B F2964A          10      JP  P,LOOP_COPY1    ;check TR bit
000A9E 4A9E 08               4      EX  AF,AF'
000A9F 4A9F FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000AA1 4AA1 ED79            12      OUT (C),A
000AA3 4AA3 18EB            12      JR  LOOP_COPY
                                
       4AA5                     EXIT_COPY:
000AA5 4AA5 CDDC4A          17      CALL    GET_STATUS_0
000AA8 4AA8 FB               4      EI
000AA9 4AA9 C33C48          10      JP  ROM_NEXT
                                
       4AAC                     LOOP_HMMC:
000AAC 4AAC F3               4      DI          ;必要
000AAD 4AAD FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000AAF 4AAF 43               4      LD  B,E
000AB0 4AB0 7B               4      LD  A,E
000AB1 4AB1 B7               4      OR  A
000AB2 4AB2 2802            12      JR  Z,LOOP_HMMC1
000AB4 4AB4 EDB3                    OTIR
       4AB6                     LOOP_HMMC1:
000AB6 4AB6 14               4      INC D
       4AB7                     LOOP_HMMC2:
000AB7 4AB7 15               4      DEC D
000AB8 4AB8 2805            12      JR  Z,LOOP_HMMC3
000ABA 4ABA EDB3                    OTIR
000ABC 4ABC C3B74A          10      JP  LOOP_HMMC2
       4ABF                     LOOP_HMMC3:
000ABF 4ABF ED78            12      IN  A,(C)
000AC1 4AC1 0F               4      RRCA
000AC2 4AC2 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
000AC4 4AC4 2ADCF2          16      LD  HL,(_BUF_EN)
000AC7 4AC7 CD464B          17      CALL    ROM_READ
000ACA 4ACA EB               4      EX  DE,HL
000ACB 4ACB 2AD4F2          16      LD  HL,(_DTA)
000ACE 4ACE 7A               4      LD  A,D
000ACF 4ACF B3               4      OR  E
000AD0 4AD0 20DA            12      JR  NZ,LOOP_HMMC
000AD2 4AD2 18C2            12      JR  LOOP_COPY1
                                    
       4AD4                     WAIT_VDP:
000AD4 4AD4 3E02             7      LD  A,2
000AD6 4AD6 CDDD4A          17      CALL    GET_STATUS
000AD9 4AD9 0F               4      RRCA
000ADA 4ADA 38F8            12      JR  C,WAIT_VDP
       4ADC                     GET_STATUS_0:
000ADC 4ADC AF               4      XOR A
       4ADD                     GET_STATUS:
000ADD 4ADD C5              11      PUSH    BC
000ADE 4ADE ED4B0600        20      LD  BC,(RDVDP)
000AE2 4AE2 0C               4      INC C
000AE3 4AE3 ED79            12      OUT (C),A
000AE5 4AE5 3E8F             7      LD  A,08FH
000AE7 4AE7 ED79            12      OUT (C),A
000AE9 4AE9 ED78            12      IN  A,(C)
000AEB 4AEB C1              10      POP BC
000AEC 4AEC C9              10      RET
                                
       4AED                     GET_PIXEL256:
000AED 4AED 7A               4      LD  A,D
000AEE 4AEE B3               4      OR  E
000AEF 4AEF 200A            12      JR  NZ,GET_PIXEL1
000AF1 4AF1 2ADCF2          16      LD  HL,(_BUF_EN)
000AF4 4AF4 CD464B          17      CALL    ROM_READ
000AF7 4AF7 EB               4      EX  DE,HL
000AF8 4AF8 2AD4F2          16      LD  HL,(_DTA)
       4AFB                     GET_PIXEL1:
000AFB 4AFB 7E               7      LD  A,(HL)
000AFC 4AFC 23               6      INC HL
000AFD 4AFD 1B               6      DEC DE
000AFE 4AFE C9              10      RET
                                
       4AFF                     GET_PIXEL:
000AFF 4AFF DD7D             9      LD  A,IXL
000B01 4B01 FE08             7      CP  8
000B03 4B03 28E8            12      JR  Z,GET_PIXEL256
000B05 4B05 04               4      INC B
000B06 4B06 FE06             7      CP  6
000B08 4B08 282E            12      JR  Z,GET_PIXEL4
                                
000B0A 4B0A CB40             8      BIT 0,B
000B0C 4B0C 20ED            12      JR  NZ,GET_PIXEL1
                                
000B0E 4B0E 7A               4      LD  A,D
000B0F 4B0F B3               4      OR  E
000B10 4B10 200A            12      JR  NZ,GET_PIXEL2
                                
000B12 4B12 2ADCF2          16      LD  HL,(_BUF_EN)
000B15 4B15 CD464B          17      CALL    ROM_READ
000B18 4B18 EB               4      EX  DE,HL
000B19 4B19 2AD4F2          16      LD  HL,(_DTA)
                                
       4B1C                     GET_PIXEL2:
000B1C 4B1C 7E               7      LD  A,(HL)
000B1D 4B1D 0F               4      RRCA
000B1E 4B1E 0F               4      RRCA
000B1F 4B1F 0F               4      RRCA
000B20 4B20 0F               4      RRCA
000B21 4B21 C9              10      RET
                                
       4B22                     GET_PIXEL3:
000B22 4B22 7A               4      LD  A,D
000B23 4B23 B3               4      OR  E
000B24 4B24 200A            12      JR  NZ,GET_PIXEL5
                                
000B26 4B26 2ADCF2          16      LD  HL,(_BUF_EN)
000B29 4B29 CD464B          17      CALL    ROM_READ
000B2C 4B2C EB               4      EX  DE,HL
000B2D 4B2D 2AD4F2          16      LD  HL,(_DTA)
       4B30                     GET_PIXEL5:
000B30 4B30 7E               7      LD  A,(HL)
000B31 4B31 0F               4      RRCA
000B32 4B32 0F               4      RRCA
000B33 4B33 0F               4      RRCA
000B34 4B34 0F               4      RRCA
000B35 4B35 0F               4      RRCA
000B36 4B36 0F               4      RRCA
000B37 4B37 C9              10      RET
                                
       4B38                     GET_PIXEL4:
000B38 4B38 78               4      LD  A,B
000B39 4B39 E603             7      AND 3   ;+0
000B3B 4B3B 28E5            12      JR  Z,GET_PIXEL3
000B3D 4B3D 3D               4      DEC A   ;+1
000B3E 4B3E 28DC            12      JR  Z,GET_PIXEL2
000B40 4B40 3D               4      DEC A   ;+2
000B41 4B41 7E               7      LD  A,(HL)
000B42 4B42 C0              11      RET NZ
000B43 4B43 0F               4      RRCA        ;+3
000B44 4B44 0F               4      RRCA
000B45 4B45 C9              10      RET
                                
       4B46                     ROM_READ:
000B46 4B46 E5              11      PUSH    HL
000B47 4B47 D5              11      PUSH    DE
000B48 4B48 C5              11      PUSH    BC
000B49 4B49 FDE5            15      PUSH    IY
000B4B 4B4B 22F0F2          16      LD  (LEFTX),HL
000B4E 4B4E 2AD4F2          16      LD  HL,(_DTA)
000B51 4B51 22E7F2          16      LD  (DTAX),HL
000B54 4B54 2AF0F2          16      LD  HL,(LEFTX)
                                
000B57 4B57 CDFA4D          17      CALL    RBX1
000B5A 4B5A 3870            12      JR  C,RBRERR1
000B5C 4B5C 79               4      LD  A,C
000B5D 4B5D EB               4      EX  DE,HL
000B5E 4B5E ED52            15      SBC HL,DE       ;CP 0HL,CDE
000B60 4B60 19              11      ADD HL,DE
000B61 4B61 DE00             7      SBC A,000H
000B63 4B63 3801            12      JR  C,RBR1
000B65 4B65 EB               4      EX  DE,HL
       4B66                     RBR1:
000B66 4B66 9F               4      SBC A,A
000B67 4B67 E601             7      AND 1
000B69 4B69 32C3F2          13      LD  (_RESULT),A
000B6C 4B6C 7C               4      LD  A,H
000B6D 4B6D B5               4      OR  L
000B6E 4B6E CAC24B          10      JP  Z,RBREND0
                                
000B71 4B71 22D0F2          16      LD  (_LEFT),HL  ;Read record byte
000B74 4B74 22F0F2          16      LD  (LEFTX),HL
                                
000B77 4B77 CD2D4E          17      CALL    RBX2
000B7A 4B7A 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000B7C 4B7C CD404E          17      CALL    RBXA
000B7F 4B7F DAD84B          10      JP  C,RBRERR
000B82 4B82 C5              11      PUSH    BC
000B83 4B83 CD1945          17      CALL    ROM_LDIR
000B86 4B86 ED53E7F2        20      LD  (DTAX),DE
000B8A 4B8A 2AF0F2          16      LD  HL,(LEFTX)
000B8D 4B8D D1              10      POP DE
000B8E 4B8E A7               4      AND A
000B8F 4B8F ED52            15      SBC HL,DE
000B91 4B91 22F0F2          16      LD  (LEFTX),HL
000B94 4B94 2829            12      JR  Z,RBREND
                                
       4B96                     RBRB:
000B96 4B96 CD794E          17      CALL    RBXB
000B99 4B99 2818            12      JR  Z,RBRC
       4B9B                     RBRB1:
000B9B 4B9B C5              11      PUSH    BC
000B9C 4B9C D5              11      PUSH    DE
000B9D 4B9D CD2A4F          17      CALL    CLUST
000BA0 4BA0 EB               4      EX  DE,HL
000BA1 4BA1 ED4BC6F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000BA5 4BA5 CD1945          17      CALL    ROM_LDIR
000BA8 4BA8 EB               4      EX  DE,HL
000BA9 4BA9 D1              10      POP DE
000BAA 4BAA C1              10      POP BC
000BAB 4BAB CD074F          17      CALL    GNCL
000BAE 4BAE DAD84B          10      JP  C,RBRERR
000BB1 4BB1 10E8            13      DJNZ    RBRB1
       4BB3                     RBRC:
000BB3 4BB3 CD914E          17      CALL    RBXC
000BB6 4BB6 2807            12      JR  Z,RBREND
                                
000BB8 4BB8 CD2A4F          17      CALL    CLUST
000BBB 4BBB EB               4      EX  DE,HL
000BBC 4BBC CD1945          17      CALL    ROM_LDIR
       4BBF                     RBREND:
000BBF 4BBF CD9D4E          17      CALL    RBXEND
       4BC2                     RBREND0:
000BC2 4BC2 FDE1            14      POP IY
000BC4 4BC4 C1              10      POP BC
000BC5 4BC5 D1              10      POP DE
000BC6 4BC6 F1              10      POP AF  ;(HL)
000BC7 4BC7 AF               4      XOR A
000BC8 4BC8 3AC3F2          13      LD  A,(_RESULT)
000BCB 4BCB C9              10      RET
                                
       4BCC                     RBRERR1:
000BCC 4BCC 3E01             7      LD  A,001H
       4BCE                     RBRERR2:
000BCE 4BCE FDE1            14      POP IY
000BD0 4BD0 C1              10      POP BC
000BD1 4BD1 D1              10      POP DE
000BD2 4BD2 E1              10      POP HL
000BD3 4BD3 37               4      SCF
000BD4 4BD4 210000          10      LD  HL,0
000BD7 4BD7 C9              10      RET
       4BD8                     RBRERR:
000BD8 4BD8 3EFF             7      LD  A,0FFH
000BDA 4BDA 18F2            12      JR  RBRERR2
                                
       4BDC                     FILE_DD:
000BDC 4BDC E1              10      POP HL
000BDD 4BDD 3E                      DB  03EH
000BDE 4BDE C9              10      RET
000BDF 4BDF 32A3F2          13      LD  (SWC_BLOAD_M),A
       4BE2                     ROM_ORG:
000BE2 4BE2 2AF2F2          16      LD  HL,(PARAM0)
000BE5 4BE5 7E               7      LD  A,(HL)
000BE6 4BE6 C9              10      RET
       4BE7                     FILE_B:
000BE7 4BE7 AF               4      XOR A
000BE8 4BE8 32F8F2          13      LD  (FDRV),A
000BEB 4BEB 1E00             7      LD  E,0
000BED 4BED 3A63F6          13      LD  A,(VALTYP)
000BF0 4BF0 FE03             7      CP  3       ;string
000BF2 4BF2 C28A4C          10      JP  NZ,FILED
                                
000BF5 4BF5 DD21D067        14      LD  IX,FRESTR
000BF9 4BF9 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000BFD 4BFD CD1C00          17      CALL    _CALSLT
000C00 4C00 E5              11      PUSH    HL
000C01 4C01 DDE1            14      POP IX
                                
000C03 4C03 DD5E00          19      LD  E,(IX+0)
000C06 4C06 DD7E01          19      LD  A,(IX+1)
000C09 4C09 DD5602          19      LD  D,(IX+2)
000C0C 4C0C DD62             9      LD  IXH,D
000C0E 4C0E DD6F             9      LD  IXL,A
000C10 4C10 7B               4      LD  A,E
       4C11                     FILE_BDOS:
000C11 4C11 FE04             7      CP  4
000C13 4C13 3808            12      JR  C,FILEB1
000C15 4C15 DD7E03          19      LD  A,(IX+3)
000C18 4C18 FE3A             7      CP  ':'
000C1A 4C1A 28C0            12      JR  Z,FILE_DD
000C1C 4C1C 7B               4      LD  A,E
       4C1D                     FILEB1:
000C1D 4C1D FE02             7      CP  2
000C1F 4C1F 3818            12      JR  C,DEVI1
000C21 4C21 DD7E01          19      LD  A,(IX+1)
000C24 4C24 FE3A             7      CP  ':'
000C26 4C26 2011            12      JR  NZ,DEVI1
000C28 4C28 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000C2B 4C2B CD634D          17      CALL    CAP
000C2E 4C2E D640             7      SUB '@'
000C30 4C30 DD23            10      INC IX
000C32 4C32 DD23            10      INC IX
000C34 4C34 1D               4      DEC E
000C35 4C35 1D               4      DEC E
000C36 4C36 32F8F2          13      LD  (FDRV),A
       4C39                     DEVI1:
000C39 4C39 DD7E00          19      LD  A,(IX+0)
000C3C 4C3C D65C             7      SUB 05CH        ;\
000C3E 4C3E 2008            12      JR  NZ,NOROOT
000C40 4C40 6F               4      LD  L,A
000C41 4C41 67               4      LD  H,A
000C42 4C42 22F6F2          16      LD  (_CDX),HL
000C45 4C45 DD23            10      INC IX
000C47 4C47 1D               4      DEC E
       4C48                     NOROOT:
                                
       4C48                     SETDIR:
000C48 4C48 CD8A4C          17      CALL    FILED
000C4B 4C4B DD7E00          19      LD  A,(IX+0)
000C4E 4C4E FE5C             7      CP  05CH        ;\
000C50 4C50 C0              11      RET NZ
000C51 4C51 DD23            10      INC IX
000C53 4C53 1D               4      DEC E
000C54 4C54 3AF9F2          13      LD  A,(FNAME)
000C57 4C57 FE20             7      CP  020H        ;. の処理
000C59 4C59 28ED            12      JR  Z,SETDIR
                                
000C5B 4C5B CD794D          17      CALL    ROM_OPEN
000C5E 4C5E B7               4      OR  A
000C5F 4C5F C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000C60 4C60 D5              11      PUSH    DE
000C61 4C61 2AEDF2          16      LD  HL,(DIRENT1)
000C64 4C64 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000C67 4C67 19              11      ADD HL,DE
000C68 4C68 CDC344          17      CALL    RDSLT_ROM
000C6B 4C6B D1              10      POP DE
000C6C 4C6C CB67             8      BIT 4,A     ;ディレクトリ
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000C6E 4C6E C8              11      RET Z
000C6F 4C6F CDD14C          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
000C72 4C72 D5              11      PUSH    DE
000C73 4C73 2AEDF2          16      LD  HL,(DIRENT1)
000C76 4C76 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000C79 4C79 19              11      ADD HL,DE
000C7A 4C7A CDC344          17      CALL    RDSLT_ROM
000C7D 4C7D 23               6      INC HL
000C7E 4C7E 5F               4      LD  E,A
000C7F 4C7F CDC344          17      CALL    RDSLT_ROM
000C82 4C82 57               4      LD  D,A
000C83 4C83 EB               4      EX  DE,HL
000C84 4C84 D1              10      POP DE
                                #else
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
000C85 4C85 22F6F2          16      LD  (_CDX),HL
000C88 4C88 18BE            12      JR  SETDIR
                                
       4C8A                     FILED:
000C8A 4C8A CDD14C          17      CALL    FILEI
000C8D 4C8D 21F9F2          10      LD  HL,FNAME
                                
000C90 4C90 0608             7      LD  B,8
       4C92                     FILE2:
000C92 4C92 CDDE4C          17      CALL    CCHKF
000C95 4C95 C8              11      RET Z
000C96 4C96 FE2A             7      CP  '*'
000C98 4C98 282E            12      JR  Z,FILE9
000C9A 4C9A FE2E             7      CP  '.'
000C9C 4C9C 280C            12      JR  Z,FILE4
000C9E 4C9E 77               7      LD  (HL),A
000C9F 4C9F 23               6      INC HL
000CA0 4CA0 10F0            13      DJNZ    FILE2
                                
       4CA2                     FILE3:
000CA2 4CA2 CDDE4C          17      CALL    CCHKF
000CA5 4CA5 C8              11      RET Z
000CA6 4CA6 FE2E             7      CP  '.'
000CA8 4CA8 20F8            12      JR  NZ,FILE3
                                
       4CAA                     FILE4:
000CAA 4CAA 2101F3          10      LD  HL,FNAME+8
000CAD 4CAD 0603             7      LD  B,3
                                
       4CAF                     FILE4L:
000CAF 4CAF CDDE4C          17      CALL    CCHKF
000CB2 4CB2 C8              11      RET Z
000CB3 4CB3 FE2E             7      CP  '.'
000CB5 4CB5 2008            12      JR  NZ,FILE12
000CB7 4CB7 32F9F2          13      LD  (FNAME),A   ;Parent directory(..)
000CBA 4CBA 32FAF2          13      LD  (FNAME+1),A
000CBD 4CBD 3E20             7      LD  A,020H
       4CBF                     FILE12:
000CBF 4CBF FE2A             7      CP  '*'
000CC1 4CC1 280A            12      JR  Z,FILE10
000CC3 4CC3 77               7      LD  (HL),A
000CC4 4CC4 23               6      INC HL
000CC5 4CC5 10E8            13      DJNZ    FILE4L
000CC7 4CC7 C9              10      RET
                                
       4CC8                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000CC8 4CC8 CDCD4C          17      CALL    FILE10
000CCB 4CCB 18D5            12      JR  FILE3
                                
       4CCD                     FILE10:
000CCD 4CCD 3E3F             7      LD  A,'?'
000CCF 4CCF 1808            12      JR  FILL_MEMORY
       4CD1                     FILEI:              ;名前＋拡張子をスペースで初期化
000CD1 4CD1 3E20             7      LD  A,020H
000CD3 4CD3 01000B          10      LD  BC,11*256   ;C=0にしておく
000CD6 4CD6 21F9F2          10      LD  HL,FNAME
       4CD9                     FILL_MEMORY:            ;HLからBバイトAで埋める
000CD9 4CD9 77               7      LD  (HL),A
000CDA 4CDA 23               6      INC HL
000CDB 4CDB 10FC            13      DJNZ    FILL_MEMORY
000CDD 4CDD C9              10      RET
                                
       4CDE                     CCHKF:
000CDE 4CDE 7B               4      LD  A,E
000CDF 4CDF B7               4      OR  A
000CE0 4CE0 C8              11      RET Z
000CE1 4CE1 DD7E00          19      LD  A,(IX+0)
000CE4 4CE4 CDEB4C          17      CALL    CCHK2
000CE7 4CE7 C8              11      RET Z
000CE8 4CE8 C34E4D          10      JP  FKAN
                                
       4CEB                     CCHK2:
000CEB 4CEB 0C               4      INC C
000CEC 4CEC 0D               4      DEC C
000CED 4CED C0              11      RET NZ
       4CEE                     CCHK3:              ;ZF=1 で使えない文字
000CEE 4CEE FE2B             7      CP  '+'
000CF0 4CF0 C8              11      RET Z
000CF1 4CF1 FE2C             7      CP  ','
000CF3 4CF3 C8              11      RET Z
000CF4 4CF4 FE2F             7      CP  '/'
000CF6 4CF6 C8              11      RET Z
000CF7 4CF7 FE3A             7      CP  ':'
000CF9 4CF9 C8              11      RET Z
000CFA 4CFA FE3B             7      CP  ';'
000CFC 4CFC C8              11      RET Z
000CFD 4CFD FE3D             7      CP  '='
000CFF 4CFF C8              11      RET Z
000D00 4D00 FE5C             7      CP  05CH    ;\
000D02 4D02 C8              11      RET Z
000D03 4D03 FE1F             7      CP  01FH
000D05 4D05 D0              11      RET NC
000D06 4D06 BF               4      CP  A       ;Z=1
000D07 4D07 C9              10      RET
                                
       4D08                     SS1:
000D08 4D08 13               6      INC DE
       4D09                     SPCUT:              ;スペースをカット
000D09 4D09 1A               7      LD  A,(DE)
000D0A 4D0A FE20             7      CP  020H
000D0C 4D0C 28FA            12      JR  Z,SS1
000D0E 4D0E C9              10      RET
                                
       4D0F                     SCREOF1:
000D0F 4D0F 13               6      INC DE
       4D10                     SPCUTEX:            ;スペース改行などをカット
000D10 4D10 1A               7      LD  A,(DE)
000D11 4D11 FE20             7      CP  020H
000D13 4D13 28FA            12      JR  Z,SCREOF1
000D15 4D15 FE0D             7      CP  00DH
000D17 4D17 28F6            12      JR  Z,SCREOF1
000D19 4D19 FE0A             7      CP  00AH
000D1B 4D1B 28F2            12      JR  Z,SCREOF1
000D1D 4D1D FE1A             7      CP  01AH
000D1F 4D1F 28EE            12      JR  Z,SCREOF1
000D21 4D21 C9              10      RET
                                
       4D22                     GETNUM:
000D22 4D22 210000          10      LD  HL,0
       4D25                     GETNUM1:
000D25 4D25 1A               7      LD  A,(DE)
000D26 4D26 13               6      INC DE
000D27 4D27 D630             7      SUB '0'
000D29 4D29 D8              11      RET C
000D2A 4D2A FE0A             7      CP  10
000D2C 4D2C D0              11      RET NC
000D2D 4D2D 4D               4      LD  C,L
000D2E 4D2E 44               4      LD  B,H
000D2F 4D2F 29              11      ADD HL,HL   ;*2
000D30 4D30 29              11      ADD HL,HL   ;*4
000D31 4D31 09              11      ADD HL,BC   ;*5
000D32 4D32 29              11      ADD HL,HL   ;*10
000D33 4D33 4F               4      LD  C,A
000D34 4D34 0600             7      LD  B,0
000D36 4D36 09              11      ADD HL,BC
000D37 4D37 18EC            12      JR  GETNUM1
                                
       4D39                     SEARCH_END:
000D39 4D39 7E               7      LD  A,(HL)
       4D3A                     SEARCH_END1:
000D3A 4D3A 23               6      INC HL
000D3B 4D3B B7               4      OR  A
000D3C 4D3C C8              11      RET Z
000D3D 4D3D FE3A             7      CP  ':'
000D3F 4D3F 20F8            12      JR  NZ,SEARCH_END
000D41 4D41 7E               7      LD  A,(HL)
000D42 4D42 FE3A             7      CP  ':'
000D44 4D44 28F4            12      JR  Z,SEARCH_END1
000D46 4D46 C9              10      RET
                                
       4D47                     FKANC:
000D47 4D47 CB41             8      BIT 0,C
000D49 4D49 CC6C4D          17      CALL    Z,CAP2
000D4C 4D4C 1803            12      JR  FKANX
       4D4E                     FKAN:           ;漢字チェック
000D4E 4D4E DD23            10      INC IX
000D50 4D50 1D               4      DEC E
       4D51                     FKANX:
000D51 4D51 CB41             8      BIT 0,C
000D53 4D53 CB81             8      RES 0,C
000D55 4D55 C0              11      RET NZ
000D56 4D56 FE80             7      CP  080H
000D58 4D58 D8              11      RET C
000D59 4D59 FEA0             7      CP  0A0H
000D5B 4D5B 3803            12      JR  C,FKAN1
000D5D 4D5D FEE0             7      CP  0E0H
000D5F 4D5F D8              11      RET C
       4D60                     FKAN1:
000D60 4D60 0C               4      INC C
000D61 4D61 A7               4      AND A
000D62 4D62 C9              10      RET
                                
       4D63                     CAP:
000D63 4D63 FE61             7      CP  'a'
000D65 4D65 D8              11      RET C
000D66 4D66 FE7B             7      CP  'z'+1
000D68 4D68 D0              11      RET NC
000D69 4D69 D620             7      SUB 020H
000D6B 4D6B C9              10      RET
       4D6C                     CAP2:
000D6C 4D6C CD634D          17      CALL    CAP
       4D6F                     CAP3:               ;
000D6F 4D6F FE05             7      CP  5
000D71 4D71 2803            12      JR  Z,CAP4
000D73 4D73 FE21             7      CP  021H
000D75 4D75 C9              10      RET
       4D76                     CAP4:
000D76 4D76 3EE5             7      LD  A,0E5H
000D78 4D78 C9              10      RET
                                
       4D79                     ROM_OPEN:
000D79 4D79 CD7B54          17      CALL    GET_DISK_BANK_FDRV
                                
000D7C 4D7C CDD54F          17      CALL    GET_DIR_DAT
000D7F 4D7F D5              11      PUSH    DE
000D80 4D80 CD954D          17      CALL    FILESE
000D83 4D83 D1              10      POP DE
000D84 4D84 3F               4      CCF
000D85 4D85 D8              11      RET C
000D86 4D86 22EDF2          16      LD  (DIRENT1),HL
000D89 4D89 E5              11      PUSH    HL
000D8A 4D8A 210000          10      LD  HL,0
000D8D 4D8D 22CAF2          16      LD  (RR_LOW),HL
000D90 4D90 22CCF2          16      LD  (RR_HIGH),HL
000D93 4D93 E1              10      POP HL
000D94 4D94 C9              10      RET
                                
       4D95                     FILESE:
       4D95                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
000D95 4D95 CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000D98 4D98 B7               4      OR  A
000D99 4D99 C8              11      RET Z       ;END:ZF=1 CF=0
000D9A 4D9A FEE5             7      CP  0E5H
000D9C 4D9C 280D            12      JR  Z,FILESE1
000D9E 4D9E 11F9F2          10      LD  DE,FNAME
000DA1 4DA1 E5              11      PUSH    HL
000DA2 4DA2 CDD14D          17      CALL    CPFILE
000DA5 4DA5 CCF44D          17      CALL    Z,CPFILE2
000DA8 4DA8 E1              10      POP HL
000DA9 4DA9 37               4      SCF
000DAA 4DAA C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4DAB                     FILESE1:
000DAB 4DAB CDB34D          17      CALL    FNEXT
000DAE 4DAE 20E5            12      JR  NZ,FILESE0
000DB0 4DB0 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000DB2 4DB2 C9              10      RET
                                
       4DB3                     FNEXT:
000DB3 4DB3 112000          10      LD  DE,020H
000DB6 4DB6 19              11      ADD HL,DE
000DB7 4DB7 ED5BF6F2        20      LD  DE,(_CDX)
000DBB 4DBB 7A               4      LD  A,D
000DBC 4DBC B3               4      OR  E
000DBD 4DBD 2002            12      JR  NZ,FNEXT_SUBDIR
000DBF 4DBF 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000DC0 4DC0 C9              10      RET
                                
       4DC1                     FNEXT_SUBDIR:           ;サブディレクトリ
000DC1 4DC1 0D               4      DEC C
000DC2 4DC2 C0              11      RET NZ
                                
000DC3 4DC3 ED5BF6F2        20      LD  DE,(_CDX)
000DC7 4DC7 CD074F          17      CALL    GNCL
000DCA 4DCA EB               4      EX  DE,HL
000DCB 4DCB 22F6F2          16      LD  (_CDX),HL
000DCE 4DCE C30E50          10      JP  GET_SUBDIR
                                
       4DD1                     CPFILE:
000DD1 4DD1 C5              11      PUSH    BC
000DD2 4DD2 01000B          10      LD  BC,00B00H
       4DD5                     CPSTR1:
000DD5 4DD5 1A               7      LD  A,(DE)
000DD6 4DD6 FE3F             7      CP  '?'     ;Wild card
000DD8 4DD8 2814            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
000DDA 4DDA CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000DDD 4DDD CD474D          17      CALL    FKANC
000DE0 4DE0 E5              11      PUSH    HL
000DE1 4DE1 67               4      LD  H,A
000DE2 4DE2 1A               7      LD  A,(DE)
000DE3 4DE3 CB01             8      RLC C
000DE5 4DE5 CD474D          17      CALL    FKANC
000DE8 4DE8 CB09             8      RRC C
000DEA 4DEA BC               4      CP  H       ;CP (HL),(DE)
000DEB 4DEB E1              10      POP HL
000DEC 4DEC 2004            12      JR  NZ,CPSTR3
       4DEE                     CPSTR2:
000DEE 4DEE 13               6      INC DE
000DEF 4DEF 23               6      INC HL
000DF0 4DF0 10E3            13      DJNZ    CPSTR1
       4DF2                     CPSTR3:
000DF2 4DF2 C1              10      POP BC
000DF3 4DF3 C9              10      RET
                                
       4DF4                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
000DF4 4DF4 CDC344          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000DF7 4DF7 E608             7      AND 008H    ;~0F7H
000DF9 4DF9 C9              10      RET
                                
       4DFA                     RBX1:
000DFA 4DFA E5              11      PUSH    HL      ;Record byte
                                
000DFB 4DFB ED5BCAF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000DFF 4DFF 3ACDF2          13      LD  A,(RR_HIGH+1)
000E02 4E02 4F               4      LD  C,A
                                
000E03 4E03 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000E06 4E06 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
000E09 4E09 D5              11      PUSH    DE
000E0A 4E0A 2AEDF2          16      LD  HL,(DIRENT1)
000E0D 4E0D 111C00          10      LD  DE,0001CH
000E10 4E10 19              11      ADD HL,DE
000E11 4E11 CDC344          17      CALL    RDSLT_ROM
000E14 4E14 23               6      INC HL
000E15 4E15 5F               4      LD  E,A
000E16 4E16 CDC344          17      CALL    RDSLT_ROM
000E19 4E19 23               6      INC HL
000E1A 4E1A 57               4      LD  D,A
000E1B 4E1B CDC344          17      CALL    RDSLT_ROM
000E1E 4E1E EB               4      EX  DE,HL       ;AHL=File size
000E1F 4E1F D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
                                
000E20 4E20 A7               4      AND A
000E21 4E21 ED52            15      SBC HL,DE
000E23 4E23 99               4      SBC A,C
000E24 4E24 D1              10      POP DE
                                
000E25 4E25 D8              11      RET C
000E26 4E26 4F               4      LD  C,A
000E27 4E27 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000E28 4E28 B2               4      OR  D
000E29 4E29 B3               4      OR  E
000E2A 4E2A C0              11      RET NZ
000E2B 4E2B 37               4      SCF
000E2C 4E2C C9              10      RET
                                
       4E2D                     RBX2:
000E2D 4E2D ED4BCBF2        20      LD  BC,(RR_LOW+1)
000E31 4E31 CDB24E          17      CALL    RWXR
000E34 4E34 3AC7F2          13      LD  A,(CLSZ_H)
000E37 4E37 3D               4      DEC A
000E38 4E38 E5              11      PUSH    HL
000E39 4E39 2ACAF2          16      LD  HL,(RR_LOW)
000E3C 4E3C A4               4      AND H
000E3D 4E3D B5               4      OR  L
000E3E 4E3E E1              10      POP HL
000E3F 4E3F C9              10      RET
                                
       4E40                     RBXA:
000E40 4E40 D5              11      PUSH    DE
000E41 4E41 CD2A4F          17      CALL    CLUST
000E44 4E44 ED53D2F2        20      LD  (_DTPS),DE
000E48 4E48 D1              10      POP DE
000E49 4E49 CD074F          17      CALL    GNCL
000E4C 4E4C D8              11      RET C
000E4D 4E4D ED53CEF2        20      LD  (_CLPS),DE
                                
000E51 4E51 ED4BCAF2        20      LD  BC,(RR_LOW)
000E55 4E55 2AC6F2          16      LD  HL,(CLSZ)
000E58 4E58 7C               4      LD  A,H
000E59 4E59 3D               4      DEC A
000E5A 4E5A A0               4      AND B
000E5B 4E5B 47               4      LD  B,A
000E5C 4E5C ED42            15      SBC HL,BC       ;remaining cluster
                                
000E5E 4E5E ED5BF0F2        20      LD  DE,(LEFTX)
000E62 4E62 ED52            15      SBC HL,DE       ;CP HL,DE
000E64 4E64 19              11      ADD HL,DE
000E65 4E65 3801            12      JR  C,RBXA1
000E67 4E67 EB               4      EX  DE,HL
       4E68                     RBXA1:
000E68 4E68 3AC4F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
000E6B 4E6B 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000E6E 4E6E E5              11      PUSH    HL
000E6F 4E6F 2AD2F2          16      LD  HL,(_DTPS)
000E72 4E72 09              11      ADD HL,BC
000E73 4E73 ED5BE7F2        20      LD  DE,(DTAX)
000E77 4E77 C1              10      POP BC
000E78 4E78 C9              10      RET
                                
       4E79                     RBXB:
000E79 4E79 2AE7F2          16      LD  HL,(DTAX)
000E7C 4E7C ED5BCEF2        20      LD  DE,(_CLPS)
000E80 4E80 3AF1F2          13      LD  A,(LEFTX+1)
000E83 4E83 47               4      LD  B,A
000E84 4E84 3AC7F2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4E87                     RBXB1:
000E87 4E87 1F               4      RRA     ;->CF
000E88 4E88 3804            12      JR  C,RBXB2
000E8A 4E8A CB38             8      SRL B   ;B=B/2
000E8C 4E8C 18F9            12      JR  RBXB1
       4E8E                     RBXB2:
000E8E 4E8E 78               4      LD  A,B
000E8F 4E8F B7               4      OR  A
000E90 4E90 C9              10      RET
                                
       4E91                     RBXC:
000E91 4E91 ED4BF0F2        20      LD  BC,(LEFTX)
000E95 4E95 3AC7F2          13      LD  A,(CLSZ_H)
000E98 4E98 3D               4      DEC A
000E99 4E99 A0               4      AND B
000E9A 4E9A 47               4      LD  B,A
000E9B 4E9B B1               4      OR  C
000E9C 4E9C C9              10      RET
                                
       4E9D                     RBXEND:
000E9D 4E9D ED5BD0F2        20      LD  DE,(_LEFT)
000EA1 4EA1 2ACAF2          16      LD  HL,(RR_LOW)
000EA4 4EA4 3ACDF2          13      LD  A,(RR_HIGH+1)
000EA7 4EA7 19              11      ADD HL,DE
000EA8 4EA8 CE00             7      ADC A,0
000EAA 4EAA 22CAF2          16      LD  (RR_LOW),HL
000EAD 4EAD 32CDF2          13      LD  (RR_HIGH+1),A
000EB0 4EB0 EB               4      EX  DE,HL       ;HL=Read byte
000EB1 4EB1 C9              10      RET 
                                
       4EB2                     RWXR:
000EB2 4EB2 3AC7F2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4EB5                     L_RWX:
000EB5 4EB5 1F               4      RRA     ;->CF
000EB6 4EB6 3806            12      JR  C,E_RWX
000EB8 4EB8 CB38             8      SRL B   ;BC=BC/2
000EBA 4EBA CB19             8      RR  C   ;
000EBC 4EBC 18F7            12      JR  L_RWX
       4EBE                     E_RWX:
000EBE 4EBE 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000EC1 4EC1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
000EC4 4EC4 E5              11      PUSH    HL
000EC5 4EC5 2AEDF2          16      LD  HL,(DIRENT1)
000EC8 4EC8 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000ECB 4ECB 19              11      ADD HL,DE
000ECC 4ECC CDC344          17      CALL    RDSLT_ROM
000ECF 4ECF 23               6      INC HL
000ED0 4ED0 5F               4      LD  E,A
000ED1 4ED1 CDC344          17      CALL    RDSLT_ROM
000ED4 4ED4 23               6      INC HL
000ED5 4ED5 57               4      LD  D,A
000ED6 4ED6 E1              10      POP HL
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  E,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  D,(IY+01BH)
                                #endif
000ED7 4ED7 CD7B54          17      CALL    GET_DISK_BANK_FDRV
       4EDA                     RWX1:
000EDA 4EDA ED53CEF2        20      LD  (_CLPS),DE
000EDE 4EDE 7A               4      LD  A,D
000EDF 4EDF B3               4      OR  E
000EE0 4EE0 37               4      SCF
000EE1 4EE1 C8              11      RET Z
                                
000EE2 4EE2 78               4      LD  A,B
000EE3 4EE3 B1               4      OR  C
000EE4 4EE4 C8              11      RET Z
                                
000EE5 4EE5 CD074F          17      CALL    GNCL
000EE8 4EE8 D8              11      RET C
000EE9 4EE9 0B               6      DEC BC
000EEA 4EEA CD6E4F          17      CALL    ENDCL
000EED 4EED 38EB            12      JR  C,RWX1
000EEF 4EEF 37               4      SCF
000EF0 4EF0 C9              10      RET
                                
       4EF1                     NCL3:
000EF1 4EF1 CD7B54          17      CALL    GET_DISK_BANK_FDRV
000EF4 4EF4 6B               4      LD  L,E
000EF5 4EF5 62               4      LD  H,D
000EF6 4EF6 CB3C             8      SRL H
000EF8 4EF8 CB1D             8      RR  L
000EFA 4EFA 1F               4      RRA
000EFB 4EFB 19              11      ADD HL,DE
000EFC 4EFC 010060          10      LD  BC,BANK1_ADR
000EFF 4EFF 09              11      ADD HL,BC
000F00 4F00 ED4BC8F2        20      LD  BC,(SECSZ)
000F04 4F04 09              11      ADD HL,BC
000F05 4F05 17               4      RLA
000F06 4F06 C9              10      RET
                                
       4F07                     GNCL:
000F07 4F07 7A               4      LD  A,D
000F08 4F08 B3               4      OR  E
000F09 4F09 37               4      SCF
000F0A 4F0A C8              11      RET Z
000F0B 4F0B C5              11      PUSH    BC
000F0C 4F0C E5              11      PUSH    HL
000F0D 4F0D CDF14E          17      CALL    NCL3
000F10 4F10 3809            12      JR  C,GNC1
000F12 4F12 5E               7      LD  E,(HL)
000F13 4F13 23               6      INC HL
000F14 4F14 7E               7      LD  A,(HL)
000F15 4F15 E60F             7      AND 00FH
000F17 4F17 57               4      LD  D,A
000F18 4F18 E1              10      POP HL
000F19 4F19 C1              10      POP BC
000F1A 4F1A C9              10      RET
       4F1B                     GNC1:
000F1B 4F1B 7E               7      LD  A,(HL)
000F1C 4F1C 23               6      INC HL
000F1D 4F1D 56               7      LD  D,(HL)
000F1E 4F1E 0604             7      LD  B,4
       4F20                     GNC1L:
000F20 4F20 CB3A             8      SRL D
000F22 4F22 1F               4      RRA
000F23 4F23 10FB            13      DJNZ    GNC1L
                                
000F25 4F25 5F               4      LD  E,A
000F26 4F26 E1              10      POP HL
000F27 4F27 C1              10      POP BC
000F28 4F28 A7               4      AND A
000F29 4F29 C9              10      RET
                                
       4F2A                     CLUST:
000F2A 4F2A EB               4      EX  DE,HL
       4F2B                     CLUST_HL:
000F2B 4F2B 2B               6      DEC HL
000F2C 4F2C 2B               6      DEC HL
000F2D 4F2D C5              11      PUSH    BC
000F2E 4F2E 3AC7F2          13      LD  A,(CLSZ_H)
000F31 4F31 CDA854          17      CALL    MUL_AHL
                                
000F34 4F34 CDEF4F          17      CALL    GET_DIR_POS
000F37 4F37 4F               4      LD  C,A
000F38 4F38 0600             7      LD  B,0
000F3A 4F3A 09              11      ADD HL,BC
                                
000F3B 4F3B ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000F3F 4F3F CB38             8      SRL B
000F41 4F41 CB19             8      RR  C           ;/2
000F43 4F43 CB38             8      SRL B
000F45 4F45 CB19             8      RR  C           ;/4
000F47 4F47 CB38             8      SRL B
000F49 4F49 CB19             8      RR  C           ;/8
000F4B 4F4B 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
000F4C 4F4C 7D               4      LD  A,L
000F4D 4F4D 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000F50 4F50 09              11      ADD HL,BC
000F51 4F51 3013            12      JR  NC,CLUST2
000F53 4F53 4D               4      LD  C,L     ;C=読み出し元
000F54 4F54 29              11      ADD HL,HL   ;64KB→32KB
000F55 4F55 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000F56 4F56 CD7B54          17      CALL    GET_DISK_BANK_FDRV
000F59 4F59 84               4      ADD A,H
000F5A 4F5A 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000F5D 4F5D 32C4F2          13      LD  (_BANK),A
000F60 4F60 69               4      LD  L,C     ;C=読み出し元
000F61 4F61 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000F63 4F63 A5               4      AND L
000F64 4F64 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4F66                     CLUST2:
000F66 4F66 C660             7      ADD A,high BANK1_ADR
000F68 4F68 67               4      LD  H,A
000F69 4F69 2E00             7      LD  L,0
000F6B 4F6B EB               4      EX  DE,HL
000F6C 4F6C C1              10      POP BC
000F6D 4F6D C9              10      RET
                                
       4F6E                     ENDCL:
000F6E 4F6E 7A               4      LD  A,D ;END CLUSTER
000F6F 4F6F FE0F             7      CP  00FH    ;FAT12の最大値
000F71 4F71 C0              11      RET NZ
000F72 4F72 7B               4      LD  A,E
000F73 4F73 FEF7             7      CP  0F7H
000F75 4F75 C9              10      RET
                                
       4F76                     RB_READ:
000F76 4F76 AF               4      XOR A   ;HLA = HL*128
000F77 4F77 CB3C             8      SRL H
000F79 4F79 CB1D             8      RR  L
000F7B 4F7B 1F               4      RRA
000F7C 4F7C 32CAF2          13      LD  (RR_LOW),A
000F7F 4F7F 22CBF2          16      LD  (RR_MID),HL
000F82 4F82 218000          10      LD  HL,128
                                
000F85 4F85 CD464B          17      CALL    ROM_READ
000F88 4F88 C9              10      RET
                                
       4F89                     GETSEQ:
000F89 4F89 FD6E20          19      LD  L,(IY+32)
000F8C 4F8C FD660C          19      LD  H,(IY+12)
                                
000F8F 4F8F CB25             8      SLA L
                                
000F91 4F91 CB3C             8      SRL H
000F93 4F93 CB1D             8      RR  L
000F95 4F95 C9              10      RET
                                
       4F96                     SETSEQ:
000F96 4F96 F5              11      PUSH    AF
000F97 4F97 3ACAF2          13      LD  A,(RR_LOW)
000F9A 4F9A 2ACBF2          16      LD  HL,(RR_MID)
                                
000F9D 4F9D CDB44F          17      CALL    SSQ1
                                
000FA0 4FA0 29              11      ADD HL,HL
000FA1 4FA1 CB3D             8      SRL L
000FA3 4FA3 FD7520          19      LD  (IY+32),L
000FA6 4FA6 FD740C          19      LD  (IY+12),H
000FA9 4FA9 F1              10      POP AF
000FAA 4FAA C9              10      RET
                                
       4FAB                     GETSIZE:
000FAB 4FAB FD7E10          19      LD  A,(IY+16)
000FAE 4FAE FD6E11          19      LD  L,(IY+17)
000FB1 4FB1 FD6612          19      LD  H,(IY+18)
       4FB4                     SSQ1:
000FB4 4FB4 87               4      ADD A,A
000FB5 4FB5 ED6A            15      ADC HL,HL
000FB7 4FB7 B7               4      OR  A
000FB8 4FB8 C8              11      RET Z
000FB9 4FB9 23               6      INC HL
000FBA 4FBA C9              10      RET
                                
       4FBB                     SET_FCB:
000FBB 4FBB D5              11      PUSH    DE
000FBC 4FBC FDE1            14      POP IY
000FBE 4FBE FD7E1C          19      LD  A,(IY+28)
000FC1 4FC1 FEFF             7      CP  0FFH
000FC3 4FC3 200C            12      JR  NZ,POPAF_SCF_FF_RET
000FC5 4FC5 E5              11      PUSH    HL
000FC6 4FC6 FD6E1A          19      LD  L,(IY+26)
000FC9 4FC9 FD661B          19      LD  H,(IY+27)
000FCC 4FCC 22CEF2          16      LD  (_CLPS),HL
000FCF 4FCF E1              10      POP HL
000FD0 4FD0 C9              10      RET
                                
       4FD1                     POPAF_SCF_FF_RET:
000FD1 4FD1 F1              10      POP AF
000FD2 4FD2 37               4      SCF
000FD3 4FD3 9F               4      SBC A,A
000FD4 4FD4 C9              10      RET
                                
       4FD5                     GET_DIR_DAT:
000FD5 4FD5 2AF6F2          16      LD  HL,(_CDX)
000FD8 4FD8 7C               4      LD  A,H
000FD9 4FD9 B5               4      OR  L
000FDA 4FDA 2032            12      JR  NZ,GET_SUBDIR
000FDC 4FDC CDEF4F          17      CALL    GET_DIR_POS
000FDF 4FDF C660             7      ADD A,high BANK1_ADR
000FE1 4FE1 2E00             7      LD  L,0
000FE3 4FE3 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000FE4 4FE4 3AC5F2          13      LD  A,(_BANK1)
000FE7 4FE7 32EFF2          13      LD  (_DIR_BANK),A
                                
000FEA 4FEA 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000FED 4FED 4F               4      LD  C,A
000FEE 4FEE C9              10      RET
                                
       4FEF                     GET_DIR_POS:                ;ルートディレクトリ
000FEF 4FEF CD7B54          17      CALL    GET_DISK_BANK_FDRV
000FF2 4FF2 32C5F2          13      LD  (_BANK1),A
000FF5 4FF5 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000FF8 4FF8 47               4      LD  B,A
000FF9 4FF9 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000FFC 4FFC 4F               4      LD  C,A
000FFD 4FFD 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       5000                     GET_DIR_POS1:
001000 5000 81               4      ADD A,C
001001 5001 10FD            13      DJNZ    GET_DIR_POS1
                                
001003 5003 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
001007 5007 37               4      SCF     ;無限ループ回避
       5008                     L_MDP:
001008 5008 CB18             8      RR  B   ;->CF
00100A 500A D8              11      RET C
00100B 500B 87               4      ADD A,A
00100C 500C 18FA            12      JR  L_MDP
                                
       500E                     GET_SUBDIR:             ;サブディレクトリ
00100E 500E CD2B4F          17      CALL    CLUST_HL
001011 5011 EB               4      EX  DE,HL
001012 5012 3AC4F2          13      LD  A,(_BANK)
001015 5015 32EFF2          13      LD  (_DIR_BANK),A
001018 5018 3AC7F2          13      LD  A,(CLSZ_H)
00101B 501B 87               4      ADD A,A     ;*2
00101C 501C 87               4      ADD A,A     ;*4
00101D 501D 87               4      ADD A,A     ;*8
00101E 501E 4F               4      LD  C,A
00101F 501F C9              10      RET
                                
       5020                     STATEMENT:
001020 5020 118D52          10      LD  DE,STR_CHDIR
001023 5023 CD7352          17      CALL    CPPROCNM
001026 5026 2812            12      JR  Z,_CHDIR
001028 5028 119352          10      LD  DE,STR_CHDRV
00102B 502B CD7352          17      CALL    CPPROCNM
00102E 502E 281C            12      JR  Z,_CHDRV
001030 5030 119952          10      LD  DE,STR_RAMDISK
001033 5033 CD7352          17      CALL    CPPROCNM
001036 5036 2829            12      JR  Z,_RAMDISK
001038 5038 37               4      SCF
001039 5039 C9              10      RET
       503A                     _CHDIR:
00103A 503A 7E               7      LD  A,(HL)
00103B 503B FE28             7      CP  '('
00103D 503D 37               4      SCF
00103E 503E C0              11      RET NZ
00103F 503F CDF448          17      CALL    INIT_PARAM
001042 5042 CDE74B          17      CALL    FILE_B
001045 5045 CD7550          17      CALL    ROM_CD
001048 5048 D0              11      RET NC
001049 5049 C39747          10      JP  ERROR_FILE_NOT_FOUND
                                
       504C                     _CHDRV:
00104C 504C 7E               7      LD  A,(HL)
00104D 504D FE28             7      CP  '('
00104F 504F 37               4      SCF
001050 5050 C0              11      RET NZ
001051 5051 CDF448          17      CALL    INIT_PARAM
001054 5054 E5              11      PUSH    HL
001055 5055 CDE74B          17      CALL    FILE_B
001058 5058 E1              10      POP HL
001059 5059 23               6      INC HL
00105A 505A 3AF8F2          13      LD  A,(FDRV)
00105D 505D 3D               4      DEC A
00105E 505E C34E57          10      JP  _SYS0EX1
                                
       5061                     _RAMDISK:
001061 5061 7E               7      LD  A,(HL)
001062 5062 FE28             7      CP  '('
001064 5064 37               4      SCF
001065 5065 C0              11      RET NZ
001066 5066 23               6      INC HL
001067 5067 DD212F54        14      LD  IX,FRMQNT
00106B 506B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00106F 506F CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
                                ;   LD  A,D
                                ;   OR  E
                                ;   JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   XOR A
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
001072 5072 23               6      INC HL
001073 5073 AF               4      XOR A
001074 5074 C9              10      RET
                                
       5075                     ROM_CD:
001075 5075 3AF9F2          13      LD  A,(FNAME)
001078 5078 FE20             7      CP  020H
00107A 507A 2835            12      JR  Z,CD1
00107C 507C CD794D          17      CALL    ROM_OPEN
00107F 507F D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
001080 5080 D5              11      PUSH    DE
001081 5081 2AEDF2          16      LD  HL,(DIRENT1)
001084 5084 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
001087 5087 19              11      ADD HL,DE
001088 5088 CDC344          17      CALL    RDSLT_ROM
00108B 508B D1              10      POP DE
00108C 508C CB67             8      BIT 4,A     ;ディレクトリ
00108E 508E CA9747          10      JP  Z,ERROR_FILE_NOT_FOUND
001091 5091 D5              11      PUSH    DE
001092 5092 2AEDF2          16      LD  HL,(DIRENT1)
001095 5095 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
001098 5098 19              11      ADD HL,DE
001099 5099 CDC344          17      CALL    RDSLT_ROM
00109C 509C 23               6      INC HL
00109D 509D 5F               4      LD  E,A
00109E 509E CDC344          17      CALL    RDSLT_ROM
0010A1 50A1 57               4      LD  D,A
0010A2 50A2 EB               4      EX  DE,HL
0010A3 50A3 D1              10      POP DE
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
       50A4                     CD2:
0010A4 50A4 22EBF2          16      LD  (_CD),HL
0010A7 50A7 2AF4F2          16      LD  HL,(PARAM1)
       50AA                     CD_SKIP:
0010AA 50AA 7E               7      LD  A,(HL)
0010AB 50AB 23               6      INC HL
0010AC 50AC FE21             7      CP  021H
0010AE 50AE 38FA            12      JR  C,CD_SKIP
0010B0 50B0 C9              10      RET
       50B1                     CD1:
0010B1 50B1 2AF6F2          16      LD  HL,(_CDX)
0010B4 50B4 18EE            12      JR  CD2
                                
       50B6                     GET_BASIC_FCB:
0010B6 50B6 D5              11      PUSH    DE
0010B7 50B7 23               6      INC HL  ;+1
0010B8 50B8 5E               7      LD  E,(HL)  ;FCB[1]
0010B9 50B9 23               6      INC HL  ;+2
0010BA 50BA 56               7      LD  D,(HL)  ;FCB[2]
0010BB 50BB 23               6      INC HL  ;+3
0010BC 50BC ED53EDF2        20      LD  (DIRENT1),DE
                                            ;FCB[3] backup char
0010C0 50C0 23               6      INC HL  ;+4
                                            ;FCB[4]
0010C1 50C1 23               6      INC HL  ;+5
0010C2 50C2 7E               7      LD  A,(HL)  ;FCB[5]
0010C3 50C3 23               6      INC HL  ;+6
0010C4 50C4 32EFF2          13      LD  (_DIR_BANK),A
0010C7 50C7 5E               7      LD  E,(HL)  ;FCB[6]
0010C8 50C8 23               6      INC HL  ;+7
0010C9 50C9 56               7      LD  D,(HL)  ;FCB[7]
0010CA 50CA 23               6      INC HL  ;+8
0010CB 50CB ED53CAF2        20      LD  (RR_LOW),DE
0010CF 50CF 7E               7      LD  A,(HL)  ;FCB[8]
0010D0 50D0 23               6      INC HL  ;+9
0010D1 50D1 32CCF2          13      LD  (RR_HIGH),A
0010D4 50D4 22D4F2          16      LD  (_DTA),HL   ;FCB[9]
0010D7 50D7 D1              10      POP DE
0010D8 50D8 C9              10      RET
                                
       50D9                     SET_BASIC_FCB:
0010D9 50D9 E5              11      PUSH    HL
0010DA 50DA 2A64F8          16      LD  HL,(PTRFIL)
0010DD 50DD 23               6      INC HL  ;+1
0010DE 50DE D5              11      PUSH    DE
0010DF 50DF ED5BEDF2        20      LD  DE,(DIRENT1)
0010E3 50E3 73               7      LD  (HL),E  ;FCB[1]
0010E4 50E4 23               6      INC HL  ;+2
0010E5 50E5 72               7      LD  (HL),D  ;FCB[2]
0010E6 50E6 23               6      INC HL  ;+3
0010E7 50E7 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
0010E8 50E8 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
0010E9 50E9 23               6      INC HL  ;+5
0010EA 50EA 3AEFF2          13      LD  A,(_DIR_BANK)
0010ED 50ED 77               7      LD  (HL),A  ;FCB[5]
0010EE 50EE 23               6      INC HL  ;+6
0010EF 50EF ED5BCAF2        20      LD  DE,(RR_LOW)
0010F3 50F3 73               7      LD  (HL),E  ;FCB[6]
0010F4 50F4 23               6      INC HL  ;+7
0010F5 50F5 72               7      LD  (HL),D  ;FCB[7]
0010F6 50F6 23               6      INC HL  ;+8
0010F7 50F7 3ACCF2          13      LD  A,(RR_HIGH)
0010FA 50FA 77               7      LD  (HL),A  ;FCB[8]
0010FB 50FB D1              10      POP DE
0010FC 50FC E1              10      POP HL
0010FD 50FD C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_18:BACKUP
                                ;in
                                ;   C : backup charactor
                                ;   HL: FBC pointer
                                ;out
       50FE                     DEVICE_18_BACKUP:
0010FE 50FE D5              11      PUSH    DE
0010FF 50FF E5              11      PUSH    HL
001100 5100 110300          10      LD  DE,3
001103 5103 19              11      ADD HL,DE
001104 5104 71               7      LD  (HL),C
001105 5105 E1              10      POP HL
001106 5106 D1              10      POP DE
001107 5107 C9              10      RET
                                
       5108                     DEVICE_CHECK:
001108 5108 3A8AFD          13      LD  A,(PROCNM+1)
00110B 510B B7               4      OR  A
00110C 510C C8              11      RET Z
00110D 510D 11A152          10      LD  DE,STR_ROM
001110 5110 CD7352          17      CALL    CPPROCNM
001113 5113 2802            12      JR  Z,DEVICE_OK
001115 5115 37               4      SCF
001116 5116 C9              10      RET
       5117                     DEVICE_OK:
001117 5117 AF               4      XOR A
001118 5118 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファ
                                
       5119                     DEVICE_0_OPEN:
001119 5119 7B               4      LD  A,E
00111A 511A FE02             7      CP  2       ;FOR OUTPUT
00111C 511C 281B            12      JR  Z,OPEN2
00111E 511E D5              11      PUSH    DE
00111F 511F E5              11      push    hl
                                ;
001120 5120 3E01             7      LD  A,1     ;ドライブA
001122 5122 32F8F2          13      LD  (FDRV),A
001125 5125 2166F8          10      LD  HL,FILNAM
001128 5128 11F9F2          10      LD  DE,FNAME
00112B 512B 010B00          10      LD  BC,8+3
00112E 512E CDCC58          17      CALL    INIT_FILE1
001131 5131 CD794D          17      CALL    ROM_OPEN
001134 5134 DA9747          10      JP  C,ERROR_FILE_NOT_FOUND
001137 5137 E1              10      pop hl
001138 5138 D1              10      POP DE
       5139                     OPEN2:
001139 5139 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
00113C 513C 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
00113D 513D AF               4      XOR A
00113E 513E 32F0F2          13      LD  (LEFTX),A
001141 5141 CDD950          17      CALL    SET_BASIC_FCB
001144 5144 7B               4      ld  a,e
001145 5145 FE08             7      cp  8
001147 5147 3F               4      ccf
001148 5148 C9              10      ret
                                
       5149                     DEVICE_2_CLOSE:
001149 5149 AF               4      XOR A
                                ;   LD  (HL),A
00114A 514A 6F               4      LD  L,A
00114B 514B 67               4      LD  H,A
00114C 514C 2264F8          16      LD  (PTRFIL),HL
00114F 514F C9              10      RET
                                
       5150                     DEVICE_ENTRY:
001150 5150 FE08             7      CP  8
001152 5152 2826            12      JR  Z,DEVICE_8_SIN
001154 5154 3C               4      INC A
001155 5155 28B1            12      JR  Z,DEVICE_CHECK:
001157 5157 3D               4      DEC A
001158 5158 28BF            12      JR  Z,DEVICE_0_OPEN
00115A 515A FE0E             7      CP  14
00115C 515C 2860            12      JR  Z,DEVICE_14_EOF
00115E 515E FE04             7      CP  4
001160 5160 2834            12      JR  Z,DEVICE_4_RANDOM
001162 5162 FE0A             7      CP  10
001164 5164 2850            12      JR  Z,DEVICE_10_LOC
001166 5166 FE0C             7      CP  12
001168 5168 2878            12      JR  Z,DEVICE_12_LOF
00116A 516A FE02             7      CP  2
00116C 516C 2890            12      JR  Z,DEVICE_18_BACKUP  
00116E 516E FE02             7      CP  2
001170 5170 28D7            12      JR  Z,DEVICE_2_CLOSE
001172 5172 FE06             7      CP  6
001174 5174 2802            12      JR  Z,DEVICE_6_SOUT
001176 5176 37               4      SCF
001177 5177 C9              10      RET
                                
       5178                     DEVICE_6_SOUT:
001178 5178 AF               4      XOR A
001179 5179 C9              10      RET
                                
       517A                     DEVICE_8_SIN:
00117A 517A CDB650          17      CALL    GET_BASIC_FCB
00117D 517D 210100          10      LD  HL,1
001180 5180 CD464B          17      CALL    ROM_READ
001183 5183 7C               4      LD  A,H
001184 5184 B5               4      OR  L
001185 5185 280D            12      JR  Z,CCF_RET
001187 5187 2AD4F2          16      LD  HL,(_DTA)
00118A 518A 7E               7      LD  A,(HL)
00118B 518B F5              11      PUSH    AF
00118C 518C CDD950          17      CALL    SET_BASIC_FCB
00118F 518F F1              10      POP AF
001190 5190 FE0A             7      CP  00AH
001192 5192 C8              11      RET Z   ;ZF=separate
                                ;   CP  01AH
                                ;   JR  Z,SCF_RET
001193 5193 37               4      SCF     ;
       5194                     CCF_RET:
001194 5194 3F               4      CCF     ;ZF=0 CF=0にしたい
001195 5195 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_4:RANDOM
                                ;in
                                ;   A : 4
                                ;   unknown
                                ;out
                                ;   unknown
                                ;note:
       5196                     DEVICE_4_RANDOM:
001196 5196 D5              11      PUSH    DE
001197 5197 CDB650          17      CALL    GET_BASIC_FCB
00119A 519A DDE5            15      PUSH    IX
00119C 519C DD218A2F        14      LD  IX,FRCINT
0011A0 51A0 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0011A4 51A4 CDB0F2          17      CALL    CAL_MP
0011A7 51A7 DDE1            14      POP IX
0011A9 51A9 2AF8F7          16      LD  HL,(DACDAT)
0011AC 51AC 22CAF2          16      LD  (RR_LOW),HL
0011AF 51AF AF               4      XOR A
0011B0 51B0 CDD950          17      CALL    SET_BASIC_FCB
0011B3 51B3 D1              10      POP DE
0011B4 51B4 AF               4      XOR A
0011B5 51B5 C9              10      RET
                                
                                ;FUNC_10:LOC
                                ;in
                                ;   A : 10
                                ;out
                                ;   DAC    : value of received bytes
                                ;   VALTYP : DAC type
       51B6                     DEVICE_10_LOC:
0011B6 51B6 CDB650          17      CALL    GET_BASIC_FCB
0011B9 51B9 2ACAF2          16      LD  HL,(RR_LOW)
0011BC 51BC 1844            12      JR  RETURN_TYPE8_AHL
                                
                                ;--------------------------------------
                                ;FUNC_14:EOF
                                ;in
                                ;   A : 14
                                ;out
                                ;   DAC    : value of EOF value (EOF=-1)
                                ;   VALTYP : DAC type
       51BE                     DEVICE_14_EOF:
0011BE 51BE CDB650          17      CALL    GET_BASIC_FCB
0011C1 51C1 CDFA4D          17      CALL    RBX1
0011C4 51C4 3810            12      JR  C,DEVICE_14_EOF1
0011C6 51C6 210100          10      LD  HL,1
0011C9 51C9 CD464B          17      CALL    ROM_READ
0011CC 51CC 2AD4F2          16      LD  HL,(_DTA)
0011CF 51CF 7E               7      LD  A,(HL)
0011D0 51D0 FE1A             7      CP  01AH
0011D2 51D2 37               4      SCF
0011D3 51D3 2801            12      JR  Z,DEVICE_14_EOF1
0011D5 51D5 3F               4      CCF
       51D6                     DEVICE_14_EOF1:
0011D6 51D6 9F               4      SBC A,A
0011D7 51D7 6F               4      LD  L,A
0011D8 51D8 67               4      LD  H,A
       51D9                     return_type2_hl:
0011D9 51D9 22F8F7          16      ld  (DACDAT),hl
0011DC 51DC 3E02             7      ld  a,2
0011DE 51DE 3263F6          13      ld  (VALTYP),a
0011E1 51E1 C9              10      ret
                                
                                ;--------------------------------------
                                ;FUNC_16:FPOS
                                ;in
                                ;   unknown
                                ;out
                                ;   unknown
                                ;note:
                                ;   illegal function call
                                
                                ;--------------------------------------
                                ;FUNC_12:LOF
                                ;in
                                ;   A : 12
                                ;out
                                ;   DAC    : value of LOC+RSIQLN
                                ;   VALTYP : DAC type
       51E2                     DEVICE_12_LOF:
0011E2 51E2 CDB650          17      CALL    GET_BASIC_FCB
                                
0011E5 51E5 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
0011E8 51E8 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
0011EB 51EB D5              11      PUSH    DE
0011EC 51EC 2AEDF2          16      LD  HL,(DIRENT1)
0011EF 51EF 111C00          10      LD  DE,0001CH
0011F2 51F2 19              11      ADD HL,DE
0011F3 51F3 CDC344          17      CALL    RDSLT_ROM
0011F6 51F6 23               6      INC HL
0011F7 51F7 5F               4      LD  E,A
0011F8 51F8 CDC344          17      CALL    RDSLT_ROM
0011FB 51FB 23               6      INC HL
0011FC 51FC 57               4      LD  D,A
0011FD 51FD CDC344          17      CALL    RDSLT_ROM
001200 5200 EB               4      EX  DE,HL       ;AHL=File size
001201 5201 D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
       5202                     RETURN_TYPE8_AHL:
001202 5202 B7               4      OR  A
001203 5203 2004            12      JR  NZ,RT8AHL1
001205 5205 CB7C             8      BIT 7,H
001207 5207 28D0            12      JR  Z,return_type2_hl
       5209                     RT8AHL1:
001209 5209 E5              11      PUSH    HL
00120A 520A 29              11      ADD HL,HL
00120B 520B 8F               4      ADC A,A
00120C 520C 32F8F7          13      LD  (DACDAT),A
00120F 520F 3E00             7      LD  A,0
001211 5211 8F               4      ADC A,A
001212 5212 32F9F7          13      LD  (DACDAT+1),A
                                
001215 5215 3E02             7      LD  A,2
001217 5217 3263F6          13      LD  (VALTYP),A
00121A 521A DD213A30        14      LD  IX,FRCDBL
00121E 521E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001222 5222 CDB0F2          17      CALL    CAL_MP
                                
001225 5225 216B52          10      LD  HL,DBL32768
001228 5228 1147F8          10      LD  DE,ARG
00122B 522B 010800          10      LD  BC,8
00122E 522E EDB0                    LDIR
                                
001230 5230 DD21E627        14      LD  IX,DECMUL
001234 5234 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001238 5238 CDB0F2          17      CALL    CAL_MP
                                
00123B 523B 21F6F7          10      LD  HL,DAC
00123E 523E 1147F8          10      LD  DE,ARG
001241 5241 010800          10      LD  BC,8
001244 5244 EDB0                    LDIR
                                
001246 5246 E1              10      POP HL
001247 5247 22F8F7          16      LD  (DACDAT),HL
                                
00124A 524A 3E02             7      LD  A,2
00124C 524C 3263F6          13      LD  (VALTYP),A
00124F 524F DD213A30        14      LD  IX,FRCDBL
001253 5253 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001257 5257 CDB0F2          17      CALL    CAL_MP
                                
00125A 525A DD219A26        14      LD  IX,DECADD
00125E 525E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001262 5262 CDB0F2          17      CALL    CAL_MP
                                
001265 5265 3E08             7      LD  A,8
001267 5267 3263F6          13      LD  (VALTYP),A
00126A 526A C9              10      RET
                                
       526B                     DBL32768:
00126B 526B 4532768000000000        DB  045H,032H,076H,080H,0,0,0,0
                                
       5273                     CPPROCNM:
001273 5273 E5              11      PUSH    HL
001274 5274 2189FD          10      LD  HL,PROCNM
       5277                     CPPROCNM1:
001277 5277 1A               7      LD  A,(DE)
001278 5278 13               6      INC DE
001279 5279 BE               7      CP  (HL)
00127A 527A 23               6      INC HL
00127B 527B 2003            12      JR  NZ,CPPROCNM2
00127D 527D B7               4      OR  A
00127E 527E 20F7            12      JR  NZ,CPPROCNM1
       5280                     CPPROCNM2:
001280 5280 E1              10      POP HL
001281 5281 C9              10      RET
                                
       5282                     WILDCARD:
001282 5282 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       528D                     STR_CHDIR:
00128D 528D 434844495200            DB  "CHDIR",0
       5293                     STR_CHDRV:
001293 5293 434844525600            DB  "CHDRV",0
       5299                     STR_RAMDISK:
001299 5299 52414D4449534B00        DB  "RAMDISK",0
       52A1                     STR_ROM:
0012A1 52A1 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       52A5                     ERROR_WRITE_PROTECTED:
0012A5 52A5 3E00             7      LD  A,0     ;Write protected
0012A7 52A7 C9              10      RET
       52A8                     DISKIO:
0012A8 52A8 38FB            12      JR  C,ERROR_WRITE_PROTECTED
0012AA 52AA 48               4      LD  C,B
0012AB 52AB CD8554          17      CALL    GET_DISK_BANK
       52AE                     SETMAP1:        
0012AE 52AE E5              11      PUSH    HL
       52AF                     DISKIO1:
0012AF 52AF C5              11      PUSH    BC      ;B=残りのセクタ数
0012B0 52B0 D5              11      PUSH    DE      ;DE=セクタ番号
0012B1 52B1 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
0012B2 52B2 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
0012B3 52B3 F5              11      PUSH    AF
0012B4 52B4 3AC9F2          13      LD  A,(SECSZ_H)
0012B7 52B7 CDA854          17      CALL    MUL_AHL
0012BA 52BA F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
0012BB 52BB 7D               4      LD  A,L
0012BC 52BC C5              11      PUSH    BC
0012BD 52BD 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
0012C0 52C0 09              11      ADD HL,BC
0012C1 52C1 C1              10      POP BC
0012C2 52C2 3013            12      JR  NC,DISKIO2
0012C4 52C4 4D               4      LD  C,L     ;C=読み出し元
0012C5 52C5 29              11      ADD HL,HL   ;64KB→32KB
0012C6 52C6 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
0012C7 52C7 CD7B54          17      CALL    GET_DISK_BANK_FDRV
0012CA 52CA 84               4      ADD A,H
0012CB 52CB 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
0012CE 52CE 32C4F2          13      LD  (_BANK),A
0012D1 52D1 69               4      LD  L,C     ;C=読み出し元
0012D2 52D2 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
0012D4 52D4 A5               4      AND L
0012D5 52D5 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       52D7                     DISKIO2:
0012D7 52D7 C660             7      ADD A,high BANK1_ADR
0012D9 52D9 67               4      LD  H,A
0012DA 52DA ED4BC8F2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
0012DE 52DE 69               4      LD  L,C     ;C=0
0012DF 52DF CD1945          17      CALL    ROM_LDIR
0012E2 52E2 EB               4      EX  DE,HL
0012E3 52E3 F1              10      POP AF
0012E4 52E4 D1              10      POP DE
0012E5 52E5 13               6      INC DE
0012E6 52E6 C1              10      POP BC
0012E7 52E7 10C6            13      DJNZ    DISKIO1
0012E9 52E9 41               4      LD  B,C
                                
0012EA 52EA E1              10      POP HL
0012EB 52EB AF               4      XOR A
                                
0012EC 52EC FB               4      EI
0012ED 52ED C9              10      RET
                                
       52EE                     DSKCHG:
0012EE 52EE CD2753          17      CALL    IS_BPB
0012F1 52F1 3824            12      JR  C,NOTREADY
0012F3 52F3 3A23FB          13      LD  A,(DRVTBL+2)
0012F6 52F6 B7               4      OR  A
0012F7 52F7 201A            12      JR  NZ,DSKCHG1
0012F9 52F9 3A21FB          13      LD  A,(DRVTBL)
0012FC 52FC FE02             7      CP  2
0012FE 52FE 2013            12      JR  NZ,DSKCHG1
001300 5300 CD2753          17      CALL    IS_BPB
001303 5303 300E            12      JR  NC,DSKCHG1
001305 5305 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
001307 5307 3221FB          13      LD  (DRVTBL),A
00130A 530A 3223FB          13      LD  (DRVTBL+2),A
00130D 530D 3A48F3          13      LD  A,(MASTERS)
001310 5310 3224FB          13      LD  (DRVTBL+3),A
       5313                     DSKCHG1:
001313 5313 AF               4      XOR A
001314 5314 0601             7      LD  B,1
001316 5316 C9              10      RET
       5317                     NOTREADY:
001317 5317 3E02             7      LD  A,2
001319 5319 37               4      SCF
00131A 531A C9              10      RET
                                
       531B                     NO_BPB:
00131B 531B E1              10      POP HL
00131C 531C 23               6      INC HL
00131D 531D 11AE54          10      LD  DE,DPB2DD
001320 5320 011200          10      LD  BC,DPB2DD_E-DPB2DD
001323 5323 EDB0                    LDIR
001325 5325 AF               4      XOR A
001326 5326 C9              10      RET
                                
       5327                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
001327 5327 CD8554          17      CALL    GET_DISK_BANK
                                
00132A 532A 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
00132D 532D FE01             7      CP  1
00132F 532F D8              11      RET C
                                
001330 5330 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
001333 5333 C6FF             7      ADD A,0FFH
001335 5335 D8              11      RET C
                                
001336 5336 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       5339                     IS_BPB1:
001339 5339 FE01             7      CP  1
00133B 533B C8              11      RET Z
00133C 533C FE02             7      CP  2
00133E 533E C8              11      RET Z
00133F 533F FE04             7      CP  4
001341 5341 C8              11      RET Z
001342 5342 37               4      SCF
001343 5343 C9              10      RET
                                
       5344                     GETDPB:
001344 5344 E5              11      PUSH    HL
001345 5345 CD8554          17      CALL    GET_DISK_BANK
                                
001348 5348 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
00134B 534B B7               4      OR  A
00134C 534C 28CD            12      JR  Z,NO_BPB
00134E 534E DDE1            14      POP IX
001350 5350 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
001353 5353 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
001356 5356 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
001359 5359 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
00135C 535C DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
00135F 535F 87               4      ADD A,A
001360 5360 87               4      ADD A,A
001361 5361 87               4      ADD A,A
001362 5362 3D               4      DEC A
001363 5363 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
001366 5366 06FF             7      LD  B,-1
001368 5368 A7               4      AND A           ;無限ループ阻止
       5369                     GETDPB1:
001369 5369 04               4      INC B
00136A 536A 1F               4      RRA
00136B 536B 38FC            12      JR  C,GETDPB1
00136D 536D DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
001370 5370 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001373 5373 3D               4      DEC A
001374 5374 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
001377 5377 A7               4      AND A           ;無限ループ阻止
001378 5378 06FF             7      LD  B,-1
       537A                     GETDPB2:
00137A 537A 04               4      INC B
00137B 537B 1F               4      RRA
00137C 537C 38FC            12      JR  C,GETDPB2
00137E 537E 04               4      INC B
00137F 537F DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
001382 5382 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
001385 5385 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
001388 5388 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
00138B 538B 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
00138E 538E DD770A          19      LD  (IX+10),A       ;FATCNT
                                
001391 5391 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
001394 5394 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
001397 5397 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
00139B 539B DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
00139E 539E DD460A          19      LD  B,(IX+10)       ;FATCNT
0013A1 53A1 210000          10      LD  HL,0
       53A4                     GETDPB3:
0013A4 53A4 19              11      ADD HL,DE
0013A5 53A5 10FD            13      DJNZ    GETDPB3
       53A7                     GETDPB4:
0013A7 53A7 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
0013AA 53AA DD5609          19      LD  D,(IX+9)        ;FIRFAT
0013AD 53AD 19              11      ADD HL,DE
0013AE 53AE DD7511          19      LD  (IX+17),L       ;FIRDIR
0013B1 53B1 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
0013B4 53B4 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0013B7 53B7 87               4      ADD A,A
0013B8 53B8 87               4      ADD A,A
0013B9 53B9 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       53BC                     GETDPB5:
0013BC 53BC CB3B             8      SRL E
0013BE 53BE 1F               4      RRA
0013BF 53BF 30FB            12      JR  NC,GETDPB5
0013C1 53C1 1600             7      LD  D,0
0013C3 53C3 19              11      ADD HL,DE
0013C4 53C4 DD750C          19      LD  (IX+12),L       ;FIRREC
0013C7 53C7 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
0013CA 53CA 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
0013CD 53CD DD5E0C          19      LD  E,(IX+12)       ;FIRREC
0013D0 53D0 DD560D          19      LD  D,(IX+13)       ;FIRREC
0013D3 53D3 A7               4      AND A
0013D4 53D4 ED52            15      SBC HL,DE
                                
0013D6 53D6 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
0013D9 53D9 3C               4      INC A
0013DA 53DA 37               4      SCF             ;無限ループ阻止
       53DB                     GETDPB6:
0013DB 53DB 1F               4      RRA
0013DC 53DC 3806            12      JR  C,GETDPB7
0013DE 53DE CB3C             8      SRL H
0013E0 53E0 CB1D             8      RR  L
0013E2 53E2 18F7            12      JR  GETDPB6
       53E4                     GETDPB7:
0013E4 53E4 23               6      INC HL
0013E5 53E5 DD750E          19      LD  (IX+14),L       ;MAXCLUS
0013E8 53E8 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       53EB                     GETDPBD1:
0013EB 53EB DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0013EE 53EE E6FC             7      AND 0FCH
0013F0 53F0 C8              11      RET Z
                                
0013F1 53F1 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
0013F5 53F5 37               4      SCF
0013F6 53F6 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
0013FA 53FA DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
0013FD 53FD DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
001401 5401 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001405 5405 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
001409 5409 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
00140D 540D DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
001411 5411 DDCB1126        23      SLA (IX+17)         ;FIRDIR
001415 5415 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
001419 5419 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
00141C 541C DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
00141F 541F DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001422 5422 87               4      ADD A,A
001423 5423 87               4      ADD A,A
001424 5424 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5427                     GETDPBD5:
001427 5427 CB3B             8      SRL E
001429 5429 1F               4      RRA
00142A 542A 30FB            12      JR  NC,GETDPBD5
00142C 542C 1600             7      LD  D,0
00142E 542E 19              11      ADD HL,DE
00142F 542F DD750C          19      LD  (IX+12),L       ;FIRREC
001432 5432 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001435 5435 18B4            12      JR  GETDPBD1
                                
       5437                     CHOICE:
001437 5437 210000          10      LD  HL,0
00143A 543A C9              10      RET
                                
       543B                     DSKFMT:
00143B 543B AF               4      XOR A
00143C 543C 37               4      SCF
       543D                     DSKSTP:
00143D 543D C9              10      RET
                                
       543E                     BASENT:
00143E 543E 2A74F6          16      LD  HL,(STKTOP)
001441 5441 3A40F3          13      LD  A,(REBOOT)
001444 5444 C6FF             7      ADD A,0FFH
001446 5446 3811            12      JR  C,REBOOT1
001448 5448 21C054          10      LD  HL,AUTOEXEC
00144B 544B 11F8F2          10      LD  DE,FDRV
00144E 544E 010C00          10      LD  BC,1+8+3
001451 5451 EDB0                    LDIR
001453 5453 CD794D          17      CALL    ROM_OPEN
001456 5456 D4E146          17      CALL    NC,ROM_LOAD1
       5459                     REBOOT1:
001459 5459 21CC54          10      LD  HL,CMD_RUN
00145C 545C 111FF4          10      LD  DE,KBUF
00145F 545F 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
001462 5462 D5              11      PUSH    DE
001463 5463 EDB0                    LDIR
001465 5465 3004            12      JR  NC,REBOOT2
001467 5467 AF               4      XOR A
001468 5468 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       546B                     REBOOT2:
00146B 546B E1              10      POP HL
00146C 546C FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001470 5470 DD210146        14      LD  IX,NEWSTT
001474 5474 C31C00          10      JP  _CALSLT
                                
       5477                     GETSLT:
001477 5477 3A22FB          13      LD  A,(DRVTBL+1)
00147A 547A C9              10      RET
                                
       547B                     GET_DISK_BANK_FDRV:
00147B 547B 3AF8F2          13      LD  A,(FDRV)
00147E 547E D601             7      SUB 1
001480 5480 3003            12      JR  NC,GET_DISK_BANK
001482 5482 3AEAF2          13      LD  A,(_DVSW)
       5485                     GET_DISK_BANK:
001485 5485 FE07             7      CP  7       ;H:
001487 5487 2801            12      JR  Z,SET_DISK_BANK_A
001489 5489 B7               4      OR  A       ;A=DRIVE
       548A                     SET_DISK_BANK_A:
00148A 548A 3E01             7      LD  A,DISK_BANK
00148C 548C 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
00148E 548E 3AE9F2          13      LD  A,(B_DRIVE)
                                #endif
       5491                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
001491 5491 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001494 5494 F5              11      PUSH    AF
001495 5495 E5              11      PUSH    HL
001496 5496 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001499 5499 22C8F2          16      LD  (SECSZ),HL
00149C 549C 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
00149F 549F CDA854          17      CALL    MUL_AHL
0014A2 54A2 22C6F2          16      LD  (CLSZ),HL
0014A5 54A5 E1              10      POP HL
0014A6 54A6 F1              10      POP AF
0014A7 54A7 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       54A8                     MUL_AHL:
0014A8 54A8 37               4      SCF     ;無限ループ回避
       54A9                     MUL_AHL1:
0014A9 54A9 1F               4      RRA     ;->CF
0014AA 54AA D8              11      RET C
0014AB 54AB 29              11      ADD HL,HL
0014AC 54AC 18FB            12      JR  MUL_AHL1
                                
       54AE                     DPB2DD:
0014AE 54AE F9                      DB  0F9H    ;MEDIA
0014AF 54AF 0002                    DW  00200H  ;SECSIZ
0014B1 54B1 0F                      DB  00FH    ;DIRMSK
0014B2 54B2 04                      DB  004H    ;DIRSHFT
0014B3 54B3 01                      DB  001H    ;CLUSMSK
0014B4 54B4 02                      DB  002H    ;CLUSSHFT
0014B5 54B5 0100                    DW  00001H  ;FIRFAT
0014B7 54B7 02                      DB  002H    ;FATCNT
0014B8 54B8 70                      DB  070H    ;MAXENT
0014B9 54B9 0E00                    DW  0000EH  ;FIRREC
0014BB 54BB CA02                    DW  002CAH  ;MAXCLUS
0014BD 54BD 03                      DB  003H    ;FATSIZ
0014BE 54BE 0700                    DW  0007H   ;FIRDIR
       54C0                     DPB2DD_E:
                                
       54C0                     AUTOEXEC:
0014C0 54C0 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       54CC                     CMD_RUN:
0014CC 54CC 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
                                #if exists USE_MORMAL32K_OR_ASCII16
0014D2 54D2 80F2                    DW  0F280H
                                #else
                                    DW  0F240H
                                #endif
       54D4                     CMD_CLEAR_E:
0014D4 54D4 3A8A00                  DB  03AH,08AH,0         ;RUN
       54D7                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       54D7                     POP_HL_ERROR:
0014D7 54D7 E1              10      POP     HL
       54D8                     _ERROR:
0014D8 54D8 0600             7      LD  B,0
0014DA 54DA A7               4      AND A
0014DB 54DB C9              10      RET
                                
       54DC                     ROM_BDOS:
0014DC 54DC E5              11      PUSH    HL
0014DD 54DD 79               4      LD  A,C
0014DE 54DE 87               4      ADD A,A
0014DF 54DF 38F7            12      JR  C,_ERROR
0014E1 54E1 6F               4      LD  L,A
0014E2 54E2 265F             7      LD  H,high STABLE
0014E4 54E4 7E               7      LD  A,(HL)
0014E5 54E5 2C               4      INC L
0014E6 54E6 66               7      LD  H,(HL)
0014E7 54E7 6F               4      LD  L,A
0014E8 54E8 E3              19      EX  (SP),HL
0014E9 54E9 79               4      LD  A,C
0014EA 54EA C9              10      RET
                                
       54EB                     _PRINT:
       54EB                     PRINT:
0014EB 54EB 7B               4      LD  A,E
0014EC 54EC 1803            12      JR  MSG_A
                                
       54EE                     _SYS01:     ;(BDOS)コンソール入力
0014EE 54EE CD7355          17      CALL    _SYS07
       54F1                     MSG_A:
0014F1 54F1 FE03             7      CP  3
0014F3 54F3 2814            12      JR  Z,MSG_BR
       54F5                     MSGA1:
0014F5 54F5 F5              11      PUSH    AF
0014F6 54F6 C5              11      PUSH    BC
0014F7 54F7 D5              11      PUSH    DE
0014F8 54F8 E5              11      PUSH    HL
0014F9 54F9 DDE5            15      PUSH    IX
0014FB 54FB DD21A200        14      LD  IX,CHPUT
0014FF 54FF CD0144          17      CALL    CALSLT_R
001502 5502 DDE1            14      POP IX
001504 5504 E1              10      POP HL
001505 5505 D1              10      POP DE
001506 5506 C1              10      POP BC
       5507                     MSGA2:
001507 5507 F1              10      POP AF
001508 5508 C9              10      RET
       5509                     MSG_BR:
001509 5509 F5              11      PUSH    AF
00150A 550A 3ADDF3          13      LD  A,(CSRX)
00150D 550D FE02             7      CP  2
00150F 550F 38F6            12      JR  C,MSGA2
001511 5511 F1              10      POP AF
       5512                     MSG_CR:
001512 5512 F5              11      PUSH    AF
001513 5513 3E0D             7      LD  A,00DH
001515 5515 CDF554          17      CALL    MSGA1
001518 5518 3E0A             7      LD  A,00AH
00151A 551A CDF554          17      CALL    MSGA1
00151D 551D F1              10      POP AF
00151E 551E C9              10      RET
                                
       551F                     _SYS02:     ;(BDOS)コンソール出力
00151F 551F CD3A55          17      CALL    BREAK
001522 5522 1805            12      JR  PRINTX
                                
       5524                     _SYS06:     ;(BDOS)コンソール直接入出力
001524 5524 7B               4      LD  A,E
001525 5525 3C               4      INC A
001526 5526 CA8755          10      JP  Z,_INKEY
       5529                     PRINTX:
001529 5529 C3EB54          10      JP  _PRINT
                                
       552C                     _SYS08:     ;(BDOS)エコーなしコンソール入力
00152C 552C CD7355          17      CALL    _SYS07
00152F 552F FE03             7      CP  3
001531 5531 CC3A55          17      CALL    Z,_BREAK
001534 5534 FE13             7      CP  013H        ;CTRL+S
001536 5536 C0              11      RET NZ
       5537                     PAUSE:
001537 5537 CD5155          17      CALL    KEYBC
                                
       553A                     _BREAK:
       553A                     BREAK:
00153A 553A F5              11      PUSH    AF
00153B 553B C5              11      PUSH    BC
00153C 553C D5              11      PUSH    DE
00153D 553D E5              11      PUSH    HL
00153E 553E DDE5            15      PUSH    IX
001540 5540 DD21B700        14      LD  IX,BREAKX
001544 5544 CD0144          17      CALL    CALSLT_R
001547 5547 DDE1            14      POP IX
001549 5549 E1              10      POP HL
00154A 554A D1              10      POP DE
00154B 554B C1              10      POP BC
00154C 554C DC3A55          17      CALL    C,_BREAK
00154F 554F F1              10      POP AF
001550 5550 C9              10      RET
       5551                     KEYBC:
001551 5551 F5              11      PUSH    AF
001552 5552 C5              11      PUSH    BC
001553 5553 D5              11      PUSH    DE
001554 5554 E5              11      PUSH    HL
001555 5555 DDE5            15      PUSH    IX
001557 5557 DD215601        14      LD  IX,KILBUF
00155B 555B CD0144          17      CALL    CALSLT_R
00155E 555E DDE1            14      POP IX
001560 5560 E1              10      POP HL
001561 5561 D1              10      POP DE
001562 5562 C1              10      POP BC
001563 5563 F1              10      POP AF
001564 5564 C9              10      RET
                                
       5565                     _SYS09:     ;(BDOS)文字列出力
001565 5565 D5              11      PUSH    DE
       5566                     _SX09:
001566 5566 1A               7      LD  A,(DE)
001567 5567 13               6      INC DE
001568 5568 FE24             7      CP  '$'
00156A 556A 2805            12      JR  Z,POPDE_RET
00156C 556C CDF154          17      CALL    MSG_A
00156F 556F 18F5            12      JR  _SX09
       5571                     POPDE_RET:
001571 5571 D1              10      POP DE
001572 5572 C9              10      RET
                                
       5573                     _SYS07:
       5573                     FLGET:
001573 5573 C5              11      PUSH    BC
001574 5574 D5              11      PUSH    DE
001575 5575 E5              11      PUSH    HL
001576 5576 DDE5            15      PUSH    IX
001578 5578 DD219F00        14      LD  IX,CHGET
00157C 557C CD0144          17      CALL    CALSLT_R
00157F 557F DDE1            14      POP IX
001581 5581 E1              10      POP HL
001582 5582 D1              10      POP DE
001583 5583 C1              10      POP BC
001584 5584 FE03             7      CP  3
001586 5586 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5587                     _INKEY:
       5587                     INKEY:
001587 5587 CD2156          17      CALL    CPM_CONST
00158A 558A C8              11      RET Z
00158B 558B 18E6            12      JR  FLGET
                                
       558D                     _SYS0A:     ;(BDOS)文字列入力
00158D 558D C5              11      PUSH    BC
00158E 558E E5              11      PUSH    HL
00158F 558F D5              11      PUSH    DE
001590 5590 CDB955          17      CALL    GETL
001593 5593 111FF4          10      LD  DE,KBUF
001596 5596 E1              10      POP HL
001597 5597 E5              11      PUSH    HL
001598 5598 0E00             7      LD  C,0
00159A 559A 3004            12      JR  NC,SAX0
00159C 559C 23               6      INC HL
00159D 559D 23               6      INC HL
00159E 559E 1808            12      JR  SAX4
       55A0                     SAX0:
0015A0 55A0 46               7      LD  B,(HL)
0015A1 55A1 23               6      INC HL
       55A2                     SAX1:
0015A2 55A2 23               6      INC HL
0015A3 55A3 1A               7      LD  A,(DE)
0015A4 55A4 13               6      INC DE
0015A5 55A5 B7               4      OR  A
0015A6 55A6 2004            12      JR  NZ,SAX2
       55A8                     SAX4:
0015A8 55A8 360D            10      LD  (HL),00DH
0015AA 55AA 1804            12      JR  SAX3
       55AC                     SAX2:
0015AC 55AC 77               7      LD  (HL),A
0015AD 55AD 0C               4      INC C
0015AE 55AE 10F2            13      DJNZ    SAX1
       55B0                     SAX3:
0015B0 55B0 D1              10      POP DE
0015B1 55B1 79               4      LD  A,C
0015B2 55B2 13               6      INC DE
0015B3 55B3 12               7      LD  (DE),A
0015B4 55B4 1B               6      DEC DE
0015B5 55B5 E1              10      POP HL
0015B6 55B6 C1              10      POP BC
0015B7 55B7 A7               4      AND A
0015B8 55B8 C9              10      RET
       55B9                     GETL:
0015B9 55B9 DDE5            15      PUSH    IX
0015BB 55BB FDE5            15      PUSH    IY
                                
0015BD 55BD 2ADCF3          16      LD  HL,(CSRY)
0015C0 55C0 22CAFB          16      LD  (FSTPOS),HL
       55C3                     GETL1:
0015C3 55C3 CD2C55          17      CALL    _SYS08
0015C6 55C6 FE09             7      CP  9
0015C8 55C8 2008            12      JR  NZ,GETL1V
0015CA 55CA 211FF4          10      LD  HL,KBUF
0015CD 55CD CD9844          17      CALL    MSX
0015D0 55D0 18F1            12      JR  GETL1
       55D2                     GETL1V:
0015D2 55D2 5F               4      LD  E,A
0015D3 55D3 FE08             7      CP  8
0015D5 55D5 CCCE56          17      CALL    Z,CTRL02
0015D8 55D8 FE20             7      CP  020H
0015DA 55DA D4FA56          17      CALL    NC,INSERT
0015DD 55DD CDF554          17      CALL    MSGA1
                                
0015E0 55E0 7B               4      LD  A,E
0015E1 55E1 FE0D             7      CP  00DH
0015E3 55E3 20DE            12      JR  NZ,GETL1
                                
0015E5 55E5 111FF4          10      LD  DE,KBUF
0015E8 55E8 3AB0F3          13      LD  A,(LINLEN)
0015EB 55EB 47               4      LD  B,A
0015EC 55EC CDDB58          17      CALL    ZERO_MEMORY_DE
                                
0015EF 55EF 2ACAFB          16      LD  HL,(FSTPOS)
0015F2 55F2 3ADCF3          13      LD  A,(CSRY)
0015F5 55F5 6F               4      LD  L,A
0015F6 55F6 E5              11      PUSH    HL
0015F7 55F7 CD2B57          17      CALL    LOC0
0015FA 55FA 4D               4      LD  C,L
0015FB 55FB 44               4      LD  B,H
0015FC 55FC E1              10      POP HL
0015FD 55FD 3AB0F3          13      LD  A,(LINLEN)
001600 5600 94               4      SUB H
001601 5601 3D               4      DEC A
001602 5602 5F               4      LD  E,A
001603 5603 211FF4          10      LD  HL,KBUF
       5606                     GETL2:
001606 5606 CDBE56          17      CALL    _SCRN
001609 5609 03               6      INC BC
00160A 560A 77               7      LD  (HL),A
00160B 560B 23               6      INC HL
00160C 560C 1D               4      DEC E
00160D 560D 20F7            12      JR  NZ,GETL2
00160F 560F CD1255          17      CALL    MSG_CR
                                
001612 5612 FDE1            14      POP IY
001614 5614 DDE1            14      POP IX
       5616                     GETL3:
001616 5616 2B               6      DEC HL
001617 5617 7E               7      LD  A,(HL)
001618 5618 FE21             7      CP  021H
00161A 561A D0              11      RET NC
00161B 561B 3600            10      LD  (HL),0
00161D 561D 15               4      DEC D
00161E 561E 20F6            12      JR  NZ,GETL3
001620 5620 C9              10      RET
                                
       5621                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       5621                     CONSTX:
       5621                     CPM_CONST:
001621 5621 C5              11      PUSH    BC
001622 5622 D5              11      PUSH    DE
001623 5623 E5              11      PUSH    HL
001624 5624 DDE5            15      PUSH    IX
001626 5626 DD219C00        14      LD  IX,CHSNS
00162A 562A CD0144          17      CALL    CALSLT_R
00162D 562D DDE1            14      POP IX
00162F 562F E1              10      POP HL
001630 5630 D1              10      POP DE
001631 5631 C1              10      POP BC
001632 5632 C9              10      RET
                                
       5633                     _SYS2A:     ;(BDOS)日付の獲得
001633 5633 0E0B             7      LD  C,11        ;年/Year→HL
001635 5635 CD7456          17      CALL    RDCLK_BCD
001638 5638 6F               4      LD  L,A
001639 5639 2600             7      LD  H,0
00163B 563B 3AF8FA          13      LD  A,(EXBRSA)
00163E 563E B7               4      OR  A
00163F 563F 2804            12      JR  Z,SX2A1
001641 5641 11BC07          10      LD  DE,1980     ;1980年～2079年
001644 5644 19              11      ADD HL,DE
       5645                     SX2A1:
001645 5645 0E09             7      LD  C,9     ;月/Month→D
001647 5647 CD7456          17      CALL    RDCLK_BCD
00164A 564A 57               4      LD  D,A
                                
00164B 564B 0E07             7      LD  C,7     ;日/Day→E
00164D 564D CD7456          17      CALL    RDCLK_BCD
001650 5650 5F               4      LD  E,A
                                
001651 5651 0E06             7      LD  C,6     ;曜日/Week→A
       5653                     RDCLK:
001653 5653 DDE5            15      PUSH    IX
001655 5655 DD21F501        14      LD  IX,REDCLK
       5659                     WRCLK1:
001659 5659 3AF8FA          13      LD  A,(EXBRSA)
00165C 565C B7               4      OR  A
00165D 565D 280A            12      JR  Z,RDCLK1    ;MSX1
00165F 565F FDE5            15      PUSH    IY
001661 5661 FD67             9      LD  IYH,A
001663 5663 78               4      LD  A,B
001664 5664 CD1C00          17      CALL    _CALSLT
001667 5667 FDE1            14      POP IY
       5669                     RDCLK1:
001669 5669 DDE1            14      POP IX
00166B 566B C9              10      RET
       566C                     WRCLK:
00166C 566C DDE5            15      PUSH    IX
00166E 566E DD21F901        14      LD  IX,WRTCLK
001672 5672 18E5            12      JR  WRCLK1
                                
       5674                     RDCLK_BCD:
001674 5674 CD5356          17      CALL    RDCLK       ;1の位
001677 5677 47               4      LD  B,A
001678 5678 0C               4      INC C
001679 5679 CD5356          17      CALL    RDCLK       ;10の位
00167C 567C 87               4      ADD A,A     ;*2
00167D 567D 4F               4      LD  C,A
00167E 567E 87               4      ADD A,A     ;*4
00167F 567F 87               4      ADD A,A     ;*8
001680 5680 81               4      ADD A,C     ;*10(8+2)
001681 5681 80               4      ADD A,B     ;1の位
001682 5682 C9              10      RET
                                
       5683                     _SYS2C:     ;(BDOS)時刻の獲得
001683 5683 011501          10      LD  BC,00115H       ;12時間計/24時間計の設定を24時間計に
001686 5686 CD6C56          17      CALL    WRCLK
001689 5689 0E04             7      LD  C,4     ;H=時/Hour
00168B 568B CD7456          17      CALL    RDCLK_BCD
00168E 568E 67               4      LD  H,A
00168F 568F 0E02             7      LD  C,2     ;L=分/Minute
001691 5691 CD7456          17      CALL    RDCLK_BCD
001694 5694 6F               4      LD  L,A
001695 5695 0E00             7      LD  C,0     ;D=秒/Second
001697 5697 CD7456          17      CALL    RDCLK_BCD
00169A 569A 57               4      LD  D,A
00169B 569B AF               4      XOR A       ;E=1/100秒
00169C 569C 5F               4      LD  E,A
00169D 569D C9              10      RET
                                
       569E                     POS:
00169E 569E F5              11      PUSH    AF
00169F 569F 2ADCF3          16      LD  HL,(CSRY)
0016A2 56A2 7D               4      LD  A,L
0016A3 56A3 6C               4      LD  L,H
0016A4 56A4 67               4      LD  H,A
0016A5 56A5 2C               4      INC L
0016A6 56A6 24               4      INC H
0016A7 56A7 F1              10      POP AF
0016A8 56A8 C9              10      RET
                                
       56A9                     LOC:
0016A9 56A9 F5              11      PUSH    AF
0016AA 56AA E5              11      PUSH    HL
0016AB 56AB 7D               4      LD  A,L
0016AC 56AC 6C               4      LD  L,H
0016AD 56AD 67               4      LD  H,A
0016AE 56AE 2D               4      DEC L
0016AF 56AF 25               4      DEC H
0016B0 56B0 DDE5            15      PUSH    IX
0016B2 56B2 DD21C600        14      LD  IX,POSIT
0016B6 56B6 CD0144          17      CALL    CALSLT_R
0016B9 56B9 DDE1            14      POP IX
0016BB 56BB E1              10      POP HL
0016BC 56BC F1              10      POP AF
0016BD 56BD C9              10      RET
                                
       56BE                     _SCRN:
       56BE                     SCRN:
0016BE 56BE E5              11      PUSH    HL
0016BF 56BF DDE5            15      PUSH    IX
                                
0016C1 56C1 69               4      LD  L,C
0016C2 56C2 60               4      LD  H,B
0016C3 56C3 DD214A00        14      LD  IX,RDVRM
0016C7 56C7 CD0144          17      CALL    CALSLT_R
                                
0016CA 56CA DDE1            14      POP IX
0016CC 56CC E1              10      POP HL
0016CD 56CD C9              10      RET
                                
       56CE                     CTRL02:
0016CE 56CE F5              11      PUSH    AF
0016CF 56CF D5              11      PUSH    DE
0016D0 56D0 2ADCF3          16      LD  HL,(CSRY)
0016D3 56D3 3AB0F3          13      LD  A,(LINLEN)
0016D6 56D6 4F               4      LD  C,A
0016D7 56D7 94               4      SUB H   ;CSRX
0016D8 56D8 C602             7      ADD A,2
0016DA 56DA 47               4      LD  B,A ;カーソルより右の文字数
0016DB 56DB 61               4      LD  H,C ;LINLEN
0016DC 56DC C5              11      PUSH    BC
0016DD 56DD CD2B57          17      CALL    LOC0
0016E0 56E0 C1              10      POP BC
                                
0016E1 56E1 1620             7      LD  D,020H
       56E3                     C8X1:
0016E3 56E3 DD214A00        14      LD  IX,RDVRM
0016E7 56E7 CD0144          17      CALL    CALSLT_R
0016EA 56EA 4F               4      LD  C,A
0016EB 56EB 7A               4      LD  A,D
0016EC 56EC DD214D00        14      LD  IX,WRTVRM
0016F0 56F0 CD0144          17      CALL    CALSLT_R
0016F3 56F3 2B               6      DEC HL
0016F4 56F4 51               4      LD  D,C
0016F5 56F5 10EC            13      DJNZ    C8X1
0016F7 56F7 D1              10      POP DE
0016F8 56F8 F1              10      POP AF
0016F9 56F9 C9              10      RET
                                
       56FA                     INSERT:
0016FA 56FA F5              11      PUSH    AF
0016FB 56FB D5              11      PUSH    DE
0016FC 56FC 2ADCF3          16      LD  HL,(CSRY)
0016FF 56FF 3AB0F3          13      LD  A,(LINLEN)
001702 5702 4F               4      LD  C,A
001703 5703 94               4      SUB H   ;CSRX
001704 5704 3C               4      INC A
001705 5705 47               4      LD  B,A ;カーソルより右の文字数
001706 5706 C5              11      PUSH    BC
001707 5707 CD2B57          17      CALL    LOC0
00170A 570A C1              10      POP BC
                                
00170B 570B 1620             7      LD  D,020H
       570D                     INS1:
00170D 570D DD214A00        14      LD  IX,RDVRM
001711 5711 CD0144          17      CALL    CALSLT_R
001714 5714 4F               4      LD  C,A
001715 5715 7A               4      LD  A,D
001716 5716 DD214D00        14      LD  IX,WRTVRM
00171A 571A CD0144          17      CALL    CALSLT_R
00171D 571D 23               6      INC HL
00171E 571E 51               4      LD  D,C
00171F 571F 10EC            13      DJNZ    INS1
001721 5721 D1              10      POP DE
001722 5722 F1              10      POP AF
001723 5723 C9              10      RET
                                
       5724                     CONOUT1:
001724 5724 59               4      LD  E,C
001725 5725 C3EB54          10      JP  _PRINT
                                
       5728                     GETVRAM:
001728 5728 2ADCF3          16      LD  HL,(CSRY)
       572B                     LOC0:
00172B 572B 2D               4      DEC L
00172C 572C 25               4      DEC H
00172D 572D 4C               4      LD  C,H ;CSRX-1
00172E 572E 5D               4      LD  E,L ;CSRY-1
       572F                     LOC1:
00172F 572F 3AB0F3          13      LD  A,(LINLEN)
001732 5732 67               4      LD  H,A
001733 5733 1600             7      LD  D,0
001735 5735 6A               4      LD  L,D ;0
001736 5736 0608             7      LD  B,8
       5738                     LOC2:
001738 5738 29              11      ADD HL,HL
001739 5739 3001            12      JR  NC,LOC3
00173B 573B 19              11      ADD HL,DE
       573C                     LOC3:
00173C 573C 10FA            13      DJNZ    LOC2
00173E 573E 09              11      ADD HL,BC
00173F 573F C9              10      RET
                                
       5740                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001740 5740 212200          10      LD  HL,00022H
001743 5743 AF               4      XOR A
001744 5744 7D               4      LD  A,L
001745 5745 C9              10      RET
                                
       5746                     _SYS0D:     ;(BDOS)ディスク・リセット
001746 5746 218000          10      LD  HL,00080H
001749 5749 22D4F2          16      LD  (_DTA),HL
00174C 574C C9              10      RET
                                
       574D                     _SYS0E:     ;(BDOS)カレントドライブの設定
00174D 574D 7B               4      LD  A,E
       574E                     _SYS0EX1:
00174E 574E FE08             7      CP  8
001750 5750 3F               4      CCF
001751 5751 D8              11      RET C
001752 5752 32EAF2          13      LD  (_DVSW),A
001755 5755 C9              10      RET
                                
       5756                     _SYS0F:     ;(BDOS)ファイルのオープン
001756 5756 D5              11      PUSH    DE
001757 5757 FDE1            14      POP IY
001759 5759 CDC558          17      CALL    INIT_FILE
00175C 575C CD794D          17      CALL    ROM_OPEN
00175F 575F 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001761 5761 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
001765 5765 FDE5            15      PUSH    IY
001767 5767 D1              10      POP DE
001768 5768 13               6      INC DE
001769 5769 010B00          10      LD  BC,11
00176C 576C EDB0                    LDIR
                                ;               Attribute
00176E 576E 7E               7      LD  A,(HL)
00176F 576F FD770D          19      LD  (IY+13),A
                                ;               TIME
001772 5772 110B00          10      LD  DE,11
001775 5775 19              11      ADD HL,DE
001776 5776 7E               7      LD  A,(HL)
001777 5777 23               6      INC HL
001778 5778 FD7716          19      LD  (IY+22),A
00177B 577B 7E               7      LD  A,(HL)
00177C 577C 23               6      INC HL
00177D 577D FD7717          19      LD  (IY+23),A
                                ;               DATE
001780 5780 7E               7      LD  A,(HL)
001781 5781 23               6      INC HL
001782 5782 FD7714          19      LD  (IY+20),A
001785 5785 7E               7      LD  A,(HL)
001786 5786 23               6      INC HL
001787 5787 FD7715          19      LD  (IY+21),A
                                ;               First cluster
00178A 578A 7E               7      LD  A,(HL)
00178B 578B 23               6      INC HL
00178C 578C FD771A          19      LD  (IY+26),A
00178F 578F 7E               7      LD  A,(HL)
001790 5790 23               6      INC HL
001791 5791 FD771B          19      LD  (IY+27),A
                                ;               SIZE
001794 5794 7E               7      LD  A,(HL)
001795 5795 23               6      INC HL
001796 5796 FD7710          19      LD  (IY+16),A
001799 5799 7E               7      LD  A,(HL)
00179A 579A 23               6      INC HL
00179B 579B FD7711          19      LD  (IY+17),A
00179E 579E 7E               7      LD  A,(HL)
00179F 579F 23               6      INC HL
0017A0 57A0 FD7712          19      LD  (IY+18),A
0017A3 57A3 7E               7      LD  A,(HL)
0017A4 57A4 FD7713          19      LD  (IY+19),A
0017A7 57A7 AF               4      XOR A
0017A8 57A8 FD770C          19      LD  (IY+12),A
0017AB 57AB C9              10      RET
                                
       57AC                     _SYS10:     ;(BDOS)ファイルのクローズ
0017AC 57AC AF               4      XOR A
0017AD 57AD C9              10      RET
                                
       57AE                     S11X1:
0017AE 57AE FD7119          19      LD  (IY+25),C       ;RootEntCnt
0017B1 57B1 FD750E          19      LD  (IY+14),L
0017B4 57B4 FD740F          19      LD  (IY+15),H
       57B7                     SCF_FF_RET:
0017B7 57B7 37               4      SCF
0017B8 57B8 9F               4      SBC A,A
0017B9 57B9 C9              10      RET
                                
       57BA                     _SYS11:     ;(BDOS)最初のファイルの検索
0017BA 57BA ED53D7F2        20      LD  (_FCB),DE
0017BE 57BE D5              11      PUSH    DE
0017BF 57BF FDE1            14      POP IY
0017C1 57C1 CDC558          17      CALL    INIT_FILE
0017C4 57C4 CDD54F          17      CALL    GET_DIR_DAT
       57C7                     S12X1:
0017C7 57C7 CD954D          17      CALL    FILESE
0017CA 57CA 30E2            12      JR  NC,S11X1
0017CC 57CC 0D               4      DEC C
0017CD 57CD FD7119          19      LD  (IY+25),C       ;RootEntCnt
0017D0 57D0 FDCB0D66        20      BIT 4,(IY+13)
0017D4 57D4 2809            12      JR  Z,S12X2
0017D6 57D6 E5              11      PUSH    HL
0017D7 57D7 DDE1            14      POP IX
0017D9 57D9 DDCB0E66        20      BIT 4,(IX+1+13)
0017DD 57DD 28E8            12      JR  Z,S12X1
       57DF                     S12X2:
0017DF 57DF 012000          10      LD  BC,32
0017E2 57E2 ED5BD4F2        20      LD  DE,(_DTA)
0017E6 57E6 AF               4      XOR A
0017E7 57E7 12               7      LD  (DE),A      ;ドライブ番号
0017E8 57E8 13               6      INC DE
0017E9 57E9 EDB0                    LDIR            ;ディレクトリエントリ
0017EB 57EB FD750E          19      LD  (IY+14),L
0017EE 57EE FD740F          19      LD  (IY+15),H
0017F1 57F1 C9              10      RET
                                
       57F2                     _SYS12:
0017F2 57F2 FD2AD7F2        20      LD  IY,(_FCB)
0017F6 57F6 FDE5            15      PUSH    IY
0017F8 57F8 D1              10      POP DE
0017F9 57F9 CDC558          17      CALL    INIT_FILE
                                
0017FC 57FC FD6E0E          19      LD  L,(IY+14)
0017FF 57FF FD660F          19      LD  H,(IY+15)
001802 5802 FD4E19          19      LD  C,(IY+25)
001805 5805 18C0            12      JR  S12X1
                                
       5807                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001807 5807 CDBB4F          17      CALL    SET_FCB
00180A 580A CD894F          17      CALL    GETSEQ
00180D 580D CD764F          17      CALL    RB_READ
001810 5810 E5              11      PUSH    HL
001811 5811 CD964F          17      CALL    SETSEQ
001814 5814 E1              10      POP HL
       5815                     SREAD:
001815 5815 C601             7      ADD A,001H
001817 5817 D8              11      RET C
                                
001818 5818 7D               4      LD  A,L
001819 5819 D601             7      SUB 001H
00181B 581B 9F               4      SBC A,A
00181C 581C E603             7      AND 3
00181E 581E 1F               4      RRA
00181F 581F C9              10      RET
                                
       5820                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001820 5820 218300          10      LD  HL,00083H
001823 5823 AF               4      XOR A
001824 5824 C9              10      RET
                                
       5825                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001825 5825 3AEAF2          13      LD  A,(_DVSW)
001828 5828 A7               4      AND A
001829 5829 C9              10      RET
                                
       582A                     _SYS1A:     ;(BDOS)DTAの設定
00182A 582A ED53D4F2        20      LD  (_DTA),DE
00182E 582E AF               4      XOR A
00182F 582F C9              10      RET
                                
       5830                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001830 5830 010002          10      LD  BC,512
001833 5833 11C302          10      LD  DE,707
001836 5836 210000          10      LD  HL,0
001839 5839 DD21D9F2        14      LD  IX,_BUF
00183D 583D FD21D9F2        14      LD  IY,_BUF
001841 5841 FD3600F9        19      LD  (IY+0),0F9H
001845 5845 3E02             7      LD  A,2
001847 5847 C9              10      RET
                                
       5848                     _SYS21:     ;(BDOS)ランダムな読み出し
001848 5848 CDBB4F          17      CALL    SET_FCB
                                
00184B 584B FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00184E 584E FD6622          19      LD  H,(IY+34)
                                
001851 5851 CD764F          17      CALL    RB_READ
001854 5854 18BF            12      JR  SREAD
                                
       5856                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001856 5856 CD5657          17      CALL    _SYS0F
001859 5859 D8              11      RET C
                                
00185A 585A D5              11      PUSH    DE      ;EX DE,IY
00185B 585B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00185D 585D CDAB4F          17      CALL    GETSIZE
       5860                     _S24X1:
001860 5860 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001863 5863 FD7422          19      LD  (IY+34),H
001866 5866 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00186A 586A FDE3            23      EX  (SP),IY     ;
00186C 586C D1              10      POP DE      ;
                                
00186D 586D AF               4      XOR A
00186E 586E C9              10      RET
                                
       586F                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
00186F 586F E5              11      PUSH    HL
001870 5870 D5              11      PUSH    DE      ;EX DE,IY
001871 5871 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001873 5873 CD894F          17      CALL    GETSEQ
001876 5876 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5878                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001878 5878 CDBB4F          17      CALL    SET_FCB
00187B 587B E5              11      PUSH    HL
00187C 587C FD6E21          19      LD  L,(IY+33)
00187F 587F FD6622          19      LD  H,(IY+34)
001882 5882 22CAF2          16      LD  (RR_LOW),HL
001885 5885 FD6E23          19      LD  L,(IY+35)
001888 5888 FD6624          19      LD  H,(IY+36)
00188B 588B 22CCF2          16      LD  (RR_HIGH),HL
00188E 588E E1              10      POP HL
00188F 588F CD464B          17      CALL    ROM_READ
001892 5892 ED5BCAF2        20      LD  DE,(RR_LOW)
001896 5896 FD7321          19      LD  (IY+33),E
001899 5899 FD7222          19      LD  (IY+34),D
00189C 589C ED5BCCF2        20      LD  DE,(RR_HIGH)
0018A0 58A0 FD7323          19      LD  (IY+35),E
0018A3 58A3 FD7224          19      LD  (IY+36),D
0018A6 58A6 9F               4      SBC A,A
0018A7 58A7 C9              10      RET
                                
       58A8                     _SYS2F:
0018A8 58A8 44               4      LD  B,H
0018A9 58A9 2AD4F2          16      LD  HL,(_DTA)
0018AC 58AC C3A852          10      JP  DISKIO
                                
       58AF                     _SYS5A:
0018AF 58AF 0600             7      LD  B,0
0018B1 58B1 D5              11      PUSH    DE
0018B2 58B2 DDE1            14      POP IX
       58B4                     _SX5A1:
0018B4 58B4 1A               7      LD  A,(DE)
0018B5 58B5 B7               4      OR  A
0018B6 58B6 2804            12      JR  Z,_SX5A2
0018B8 58B8 13               6      INC DE
0018B9 58B9 04               4      INC B
0018BA 58BA 18F8            12      JR  _SX5A1
                                
       58BC                     _SX5A2:
0018BC 58BC 78               4      LD  A,B
0018BD 58BD CD114C          17      CALL    FILE_BDOS
0018C0 58C0 CD7550          17      CALL    ROM_CD
0018C3 58C3 9F               4      SBC A,A
0018C4 58C4 C9              10      RET
                                
       58C5                     INIT_FILE:
0018C5 58C5 EB               4      EX  DE,HL
0018C6 58C6 11F8F2          10      LD  DE,FDRV
0018C9 58C9 010C00          10      LD  BC,1+8+3
       58CC                     INIT_FILE1:
0018CC 58CC EDB0                    LDIR
0018CE 58CE CD7B54          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
0018D1 58D1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0018D4 58D4 2AEBF2          16      LD  HL,(_CD)
0018D7 58D7 22F6F2          16      LD  (_CDX),HL           ;カレントディレクトリ
0018DA 58DA C9              10      RET
                                
       58DB                     ZERO_MEMORY_DE:
0018DB 58DB AF               4      XOR A
       58DC                     FILL_MEMORY_DE:
0018DC 58DC 12               7      LD  (DE),A
0018DD 58DD 13               6      INC DE
0018DE 58DE 10FC            13      DJNZ    FILL_MEMORY_DE
0018E0 58E0 C9              10      RET
                                
0018E1 58E1                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 D854EE541F55D854        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 D854D85424557355        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 2C5565558D552156        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001F18 5F18 405746574D575657        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 AC57BA57F257D854        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 0758D854D854D854        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 205825582A583058        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 D8544858D8545658        DW  _ERROR,_SYS21,_ERROR,_SYS23
001F48 5F48 6F58D854D8547858        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 D854D8543356D854        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 8356D854D854A858        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 D854D854AF58D854        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 D854D854D854D854        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
[EOF:DISKROM32.ASM:UTF_8]
