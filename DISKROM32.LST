                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                ;USE_RAM_BLOAD_S    EQU 1   ;先頭のコメントを外すとBLOAD,SでRAMを使う
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3614B          10      JP  DISKIO
000013 4013 C39B4B          10      JP  DSKCHG
000016 4016 C3F14B          10      JP  GETDPB
000019 4019 C3E44C          10      JP  CHOICE
00001C 401C C3E84C          10      JP  DSKFMT
00001F 401F C3EA4C          10      JP  DSKSTP
000022 4022 C3EB4C          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3E84C          10      JP  DSKFMT
000029 4029 C3EA4C          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3F24C          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.1.4.2",0
            204449534B20524F    
            4D204C6974652076    
            302E312E342E3200    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2257F1          16      LD  (BASSTK),HL
000129 4129 ED7B57F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3242F1          13      LD  (_DVSW),A
                                
00013B 413B 21DD42          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017400          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2110F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 210BF1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD2542          17      CALL    GTSL1_
000183 4183 32FCF0          13      LD  (ROM_SLT),A
000186 4186 3272FE          13      LD  (H_BINS+1),A
000189 4189 3277FE          13      LD  (H_BINL+1),A
00018C 418C 327CFE          13      LD  (H_FILE+1),A
00018F 418F 3232F3          13      LD  (H_BDOS+1),A
000192 4192 32DBFE          13      LD  (H_STKE+1),A
000195 4195 32A8FF          13      LD  (H_PHYD+1),A
000198 4198 3222FB          13      LD  (DRVTBL+1),A
00019B 419B 3248F3          13      LD  (MASTERS),A
                                
00019E 419E 217C45          10      LD  HL,ROM_LOAD
0001A1 41A1 2273FE          16      LD  (H_BINS+2),HL
0001A4 41A4 219746          10      LD  HL,ROM_RUN
0001A7 41A7 2278FE          16      LD  (H_BINL+2),HL
0001AA 41AA 21A446          10      LD  HL,ROM_FILES
0001AD 41AD 227DFE          16      LD  (H_FILE+2),HL
0001B0 41B0 213E4D          10      LD  HL,ROM_BDOS
0001B3 41B3 2233F3          16      LD  (H_BDOS+2),HL
0001B6 41B6 217B43          10      LD  HL,ROM_STKE
0001B9 41B9 22DCFE          16      LD  (H_STKE+2),HL
0001BC 41BC 21614B          10      LD  HL,DISKIO
0001BF 41BF 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C2 41C2 3E                      DB  03EH
0001C3 41C3 C9              10      RET
0001C4 41C4 327FFE          13      LD  (H_FILE+4),A
0001C7 41C7 3275FE          13      LD  (H_BINS+4),A
0001CA 41CA 327AFE          13      LD  (H_BINL+4),A
0001CD 41CD 3235F3          13      LD  (H_BDOS+4),A
0001D0 41D0 32DEFE          13      LD  (H_STKE+4),A
0001D3 41D3 32ABFF          13      LD  (H_PHYD+4),A
                                
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    XOR A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  A,(BANK1_ADR)
                                    CP  'A'
                                    JR  NZ,NOT_8K_BANK
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D6 41D6 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D9 41D9 07               4      RLCA
0001DA 41DA 07               4      RLCA
0001DB 41DB F5              11      PUSH    AF
0001DC 41DC CD2A42          17      CALL    GTSL2_
0001DF 41DF 3244F3          13      LD  (RAMAD3),A
0001E2 41E2 F1              10      POP AF  
0001E3 41E3 CD2A42          17      CALL    GTSL2_
0001E6 41E6 3243F3          13      LD  (RAMAD2),A
       41E9                     RAMCHK2:
0001E9 41E9 3A44F3          13      LD  A,(RAMAD3)
0001EC 41EC 2640             7      LD  H,040H
0001EE 41EE CD4142          17      CALL    CHK_RAM
0001F1 41F1 3242F3          13      LD  (RAMAD1),A
       41F4                     RAMCHK1:
0001F4 41F4 3A44F3          13      LD  A,(RAMAD3)
0001F7 41F7 2600             7      LD  H,00H
0001F9 41F9 CD4142          17      CALL    CHK_RAM
0001FC 41FC 3241F3          13      LD  (RAMAD0),A
       41FF                     RAMCHK0:
0001FF 41FF 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000202 4202 010F00          10      LD  BC,0000FH       ;切り上げ
000205 4205 09              11      ADD HL,BC
000206 4206 7D               4      LD  A,L
                                
000207 4207 0604             7      LD  B,4
       4209                     B_DRIVE1:
000209 4209 CB3C             8      SRL H
00020B 420B 1F               4      RRA
00020C 420C 10FB            13      DJNZ    B_DRIVE1
                                
00020E 420E C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000210 4210 3241F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000213 4213 C9              10      RET
                                
       4214                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
000214 4214 21C943          10      LD  HL,MSG_ERROR_ROM_MODE
000217 4217 CD5443          17      CALL    MSX
00021A 421A FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00021E 421E DD219F00        14      LD  IX,CHGET
000222 4222 C31C00          10      JP  _CALSLT
                                
       4225                     GTSL1_:             ;自分のいるスロットを知る
000225 4225 CD3801          17      CALL    RSLREG      ;read primary slot #
000228 4228 0F               4      RRCA
000229 4229 0F               4      RRCA
       422A                     GTSL2_:
00022A 422A E603             7      AND 3       ;[A]=000000PP
00022C 422C 5F               4      LD  E,A     ;[E]=000000PP
00022D 422D 21C1FC          10      LD  HL,EXPTBL
000230 4230 85               4      ADD A,L     ;桁上りは無い
000231 4231 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000232 4232 7B               4      LD  A,E     ;[A]=000000PP
000233 4233 CB7E            13      BIT 7,(HL)
000235 4235 C8              11      RET Z
000236 4236 7D               4      LD  A,L     ;point to SLTTBL entry
000237 4237 C604             7      ADD A,4     ;桁上りは無い
000239 4239 6F               4      LD  L,A
00023A 423A 7E               7      LD  A,(HL)      ;get currently expansion slot register
00023B 423B E60C             7      AND 00CH        ;[A] = 0000SS00
00023D 423D B3               4      OR  E       ;[A] = 0000SSPP
00023E 423E F680             7      OR  080H        ;[A] = 1000SSPP
000240 4240 C9              10      RET
       4241                     GTSL1_E:
                                
       4241                     CHK_RAM:
000241 4241 E5              11      PUSH    HL
000242 4242 CD9642          17      CALL    CHK_RAM0
000245 4245 E1              10      POP HL
000246 4246 C8              11      RET Z
000247 4247 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00024A 424A E680             7      AND 080H
00024C 424C CD6D42          17      CALL    CHK_RAM_SLT
00024F 424F C8              11      RET Z
000250 4250 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000253 4253 E680             7      AND 080H
000255 4255 C601             7      ADD A,1
000257 4257 CD6D42          17      CALL    CHK_RAM_SLT
00025A 425A C8              11      RET Z
00025B 425B 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00025E 425E E680             7      AND 080H
000260 4260 C602             7      ADD A,2
000262 4262 CD6D42          17      CALL    CHK_RAM_SLT
000265 4265 C8              11      RET Z
000266 4266 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000269 4269 E680             7      AND 080H
00026B 426B C603             7      ADD A,3
       426D                     CHK_RAM_SLT:
00026D 426D E5              11      PUSH    HL
00026E 426E CD9642          17      CALL    CHK_RAM0        ;スロット#X or X-0
000271 4271 E1              10      POP HL
000272 4272 C8              11      RET Z
000273 4273 CB79             8      BIT 7,C
000275 4275 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
000277 4277 79               4      LD  A,C
000278 4278 C604             7      ADD A,4         ;スロット#X-1
00027A 427A E5              11      PUSH    HL
00027B 427B CD9642          17      CALL    CHK_RAM0
00027E 427E E1              10      POP HL
00027F 427F C8              11      RET Z
000280 4280 79               4      LD  A,C
000281 4281 C604             7      ADD A,4         ;スロット#X-2
000283 4283 E5              11      PUSH    HL
000284 4284 CD9642          17      CALL    CHK_RAM0
000287 4287 E1              10      POP HL
000288 4288 C8              11      RET Z
000289 4289 79               4      LD  A,C
00028A 428A C604             7      ADD A,4         ;スロット#X-3
00028C 428C E5              11      PUSH    HL
00028D 428D CD9642          17      CALL    CHK_RAM0
000290 4290 E1              10      POP HL
       4291                     CHK_RAM_E:
000291 4291 AF               4      XOR A
000292 4292 3C               4      INC A           ;ZF=0にする
000293 4293 3E00             7      LD  A,0
000295 4295 C9              10      RET
                                
       4296                     CHK_RAM0:
000296 4296 4F               4      LD  C,A
000297 4297 3AFCF0          13      LD  A,(ROM_SLT)
00029A 429A B9               4      CP  C
00029B 429B 28F4            12      JR  Z,CHK_RAM_E
00029D 429D 2E00             7      LD  L,0
       429F                     CHK_RAM1:
00029F 429F 79               4      LD  A,C
0002A0 42A0 DD210C00        14      LD  IX,_RDSLT
0002A4 42A4 CDD142          17      CALL    CALSLT_R
0002A7 42A7 C6E5             7      ADD A,0E5H
0002A9 42A9 47               4      LD  B,A
0002AA 42AA 5F               4      LD  E,A
0002AB 42AB 79               4      LD  A,C
0002AC 42AC DD211400        14      LD  IX,_WRSLT
0002B0 42B0 CDD142          17      CALL    CALSLT_R
0002B3 42B3 79               4      LD  A,C
0002B4 42B4 DD210C00        14      LD  IX,_RDSLT
0002B8 42B8 CDD142          17      CALL    CALSLT_R
0002BB 42BB B8               4      CP  B
0002BC 42BC C0              11      RET NZ
0002BD 42BD D6E5             7      SUB 0E5H
0002BF 42BF 79               4      LD  A,C
0002C0 42C0 5F               4      LD  E,A
0002C1 42C1 DD211400        14      LD  IX,_WRSLT
0002C5 42C5 CDD142          17      CALL    CALSLT_R
0002C8 42C8 24               4      INC H
0002C9 42C9 7D               4      LD  A,L
0002CA 42CA C604             7      ADD A,4
0002CC 42CC 6F               4      LD  L,A
0002CD 42CD 20D0            12      JR  NZ,CHK_RAM1
0002CF 42CF 79               4      LD  A,C     ;ZF=1のハズ
0002D0 42D0 C9              10      RET
                                
       42D1                     CALSLT_R:
0002D1 42D1 C5              11      PUSH    BC
0002D2 42D2 E5              11      PUSH    HL
0002D3 42D3 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002D7 42D7 CD1C00          17      CALL    _CALSLT
0002DA 42DA E1              10      POP HL
0002DB 42DB C1              10      POP BC
0002DC 42DC C9              10      RET
                                
       42DD                     AT_ISC:
0002DD F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
0002DD F0E9 FEB7             7      CP  0B7H            ;FILES
0002DF F0EB CC7BFE          17      CALL    Z,H_FILE
0002E2 F0EE FEB5             7      CP  0B5H            ;LOAD
0002E4 F0F0 CA71FE          10      JP  Z,H_BINS
0002E7 F0F3 FE8A             7      CP  08AH            ;RUN
0002E9 F0F5 CA76FE          10      JP  Z,H_BINL
0002EC F0F8 FECF             7      CP  0CFH            ;BLOAD
0002EE F0FA C0              11      RET NZ
       F0FB                     FIX_BLOAD:
0002EF F0FB F7              12      RST 30H
       F0FC                     ROM_SLT:
0002F0 F0FC 00                      DB  0
0002F1 F0FD D945                    DW  ROM_BLOAD
0002F3 F0FF F5              11      PUSH    AF
0002F4 F100 E5              11      PUSH    HL
0002F5 F101 CD0AF1          17      CALL    BLOAD_RET
       F102                     SWC_BLOAD   EQU $-2
0002F8 F104 E1              10      POP HL
0002F9 F105 F1              10      POP AF
0002FA F106 FECF             7      CP  0CFH            ;BLOAD
       F108                     SWC_BLOAD_M:
0002FC F108 28DF            12      JR  Z,REPLACE_COMMAND
       F10A                     BLOAD_RET:
0002FE F10A C9              10      RET
       F10B                     ROMUSE1:
0002FF F10B 3AFCF0          13      LD  A,(ROM_SLT)
000302 F10E 1803            12      JR  ROMUSE2
       F110                     RAMUSE1:
000304 F110 3A42F3          13      LD  A,(RAMAD1)
       F113                     ROMUSE2:
000307 F113 DD212400        14      LD  IX,_ENASLT
00030B F117 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00030F F11B C31C00          10      JP  _CALSLT
                                
       F11E                     _RESULT:
000312 F11E 00                      DB  0
       F11F                     _BANK:
000313 F11F 00                      DB  0
       F120                     CLSZ:               ;クラスタサイズ
000314 F120 0004                    DW  1024
       F121                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F122                     SECSZ:              ;セクタサイズ
000316 F122 0002                    DW  512
       F123                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F124                     RR_LOW:
000318 F124 0000                    DW  0
       F125                     RR_MID  EQU $-1
       F126                     RR_HIGH:
00031A F126 0000                    DW  0
       F128                     _CLPS:
00031C F128 0000                    DW  0
       F12A                     _LEFT:
00031E F12A 0000                    DW  0
       F12C                     _DTPS:
000320 F12C 0000                    DW  0
       F12E                     _DTA:
000322 F12E 0000                    DW  0
                                #if exists USE_RAM_BLOAD_S
                                #else
       F130                     FLG_LDIR:
000324 F130 00                      DB  0
                                #endif
                                ;   BDOS
000325 F131 F7              12      RST 30H
000326 F132 00                      DB  0
000327 F133 3E4D                    DW  ROM_BDOS
000329 F135 C9              10      RET 
       F136                     _FCB:
00032A F136 0000                    DW  0
       F138                     _BUF:
00032C F138 00                      DB  0
       F139                     _BUF_ST:
00032D F139 0000                    DW  0
       F13B                     _BUF_EN:
00032F F13B 0000                    DW  0
       F13D                     _BUF_EX:
000331 F13D 0000                    DW  0
                                
       F13F                     DTAX:
000333 F13F 0000                    DW  0
       F141                     B_DRIVE:
000335 F141 00                      DB  0
       F142                     _DVSW:
000336 F142 00                      DB  0
       F143                     FCBX:
000337 F143 0000                    DW  0
       F145                     LEFTX:
000339 F145 0000                    DW  0
       F147                     PARAM0:
00033B F147 0000                    DW  0
       F149                     PARAM1:
00033D F149 0000                    DW  0
       F14B                     FDRV:
00033F F14B 00                      DB  0
       F14C                     FNAME:
000340 F14C                         DS  8+3
                                
       F157                     BASSTK:
00034B F157 0000                    DW  0
       F159                     _HL:
00034D F159 0000                    DW  0
       F15B                     _SP:
00034F F15B 0000                    DW  0
                                
       F15D                     ISC_E:
000351 4351                         ORG $$+RUN          ;$DEPHASE
                                
       4351                     MSX1:
000351 4351 CD574D          17      CALL    MSGA1
       4354                     MSX:
000354 4354 7E               7      LD  A,(HL)
000355 4355 23               6      INC HL
000356 4356 B7               4      OR  A
000357 4357 20F8            12      JR  NZ,MSX1
000359 4359 C9              10      RET
                                
       435A                     PRTHX:
00035A 435A F5              11      PUSH    AF
00035B 435B 07               4      RLCA
00035C 435C 07               4      RLCA
00035D 435D 07               4      RLCA
00035E 435E 07               4      RLCA
00035F 435F CD6343          17      CALL    PRTA2
000362 4362 F1              10      POP AF
       4363                     PRTA2:
000363 4363 CD6943          17      CALL    ASC
000366 4366 C3534D          10      JP  MSG_A
                                    
       4369                     ASC:
000369 4369 E60F             7      AND $0F
00036B 436B F630             7      OR  $30
00036D 436D FE3A             7      CP  $3A
00036F 436F D8              11      RET C
000370 4370 C607             7      ADD A,7
000372 4372 C9              10      RET
                                
       4373                     MSN:
000373 4373 7E               7      LD  A,(HL)
000374 4374 23               6      INC HL
000375 4375 CD534D          17      CALL    MSG_A
000378 4378 10F9            13      DJNZ    MSN
00037A 437A C9              10      RET
                                
       437B                     ROM_STKE:
00037B 437B 3E                      DB  03EH
00037C 437C C9              10      RET
00037D 437D 32DAFE          13      LD  (H_STKE),A
000380 4380 E5              11      PUSH    HL
000381 4381 D5              11      PUSH    DE
000382 4382 C5              11      PUSH    BC
000383 4383 181D            12      JR  BASAUTO
                                
000385 4385 AF               4      XOR A
000386 4386 5F               4      LD  E,A
000387 4387 57               4      LD  D,A
000388 4388 0601             7      LD  B,1
00038A 438A 2100C0          10      LD  HL,0C000H
00038D 438D CD614B          17      CALL    DISKIO
                                
000390 4390 ED7357F1        20      LD  (BASSTK),SP
000394 4394 116BF3          10      LD  DE,RAMUSE
000397 4397 AF               4      XOR A
000398 4398 CD1EC0          17      CALL    0C01EH
00039B 439B 116BF3          10      LD  DE,RAMUSE
00039E 439E 37               4      SCF
00039F 439F CD1EC0          17      CALL    0C01EH
       43A2                     BASAUTO:
0003A2 43A2 21EF43          10      LD  HL,AUTOEXEC
0003A5 43A5 114BF1          10      LD  DE,FDRV
0003A8 43A8 010C00          10      LD  BC,1+8+3
0003AB 43AB EDB0                    LDIR
0003AD 43AD CD0549          17      CALL    ROM_OPEN
0003B0 43B0 3813            12      JR  C,RSTKEE
0003B2 43B2 21FB43          10      LD  HL,RUN_AUTOEXEC
0003B5 43B5 11F0FB          10      LD  DE,KEYBUF
0003B8 43B8 ED53FAF3        20      LD  (GETPNT),DE
0003BC 43BC 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003BF 43BF EDB0                    LDIR
0003C1 43C1 ED53F8F3        20      LD  (PUTPNT),DE
       43C5                     RSTKEE:
0003C5 43C5 C1              10      POP BC
0003C6 43C6 D1              10      POP DE
0003C7 43C7 E1              10      POP HL
0003C8 43C8 C9              10      RET
                                
       43C9                     MSG_ERROR_ROM_MODE:
0003C9 43C9 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
       43EE                     NULL:
0003EE 43EE 00                      DB  0
                                
       43EF                     AUTOEXEC:
0003EF 43EF 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       43FB                     RUN_AUTOEXEC:
0003FB 43FB 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       440E                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       440E                     ROM_LDIR:
                                #if exists USE_RAM_BLOAD_S
                                #else
00040E 440E 3A30F1          13      LD  A,(FLG_LDIR)
000411 4411 B7               4      OR  A
000412 4412 2062            12      JR  NZ,ROM_LDIRVM
                                #endif
000414 4414 CB7A             8      BIT 7,D
000416 4416 CA9E44          10      JP  Z,ROM_LDIRSLT
                                
                                #if exists USE_NORMAL_32K_ROM
000419 4419 ED735BF1        20      LD  (_SP),SP
00041D 441D 3121FB          10      LD  SP,DRVTBL
       4420                     LDIR1:
000420 4420 78               4      LD  A,B
000421 4421 B1               4      OR  C
000422 4422 2841            12      JR  Z,LDIRE
                                
000424 4424 C5              11      PUSH    BC
000425 4425 D5              11      PUSH    DE
000426 4426 E5              11      PUSH    HL
000427 4427 3AFCF0          13      LD  A,(ROM_SLT)
00042A 442A 2680             7      LD  H,080H
00042C 442C CD2400          17      CALL    _ENASLT
00042F 442F E1              10      POP HL
000430 4430 D1              10      POP DE
000431 4431 C1              10      POP BC
       4432                     LDIR2:
000432 4432 7A               4      LD  A,D
000433 4433 FEC0             7      CP  0C0H
000435 4435 302C            12      JR  NC,LDIR4
                                
000437 4437 C5              11      PUSH    BC
000438 4438 D5              11      PUSH    DE
000439 4439 115EF5          10      LD  DE,BUF
                                
00043C 443C 78               4      LD  A,B
00043D 443D B7               4      OR  A
00043E 443E 2803            12      JR  Z,LDIR3
000440 4440 010001          10      LD  BC,00100H
       4443                     LDIR3:
000443 4443 C5              11      PUSH    BC
000444 4444 EDB0                    LDIR
000446 4446 2259F1          16      LD  (_HL),HL
                                
000449 4449 3A43F3          13      LD  A,(RAMAD2)
00044C 444C 2680             7      LD  H,080H
00044E 444E CD2400          17      CALL    _ENASLT
                                
000451 4451 215EF5          10      LD  HL,BUF
000454 4454 C1              10      POP BC
000455 4455 D1              10      POP DE
000456 4456 EDB0                    LDIR
                                
000458 4458 2A59F1          16      LD  HL,(_HL)
00045B 445B C1              10      POP BC
00045C 445C 78               4      LD  A,B
00045D 445D B7               4      OR  A
00045E 445E 2805            12      JR  Z,LDIRE
000460 4460 05               4      DEC B
000461 4461 18BD            12      JR  LDIR1
       4463                     LDIR4:
                                #endif
000463 4463 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       4465                     LDIRE:
000465 4465 D5              11      PUSH    DE
000466 4466 E5              11      PUSH    HL
000467 4467 3A43F3          13      LD  A,(RAMAD2)
00046A 446A 2680             7      LD  H,080H
00046C 446C CD2400          17      CALL    _ENASLT
00046F 446F E1              10      POP HL
000470 4470 D1              10      POP DE
000471 4471 ED7B5BF1        20      LD  SP,(_SP)
                                #endif
000475 4475 C9              10      RET
                                
       4476                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
000476 4476 C5              11      PUSH    BC
000477 4477 D5              11      PUSH    DE
000478 4478 E5              11      PUSH    HL
000479 4479 3AFCF0          13      LD  A,(ROM_SLT)
00047C 447C 2680             7      LD  H,080H
00047E 447E CD2400          17      CALL    _ENASLT
000481 4481 E1              10      POP HL
000482 4482 D1              10      POP DE
000483 4483 C1              10      POP BC
                                #endif
000484 4484 C5              11      PUSH    BC
000485 4485 D5              11      PUSH    DE
000486 4486 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00048A 448A DD215C00        14      LD  IX,LDIRVM
00048E 448E CD1C00          17      CALL    _CALSLT
                                #if exists USE_NORMAL_32K_ROM
000491 4491 2680             7      LD  H,080H
000493 4493 3A43F3          13      LD  A,(RAMAD2)
000496 4496 CD2400          17      CALL    _ENASLT
                                #endif
000499 4499 E1              10      POP HL
00049A 449A C1              10      POP BC
00049B 449B 09              11      ADD HL,BC
00049C 449C EB               4      EX  DE,HL
00049D 449D C9              10      RET
                                
       449E                     ROM_LDIRSLT:
00049E 449E EB               4      EX  DE,HL
       449F                     RLDIRSLT1:
00049F 449F 1A               7      LD  A,(DE)
0004A0 44A0 13               6      INC DE
0004A1 44A1 C5              11      PUSH    BC
0004A2 44A2 D5              11      PUSH    DE
0004A3 44A3 E5              11      PUSH    HL
0004A4 44A4 5F               4      LD  E,A
0004A5 44A5 3A42F3          13      LD  A,(RAMAD1)
0004A8 44A8 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004AC 44AC DD211400        14      LD  IX,_WRSLT
0004B0 44B0 CD1C00          17      CALL    _CALSLT
0004B3 44B3 E1              10      POP HL
0004B4 44B4 D1              10      POP DE
0004B5 44B5 C1              10      POP BC
0004B6 44B6 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004B8 44B8 EA9F44          10      JP  PE,RLDIRSLT1
0004BB 44BB EB               4      EX  DE,HL
0004BC 44BC C9              10      RET
                                
       44BD                     END_OF_LINE:
0004BD 44BD 215EF5          10      LD  HL,BUF
       44C0                     EOL1:
0004C0 44C0 7E               7      LD  A,(HL)
0004C1 44C1 C8              11      RET Z
0004C2 44C2 FE0D             7      CP  00DH
0004C4 44C4 2807            12      JR  Z,EOLE
0004C6 44C6 FE0A             7      CP  00AH
0004C8 44C8 2803            12      JR  Z,EOLE
0004CA 44CA 23               6      INC HL
0004CB 44CB 18F3            12      JR  EOL1
       44CD                     EOLE:
0004CD 44CD 3600            10      LD  (HL),0
0004CF 44CF 23               6      INC HL
0004D0 44D0 7E               7      LD  A,(HL)
0004D1 44D1 FE0A             7      CP  00AH
0004D3 44D3 C0              11      RET NZ
0004D4 44D4 23               6      INC HL
0004D5 44D5 C9              10      RET
                                
       44D6                     ROM_LOAD_ASCII:
0004D6 44D6 210000          10      LD  HL,0
0004D9 44D9 2239F1          16      LD  (_BUF_ST),HL    ;読み出し位置
0004DC 44DC 2A76F6          16      LD  HL,(TXTTAB)
0004DF 44DF 223BF1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
0004E2 44E2 215EF5          10      LD  HL,BUF
0004E5 44E5 222EF1          16      LD  (_DTA),HL
       44E8                     RLOAD_A1:
0004E8 44E8 2A39F1          16      LD  HL,(_BUF_ST)
0004EB 44EB 2224F1          16      LD  (RR_LOW),HL
0004EE 44EE 210201          10      LD  HL,258
0004F1 44F1 CD2547          17      CALL    ROM_READ
0004F4 44F4 7C               4      LD  A,H
0004F5 44F5 B5               4      OR  L
0004F6 44F6 2877            12      JR  Z,RLOAD_AEND
0004F8 44F8 015EF5          10      LD  BC,BUF
0004FB 44FB 09              11      ADD HL,BC
0004FC 44FC 3600            10      LD  (HL),0
0004FE 44FE CDBD44          17      CALL    END_OF_LINE
000501 4501 015EF5          10      LD  BC,BUF
000504 4504 A7               4      AND A
000505 4505 ED42            15      SBC HL,BC
000507 4507 2810            12      JR  Z,RLOAD_A2
000509 4509 4D               4      LD  C,L
00050A 450A 44               4      LD  B,H
00050B 450B ED5B39F1        20      LD  DE,(_BUF_ST)
00050F 450F 19              11      ADD HL,DE
000510 4510 2239F1          16      LD  (_BUF_ST),HL
000513 4513 3A5EF5          13      LD  A,(BUF)
000516 4516 B7               4      OR  A
000517 4517 28CF            12      JR  Z,RLOAD_A1
       4519                     RLOAD_A2:
000519 4519 115EF5          10      LD  DE,BUF
00051C 451C CD9C48          17      CALL    SPCUTEX
00051F 451F 1A               7      LD  A,(DE)
000520 4520 B7               4      OR  A
000521 4521 284C            12      JR  Z,RLOAD_AEND
000523 4523 CDAE48          17      CALL    GETNUM
000526 4526 7C               4      LD  A,H
000527 4527 B5               4      OR  L
000528 4528 CAC645          10      JP  Z,ERROR_DIRECT_IN_FILE
00052B 452B DD2A3BF1        20      LD  IX,(_BUF_EN)
00052F 452F DD7502          19      LD  (IX+2),L
000532 4532 DD7403          19      LD  (IX+3),H
                                
000535 4535 CD9548          17      CALL    SPCUT
000538 4538 EB               4      EX  DE,HL
000539 4539 DDE5            15      PUSH    IX
00053B 453B DD21B242        14      LD  IX,CRUNCH
00053F 453F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000543 4543 CD1C00          17      CALL    _CALSLT
000546 4546 DDE1            14      POP IX
000548 4548 EB               4      EX  DE,HL
000549 4549 111FF4          10      LD  DE,KBUF
00054C 454C 37               4      SCF
00054D 454D ED52            15      SBC HL,DE
00054F 454F 2875            12      JR  Z,ERROR_DIRECT_IN_FILE
000551 4551 3873            12      JR  C,ERROR_DIRECT_IN_FILE
000553 4553 4D               4      LD  C,L
000554 4554 44               4      LD  B,H
000555 4555 2A3BF1          16      LD  HL,(_BUF_EN)
000558 4558 110400          10      LD  DE,4
00055B 455B 19              11      ADD HL,DE
00055C 455C 111FF4          10      LD  DE,KBUF
                                
00055F 455F EB               4      EX  DE,HL
000560 4560 EDB0                    LDIR
000562 4562 EB               4      EX  DE,HL
                                
000563 4563 DD7500          19      LD  (IX+0),L
000566 4566 DD7401          19      LD  (IX+1),H
000569 4569 223BF1          16      LD  (_BUF_EN),HL
00056C 456C C3E844          10      JP  RLOAD_A1
                                
       456F                     RLOAD_AEND:
00056F 456F 2A3BF1          16      LD  HL,(_BUF_EN)
000572 4572 AF               4      XOR A
000573 4573 77               7      LD  (HL),A
000574 4574 23               6      INC HL
000575 4575 77               7      LD  (HL),A
000576 4576 23               6      INC HL
000577 4577 223BF1          16      LD  (_BUF_EN),HL
00057A 457A 1833            12      JR  RLOAD_END1
                                
       457C                     ROM_LOAD:
00057C 457C CDFA46          17      CALL    INIT_PARAM
00057F 457F CDC547          17      CALL    FILE_B
000582 4582 CD0549          17      CALL    ROM_OPEN
000585 4585 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000587 4587 2138F1          10      LD  HL,_BUF
00058A 458A 222EF1          16      LD  (_DTA),HL
00058D 458D 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
000590 4590 CD2547          17      CALL    ROM_READ
000593 4593 3A38F1          13      LD  A,(_BUF)
000596 4596 3C               4      INC A
000597 4597 C2D644          10      JP  NZ,ROM_LOAD_ASCII
00059A 459A 2A76F6          16      LD  HL,(TXTTAB)
00059D 459D 222EF1          16      LD  (_DTA),HL
0005A0 45A0 EB               4      EX  DE,HL
0005A1 45A1 2100FF          10      LD  HL,-256
0005A4 45A4 39              11      ADD HL,SP
0005A5 45A5 ED52            15      SBC HL,DE
0005A7 45A7 CD2547          17      CALL    ROM_READ
0005AA 45AA ED5B2EF1        20      LD  DE,(_DTA)
0005AE 45AE 19              11      ADD HL,DE
       45AF                     RLOAD_END1:
0005AF 45AF 22C2F6          16      LD  (VARTAB),HL
0005B2 45B2 22C4F6          16      LD  (ARYTAB),HL
0005B5 45B5 22C6F6          16      LD  (STREND),HL
                                
0005B8 45B8 AF               4      XOR A
0005B9 45B9 213BF1          10      LD  HL,_BUF+3
0005BC 45BC 77               7      LD  (HL),A
0005BD 45BD 2B               6      DEC HL
0005BE 45BE 77               7      LD  (HL),A
0005BF 45BF 2B               6      DEC HL
0005C0 45C0 77               7      LD  (HL),A
0005C1 45C1 2B               6      DEC HL
0005C2 45C2 3E8F             7      LD  A,08FH          ;REM
0005C4 45C4 77               7      LD  (HL),A
0005C5 45C5 C9              10      RET
                                
       45C6                     ERROR_DIRECT_IN_FILE:
0005C6 45C6 1E39             7      LD  E,57            ;Direct statement in file
0005C8 45C8 01                      DB  1           ;LD BC,
       45C9                     ERROR_FILE_NOT_OPEN:
0005C9 45C9 1E3B             7      LD  E,59            ;File not OPEN
0005CB 45CB 01                      DB  1           ;LD BC,
       45CC                     ERROR_FILE_NOT_FOUND:
0005CC 45CC 1E35             7      LD  E,53            ;File not found
       45CE                     ERROR:
0005CE 45CE FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005D2 45D2 DD216F40        14      LD  IX,ERRHAND
0005D6 45D6 C31C00          10      JP  _CALSLT
                                
       45D9                     ROM_BLOAD:
0005D9 45D9 CDFA46          17      CALL    INIT_PARAM
0005DC 45DC CDC547          17      CALL    FILE_B
0005DF 45DF CD0549          17      CALL    ROM_OPEN
0005E2 45E2 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005E4 45E4 2138F1          10      LD  HL,_BUF
0005E7 45E7 222EF1          16      LD  (_DTA),HL
0005EA 45EA 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005ED 45ED CD2547          17      CALL    ROM_READ
0005F0 45F0 3A38F1          13      LD  A,(_BUF)
0005F3 45F3 FEFE             7      CP  0FEH
0005F5 45F5 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0005F7 45F7 210AF1          10      LD  HL,BLOAD_RET
0005FA 45FA 2202F1          16      LD  (SWC_BLOAD),HL
                                
0005FD 45FD 2A49F1          16      LD  HL,(PARAM1)
000600 4600 7E               7      LD  A,(HL)
000601 4601 FE2C             7      CP  ','
000603 4603 2048            12      JR  NZ,RBREAD_MEM
000605 4605 23               6      INC HL
000606 4606 7E               7      LD  A,(HL)
000607 4607 CDEF48          17      CALL    CAP
00060A 460A 32BEFC          13      LD  (RUNBNF),A
       460D                     RBOS1:
00060D 460D 7E               7      LD  A,(HL)
00060E 460E 23               6      INC HL
00060F 460F B7               4      OR  A
000610 4610 282F            12      JR  Z,RBREAD_OSE
000612 4612 FE3A             7      CP  ':'
000614 4614 282B            12      JR  Z,RBREAD_OSE
000616 4616 FE2C             7      CP  ','     ;次のパラメータを探す
000618 4618 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
00061A 461A 2249F1          16      LD  (PARAM1),HL
00061D 461D 7E               7      LD  A,(HL)
00061E 461E B7               4      OR  A
00061F 461F 2820            12      JR  Z,RBREAD_OSE
000621 4621 DD21644C        14      LD  IX,FRMEVL
000625 4625 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000629 4629 CD1C00          17      CALL    _CALSLT
00062C 462C 2249F1          16      LD  (PARAM1),HL
00062F 462F 3A63F6          13      LD  A,(VALTYP)
000632 4632 FE02             7      CP  2
000634 4634 200B            12      JR  NZ,RBREAD_OSE
000636 4636 2A39F1          16      LD  HL,(_BUF_ST)
000639 4639 ED5BF8F7        20      LD  DE,(DACDAT)
00063D 463D 19              11      ADD HL,DE
00063E 463E 2239F1          16      LD  (_BUF_ST),HL
       4641                     RBREAD_OSE:
000641 4641 3ABEFC          13      LD  A,(RUNBNF)
000644 4644 FE53             7      CP  'S'
                                #if exists USE_RAM_BLOAD_S
                                    JR  Z,ROM_BLOAD_SCREEN
                                #else
000646 4646 2005            12      JR  NZ,RBREAD_MEM
000648 4648 3E01             7      LD  A,1
00064A 464A 3230F1          13      LD  (FLG_LDIR),A
                                #endif
       464D                     RBREAD_MEM:
00064D 464D 2A39F1          16      LD  HL,(_BUF_ST)
000650 4650 22BFFC          16      LD  (SAVENT),HL
000653 4653 222EF1          16      LD  (_DTA),HL
000656 4656 21FFFF          10      LD  HL,0FFFFH
000659 4659 CD2547          17      CALL    ROM_READ
00065C 465C 3ABEFC          13      LD  A,(RUNBNF)
00065F 465F FE52             7      CP  'R'
000661 4661 2006            12      JR  NZ,RBREAD1
000663 4663 2A3DF1          16      LD  HL,(_BUF_EX)
000666 4666 2202F1          16      LD  (SWC_BLOAD),HL
       4669                     RBREAD1:
       4669                     ROM_NEXT:
000669 4669 2A49F1          16      LD  HL,(PARAM1)
00066C 466C 7E               7      LD  A,(HL)
00066D 466D 2B               6      DEC HL
00066E 466E B7               4      OR  A
00066F 466F 2805            12      JR  Z,RN1
000671 4671 FE3A             7      CP  ':'
000673 4673 2801            12      JR  Z,RN1
000675 4675 23               6      INC HL
       4676                     RN1:
000676 4676 5D               4      LD  E,L
000677 4677 54               4      LD  D,H
                                
000678 4678 CDC548          17      CALL    SEARCH_END
00067B 467B B7               4      OR  A
00067C 467C 2815            12      JR  Z,REM
                                                    ;マルチステートメントの処理
00067E 467E 7E               7      LD  A,(HL)
                                
00067F 467F FEB5             7      CP  0B5H            ;LOAD
000681 4681 CA7C45          10      JP  Z,ROM_LOAD
000684 4684 FE8A             7      CP  08AH            ;RUN
000686 4686 280F            12      JR  Z,ROM_RUN
000688 4688 FEB7             7      CP  0B7H            ;FILES
00068A 468A 2818            12      JR  Z,ROM_FILES
00068C 468C 3E28             7      LD  A,028H          ;JR Z,
00068E 468E 3208F1          13      LD  (SWC_BLOAD_M),A
000691 4691 7E               7      LD  A,(HL)
000692 4692 C9              10      RET
                                
       4693                     REM:
000693 4693 EB               4      EX  DE,HL
000694 4694 3E8F             7      LD  A,08FH          ;REM
000696 4696 C9              10      RET
                                
                                #if exists USE_RAM_BLOAD_S
                                ROM_BLOAD_SCREEN:
                                    LD  HL,(STREND)
                                    LD  (_DTA),HL
                                    EX  DE,HL
                                    LD  HL,-512
                                    ADD HL,SP
                                    XOR A
                                    SBC HL,DE
                                    JR  NC,RBS0
                                    LD  HL,BUF
                                    LD  (_DTA),HL
                                    LD  L,A ;0
                                    LD  H,A ;0
                                RBS0:
                                    INC H
                                    LD  (_BUF_EN),HL
                                RBS1:
                                    LD  HL,(_BUF_EN)
                                    CALL    ROM_READ
                                    LD  A,H
                                    OR  L
                                    JR  Z,ROM_NEXT
                                
                                    PUSH    HL
                                    LD  C,L
                                    LD  B,H
                                    LD  HL,(_DTA)   ;転送元
                                    LD  DE,(_BUF_ST)    ;転送先
                                
                                    LD  IY,(EXPTBL-1)   ;メインROMスロット
                                    LD  IX,LDIRVM
                                    CALL    _CALSLT
                                
                                    LD  HL,(_BUF_ST)
                                    POP DE
                                    ADD HL,DE
                                    LD  (_BUF_ST),HL
                                    JR  RBS1
                                #endif
                                
       4697                     ROM_RUN:
000697 4697 23               6      INC HL
000698 4698 7E               7      LD  A,(HL)
000699 4699 2B               6      DEC HL
00069A 469A B7               4      OR  A
00069B 469B 2803            12      JR  Z,ROM_RUN1
00069D 469D CD7C45          17      CALL    ROM_LOAD
       46A0                     ROM_RUN1:
0006A0 46A0 3E8A             7      LD  A,08AH          ;RUN
0006A2 46A2 77               7      LD  (HL),A
0006A3 46A3 C9              10      RET
                                
       46A4                     ROM_FILES:
0006A4 46A4 CDFA46          17      CALL    INIT_PARAM
0006A7 46A7 CDC547          17      CALL    FILE_B
0006AA 46AA CDF64C          17      CALL    GET_DISK_BANK_FDRV
0006AD 46AD 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0006B0 46B0 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0006B3 46B3 3A4CF1          13      LD  A,(FNAME)
0006B6 46B6 FE21             7      CP  021H
0006B8 46B8 3005            12      JR  NC,RFILES0
0006BA 46BA 060B             7      LD  B,11
0006BC 46BC CD5948          17      CALL    FILE10
       46BF                     RFILES0:
0006BF 46BF CD224B          17      CALL    GET_DIR_DAT
       46C2                     RFILES1:
0006C2 46C2 CD2149          17      CALL    FILESE
0006C5 46C5 302E            12      JR  NC,RFILES_NOT_MATCH
       46C7                     RFILES_DISP:
0006C7 46C7 E5              11      PUSH    HL
0006C8 46C8 0608             7      LD  B,8
0006CA 46CA CD7343          17      CALL    MSN
0006CD 46CD 3E2E             7      LD  A,'.'
0006CF 46CF CD534D          17      CALL    MSG_A
0006D2 46D2 0603             7      LD  B,3
0006D4 46D4 CD7343          17      CALL    MSN
0006D7 46D7 3ADDF3          13      LD  A,(CSRX)
0006DA 46DA 47               4      LD  B,A
0006DB 46DB 3AB0F3          13      LD  A,(LINLEN)
0006DE 46DE 90               4      SUB B
0006DF 46DF FE0C             7      CP  12
0006E1 46E1 3009            12      JR  NC,RFILES2
0006E3 46E3 3E0D             7      LD  A,00DH      ;改行
0006E5 46E5 CD534D          17      CALL    MSG_A
0006E8 46E8 3E0A             7      LD  A,00AH
0006EA 46EA 1802            12      JR  RFILES3
       46EC                     RFILES2:
0006EC 46EC 3E20             7      LD  A,020H
       46EE                     RFILES3:
0006EE 46EE CD534D          17      CALL    MSG_A
0006F1 46F1 E1              10      POP HL
0006F2 46F2 CD3D49          17      CALL    FNEXT
       46F5                     RFILES_NOT_MATCH:
0006F5 46F5 20CB            12      JR  NZ,RFILES1
0006F7 46F7 C36946          10      JP  ROM_NEXT
                                
       46FA                     INIT_PARAM:
0006FA 46FA 2247F1          16      LD  (PARAM0),HL
0006FD 46FD 2249F1          16      LD  (PARAM1),HL
000700 4700 EB               4      EX  DE,HL
000701 4701 AF               4      XOR A
                                #if exists USE_RAM_BLOAD_S
                                #else
000702 4702 3230F1          13      LD  (FLG_LDIR),A
                                #endif
000705 4705 32BEFC          13      LD  (RUNBNF),A
000708 4708 3263F6          13      LD  (VALTYP),A
00070B 470B 13               6      INC DE
00070C 470C CD9548          17      CALL    SPCUT
00070F 470F 1A               7      LD  A,(DE)
000710 4710 B7               4      OR  A
000711 4711 C8              11      RET Z
000712 4712 FE3A             7      CP  ':'
000714 4714 C8              11      RET Z
000715 4715 EB               4      EX  DE,HL
000716 4716 DD21644C        14      LD  IX,FRMEVL
00071A 471A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00071E 471E CD1C00          17      CALL    _CALSLT
000721 4721 2249F1          16      LD  (PARAM1),HL
000724 4724 C9              10      RET
                                
       4725                     ROM_READ:
000725 4725 E5              11      PUSH    HL
000726 4726 D5              11      PUSH    DE
000727 4727 C5              11      PUSH    BC
000728 4728 FDE5            15      PUSH    IY
00072A 472A 2245F1          16      LD  (LEFTX),HL
00072D 472D 2A2EF1          16      LD  HL,(_DTA)
000730 4730 223FF1          16      LD  (DTAX),HL
000733 4733 2A45F1          16      LD  HL,(LEFTX)
                                
000736 4736 CD6949          17      CALL    RBX1
000739 4739 3870            12      JR  C,RBRERR1
00073B 473B 79               4      LD  A,C
00073C 473C EB               4      EX  DE,HL
00073D 473D ED52            15      SBC HL,DE       ;CP 0HL,CDE
00073F 473F 19              11      ADD HL,DE
000740 4740 DE00             7      SBC A,000H
000742 4742 3801            12      JR  C,RBR1
000744 4744 EB               4      EX  DE,HL
       4745                     RBR1:
000745 4745 9F               4      SBC A,A
000746 4746 E601             7      AND 1
000748 4748 321EF1          13      LD  (_RESULT),A
00074B 474B 7C               4      LD  A,H
00074C 474C B5               4      OR  L
00074D 474D CAA147          10      JP  Z,RBREND0
                                
000750 4750 222AF1          16      LD  (_LEFT),HL  ;Read record byte
000753 4753 2245F1          16      LD  (LEFTX),HL
                                
000756 4756 CD8F49          17      CALL    RBX2
000759 4759 281A            12      JR  Z,RBRB
                                                ;先頭の端数
00075B 475B CDA249          17      CALL    RBXA
00075E 475E DAB747          10      JP  C,RBRERR
000761 4761 C5              11      PUSH    BC
000762 4762 CD0E44          17      CALL    ROM_LDIR
000765 4765 ED533FF1        20      LD  (DTAX),DE
000769 4769 2A45F1          16      LD  HL,(LEFTX)
00076C 476C D1              10      POP DE
00076D 476D A7               4      AND A
00076E 476E ED52            15      SBC HL,DE
000770 4770 2245F1          16      LD  (LEFTX),HL
000773 4773 2829            12      JR  Z,RBREND
                                
       4775                     RBRB:
000775 4775 CDDE49          17      CALL    RBXB
000778 4778 2818            12      JR  Z,RBRC
       477A                     RBRB1:
00077A 477A C5              11      PUSH    BC
00077B 477B D5              11      PUSH    DE
00077C 477C CD864A          17      CALL    CLUST
00077F 477F EB               4      EX  DE,HL
000780 4780 ED4B20F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000784 4784 CD0E44          17      CALL    ROM_LDIR
000787 4787 EB               4      EX  DE,HL
000788 4788 D1              10      POP DE
000789 4789 C1              10      POP BC
00078A 478A CD634A          17      CALL    GNCL
00078D 478D DAB747          10      JP  C,RBRERR
000790 4790 10E8            13      DJNZ    RBRB1
       4792                     RBRC:
000792 4792 CDF649          17      CALL    RBXC
000795 4795 2807            12      JR  Z,RBREND
                                
000797 4797 CD864A          17      CALL    CLUST
00079A 479A EB               4      EX  DE,HL
00079B 479B CD0E44          17      CALL    ROM_LDIR
       479E                     RBREND:
00079E 479E CD024A          17      CALL    RBXEND
       47A1                     RBREND0:
0007A1 47A1 FDE1            14      POP IY
0007A3 47A3 C1              10      POP BC
0007A4 47A4 D1              10      POP DE
0007A5 47A5 F1              10      POP AF  ;(HL)
0007A6 47A6 AF               4      XOR A
0007A7 47A7 3A1EF1          13      LD  A,(_RESULT)
0007AA 47AA C9              10      RET
                                
       47AB                     RBRERR1:
0007AB 47AB 3E01             7      LD  A,001H
       47AD                     RBRERR2:
0007AD 47AD FDE1            14      POP IY
0007AF 47AF C1              10      POP BC
0007B0 47B0 D1              10      POP DE
0007B1 47B1 E1              10      POP HL
0007B2 47B2 37               4      SCF
0007B3 47B3 210000          10      LD  HL,0
0007B6 47B6 C9              10      RET
       47B7                     RBRERR:
0007B7 47B7 3EFF             7      LD  A,0FFH
0007B9 47B9 18F2            12      JR  RBRERR2
                                
       47BB                     FILE_DD:
0007BB 47BB 3E                      DB  03EH
0007BC 47BC C9              10      RET
0007BD 47BD 3208F1          13      LD  (SWC_BLOAD_M),A
0007C0 47C0 2A47F1          16      LD  HL,(PARAM0)
0007C3 47C3 7E               7      LD  A,(HL)
0007C4 47C4 C9              10      RET
       47C5                     FILE_B:
0007C5 47C5 AF               4      XOR A
0007C6 47C6 324BF1          13      LD  (FDRV),A
0007C9 47C9 1E00             7      LD  E,0
0007CB 47CB 3A63F6          13      LD  A,(VALTYP)
0007CE 47CE FE03             7      CP  3       ;string
0007D0 47D0 2044            12      JR  NZ,FILED
                                
0007D2 47D2 DD21D067        14      LD  IX,FRESTR
0007D6 47D6 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007DA 47DA CD1C00          17      CALL    _CALSLT
0007DD 47DD E5              11      PUSH    HL
0007DE 47DE DDE1            14      POP IX
                                
0007E0 47E0 DD5E00          19      LD  E,(IX+0)
0007E3 47E3 DD7E01          19      LD  A,(IX+1)
0007E6 47E6 DD5602          19      LD  D,(IX+2)
0007E9 47E9 DD62             9      LD  IXH,D
0007EB 47EB DD6F             9      LD  IXL,A
0007ED 47ED 7B               4      LD  A,E
0007EE 47EE FE04             7      CP  4
0007F0 47F0 3808            12      JR  C,FILEB1
0007F2 47F2 DD7E03          19      LD  A,(IX+3)
0007F5 47F5 FE3A             7      CP  ':'
0007F7 47F7 28C2            12      JR  Z,FILE_DD
0007F9 47F9 7B               4      LD  A,E
       47FA                     FILEB1:
0007FA 47FA FE02             7      CP  2
0007FC 47FC 3818            12      JR  C,FILED
0007FE 47FE DD7E01          19      LD  A,(IX+1)
000801 4801 FE3A             7      CP  ':'
000803 4803 2011            12      JR  NZ,DEVI1
000805 4805 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000808 4808 CDEF48          17      CALL    CAP
00080B 480B D640             7      SUB '@'
00080D 480D DD23            10      INC IX
00080F 480F DD23            10      INC IX
000811 4811 1D               4      DEC E
000812 4812 1D               4      DEC E
000813 4813 324BF1          13      LD  (FDRV),A
       4816                     DEVI1:
                                
       4816                     FILED:
000816 4816 CD5D48          17      CALL    FILEI
000819 4819 214CF1          10      LD  HL,FNAME
                                
00081C 481C 0608             7      LD  B,8
       481E                     FILE2:
00081E 481E CD6A48          17      CALL    CCHKF
000821 4821 C8              11      RET Z
000822 4822 FE2A             7      CP  '*'
000824 4824 282E            12      JR  Z,FILE9
000826 4826 FE2E             7      CP  '.'
000828 4828 280C            12      JR  Z,FILE4
00082A 482A 77               7      LD  (HL),A
00082B 482B 23               6      INC HL
00082C 482C 10F0            13      DJNZ    FILE2
                                
       482E                     FILE3:
00082E 482E CD6A48          17      CALL    CCHKF
000831 4831 C8              11      RET Z
000832 4832 FE2E             7      CP  '.'
000834 4834 20F8            12      JR  NZ,FILE3
                                
       4836                     FILE4:
000836 4836 2154F1          10      LD  HL,FNAME+8
000839 4839 0603             7      LD  B,3
                                
       483B                     FILE4L:
00083B 483B CD6A48          17      CALL    CCHKF
00083E 483E C8              11      RET Z
00083F 483F FE2E             7      CP  '.'
000841 4841 2008            12      JR  NZ,FILE12
000843 4843 324CF1          13      LD  (FNAME),A   ;Parent directory(..)
000846 4846 324DF1          13      LD  (FNAME+1),A
000849 4849 3E20             7      LD  A,020H
       484B                     FILE12:
00084B 484B FE2A             7      CP  '*'
00084D 484D 280A            12      JR  Z,FILE10
00084F 484F 77               7      LD  (HL),A
000850 4850 23               6      INC HL
000851 4851 10E8            13      DJNZ    FILE4L
000853 4853 C9              10      RET
                                
       4854                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000854 4854 CD5948          17      CALL    FILE10
000857 4857 18D5            12      JR  FILE3
                                
       4859                     FILE10:
000859 4859 3E3F             7      LD  A,'?'
00085B 485B 1808            12      JR  FILL_MEMORY
       485D                     FILEI:              ;名前＋拡張子をスペースで初期化
00085D 485D 3E20             7      LD  A,020H
00085F 485F 01000B          10      LD  BC,11*256   ;C=0にしておく
000862 4862 214CF1          10      LD  HL,FNAME
       4865                     FILL_MEMORY:            ;HLからBバイトAで埋める
000865 4865 77               7      LD  (HL),A
000866 4866 23               6      INC HL
000867 4867 10FC            13      DJNZ    FILL_MEMORY
000869 4869 C9              10      RET
                                
       486A                     CCHKF:
00086A 486A 7B               4      LD  A,E
00086B 486B B7               4      OR  A
00086C 486C C8              11      RET Z
00086D 486D DD7E00          19      LD  A,(IX+0)
000870 4870 CD7748          17      CALL    CCHK2
000873 4873 C8              11      RET Z
000874 4874 C3DA48          10      JP  FKAN
                                
       4877                     CCHK2:
000877 4877 0C               4      INC C
000878 4878 0D               4      DEC C
000879 4879 C0              11      RET NZ
       487A                     CCHK3:              ;ZF=1 で使えない文字
00087A 487A FE2B             7      CP  '+'
00087C 487C C8              11      RET Z
00087D 487D FE2C             7      CP  ','
00087F 487F C8              11      RET Z
000880 4880 FE2F             7      CP  '/'
000882 4882 C8              11      RET Z
000883 4883 FE3A             7      CP  ':'
000885 4885 C8              11      RET Z
000886 4886 FE3B             7      CP  ';'
000888 4888 C8              11      RET Z
000889 4889 FE3D             7      CP  '='
00088B 488B C8              11      RET Z
00088C 488C FE5C             7      CP  05CH    ;\
00088E 488E C8              11      RET Z
00088F 488F FE1F             7      CP  01FH
000891 4891 D0              11      RET NC
000892 4892 BF               4      CP  A       ;Z=1
000893 4893 C9              10      RET
                                
       4894                     SS1:
000894 4894 13               6      INC DE
       4895                     SPCUT:              ;スペースをカット
000895 4895 1A               7      LD  A,(DE)
000896 4896 FE20             7      CP  020H
000898 4898 28FA            12      JR  Z,SS1
00089A 489A C9              10      RET
                                
       489B                     SCREOF1:
00089B 489B 13               6      INC DE
       489C                     SPCUTEX:            ;スペース改行などをカット
00089C 489C 1A               7      LD  A,(DE)
00089D 489D FE20             7      CP  020H
00089F 489F 28FA            12      JR  Z,SCREOF1
0008A1 48A1 FE0D             7      CP  00DH
0008A3 48A3 28F6            12      JR  Z,SCREOF1
0008A5 48A5 FE0A             7      CP  00AH
0008A7 48A7 28F2            12      JR  Z,SCREOF1
0008A9 48A9 FE1A             7      CP  01AH
0008AB 48AB 28EE            12      JR  Z,SCREOF1
0008AD 48AD C9              10      RET
                                
       48AE                     GETNUM:
0008AE 48AE 210000          10      LD  HL,0
       48B1                     GETNUM1:
0008B1 48B1 1A               7      LD  A,(DE)
0008B2 48B2 13               6      INC DE
0008B3 48B3 D630             7      SUB '0'
0008B5 48B5 D8              11      RET C
0008B6 48B6 FE0A             7      CP  10
0008B8 48B8 D0              11      RET NC
0008B9 48B9 4D               4      LD  C,L
0008BA 48BA 44               4      LD  B,H
0008BB 48BB 29              11      ADD HL,HL   ;*2
0008BC 48BC 29              11      ADD HL,HL   ;*4
0008BD 48BD 09              11      ADD HL,BC   ;*5
0008BE 48BE 29              11      ADD HL,HL   ;*10
0008BF 48BF 4F               4      LD  C,A
0008C0 48C0 0600             7      LD  B,0
0008C2 48C2 09              11      ADD HL,BC
0008C3 48C3 18EC            12      JR  GETNUM1
                                
       48C5                     SEARCH_END:
0008C5 48C5 7E               7      LD  A,(HL)
       48C6                     SEARCH_END1:
0008C6 48C6 23               6      INC HL
0008C7 48C7 B7               4      OR  A
0008C8 48C8 C8              11      RET Z
0008C9 48C9 FE3A             7      CP  ':'
0008CB 48CB 20F8            12      JR  NZ,SEARCH_END
0008CD 48CD 7E               7      LD  A,(HL)
0008CE 48CE FE3A             7      CP  ':'
0008D0 48D0 28F4            12      JR  Z,SEARCH_END1
0008D2 48D2 C9              10      RET
                                
       48D3                     FKANC:
0008D3 48D3 CB41             8      BIT 0,C
0008D5 48D5 CCF848          17      CALL    Z,CAP2
0008D8 48D8 1803            12      JR  FKANX
       48DA                     FKAN:           ;漢字チェック
0008DA 48DA DD23            10      INC IX
0008DC 48DC 1D               4      DEC E
       48DD                     FKANX:
0008DD 48DD CB41             8      BIT 0,C
0008DF 48DF CB81             8      RES 0,C
0008E1 48E1 C0              11      RET NZ
0008E2 48E2 FE80             7      CP  080H
0008E4 48E4 D8              11      RET C
0008E5 48E5 FEA0             7      CP  0A0H
0008E7 48E7 3803            12      JR  C,FKAN1
0008E9 48E9 FEE0             7      CP  0E0H
0008EB 48EB D8              11      RET C
       48EC                     FKAN1:
0008EC 48EC 0C               4      INC C
0008ED 48ED A7               4      AND A
0008EE 48EE C9              10      RET
                                
       48EF                     CAP:
0008EF 48EF FE61             7      CP  'a'
0008F1 48F1 D8              11      RET C
0008F2 48F2 FE7B             7      CP  'z'+1
0008F4 48F4 D0              11      RET NC
0008F5 48F5 D620             7      SUB 020H
0008F7 48F7 C9              10      RET
       48F8                     CAP2:
0008F8 48F8 CDEF48          17      CALL    CAP
       48FB                     CAP3:               ;
0008FB 48FB FE05             7      CP  5
0008FD 48FD 2803            12      JR  Z,CAP4
0008FF 48FF FE21             7      CP  021H
000901 4901 C9              10      RET
       4902                     CAP4:
000902 4902 3EE5             7      LD  A,0E5H
000904 4904 C9              10      RET
                                
       4905                     ROM_OPEN:
000905 4905 CDF64C          17      CALL    GET_DISK_BANK_FDRV
                                
000908 4908 CD224B          17      CALL    GET_DIR_DAT
00090B 490B D5              11      PUSH    DE
00090C 490C CD2149          17      CALL    FILESE
00090F 490F D1              10      POP DE
000910 4910 3F               4      CCF
000911 4911 D8              11      RET C
000912 4912 2243F1          16      LD  (FCBX),HL
000915 4915 E5              11      PUSH    HL
000916 4916 210000          10      LD  HL,0
000919 4919 2224F1          16      LD  (RR_LOW),HL
00091C 491C 2226F1          16      LD  (RR_HIGH),HL
00091F 491F E1              10      POP HL
000920 4920 C9              10      RET
                                
       4921                     FILESE:
000921 4921 7E               7      LD  A,(HL)
000922 4922 B7               4      OR  A
000923 4923 C8              11      RET Z       ;END:ZF=1 CF=0
000924 4924 FEE5             7      CP  0E5H
000926 4926 280D            12      JR  Z,FILESE1
000928 4928 114CF1          10      LD  DE,FNAME
00092B 492B E5              11      PUSH    HL
00092C 492C CD4349          17      CALL    CPFILE
00092F 492F CC6449          17      CALL    Z,CPFILE2
000932 4932 E1              10      POP HL
000933 4933 37               4      SCF
000934 4934 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4935                     FILESE1:
000935 4935 CD3D49          17      CALL    FNEXT
000938 4938 20E7            12      JR  NZ,FILESE
       493A                     ZF0_CF0_AFF_RET:
00093A 493A F6FF             7      OR  0FFH        ;ZF=0 CF=0
00093C 493C C9              10      RET
                                
       493D                     FNEXT:
00093D 493D 112000          10      LD  DE,020H
000940 4940 19              11      ADD HL,DE
000941 4941 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000942 4942 C9              10      RET
                                
       4943                     CPFILE:
000943 4943 C5              11      PUSH    BC
000944 4944 01000B          10      LD  BC,00B00H
       4947                     CPSTR1:
000947 4947 1A               7      LD  A,(DE)
000948 4948 FE3F             7      CP  '?'     ;Wild card
00094A 494A 2812            12      JR  Z,CPSTR2
00094C 494C 7E               7      LD  A,(HL)
00094D 494D CDD348          17      CALL    FKANC
000950 4950 E5              11      PUSH    HL
000951 4951 67               4      LD  H,A
000952 4952 1A               7      LD  A,(DE)
000953 4953 CB01             4      RLC C
000955 4955 CDD348          17      CALL    FKANC
000958 4958 CB09             4      RRC C
00095A 495A BC               4      CP  H       ;CP (HL),(DE)
00095B 495B E1              10      POP HL
00095C 495C 2004            12      JR  NZ,CPSTR3
       495E                     CPSTR2:
00095E 495E 13               6      INC DE
00095F 495F 23               6      INC HL
000960 4960 10E5            13      DJNZ    CPSTR1
       4962                     CPSTR3:
000962 4962 C1              10      POP BC
000963 4963 C9              10      RET
                                
       4964                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
000964 4964 3EE1             7      LD  A,0E1H
000966 4966 2F               4      CPL
000967 4967 A6               7      AND (HL)
000968 4968 C9              10      RET
                                
       4969                     RBX1:
000969 4969 E5              11      PUSH    HL      ;Record byte
                                
00096A 496A ED5B24F1        20      LD  DE,(RR_LOW) ;CDE=Random record
00096E 496E 3A27F1          13      LD  A,(RR_HIGH+1)
000971 4971 4F               4      LD  C,A
                                
000972 4972 CDF64C          17      CALL    GET_DISK_BANK_FDRV
                                
000975 4975 FD2A43F1        20      LD  IY,(FCBX)
000979 4979 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
00097C 497C FD661D          19      LD  H,(IY+01DH)
00097F 497F FD7E1E          19      LD  A,(IY+01EH)
                                
000982 4982 A7               4      AND A
000983 4983 ED52            15      SBC HL,DE
000985 4985 99               4      SBC A,C
000986 4986 D1              10      POP DE
                                
000987 4987 D8              11      RET C
000988 4988 4F               4      LD  C,A
000989 4989 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
00098A 498A B2               4      OR  D
00098B 498B B3               4      OR  E
00098C 498C C0              11      RET NZ
00098D 498D 37               4      SCF
00098E 498E C9              10      RET
                                
       498F                     RBX2:
00098F 498F ED4B25F1        20      LD  BC,(RR_LOW+1)
000993 4993 CD174A          17      CALL    RWXR
000996 4996 3A21F1          13      LD  A,(CLSZ_H)
000999 4999 3D               4      DEC A
00099A 499A E5              11      PUSH    HL
00099B 499B 2A24F1          16      LD  HL,(RR_LOW)
00099E 499E A4               4      AND H
00099F 499F B5               4      OR  L
0009A0 49A0 E1              10      POP HL
0009A1 49A1 C9              10      RET
                                
       49A2                     RBXA:
0009A2 49A2 D5              11      PUSH    DE
0009A3 49A3 CD864A          17      CALL    CLUST
0009A6 49A6 ED532CF1        20      LD  (_DTPS),DE
0009AA 49AA D1              10      POP DE
0009AB 49AB CD634A          17      CALL    GNCL
0009AE 49AE D8              11      RET C
0009AF 49AF ED5328F1        20      LD  (_CLPS),DE
                                
0009B3 49B3 ED4B24F1        20      LD  BC,(RR_LOW)
0009B7 49B7 2A20F1          16      LD  HL,(CLSZ)
0009BA 49BA 7C               4      LD  A,H
0009BB 49BB 3D               4      DEC A
0009BC 49BC A0               4      AND B
0009BD 49BD 47               4      LD  B,A
0009BE 49BE ED42            15      SBC HL,BC       ;remaining cluster
                                
0009C0 49C0 ED5B45F1        20      LD  DE,(LEFTX)
0009C4 49C4 ED52            15      SBC HL,DE       ;CP HL,DE
0009C6 49C6 19              11      ADD HL,DE
0009C7 49C7 3801            12      JR  C,RBXA1
0009C9 49C9 EB               4      EX  DE,HL
       49CA                     RBXA1:
0009CA 49CA 3A1FF1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
0009CD 49CD 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0009D0 49D0 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0009D3 49D3 E5              11      PUSH    HL
0009D4 49D4 2A2CF1          16      LD  HL,(_DTPS)
0009D7 49D7 09              11      ADD HL,BC
0009D8 49D8 ED5B3FF1        20      LD  DE,(DTAX)
0009DC 49DC C1              10      POP BC
0009DD 49DD C9              10      RET
                                
       49DE                     RBXB:
0009DE 49DE 2A3FF1          16      LD  HL,(DTAX)
0009E1 49E1 ED5B28F1        20      LD  DE,(_CLPS)
0009E5 49E5 3A46F1          13      LD  A,(LEFTX+1)
0009E8 49E8 47               4      LD  B,A
0009E9 49E9 3A21F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       49EC                     RBXB1:
0009EC 49EC 1F               4      RRA     ;->CF
0009ED 49ED 3804            12      JR  C,RBXB2
0009EF 49EF CB38             8      SRL B   ;B=B/2
0009F1 49F1 18F9            12      JR  RBXB1
       49F3                     RBXB2:
0009F3 49F3 78               4      LD  A,B
0009F4 49F4 B7               4      OR  A
0009F5 49F5 C9              10      RET
                                
       49F6                     RBXC:
0009F6 49F6 ED4B45F1        20      LD  BC,(LEFTX)
0009FA 49FA 3A21F1          13      LD  A,(CLSZ_H)
0009FD 49FD 3D               4      DEC A
0009FE 49FE A0               4      AND B
0009FF 49FF 47               4      LD  B,A
000A00 4A00 B1               4      OR  C
000A01 4A01 C9              10      RET
                                
       4A02                     RBXEND:
000A02 4A02 ED5B2AF1        20      LD  DE,(_LEFT)
000A06 4A06 2A24F1          16      LD  HL,(RR_LOW)
000A09 4A09 3A27F1          13      LD  A,(RR_HIGH+1)
000A0C 4A0C 19              11      ADD HL,DE
000A0D 4A0D CE00             7      ADC A,0
000A0F 4A0F 2224F1          16      LD  (RR_LOW),HL
000A12 4A12 3227F1          13      LD  (RR_HIGH+1),A
000A15 4A15 EB               4      EX  DE,HL       ;HL=Read byte
000A16 4A16 C9              10      RET 
                                
       4A17                     RWXR:
000A17 4A17 3A21F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4A1A                     L_RWX:
000A1A 4A1A 1F               4      RRA     ;->CF
000A1B 4A1B 3806            12      JR  C,E_RWX
000A1D 4A1D CB38             8      SRL B   ;BC=BC/2
000A1F 4A1F CB19             8      RR  C   ;
000A21 4A21 18F7            12      JR  L_RWX
       4A23                     E_RWX:
000A23 4A23 CDF64C          17      CALL    GET_DISK_BANK_FDRV
                                
000A26 4A26 FD2A43F1        20      LD  IY,(FCBX)
000A2A 4A2A FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000A2D 4A2D FD561B          19      LD  D,(IY+01BH)
       4A30                     RWX1:
000A30 4A30 ED5328F1        20      LD  (_CLPS),DE
000A34 4A34 7A               4      LD  A,D
000A35 4A35 B3               4      OR  E
000A36 4A36 37               4      SCF
000A37 4A37 C8              11      RET Z
                                
000A38 4A38 78               4      LD  A,B
000A39 4A39 B1               4      OR  C
000A3A 4A3A C8              11      RET Z
                                
000A3B 4A3B CD634A          17      CALL    GNCL
000A3E 4A3E D8              11      RET C
000A3F 4A3F 0B               6      DEC BC
000A40 4A40 CDBB4A          17      CALL    ENDCL
000A43 4A43 38EB            12      JR  C,RWX1
000A45 4A45 37               4      SCF
000A46 4A46 C9              10      RET
                                
       4A47                     NCL3:
000A47 4A47 CDF64C          17      CALL    GET_DISK_BANK_FDRV
000A4A 4A4A 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000A4D 4A4D 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000A50 4A50 6B               4      LD  L,E
000A51 4A51 62               4      LD  H,D
000A52 4A52 CB3C             8      SRL H
000A54 4A54 CB1D             8      RR  L
000A56 4A56 1F               4      RRA
000A57 4A57 19              11      ADD HL,DE
000A58 4A58 010060          10      LD  BC,BANK1_ADR
000A5B 4A5B 09              11      ADD HL,BC
000A5C 4A5C ED4B22F1        20      LD  BC,(SECSZ)
000A60 4A60 09              11      ADD HL,BC
000A61 4A61 17               4      RLA
000A62 4A62 C9              10      RET
                                
       4A63                     GNCL:
000A63 4A63 7A               4      LD  A,D
000A64 4A64 B3               4      OR  E
000A65 4A65 37               4      SCF
000A66 4A66 C8              11      RET Z
000A67 4A67 C5              11      PUSH    BC
000A68 4A68 E5              11      PUSH    HL
000A69 4A69 CD474A          17      CALL    NCL3
000A6C 4A6C 3809            12      JR  C,GNC1
000A6E 4A6E 5E               7      LD  E,(HL)
000A6F 4A6F 23               6      INC HL
000A70 4A70 7E               7      LD  A,(HL)
000A71 4A71 E60F             7      AND 00FH
000A73 4A73 57               4      LD  D,A
000A74 4A74 E1              10      POP HL
000A75 4A75 C1              10      POP BC
000A76 4A76 C9              10      RET
       4A77                     GNC1:
000A77 4A77 7E               7      LD  A,(HL)
000A78 4A78 23               6      INC HL
000A79 4A79 56               7      LD  D,(HL)
000A7A 4A7A 0604             7      LD  B,4
       4A7C                     GNC1L:
000A7C 4A7C CB3A             8      SRL D
000A7E 4A7E 1F               4      RRA
000A7F 4A7F 10FB            13      DJNZ    GNC1L
                                
000A81 4A81 5F               4      LD  E,A
000A82 4A82 E1              10      POP HL
000A83 4A83 C1              10      POP BC
000A84 4A84 A7               4      AND A
000A85 4A85 C9              10      RET
                                
       4A86                     CLUST:
000A86 4A86 EB               4      EX  DE,HL
000A87 4A87 C5              11      PUSH    BC
000A88 4A88 3A21F1          13      LD  A,(CLSZ_H)
000A8B 4A8B CD224D          17      CALL    MUL_AHL
                                
000A8E 4A8E CD2F4B          17      CALL    GET_DIR_POS
000A91 4A91 4F               4      LD  C,A
000A92 4A92 0600             7      LD  B,0
000A94 4A94 09              11      ADD HL,BC
                                
000A95 4A95 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000A98 4A98 0F               4      RRCA
000A99 4A99 0F               4      RRCA
000A9A 4A9A 0F               4      RRCA
000A9B 4A9B 0F               4      RRCA
000A9C 4A9C 4F               4      LD  C,A
                                
000A9D 4A9D 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000AA0 4AA0 FE02             7      CP  2
000AA2 4AA2 280C            12      JR  Z,CLUST1
000AA4 4AA4 CB01             4      RLC C
000AA6 4AA6 0D               4      DEC C
000AA7 4AA7 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000AAA 4AAA FE02             7      CP  2
000AAC 4AAC 2002            12      JR  NZ,CLUST1
000AAE 4AAE 0D               4      DEC C
000AAF 4AAF 0D               4      DEC C
       4AB0                     CLUST1:
000AB0 4AB0 0D               4      DEC C
000AB1 4AB1 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000AB2 4AB2 7D               4      LD  A,L
                                #else
                                    PUSH    HL
                                    ADD HL,HL   ;*2
                                    ADD HL,HL   ;*4
                                    ADD HL,HL   ;*8
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    POP HL
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
000AB3 4AB3 C660             7      ADD A,high BANK1_ADR
000AB5 4AB5 67               4      LD  H,A
000AB6 4AB6 2E00             7      LD  L,0
000AB8 4AB8 EB               4      EX  DE,HL
000AB9 4AB9 C1              10      POP BC
000ABA 4ABA C9              10      RET
                                
       4ABB                     ENDCL:
000ABB 4ABB 7A               4      LD  A,D ;END CLUSTER
000ABC 4ABC FE0F             7      CP  00FH    ;FAT12の最大値
000ABE 4ABE C0              11      RET NZ
000ABF 4ABF 7B               4      LD  A,E
000AC0 4AC0 FEF7             7      CP  0F7H
000AC2 4AC2 C9              10      RET
                                
       4AC3                     RB_READ:
000AC3 4AC3 AF               4      XOR A   ;HLA = HL*128
000AC4 4AC4 CB3C             8      SRL H
000AC6 4AC6 CB1D             8      RR  L
000AC8 4AC8 1F               4      RRA
000AC9 4AC9 3224F1          13      LD  (RR_LOW),A
000ACC 4ACC 2225F1          16      LD  (RR_MID),HL
000ACF 4ACF 218000          10      LD  HL,128
                                
000AD2 4AD2 CD2547          17      CALL    ROM_READ
000AD5 4AD5 C9              10      RET
                                
       4AD6                     GETSEQ:
000AD6 4AD6 FD6E20          19      LD  L,(IY+32)
000AD9 4AD9 FD660C          19      LD  H,(IY+12)
                                
000ADC 4ADC CB25             8      SLA L
                                
000ADE 4ADE CB3C             8      SRL H
000AE0 4AE0 CB1D             8      RR  L
000AE2 4AE2 C9              10      RET
                                
       4AE3                     SETSEQ:
000AE3 4AE3 F5              11      PUSH    AF
000AE4 4AE4 3A24F1          13      LD  A,(RR_LOW)
000AE7 4AE7 2A25F1          16      LD  HL,(RR_MID)
                                
000AEA 4AEA CD014B          17      CALL    SSQ1
                                
000AED 4AED 29              11      ADD HL,HL
000AEE 4AEE CB3D             8      SRL L
000AF0 4AF0 FD7520          19      LD  (IY+32),L
000AF3 4AF3 FD740C          19      LD  (IY+12),H
000AF6 4AF6 F1              10      POP AF
000AF7 4AF7 C9              10      RET
                                
       4AF8                     GETSIZE:
000AF8 4AF8 FD7E10          19      LD  A,(IY+16)
000AFB 4AFB FD6E11          19      LD  L,(IY+17)
000AFE 4AFE FD6612          19      LD  H,(IY+18)
       4B01                     SSQ1:
000B01 4B01 87               4      ADD A,A
000B02 4B02 ED6A            15      ADC HL,HL
000B04 4B04 B7               4      OR  A
000B05 4B05 C8              11      RET Z
000B06 4B06 23               6      INC HL
000B07 4B07 C9              10      RET
                                
       4B08                     SET_FCB:
000B08 4B08 D5              11      PUSH    DE
000B09 4B09 FDE1            14      POP IY
000B0B 4B0B FD7E1C          19      LD  A,(IY+28)
000B0E 4B0E FEFF             7      CP  0FFH
000B10 4B10 200C            12      JR  NZ,POPAF_SCF_FF_RET
000B12 4B12 E5              11      PUSH    HL
000B13 4B13 FD6E1A          19      LD  L,(IY+26)
000B16 4B16 FD661B          19      LD  H,(IY+27)
000B19 4B19 2228F1          16      LD  (_CLPS),HL
000B1C 4B1C E1              10      POP HL
000B1D 4B1D C9              10      RET
                                
       4B1E                     POPAF_SCF_FF_RET:
000B1E 4B1E F1              10      POP AF
000B1F 4B1F 37               4      SCF
000B20 4B20 9F               4      SBC A,A
000B21 4B21 C9              10      RET
                                
       4B22                     GET_DIR_DAT:
000B22 4B22 CD2F4B          17      CALL    GET_DIR_POS
000B25 4B25 C660             7      ADD A,high BANK1_ADR
000B27 4B27 2E00             7      LD  L,0
000B29 4B29 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000B2A 4B2A 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000B2D 4B2D 4F               4      LD  C,A
000B2E 4B2E C9              10      RET
                                
       4B2F                     GET_DIR_POS:
000B2F 4B2F CDF64C          17      CALL    GET_DISK_BANK_FDRV
000B32 4B32 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B35 4B35 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B38 4B38 321FF1          13      LD  (_BANK),A
000B3B 4B3B 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000B3E 4B3E 47               4      LD  B,A
000B3F 4B3F 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000B42 4B42 4F               4      LD  C,A
000B43 4B43 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4B46                     GET_DIR_POS1:
000B46 4B46 81               4      ADD A,C
000B47 4B47 10FD            13      DJNZ    GET_DIR_POS1
                                
000B49 4B49 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4B4D                     L_MDP:
000B4D 4B4D CB18             8      RR  B   ;->CF
000B4F 4B4F D8              11      RET C
000B50 4B50 87               4      ADD A,A
000B51 4B51 18FA            12      JR  L_MDP
                                
       4B53                     WILDCARD:
000B53 4B53 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4B5E                     ERROR_WRITE_PROTECTED:
000B5E 4B5E 3E00             7      LD  A,0     ;Write protected
000B60 4B60 C9              10      RET
       4B61                     DISKIO:
000B61 4B61 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000B63 4B63 48               4      LD  C,B
000B64 4B64 CD004D          17      CALL    GET_DISK_BANK
       4B67                     SETMAP1:        
000B67 4B67 E5              11      PUSH    HL
       4B68                     DISKIO1:
000B68 4B68 C5              11      PUSH    BC      ;B=残りのセクタ数
000B69 4B69 D5              11      PUSH    DE      ;DE=セクタ番号
000B6A 4B6A F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000B6B 4B6B EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000B6C 4B6C F5              11      PUSH    AF
000B6D 4B6D 3A23F1          13      LD  A,(SECSZ_H)
000B70 4B70 CD224D          17      CALL    MUL_AHL
000B73 4B73 F1              10      POP AF
000B74 4B74 4D               4      LD  C,L     ;C=読み出し元
000B75 4B75 29              11      ADD HL,HL       ;64KB→32KB
000B76 4B76 29              11      ADD HL,HL       ;32KB→16KB
000B77 4B77 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000B78 4B78 84               4      ADD A,H
000B79 4B79 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B7C 4B7C 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B7F 4B7F 321FF1          13      LD  (_BANK),A
000B82 4B82 79               4      LD  A,C     ;C=読み出し元
000B83 4B83 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
000B85 4B85 C660             7      ADD A,high BANK1_ADR
000B87 4B87 67               4      LD  H,A
000B88 4B88 ED4B22F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000B8C 4B8C 69               4      LD  L,C     ;C=0
000B8D 4B8D EDB0                    LDIR
000B8F 4B8F EB               4      EX  DE,HL
000B90 4B90 F1              10      POP AF
000B91 4B91 D1              10      POP DE
000B92 4B92 13               6      INC DE
000B93 4B93 C1              10      POP BC
000B94 4B94 10D2            13      DJNZ    DISKIO1
000B96 4B96 41               4      LD  B,C
                                
000B97 4B97 E1              10      POP HL
000B98 4B98 AF               4      XOR A
000B99 4B99 FB               4      EI
000B9A 4B9A C9              10      RET
                                
       4B9B                     DSKCHG:
000B9B 4B9B CDD44B          17      CALL    IS_BPB
000B9E 4B9E 3824            12      JR  C,NOTREADY
000BA0 4BA0 3A23FB          13      LD  A,(DRVTBL+2)
000BA3 4BA3 B7               4      OR  A
000BA4 4BA4 201A            12      JR  NZ,DSKCHG1
000BA6 4BA6 3A21FB          13      LD  A,(DRVTBL)
000BA9 4BA9 FE02             7      CP  2
000BAB 4BAB 2013            12      JR  NZ,DSKCHG1
000BAD 4BAD CDD44B          17      CALL    IS_BPB
000BB0 4BB0 300E            12      JR  NC,DSKCHG1
000BB2 4BB2 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000BB4 4BB4 3221FB          13      LD  (DRVTBL),A
000BB7 4BB7 3223FB          13      LD  (DRVTBL+2),A
000BBA 4BBA 3A48F3          13      LD  A,(MASTERS)
000BBD 4BBD 3224FB          13      LD  (DRVTBL+3),A
       4BC0                     DSKCHG1:
000BC0 4BC0 AF               4      XOR A
000BC1 4BC1 0601             7      LD  B,1
000BC3 4BC3 C9              10      RET
       4BC4                     NOTREADY:
000BC4 4BC4 3E02             7      LD  A,2
000BC6 4BC6 37               4      SCF
000BC7 4BC7 C9              10      RET
                                
       4BC8                     NO_BPB:
000BC8 4BC8 E1              10      POP HL
000BC9 4BC9 23               6      INC HL
000BCA 4BCA 11274D          10      LD  DE,DPB2DD
000BCD 4BCD 011200          10      LD  BC,DPB2DD_E-DPB2DD
000BD0 4BD0 EDB0                    LDIR
000BD2 4BD2 AF               4      XOR A
000BD3 4BD3 C9              10      RET
                                
       4BD4                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000BD4 4BD4 CD004D          17      CALL    GET_DISK_BANK
                                
000BD7 4BD7 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000BDA 4BDA FE01             7      CP  1
000BDC 4BDC D8              11      RET C
                                
000BDD 4BDD 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000BE0 4BE0 C6FF             7      ADD A,0FFH
000BE2 4BE2 D8              11      RET C
                                
000BE3 4BE3 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000BE6 4BE6 FE01             7      CP  1
000BE8 4BE8 C8              11      RET Z
000BE9 4BE9 FE02             7      CP  2
000BEB 4BEB C8              11      RET Z
000BEC 4BEC FE04             7      CP  4
000BEE 4BEE C8              11      RET Z
000BEF 4BEF 37               4      SCF
000BF0 4BF0 C9              10      RET
                                
       4BF1                     GETDPB:
000BF1 4BF1 E5              11      PUSH    HL
000BF2 4BF2 CD004D          17      CALL    GET_DISK_BANK
                                
000BF5 4BF5 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000BF8 4BF8 B7               4      OR  A
000BF9 4BF9 28CD            12      JR  Z,NO_BPB
000BFB 4BFB DDE1            14      POP IX
000BFD 4BFD DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000C00 4C00 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000C03 4C03 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000C06 4C06 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000C09 4C09 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000C0C 4C0C 87               4      ADD A,A
000C0D 4C0D 87               4      ADD A,A
000C0E 4C0E 87               4      ADD A,A
000C0F 4C0F 3D               4      DEC A
000C10 4C10 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000C13 4C13 06FF             7      LD  B,-1
000C15 4C15 A7               4      AND A           ;無限ループ阻止
       4C16                     GETDPB1:
000C16 4C16 04               4      INC B
000C17 4C17 1F               4      RRA
000C18 4C18 38FC            12      JR  C,GETDPB1
000C1A 4C1A DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000C1D 4C1D 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000C20 4C20 3D               4      DEC A
000C21 4C21 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000C24 4C24 A7               4      AND A           ;無限ループ阻止
000C25 4C25 06FF             7      LD  B,-1
       4C27                     GETDPB2:
000C27 4C27 04               4      INC B
000C28 4C28 1F               4      RRA
000C29 4C29 38FC            12      JR  C,GETDPB2
000C2B 4C2B 04               4      INC B
000C2C 4C2C DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000C2F 4C2F 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000C32 4C32 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000C35 4C35 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000C38 4C38 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000C3B 4C3B DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000C3E 4C3E 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000C41 4C41 DD770B          19      LD  (IX+11),A       ;FATCNT
                                
000C44 4C44 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000C48 4C48 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000C4B 4C4B DD460A          19      LD  B,(IX+10)       ;FATCNT
000C4E 4C4E 210000          10      LD  HL,0
       4C51                     GETDPB3:
000C51 4C51 19              11      ADD HL,DE
000C52 4C52 10FD            13      DJNZ    GETDPB3
       4C54                     GETDPB4:
000C54 4C54 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000C57 4C57 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000C5A 4C5A 19              11      ADD HL,DE
000C5B 4C5B DD7511          19      LD  (IX+17),L       ;FIRDIR
000C5E 4C5E DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000C61 4C61 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C64 4C64 87               4      ADD A,A
000C65 4C65 87               4      ADD A,A
000C66 4C66 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4C69                     GETDPB5:
000C69 4C69 CB3B             8      SRL E
000C6B 4C6B 1F               4      RRA
000C6C 4C6C 30FB            12      JR  NC,GETDPB5
000C6E 4C6E 1600             7      LD  D,0
000C70 4C70 19              11      ADD HL,DE
000C71 4C71 DD750C          19      LD  (IX+12),L       ;FIRREC
000C74 4C74 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000C77 4C77 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000C7A 4C7A DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000C7D 4C7D DD560D          19      LD  D,(IX+13)       ;FIRREC
000C80 4C80 A7               4      AND A
000C81 4C81 ED52            15      SBC HL,DE
                                
000C83 4C83 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000C86 4C86 3C               4      INC A
000C87 4C87 37               4      SCF             ;無限ループ阻止
       4C88                     GETDPB6:
000C88 4C88 1F               4      RRA
000C89 4C89 3806            12      JR  C,GETDPB7
000C8B 4C8B CB3C             8      SRL H
000C8D 4C8D CB1D             8      RR  L
000C8F 4C8F 18F7            12      JR  GETDPB6
       4C91                     GETDPB7:
000C91 4C91 23               6      INC HL
000C92 4C92 DD750E          19      LD  (IX+14),L       ;MAXCLUS
000C95 4C95 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4C98                     GETDPBD1:
000C98 4C98 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C9B 4C9B E6FC             7      AND 0FCH
000C9D 4C9D C8              11      RET Z
                                
000C9E 4C9E DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000CA2 4CA2 37               4      SCF
000CA3 4CA3 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000CA7 4CA7 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000CAA 4CAA DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000CAE 4CAE DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000CB2 4CB2 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000CB6 4CB6 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000CBA 4CBA DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000CBE 4CBE DDCB1126        23      SLA (IX+17)         ;FIRDIR
000CC2 4CC2 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000CC6 4CC6 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000CC9 4CC9 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000CCC 4CCC DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000CCF 4CCF 87               4      ADD A,A
000CD0 4CD0 87               4      ADD A,A
000CD1 4CD1 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4CD4                     GETDPBD5:
000CD4 4CD4 CB3B             8      SRL E
000CD6 4CD6 1F               4      RRA
000CD7 4CD7 30FB            12      JR  NC,GETDPBD5
000CD9 4CD9 1600             7      LD  D,0
000CDB 4CDB 19              11      ADD HL,DE
000CDC 4CDC DD750C          19      LD  (IX+12),L       ;FIRREC
000CDF 4CDF DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000CE2 4CE2 18B4            12      JR  GETDPBD1
                                
       4CE4                     CHOICE:
000CE4 4CE4 210000          10      LD  HL,0
000CE7 4CE7 C9              10      RET
                                
       4CE8                     DSKFMT:
000CE8 4CE8 AF               4      XOR A
000CE9 4CE9 37               4      SCF
       4CEA                     DSKSTP:
000CEA 4CEA C9              10      RET
                                
       4CEB                     BASENT:
000CEB 4CEB ED7B57F1        20      LD  SP,(BASSTK)
000CEF 4CEF C3A243          10      JP  BASAUTO
                                
       4CF2                     GETSLT:
000CF2 4CF2 3A22FB          13      LD  A,(DRVTBL+1)
000CF5 4CF5 C9              10      RET
                                
       4CF6                     GET_DISK_BANK_FDRV:
000CF6 4CF6 3A4BF1          13      LD  A,(FDRV)
000CF9 4CF9 D601             7      SUB 1
000CFB 4CFB 3003            12      JR  NC,GET_DISK_BANK
000CFD 4CFD 3A42F1          13      LD  A,(_DVSW)
       4D00                     GET_DISK_BANK:
000D00 4D00 B7               4      OR  A       ;A=DRIVE
000D01 4D01 3E01             7      LD  A,DISK_BANK
000D03 4D03 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
000D05 4D05 3A41F1          13      LD  A,(B_DRIVE)
                                #endif
       4D08                     SET_DISK_BANK:
000D08 4D08 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D0B 4D0B 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D0E 4D0E F5              11      PUSH    AF
000D0F 4D0F E5              11      PUSH    HL
000D10 4D10 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
000D13 4D13 2222F1          16      LD  (SECSZ),HL
000D16 4D16 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D19 4D19 CD224D          17      CALL    MUL_AHL
000D1C 4D1C 2220F1          16      LD  (CLSZ),HL
000D1F 4D1F E1              10      POP HL
000D20 4D20 F1              10      POP AF
000D21 4D21 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)
       4D22                     MUL_AHL:
000D22 4D22 1F               4      RRA     ;->CF
000D23 4D23 D8              11      RET C
000D24 4D24 29              11      ADD HL,HL
000D25 4D25 18FB            12      JR  MUL_AHL
                                
       4D27                     DPB2DD:
000D27 4D27 F9                      DB  0F9H    ;MEDIA
000D28 4D28 0002                    DW  00200H  ;SECSIZ
000D2A 4D2A 0F                      DB  00FH    ;DIRMSK
000D2B 4D2B 04                      DB  004H    ;DIRSHFT
000D2C 4D2C 01                      DB  001H    ;CLUSMSK
000D2D 4D2D 02                      DB  002H    ;CLUSSHFT
000D2E 4D2E 0100                    DW  00001H  ;FIRFAT
000D30 4D30 02                      DB  002H    ;FATCNT
000D31 4D31 70                      DB  070H    ;MAXENT
000D32 4D32 0E00                    DW  0000EH  ;FIRREC
000D34 4D34 CA02                    DW  002CAH  ;MAXCLUS
000D36 4D36 03                      DB  003H    ;FATSIZ
000D37 4D37 0700                    DW  0007H   ;FIRDIR
       4D39                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4D39                     POP_HL_ERROR:
000D39 4D39 E1              10      POP     HL
       4D3A                     _ERROR:
000D3A 4D3A 0600             7      LD  B,0
000D3C 4D3C A7               4      AND A
000D3D 4D3D C9              10      RET
                                
       4D3E                     ROM_BDOS:
000D3E 4D3E E5              11      PUSH    HL
000D3F 4D3F 79               4      LD  A,C
000D40 4D40 87               4      ADD A,A
000D41 4D41 38F7            12      JR  C,_ERROR
000D43 4D43 6F               4      LD  L,A
000D44 4D44 265F             7      LD  H,high STABLE
000D46 4D46 7E               7      LD  A,(HL)
000D47 4D47 2C               4      INC L
000D48 4D48 66               7      LD  H,(HL)
000D49 4D49 6F               4      LD  L,A
000D4A 4D4A E3              19      EX  (SP),HL
000D4B 4D4B 79               4      LD  A,C
000D4C 4D4C C9              10      RET
                                
       4D4D                     _PRINT:
       4D4D                     PRINT:
000D4D 4D4D 7B               4      LD  A,E
000D4E 4D4E 1803            12      JR  MSG_A
                                
       4D50                     _SYS01:     ;(BDOS)コンソール入力
000D50 4D50 CDC74D          17      CALL    _SYS07
       4D53                     MSG_A:
000D53 4D53 FE03             7      CP  3
000D55 4D55 2814            12      JR  Z,MSG_BR
       4D57                     MSGA1:
000D57 4D57 F5              11      PUSH    AF
000D58 4D58 C5              11      PUSH    BC
000D59 4D59 D5              11      PUSH    DE
000D5A 4D5A E5              11      PUSH    HL
000D5B 4D5B DDE5            15      PUSH    IX
000D5D 4D5D DD21A200        14      LD  IX,CHPUT
000D61 4D61 CDD142          17      CALL    CALSLT_R
000D64 4D64 DDE1            14      POP IX
000D66 4D66 E1              10      POP HL
000D67 4D67 D1              10      POP DE
000D68 4D68 C1              10      POP BC
       4D69                     MSGA2:
000D69 4D69 F1              10      POP AF
000D6A 4D6A C9              10      RET
       4D6B                     MSG_BR:
000D6B 4D6B F5              11      PUSH    AF
000D6C 4D6C 3ADDF3          13      LD  A,(CSRX)
000D6F 4D6F FE02             7      CP  2
000D71 4D71 38F6            12      JR  C,MSGA2
000D73 4D73 F1              10      POP AF
       4D74                     MSG_CR:
000D74 4D74 F5              11      PUSH    AF
000D75 4D75 3E0D             7      LD  A,00DH
000D77 4D77 CD574D          17      CALL    MSGA1
000D7A 4D7A 3E0A             7      LD  A,00AH
000D7C 4D7C CD574D          17      CALL    MSGA1
000D7F 4D7F F1              10      POP AF
000D80 4D80 C9              10      RET
                                
       4D81                     _SYS02:     ;(BDOS)コンソール出力
000D81 4D81 CD9C4D          17      CALL    BREAK
000D84 4D84 1805            12      JR  PRINTX
                                
       4D86                     _SYS06:     ;(BDOS)コンソール直接入出力
000D86 4D86 7B               4      LD  A,E
000D87 4D87 3C               4      INC A
000D88 4D88 CADB4D          10      JP  Z,_INKEY
       4D8B                     PRINTX:
000D8B 4D8B C34D4D          10      JP  _PRINT
                                
       4D8E                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D8E 4D8E CDC74D          17      CALL    _SYS07
000D91 4D91 FE03             7      CP  3
000D93 4D93 CC9C4D          17      CALL    Z,_BREAK
000D96 4D96 FE13             7      CP  013H        ;CTRL+S
000D98 4D98 C0              11      RET NZ
       4D99                     PAUSE:
000D99 4D99 CDB34D          17      CALL    KEYBC
                                
       4D9C                     _BREAK:
       4D9C                     BREAK:
000D9C 4D9C F5              11      PUSH    AF
000D9D 4D9D C5              11      PUSH    BC
000D9E 4D9E D5              11      PUSH    DE
000D9F 4D9F E5              11      PUSH    HL
000DA0 4DA0 DDE5            15      PUSH    IX
000DA2 4DA2 DD21B700        14      LD  IX,BREAKX
000DA6 4DA6 CDD142          17      CALL    CALSLT_R
000DA9 4DA9 DDE1            14      POP IX
000DAB 4DAB E1              10      POP HL
000DAC 4DAC D1              10      POP DE
000DAD 4DAD C1              10      POP BC
000DAE 4DAE DC9C4D          17      CALL    C,_BREAK
000DB1 4DB1 F1              10      POP AF
000DB2 4DB2 C9              10      RET
       4DB3                     KEYBC:
000DB3 4DB3 F5              11      PUSH    AF
000DB4 4DB4 C5              11      PUSH    BC
000DB5 4DB5 D5              11      PUSH    DE
000DB6 4DB6 E5              11      PUSH    HL
000DB7 4DB7 DDE5            15      PUSH    IX
000DB9 4DB9 DD215601        14      LD  IX,KILBUF
000DBD 4DBD CDD142          17      CALL    CALSLT_R
000DC0 4DC0 DDE1            14      POP IX
000DC2 4DC2 E1              10      POP HL
000DC3 4DC3 D1              10      POP DE
000DC4 4DC4 C1              10      POP BC
000DC5 4DC5 F1              10      POP AF
000DC6 4DC6 C9              10      RET
                                
       4DC7                     _SYS07:
       4DC7                     FLGET:
000DC7 4DC7 C5              11      PUSH    BC
000DC8 4DC8 D5              11      PUSH    DE
000DC9 4DC9 E5              11      PUSH    HL
000DCA 4DCA DDE5            15      PUSH    IX
000DCC 4DCC DD219F00        14      LD  IX,CHGET
000DD0 4DD0 CDD142          17      CALL    CALSLT_R
000DD3 4DD3 DDE1            14      POP IX
000DD5 4DD5 E1              10      POP HL
000DD6 4DD6 D1              10      POP DE
000DD7 4DD7 C1              10      POP BC
000DD8 4DD8 FE03             7      CP  3
000DDA 4DDA C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       4DDB                     _INKEY:
       4DDB                     INKEY:
000DDB 4DDB CD754E          17      CALL    CPM_CONST
000DDE 4DDE C8              11      RET Z
000DDF 4DDF 18E6            12      JR  FLGET
                                
       4DE1                     _SYS0A:     ;(BDOS)文字列入力
000DE1 4DE1 C5              11      PUSH    BC
000DE2 4DE2 E5              11      PUSH    HL
000DE3 4DE3 D5              11      PUSH    DE
000DE4 4DE4 CD0D4E          17      CALL    GETL
000DE7 4DE7 111FF4          10      LD  DE,KBUF
000DEA 4DEA E1              10      POP HL
000DEB 4DEB E5              11      PUSH    HL
000DEC 4DEC 0E00             7      LD  C,0
000DEE 4DEE 3004            12      JR  NC,SAX0
000DF0 4DF0 23               6      INC HL
000DF1 4DF1 23               6      INC HL
000DF2 4DF2 1808            12      JR  SAX4
       4DF4                     SAX0:
000DF4 4DF4 46               7      LD  B,(HL)
000DF5 4DF5 23               6      INC HL
       4DF6                     SAX1:
000DF6 4DF6 23               6      INC HL
000DF7 4DF7 1A               7      LD  A,(DE)
000DF8 4DF8 13               6      INC DE
000DF9 4DF9 B7               4      OR  A
000DFA 4DFA 2004            12      JR  NZ,SAX2
       4DFC                     SAX4:
000DFC 4DFC 360D            10      LD  (HL),00DH
000DFE 4DFE 1804            12      JR  SAX3
       4E00                     SAX2:
000E00 4E00 77               7      LD  (HL),A
000E01 4E01 0C               4      INC C
000E02 4E02 10F2            13      DJNZ    SAX1
       4E04                     SAX3:
000E04 4E04 D1              10      POP DE
000E05 4E05 79               4      LD  A,C
000E06 4E06 13               6      INC DE
000E07 4E07 12               7      LD  (DE),A
000E08 4E08 1B               6      DEC DE
000E09 4E09 E1              10      POP HL
000E0A 4E0A C1              10      POP BC
000E0B 4E0B A7               4      AND A
000E0C 4E0C C9              10      RET
       4E0D                     GETL:
000E0D 4E0D DDE5            15      PUSH    IX
000E0F 4E0F FDE5            15      PUSH    IY
                                
000E11 4E11 2ADCF3          16      LD  HL,(CSRY)
000E14 4E14 22CAFB          16      LD  (FSTPOS),HL
       4E17                     GETL1:
000E17 4E17 CD8E4D          17      CALL    _SYS08
000E1A 4E1A FE09             7      CP  9
000E1C 4E1C 2008            12      JR  NZ,GETL1V
000E1E 4E1E 211FF4          10      LD  HL,KBUF
000E21 4E21 CD5443          17      CALL    MSX
000E24 4E24 18F1            12      JR  GETL1
       4E26                     GETL1V:
000E26 4E26 5F               4      LD  E,A
000E27 4E27 FE08             7      CP  8
000E29 4E29 CCC34E          17      CALL    Z,CTRL02
000E2C 4E2C FE20             7      CP  020H
000E2E 4E2E D4EF4E          17      CALL    NC,INSERT
000E31 4E31 CD574D          17      CALL    MSGA1
                                
000E34 4E34 7B               4      LD  A,E
000E35 4E35 FE0D             7      CP  00DH
000E37 4E37 20DE            12      JR  NZ,GETL1
                                
000E39 4E39 111FF4          10      LD  DE,KBUF
000E3C 4E3C 3AB0F3          13      LD  A,(LINLEN)
000E3F 4E3F 47               4      LD  B,A
000E40 4E40 CDA250          17      CALL    ZERO_MEMORY_DE
                                
000E43 4E43 2ACAFB          16      LD  HL,(FSTPOS)
000E46 4E46 3ADCF3          13      LD  A,(CSRY)
000E49 4E49 6F               4      LD  L,A
000E4A 4E4A E5              11      PUSH    HL
000E4B 4E4B CD204F          17      CALL    LOC0
000E4E 4E4E 4D               4      LD  C,L
000E4F 4E4F 44               4      LD  B,H
000E50 4E50 E1              10      POP HL
000E51 4E51 3AB0F3          13      LD  A,(LINLEN)
000E54 4E54 94               4      SUB H
000E55 4E55 3D               4      DEC A
000E56 4E56 5F               4      LD  E,A
000E57 4E57 211FF4          10      LD  HL,KBUF
       4E5A                     GETL2:
000E5A 4E5A CDB34E          17      CALL    _SCRN
000E5D 4E5D 03               6      INC BC
000E5E 4E5E 77               7      LD  (HL),A
000E5F 4E5F 23               6      INC HL
000E60 4E60 1D               4      DEC E
000E61 4E61 20F7            12      JR  NZ,GETL2
000E63 4E63 CD744D          17      CALL    MSG_CR
                                
000E66 4E66 FDE1            14      POP IY
000E68 4E68 DDE1            14      POP IX
       4E6A                     GETL3:
000E6A 4E6A 2B               6      DEC HL
000E6B 4E6B 7E               7      LD  A,(HL)
000E6C 4E6C FE21             7      CP  021H
000E6E 4E6E D0              11      RET NC
000E6F 4E6F 3600            10      LD  (HL),0
000E71 4E71 15               4      DEC D
000E72 4E72 20F6            12      JR  NZ,GETL3
000E74 4E74 C9              10      RET
                                
       4E75                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       4E75                     CONSTX:
       4E75                     CPM_CONST:
000E75 4E75 C5              11      PUSH    BC
000E76 4E76 D5              11      PUSH    DE
000E77 4E77 E5              11      PUSH    HL
000E78 4E78 DDE5            15      PUSH    IX
000E7A 4E7A DD219C00        14      LD  IX,CHSNS
000E7E 4E7E CDD142          17      CALL    CALSLT_R
000E81 4E81 DDE1            14      POP IX
000E83 4E83 E1              10      POP HL
000E84 4E84 D1              10      POP DE
000E85 4E85 C1              10      POP BC
000E86 4E86 C9              10      RET
                                
       4E87                     _SYS2A:     ;(BDOS)日付の獲得
000E87 4E87 AF               4      XOR A
000E88 4E88 57               4      LD  D,A
000E89 4E89 5F               4      LD  E,A
000E8A 4E8A 67               4      LD  H,A
000E8B 4E8B 6F               4      LD  L,A
000E8C 4E8C C9              10      RET
                                
       4E8D                     _SYS2C:     ;(BDOS)時刻の獲得
000E8D 4E8D AF               4      XOR A
000E8E 4E8E 57               4      LD  D,A
000E8F 4E8F 5F               4      LD  E,A
000E90 4E90 67               4      LD  H,A
000E91 4E91 6F               4      LD  L,A
000E92 4E92 C9              10      RET
                                
       4E93                     POS:
000E93 4E93 F5              11      PUSH    AF
000E94 4E94 2ADCF3          16      LD  HL,(CSRY)
000E97 4E97 7D               4      LD  A,L
000E98 4E98 6C               4      LD  L,H
000E99 4E99 67               4      LD  H,A
000E9A 4E9A 2C               4      INC L
000E9B 4E9B 24               4      INC H
000E9C 4E9C F1              10      POP AF
000E9D 4E9D C9              10      RET
                                
       4E9E                     LOC:
000E9E 4E9E F5              11      PUSH    AF
000E9F 4E9F E5              11      PUSH    HL
000EA0 4EA0 7D               4      LD  A,L
000EA1 4EA1 6C               4      LD  L,H
000EA2 4EA2 67               4      LD  H,A
000EA3 4EA3 2D               4      DEC L
000EA4 4EA4 25               4      DEC H
000EA5 4EA5 DDE5            15      PUSH    IX
000EA7 4EA7 DD21C600        14      LD  IX,POSIT
000EAB 4EAB CDD142          17      CALL    CALSLT_R
000EAE 4EAE DDE1            14      POP IX
000EB0 4EB0 E1              10      POP HL
000EB1 4EB1 F1              10      POP AF
000EB2 4EB2 C9              10      RET
                                
       4EB3                     _SCRN:
       4EB3                     SCRN:
000EB3 4EB3 E5              11      PUSH    HL
000EB4 4EB4 DDE5            15      PUSH    IX
                                
000EB6 4EB6 69               4      LD  L,C
000EB7 4EB7 60               4      LD  H,B
000EB8 4EB8 DD214A00        14      LD  IX,RDVRM
000EBC 4EBC CDD142          17      CALL    CALSLT_R
                                
000EBF 4EBF DDE1            14      POP IX
000EC1 4EC1 E1              10      POP HL
000EC2 4EC2 C9              10      RET
                                
       4EC3                     CTRL02:
000EC3 4EC3 F5              11      PUSH    AF
000EC4 4EC4 D5              11      PUSH    DE
000EC5 4EC5 2ADCF3          16      LD  HL,(CSRY)
000EC8 4EC8 3AB0F3          13      LD  A,(LINLEN)
000ECB 4ECB 4F               4      LD  C,A
000ECC 4ECC 94               4      SUB H   ;CSRX
000ECD 4ECD C602             7      ADD A,2
000ECF 4ECF 47               4      LD  B,A ;カーソルより右の文字数
000ED0 4ED0 61               4      LD  H,C ;LINLEN
000ED1 4ED1 C5              11      PUSH    BC
000ED2 4ED2 CD204F          17      CALL    LOC0
000ED5 4ED5 C1              10      POP BC
                                
000ED6 4ED6 1620             7      LD  D,020H
       4ED8                     C8X1:
000ED8 4ED8 DD214A00        14      LD  IX,RDVRM
000EDC 4EDC CDD142          17      CALL    CALSLT_R
000EDF 4EDF 4F               4      LD  C,A
000EE0 4EE0 7A               4      LD  A,D
000EE1 4EE1 DD214D00        14      LD  IX,WRTVRM
000EE5 4EE5 CDD142          17      CALL    CALSLT_R
000EE8 4EE8 2B               6      DEC HL
000EE9 4EE9 51               4      LD  D,C
000EEA 4EEA 10EC            13      DJNZ    C8X1
000EEC 4EEC D1              10      POP DE
000EED 4EED F1              10      POP AF
000EEE 4EEE C9              10      RET
                                
       4EEF                     INSERT:
000EEF 4EEF F5              11      PUSH    AF
000EF0 4EF0 D5              11      PUSH    DE
000EF1 4EF1 2ADCF3          16      LD  HL,(CSRY)
000EF4 4EF4 3AB0F3          13      LD  A,(LINLEN)
000EF7 4EF7 4F               4      LD  C,A
000EF8 4EF8 94               4      SUB H   ;CSRX
000EF9 4EF9 3C               4      INC A
000EFA 4EFA 47               4      LD  B,A ;カーソルより右の文字数
000EFB 4EFB C5              11      PUSH    BC
000EFC 4EFC CD204F          17      CALL    LOC0
000EFF 4EFF C1              10      POP BC
                                
000F00 4F00 1620             7      LD  D,020H
       4F02                     INS1:
000F02 4F02 DD214A00        14      LD  IX,RDVRM
000F06 4F06 CDD142          17      CALL    CALSLT_R
000F09 4F09 4F               4      LD  C,A
000F0A 4F0A 7A               4      LD  A,D
000F0B 4F0B DD214D00        14      LD  IX,WRTVRM
000F0F 4F0F CDD142          17      CALL    CALSLT_R
000F12 4F12 23               6      INC HL
000F13 4F13 51               4      LD  D,C
000F14 4F14 10EC            13      DJNZ    INS1
000F16 4F16 D1              10      POP DE
000F17 4F17 F1              10      POP AF
000F18 4F18 C9              10      RET
                                
       4F19                     CONOUT1:
000F19 4F19 59               4      LD  E,C
000F1A 4F1A C34D4D          10      JP  _PRINT
                                
       4F1D                     GETVRAM:
000F1D 4F1D 2ADCF3          16      LD  HL,(CSRY)
       4F20                     LOC0:
000F20 4F20 2D               4      DEC L
000F21 4F21 25               4      DEC H
000F22 4F22 4C               4      LD  C,H ;CSRX-1
000F23 4F23 5D               4      LD  E,L ;CSRY-1
       4F24                     LOC1:
000F24 4F24 3AB0F3          13      LD  A,(LINLEN)
000F27 4F27 67               4      LD  H,A
000F28 4F28 1600             7      LD  D,0
000F2A 4F2A 6A               4      LD  L,D ;0
000F2B 4F2B 0608             7      LD  B,8
       4F2D                     LOC2:
000F2D 4F2D 29              11      ADD HL,HL
000F2E 4F2E 3001            12      JR  NC,LOC3
000F30 4F30 19              11      ADD HL,DE
       4F31                     LOC3:
000F31 4F31 10FA            13      DJNZ    LOC2
000F33 4F33 09              11      ADD HL,BC
000F34 4F34 C9              10      RET
                                
       4F35                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000F35 4F35 212200          10      LD  HL,00022H
000F38 4F38 AF               4      XOR A
000F39 4F39 7D               4      LD  A,L
000F3A 4F3A C9              10      RET
                                
       4F3B                     _SYS0D:     ;(BDOS)ディスク・リセット
000F3B 4F3B 218000          10      LD  HL,00080H
000F3E 4F3E 222EF1          16      LD  (_DTA),HL
000F41 4F41 C9              10      RET
                                
       4F42                     _SYS0E:     ;(BDOS)カレントドライブの設定
000F42 4F42 3242F1          13      LD  (_DVSW),A
000F45 4F45 C9              10      RET
                                
       4F46                     _SYS0F:     ;(BDOS)ファイルのオープン
000F46 4F46 D5              11      PUSH    DE
000F47 4F47 FDE1            14      POP IY
000F49 4F49 CD8F50          17      CALL    INIT_FILE
000F4C 4F4C CD0549          17      CALL    ROM_OPEN
000F4F 4F4F 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
000F51 4F51 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
000F55 4F55 FDE5            15      PUSH    IY
000F57 4F57 D1              10      POP DE
000F58 4F58 13               6      INC DE
000F59 4F59 010B00          10      LD  BC,11
000F5C 4F5C EDB0                    LDIR
                                ;               Attribute
000F5E 4F5E 7E               7      LD  A,(HL)
000F5F 4F5F FD770D          19      LD  (IY+13),A
                                ;               TIME
000F62 4F62 110B00          10      LD  DE,11
000F65 4F65 19              11      ADD HL,DE
000F66 4F66 7E               7      LD  A,(HL)
000F67 4F67 23               6      INC HL
000F68 4F68 FD7716          19      LD  (IY+22),A
000F6B 4F6B 7E               7      LD  A,(HL)
000F6C 4F6C 23               6      INC HL
000F6D 4F6D FD7717          19      LD  (IY+23),A
                                ;               DATE
000F70 4F70 7E               7      LD  A,(HL)
000F71 4F71 23               6      INC HL
000F72 4F72 FD7714          19      LD  (IY+20),A
000F75 4F75 7E               7      LD  A,(HL)
000F76 4F76 23               6      INC HL
000F77 4F77 FD7715          19      LD  (IY+21),A
                                ;               First cluster
000F7A 4F7A 7E               7      LD  A,(HL)
000F7B 4F7B 23               6      INC HL
000F7C 4F7C FD771A          19      LD  (IY+26),A
000F7F 4F7F 7E               7      LD  A,(HL)
000F80 4F80 23               6      INC HL
000F81 4F81 FD771B          19      LD  (IY+27),A
                                ;               SIZE
000F84 4F84 7E               7      LD  A,(HL)
000F85 4F85 23               6      INC HL
000F86 4F86 FD7710          19      LD  (IY+16),A
000F89 4F89 7E               7      LD  A,(HL)
000F8A 4F8A 23               6      INC HL
000F8B 4F8B FD7711          19      LD  (IY+17),A
000F8E 4F8E 7E               7      LD  A,(HL)
000F8F 4F8F 23               6      INC HL
000F90 4F90 FD7712          19      LD  (IY+18),A
000F93 4F93 7E               7      LD  A,(HL)
000F94 4F94 FD7713          19      LD  (IY+19),A
000F97 4F97 AF               4      XOR A
000F98 4F98 FD770C          19      LD  (IY+12),A
000F9B 4F9B C9              10      RET
                                
       4F9C                     _SYS10:     ;(BDOS)ファイルのクローズ
000F9C 4F9C AF               4      XOR A
000F9D 4F9D C9              10      RET
                                
       4F9E                     S11X1:
000F9E 4F9E FD7119          19      LD  (IY+25),C       ;RootEntCnt
000FA1 4FA1 FD750E          19      LD  (IY+14),L
000FA4 4FA4 FD740F          19      LD  (IY+15),H
       4FA7                     SCF_FF_RET:
000FA7 4FA7 37               4      SCF
000FA8 4FA8 9F               4      SBC A,A
000FA9 4FA9 C9              10      RET
                                
       4FAA                     _SYS11:     ;(BDOS)最初のファイルの検索
000FAA 4FAA ED5336F1        20      LD  (_FCB),DE
000FAE 4FAE D5              11      PUSH    DE
000FAF 4FAF FDE1            14      POP IY
000FB1 4FB1 CD8F50          17      CALL    INIT_FILE
000FB4 4FB4 CD224B          17      CALL    GET_DIR_DAT
       4FB7                     S12X1:
000FB7 4FB7 CD2149          17      CALL    FILESE
000FBA 4FBA 30E2            12      JR  NC,S11X1
000FBC 4FBC 0D               4      DEC C
000FBD 4FBD FD7119          19      LD  (IY+25),C       ;RootEntCnt
000FC0 4FC0 012000          10      LD  BC,32
000FC3 4FC3 ED5B2EF1        20      LD  DE,(_DTA)
000FC7 4FC7 AF               4      XOR A
000FC8 4FC8 12               7      LD  (DE),A      ;ドライブ番号
000FC9 4FC9 13               6      INC DE
000FCA 4FCA EDB0                    LDIR            ;ディレクトリエントリ
000FCC 4FCC FD750E          19      LD  (IY+14),L
000FCF 4FCF FD740F          19      LD  (IY+15),H
000FD2 4FD2 C9              10      RET
                                
       4FD3                     _SYS12:
000FD3 4FD3 FD2A36F1        20      LD  IY,(_FCB)
000FD7 4FD7 FDE5            15      PUSH    IY
000FD9 4FD9 D1              10      POP DE
000FDA 4FDA CD8F50          17      CALL    INIT_FILE
                                
000FDD 4FDD FD6E0E          19      LD  L,(IY+14)
000FE0 4FE0 FD660F          19      LD  H,(IY+15)
000FE3 4FE3 FD4E19          19      LD  C,(IY+25)
000FE6 4FE6 18CF            12      JR  S12X1
                                
       4FE8                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000FE8 4FE8 CD084B          17      CALL    SET_FCB
000FEB 4FEB CDD64A          17      CALL    GETSEQ
000FEE 4FEE CDC34A          17      CALL    RB_READ
000FF1 4FF1 E5              11      PUSH    HL
000FF2 4FF2 CDE34A          17      CALL    SETSEQ
000FF5 4FF5 E1              10      POP HL
       4FF6                     SREAD:
000FF6 4FF6 C601             7      ADD A,001H
000FF8 4FF8 D8              11      RET C
                                
000FF9 4FF9 7D               4      LD  A,L
000FFA 4FFA D601             7      SUB 001H
000FFC 4FFC 9F               4      SBC A,A
000FFD 4FFD E603             7      AND 3
000FFF 4FFF 1F               4      RRA
001000 5000 C9              10      RET
                                
       5001                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001001 5001 210100          10      LD  HL,00001H
001004 5004 AF               4      XOR A
001005 5005 C9              10      RET
                                
       5006                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001006 5006 3A42F1          13      LD  A,(_DVSW)
001009 5009 C9              10      RET
                                
       500A                     _SYS1A:     ;(BDOS)DTAの設定
00100A 500A ED532EF1        20      LD  (_DTA),DE
00100E 500E AF               4      XOR A
00100F 500F C9              10      RET
                                
       5010                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001010 5010 010002          10      LD  BC,512
001013 5013 11C302          10      LD  DE,707
001016 5016 210000          10      LD  HL,0
001019 5019 DD2138F1        14      LD  IX,_BUF
00101D 501D FD2138F1        14      LD  IY,_BUF
001021 5021 FD3600F9        19      LD  (IY+0),0F9H
001025 5025 3E02             7      LD  A,2
001027 5027 C9              10      RET
                                
       5028                     _SYS21:     ;(BDOS)ランダムな読み出し
001028 5028 CD084B          17      CALL    SET_FCB
                                
00102B 502B FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00102E 502E FD6622          19      LD  H,(IY+34)
                                
001031 5031 CDC34A          17      CALL    RB_READ
001034 5034 18C0            12      JR  SREAD
                                
       5036                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001036 5036 CD464F          17      CALL    _SYS0F
001039 5039 D8              11      RET C
                                
00103A 503A D5              11      PUSH    DE      ;EX DE,IY
00103B 503B FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00103D 503D CDF84A          17      CALL    GETSIZE
       5040                     _S24X1:
001040 5040 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001043 5043 FD7422          19      LD  (IY+34),H
001046 5046 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00104A 504A FDE3            23      EX  (SP),IY     ;
00104C 504C D1              10      POP DE      ;
                                
00104D 504D AF               4      XOR A
00104E 504E C9              10      RET
                                
       504F                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
00104F 504F E5              11      PUSH    HL
001050 5050 D5              11      PUSH    DE      ;EX DE,IY
001051 5051 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001053 5053 CDD64A          17      CALL    GETSEQ
001056 5056 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5058                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001058 5058 CD084B          17      CALL    SET_FCB
00105B 505B E5              11      PUSH    HL
00105C 505C FD6E21          19      LD  L,(IY+33)
00105F 505F FD6622          19      LD  H,(IY+34)
001062 5062 2224F1          16      LD  (RR_LOW),HL
001065 5065 FD6E23          19      LD  L,(IY+35)
001068 5068 FD6624          19      LD  H,(IY+36)
00106B 506B 2226F1          16      LD  (RR_HIGH),HL
00106E 506E E1              10      POP HL
00106F 506F CD2547          17      CALL    ROM_READ
001072 5072 ED5B24F1        20      LD  DE,(RR_LOW)
001076 5076 FD7321          19      LD  (IY+33),E
001079 5079 FD7222          19      LD  (IY+34),D
00107C 507C ED5B26F1        20      LD  DE,(RR_HIGH)
001080 5080 FD7323          19      LD  (IY+35),E
001083 5083 FD7224          19      LD  (IY+36),D
001086 5086 9F               4      SBC A,A
001087 5087 C9              10      RET
                                
       5088                     _SYS2F:
001088 5088 44               4      LD  B,H
001089 5089 2A2EF1          16      LD  HL,(_DTA)
00108C 508C C3614B          10      JP  DISKIO
                                
       508F                     INIT_FILE:
00108F 508F EB               4      EX  DE,HL
001090 5090 114BF1          10      LD  DE,FDRV
001093 5093 010C00          10      LD  BC,1+8+3
001096 5096 EDB0                    LDIR
001098 5098 CDF64C          17      CALL    GET_DISK_BANK_FDRV
00109B 509B 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00109E 509E 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0010A1 50A1 C9              10      RET
                                
       50A2                     ZERO_MEMORY_DE:
0010A2 50A2 AF               4      XOR A
       50A3                     FILL_MEMORY_DE:
0010A3 50A3 12               7      LD  (DE),A
0010A4 50A4 13               6      INC DE
0010A5 50A5 10FC            13      DJNZ    FILL_MEMORY_DE
0010A7 50A7 C9              10      RET
                                
0010A8 50A8                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 3A4D504D814D3A4D        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 3A4D3A4D864DC74D        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 8E4D3A4DE14D754E        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 354F3B4F424F464F        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 9C4FAA4FD34F3A4D        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 E84F3A4D3A4D3A4D        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 015006500A501050        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 3A4D3A4D3A4D3650        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 4F503A4D3A4D5850        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 3A4D3A4D874E3A4D        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 8D4E3A4D3A4D8850        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 3A4D3A4D3A4D3A4D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
