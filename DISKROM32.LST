                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
       0001                     USE_MORMAL32K_OR_ASCII16        EQU 1   ;ノーマル32KB/ASCII-16K ROMを作成する
                                
                                    INCLUDE "DISKROM.ASM"
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
                                BANK0_SEL EQU   06000H  ;6000-67FF
                                BANK1_SEL EQU   06800H  ;6800-6FFF
                                BANK2_SEL EQU   07000H  ;7000-77FF
                                BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
                                KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
                                KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
                                KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
                                KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
                                KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
                                KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
                                KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
       F280                     ISC EQU 0F280H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU 0F280H
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 6A4E                    DW  STATEMENT   ; STATEMENT
000006 4006 7B4F                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3FC4F          10      JP  DISKIO
000013 4013 C34250          10      JP  DSKCHG
000016 4016 C39850          10      JP  GETDPB
000019 4019 C38B51          10      JP  CHOICE
00001C 401C C38F51          10      JP  DSKFMT
00001F 401F C39151          10      JP  DSKSTP
000022 4022 C39251          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C38F51          10      JP  DSKFMT
000029 4029 C39151          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3CB51          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.4.0.0",0
            204449534B20524F    
            4D204C6974652076    
            302E342E302E3000    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 AF               4      XOR A
000107 4107 2100F3          10      LD  HL,0F300H
00010A 410A 0668             7      LD  B,068H
00010C 410C CD234B          17      CALL    FILL_MEMORY
                                
00010F 410F 3E01             7      LD  A,1
000111 4111 3221FB          13      LD  (DRVTBL),A
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000114 4114 2A74F6          16      LD  HL,(STKTOP) ;起動時の空き容量表示の為
000117 4117 01C0FE          10      LD  BC,-00140H
00011A 411A 09              11      ADD HL,BC
00011B 411B 2274F6          16      LD  (STKTOP),HL
                                #else
                                    LD  HL,STKTOP+1 ;起動時の空き容量表示の為
                                    DEC (HL)
                                #endif
                                
00011E 411E AF               4      XOR A
00011F 411F 32DDF2          13      LD  (_DVSW),A
000122 4122 3D               4      DEC A       ;0FFH
000123 4123 3299FD          13      LD  (DEVICE),A
                                
000126 4126 21E242          10      LD  HL,AT_ISC
000129 4129 1180F2          10      LD  DE,ISC
00012C 412C 017B00          10      LD  BC,ISC_E-ISC
00012F 412F EDB0                    LDIR
                                    
000131 4131 3EC3             7      LD  A,0C3H      ;JP
000133 4133 3243FF          13      LD  (H_GONE),A
000136 4136 327DF3          13      LD  (BDOS),A
000139 4139 326BF3          13      LD  (RAMUSE),A
00013C 413C 3268F3          13      LD  (ROMUSE),A
00013F 413F 2180F2          10      LD  HL,REPLACE_COMMAND
000142 4142 2244FF          16      LD  (H_GONE+1),HL
000145 4145 2131F3          10      LD  HL,H_BDOS
000148 4148 227EF3          16      LD  (BDOS+1),HL
00014B 414B 21B0F2          10      LD  HL,RAMUSE1
00014E 414E 226CF3          16      LD  (RAMUSE+1),HL
000151 4151 21ABF2          10      LD  HL,ROMUSE1
000154 4154 2269F3          16      LD  (ROMUSE+1),HL
                                
000157 4157 3E                      DB  03EH
000158 4158 F7              12      RST 30H
000159 4159 3271FE          13      LD  (H_BINS),A
00015C 415C 3276FE          13      LD  (H_BINL),A
00015F 415F 327BFE          13      LD  (H_FILE),A
000162 4162 3231F3          13      LD  (H_BDOS),A
000165 4165 32DBFD          13      LD  (H_PINL),A
000168 4168 32A7FF          13      LD  (H_PHYD),A
                                
00016B 416B CD2E42          17      CALL    GTSL1_
00016E 416E 3297F2          13      LD  (ROM_SLT),A
000171 4171 32A7F2          13      LD  (ROM_SLT_COPY),A
000174 4174 3272FE          13      LD  (H_BINS+1),A
000177 4177 3277FE          13      LD  (H_BINL+1),A
00017A 417A 327CFE          13      LD  (H_FILE+1),A
00017D 417D 3232F3          13      LD  (H_BDOS+1),A
000180 4180 32DCFD          13      LD  (H_PINL+1),A
000183 4183 32A8FF          13      LD  (H_PHYD+1),A
000186 4186 3222FB          13      LD  (DRVTBL+1),A
000189 4189 3248F3          13      LD  (MASTERS),A
                                
00018C 418C 219F45          10      LD  HL,ROM_LOAD
00018F 418F 2273FE          16      LD  (H_BINS+2),HL
000192 4192 21D846          10      LD  HL,ROM_RUN
000195 4195 2278FE          16      LD  (H_BINL+2),HL
000198 4198 21E546          10      LD  HL,ROM_FILES
00019B 419B 227DFE          16      LD  (H_FILE+2),HL
00019E 419E 212C52          10      LD  HL,ROM_BDOS
0001A1 41A1 2233F3          16      LD  (H_BDOS+2),HL
0001A4 41A4 219A43          10      LD  HL,ROM_BOOT
0001A7 41A7 22DDFD          16      LD  (H_PINL+2),HL
0001AA 41AA 21FC4F          10      LD  HL,DISKIO
0001AD 41AD 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001B0 41B0 3E                      DB  03EH
0001B1 41B1 C9              10      RET
0001B2 41B2 327FFE          13      LD  (H_FILE+4),A
0001B5 41B5 3275FE          13      LD  (H_BINS+4),A
0001B8 41B8 327AFE          13      LD  (H_BINL+4),A
0001BB 41BB 3235F3          13      LD  (H_BDOS+4),A
0001BE 41BE 32DFFD          13      LD  (H_PINL+4),A
0001C1 41C1 32ABFF          13      LD  (H_PHYD+4),A
                                
0001C4 41C4 AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
0001C5 41C5 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001C8 41C8 3A0060          13      LD  A,(BANK1_ADR)
0001CB 41CB FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
0001CD 41CD 284E            12      JR  Z,NOT_BANK_TYPE
0001CF 41CF 3E01             7      LD  A,DISK_BANK
0001D1 41D1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D4 41D4 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D7 41D7 07               4      RLCA
0001D8 41D8 07               4      RLCA
0001D9 41D9 F5              11      PUSH    AF
0001DA 41DA 1605             7      LD  D,4+1
0001DC 41DC CD3542          17      CALL    GTSL2_
0001DF 41DF 3244F3          13      LD  (RAMAD3),A
0001E2 41E2 F1              10      POP AF
0001E3 41E3 07               4      RLCA
0001E4 41E4 07               4      RLCA
0001E5 41E5 1603             7      LD  D,2+1
0001E7 41E7 CD3542          17      CALL    GTSL2_
0001EA 41EA 2680             7      LD  H,080H
0001EC 41EC CD5242          17      CALL    CHK_RAM
0001EF 41EF 3243F3          13      LD  (RAMAD2),A
       41F2                     RAMCHK2:
0001F2 41F2 3A44F3          13      LD  A,(RAMAD3)
0001F5 41F5 2640             7      LD  H,040H
0001F7 41F7 CD5242          17      CALL    CHK_RAM
0001FA 41FA 3242F3          13      LD  (RAMAD1),A
       41FD                     RAMCHK1:
0001FD 41FD 3A44F3          13      LD  A,(RAMAD3)
000200 4200 2600             7      LD  H,00H
000202 4202 CD5242          17      CALL    CHK_RAM
000205 4205 3241F3          13      LD  (RAMAD0),A
       4208                     RAMCHK0:
000208 4208 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
00020B 420B 010F00          10      LD  BC,0000FH       ;切り上げ
00020E 420E 09              11      ADD HL,BC
00020F 420F 7D               4      LD  A,L
                                
000210 4210 0604             7      LD  B,4
       4212                     B_DRIVE1:
000212 4212 CB3C             8      SRL H
000214 4214 1F               4      RRA
000215 4215 10FB            13      DJNZ    B_DRIVE1
                                
000217 4217 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000219 4219 32DCF2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
00021C 421C C9              10      RET
                                
       421D                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
00021D 421D 21D843          10      LD  HL,MSG_ERROR_ROM_MODE
000220 4220 CD6043          17      CALL    MSX
000223 4223 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000227 4227 DD219F00        14      LD  IX,CHGET
00022B 422B C31C00          10      JP  _CALSLT
                                
       422E                     GTSL1_:             ;自分のいるスロットを知る
00022E 422E CD3801          17      CALL    RSLREG      ;read primary slot #
000231 4231 0F               4      RRCA
000232 4232 0F               4      RRCA
000233 4233 1601             7      LD  D,1
       4235                     GTSL2_:
000235 4235 E603             7      AND 3       ;[A]=000000PP
000237 4237 5F               4      LD  E,A     ;[E]=000000PP
000238 4238 21C1FC          10      LD  HL,EXPTBL
00023B 423B 85               4      ADD A,L     ;桁上りは無い
00023C 423C 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00023D 423D 7B               4      LD  A,E     ;[A]=000000PP
00023E 423E CB7E            13      BIT 7,(HL)
000240 4240 C8              11      RET Z
000241 4241 7D               4      LD  A,L     ;point to SLTTBL entry
000242 4242 C604             7      ADD A,4     ;桁上りは無い
000244 4244 6F               4      LD  L,A
000245 4245 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4246                     GTSL3_:
000246 4246 15               4      DEC D
000247 4247 2803            12      JR  Z,GTSL4_:
000249 4249 0F               4      RRCA
00024A 424A 18FA            12      JR  GTSL3_:
       424C                     GTSL4_:
00024C 424C E60C             7      AND 00CH        ;[A] = 0000SS00
00024E 424E B3               4      OR  E       ;[A] = 0000SSPP
00024F 424F F680             7      OR  080H        ;[A] = 1000SSPP
000251 4251 C9              10      RET
                                
       4252                     CHK_RAM:
000252 4252 E5              11      PUSH    HL
000253 4253 CDA742          17      CALL    CHK_RAM0
000256 4256 E1              10      POP HL
000257 4257 C8              11      RET Z
000258 4258 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00025B 425B E680             7      AND 080H
00025D 425D CD7E42          17      CALL    CHK_RAM_SLT
000260 4260 C8              11      RET Z
000261 4261 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000264 4264 E680             7      AND 080H
000266 4266 C601             7      ADD A,1
000268 4268 CD7E42          17      CALL    CHK_RAM_SLT
00026B 426B C8              11      RET Z
00026C 426C 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00026F 426F E680             7      AND 080H
000271 4271 C602             7      ADD A,2
000273 4273 CD7E42          17      CALL    CHK_RAM_SLT
000276 4276 C8              11      RET Z
000277 4277 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00027A 427A E680             7      AND 080H
00027C 427C C603             7      ADD A,3
       427E                     CHK_RAM_SLT:
00027E 427E E5              11      PUSH    HL
00027F 427F CDA742          17      CALL    CHK_RAM0        ;スロット#X or X-0
000282 4282 E1              10      POP HL
000283 4283 C8              11      RET Z
000284 4284 CB79             8      BIT 7,C
000286 4286 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
000288 4288 79               4      LD  A,C
000289 4289 C604             7      ADD A,4*1           ;スロット#X-1
00028B 428B E5              11      PUSH    HL
00028C 428C CDA742          17      CALL    CHK_RAM0
00028F 428F E1              10      POP HL
000290 4290 C8              11      RET Z
000291 4291 79               4      LD  A,C
000292 4292 C608             7      ADD A,4*2           ;スロット#X-2
000294 4294 E5              11      PUSH    HL
000295 4295 CDA742          17      CALL    CHK_RAM0
000298 4298 E1              10      POP HL
000299 4299 C8              11      RET Z
00029A 429A 79               4      LD  A,C
00029B 429B C60C             7      ADD A,4*3           ;スロット#X-3
00029D 429D E5              11      PUSH    HL
00029E 429E CDA742          17      CALL    CHK_RAM0
0002A1 42A1 E1              10      POP HL
       42A2                     CHK_RAM_E:
0002A2 42A2 AF               4      XOR A
0002A3 42A3 3C               4      INC A           ;ZF=0にする
0002A4 42A4 3E00             7      LD  A,0
0002A6 42A6 C9              10      RET
                                
       42A7                     CHK_RAM0:
0002A7 42A7 4F               4      LD  C,A
0002A8 42A8 3A97F2          13      LD  A,(ROM_SLT)
0002AB 42AB B9               4      CP  C
0002AC 42AC 28F4            12      JR  Z,CHK_RAM_E
0002AE 42AE 2E00             7      LD  L,0
       42B0                     CHK_RAM1:
0002B0 42B0 79               4      LD  A,C
0002B1 42B1 CD9243          17      CALL    RDSLTX
0002B4 42B4 C6E5             7      ADD A,0E5H
0002B6 42B6 47               4      LD  B,A
0002B7 42B7 5F               4      LD  E,A
0002B8 42B8 79               4      LD  A,C
0002B9 42B9 C5              11      PUSH    BC
0002BA 42BA CD1400          17      CALL    _WRSLT
0002BD 42BD C1              10      POP BC
0002BE 42BE 79               4      LD  A,C
0002BF 42BF CD9243          17      CALL    RDSLTX
0002C2 42C2 B8               4      CP  B
0002C3 42C3 C0              11      RET NZ
0002C4 42C4 D6E5             7      SUB 0E5H
0002C6 42C6 79               4      LD  A,C
0002C7 42C7 5F               4      LD  E,A
0002C8 42C8 C5              11      PUSH    BC
0002C9 42C9 CD1400          17      CALL    _WRSLT
0002CC 42CC C1              10      POP BC
0002CD 42CD 24               4      INC H
0002CE 42CE 7D               4      LD  A,L
0002CF 42CF C604             7      ADD A,4
0002D1 42D1 6F               4      LD  L,A
0002D2 42D2 20DC            12      JR  NZ,CHK_RAM1
0002D4 42D4 79               4      LD  A,C     ;ZF=1のハズ
0002D5 42D5 C9              10      RET
                                
       42D6                     CALSLT_R:
0002D6 42D6 C5              11      PUSH    BC
0002D7 42D7 E5              11      PUSH    HL
0002D8 42D8 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DC 42DC CD1C00          17      CALL    _CALSLT
0002DF 42DF E1              10      POP HL
0002E0 42E0 C1              10      POP BC
0002E1 42E1 C9              10      RET
                                
       42E2                     AT_ISC:
0002E2 F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
0002E2 F280 FEB7             7      CP  0B7H            ;FILES
0002E4 F282 CC7BFE          17      CALL    Z,H_FILE
0002E7 F285 FEB5             7      CP  0B5H            ;LOAD
0002E9 F287 CA71FE          10      JP  Z,H_BINS
0002EC F28A FE8A             7      CP  08AH            ;RUN
0002EE F28C CA76FE          10      JP  Z,H_BINL
0002F1 F28F FED6             7      CP  0D6H            ;COPY
0002F3 F291 2813            12      JR  Z,FIX_COPY
0002F5 F293 FECF             7      CP  0CFH            ;BLOAD
0002F7 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
0002F8 F296 F7              12      RST 30H
       F297                     ROM_SLT:
0002F9 F297 00                      DB  0
0002FA F298 0A46                    DW  ROM_BLOAD
0002FC F29A F5              11      PUSH    AF
0002FD F29B E5              11      PUSH    HL
0002FE F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
000301 F29F E1              10      POP HL
000302 F2A0 F1              10      POP AF
000303 F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000305 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000307 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000308 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000309 F2A7 00                      DB  0
00030A F2A8 7047                    DW  ROM_COPY
00030C F2AA C9              10      RET
       F2AB                     ROMUSE1:
00030D F2AB 3A97F2          13      LD  A,(ROM_SLT)
000310 F2AE 1803            12      JR  ROMUSE2
       F2B0                     RAMUSE1:
000312 F2B0 3A42F3          13      LD  A,(RAMAD1)
       F2B3                     ROMUSE2:
000315 F2B3 C32400          10      JP  _ENASLT
                                
       F2B6                     _RESULT:
000318 F2B6 00                      DB  0
       F2B7                     _BANK:
000319 F2B7 00                      DB  0
       F2B8                     _BANK1:
00031A F2B8 00                      DB  0
       F2B9                     CLSZ:               ;クラスタサイズ
00031B F2B9 0004                    DW  1024
       F2BA                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2BB                     SECSZ:              ;セクタサイズ
00031D F2BB 0002                    DW  512
       F2BC                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2BD                     RR_LOW:
00031F F2BD 0000                    DW  0
       F2BE                     RR_MID  EQU $-1
       F2BF                     RR_HIGH:
000321 F2BF 0000                    DW  0
       F2C1                     _CLPS:
000323 F2C1 0000                    DW  0
       F2C3                     _LEFT:
000325 F2C3 0000                    DW  0
       F2C5                     _DTPS:
000327 F2C5 0000                    DW  0
       F2C7                     _DTA:
000329 F2C7 0000                    DW  0
       F2C9                     FLG_LDIR:
00032B F2C9 00                      DB  0
       F2CA                     _FCB:
00032C F2CA 0000                    DW  0
       F2CC                     _BUF:
       F2CC                     _BUF_LO:        ;LOGICAL OPERATION
00032E F2CC 00                      DB  0
       F2CD                     _BUF_ST:
00032F F2CD 0000                    DW  0
       F2CF                     _BUF_EN:
000331 F2CF 0000                    DW  0
       F2D1                     _BUF_EX:
       F2D1                     _BUF_W:
000333 F2D1 0000                    DW  0
       F2D3                     _BUF_H:
000335 F2D3 0000                    DW  0
       F2D5                     _BUF_X:
000337 F2D5 0000                    DW  0
       F2D7                     _BUF_Y:
000339 F2D7 00                      DB  0
       F2D8                     _BUF_P:
00033A F2D8 00                      DB  0
       F2D9                     _BUF_O:
00033B F2D9 00                      DB  0
       F2DA                     DTAX:
00033C F2DA 0000                    DW  0
       F2DC                     B_DRIVE:
00033E F2DC 00                      DB  0
       F2DD                     _DVSW:          ;カレントドライブ
00033F F2DD 00                      DB  0
       F2DE                     _CD:            ;カレントディレクトリ
000340 F2DE 0000                    DW  0
       F2E0                     DIRENT1:
000342 F2E0 0000                    DW  0
       F2E2                     _DIR_BANK:
000344 F2E2 00                      DB  0
       F2E3                     LEFTX:
000345 F2E3 0000                    DW  0
       F2E5                     PARAM0:
000347 F2E5 0000                    DW  0
       F2E7                     PARAM1:
000349 F2E7 0000                    DW  0
       F2E9                     _CDX:
00034B F2E9 0000                    DW  0
       F2EB                     FDRV:
00034D F2EB 00                      DB  0
       F2EC                     FNAME:
00034E F2EC                         DS  8+3
       F2F7                     _HL:
000359 F2F7 0000                    DW  0
       F2F9                     _SP:
00035B F2F9 0000                    DW  0
       F2FA                     _SP_H   EQU $-1
       F2FB                     ISC_E:
00035D 435D                         ORG $$+RUN          ;$DEPHASE
                                
       435D                     MSX1:
00035D 435D CD4552          17      CALL    MSGA1
       4360                     MSX:
000360 4360 7E               7      LD  A,(HL)
000361 4361 23               6      INC HL
000362 4362 B7               4      OR  A
000363 4363 20F8            12      JR  NZ,MSX1
000365 4365 C9              10      RET
                                
       4366                     PRTHX:
000366 4366 F5              11      PUSH    AF
000367 4367 07               4      RLCA
000368 4368 07               4      RLCA
000369 4369 07               4      RLCA
00036A 436A 07               4      RLCA
00036B 436B CD6F43          17      CALL    PRTA2
00036E 436E F1              10      POP AF
       436F                     PRTA2:
00036F 436F CD7543          17      CALL    ASC
000372 4372 C34152          10      JP  MSG_A
                                    
       4375                     ASC:
000375 4375 E60F             7      AND $0F
000377 4377 F630             7      OR  $30
000379 4379 FE3A             7      CP  $3A
00037B 437B D8              11      RET C
00037C 437C C607             7      ADD A,7
00037E 437E C9              10      RET
                                
       437F                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
00037F 437F CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000382 4382 23               6      INC HL
000383 4383 CD4152          17      CALL    MSG_A
000386 4386 10F7            13      DJNZ    MSN
000388 4388 C9              10      RET
                                
       4389                     RDSLT_ROM3:
000389 4389 7E               7      LD  A,(HL)
00038A 438A C9              10      RET
       438B                     RDSLT_ROM:
00038B 438B CB7C             8      BIT 7,H
00038D 438D 28FA            12      JR  Z,RDSLT_ROM3
       438F                     RDSLT_ROM2:
00038F 438F 3A97F2          13      LD  A,(ROM_SLT)
       4392                     RDSLTX:
000392 4392 C5              11      PUSH    BC
000393 4393 D5              11      PUSH    DE
000394 4394 CD0C00          17      CALL    _RDSLT
000397 4397 D1              10      POP DE
000398 4398 C1              10      POP BC
000399 4399 C9              10      RET
                                
       439A                     ROM_BOOT:
00039A 439A 3E                      DB  03EH
00039B 439B C9              10      RET
00039C 439C 32DBFD          13      LD  (H_PINL),A
00039F 439F 3ACAFF          13      LD  A,(EXTBIO)
0003A2 43A2 FEF7             7      CP  0F7H        ;RST 30H
0003A4 43A4 2805            12      JR  Z,EXTBIO_OK
0003A6 43A6 3E                      DB  03EH
0003A7 43A7 C9              10      RET
0003A8 43A8 32CAFF          13      LD  (EXTBIO),A
       43AB                     EXTBIO_OK:
0003AB 43AB 21F543          10      LD  HL,DELOK
0003AE 43AE CD6043          17      CALL    MSX
                                
0003B1 43B1 AF               4      XOR A
0003B2 43B2 3240F3          13      LD  (REBOOT),A
0003B5 43B5 2A48FC          16      LD  HL,(BOTTOM)
0003B8 43B8 110040          10      LD  DE,16384
0003BB 43BB 19              11      ADD HL,DE
0003BC 43BC 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003BE 43BE 57               4      LD  D,A
0003BF 43BF 0601             7      LD  B,1
0003C1 43C1 2100C0          10      LD  HL,0C000H
0003C4 43C4 CDFC4F          17      CALL    DISKIO
                                
0003C7 43C7 116BF3          10      LD  DE,RAMUSE
0003CA 43CA AF               4      XOR A
0003CB 43CB CD1EC0          17      CALL    0C01EH
0003CE 43CE 116BF3          10      LD  DE,RAMUSE
0003D1 43D1 37               4      SCF
0003D2 43D2 CD1EC0          17      CALL    0C01EH
       43D5                     BOOT1:
0003D5 43D5 C39251          10      JP  BASENT
                                
       43D8                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
0003D8 43D8 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
       43F4                     NULL:
0003F4 43F4 00                      DB  0
       43F5                     DELOK:
0003F5 43F5 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       43F9                     ROM_LDIR:
0003F9 43F9 3AC9F2          13      LD  A,(FLG_LDIR)
0003FC 43FC B7               4      OR  A
0003FD 43FD 206A            12      JR  NZ,ROM_LDIRVM
0003FF 43FF CB7A             8      BIT 7,D
000401 4401 CA9944          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
       4404                     LDIRA:
000404 4404 F3               4      DI
000405 4405 ED73F9F2        20      LD  (_SP),SP
000409 4409 3AFAF2          13      LD  A,(_SP_H)
00040C 440C FEC0             7      CP  0C0H
00040E 440E 3003            12      JR  NC,SPJ1
000410 4410 3180F2          10      LD  SP,SP32
       4413                     SPJ1:
       4413                     LDIR1:
000413 4413 78               4      LD  A,B
000414 4414 B1               4      OR  C
000415 4415 284D            12      JR  Z,LDIRE
                                
000417 4417 C5              11      PUSH    BC
000418 4418 D5              11      PUSH    DE
000419 4419 E5              11      PUSH    HL
00041A 441A 3A97F2          13      LD  A,(ROM_SLT)
00041D 441D 2680             7      LD  H,080H
00041F 441F CD2400          17      CALL    _ENASLT
000422 4422 E1              10      POP HL
000423 4423 D1              10      POP DE
000424 4424 C1              10      POP BC
       4425                     LDIR2:
000425 4425 7A               4      LD  A,D
000426 4426 FEC0             7      CP  0C0H
000428 4428 302C            12      JR  NC,LDIR4
                                
00042A 442A C5              11      PUSH    BC
00042B 442B D5              11      PUSH    DE
00042C 442C 115EF5          10      LD  DE,BUF
                                
00042F 442F 78               4      LD  A,B
000430 4430 B7               4      OR  A
000431 4431 2803            12      JR  Z,LDIR3
000433 4433 010001          10      LD  BC,00100H
       4436                     LDIR3:
000436 4436 C5              11      PUSH    BC
000437 4437 EDB0                    LDIR
000439 4439 22F7F2          16      LD  (_HL),HL
                                
00043C 443C 3A43F3          13      LD  A,(RAMAD2)
00043F 443F 2680             7      LD  H,080H
000441 4441 CD2400          17      CALL    _ENASLT
                                
000444 4444 C1              10      POP BC
000445 4445 D1              10      POP DE
000446 4446 215EF5          10      LD  HL,BUF
000449 4449 EDB0                    LDIR
                                
00044B 444B 2AF7F2          16      LD  HL,(_HL)
00044E 444E C1              10      POP BC
00044F 444F 78               4      LD  A,B
000450 4450 B7               4      OR  A
000451 4451 2811            12      JR  Z,LDIRE
000453 4453 05               4      DEC B
000454 4454 18BD            12      JR  LDIR1
       4456                     LDIR4:
                                #endif
000456 4456 EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
       4458                     LDIRE2:
000458 4458 D5              11      PUSH    DE
000459 4459 E5              11      PUSH    HL
00045A 445A 3A43F3          13      LD  A,(RAMAD2)
00045D 445D 2680             7      LD  H,080H
00045F 445F CD2400          17      CALL    _ENASLT
000462 4462 E1              10      POP HL
000463 4463 D1              10      POP DE
       4464                     LDIRE:
000464 4464 ED7BF9F2        20      LD  SP,(_SP)
                                #endif
000468 4468 C9              10      RET
                                
       4469                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
000469 4469 F3               4      DI
00046A 446A ED73F9F2        20      LD  (_SP),SP
00046E 446E 3AFAF2          13      LD  A,(_SP_H)
000471 4471 FEC0             7      CP  0C0H
000473 4473 3003            12      JR  NC,SPJ2
000475 4475 3180F2          10      LD  SP,SP32
       4478                     SPJ2:
000478 4478 C5              11      PUSH    BC
000479 4479 D5              11      PUSH    DE
00047A 447A E5              11      PUSH    HL
00047B 447B 3A97F2          13      LD  A,(ROM_SLT)
00047E 447E 2680             7      LD  H,080H
000480 4480 CD2400          17      CALL    _ENASLT
000483 4483 E1              10      POP HL
000484 4484 D1              10      POP DE
000485 4485 C1              10      POP BC
                                #endif
000486 4486 C5              11      PUSH    BC
000487 4487 D5              11      PUSH    DE
000488 4488 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00048C 448C DD215C00        14      LD  IX,LDIRVM
000490 4490 CD1C00          17      CALL    _CALSLT
000493 4493 E1              10      POP HL
000494 4494 C1              10      POP BC
000495 4495 09              11      ADD HL,BC
000496 4496 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
000497 4497 18BF            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       4499                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
000499 4499 F3               4      DI
00049A 449A ED73F9F2        20      LD  (_SP),SP
00049E 449E 3AFAF2          13      LD  A,(_SP_H)
0004A1 44A1 FEC0             7      CP  0C0H
0004A3 44A3 3003            12      JR  NC,SPJ3
0004A5 44A5 3180F2          10      LD  SP,SP32
       44A8                     SPJ3:
0004A8 44A8 C5              11      PUSH    BC
0004A9 44A9 D5              11      PUSH    DE
0004AA 44AA E5              11      PUSH    HL
0004AB 44AB 3A97F2          13      LD  A,(ROM_SLT)
0004AE 44AE 2680             7      LD  H,080H
0004B0 44B0 CD2400          17      CALL    _ENASLT
0004B3 44B3 E1              10      POP HL
0004B4 44B4 D1              10      POP DE
0004B5 44B5 C1              10      POP BC
                                #endif
       44B6                     ROM_LDIRSLT1:
0004B6 44B6 EB               4      EX  DE,HL
       44B7                     RLDIRSLT1:
0004B7 44B7 CB7C             8      BIT 7,H
0004B9 44B9 2021            12      JR  NZ,RLDIRSLT_EXIT
0004BB 44BB 1A               7      LD  A,(DE)
0004BC 44BC 13               6      INC DE
0004BD 44BD C5              11      PUSH    BC
0004BE 44BE D5              11      PUSH    DE
0004BF 44BF E5              11      PUSH    HL
0004C0 44C0 5F               4      LD  E,A
                                
0004C1 44C1 0141F3          10      LD  BC,RAMAD0
0004C4 44C4 7C               4      LD  A,H
0004C5 44C5 07               4      RLCA
0004C6 44C6 07               4      RLCA
0004C7 44C7 E603             7      AND 3
0004C9 44C9 81               4      ADD A,C
0004CA 44CA 4F               4      LD  C,A
0004CB 44CB 0A               7      LD  A,(BC)
       44CC                     RLDIRSLT2:
0004CC 44CC CD1400          17      CALL    _WRSLT
0004CF 44CF 08               4      EX  AF,AF'
0004D0 44D0 E1              10      POP HL
0004D1 44D1 D1              10      POP DE
0004D2 44D2 C1              10      POP BC
0004D3 44D3 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004D5 44D5 EAB744          10      JP  PE,RLDIRSLT1
0004D8 44D8 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0004D9 44D9 C35844          10      JP  LDIRE2
       44DC                     RLDIRSLT_EXIT:
0004DC 44DC EB               4      EX  DE,HL
0004DD 44DD C31344          10      JP  LDIR1
                                #else
                                    RET
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    LDIR
                                    RET
                                #endif
                                
       44E0                     END_OF_LINE:
0004E0 44E0 215EF5          10      LD  HL,BUF
       44E3                     EOL1:
0004E3 44E3 7E               7      LD  A,(HL)
0004E4 44E4 C8              11      RET Z
0004E5 44E5 FE0D             7      CP  00DH
0004E7 44E7 2807            12      JR  Z,EOLE
0004E9 44E9 FE0A             7      CP  00AH
0004EB 44EB 2803            12      JR  Z,EOLE
0004ED 44ED 23               6      INC HL
0004EE 44EE 18F3            12      JR  EOL1
       44F0                     EOLE:
0004F0 44F0 3600            10      LD  (HL),0
0004F2 44F2 23               6      INC HL
0004F3 44F3 7E               7      LD  A,(HL)
0004F4 44F4 FE0A             7      CP  00AH
0004F6 44F6 C0              11      RET NZ
0004F7 44F7 23               6      INC HL
0004F8 44F8 C9              10      RET
                                
       44F9                     ROM_LOAD_ASCII:
0004F9 44F9 210000          10      LD  HL,0
0004FC 44FC 22CDF2          16      LD  (_BUF_ST),HL    ;読み出し位置
0004FF 44FF 2A76F6          16      LD  HL,(TXTTAB)
000502 4502 22CFF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000505 4505 215EF5          10      LD  HL,BUF
000508 4508 22C7F2          16      LD  (_DTA),HL
       450B                     RLOAD_A1:
00050B 450B 2ACDF2          16      LD  HL,(_BUF_ST)
00050E 450E 22BDF2          16      LD  (RR_LOW),HL
000511 4511 210201          10      LD  HL,258
000514 4514 CD9049          17      CALL    ROM_READ
000517 4517 7C               4      LD  A,H
000518 4518 B5               4      OR  L
000519 4519 2877            12      JR  Z,RLOAD_AEND
00051B 451B 015EF5          10      LD  BC,BUF
00051E 451E 09              11      ADD HL,BC
00051F 451F 3600            10      LD  (HL),0
000521 4521 CDE044          17      CALL    END_OF_LINE
000524 4524 015EF5          10      LD  BC,BUF
000527 4527 A7               4      AND A
000528 4528 ED42            15      SBC HL,BC
00052A 452A 2810            12      JR  Z,RLOAD_A2
00052C 452C 4D               4      LD  C,L
00052D 452D 44               4      LD  B,H
00052E 452E ED5BCDF2        20      LD  DE,(_BUF_ST)
000532 4532 19              11      ADD HL,DE
000533 4533 22CDF2          16      LD  (_BUF_ST),HL
000536 4536 3A5EF5          13      LD  A,(BUF)
000539 4539 B7               4      OR  A
00053A 453A 28CF            12      JR  Z,RLOAD_A1
       453C                     RLOAD_A2:
00053C 453C 115EF5          10      LD  DE,BUF
00053F 453F CD5A4B          17      CALL    SPCUTEX
000542 4542 1A               7      LD  A,(DE)
000543 4543 B7               4      OR  A
000544 4544 284C            12      JR  Z,RLOAD_AEND
000546 4546 CD6C4B          17      CALL    GETNUM
000549 4549 7C               4      LD  A,H
00054A 454A B5               4      OR  L
00054B 454B CAF145          10      JP  Z,ERROR_DIRECT_IN_FILE
00054E 454E DD2ACFF2        20      LD  IX,(_BUF_EN)
000552 4552 DD7502          19      LD  (IX+2),L
000555 4555 DD7403          19      LD  (IX+3),H
                                
000558 4558 CD534B          17      CALL    SPCUT
00055B 455B EB               4      EX  DE,HL
00055C 455C DDE5            15      PUSH    IX
00055E 455E DD21B242        14      LD  IX,CRUNCH
000562 4562 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000566 4566 CD1C00          17      CALL    _CALSLT
000569 4569 DDE1            14      POP IX
00056B 456B EB               4      EX  DE,HL
00056C 456C 111FF4          10      LD  DE,KBUF
00056F 456F 37               4      SCF
000570 4570 ED52            15      SBC HL,DE
000572 4572 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
000574 4574 387B            12      JR  C,ERROR_DIRECT_IN_FILE
000576 4576 4D               4      LD  C,L
000577 4577 44               4      LD  B,H
000578 4578 2ACFF2          16      LD  HL,(_BUF_EN)
00057B 457B 110400          10      LD  DE,4
00057E 457E 19              11      ADD HL,DE
00057F 457F 111FF4          10      LD  DE,KBUF
                                
000582 4582 EB               4      EX  DE,HL
000583 4583 EDB0                    LDIR
000585 4585 EB               4      EX  DE,HL
                                
000586 4586 DD7500          19      LD  (IX+0),L
000589 4589 DD7401          19      LD  (IX+1),H
00058C 458C 22CFF2          16      LD  (_BUF_EN),HL
00058F 458F C30B45          10      JP  RLOAD_A1
                                
       4592                     RLOAD_AEND:
000592 4592 2ACFF2          16      LD  HL,(_BUF_EN)
000595 4595 AF               4      XOR A
000596 4596 77               7      LD  (HL),A
000597 4597 23               6      INC HL
000598 4598 77               7      LD  (HL),A
000599 4599 23               6      INC HL
00059A 459A 22CFF2          16      LD  (_BUF_EN),HL
00059D 459D 183B            12      JR  RLOAD_END1
                                
       459F                     ROM_LOAD:
00059F 459F CD3E47          17      CALL    INIT_PARAM
0005A2 45A2 CD314A          17      CALL    FILE_B
0005A5 45A5 3AECF2          13      LD  A,(FNAME)
0005A8 45A8 FE20             7      CP  020H
0005AA 45AA CA2C4A          10      JP  Z,ROM_ORG
                                
0005AD 45AD CDC34B          17      CALL    ROM_OPEN
0005B0 45B0 384B            12      JR  C,ERROR_FILE_NOT_FOUND
       45B2                     ROM_LOAD1:
0005B2 45B2 21CCF2          10      LD  HL,_BUF
0005B5 45B5 22C7F2          16      LD  (_DTA),HL
0005B8 45B8 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0005BB 45BB CD9049          17      CALL    ROM_READ
0005BE 45BE 3ACCF2          13      LD  A,(_BUF)
0005C1 45C1 3C               4      INC A
0005C2 45C2 C2F944          10      JP  NZ,ROM_LOAD_ASCII
0005C5 45C5 2A76F6          16      LD  HL,(TXTTAB)
0005C8 45C8 22C7F2          16      LD  (_DTA),HL
0005CB 45CB EB               4      EX  DE,HL
0005CC 45CC 2100FF          10      LD  HL,-256
0005CF 45CF 39              11      ADD HL,SP
0005D0 45D0 ED52            15      SBC HL,DE
0005D2 45D2 CD9049          17      CALL    ROM_READ
0005D5 45D5 ED5BC7F2        20      LD  DE,(_DTA)
0005D9 45D9 19              11      ADD HL,DE
       45DA                     RLOAD_END1:
0005DA 45DA 22C2F6          16      LD  (VARTAB),HL
0005DD 45DD 22C4F6          16      LD  (ARYTAB),HL
0005E0 45E0 22C6F6          16      LD  (STREND),HL
                                
0005E3 45E3 AF               4      XOR A
0005E4 45E4 21CFF2          10      LD  HL,_BUF+3
0005E7 45E7 77               7      LD  (HL),A
0005E8 45E8 2B               6      DEC HL
0005E9 45E9 77               7      LD  (HL),A
0005EA 45EA 2B               6      DEC HL
0005EB 45EB 77               7      LD  (HL),A
0005EC 45EC 2B               6      DEC HL
0005ED 45ED 3E8F             7      LD  A,08FH          ;REM
0005EF 45EF 77               7      LD  (HL),A
0005F0 45F0 C9              10      RET
                                
       45F1                     ERROR_DIRECT_IN_FILE:
0005F1 45F1 1E39             7      LD  E,57            ;Direct statement in file
0005F3 45F3 01                      DB  1           ;LD BC,
       45F4                     ERROR_DEVICE_IO_ERROR:
0005F4 45F4 1E13             7      LD  E,19            ;Device I/O error
0005F6 45F6 01                      DB  1           ;LD BC,
       45F7                     ERROR_INTERNAL_ERROR:
0005F7 45F7 1E33             7      LD  E,51            ;Internal error
0005F9 45F9 01                      DB  1           ;LD BC,
       45FA                     ERROR_FILE_NOT_OPEN:
0005FA 45FA 1E3B             7      LD  E,59            ;File not OPEN
0005FC 45FC 01                      DB  1           ;LD BC,
       45FD                     ERROR_FILE_NOT_FOUND:
0005FD 45FD 1E35             7      LD  E,53            ;File not found
       45FF                     ERROR:
0005FF 45FF FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000603 4603 DD216F40        14      LD  IX,ERRHAND
000607 4607 C31C00          10      JP  _CALSLT
                                
       460A                     ROM_BLOAD:
00060A 460A CD3E47          17      CALL    INIT_PARAM
00060D 460D CD314A          17      CALL    FILE_B
000610 4610 CDC34B          17      CALL    ROM_OPEN
000613 4613 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000615 4615 21CCF2          10      LD  HL,_BUF
000618 4618 22C7F2          16      LD  (_DTA),HL
00061B 461B 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
00061E 461E CD9049          17      CALL    ROM_READ
000621 4621 3ACCF2          13      LD  A,(_BUF)
000624 4624 FEFE             7      CP  0FEH
000626 4626 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
000628 4628 21A5F2          10      LD  HL,BLOAD_RET
00062B 462B 229DF2          16      LD  (SWC_BLOAD),HL
                                
00062E 462E 2AE7F2          16      LD  HL,(PARAM1)
000631 4631 7E               7      LD  A,(HL)
000632 4632 FE2C             7      CP  ','
000634 4634 2048            12      JR  NZ,RBREAD_MEM
000636 4636 23               6      INC HL
000637 4637 7E               7      LD  A,(HL)
000638 4638 CDAD4B          17      CALL    CAP
00063B 463B 32BEFC          13      LD  (RUNBNF),A
       463E                     RBOS1:
00063E 463E 7E               7      LD  A,(HL)
00063F 463F 23               6      INC HL
000640 4640 B7               4      OR  A
000641 4641 282F            12      JR  Z,RBREAD_OSE
000643 4643 FE3A             7      CP  ':'
000645 4645 282B            12      JR  Z,RBREAD_OSE
000647 4647 FE2C             7      CP  ','     ;次のパラメータを探す
000649 4649 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
00064B 464B 22E7F2          16      LD  (PARAM1),HL
00064E 464E 7E               7      LD  A,(HL)
00064F 464F B7               4      OR  A
000650 4650 2820            12      JR  Z,RBREAD_OSE
000652 4652 DD21644C        14      LD  IX,FRMEVL
000656 4656 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00065A 465A CD1C00          17      CALL    _CALSLT
00065D 465D 22E7F2          16      LD  (PARAM1),HL
000660 4660 3A63F6          13      LD  A,(VALTYP)
000663 4663 FE02             7      CP  2
000665 4665 200B            12      JR  NZ,RBREAD_OSE
000667 4667 2ACDF2          16      LD  HL,(_BUF_ST)
00066A 466A ED5BF8F7        20      LD  DE,(DACDAT)
00066E 466E 19              11      ADD HL,DE
00066F 466F 22CDF2          16      LD  (_BUF_ST),HL
       4672                     RBREAD_OSE:
000672 4672 3ABEFC          13      LD  A,(RUNBNF)
000675 4675 FE53             7      CP  'S'
000677 4677 2005            12      JR  NZ,RBREAD_MEM
000679 4679 3E01             7      LD  A,1
00067B 467B 32C9F2          13      LD  (FLG_LDIR),A
       467E                     RBREAD_MEM:
00067E 467E 2ACDF2          16      LD  HL,(_BUF_ST)
000681 4681 22BFFC          16      LD  (SAVENT),HL
000684 4684 22C7F2          16      LD  (_DTA),HL
000687 4687 21FFFF          10      LD  HL,0FFFFH
00068A 468A CD9049          17      CALL    ROM_READ
00068D 468D AF               4      XOR A
00068E 468E 32C9F2          13      LD  (FLG_LDIR),A
000691 4691 3ABEFC          13      LD  A,(RUNBNF)
000694 4694 FE52             7      CP  'R'
000696 4696 2006            12      JR  NZ,RBREAD1
000698 4698 2AD1F2          16      LD  HL,(_BUF_EX)
00069B 469B 229DF2          16      LD  (SWC_BLOAD),HL
       469E                     RBREAD1:
       469E                     ROM_NEXT:
00069E 469E 2AE7F2          16      LD  HL,(PARAM1)
0006A1 46A1 7E               7      LD  A,(HL)
0006A2 46A2 2B               6      DEC HL
0006A3 46A3 B7               4      OR  A
0006A4 46A4 2805            12      JR  Z,RN1
0006A6 46A6 FE3A             7      CP  ':'
0006A8 46A8 2801            12      JR  Z,RN1
0006AA 46AA 23               6      INC HL
       46AB                     RN1:
0006AB 46AB 5D               4      LD  E,L
0006AC 46AC 54               4      LD  D,H
                                
0006AD 46AD CD834B          17      CALL    SEARCH_END
0006B0 46B0 B7               4      OR  A
0006B1 46B1 2821            12      JR  Z,REM
       46B3                     RN3:                    ;マルチステートメントの処理
0006B3 46B3 7E               7      LD  A,(HL)
                                
0006B4 46B4 FEB5             7      CP  0B5H            ;LOAD
0006B6 46B6 CA9F45          10      JP  Z,ROM_LOAD
0006B9 46B9 FE8A             7      CP  08AH            ;RUN
0006BB 46BB 281B            12      JR  Z,ROM_RUN
0006BD 46BD FEB7             7      CP  0B7H            ;FILES
0006BF 46BF 2824            12      JR  Z,ROM_FILES
0006C1 46C1 FED6             7      CP  0D6H            ;COPY
0006C3 46C3 CA7047          10      JP  Z,ROM_COPY
0006C6 46C6 FE20             7      CP  020H
0006C8 46C8 2807            12      JR  Z,RN_SP
                                
0006CA 46CA 3E28             7      LD  A,028H          ;JR Z,
0006CC 46CC 32A3F2          13      LD  (SWC_BLOAD_M),A
0006CF 46CF 7E               7      LD  A,(HL)
0006D0 46D0 C9              10      RET
       46D1                     RN_SP:
0006D1 46D1 23               6      INC HL
0006D2 46D2 18DF            12      JR  RN3
                                
       46D4                     REM:
0006D4 46D4 EB               4      EX  DE,HL
0006D5 46D5 3E8F             7      LD  A,08FH          ;REM
0006D7 46D7 C9              10      RET
                                
       46D8                     ROM_RUN:
0006D8 46D8 23               6      INC HL
0006D9 46D9 7E               7      LD  A,(HL)
0006DA 46DA 2B               6      DEC HL
0006DB 46DB B7               4      OR  A
0006DC 46DC 2803            12      JR  Z,ROM_RUN1
0006DE 46DE CD9F45          17      CALL    ROM_LOAD
       46E1                     ROM_RUN1:
0006E1 46E1 3E8A             7      LD  A,08AH          ;RUN
0006E3 46E3 77               7      LD  (HL),A
0006E4 46E4 C9              10      RET
                                
       46E5                     ROM_FILES:
0006E5 46E5 CD3E47          17      CALL    INIT_PARAM
0006E8 46E8 CD314A          17      CALL    FILE_B
0006EB 46EB CDCF51          17      CALL    GET_DISK_BANK_FDRV
0006EE 46EE 3ABCF2          13      LD  A,(SECSZ_H)
0006F1 46F1 CD8D50          17      CALL    IS_BPB1
0006F4 46F4 DAF445          10      JP  C,ERROR_DEVICE_IO_ERROR
0006F7 46F7 3AECF2          13      LD  A,(FNAME)
0006FA 46FA FE21             7      CP  021H
0006FC 46FC 3005            12      JR  NC,RFILES0
0006FE 46FE 060B             7      LD  B,11
000700 4700 CD174B          17      CALL    FILE10
       4703                     RFILES0:
000703 4703 CD1F4E          17      CALL    GET_DIR_DAT
       4706                     RFILES1:
000706 4706 CDDF4B          17      CALL    FILESE
000709 4709 302E            12      JR  NC,RFILES_NOT_MATCH
       470B                     RFILES_DISP:
00070B 470B E5              11      PUSH    HL
00070C 470C 0608             7      LD  B,8
00070E 470E CD7F43          17      CALL    MSN
000711 4711 3E2E             7      LD  A,'.'
000713 4713 CD4152          17      CALL    MSG_A
000716 4716 0603             7      LD  B,3
000718 4718 CD7F43          17      CALL    MSN
00071B 471B 3ADDF3          13      LD  A,(CSRX)
00071E 471E 47               4      LD  B,A
00071F 471F 3AB0F3          13      LD  A,(LINLEN)
000722 4722 90               4      SUB B
000723 4723 FE0C             7      CP  12
000725 4725 3009            12      JR  NC,RFILES2
000727 4727 3E0D             7      LD  A,00DH      ;改行
000729 4729 CD4152          17      CALL    MSG_A
00072C 472C 3E0A             7      LD  A,00AH
00072E 472E 1802            12      JR  RFILES3
       4730                     RFILES2:
000730 4730 3E20             7      LD  A,020H
       4732                     RFILES3:
000732 4732 CD4152          17      CALL    MSG_A
000735 4735 E1              10      POP HL
000736 4736 CDFD4B          17      CALL    FNEXT
       4739                     RFILES_NOT_MATCH:
000739 4739 20CB            12      JR  NZ,RFILES1
00073B 473B C39E46          10      JP  ROM_NEXT
                                
       473E                     INIT_PARAM:
00073E 473E 22E5F2          16      LD  (PARAM0),HL
000741 4741 22E7F2          16      LD  (PARAM1),HL
000744 4744 EB               4      EX  DE,HL
000745 4745 32BEFC          13      LD  (RUNBNF),A
000748 4748 3263F6          13      LD  (VALTYP),A
00074B 474B E5              11      PUSH    HL
00074C 474C 2ADEF2          16      LD  HL,(_CD)
00074F 474F 22E9F2          16      LD  (_CDX),HL
000752 4752 E1              10      POP HL
000753 4753 13               6      INC DE
000754 4754 CD534B          17      CALL    SPCUT
000757 4757 1A               7      LD  A,(DE)
000758 4758 B7               4      OR  A
000759 4759 C8              11      RET Z
00075A 475A FE3A             7      CP  ':'
00075C 475C C8              11      RET Z
00075D 475D FE28             7      CP  '('
00075F 475F C8              11      RET Z
000760 4760 EB               4      EX  DE,HL
000761 4761 DD21644C        14      LD  IX,FRMEVL
000765 4765 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000769 4769 CD1C00          17      CALL    _CALSLT
00076C 476C 22E7F2          16      LD  (PARAM1),HL
00076F 476F C9              10      RET
                                
       4770                     ROM_COPY:
000770 4770 CD3E47          17      CALL    INIT_PARAM
000773 4773 3A63F6          13      LD  A,(VALTYP)
000776 4776 FE03             7      CP  3       ;string
000778 4778 C22C4A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
00077B 477B CD314A          17      CALL    FILE_B
00077E 477E CDC34B          17      CALL    ROM_OPEN
000781 4781 DAFD45          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000784 4784 21D1F2          10      LD  HL,_BUF_W
000787 4787 22C7F2          16      LD  (_DTA),HL
00078A 478A 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
00078D 478D CD9049          17      CALL    ROM_READ
                                
000790 4790 AF               4      XOR A
000791 4791 32CCF2          13      LD  (_BUF_LO),A     ;PSET
000794 4794 32D9F2          13      LD  (_BUF_O),A      ;向き
                                
000797 4797 2AE7F2          16      LD  HL,(PARAM1)
       479A                     RCP_PARAM1:
00079A 479A 7E               7      LD  A,(HL)
00079B 479B 23               6      INC HL
00079C 479C B7               4      OR  A
00079D 479D CA2C4A          10      JP  Z,ROM_ORG
0007A0 47A0 FE3A             7      CP  ':'
0007A2 47A2 CA2C4A          10      JP  Z,ROM_ORG
0007A5 47A5 FE2C             7      CP  ','
0007A7 47A7 2012            12      JR  NZ,RCP_PARAM1_
                                
0007A9 47A9 DD212F54        14      LD  IX,FRMQNT
0007AD 47AD FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007B1 47B1 CD1C00          17      CALL    _CALSLT
0007B4 47B4 7B               4      LD  A,E
0007B5 47B5 87               4      ADD A,A
0007B6 47B6 87               4      ADD A,A
0007B7 47B7 32D9F2          13      LD  (_BUF_O),A
0007BA 47BA 7E               7      LD  A,(HL)
       47BB                     RCP_PARAM1_:
0007BB 47BB FE28             7      CP  '('
0007BD 47BD 20DB            12      JR  NZ,RCP_PARAM1
                                
0007BF 47BF DD212F54        14      LD  IX,FRMQNT
0007C3 47C3 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007C7 47C7 CD1C00          17      CALL    _CALSLT
                                
0007CA 47CA ED53D5F2        20      LD  (_BUF_X),DE
                                
       47CE                     RCP_PARAM2:
0007CE 47CE 23               6      INC HL
0007CF 47CF 7E               7      LD  A,(HL)
0007D0 47D0 FE20             7      CP  020H
0007D2 47D2 28FA            12      JR  Z,RCP_PARAM2
0007D4 47D4 FE2C             7      CP  ','
0007D6 47D6 28F6            12      JR  Z,RCP_PARAM2
                                
0007D8 47D8 DD212F54        14      LD  IX,FRMQNT
0007DC 47DC FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007E0 47E0 CD1C00          17      CALL    _CALSLT
                                
0007E3 47E3 3AF6FA          13      LD  A,(ACPAGE)
0007E6 47E6 57               4      LD  D,A
0007E7 47E7 ED53D7F2        20      LD  (_BUF_Y),DE
       47EB                     RCP_PARAM3:
0007EB 47EB 23               6      INC HL
0007EC 47EC 7E               7      LD  A,(HL)
0007ED 47ED FE20             7      CP  020H
0007EF 47EF 28FA            12      JR  Z,RCP_PARAM3
0007F1 47F1 FE29             7      CP  ')'
0007F3 47F3 28F6            12      JR  Z,RCP_PARAM3
0007F5 47F5 FE2C             7      CP  ','
0007F7 47F7 2033            12      JR  NZ,RCP_ST
                                
0007F9 47F9 23               6      INC HL
0007FA 47FA DD212F54        14      LD  IX,FRMQNT
0007FE 47FE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000802 4802 CD1C00          17      CALL    _CALSLT
                                
000805 4805 7B               4      LD  A,E
000806 4806 32D8F2          13      LD  (_BUF_P),A
                                
       4809                     RCP_PARAM4:
000809 4809 7E               7      LD  A,(HL)
00080A 480A 23               6      INC HL
00080B 480B FE20             7      CP  020H
00080D 480D 28FA            12      JR  Z,RCP_PARAM4
                                
00080F 480F FE2C             7      CP  ','
000811 4811 2019            12      JR  NZ,RCP_ST
                                
000813 4813 7E               7      LD  A,(HL)
000814 4814 0604             7      LD  B,4
000816 4816 FEC3             7      CP  0C3H        ;PRESET
000818 4818 280E            12      JR  Z,RCP_LO
00081A 481A 05               4      DEC B       ;3
00081B 481B D6F8             7      SUB 0F8H        ;XOR
00081D 481D 2809            12      JR  Z,RCP_LO
00081F 481F 05               4      DEC B       ;2
000820 4820 3C               4      INC A       ;OR
000821 4821 2805            12      JR  Z,RCP_LO
000823 4823 05               4      DEC B       ;1
000824 4824 3C               4      INC A       ;AND
000825 4825 2801            12      JR  Z,RCP_LO
000827 4827 05               4      DEC B       ;0
                                                ;PSET
       4828                     RCP_LO:
000828 4828 78               4      LD  A,B
000829 4829 32CCF2          13      LD  (_BUF_LO),A
       482C                     RCP_ST:
00082C 482C 2AC6F6          16      LD  HL,(STREND)
00082F 482F 22C7F2          16      LD  (_DTA),HL
000832 4832 EB               4      EX  DE,HL
000833 4833 2100FE          10      LD  HL,-512
000836 4836 39              11      ADD HL,SP
000837 4837 AF               4      XOR A
000838 4838 ED52            15      SBC HL,DE
00083A 483A 3008            12      JR  NC,RCP0
00083C 483C 215EF5          10      LD  HL,BUF
00083F 483F 22C7F2          16      LD  (_DTA),HL
000842 4842 6F               4      LD  L,A ;0
000843 4843 67               4      LD  H,A ;0
       4844                     RCP0:
000844 4844 24               4      INC H
000845 4845 22CFF2          16      LD  (_BUF_EN),HL
       4848                     RCP1:
000848 4848 F3               4      DI
000849 4849 CD1E49          17      CALL    WAIT_VDP
                                
00084C 484C 3A0700          13      LD  A,(WRVDP)
00084F 484F 4F               4      LD  C,A
000850 4850 0C               4      INC C       ;C := PORT#1's address(WR)
000851 4851 3E24             7      LD  A,36
000853 4853 ED79            12      OUT (C),A
000855 4855 3E91             7      LD  A,080H+17
000857 4857 ED79            12      OUT (C),A       ;R#17 := 36
                                
000859 4859 0C               4      INC C
00085A 485A 0C               4      INC C       ;C := PORT#3's address(WR)
00085B 485B 2AD5F2          16      LD  HL,(_BUF_X)
00085E 485E ED69            12      OUT (C),L       ;R#36 DX
000860 4860 ED61            12      OUT (C),H       ;R#37
000862 4862 2AD7F2          16      LD  HL,(_BUF_Y)
000865 4865 ED69            12      OUT (C),L       ;R#38 DY
000867 4867 ED61            12      OUT (C),H       ;R#39
000869 4869 2AD1F2          16      LD  HL,(_BUF_W)
00086C 486C ED69            12      OUT (C),L       ;R#40 NX
00086E 486E ED61            12      OUT (C),H       ;R#41
000870 4870 2AD3F2          16      LD  HL,(_BUF_H)
000873 4873 ED69            12      OUT (C),L       ;R#42 NY
000875 4875 ED61            12      OUT (C),H       ;R#43
                                
000877 4877 DD2AAFFC        20      LD  IX,(SCRMOD)
00087B 487B 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00087E 487E B7               4      OR  A
00087F 487F 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000881 4881 DD7D             9      LD  A,IXL
000883 4883 FE08             7      CP  8
000885 4885 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000887 4887 FE06             7      CP  6
000889 4889 2AD5F2          16      LD  HL,(_BUF_X)
00088C 488C 3AD1F2          13      LD  A,(_BUF_W)
00088F 488F 2005            12      JR  NZ,SCR57
000891 4891 B5               4      OR  L       ;スクリーン6
000892 4892 E603             7      AND 3
000894 4894 200D            12      JR  NZ,USE_LMMC
       4896                     SCR57:              ;スクリーン5,7
000896 4896 B5               4      OR  L
000897 4897 E601             7      AND 1
000899 4899 2008            12      JR  NZ,USE_LMMC
       489B                     USE_HMMC:
00089B 489B DD2E08          10      LD  IXL,8
       489E                     USE_HMMC8:
00089E 489E 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
0008A0 48A0 32CCF2          13      LD  (_BUF_LO),A
       48A3                     USE_LMMC:
0008A3 48A3 110000          10      LD  DE,0
0008A6 48A6 06FF             7      LD  B,-1
0008A8 48A8 CD4949          17      CALL    GET_PIXEL
0008AB 48AB ED79            12      OUT (C),A       ;R#44 first DATA
0008AD 48AD 3AD9F2          13      LD  A,(_BUF_O)
0008B0 48B0 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
0008B2 48B2 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008B5 48B5 F6B0             7      OR  0B0H        ;R#46 LMMC command
0008B7 48B7 ED79            12      OUT (C),A
                                
0008B9 48B9 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008BB 48BB 0D               4      DEC C
0008BC 48BC 0D               4      DEC C       ;C := PORT#1's address(WR)
0008BD 48BD 3EAC             7      LD  A,080H+44
0008BF 48BF ED79            12      OUT (C),A
0008C1 48C1 3E91             7      LD  A,080H+17
0008C3 48C3 ED79            12      OUT (C),A       ;R#17 := 44
                                
0008C5 48C5 3A0600          13      LD  A,(RDVDP)
0008C8 48C8 3C               4      INC A
0008C9 48C9 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
0008CB 48CB 3E02             7      LD  A,2
0008CD 48CD ED79            12      OUT (C),A
0008CF 48CF 3E8F             7      LD  A,08FH
0008D1 48D1 ED79            12      OUT (C),A
0008D3 48D3 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008D6 48D6 E640             7      AND 040H
0008D8 48D8 201C            12      JR  NZ,LOOP_HMMC
       48DA                     LOOP_COPY:
0008DA 48DA CD4949          17      CALL    GET_PIXEL
0008DD 48DD 08               4      EX  AF,AF'
0008DE 48DE FD4C             9      LD  C,IYH
       48E0                     LOOP_COPY1:
0008E0 48E0 ED78            12      IN  A,(C)
0008E2 48E2 0F               4      RRCA            ;RRCAではサインフラグは変化しない
0008E3 48E3 300A            12      JR  NC,EXIT_COPY    ;check CE bit
0008E5 48E5 F2E048          10      JP  P,LOOP_COPY1    ;check TR bit
0008E8 48E8 08               4      EX  AF,AF'
0008E9 48E9 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008EB 48EB ED79            12      OUT (C),A
0008ED 48ED 18EB            12      JR  LOOP_COPY
                                
       48EF                     EXIT_COPY:
0008EF 48EF CD2649          17      CALL    GET_STATUS_0
0008F2 48F2 FB               4      EI
0008F3 48F3 C39E46          10      JP  ROM_NEXT
                                
       48F6                     LOOP_HMMC:
0008F6 48F6 F3               4      DI          ;必要
0008F7 48F7 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008F9 48F9 43               4      LD  B,E
0008FA 48FA 7B               4      LD  A,E
0008FB 48FB B7               4      OR  A
0008FC 48FC 2802            12      JR  Z,LOOP_HMMC1
0008FE 48FE EDB3                    OTIR
       4900                     LOOP_HMMC1:
000900 4900 14               4      INC D
       4901                     LOOP_HMMC2:
000901 4901 15               4      DEC D
000902 4902 2805            12      JR  Z,LOOP_HMMC3
000904 4904 EDB3                    OTIR
000906 4906 C30149          10      JP  LOOP_HMMC2
       4909                     LOOP_HMMC3:
000909 4909 ED78            12      IN  A,(C)
00090B 490B 0F               4      RRCA
00090C 490C 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
00090E 490E 2ACFF2          16      LD  HL,(_BUF_EN)
000911 4911 CD9049          17      CALL    ROM_READ
000914 4914 EB               4      EX  DE,HL
000915 4915 2AC7F2          16      LD  HL,(_DTA)
000918 4918 7A               4      LD  A,D
000919 4919 B3               4      OR  E
00091A 491A 20DA            12      JR  NZ,LOOP_HMMC
00091C 491C 18C2            12      JR  LOOP_COPY1
                                    
       491E                     WAIT_VDP:
00091E 491E 3E02             7      LD  A,2
000920 4920 CD2749          17      CALL    GET_STATUS
000923 4923 0F               4      RRCA
000924 4924 38F8            12      JR  C,WAIT_VDP
       4926                     GET_STATUS_0:
000926 4926 AF               4      XOR A
       4927                     GET_STATUS:
000927 4927 C5              11      PUSH    BC
000928 4928 ED4B0600        20      LD  BC,(RDVDP)
00092C 492C 0C               4      INC C
00092D 492D ED79            12      OUT (C),A
00092F 492F 3E8F             7      LD  A,08FH
000931 4931 ED79            12      OUT (C),A
000933 4933 ED78            12      IN  A,(C)
000935 4935 C1              10      POP BC
000936 4936 C9              10      RET
                                
       4937                     GET_PIXEL256:
000937 4937 7A               4      LD  A,D
000938 4938 B3               4      OR  E
000939 4939 200A            12      JR  NZ,GET_PIXEL1
00093B 493B 2ACFF2          16      LD  HL,(_BUF_EN)
00093E 493E CD9049          17      CALL    ROM_READ
000941 4941 EB               4      EX  DE,HL
000942 4942 2AC7F2          16      LD  HL,(_DTA)
       4945                     GET_PIXEL1:
000945 4945 7E               7      LD  A,(HL)
000946 4946 23               6      INC HL
000947 4947 1B               6      DEC DE
000948 4948 C9              10      RET
                                
       4949                     GET_PIXEL:
000949 4949 DD7D             9      LD  A,IXL
00094B 494B FE08             7      CP  8
00094D 494D 28E8            12      JR  Z,GET_PIXEL256
00094F 494F 04               4      INC B
000950 4950 FE06             7      CP  6
000952 4952 282E            12      JR  Z,GET_PIXEL4
                                
000954 4954 CB40             8      BIT 0,B
000956 4956 20ED            12      JR  NZ,GET_PIXEL1
                                
000958 4958 7A               4      LD  A,D
000959 4959 B3               4      OR  E
00095A 495A 200A            12      JR  NZ,GET_PIXEL2
                                
00095C 495C 2ACFF2          16      LD  HL,(_BUF_EN)
00095F 495F CD9049          17      CALL    ROM_READ
000962 4962 EB               4      EX  DE,HL
000963 4963 2AC7F2          16      LD  HL,(_DTA)
                                
       4966                     GET_PIXEL2:
000966 4966 7E               7      LD  A,(HL)
000967 4967 0F               4      RRCA
000968 4968 0F               4      RRCA
000969 4969 0F               4      RRCA
00096A 496A 0F               4      RRCA
00096B 496B C9              10      RET
                                
       496C                     GET_PIXEL3:
00096C 496C 7A               4      LD  A,D
00096D 496D B3               4      OR  E
00096E 496E 200A            12      JR  NZ,GET_PIXEL5
                                
000970 4970 2ACFF2          16      LD  HL,(_BUF_EN)
000973 4973 CD9049          17      CALL    ROM_READ
000976 4976 EB               4      EX  DE,HL
000977 4977 2AC7F2          16      LD  HL,(_DTA)
       497A                     GET_PIXEL5:
00097A 497A 7E               7      LD  A,(HL)
00097B 497B 0F               4      RRCA
00097C 497C 0F               4      RRCA
00097D 497D 0F               4      RRCA
00097E 497E 0F               4      RRCA
00097F 497F 0F               4      RRCA
000980 4980 0F               4      RRCA
000981 4981 C9              10      RET
                                
       4982                     GET_PIXEL4:
000982 4982 78               4      LD  A,B
000983 4983 E603             7      AND 3   ;+0
000985 4985 28E5            12      JR  Z,GET_PIXEL3
000987 4987 3D               4      DEC A   ;+1
000988 4988 28DC            12      JR  Z,GET_PIXEL2
00098A 498A 3D               4      DEC A   ;+2
00098B 498B 7E               7      LD  A,(HL)
00098C 498C C0              11      RET NZ
00098D 498D 0F               4      RRCA        ;+3
00098E 498E 0F               4      RRCA
00098F 498F C9              10      RET
                                
       4990                     ROM_READ:
000990 4990 E5              11      PUSH    HL
000991 4991 D5              11      PUSH    DE
000992 4992 C5              11      PUSH    BC
000993 4993 FDE5            15      PUSH    IY
000995 4995 22E3F2          16      LD  (LEFTX),HL
000998 4998 2AC7F2          16      LD  HL,(_DTA)
00099B 499B 22DAF2          16      LD  (DTAX),HL
00099E 499E 2AE3F2          16      LD  HL,(LEFTX)
                                
0009A1 49A1 CD444C          17      CALL    RBX1
0009A4 49A4 3870            12      JR  C,RBRERR1
0009A6 49A6 79               4      LD  A,C
0009A7 49A7 EB               4      EX  DE,HL
0009A8 49A8 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0009AA 49AA 19              11      ADD HL,DE
0009AB 49AB DE00             7      SBC A,000H
0009AD 49AD 3801            12      JR  C,RBR1
0009AF 49AF EB               4      EX  DE,HL
       49B0                     RBR1:
0009B0 49B0 9F               4      SBC A,A
0009B1 49B1 E601             7      AND 1
0009B3 49B3 32B6F2          13      LD  (_RESULT),A
0009B6 49B6 7C               4      LD  A,H
0009B7 49B7 B5               4      OR  L
0009B8 49B8 CA0C4A          10      JP  Z,RBREND0
                                
0009BB 49BB 22C3F2          16      LD  (_LEFT),HL  ;Read record byte
0009BE 49BE 22E3F2          16      LD  (LEFTX),HL
                                
0009C1 49C1 CD774C          17      CALL    RBX2
0009C4 49C4 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009C6 49C6 CD8A4C          17      CALL    RBXA
0009C9 49C9 DA224A          10      JP  C,RBRERR
0009CC 49CC C5              11      PUSH    BC
0009CD 49CD CDF943          17      CALL    ROM_LDIR
0009D0 49D0 ED53DAF2        20      LD  (DTAX),DE
0009D4 49D4 2AE3F2          16      LD  HL,(LEFTX)
0009D7 49D7 D1              10      POP DE
0009D8 49D8 A7               4      AND A
0009D9 49D9 ED52            15      SBC HL,DE
0009DB 49DB 22E3F2          16      LD  (LEFTX),HL
0009DE 49DE 2829            12      JR  Z,RBREND
                                
       49E0                     RBRB:
0009E0 49E0 CDC34C          17      CALL    RBXB
0009E3 49E3 2818            12      JR  Z,RBRC
       49E5                     RBRB1:
0009E5 49E5 C5              11      PUSH    BC
0009E6 49E6 D5              11      PUSH    DE
0009E7 49E7 CD744D          17      CALL    CLUST
0009EA 49EA EB               4      EX  DE,HL
0009EB 49EB ED4BB9F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
0009EF 49EF CDF943          17      CALL    ROM_LDIR
0009F2 49F2 EB               4      EX  DE,HL
0009F3 49F3 D1              10      POP DE
0009F4 49F4 C1              10      POP BC
0009F5 49F5 CD514D          17      CALL    GNCL
0009F8 49F8 DA224A          10      JP  C,RBRERR
0009FB 49FB 10E8            13      DJNZ    RBRB1
       49FD                     RBRC:
0009FD 49FD CDDB4C          17      CALL    RBXC
000A00 4A00 2807            12      JR  Z,RBREND
                                
000A02 4A02 CD744D          17      CALL    CLUST
000A05 4A05 EB               4      EX  DE,HL
000A06 4A06 CDF943          17      CALL    ROM_LDIR
       4A09                     RBREND:
000A09 4A09 CDE74C          17      CALL    RBXEND
       4A0C                     RBREND0:
000A0C 4A0C FDE1            14      POP IY
000A0E 4A0E C1              10      POP BC
000A0F 4A0F D1              10      POP DE
000A10 4A10 F1              10      POP AF  ;(HL)
000A11 4A11 AF               4      XOR A
000A12 4A12 3AB6F2          13      LD  A,(_RESULT)
000A15 4A15 C9              10      RET
                                
       4A16                     RBRERR1:
000A16 4A16 3E01             7      LD  A,001H
       4A18                     RBRERR2:
000A18 4A18 FDE1            14      POP IY
000A1A 4A1A C1              10      POP BC
000A1B 4A1B D1              10      POP DE
000A1C 4A1C E1              10      POP HL
000A1D 4A1D 37               4      SCF
000A1E 4A1E 210000          10      LD  HL,0
000A21 4A21 C9              10      RET
       4A22                     RBRERR:
000A22 4A22 3EFF             7      LD  A,0FFH
000A24 4A24 18F2            12      JR  RBRERR2
                                
       4A26                     FILE_DD:
000A26 4A26 E1              10      POP HL
000A27 4A27 3E                      DB  03EH
000A28 4A28 C9              10      RET
000A29 4A29 32A3F2          13      LD  (SWC_BLOAD_M),A
       4A2C                     ROM_ORG:
000A2C 4A2C 2AE5F2          16      LD  HL,(PARAM0)
000A2F 4A2F 7E               7      LD  A,(HL)
000A30 4A30 C9              10      RET
       4A31                     FILE_B:
000A31 4A31 AF               4      XOR A
000A32 4A32 32EBF2          13      LD  (FDRV),A
000A35 4A35 1E00             7      LD  E,0
000A37 4A37 3A63F6          13      LD  A,(VALTYP)
000A3A 4A3A FE03             7      CP  3       ;string
000A3C 4A3C C2D44A          10      JP  NZ,FILED
                                
000A3F 4A3F DD21D067        14      LD  IX,FRESTR
000A43 4A43 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A47 4A47 CD1C00          17      CALL    _CALSLT
000A4A 4A4A E5              11      PUSH    HL
000A4B 4A4B DDE1            14      POP IX
                                
000A4D 4A4D DD5E00          19      LD  E,(IX+0)
000A50 4A50 DD7E01          19      LD  A,(IX+1)
000A53 4A53 DD5602          19      LD  D,(IX+2)
000A56 4A56 DD62             9      LD  IXH,D
000A58 4A58 DD6F             9      LD  IXL,A
000A5A 4A5A 7B               4      LD  A,E
       4A5B                     FILE_BDOS:
000A5B 4A5B FE04             7      CP  4
000A5D 4A5D 3808            12      JR  C,FILEB1
000A5F 4A5F DD7E03          19      LD  A,(IX+3)
000A62 4A62 FE3A             7      CP  ':'
000A64 4A64 28C0            12      JR  Z,FILE_DD
000A66 4A66 7B               4      LD  A,E
       4A67                     FILEB1:
000A67 4A67 FE02             7      CP  2
000A69 4A69 3818            12      JR  C,DEVI1
000A6B 4A6B DD7E01          19      LD  A,(IX+1)
000A6E 4A6E FE3A             7      CP  ':'
000A70 4A70 2011            12      JR  NZ,DEVI1
000A72 4A72 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A75 4A75 CDAD4B          17      CALL    CAP
000A78 4A78 D640             7      SUB '@'
000A7A 4A7A DD23            10      INC IX
000A7C 4A7C DD23            10      INC IX
000A7E 4A7E 1D               4      DEC E
000A7F 4A7F 1D               4      DEC E
000A80 4A80 32EBF2          13      LD  (FDRV),A
       4A83                     DEVI1:
000A83 4A83 DD7E00          19      LD  A,(IX+0)
000A86 4A86 D65C             7      SUB 05CH        ;\
000A88 4A88 2008            12      JR  NZ,NOROOT
000A8A 4A8A 6F               4      LD  L,A
000A8B 4A8B 67               4      LD  H,A
000A8C 4A8C 22E9F2          16      LD  (_CDX),HL
000A8F 4A8F DD23            10      INC IX
000A91 4A91 1D               4      DEC E
       4A92                     NOROOT:
                                
       4A92                     SETDIR:
000A92 4A92 CDD44A          17      CALL    FILED
000A95 4A95 DD7E00          19      LD  A,(IX+0)
000A98 4A98 FE5C             7      CP  05CH        ;\
000A9A 4A9A C0              11      RET NZ
000A9B 4A9B DD23            10      INC IX
000A9D 4A9D 1D               4      DEC E
000A9E 4A9E 3AECF2          13      LD  A,(FNAME)
000AA1 4AA1 FE20             7      CP  020H        ;. の処理
000AA3 4AA3 28ED            12      JR  Z,SETDIR
                                
000AA5 4AA5 CDC34B          17      CALL    ROM_OPEN
000AA8 4AA8 B7               4      OR  A
000AA9 4AA9 C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000AAA 4AAA D5              11      PUSH    DE
000AAB 4AAB 2AE0F2          16      LD  HL,(DIRENT1)
000AAE 4AAE 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000AB1 4AB1 19              11      ADD HL,DE
000AB2 4AB2 CD8B43          17      CALL    RDSLT_ROM
000AB5 4AB5 D1              10      POP DE
000AB6 4AB6 CB67             8      BIT 4,A     ;ディレクトリ
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000AB8 4AB8 C8              11      RET Z
000AB9 4AB9 CD1B4B          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
000ABC 4ABC D5              11      PUSH    DE
000ABD 4ABD 2AE0F2          16      LD  HL,(DIRENT1)
000AC0 4AC0 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000AC3 4AC3 19              11      ADD HL,DE
000AC4 4AC4 CD8B43          17      CALL    RDSLT_ROM
000AC7 4AC7 23               6      INC HL
000AC8 4AC8 5F               4      LD  E,A
000AC9 4AC9 CD8B43          17      CALL    RDSLT_ROM
000ACC 4ACC 57               4      LD  D,A
000ACD 4ACD EB               4      EX  DE,HL
000ACE 4ACE D1              10      POP DE
                                #else
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
000ACF 4ACF 22E9F2          16      LD  (_CDX),HL
000AD2 4AD2 18BE            12      JR  SETDIR
                                
       4AD4                     FILED:
000AD4 4AD4 CD1B4B          17      CALL    FILEI
000AD7 4AD7 21ECF2          10      LD  HL,FNAME
                                
000ADA 4ADA 0608             7      LD  B,8
       4ADC                     FILE2:
000ADC 4ADC CD284B          17      CALL    CCHKF
000ADF 4ADF C8              11      RET Z
000AE0 4AE0 FE2A             7      CP  '*'
000AE2 4AE2 282E            12      JR  Z,FILE9
000AE4 4AE4 FE2E             7      CP  '.'
000AE6 4AE6 280C            12      JR  Z,FILE4
000AE8 4AE8 77               7      LD  (HL),A
000AE9 4AE9 23               6      INC HL
000AEA 4AEA 10F0            13      DJNZ    FILE2
                                
       4AEC                     FILE3:
000AEC 4AEC CD284B          17      CALL    CCHKF
000AEF 4AEF C8              11      RET Z
000AF0 4AF0 FE2E             7      CP  '.'
000AF2 4AF2 20F8            12      JR  NZ,FILE3
                                
       4AF4                     FILE4:
000AF4 4AF4 21F4F2          10      LD  HL,FNAME+8
000AF7 4AF7 0603             7      LD  B,3
                                
       4AF9                     FILE4L:
000AF9 4AF9 CD284B          17      CALL    CCHKF
000AFC 4AFC C8              11      RET Z
000AFD 4AFD FE2E             7      CP  '.'
000AFF 4AFF 2008            12      JR  NZ,FILE12
000B01 4B01 32ECF2          13      LD  (FNAME),A   ;Parent directory(..)
000B04 4B04 32EDF2          13      LD  (FNAME+1),A
000B07 4B07 3E20             7      LD  A,020H
       4B09                     FILE12:
000B09 4B09 FE2A             7      CP  '*'
000B0B 4B0B 280A            12      JR  Z,FILE10
000B0D 4B0D 77               7      LD  (HL),A
000B0E 4B0E 23               6      INC HL
000B0F 4B0F 10E8            13      DJNZ    FILE4L
000B11 4B11 C9              10      RET
                                
       4B12                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000B12 4B12 CD174B          17      CALL    FILE10
000B15 4B15 18D5            12      JR  FILE3
                                
       4B17                     FILE10:
000B17 4B17 3E3F             7      LD  A,'?'
000B19 4B19 1808            12      JR  FILL_MEMORY
       4B1B                     FILEI:              ;名前＋拡張子をスペースで初期化
000B1B 4B1B 3E20             7      LD  A,020H
000B1D 4B1D 01000B          10      LD  BC,11*256   ;C=0にしておく
000B20 4B20 21ECF2          10      LD  HL,FNAME
       4B23                     FILL_MEMORY:            ;HLからBバイトAで埋める
000B23 4B23 77               7      LD  (HL),A
000B24 4B24 23               6      INC HL
000B25 4B25 10FC            13      DJNZ    FILL_MEMORY
000B27 4B27 C9              10      RET
                                
       4B28                     CCHKF:
000B28 4B28 7B               4      LD  A,E
000B29 4B29 B7               4      OR  A
000B2A 4B2A C8              11      RET Z
000B2B 4B2B DD7E00          19      LD  A,(IX+0)
000B2E 4B2E CD354B          17      CALL    CCHK2
000B31 4B31 C8              11      RET Z
000B32 4B32 C3984B          10      JP  FKAN
                                
       4B35                     CCHK2:
000B35 4B35 0C               4      INC C
000B36 4B36 0D               4      DEC C
000B37 4B37 C0              11      RET NZ
       4B38                     CCHK3:              ;ZF=1 で使えない文字
000B38 4B38 FE2B             7      CP  '+'
000B3A 4B3A C8              11      RET Z
000B3B 4B3B FE2C             7      CP  ','
000B3D 4B3D C8              11      RET Z
000B3E 4B3E FE2F             7      CP  '/'
000B40 4B40 C8              11      RET Z
000B41 4B41 FE3A             7      CP  ':'
000B43 4B43 C8              11      RET Z
000B44 4B44 FE3B             7      CP  ';'
000B46 4B46 C8              11      RET Z
000B47 4B47 FE3D             7      CP  '='
000B49 4B49 C8              11      RET Z
000B4A 4B4A FE5C             7      CP  05CH    ;\
000B4C 4B4C C8              11      RET Z
000B4D 4B4D FE1F             7      CP  01FH
000B4F 4B4F D0              11      RET NC
000B50 4B50 BF               4      CP  A       ;Z=1
000B51 4B51 C9              10      RET
                                
       4B52                     SS1:
000B52 4B52 13               6      INC DE
       4B53                     SPCUT:              ;スペースをカット
000B53 4B53 1A               7      LD  A,(DE)
000B54 4B54 FE20             7      CP  020H
000B56 4B56 28FA            12      JR  Z,SS1
000B58 4B58 C9              10      RET
                                
       4B59                     SCREOF1:
000B59 4B59 13               6      INC DE
       4B5A                     SPCUTEX:            ;スペース改行などをカット
000B5A 4B5A 1A               7      LD  A,(DE)
000B5B 4B5B FE20             7      CP  020H
000B5D 4B5D 28FA            12      JR  Z,SCREOF1
000B5F 4B5F FE0D             7      CP  00DH
000B61 4B61 28F6            12      JR  Z,SCREOF1
000B63 4B63 FE0A             7      CP  00AH
000B65 4B65 28F2            12      JR  Z,SCREOF1
000B67 4B67 FE1A             7      CP  01AH
000B69 4B69 28EE            12      JR  Z,SCREOF1
000B6B 4B6B C9              10      RET
                                
       4B6C                     GETNUM:
000B6C 4B6C 210000          10      LD  HL,0
       4B6F                     GETNUM1:
000B6F 4B6F 1A               7      LD  A,(DE)
000B70 4B70 13               6      INC DE
000B71 4B71 D630             7      SUB '0'
000B73 4B73 D8              11      RET C
000B74 4B74 FE0A             7      CP  10
000B76 4B76 D0              11      RET NC
000B77 4B77 4D               4      LD  C,L
000B78 4B78 44               4      LD  B,H
000B79 4B79 29              11      ADD HL,HL   ;*2
000B7A 4B7A 29              11      ADD HL,HL   ;*4
000B7B 4B7B 09              11      ADD HL,BC   ;*5
000B7C 4B7C 29              11      ADD HL,HL   ;*10
000B7D 4B7D 4F               4      LD  C,A
000B7E 4B7E 0600             7      LD  B,0
000B80 4B80 09              11      ADD HL,BC
000B81 4B81 18EC            12      JR  GETNUM1
                                
       4B83                     SEARCH_END:
000B83 4B83 7E               7      LD  A,(HL)
       4B84                     SEARCH_END1:
000B84 4B84 23               6      INC HL
000B85 4B85 B7               4      OR  A
000B86 4B86 C8              11      RET Z
000B87 4B87 FE3A             7      CP  ':'
000B89 4B89 20F8            12      JR  NZ,SEARCH_END
000B8B 4B8B 7E               7      LD  A,(HL)
000B8C 4B8C FE3A             7      CP  ':'
000B8E 4B8E 28F4            12      JR  Z,SEARCH_END1
000B90 4B90 C9              10      RET
                                
       4B91                     FKANC:
000B91 4B91 CB41             8      BIT 0,C
000B93 4B93 CCB64B          17      CALL    Z,CAP2
000B96 4B96 1803            12      JR  FKANX
       4B98                     FKAN:           ;漢字チェック
000B98 4B98 DD23            10      INC IX
000B9A 4B9A 1D               4      DEC E
       4B9B                     FKANX:
000B9B 4B9B CB41             8      BIT 0,C
000B9D 4B9D CB81             8      RES 0,C
000B9F 4B9F C0              11      RET NZ
000BA0 4BA0 FE80             7      CP  080H
000BA2 4BA2 D8              11      RET C
000BA3 4BA3 FEA0             7      CP  0A0H
000BA5 4BA5 3803            12      JR  C,FKAN1
000BA7 4BA7 FEE0             7      CP  0E0H
000BA9 4BA9 D8              11      RET C
       4BAA                     FKAN1:
000BAA 4BAA 0C               4      INC C
000BAB 4BAB A7               4      AND A
000BAC 4BAC C9              10      RET
                                
       4BAD                     CAP:
000BAD 4BAD FE61             7      CP  'a'
000BAF 4BAF D8              11      RET C
000BB0 4BB0 FE7B             7      CP  'z'+1
000BB2 4BB2 D0              11      RET NC
000BB3 4BB3 D620             7      SUB 020H
000BB5 4BB5 C9              10      RET
       4BB6                     CAP2:
000BB6 4BB6 CDAD4B          17      CALL    CAP
       4BB9                     CAP3:               ;
000BB9 4BB9 FE05             7      CP  5
000BBB 4BBB 2803            12      JR  Z,CAP4
000BBD 4BBD FE21             7      CP  021H
000BBF 4BBF C9              10      RET
       4BC0                     CAP4:
000BC0 4BC0 3EE5             7      LD  A,0E5H
000BC2 4BC2 C9              10      RET
                                
       4BC3                     ROM_OPEN:
000BC3 4BC3 CDCF51          17      CALL    GET_DISK_BANK_FDRV
                                
000BC6 4BC6 CD1F4E          17      CALL    GET_DIR_DAT
000BC9 4BC9 D5              11      PUSH    DE
000BCA 4BCA CDDF4B          17      CALL    FILESE
000BCD 4BCD D1              10      POP DE
000BCE 4BCE 3F               4      CCF
000BCF 4BCF D8              11      RET C
000BD0 4BD0 22E0F2          16      LD  (DIRENT1),HL
000BD3 4BD3 E5              11      PUSH    HL
000BD4 4BD4 210000          10      LD  HL,0
000BD7 4BD7 22BDF2          16      LD  (RR_LOW),HL
000BDA 4BDA 22BFF2          16      LD  (RR_HIGH),HL
000BDD 4BDD E1              10      POP HL
000BDE 4BDE C9              10      RET
                                
       4BDF                     FILESE:
       4BDF                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
000BDF 4BDF CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000BE2 4BE2 B7               4      OR  A
000BE3 4BE3 C8              11      RET Z       ;END:ZF=1 CF=0
000BE4 4BE4 FEE5             7      CP  0E5H
000BE6 4BE6 280D            12      JR  Z,FILESE1
000BE8 4BE8 11ECF2          10      LD  DE,FNAME
000BEB 4BEB E5              11      PUSH    HL
000BEC 4BEC CD1B4C          17      CALL    CPFILE
000BEF 4BEF CC3E4C          17      CALL    Z,CPFILE2
000BF2 4BF2 E1              10      POP HL
000BF3 4BF3 37               4      SCF
000BF4 4BF4 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4BF5                     FILESE1:
000BF5 4BF5 CDFD4B          17      CALL    FNEXT
000BF8 4BF8 20E5            12      JR  NZ,FILESE0
000BFA 4BFA F6FF             7      OR  0FFH        ;ZF=0 CF=0
000BFC 4BFC C9              10      RET
                                
       4BFD                     FNEXT:
000BFD 4BFD 112000          10      LD  DE,020H
000C00 4C00 19              11      ADD HL,DE
000C01 4C01 ED5BE9F2        20      LD  DE,(_CDX)
000C05 4C05 7A               4      LD  A,D
000C06 4C06 B3               4      OR  E
000C07 4C07 2002            12      JR  NZ,FNEXT_SUBDIR
000C09 4C09 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000C0A 4C0A C9              10      RET
                                
       4C0B                     FNEXT_SUBDIR:           ;サブディレクトリ
000C0B 4C0B 0D               4      DEC C
000C0C 4C0C C0              11      RET NZ
                                
000C0D 4C0D ED5BE9F2        20      LD  DE,(_CDX)
000C11 4C11 CD514D          17      CALL    GNCL
000C14 4C14 EB               4      EX  DE,HL
000C15 4C15 22E9F2          16      LD  (_CDX),HL
000C18 4C18 C3584E          10      JP  GET_SUBDIR
                                
       4C1B                     CPFILE:
000C1B 4C1B C5              11      PUSH    BC
000C1C 4C1C 01000B          10      LD  BC,00B00H
       4C1F                     CPSTR1:
000C1F 4C1F 1A               7      LD  A,(DE)
000C20 4C20 FE3F             7      CP  '?'     ;Wild card
000C22 4C22 2814            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
000C24 4C24 CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000C27 4C27 CD914B          17      CALL    FKANC
000C2A 4C2A E5              11      PUSH    HL
000C2B 4C2B 67               4      LD  H,A
000C2C 4C2C 1A               7      LD  A,(DE)
000C2D 4C2D CB01             4      RLC C
000C2F 4C2F CD914B          17      CALL    FKANC
000C32 4C32 CB09             4      RRC C
000C34 4C34 BC               4      CP  H       ;CP (HL),(DE)
000C35 4C35 E1              10      POP HL
000C36 4C36 2004            12      JR  NZ,CPSTR3
       4C38                     CPSTR2:
000C38 4C38 13               6      INC DE
000C39 4C39 23               6      INC HL
000C3A 4C3A 10E3            13      DJNZ    CPSTR1
       4C3C                     CPSTR3:
000C3C 4C3C C1              10      POP BC
000C3D 4C3D C9              10      RET
                                
       4C3E                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
000C3E 4C3E CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000C41 4C41 E60E             7      AND 00EH    ;~0F1H
000C43 4C43 C9              10      RET
                                
       4C44                     RBX1:
000C44 4C44 E5              11      PUSH    HL      ;Record byte
                                
000C45 4C45 ED5BBDF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000C49 4C49 3AC0F2          13      LD  A,(RR_HIGH+1)
000C4C 4C4C 4F               4      LD  C,A
                                
000C4D 4C4D 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000C50 4C50 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
000C53 4C53 D5              11      PUSH    DE
000C54 4C54 2AE0F2          16      LD  HL,(DIRENT1)
000C57 4C57 111C00          10      LD  DE,0001CH
000C5A 4C5A 19              11      ADD HL,DE
000C5B 4C5B CD8B43          17      CALL    RDSLT_ROM
000C5E 4C5E 23               6      INC HL
000C5F 4C5F 5F               4      LD  E,A
000C60 4C60 CD8B43          17      CALL    RDSLT_ROM
000C63 4C63 23               6      INC HL
000C64 4C64 57               4      LD  D,A
000C65 4C65 CD8B43          17      CALL    RDSLT_ROM
000C68 4C68 EB               4      EX  DE,HL       ;AHL=File size
000C69 4C69 D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
                                
000C6A 4C6A A7               4      AND A
000C6B 4C6B ED52            15      SBC HL,DE
000C6D 4C6D 99               4      SBC A,C
000C6E 4C6E D1              10      POP DE
                                
000C6F 4C6F D8              11      RET C
000C70 4C70 4F               4      LD  C,A
000C71 4C71 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000C72 4C72 B2               4      OR  D
000C73 4C73 B3               4      OR  E
000C74 4C74 C0              11      RET NZ
000C75 4C75 37               4      SCF
000C76 4C76 C9              10      RET
                                
       4C77                     RBX2:
000C77 4C77 ED4BBEF2        20      LD  BC,(RR_LOW+1)
000C7B 4C7B CDFC4C          17      CALL    RWXR
000C7E 4C7E 3ABAF2          13      LD  A,(CLSZ_H)
000C81 4C81 3D               4      DEC A
000C82 4C82 E5              11      PUSH    HL
000C83 4C83 2ABDF2          16      LD  HL,(RR_LOW)
000C86 4C86 A4               4      AND H
000C87 4C87 B5               4      OR  L
000C88 4C88 E1              10      POP HL
000C89 4C89 C9              10      RET
                                
       4C8A                     RBXA:
000C8A 4C8A D5              11      PUSH    DE
000C8B 4C8B CD744D          17      CALL    CLUST
000C8E 4C8E ED53C5F2        20      LD  (_DTPS),DE
000C92 4C92 D1              10      POP DE
000C93 4C93 CD514D          17      CALL    GNCL
000C96 4C96 D8              11      RET C
000C97 4C97 ED53C1F2        20      LD  (_CLPS),DE
                                
000C9B 4C9B ED4BBDF2        20      LD  BC,(RR_LOW)
000C9F 4C9F 2AB9F2          16      LD  HL,(CLSZ)
000CA2 4CA2 7C               4      LD  A,H
000CA3 4CA3 3D               4      DEC A
000CA4 4CA4 A0               4      AND B
000CA5 4CA5 47               4      LD  B,A
000CA6 4CA6 ED42            15      SBC HL,BC       ;remaining cluster
                                
000CA8 4CA8 ED5BE3F2        20      LD  DE,(LEFTX)
000CAC 4CAC ED52            15      SBC HL,DE       ;CP HL,DE
000CAE 4CAE 19              11      ADD HL,DE
000CAF 4CAF 3801            12      JR  C,RBXA1
000CB1 4CB1 EB               4      EX  DE,HL
       4CB2                     RBXA1:
000CB2 4CB2 3AB7F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
000CB5 4CB5 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000CB8 4CB8 E5              11      PUSH    HL
000CB9 4CB9 2AC5F2          16      LD  HL,(_DTPS)
000CBC 4CBC 09              11      ADD HL,BC
000CBD 4CBD ED5BDAF2        20      LD  DE,(DTAX)
000CC1 4CC1 C1              10      POP BC
000CC2 4CC2 C9              10      RET
                                
       4CC3                     RBXB:
000CC3 4CC3 2ADAF2          16      LD  HL,(DTAX)
000CC6 4CC6 ED5BC1F2        20      LD  DE,(_CLPS)
000CCA 4CCA 3AE4F2          13      LD  A,(LEFTX+1)
000CCD 4CCD 47               4      LD  B,A
000CCE 4CCE 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CD1                     RBXB1:
000CD1 4CD1 1F               4      RRA     ;->CF
000CD2 4CD2 3804            12      JR  C,RBXB2
000CD4 4CD4 CB38             8      SRL B   ;B=B/2
000CD6 4CD6 18F9            12      JR  RBXB1
       4CD8                     RBXB2:
000CD8 4CD8 78               4      LD  A,B
000CD9 4CD9 B7               4      OR  A
000CDA 4CDA C9              10      RET
                                
       4CDB                     RBXC:
000CDB 4CDB ED4BE3F2        20      LD  BC,(LEFTX)
000CDF 4CDF 3ABAF2          13      LD  A,(CLSZ_H)
000CE2 4CE2 3D               4      DEC A
000CE3 4CE3 A0               4      AND B
000CE4 4CE4 47               4      LD  B,A
000CE5 4CE5 B1               4      OR  C
000CE6 4CE6 C9              10      RET
                                
       4CE7                     RBXEND:
000CE7 4CE7 ED5BC3F2        20      LD  DE,(_LEFT)
000CEB 4CEB 2ABDF2          16      LD  HL,(RR_LOW)
000CEE 4CEE 3AC0F2          13      LD  A,(RR_HIGH+1)
000CF1 4CF1 19              11      ADD HL,DE
000CF2 4CF2 CE00             7      ADC A,0
000CF4 4CF4 22BDF2          16      LD  (RR_LOW),HL
000CF7 4CF7 32C0F2          13      LD  (RR_HIGH+1),A
000CFA 4CFA EB               4      EX  DE,HL       ;HL=Read byte
000CFB 4CFB C9              10      RET 
                                
       4CFC                     RWXR:
000CFC 4CFC 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CFF                     L_RWX:
000CFF 4CFF 1F               4      RRA     ;->CF
000D00 4D00 3806            12      JR  C,E_RWX
000D02 4D02 CB38             8      SRL B   ;BC=BC/2
000D04 4D04 CB19             8      RR  C   ;
000D06 4D06 18F7            12      JR  L_RWX
       4D08                     E_RWX:
000D08 4D08 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000D0B 4D0B 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
000D0E 4D0E E5              11      PUSH    HL
000D0F 4D0F 2AE0F2          16      LD  HL,(DIRENT1)
000D12 4D12 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000D15 4D15 19              11      ADD HL,DE
000D16 4D16 CD8B43          17      CALL    RDSLT_ROM
000D19 4D19 23               6      INC HL
000D1A 4D1A 5F               4      LD  E,A
000D1B 4D1B CD8B43          17      CALL    RDSLT_ROM
000D1E 4D1E 23               6      INC HL
000D1F 4D1F 57               4      LD  D,A
000D20 4D20 E1              10      POP HL
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  E,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  D,(IY+01BH)
                                #endif
000D21 4D21 CDCF51          17      CALL    GET_DISK_BANK_FDRV
       4D24                     RWX1:
000D24 4D24 ED53C1F2        20      LD  (_CLPS),DE
000D28 4D28 7A               4      LD  A,D
000D29 4D29 B3               4      OR  E
000D2A 4D2A 37               4      SCF
000D2B 4D2B C8              11      RET Z
                                
000D2C 4D2C 78               4      LD  A,B
000D2D 4D2D B1               4      OR  C
000D2E 4D2E C8              11      RET Z
                                
000D2F 4D2F CD514D          17      CALL    GNCL
000D32 4D32 D8              11      RET C
000D33 4D33 0B               6      DEC BC
000D34 4D34 CDB84D          17      CALL    ENDCL
000D37 4D37 38EB            12      JR  C,RWX1
000D39 4D39 37               4      SCF
000D3A 4D3A C9              10      RET
                                
       4D3B                     NCL3:
000D3B 4D3B CDCF51          17      CALL    GET_DISK_BANK_FDRV
000D3E 4D3E 6B               4      LD  L,E
000D3F 4D3F 62               4      LD  H,D
000D40 4D40 CB3C             8      SRL H
000D42 4D42 CB1D             8      RR  L
000D44 4D44 1F               4      RRA
000D45 4D45 19              11      ADD HL,DE
000D46 4D46 010060          10      LD  BC,BANK1_ADR
000D49 4D49 09              11      ADD HL,BC
000D4A 4D4A ED4BBBF2        20      LD  BC,(SECSZ)
000D4E 4D4E 09              11      ADD HL,BC
000D4F 4D4F 17               4      RLA
000D50 4D50 C9              10      RET
                                
       4D51                     GNCL:
000D51 4D51 7A               4      LD  A,D
000D52 4D52 B3               4      OR  E
000D53 4D53 37               4      SCF
000D54 4D54 C8              11      RET Z
000D55 4D55 C5              11      PUSH    BC
000D56 4D56 E5              11      PUSH    HL
000D57 4D57 CD3B4D          17      CALL    NCL3
000D5A 4D5A 3809            12      JR  C,GNC1
000D5C 4D5C 5E               7      LD  E,(HL)
000D5D 4D5D 23               6      INC HL
000D5E 4D5E 7E               7      LD  A,(HL)
000D5F 4D5F E60F             7      AND 00FH
000D61 4D61 57               4      LD  D,A
000D62 4D62 E1              10      POP HL
000D63 4D63 C1              10      POP BC
000D64 4D64 C9              10      RET
       4D65                     GNC1:
000D65 4D65 7E               7      LD  A,(HL)
000D66 4D66 23               6      INC HL
000D67 4D67 56               7      LD  D,(HL)
000D68 4D68 0604             7      LD  B,4
       4D6A                     GNC1L:
000D6A 4D6A CB3A             8      SRL D
000D6C 4D6C 1F               4      RRA
000D6D 4D6D 10FB            13      DJNZ    GNC1L
                                
000D6F 4D6F 5F               4      LD  E,A
000D70 4D70 E1              10      POP HL
000D71 4D71 C1              10      POP BC
000D72 4D72 A7               4      AND A
000D73 4D73 C9              10      RET
                                
       4D74                     CLUST:
000D74 4D74 EB               4      EX  DE,HL
       4D75                     CLUST_HL:
000D75 4D75 2B               6      DEC HL
000D76 4D76 2B               6      DEC HL
000D77 4D77 C5              11      PUSH    BC
000D78 4D78 3ABAF2          13      LD  A,(CLSZ_H)
000D7B 4D7B CDF851          17      CALL    MUL_AHL
                                
000D7E 4D7E CD394E          17      CALL    GET_DIR_POS
000D81 4D81 4F               4      LD  C,A
000D82 4D82 0600             7      LD  B,0
000D84 4D84 09              11      ADD HL,BC
                                
000D85 4D85 ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000D89 4D89 CB38             8      SRL B
000D8B 4D8B CB19             8      RR  C           ;/2
000D8D 4D8D CB38             8      SRL B
000D8F 4D8F CB19             8      RR  C           ;/4
000D91 4D91 CB38             8      SRL B
000D93 4D93 CB19             8      RR  C           ;/8
000D95 4D95 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
000D96 4D96 7D               4      LD  A,L
000D97 4D97 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000D9A 4D9A 09              11      ADD HL,BC
000D9B 4D9B 3013            12      JR  NC,CLUST2
000D9D 4D9D 4D               4      LD  C,L     ;C=読み出し元
000D9E 4D9E 29              11      ADD HL,HL   ;64KB→32KB
000D9F 4D9F 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000DA0 4DA0 CDCF51          17      CALL    GET_DISK_BANK_FDRV
000DA3 4DA3 84               4      ADD A,H
000DA4 4DA4 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000DA7 4DA7 32B7F2          13      LD  (_BANK),A
000DAA 4DAA 69               4      LD  L,C     ;C=読み出し元
000DAB 4DAB 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000DAD 4DAD A5               4      AND L
000DAE 4DAE C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4DB0                     CLUST2:
000DB0 4DB0 C660             7      ADD A,high BANK1_ADR
000DB2 4DB2 67               4      LD  H,A
000DB3 4DB3 2E00             7      LD  L,0
000DB5 4DB5 EB               4      EX  DE,HL
000DB6 4DB6 C1              10      POP BC
000DB7 4DB7 C9              10      RET
                                
       4DB8                     ENDCL:
000DB8 4DB8 7A               4      LD  A,D ;END CLUSTER
000DB9 4DB9 FE0F             7      CP  00FH    ;FAT12の最大値
000DBB 4DBB C0              11      RET NZ
000DBC 4DBC 7B               4      LD  A,E
000DBD 4DBD FEF7             7      CP  0F7H
000DBF 4DBF C9              10      RET
                                
       4DC0                     RB_READ:
000DC0 4DC0 AF               4      XOR A   ;HLA = HL*128
000DC1 4DC1 CB3C             8      SRL H
000DC3 4DC3 CB1D             8      RR  L
000DC5 4DC5 1F               4      RRA
000DC6 4DC6 32BDF2          13      LD  (RR_LOW),A
000DC9 4DC9 22BEF2          16      LD  (RR_MID),HL
000DCC 4DCC 218000          10      LD  HL,128
                                
000DCF 4DCF CD9049          17      CALL    ROM_READ
000DD2 4DD2 C9              10      RET
                                
       4DD3                     GETSEQ:
000DD3 4DD3 FD6E20          19      LD  L,(IY+32)
000DD6 4DD6 FD660C          19      LD  H,(IY+12)
                                
000DD9 4DD9 CB25             8      SLA L
                                
000DDB 4DDB CB3C             8      SRL H
000DDD 4DDD CB1D             8      RR  L
000DDF 4DDF C9              10      RET
                                
       4DE0                     SETSEQ:
000DE0 4DE0 F5              11      PUSH    AF
000DE1 4DE1 3ABDF2          13      LD  A,(RR_LOW)
000DE4 4DE4 2ABEF2          16      LD  HL,(RR_MID)
                                
000DE7 4DE7 CDFE4D          17      CALL    SSQ1
                                
000DEA 4DEA 29              11      ADD HL,HL
000DEB 4DEB CB3D             8      SRL L
000DED 4DED FD7520          19      LD  (IY+32),L
000DF0 4DF0 FD740C          19      LD  (IY+12),H
000DF3 4DF3 F1              10      POP AF
000DF4 4DF4 C9              10      RET
                                
       4DF5                     GETSIZE:
000DF5 4DF5 FD7E10          19      LD  A,(IY+16)
000DF8 4DF8 FD6E11          19      LD  L,(IY+17)
000DFB 4DFB FD6612          19      LD  H,(IY+18)
       4DFE                     SSQ1:
000DFE 4DFE 87               4      ADD A,A
000DFF 4DFF ED6A            15      ADC HL,HL
000E01 4E01 B7               4      OR  A
000E02 4E02 C8              11      RET Z
000E03 4E03 23               6      INC HL
000E04 4E04 C9              10      RET
                                
       4E05                     SET_FCB:
000E05 4E05 D5              11      PUSH    DE
000E06 4E06 FDE1            14      POP IY
000E08 4E08 FD7E1C          19      LD  A,(IY+28)
000E0B 4E0B FEFF             7      CP  0FFH
000E0D 4E0D 200C            12      JR  NZ,POPAF_SCF_FF_RET
000E0F 4E0F E5              11      PUSH    HL
000E10 4E10 FD6E1A          19      LD  L,(IY+26)
000E13 4E13 FD661B          19      LD  H,(IY+27)
000E16 4E16 22C1F2          16      LD  (_CLPS),HL
000E19 4E19 E1              10      POP HL
000E1A 4E1A C9              10      RET
                                
       4E1B                     POPAF_SCF_FF_RET:
000E1B 4E1B F1              10      POP AF
000E1C 4E1C 37               4      SCF
000E1D 4E1D 9F               4      SBC A,A
000E1E 4E1E C9              10      RET
                                
       4E1F                     GET_DIR_DAT:
000E1F 4E1F 2AE9F2          16      LD  HL,(_CDX)
000E22 4E22 7C               4      LD  A,H
000E23 4E23 B5               4      OR  L
000E24 4E24 2032            12      JR  NZ,GET_SUBDIR
000E26 4E26 CD394E          17      CALL    GET_DIR_POS
000E29 4E29 C660             7      ADD A,high BANK1_ADR
000E2B 4E2B 2E00             7      LD  L,0
000E2D 4E2D 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000E2E 4E2E 3AB8F2          13      LD  A,(_BANK1)
000E31 4E31 32E2F2          13      LD  (_DIR_BANK),A
                                
000E34 4E34 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000E37 4E37 4F               4      LD  C,A
000E38 4E38 C9              10      RET
                                
       4E39                     GET_DIR_POS:                ;ルートディレクトリ
000E39 4E39 CDCF51          17      CALL    GET_DISK_BANK_FDRV
000E3C 4E3C 32B8F2          13      LD  (_BANK1),A
000E3F 4E3F 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000E42 4E42 47               4      LD  B,A
000E43 4E43 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000E46 4E46 4F               4      LD  C,A
000E47 4E47 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4E4A                     GET_DIR_POS1:
000E4A 4E4A 81               4      ADD A,C
000E4B 4E4B 10FD            13      DJNZ    GET_DIR_POS1
                                
000E4D 4E4D ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
000E51 4E51 37               4      SCF     ;無限ループ回避
       4E52                     L_MDP:
000E52 4E52 CB18             8      RR  B   ;->CF
000E54 4E54 D8              11      RET C
000E55 4E55 87               4      ADD A,A
000E56 4E56 18FA            12      JR  L_MDP
                                
       4E58                     GET_SUBDIR:             ;サブディレクトリ
000E58 4E58 CD754D          17      CALL    CLUST_HL
000E5B 4E5B EB               4      EX  DE,HL
000E5C 4E5C 3AB7F2          13      LD  A,(_BANK)
000E5F 4E5F 32E2F2          13      LD  (_DIR_BANK),A
000E62 4E62 3ABAF2          13      LD  A,(CLSZ_H)
000E65 4E65 87               4      ADD A,A     ;*2
000E66 4E66 87               4      ADD A,A     ;*4
000E67 4E67 87               4      ADD A,A     ;*8
000E68 4E68 4F               4      LD  C,A
000E69 4E69 C9              10      RET
                                
       4E6A                     STATEMENT:
000E6A 4E6A 11E54F          10      LD  DE,STR_CHDIR
000E6D 4E6D CDCB4F          17      CALL    CPPROCNM
000E70 4E70 280A            12      JR  Z,_CHDIR
000E72 4E72 11EB4F          10      LD  DE,STR_RAMDISK
000E75 4E75 CDCB4F          17      CALL    CPPROCNM
000E78 4E78 2814            12      JR  Z,_RAMDISK
000E7A 4E7A 37               4      SCF
000E7B 4E7B C9              10      RET
       4E7C                     _CHDIR:
000E7C 4E7C 7E               7      LD  A,(HL)
000E7D 4E7D FE28             7      CP  '('
000E7F 4E7F 37               4      SCF
000E80 4E80 C0              11      RET NZ
000E81 4E81 CD3E47          17      CALL    INIT_PARAM
000E84 4E84 CD314A          17      CALL    FILE_B
000E87 4E87 CDA64E          17      CALL    ROM_CD
000E8A 4E8A DAFD45          10      JP  C,ERROR_FILE_NOT_FOUND
000E8D 4E8D C9              10      RET
                                
       4E8E                     _RAMDISK:
000E8E 4E8E 7E               7      LD  A,(HL)
000E8F 4E8F FE28             7      CP  '('
000E91 4E91 37               4      SCF
000E92 4E92 C0              11      RET NZ
000E93 4E93 23               6      INC HL
000E94 4E94 DD212F54        14      LD  IX,FRMQNT
000E98 4E98 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E9C 4E9C CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E9F 4E9F 7A               4      LD  A,D
000EA0 4EA0 B3               4      OR  E
000EA1 4EA1 C2F745          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000EA4 4EA4 23               6      INC HL
000EA5 4EA5 C9              10      RET
                                
       4EA6                     ROM_CD:
000EA6 4EA6 3AECF2          13      LD  A,(FNAME)
000EA9 4EA9 FE20             7      CP  020H
000EAB 4EAB 2835            12      JR  Z,CD1
000EAD 4EAD CDC34B          17      CALL    ROM_OPEN
000EB0 4EB0 D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
000EB1 4EB1 D5              11      PUSH    DE
000EB2 4EB2 2AE0F2          16      LD  HL,(DIRENT1)
000EB5 4EB5 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000EB8 4EB8 19              11      ADD HL,DE
000EB9 4EB9 CD8B43          17      CALL    RDSLT_ROM
000EBC 4EBC D1              10      POP DE
000EBD 4EBD CB67             8      BIT 4,A     ;ディレクトリ
000EBF 4EBF CAFD45          10      JP  Z,ERROR_FILE_NOT_FOUND
000EC2 4EC2 D5              11      PUSH    DE
000EC3 4EC3 2AE0F2          16      LD  HL,(DIRENT1)
000EC6 4EC6 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000EC9 4EC9 19              11      ADD HL,DE
000ECA 4ECA CD8B43          17      CALL    RDSLT_ROM
000ECD 4ECD 23               6      INC HL
000ECE 4ECE 5F               4      LD  E,A
000ECF 4ECF CD8B43          17      CALL    RDSLT_ROM
000ED2 4ED2 57               4      LD  D,A
000ED3 4ED3 EB               4      EX  DE,HL
000ED4 4ED4 D1              10      POP DE
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
       4ED5                     CD2:
000ED5 4ED5 22DEF2          16      LD  (_CD),HL
000ED8 4ED8 2AE7F2          16      LD  HL,(PARAM1)
       4EDB                     CD_SKIP:
000EDB 4EDB 7E               7      LD  A,(HL)
000EDC 4EDC 23               6      INC HL
000EDD 4EDD FE21             7      CP  021H
000EDF 4EDF 38FA            12      JR  C,CD_SKIP
000EE1 4EE1 C9              10      RET
       4EE2                     CD1:
000EE2 4EE2 2AE9F2          16      LD  HL,(_CDX)
000EE5 4EE5 18EE            12      JR  CD2
                                
       4EE7                     GET_BASIC_FCB:
000EE7 4EE7 D5              11      PUSH    DE
000EE8 4EE8 23               6      INC HL  ;+1
000EE9 4EE9 5E               7      LD  E,(HL)  ;FCB[1]
000EEA 4EEA 23               6      INC HL  ;+2
000EEB 4EEB 56               7      LD  D,(HL)  ;FCB[2]
000EEC 4EEC 23               6      INC HL  ;+3
000EED 4EED ED53E0F2        20      LD  (DIRENT1),DE
                                            ;FCB[3]
000EF1 4EF1 23               6      INC HL  ;+4
                                            ;FCB[4]
000EF2 4EF2 23               6      INC HL  ;+5
000EF3 4EF3 7E               7      LD  A,(HL)  ;FCB[5]
000EF4 4EF4 23               6      INC HL  ;+6
000EF5 4EF5 32E2F2          13      LD  (_DIR_BANK),A
000EF8 4EF8 5E               7      LD  E,(HL)  ;FCB[6]
000EF9 4EF9 23               6      INC HL  ;+7
000EFA 4EFA 56               7      LD  D,(HL)  ;FCB[7]
000EFB 4EFB 23               6      INC HL  ;+8
000EFC 4EFC ED53BDF2        20      LD  (RR_LOW),DE
000F00 4F00 7E               7      LD  A,(HL)  ;FCB[8]
000F01 4F01 23               6      INC HL  ;+9
000F02 4F02 32BFF2          13      LD  (RR_HIGH),A
000F05 4F05 7E               7      LD  A,(HL)  ;FCB[9]
000F06 4F06 23               6      INC HL  ;+10
000F07 4F07 22C7F2          16      LD  (_DTA),HL   ;FCB[10]
000F0A 4F0A D1              10      POP DE
000F0B 4F0B C9              10      RET
                                
       4F0C                     SET_BASIC_FCB:
000F0C 4F0C E5              11      PUSH    HL
000F0D 4F0D 2A64F8          16      LD  HL,(PTRFIL)
000F10 4F10 23               6      INC HL  ;+1
000F11 4F11 D5              11      PUSH    DE
000F12 4F12 ED5BE0F2        20      LD  DE,(DIRENT1)
000F16 4F16 73               7      LD  (HL),E  ;FCB[1]
000F17 4F17 23               6      INC HL  ;+2
000F18 4F18 72               7      LD  (HL),D  ;FCB[2]
000F19 4F19 23               6      INC HL  ;+3
000F1A 4F1A AF               4      XOR A
000F1B 4F1B 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
000F1C 4F1C 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
000F1D 4F1D 23               6      INC HL  ;+5
000F1E 4F1E 3AE2F2          13      LD  A,(_DIR_BANK)
000F21 4F21 77               7      LD  (HL),A  ;FCB[5]
000F22 4F22 23               6      INC HL  ;+6
000F23 4F23 ED5BBDF2        20      LD  DE,(RR_LOW)
000F27 4F27 73               7      LD  (HL),E  ;FCB[6]
000F28 4F28 23               6      INC HL  ;+7
000F29 4F29 72               7      LD  (HL),D  ;FCB[7]
000F2A 4F2A 23               6      INC HL  ;+8
000F2B 4F2B 3ABFF2          13      LD  A,(RR_HIGH)
000F2E 4F2E 77               7      LD  (HL),A  ;FCB[8]
000F2F 4F2F 23               6      INC HL  ;+9
000F30 4F30 3600            10      LD  (HL),0  ;FCB[9]
000F32 4F32 D1              10      POP DE
000F33 4F33 E1              10      POP HL
000F34 4F34 C9              10      RET
                                
       4F35                     DEVICE_CHECK:
000F35 4F35 11F34F          10      LD  DE,STR_A
000F38 4F38 CDCB4F          17      CALL    CPPROCNM
000F3B 4F3B 280A            12      JR  Z,DEVICE_OK
000F3D 4F3D 11F54F          10      LD  DE,STR_ROM
000F40 4F40 CDCB4F          17      CALL    CPPROCNM
000F43 4F43 2802            12      JR  Z,DEVICE_OK
000F45 4F45 37               4      SCF
000F46 4F46 C9              10      RET
       4F47                     DEVICE_OK:
000F47 4F47 AF               4      XOR A
000F48 4F48 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファインデックス
                                ; +10: バッファ
                                
       4F49                     DEVICE_0_OPEN:
000F49 4F49 D5              11      PUSH    DE
000F4A 4F4A E5              11      push    hl
                                ;
000F4B 4F4B 3E01             7      LD  A,1     ;ドライブA
000F4D 4F4D 32EBF2          13      LD  (FDRV),A
000F50 4F50 2166F8          10      LD  HL,FILNAM
000F53 4F53 11ECF2          10      LD  DE,FNAME
000F56 4F56 010B00          10      LD  BC,8+3
000F59 4F59 CDAD55          17      CALL    INIT_FILE1
000F5C 4F5C CDC34B          17      CALL    ROM_OPEN
000F5F 4F5F DAFD45          10      JP  C,ERROR_FILE_NOT_FOUND
000F62 4F62 E1              10      pop hl
000F63 4F63 D1              10      POP DE
000F64 4F64 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
000F67 4F67 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
000F68 4F68 AF               4      XOR A
000F69 4F69 32E3F2          13      LD  (LEFTX),A
000F6C 4F6C CD0C4F          17      CALL    SET_BASIC_FCB
000F6F 4F6F 7B               4      ld  a,e
000F70 4F70 FE08             7      cp  8
000F72 4F72 3F               4      ccf
000F73 4F73 C9              10      ret
                                
       4F74                     DEVICE_2_CLOSE:
000F74 4F74 AF               4      XOR A
                                ;   LD  (HL),A
000F75 4F75 6F               4      LD  L,A
000F76 4F76 67               4      LD  H,A
000F77 4F77 2264F8          16      LD  (PTRFIL),HL
000F7A 4F7A C9              10      RET
                                
       4F7B                     DEVICE_ENTRY:
000F7B 4F7B FE08             7      CP  8
000F7D 4F7D 280C            12      JR  Z,DEVICE_8_SIN
000F7F 4F7F 3C               4      INC A
000F80 4F80 28B3            12      JR  Z,DEVICE_CHECK:
000F82 4F82 3D               4      DEC A
000F83 4F83 28C4            12      JR  Z,DEVICE_0_OPEN
000F85 4F85 FE02             7      CP  2
000F87 4F87 28EB            12      JR  Z,DEVICE_2_CLOSE
000F89 4F89 37               4      SCF
000F8A 4F8A C9              10      RET
                                
       4F8B                     DEVICE_8_SIN:
000F8B 4F8B CDE74E          17      CALL    GET_BASIC_FCB
000F8E 4F8E E67F             7      AND 127
000F90 4F90 281D            12      JR  Z,SIN_READ_DISK
000F92 4F92 2AC7F2          16      LD  HL,(_DTA)
000F95 4F95 2B               6      DEC HL
000F96 4F96 34              11      INC (HL)
000F97 4F97 3C               4      INC A   ;(INC HL)
000F98 4F98 85               4      ADD A,L ;ADD HL,A
000F99 4F99 6F               4      LD  L,A ;
000F9A 4F9A 8C               4      ADC A,H ;
000F9B 4F9B 95               4      SUB L   ;
000F9C 4F9C 67               4      LD  H,A ;
       4F9D                     SIN_READ1:
000F9D 4F9D 7E               7      LD  A,(HL)
000F9E 4F9E FE0A             7      CP  00AH
000FA0 4FA0 C8              11      RET Z   ;ZF=separate
000FA1 4FA1 FE1A             7      CP  01AH
000FA3 4FA3 2803            12      JR  Z,SIN_EOF
000FA5 4FA5 37               4      SCF
000FA6 4FA6 3F               4      CCF     ;ZF=0 CF=0にしたい
000FA7 4FA7 C9              10      RET
       4FA8                     SIN_EOF:
000FA8 4FA8 2AC7F2          16      LD  HL,(_DTA)
000FAB 4FAB 2B               6      DEC HL
000FAC 4FAC 35              11      DEC (HL)
       4FAD                     SCF_RET:
000FAD 4FAD 37               4      SCF
000FAE 4FAE C9              10      RET
                                
       4FAF                     SIN_READ_DISK:
000FAF 4FAF 218000          10      LD  HL,128
000FB2 4FB2 CD9049          17      CALL    ROM_READ
000FB5 4FB5 CD0C4F          17      CALL    SET_BASIC_FCB
000FB8 4FB8 7C               4      LD  A,H
000FB9 4FB9 B5               4      OR  L
000FBA 4FBA 28F1            12      JR  Z,SCF_RET
000FBC 4FBC ED5BC7F2        20      LD  DE,(_DTA)
000FC0 4FC0 19              11      ADD HL,DE
000FC1 4FC1 361A            10      LD  (HL),01AH
000FC3 4FC3 2AC7F2          16      LD  HL,(_DTA)
000FC6 4FC6 2B               6      DEC HL
000FC7 4FC7 34              11      INC (HL)
000FC8 4FC8 23               6      INC HL
000FC9 4FC9 18D2            12      JR  SIN_READ1
                                
       4FCB                     CPPROCNM:
000FCB 4FCB E5              11      PUSH    HL
000FCC 4FCC 2189FD          10      LD  HL,PROCNM
       4FCF                     CPPROCNM1:
000FCF 4FCF 1A               7      LD  A,(DE)
000FD0 4FD0 13               6      INC DE
000FD1 4FD1 BE               7      CP  (HL)
000FD2 4FD2 23               6      INC HL
000FD3 4FD3 2003            12      JR  NZ,CPPROCNM2
000FD5 4FD5 B7               4      OR  A
000FD6 4FD6 20F7            12      JR  NZ,CPPROCNM1
       4FD8                     CPPROCNM2:
000FD8 4FD8 E1              10      POP HL
000FD9 4FD9 C9              10      RET
                                
       4FDA                     WILDCARD:
000FDA 4FDA 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4FE5                     STR_CHDIR:
000FE5 4FE5 434844495200            DB  "CHDIR",0
       4FEB                     STR_RAMDISK:
000FEB 4FEB 52414D4449534B00        DB  "RAMDISK",0
       4FF3                     STR_A:
000FF3 4FF3 4100                    DB  "A",0
       4FF5                     STR_ROM:
000FF5 4FF5 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4FF9                     ERROR_WRITE_PROTECTED:
000FF9 4FF9 3E00             7      LD  A,0     ;Write protected
000FFB 4FFB C9              10      RET
       4FFC                     DISKIO:
000FFC 4FFC 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000FFE 4FFE 48               4      LD  C,B
000FFF 4FFF CDD951          17      CALL    GET_DISK_BANK
       5002                     SETMAP1:        
001002 5002 E5              11      PUSH    HL
       5003                     DISKIO1:
001003 5003 C5              11      PUSH    BC      ;B=残りのセクタ数
001004 5004 D5              11      PUSH    DE      ;DE=セクタ番号
001005 5005 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
001006 5006 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
001007 5007 F5              11      PUSH    AF
001008 5008 3ABCF2          13      LD  A,(SECSZ_H)
00100B 500B CDF851          17      CALL    MUL_AHL
00100E 500E F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
00100F 500F 7D               4      LD  A,L
001010 5010 C5              11      PUSH    BC
001011 5011 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
001014 5014 09              11      ADD HL,BC
001015 5015 C1              10      POP BC
001016 5016 3013            12      JR  NC,DISKIO2
001018 5018 4D               4      LD  C,L     ;C=読み出し元
001019 5019 29              11      ADD HL,HL   ;64KB→32KB
00101A 501A 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
00101B 501B CDCF51          17      CALL    GET_DISK_BANK_FDRV
00101E 501E 84               4      ADD A,H
00101F 501F 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
001022 5022 32B7F2          13      LD  (_BANK),A
001025 5025 69               4      LD  L,C     ;C=読み出し元
001026 5026 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
001028 5028 A5               4      AND L
001029 5029 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       502B                     DISKIO2:
00102B 502B C660             7      ADD A,high BANK1_ADR
00102D 502D 67               4      LD  H,A
00102E 502E ED4BBBF2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
001032 5032 69               4      LD  L,C     ;C=0
001033 5033 CDF943          17      CALL    ROM_LDIR
001036 5036 EB               4      EX  DE,HL
001037 5037 F1              10      POP AF
001038 5038 D1              10      POP DE
001039 5039 13               6      INC DE
00103A 503A C1              10      POP BC
00103B 503B 10C6            13      DJNZ    DISKIO1
00103D 503D 41               4      LD  B,C
                                
00103E 503E E1              10      POP HL
00103F 503F AF               4      XOR A
                                
001040 5040 FB               4      EI
001041 5041 C9              10      RET
                                
       5042                     DSKCHG:
001042 5042 CD7B50          17      CALL    IS_BPB
001045 5045 3824            12      JR  C,NOTREADY
001047 5047 3A23FB          13      LD  A,(DRVTBL+2)
00104A 504A B7               4      OR  A
00104B 504B 201A            12      JR  NZ,DSKCHG1
00104D 504D 3A21FB          13      LD  A,(DRVTBL)
001050 5050 FE02             7      CP  2
001052 5052 2013            12      JR  NZ,DSKCHG1
001054 5054 CD7B50          17      CALL    IS_BPB
001057 5057 300E            12      JR  NC,DSKCHG1
001059 5059 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
00105B 505B 3221FB          13      LD  (DRVTBL),A
00105E 505E 3223FB          13      LD  (DRVTBL+2),A
001061 5061 3A48F3          13      LD  A,(MASTERS)
001064 5064 3224FB          13      LD  (DRVTBL+3),A
       5067                     DSKCHG1:
001067 5067 AF               4      XOR A
001068 5068 0601             7      LD  B,1
00106A 506A C9              10      RET
       506B                     NOTREADY:
00106B 506B 3E02             7      LD  A,2
00106D 506D 37               4      SCF
00106E 506E C9              10      RET
                                
       506F                     NO_BPB:
00106F 506F E1              10      POP HL
001070 5070 23               6      INC HL
001071 5071 11FE51          10      LD  DE,DPB2DD
001074 5074 011200          10      LD  BC,DPB2DD_E-DPB2DD
001077 5077 EDB0                    LDIR
001079 5079 AF               4      XOR A
00107A 507A C9              10      RET
                                
       507B                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
00107B 507B CDD951          17      CALL    GET_DISK_BANK
                                
00107E 507E 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
001081 5081 FE01             7      CP  1
001083 5083 D8              11      RET C
                                
001084 5084 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
001087 5087 C6FF             7      ADD A,0FFH
001089 5089 D8              11      RET C
                                
00108A 508A 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       508D                     IS_BPB1:
00108D 508D FE01             7      CP  1
00108F 508F C8              11      RET Z
001090 5090 FE02             7      CP  2
001092 5092 C8              11      RET Z
001093 5093 FE04             7      CP  4
001095 5095 C8              11      RET Z
001096 5096 37               4      SCF
001097 5097 C9              10      RET
                                
       5098                     GETDPB:
001098 5098 E5              11      PUSH    HL
001099 5099 CDD951          17      CALL    GET_DISK_BANK
                                
00109C 509C 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
00109F 509F B7               4      OR  A
0010A0 50A0 28CD            12      JR  Z,NO_BPB
0010A2 50A2 DDE1            14      POP IX
0010A4 50A4 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
0010A7 50A7 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
0010AA 50AA DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
0010AD 50AD 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
0010B0 50B0 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
0010B3 50B3 87               4      ADD A,A
0010B4 50B4 87               4      ADD A,A
0010B5 50B5 87               4      ADD A,A
0010B6 50B6 3D               4      DEC A
0010B7 50B7 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
0010BA 50BA 06FF             7      LD  B,-1
0010BC 50BC A7               4      AND A           ;無限ループ阻止
       50BD                     GETDPB1:
0010BD 50BD 04               4      INC B
0010BE 50BE 1F               4      RRA
0010BF 50BF 38FC            12      JR  C,GETDPB1
0010C1 50C1 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
0010C4 50C4 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0010C7 50C7 3D               4      DEC A
0010C8 50C8 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
0010CB 50CB A7               4      AND A           ;無限ループ阻止
0010CC 50CC 06FF             7      LD  B,-1
       50CE                     GETDPB2:
0010CE 50CE 04               4      INC B
0010CF 50CF 1F               4      RRA
0010D0 50D0 38FC            12      JR  C,GETDPB2
0010D2 50D2 04               4      INC B
0010D3 50D3 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
0010D6 50D6 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
0010D9 50D9 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
0010DC 50DC DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
0010DF 50DF 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
0010E2 50E2 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
0010E5 50E5 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
0010E8 50E8 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
0010EB 50EB ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
0010EF 50EF DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
0010F2 50F2 DD460A          19      LD  B,(IX+10)       ;FATCNT
0010F5 50F5 210000          10      LD  HL,0
       50F8                     GETDPB3:
0010F8 50F8 19              11      ADD HL,DE
0010F9 50F9 10FD            13      DJNZ    GETDPB3
       50FB                     GETDPB4:
0010FB 50FB DD5E08          19      LD  E,(IX+8)        ;FIRFAT
0010FE 50FE DD5609          19      LD  D,(IX+9)        ;FIRFAT
001101 5101 19              11      ADD HL,DE
001102 5102 DD7511          19      LD  (IX+17),L       ;FIRDIR
001105 5105 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
001108 5108 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00110B 510B 87               4      ADD A,A
00110C 510C 87               4      ADD A,A
00110D 510D DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5110                     GETDPB5:
001110 5110 CB3B             8      SRL E
001112 5112 1F               4      RRA
001113 5113 30FB            12      JR  NC,GETDPB5
001115 5115 1600             7      LD  D,0
001117 5117 19              11      ADD HL,DE
001118 5118 DD750C          19      LD  (IX+12),L       ;FIRREC
00111B 511B DD740D          19      LD  (IX+13),H       ;FIRREC
                                
00111E 511E 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
001121 5121 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
001124 5124 DD560D          19      LD  D,(IX+13)       ;FIRREC
001127 5127 A7               4      AND A
001128 5128 ED52            15      SBC HL,DE
                                
00112A 512A DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
00112D 512D 3C               4      INC A
00112E 512E 37               4      SCF             ;無限ループ阻止
       512F                     GETDPB6:
00112F 512F 1F               4      RRA
001130 5130 3806            12      JR  C,GETDPB7
001132 5132 CB3C             8      SRL H
001134 5134 CB1D             8      RR  L
001136 5136 18F7            12      JR  GETDPB6
       5138                     GETDPB7:
001138 5138 23               6      INC HL
001139 5139 DD750E          19      LD  (IX+14),L       ;MAXCLUS
00113C 513C DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       513F                     GETDPBD1:
00113F 513F DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001142 5142 E6FC             7      AND 0FCH
001144 5144 C8              11      RET Z
                                
001145 5145 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
001149 5149 37               4      SCF
00114A 514A DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
00114E 514E DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
001151 5151 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
001155 5155 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001159 5159 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
00115D 515D DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
001161 5161 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
001165 5165 DDCB1126        23      SLA (IX+17)         ;FIRDIR
001169 5169 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
00116D 516D DD6E11          19      LD  L,(IX+17)       ;FIRDIR
001170 5170 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
001173 5173 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001176 5176 87               4      ADD A,A
001177 5177 87               4      ADD A,A
001178 5178 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       517B                     GETDPBD5:
00117B 517B CB3B             8      SRL E
00117D 517D 1F               4      RRA
00117E 517E 30FB            12      JR  NC,GETDPBD5
001180 5180 1600             7      LD  D,0
001182 5182 19              11      ADD HL,DE
001183 5183 DD750C          19      LD  (IX+12),L       ;FIRREC
001186 5186 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001189 5189 18B4            12      JR  GETDPBD1
                                
       518B                     CHOICE:
00118B 518B 210000          10      LD  HL,0
00118E 518E C9              10      RET
                                
       518F                     DSKFMT:
00118F 518F AF               4      XOR A
001190 5190 37               4      SCF
       5191                     DSKSTP:
001191 5191 C9              10      RET
                                
       5192                     BASENT:
001192 5192 2A74F6          16      LD  HL,(STKTOP)
001195 5195 3A40F3          13      LD  A,(REBOOT)
001198 5198 C6FF             7      ADD A,0FFH
00119A 519A 3811            12      JR  C,REBOOT1
00119C 519C 211052          10      LD  HL,AUTOEXEC
00119F 519F 11EBF2          10      LD  DE,FDRV
0011A2 51A2 010C00          10      LD  BC,1+8+3
0011A5 51A5 EDB0                    LDIR
0011A7 51A7 CDC34B          17      CALL    ROM_OPEN
0011AA 51AA D4B245          17      CALL    NC,ROM_LOAD1
       51AD                     REBOOT1:
0011AD 51AD 211C52          10      LD  HL,CMD_RUN
0011B0 51B0 111FF4          10      LD  DE,KBUF
0011B3 51B3 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
0011B6 51B6 D5              11      PUSH    DE
0011B7 51B7 EDB0                    LDIR
0011B9 51B9 3004            12      JR  NC,REBOOT2
0011BB 51BB AF               4      XOR A
0011BC 51BC 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       51BF                     REBOOT2:
0011BF 51BF E1              10      POP HL
0011C0 51C0 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0011C4 51C4 DD210146        14      LD  IX,NEWSTT
0011C8 51C8 C31C00          10      JP  _CALSLT
                                
       51CB                     GETSLT:
0011CB 51CB 3A22FB          13      LD  A,(DRVTBL+1)
0011CE 51CE C9              10      RET
                                
       51CF                     GET_DISK_BANK_FDRV:
0011CF 51CF 3AEBF2          13      LD  A,(FDRV)
0011D2 51D2 D601             7      SUB 1
0011D4 51D4 3003            12      JR  NC,GET_DISK_BANK
0011D6 51D6 3ADDF2          13      LD  A,(_DVSW)
       51D9                     GET_DISK_BANK:
0011D9 51D9 B7               4      OR  A       ;A=DRIVE
0011DA 51DA 3E01             7      LD  A,DISK_BANK
0011DC 51DC 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
0011DE 51DE 3ADCF2          13      LD  A,(B_DRIVE)
                                #endif
       51E1                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
0011E1 51E1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0011E4 51E4 F5              11      PUSH    AF
0011E5 51E5 E5              11      PUSH    HL
0011E6 51E6 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
0011E9 51E9 22BBF2          16      LD  (SECSZ),HL
0011EC 51EC 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0011EF 51EF CDF851          17      CALL    MUL_AHL
0011F2 51F2 22B9F2          16      LD  (CLSZ),HL
0011F5 51F5 E1              10      POP HL
0011F6 51F6 F1              10      POP AF
0011F7 51F7 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       51F8                     MUL_AHL:
0011F8 51F8 37               4      SCF     ;無限ループ回避
       51F9                     MUL_AHL1:
0011F9 51F9 1F               4      RRA     ;->CF
0011FA 51FA D8              11      RET C
0011FB 51FB 29              11      ADD HL,HL
0011FC 51FC 18FB            12      JR  MUL_AHL1
                                
       51FE                     DPB2DD:
0011FE 51FE F9                      DB  0F9H    ;MEDIA
0011FF 51FF 0002                    DW  00200H  ;SECSIZ
001201 5201 0F                      DB  00FH    ;DIRMSK
001202 5202 04                      DB  004H    ;DIRSHFT
001203 5203 01                      DB  001H    ;CLUSMSK
001204 5204 02                      DB  002H    ;CLUSSHFT
001205 5205 0100                    DW  00001H  ;FIRFAT
001207 5207 02                      DB  002H    ;FATCNT
001208 5208 70                      DB  070H    ;MAXENT
001209 5209 0E00                    DW  0000EH  ;FIRREC
00120B 520B CA02                    DW  002CAH  ;MAXCLUS
00120D 520D 03                      DB  003H    ;FATSIZ
00120E 520E 0700                    DW  0007H   ;FIRDIR
       5210                     DPB2DD_E:
                                
       5210                     AUTOEXEC:
001210 5210 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       521C                     CMD_RUN:
00121C 521C 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
                                #if exists USE_MORMAL32K_OR_ASCII16
001222 5222 80F2                    DW  0F280H
                                #else
                                    DW  0F240H
                                #endif
       5224                     CMD_CLEAR_E:
001224 5224 3A8A00                  DB  03AH,08AH,0         ;RUN
       5227                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       5227                     POP_HL_ERROR:
001227 5227 E1              10      POP     HL
       5228                     _ERROR:
001228 5228 0600             7      LD  B,0
00122A 522A A7               4      AND A
00122B 522B C9              10      RET
                                
       522C                     ROM_BDOS:
00122C 522C E5              11      PUSH    HL
00122D 522D 79               4      LD  A,C
00122E 522E 87               4      ADD A,A
00122F 522F 38F7            12      JR  C,_ERROR
001231 5231 6F               4      LD  L,A
001232 5232 265F             7      LD  H,high STABLE
001234 5234 7E               7      LD  A,(HL)
001235 5235 2C               4      INC L
001236 5236 66               7      LD  H,(HL)
001237 5237 6F               4      LD  L,A
001238 5238 E3              19      EX  (SP),HL
001239 5239 79               4      LD  A,C
00123A 523A C9              10      RET
                                
       523B                     _PRINT:
       523B                     PRINT:
00123B 523B 7B               4      LD  A,E
00123C 523C 1803            12      JR  MSG_A
                                
       523E                     _SYS01:     ;(BDOS)コンソール入力
00123E 523E CDB552          17      CALL    _SYS07
       5241                     MSG_A:
001241 5241 FE03             7      CP  3
001243 5243 2814            12      JR  Z,MSG_BR
       5245                     MSGA1:
001245 5245 F5              11      PUSH    AF
001246 5246 C5              11      PUSH    BC
001247 5247 D5              11      PUSH    DE
001248 5248 E5              11      PUSH    HL
001249 5249 DDE5            15      PUSH    IX
00124B 524B DD21A200        14      LD  IX,CHPUT
00124F 524F CDD642          17      CALL    CALSLT_R
001252 5252 DDE1            14      POP IX
001254 5254 E1              10      POP HL
001255 5255 D1              10      POP DE
001256 5256 C1              10      POP BC
       5257                     MSGA2:
001257 5257 F1              10      POP AF
001258 5258 C9              10      RET
       5259                     MSG_BR:
001259 5259 F5              11      PUSH    AF
00125A 525A 3ADDF3          13      LD  A,(CSRX)
00125D 525D FE02             7      CP  2
00125F 525F 38F6            12      JR  C,MSGA2
001261 5261 F1              10      POP AF
       5262                     MSG_CR:
001262 5262 F5              11      PUSH    AF
001263 5263 3E0D             7      LD  A,00DH
001265 5265 CD4552          17      CALL    MSGA1
001268 5268 3E0A             7      LD  A,00AH
00126A 526A CD4552          17      CALL    MSGA1
00126D 526D F1              10      POP AF
00126E 526E C9              10      RET
                                
       526F                     _SYS02:     ;(BDOS)コンソール出力
00126F 526F CD8A52          17      CALL    BREAK
001272 5272 1805            12      JR  PRINTX
                                
       5274                     _SYS06:     ;(BDOS)コンソール直接入出力
001274 5274 7B               4      LD  A,E
001275 5275 3C               4      INC A
001276 5276 CAC952          10      JP  Z,_INKEY
       5279                     PRINTX:
001279 5279 C33B52          10      JP  _PRINT
                                
       527C                     _SYS08:     ;(BDOS)エコーなしコンソール入力
00127C 527C CDB552          17      CALL    _SYS07
00127F 527F FE03             7      CP  3
001281 5281 CC8A52          17      CALL    Z,_BREAK
001284 5284 FE13             7      CP  013H        ;CTRL+S
001286 5286 C0              11      RET NZ
       5287                     PAUSE:
001287 5287 CDA152          17      CALL    KEYBC
                                
       528A                     _BREAK:
       528A                     BREAK:
00128A 528A F5              11      PUSH    AF
00128B 528B C5              11      PUSH    BC
00128C 528C D5              11      PUSH    DE
00128D 528D E5              11      PUSH    HL
00128E 528E DDE5            15      PUSH    IX
001290 5290 DD21B700        14      LD  IX,BREAKX
001294 5294 CDD642          17      CALL    CALSLT_R
001297 5297 DDE1            14      POP IX
001299 5299 E1              10      POP HL
00129A 529A D1              10      POP DE
00129B 529B C1              10      POP BC
00129C 529C DC8A52          17      CALL    C,_BREAK
00129F 529F F1              10      POP AF
0012A0 52A0 C9              10      RET
       52A1                     KEYBC:
0012A1 52A1 F5              11      PUSH    AF
0012A2 52A2 C5              11      PUSH    BC
0012A3 52A3 D5              11      PUSH    DE
0012A4 52A4 E5              11      PUSH    HL
0012A5 52A5 DDE5            15      PUSH    IX
0012A7 52A7 DD215601        14      LD  IX,KILBUF
0012AB 52AB CDD642          17      CALL    CALSLT_R
0012AE 52AE DDE1            14      POP IX
0012B0 52B0 E1              10      POP HL
0012B1 52B1 D1              10      POP DE
0012B2 52B2 C1              10      POP BC
0012B3 52B3 F1              10      POP AF
0012B4 52B4 C9              10      RET
                                
       52B5                     _SYS07:
       52B5                     FLGET:
0012B5 52B5 C5              11      PUSH    BC
0012B6 52B6 D5              11      PUSH    DE
0012B7 52B7 E5              11      PUSH    HL
0012B8 52B8 DDE5            15      PUSH    IX
0012BA 52BA DD219F00        14      LD  IX,CHGET
0012BE 52BE CDD642          17      CALL    CALSLT_R
0012C1 52C1 DDE1            14      POP IX
0012C3 52C3 E1              10      POP HL
0012C4 52C4 D1              10      POP DE
0012C5 52C5 C1              10      POP BC
0012C6 52C6 FE03             7      CP  3
0012C8 52C8 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       52C9                     _INKEY:
       52C9                     INKEY:
0012C9 52C9 CD6353          17      CALL    CPM_CONST
0012CC 52CC C8              11      RET Z
0012CD 52CD 18E6            12      JR  FLGET
                                
       52CF                     _SYS0A:     ;(BDOS)文字列入力
0012CF 52CF C5              11      PUSH    BC
0012D0 52D0 E5              11      PUSH    HL
0012D1 52D1 D5              11      PUSH    DE
0012D2 52D2 CDFB52          17      CALL    GETL
0012D5 52D5 111FF4          10      LD  DE,KBUF
0012D8 52D8 E1              10      POP HL
0012D9 52D9 E5              11      PUSH    HL
0012DA 52DA 0E00             7      LD  C,0
0012DC 52DC 3004            12      JR  NC,SAX0
0012DE 52DE 23               6      INC HL
0012DF 52DF 23               6      INC HL
0012E0 52E0 1808            12      JR  SAX4
       52E2                     SAX0:
0012E2 52E2 46               7      LD  B,(HL)
0012E3 52E3 23               6      INC HL
       52E4                     SAX1:
0012E4 52E4 23               6      INC HL
0012E5 52E5 1A               7      LD  A,(DE)
0012E6 52E6 13               6      INC DE
0012E7 52E7 B7               4      OR  A
0012E8 52E8 2004            12      JR  NZ,SAX2
       52EA                     SAX4:
0012EA 52EA 360D            10      LD  (HL),00DH
0012EC 52EC 1804            12      JR  SAX3
       52EE                     SAX2:
0012EE 52EE 77               7      LD  (HL),A
0012EF 52EF 0C               4      INC C
0012F0 52F0 10F2            13      DJNZ    SAX1
       52F2                     SAX3:
0012F2 52F2 D1              10      POP DE
0012F3 52F3 79               4      LD  A,C
0012F4 52F4 13               6      INC DE
0012F5 52F5 12               7      LD  (DE),A
0012F6 52F6 1B               6      DEC DE
0012F7 52F7 E1              10      POP HL
0012F8 52F8 C1              10      POP BC
0012F9 52F9 A7               4      AND A
0012FA 52FA C9              10      RET
       52FB                     GETL:
0012FB 52FB DDE5            15      PUSH    IX
0012FD 52FD FDE5            15      PUSH    IY
                                
0012FF 52FF 2ADCF3          16      LD  HL,(CSRY)
001302 5302 22CAFB          16      LD  (FSTPOS),HL
       5305                     GETL1:
001305 5305 CD7C52          17      CALL    _SYS08
001308 5308 FE09             7      CP  9
00130A 530A 2008            12      JR  NZ,GETL1V
00130C 530C 211FF4          10      LD  HL,KBUF
00130F 530F CD6043          17      CALL    MSX
001312 5312 18F1            12      JR  GETL1
       5314                     GETL1V:
001314 5314 5F               4      LD  E,A
001315 5315 FE08             7      CP  8
001317 5317 CCB153          17      CALL    Z,CTRL02
00131A 531A FE20             7      CP  020H
00131C 531C D4DD53          17      CALL    NC,INSERT
00131F 531F CD4552          17      CALL    MSGA1
                                
001322 5322 7B               4      LD  A,E
001323 5323 FE0D             7      CP  00DH
001325 5325 20DE            12      JR  NZ,GETL1
                                
001327 5327 111FF4          10      LD  DE,KBUF
00132A 532A 3AB0F3          13      LD  A,(LINLEN)
00132D 532D 47               4      LD  B,A
00132E 532E CDBC55          17      CALL    ZERO_MEMORY_DE
                                
001331 5331 2ACAFB          16      LD  HL,(FSTPOS)
001334 5334 3ADCF3          13      LD  A,(CSRY)
001337 5337 6F               4      LD  L,A
001338 5338 E5              11      PUSH    HL
001339 5339 CD0E54          17      CALL    LOC0
00133C 533C 4D               4      LD  C,L
00133D 533D 44               4      LD  B,H
00133E 533E E1              10      POP HL
00133F 533F 3AB0F3          13      LD  A,(LINLEN)
001342 5342 94               4      SUB H
001343 5343 3D               4      DEC A
001344 5344 5F               4      LD  E,A
001345 5345 211FF4          10      LD  HL,KBUF
       5348                     GETL2:
001348 5348 CDA153          17      CALL    _SCRN
00134B 534B 03               6      INC BC
00134C 534C 77               7      LD  (HL),A
00134D 534D 23               6      INC HL
00134E 534E 1D               4      DEC E
00134F 534F 20F7            12      JR  NZ,GETL2
001351 5351 CD6252          17      CALL    MSG_CR
                                
001354 5354 FDE1            14      POP IY
001356 5356 DDE1            14      POP IX
       5358                     GETL3:
001358 5358 2B               6      DEC HL
001359 5359 7E               7      LD  A,(HL)
00135A 535A FE21             7      CP  021H
00135C 535C D0              11      RET NC
00135D 535D 3600            10      LD  (HL),0
00135F 535F 15               4      DEC D
001360 5360 20F6            12      JR  NZ,GETL3
001362 5362 C9              10      RET
                                
       5363                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       5363                     CONSTX:
       5363                     CPM_CONST:
001363 5363 C5              11      PUSH    BC
001364 5364 D5              11      PUSH    DE
001365 5365 E5              11      PUSH    HL
001366 5366 DDE5            15      PUSH    IX
001368 5368 DD219C00        14      LD  IX,CHSNS
00136C 536C CDD642          17      CALL    CALSLT_R
00136F 536F DDE1            14      POP IX
001371 5371 E1              10      POP HL
001372 5372 D1              10      POP DE
001373 5373 C1              10      POP BC
001374 5374 C9              10      RET
                                
       5375                     _SYS2A:     ;(BDOS)日付の獲得
001375 5375 AF               4      XOR A
001376 5376 57               4      LD  D,A
001377 5377 5F               4      LD  E,A
001378 5378 67               4      LD  H,A
001379 5379 6F               4      LD  L,A
00137A 537A C9              10      RET
                                
       537B                     _SYS2C:     ;(BDOS)時刻の獲得
00137B 537B AF               4      XOR A
00137C 537C 57               4      LD  D,A
00137D 537D 5F               4      LD  E,A
00137E 537E 67               4      LD  H,A
00137F 537F 6F               4      LD  L,A
001380 5380 C9              10      RET
                                
       5381                     POS:
001381 5381 F5              11      PUSH    AF
001382 5382 2ADCF3          16      LD  HL,(CSRY)
001385 5385 7D               4      LD  A,L
001386 5386 6C               4      LD  L,H
001387 5387 67               4      LD  H,A
001388 5388 2C               4      INC L
001389 5389 24               4      INC H
00138A 538A F1              10      POP AF
00138B 538B C9              10      RET
                                
       538C                     LOC:
00138C 538C F5              11      PUSH    AF
00138D 538D E5              11      PUSH    HL
00138E 538E 7D               4      LD  A,L
00138F 538F 6C               4      LD  L,H
001390 5390 67               4      LD  H,A
001391 5391 2D               4      DEC L
001392 5392 25               4      DEC H
001393 5393 DDE5            15      PUSH    IX
001395 5395 DD21C600        14      LD  IX,POSIT
001399 5399 CDD642          17      CALL    CALSLT_R
00139C 539C DDE1            14      POP IX
00139E 539E E1              10      POP HL
00139F 539F F1              10      POP AF
0013A0 53A0 C9              10      RET
                                
       53A1                     _SCRN:
       53A1                     SCRN:
0013A1 53A1 E5              11      PUSH    HL
0013A2 53A2 DDE5            15      PUSH    IX
                                
0013A4 53A4 69               4      LD  L,C
0013A5 53A5 60               4      LD  H,B
0013A6 53A6 DD214A00        14      LD  IX,RDVRM
0013AA 53AA CDD642          17      CALL    CALSLT_R
                                
0013AD 53AD DDE1            14      POP IX
0013AF 53AF E1              10      POP HL
0013B0 53B0 C9              10      RET
                                
       53B1                     CTRL02:
0013B1 53B1 F5              11      PUSH    AF
0013B2 53B2 D5              11      PUSH    DE
0013B3 53B3 2ADCF3          16      LD  HL,(CSRY)
0013B6 53B6 3AB0F3          13      LD  A,(LINLEN)
0013B9 53B9 4F               4      LD  C,A
0013BA 53BA 94               4      SUB H   ;CSRX
0013BB 53BB C602             7      ADD A,2
0013BD 53BD 47               4      LD  B,A ;カーソルより右の文字数
0013BE 53BE 61               4      LD  H,C ;LINLEN
0013BF 53BF C5              11      PUSH    BC
0013C0 53C0 CD0E54          17      CALL    LOC0
0013C3 53C3 C1              10      POP BC
                                
0013C4 53C4 1620             7      LD  D,020H
       53C6                     C8X1:
0013C6 53C6 DD214A00        14      LD  IX,RDVRM
0013CA 53CA CDD642          17      CALL    CALSLT_R
0013CD 53CD 4F               4      LD  C,A
0013CE 53CE 7A               4      LD  A,D
0013CF 53CF DD214D00        14      LD  IX,WRTVRM
0013D3 53D3 CDD642          17      CALL    CALSLT_R
0013D6 53D6 2B               6      DEC HL
0013D7 53D7 51               4      LD  D,C
0013D8 53D8 10EC            13      DJNZ    C8X1
0013DA 53DA D1              10      POP DE
0013DB 53DB F1              10      POP AF
0013DC 53DC C9              10      RET
                                
       53DD                     INSERT:
0013DD 53DD F5              11      PUSH    AF
0013DE 53DE D5              11      PUSH    DE
0013DF 53DF 2ADCF3          16      LD  HL,(CSRY)
0013E2 53E2 3AB0F3          13      LD  A,(LINLEN)
0013E5 53E5 4F               4      LD  C,A
0013E6 53E6 94               4      SUB H   ;CSRX
0013E7 53E7 3C               4      INC A
0013E8 53E8 47               4      LD  B,A ;カーソルより右の文字数
0013E9 53E9 C5              11      PUSH    BC
0013EA 53EA CD0E54          17      CALL    LOC0
0013ED 53ED C1              10      POP BC
                                
0013EE 53EE 1620             7      LD  D,020H
       53F0                     INS1:
0013F0 53F0 DD214A00        14      LD  IX,RDVRM
0013F4 53F4 CDD642          17      CALL    CALSLT_R
0013F7 53F7 4F               4      LD  C,A
0013F8 53F8 7A               4      LD  A,D
0013F9 53F9 DD214D00        14      LD  IX,WRTVRM
0013FD 53FD CDD642          17      CALL    CALSLT_R
001400 5400 23               6      INC HL
001401 5401 51               4      LD  D,C
001402 5402 10EC            13      DJNZ    INS1
001404 5404 D1              10      POP DE
001405 5405 F1              10      POP AF
001406 5406 C9              10      RET
                                
       5407                     CONOUT1:
001407 5407 59               4      LD  E,C
001408 5408 C33B52          10      JP  _PRINT
                                
       540B                     GETVRAM:
00140B 540B 2ADCF3          16      LD  HL,(CSRY)
       540E                     LOC0:
00140E 540E 2D               4      DEC L
00140F 540F 25               4      DEC H
001410 5410 4C               4      LD  C,H ;CSRX-1
001411 5411 5D               4      LD  E,L ;CSRY-1
       5412                     LOC1:
001412 5412 3AB0F3          13      LD  A,(LINLEN)
001415 5415 67               4      LD  H,A
001416 5416 1600             7      LD  D,0
001418 5418 6A               4      LD  L,D ;0
001419 5419 0608             7      LD  B,8
       541B                     LOC2:
00141B 541B 29              11      ADD HL,HL
00141C 541C 3001            12      JR  NC,LOC3
00141E 541E 19              11      ADD HL,DE
       541F                     LOC3:
00141F 541F 10FA            13      DJNZ    LOC2
001421 5421 09              11      ADD HL,BC
001422 5422 C9              10      RET
                                
       5423                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001423 5423 212200          10      LD  HL,00022H
001426 5426 AF               4      XOR A
001427 5427 7D               4      LD  A,L
001428 5428 C9              10      RET
                                
       5429                     _SYS0D:     ;(BDOS)ディスク・リセット
001429 5429 218000          10      LD  HL,00080H
00142C 542C 22C7F2          16      LD  (_DTA),HL
00142F 542F C9              10      RET
                                
       5430                     _SYS0E:     ;(BDOS)カレントドライブの設定
001430 5430 7B               4      LD  A,E
001431 5431 FE02             7      CP  2
001433 5433 D0              11      RET NC
001434 5434 32DDF2          13      LD  (_DVSW),A
001437 5437 C9              10      RET
                                
       5438                     _SYS0F:     ;(BDOS)ファイルのオープン
001438 5438 D5              11      PUSH    DE
001439 5439 FDE1            14      POP IY
00143B 543B CDA655          17      CALL    INIT_FILE
00143E 543E CDC34B          17      CALL    ROM_OPEN
001441 5441 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001443 5443 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
001447 5447 FDE5            15      PUSH    IY
001449 5449 D1              10      POP DE
00144A 544A 13               6      INC DE
00144B 544B 010B00          10      LD  BC,11
00144E 544E EDB0                    LDIR
                                ;               Attribute
001450 5450 7E               7      LD  A,(HL)
001451 5451 FD770D          19      LD  (IY+13),A
                                ;               TIME
001454 5454 110B00          10      LD  DE,11
001457 5457 19              11      ADD HL,DE
001458 5458 7E               7      LD  A,(HL)
001459 5459 23               6      INC HL
00145A 545A FD7716          19      LD  (IY+22),A
00145D 545D 7E               7      LD  A,(HL)
00145E 545E 23               6      INC HL
00145F 545F FD7717          19      LD  (IY+23),A
                                ;               DATE
001462 5462 7E               7      LD  A,(HL)
001463 5463 23               6      INC HL
001464 5464 FD7714          19      LD  (IY+20),A
001467 5467 7E               7      LD  A,(HL)
001468 5468 23               6      INC HL
001469 5469 FD7715          19      LD  (IY+21),A
                                ;               First cluster
00146C 546C 7E               7      LD  A,(HL)
00146D 546D 23               6      INC HL
00146E 546E FD771A          19      LD  (IY+26),A
001471 5471 7E               7      LD  A,(HL)
001472 5472 23               6      INC HL
001473 5473 FD771B          19      LD  (IY+27),A
                                ;               SIZE
001476 5476 7E               7      LD  A,(HL)
001477 5477 23               6      INC HL
001478 5478 FD7710          19      LD  (IY+16),A
00147B 547B 7E               7      LD  A,(HL)
00147C 547C 23               6      INC HL
00147D 547D FD7711          19      LD  (IY+17),A
001480 5480 7E               7      LD  A,(HL)
001481 5481 23               6      INC HL
001482 5482 FD7712          19      LD  (IY+18),A
001485 5485 7E               7      LD  A,(HL)
001486 5486 FD7713          19      LD  (IY+19),A
001489 5489 AF               4      XOR A
00148A 548A FD770C          19      LD  (IY+12),A
00148D 548D C9              10      RET
                                
       548E                     _SYS10:     ;(BDOS)ファイルのクローズ
00148E 548E AF               4      XOR A
00148F 548F C9              10      RET
                                
       5490                     S11X1:
001490 5490 FD7119          19      LD  (IY+25),C       ;RootEntCnt
001493 5493 FD750E          19      LD  (IY+14),L
001496 5496 FD740F          19      LD  (IY+15),H
       5499                     SCF_FF_RET:
001499 5499 37               4      SCF
00149A 549A 9F               4      SBC A,A
00149B 549B C9              10      RET
                                
       549C                     _SYS11:     ;(BDOS)最初のファイルの検索
00149C 549C ED53CAF2        20      LD  (_FCB),DE
0014A0 54A0 D5              11      PUSH    DE
0014A1 54A1 FDE1            14      POP IY
0014A3 54A3 CDA655          17      CALL    INIT_FILE
0014A6 54A6 CD1F4E          17      CALL    GET_DIR_DAT
       54A9                     S12X1:
0014A9 54A9 CDDF4B          17      CALL    FILESE
0014AC 54AC 30E2            12      JR  NC,S11X1
0014AE 54AE 0D               4      DEC C
0014AF 54AF FD7119          19      LD  (IY+25),C       ;RootEntCnt
0014B2 54B2 FDCB0D66        20      BIT 4,(IY+13)
0014B6 54B6 2809            12      JR  Z,S12X2
0014B8 54B8 E5              11      PUSH    HL
0014B9 54B9 DDE1            14      POP IX
0014BB 54BB DDCB0E66        20      BIT 4,(IX+1+13)
0014BF 54BF 28E8            12      JR  Z,S12X1
       54C1                     S12X2:
0014C1 54C1 012000          10      LD  BC,32
0014C4 54C4 ED5BC7F2        20      LD  DE,(_DTA)
0014C8 54C8 AF               4      XOR A
0014C9 54C9 12               7      LD  (DE),A      ;ドライブ番号
0014CA 54CA 13               6      INC DE
0014CB 54CB EDB0                    LDIR            ;ディレクトリエントリ
0014CD 54CD FD750E          19      LD  (IY+14),L
0014D0 54D0 FD740F          19      LD  (IY+15),H
0014D3 54D3 C9              10      RET
                                
       54D4                     _SYS12:
0014D4 54D4 FD2ACAF2        20      LD  IY,(_FCB)
0014D8 54D8 FDE5            15      PUSH    IY
0014DA 54DA D1              10      POP DE
0014DB 54DB CDA655          17      CALL    INIT_FILE
                                
0014DE 54DE FD6E0E          19      LD  L,(IY+14)
0014E1 54E1 FD660F          19      LD  H,(IY+15)
0014E4 54E4 FD4E19          19      LD  C,(IY+25)
0014E7 54E7 18C0            12      JR  S12X1
                                
       54E9                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
0014E9 54E9 CD054E          17      CALL    SET_FCB
0014EC 54EC CDD34D          17      CALL    GETSEQ
0014EF 54EF CDC04D          17      CALL    RB_READ
0014F2 54F2 E5              11      PUSH    HL
0014F3 54F3 CDE04D          17      CALL    SETSEQ
0014F6 54F6 E1              10      POP HL
       54F7                     SREAD:
0014F7 54F7 C601             7      ADD A,001H
0014F9 54F9 D8              11      RET C
                                
0014FA 54FA 7D               4      LD  A,L
0014FB 54FB D601             7      SUB 001H
0014FD 54FD 9F               4      SBC A,A
0014FE 54FE E603             7      AND 3
001500 5500 1F               4      RRA
001501 5501 C9              10      RET
                                
       5502                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001502 5502 210100          10      LD  HL,00001H
001505 5505 AF               4      XOR A
001506 5506 C9              10      RET
                                
       5507                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001507 5507 3ADDF2          13      LD  A,(_DVSW)
00150A 550A C9              10      RET
                                
       550B                     _SYS1A:     ;(BDOS)DTAの設定
00150B 550B ED53C7F2        20      LD  (_DTA),DE
00150F 550F AF               4      XOR A
001510 5510 C9              10      RET
                                
       5511                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001511 5511 010002          10      LD  BC,512
001514 5514 11C302          10      LD  DE,707
001517 5517 210000          10      LD  HL,0
00151A 551A DD21CCF2        14      LD  IX,_BUF
00151E 551E FD21CCF2        14      LD  IY,_BUF
001522 5522 FD3600F9        19      LD  (IY+0),0F9H
001526 5526 3E02             7      LD  A,2
001528 5528 C9              10      RET
                                
       5529                     _SYS21:     ;(BDOS)ランダムな読み出し
001529 5529 CD054E          17      CALL    SET_FCB
                                
00152C 552C FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00152F 552F FD6622          19      LD  H,(IY+34)
                                
001532 5532 CDC04D          17      CALL    RB_READ
001535 5535 18C0            12      JR  SREAD
                                
       5537                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001537 5537 CD3854          17      CALL    _SYS0F
00153A 553A D8              11      RET C
                                
00153B 553B D5              11      PUSH    DE      ;EX DE,IY
00153C 553C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00153E 553E CDF54D          17      CALL    GETSIZE
       5541                     _S24X1:
001541 5541 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001544 5544 FD7422          19      LD  (IY+34),H
001547 5547 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00154B 554B FDE3            23      EX  (SP),IY     ;
00154D 554D D1              10      POP DE      ;
                                
00154E 554E AF               4      XOR A
00154F 554F C9              10      RET
                                
       5550                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001550 5550 E5              11      PUSH    HL
001551 5551 D5              11      PUSH    DE      ;EX DE,IY
001552 5552 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001554 5554 CDD34D          17      CALL    GETSEQ
001557 5557 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5559                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001559 5559 CD054E          17      CALL    SET_FCB
00155C 555C E5              11      PUSH    HL
00155D 555D FD6E21          19      LD  L,(IY+33)
001560 5560 FD6622          19      LD  H,(IY+34)
001563 5563 22BDF2          16      LD  (RR_LOW),HL
001566 5566 FD6E23          19      LD  L,(IY+35)
001569 5569 FD6624          19      LD  H,(IY+36)
00156C 556C 22BFF2          16      LD  (RR_HIGH),HL
00156F 556F E1              10      POP HL
001570 5570 CD9049          17      CALL    ROM_READ
001573 5573 ED5BBDF2        20      LD  DE,(RR_LOW)
001577 5577 FD7321          19      LD  (IY+33),E
00157A 557A FD7222          19      LD  (IY+34),D
00157D 557D ED5BBFF2        20      LD  DE,(RR_HIGH)
001581 5581 FD7323          19      LD  (IY+35),E
001584 5584 FD7224          19      LD  (IY+36),D
001587 5587 9F               4      SBC A,A
001588 5588 C9              10      RET
                                
       5589                     _SYS2F:
001589 5589 44               4      LD  B,H
00158A 558A 2AC7F2          16      LD  HL,(_DTA)
00158D 558D C3FC4F          10      JP  DISKIO
                                
       5590                     _SYS5A:
001590 5590 0600             7      LD  B,0
001592 5592 D5              11      PUSH    DE
001593 5593 DDE1            14      POP IX
       5595                     _SX5A1:
001595 5595 1A               7      LD  A,(DE)
001596 5596 B7               4      OR  A
001597 5597 2804            12      JR  Z,_SX5A2
001599 5599 13               6      INC DE
00159A 559A 04               4      INC B
00159B 559B 18F8            12      JR  _SX5A1
                                
       559D                     _SX5A2:
00159D 559D 78               4      LD  A,B
00159E 559E CD5B4A          17      CALL    FILE_BDOS
0015A1 55A1 CDA64E          17      CALL    ROM_CD
0015A4 55A4 9F               4      SBC A,A
0015A5 55A5 C9              10      RET
                                
       55A6                     INIT_FILE:
0015A6 55A6 EB               4      EX  DE,HL
0015A7 55A7 11EBF2          10      LD  DE,FDRV
0015AA 55AA 010C00          10      LD  BC,1+8+3
       55AD                     INIT_FILE1:
0015AD 55AD EDB0                    LDIR
0015AF 55AF CDCF51          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
0015B2 55B2 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0015B5 55B5 2ADEF2          16      LD  HL,(_CD)
0015B8 55B8 22E9F2          16      LD  (_CDX),HL           ;カレントディレクトリ
0015BB 55BB C9              10      RET
                                
       55BC                     ZERO_MEMORY_DE:
0015BC 55BC AF               4      XOR A
       55BD                     FILL_MEMORY_DE:
0015BD 55BD 12               7      LD  (DE),A
0015BE 55BE 13               6      INC DE
0015BF 55BF 10FC            13      DJNZ    FILL_MEMORY_DE
0015C1 55C1 C9              10      RET
                                
0015C2 55C2                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 28523E526F522852        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 285228527452B552        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 7C522852CF526353        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 2354295430543854        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 8E549C54D4542852        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 E954285228522852        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 025507550B551155        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 2852285228523755        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 5055285228525955        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 2852285275532852        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 7B53285228528955        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 2852285290552852        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 2852285228522852        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
[EOF:DISKROM32.ASM:UTF_8]
