                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                ;USE_RAM_BLOAD_S    EQU 1   ;先頭のコメントを外すとBLOAD,SでRAMを使う
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C36C4B          10      JP  DISKIO
000013 4013 C3A64B          10      JP  DSKCHG
000016 4016 C3FC4B          10      JP  GETDPB
000019 4019 C3EF4C          10      JP  CHOICE
00001C 401C C3F34C          10      JP  DSKFMT
00001F 401F C3F54C          10      JP  DSKSTP
000022 4022 C3F64C          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3F34C          10      JP  DSKFMT
000029 4029 C3F54C          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3FD4C          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.1.4.4",0
            204449534B20524F    
            4D204C6974652076    
            302E312E342E3400    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 224FF1          16      LD  (BASSTK),HL
000129 4129 ED7B4FF1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 323AF1          13      LD  (_DVSW),A
                                
00013B 413B 21F042          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 016C00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2110F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 210BF1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD3042          17      CALL    GTSL1_
000183 4183 32FCF0          13      LD  (ROM_SLT),A
000186 4186 3272FE          13      LD  (H_BINS+1),A
000189 4189 3277FE          13      LD  (H_BINL+1),A
00018C 418C 327CFE          13      LD  (H_FILE+1),A
00018F 418F 3232F3          13      LD  (H_BDOS+1),A
000192 4192 32DBFE          13      LD  (H_STKE+1),A
000195 4195 32A8FF          13      LD  (H_PHYD+1),A
000198 4198 3222FB          13      LD  (DRVTBL+1),A
00019B 419B 3248F3          13      LD  (MASTERS),A
                                
00019E 419E 218745          10      LD  HL,ROM_LOAD
0001A1 41A1 2273FE          16      LD  (H_BINS+2),HL
0001A4 41A4 21A246          10      LD  HL,ROM_RUN
0001A7 41A7 2278FE          16      LD  (H_BINL+2),HL
0001AA 41AA 21AF46          10      LD  HL,ROM_FILES
0001AD 41AD 227DFE          16      LD  (H_FILE+2),HL
0001B0 41B0 21494D          10      LD  HL,ROM_BDOS
0001B3 41B3 2233F3          16      LD  (H_BDOS+2),HL
0001B6 41B6 218643          10      LD  HL,ROM_STKE
0001B9 41B9 22DCFE          16      LD  (H_STKE+2),HL
0001BC 41BC 216C4B          10      LD  HL,DISKIO
0001BF 41BF 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C2 41C2 3E                      DB  03EH
0001C3 41C3 C9              10      RET
0001C4 41C4 327FFE          13      LD  (H_FILE+4),A
0001C7 41C7 3275FE          13      LD  (H_BINS+4),A
0001CA 41CA 327AFE          13      LD  (H_BINL+4),A
0001CD 41CD 3235F3          13      LD  (H_BDOS+4),A
0001D0 41D0 32DEFE          13      LD  (H_STKE+4),A
0001D3 41D3 32ABFF          13      LD  (H_PHYD+4),A
                                
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    XOR A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  A,(BANK1_ADR)
                                    CP  'A'
                                    JR  NZ,NOT_8K_BANK
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D6 41D6 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D9 41D9 07               4      RLCA
0001DA 41DA 07               4      RLCA
0001DB 41DB F5              11      PUSH    AF
0001DC 41DC 1605             7      LD  D,4+1
0001DE 41DE CD3742          17      CALL    GTSL2_
0001E1 41E1 3244F3          13      LD  (RAMAD3),A
0001E4 41E4 F1              10      POP AF
0001E5 41E5 07               4      RLCA
0001E6 41E6 07               4      RLCA
0001E7 41E7 1603             7      LD  D,2+1
0001E9 41E9 CD3742          17      CALL    GTSL2_
0001EC 41EC 2680             7      LD  H,080H
0001EE 41EE CD5442          17      CALL    CHK_RAM
0001F1 41F1 3243F3          13      LD  (RAMAD2),A
       41F4                     RAMCHK2:
0001F4 41F4 3A44F3          13      LD  A,(RAMAD3)
0001F7 41F7 2640             7      LD  H,040H
0001F9 41F9 CD5442          17      CALL    CHK_RAM
0001FC 41FC 3242F3          13      LD  (RAMAD1),A
       41FF                     RAMCHK1:
0001FF 41FF 3A44F3          13      LD  A,(RAMAD3)
000202 4202 2600             7      LD  H,00H
000204 4204 CD5442          17      CALL    CHK_RAM
000207 4207 3241F3          13      LD  (RAMAD0),A
       420A                     RAMCHK0:
00020A 420A 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
00020D 420D 010F00          10      LD  BC,0000FH       ;切り上げ
000210 4210 09              11      ADD HL,BC
000211 4211 7D               4      LD  A,L
                                
000212 4212 0604             7      LD  B,4
       4214                     B_DRIVE1:
000214 4214 CB3C             8      SRL H
000216 4216 1F               4      RRA
000217 4217 10FB            13      DJNZ    B_DRIVE1
                                
000219 4219 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
00021B 421B 3239F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
00021E 421E C9              10      RET
                                
       421F                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
00021F 421F 21D443          10      LD  HL,MSG_ERROR_ROM_MODE
000222 4222 CD5F43          17      CALL    MSX
000225 4225 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000229 4229 DD219F00        14      LD  IX,CHGET
00022D 422D C31C00          10      JP  _CALSLT
                                
       4230                     GTSL1_:             ;自分のいるスロットを知る
000230 4230 CD3801          17      CALL    RSLREG      ;read primary slot #
000233 4233 0F               4      RRCA
000234 4234 0F               4      RRCA
000235 4235 1601             7      LD  D,1
       4237                     GTSL2_:
000237 4237 E603             7      AND 3       ;[A]=000000PP
000239 4239 5F               4      LD  E,A     ;[E]=000000PP
00023A 423A 21C1FC          10      LD  HL,EXPTBL
00023D 423D 85               4      ADD A,L     ;桁上りは無い
00023E 423E 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00023F 423F 7B               4      LD  A,E     ;[A]=000000PP
000240 4240 CB7E            13      BIT 7,(HL)
000242 4242 C8              11      RET Z
000243 4243 7D               4      LD  A,L     ;point to SLTTBL entry
000244 4244 C604             7      ADD A,4     ;桁上りは無い
000246 4246 6F               4      LD  L,A
000247 4247 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4248                     GTSL3_:
000248 4248 15               4      DEC D
000249 4249 2803            12      JR  Z,GTSL4_:
00024B 424B 0F               4      RRCA
00024C 424C 18FA            12      JR  GTSL3_:
       424E                     GTSL4_:
00024E 424E E60C             7      AND 00CH        ;[A] = 0000SS00
000250 4250 B3               4      OR  E       ;[A] = 0000SSPP
000251 4251 F680             7      OR  080H        ;[A] = 1000SSPP
000253 4253 C9              10      RET
                                
       4254                     CHK_RAM:
000254 4254 E5              11      PUSH    HL
000255 4255 CDA942          17      CALL    CHK_RAM0
000258 4258 E1              10      POP HL
000259 4259 C8              11      RET Z
00025A 425A 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00025D 425D E680             7      AND 080H
00025F 425F CD8042          17      CALL    CHK_RAM_SLT
000262 4262 C8              11      RET Z
000263 4263 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000266 4266 E680             7      AND 080H
000268 4268 C601             7      ADD A,1
00026A 426A CD8042          17      CALL    CHK_RAM_SLT
00026D 426D C8              11      RET Z
00026E 426E 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000271 4271 E680             7      AND 080H
000273 4273 C602             7      ADD A,2
000275 4275 CD8042          17      CALL    CHK_RAM_SLT
000278 4278 C8              11      RET Z
000279 4279 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00027C 427C E680             7      AND 080H
00027E 427E C603             7      ADD A,3
       4280                     CHK_RAM_SLT:
000280 4280 E5              11      PUSH    HL
000281 4281 CDA942          17      CALL    CHK_RAM0        ;スロット#X or X-0
000284 4284 E1              10      POP HL
000285 4285 C8              11      RET Z
000286 4286 CB79             8      BIT 7,C
000288 4288 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00028A 428A 79               4      LD  A,C
00028B 428B C604             7      ADD A,4*1           ;スロット#X-1
00028D 428D E5              11      PUSH    HL
00028E 428E CDA942          17      CALL    CHK_RAM0
000291 4291 E1              10      POP HL
000292 4292 C8              11      RET Z
000293 4293 79               4      LD  A,C
000294 4294 C608             7      ADD A,4*2           ;スロット#X-2
000296 4296 E5              11      PUSH    HL
000297 4297 CDA942          17      CALL    CHK_RAM0
00029A 429A E1              10      POP HL
00029B 429B C8              11      RET Z
00029C 429C 79               4      LD  A,C
00029D 429D C60C             7      ADD A,4*3           ;スロット#X-3
00029F 429F E5              11      PUSH    HL
0002A0 42A0 CDA942          17      CALL    CHK_RAM0
0002A3 42A3 E1              10      POP HL
       42A4                     CHK_RAM_E:
0002A4 42A4 AF               4      XOR A
0002A5 42A5 3C               4      INC A           ;ZF=0にする
0002A6 42A6 3E00             7      LD  A,0
0002A8 42A8 C9              10      RET
                                
       42A9                     CHK_RAM0:
0002A9 42A9 4F               4      LD  C,A
0002AA 42AA 3AFCF0          13      LD  A,(ROM_SLT)
0002AD 42AD B9               4      CP  C
0002AE 42AE 28F4            12      JR  Z,CHK_RAM_E
0002B0 42B0 2E00             7      LD  L,0
       42B2                     CHK_RAM1:
0002B2 42B2 79               4      LD  A,C
0002B3 42B3 DD210C00        14      LD  IX,_RDSLT
0002B7 42B7 CDE442          17      CALL    CALSLT_R
0002BA 42BA C6E5             7      ADD A,0E5H
0002BC 42BC 47               4      LD  B,A
0002BD 42BD 5F               4      LD  E,A
0002BE 42BE 79               4      LD  A,C
0002BF 42BF DD211400        14      LD  IX,_WRSLT
0002C3 42C3 CDE442          17      CALL    CALSLT_R
0002C6 42C6 79               4      LD  A,C
0002C7 42C7 DD210C00        14      LD  IX,_RDSLT
0002CB 42CB CDE442          17      CALL    CALSLT_R
0002CE 42CE B8               4      CP  B
0002CF 42CF C0              11      RET NZ
0002D0 42D0 D6E5             7      SUB 0E5H
0002D2 42D2 79               4      LD  A,C
0002D3 42D3 5F               4      LD  E,A
0002D4 42D4 DD211400        14      LD  IX,_WRSLT
0002D8 42D8 CDE442          17      CALL    CALSLT_R
0002DB 42DB 24               4      INC H
0002DC 42DC 7D               4      LD  A,L
0002DD 42DD C604             7      ADD A,4
0002DF 42DF 6F               4      LD  L,A
0002E0 42E0 20D0            12      JR  NZ,CHK_RAM1
0002E2 42E2 79               4      LD  A,C     ;ZF=1のハズ
0002E3 42E3 C9              10      RET
                                
       42E4                     CALSLT_R:
0002E4 42E4 C5              11      PUSH    BC
0002E5 42E5 E5              11      PUSH    HL
0002E6 42E6 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002EA 42EA CD1C00          17      CALL    _CALSLT
0002ED 42ED E1              10      POP HL
0002EE 42EE C1              10      POP BC
0002EF 42EF C9              10      RET
                                
       42F0                     AT_ISC:
0002F0 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
0002F0 F0E9 FEB7             7      CP  0B7H            ;FILES
0002F2 F0EB CC7BFE          17      CALL    Z,H_FILE
0002F5 F0EE FEB5             7      CP  0B5H            ;LOAD
0002F7 F0F0 CA71FE          10      JP  Z,H_BINS
0002FA F0F3 FE8A             7      CP  08AH            ;RUN
0002FC F0F5 CA76FE          10      JP  Z,H_BINL
0002FF F0F8 FECF             7      CP  0CFH            ;BLOAD
000301 F0FA C0              11      RET NZ
       F0FB                     FIX_BLOAD:
000302 F0FB F7              12      RST 30H
       F0FC                     ROM_SLT:
000303 F0FC 00                      DB  0
000304 F0FD E445                    DW  ROM_BLOAD
000306 F0FF F5              11      PUSH    AF
000307 F100 E5              11      PUSH    HL
000308 F101 CD0AF1          17      CALL    BLOAD_RET
       F102                     SWC_BLOAD   EQU $-2
00030B F104 E1              10      POP HL
00030C F105 F1              10      POP AF
00030D F106 FECF             7      CP  0CFH            ;BLOAD
       F108                     SWC_BLOAD_M:
00030F F108 28DF            12      JR  Z,REPLACE_COMMAND
       F10A                     BLOAD_RET:
000311 F10A C9              10      RET
       F10B                     ROMUSE1:
000312 F10B 3AFCF0          13      LD  A,(ROM_SLT)
000315 F10E 1803            12      JR  ROMUSE2
       F110                     RAMUSE1:
000317 F110 3A42F3          13      LD  A,(RAMAD1)
       F113                     ROMUSE2:
00031A F113 C32400          10      JP  _ENASLT
                                
       F116                     _RESULT:
00031D F116 00                      DB  0
       F117                     _BANK:
00031E F117 00                      DB  0
       F118                     CLSZ:               ;クラスタサイズ
00031F F118 0004                    DW  1024
       F119                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F11A                     SECSZ:              ;セクタサイズ
000321 F11A 0002                    DW  512
       F11B                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F11C                     RR_LOW:
000323 F11C 0000                    DW  0
       F11D                     RR_MID  EQU $-1
       F11E                     RR_HIGH:
000325 F11E 0000                    DW  0
       F120                     _CLPS:
000327 F120 0000                    DW  0
       F122                     _LEFT:
000329 F122 0000                    DW  0
       F124                     _DTPS:
00032B F124 0000                    DW  0
       F126                     _DTA:
00032D F126 0000                    DW  0
                                #if exists USE_RAM_BLOAD_S
                                #else
       F128                     FLG_LDIR:
00032F F128 00                      DB  0
                                #endif
                                ;   BDOS
000330 F129 F7              12      RST 30H
000331 F12A 00                      DB  0
000332 F12B 494D                    DW  ROM_BDOS
000334 F12D C9              10      RET 
       F12E                     _FCB:
000335 F12E 0000                    DW  0
       F130                     _BUF:
000337 F130 00                      DB  0
       F131                     _BUF_ST:
000338 F131 0000                    DW  0
       F133                     _BUF_EN:
00033A F133 0000                    DW  0
       F135                     _BUF_EX:
00033C F135 0000                    DW  0
                                
       F137                     DTAX:
00033E F137 0000                    DW  0
       F139                     B_DRIVE:
000340 F139 00                      DB  0
       F13A                     _DVSW:
000341 F13A 00                      DB  0
       F13B                     FCBX:
000342 F13B 0000                    DW  0
       F13D                     LEFTX:
000344 F13D 0000                    DW  0
       F13F                     PARAM0:
000346 F13F 0000                    DW  0
       F141                     PARAM1:
000348 F141 0000                    DW  0
       F143                     FDRV:
00034A F143 00                      DB  0
       F144                     FNAME:
00034B F144                         DS  8+3
                                
       F14F                     BASSTK:
000356 F14F 0000                    DW  0
       F151                     _HL:
000358 F151 0000                    DW  0
       F153                     _SP:
00035A F153 0000                    DW  0
                                
       F155                     ISC_E:
00035C 435C                         ORG $$+RUN          ;$DEPHASE
                                
       435C                     MSX1:
00035C 435C CD624D          17      CALL    MSGA1
       435F                     MSX:
00035F 435F 7E               7      LD  A,(HL)
000360 4360 23               6      INC HL
000361 4361 B7               4      OR  A
000362 4362 20F8            12      JR  NZ,MSX1
000364 4364 C9              10      RET
                                
       4365                     PRTHX:
000365 4365 F5              11      PUSH    AF
000366 4366 07               4      RLCA
000367 4367 07               4      RLCA
000368 4368 07               4      RLCA
000369 4369 07               4      RLCA
00036A 436A CD6E43          17      CALL    PRTA2
00036D 436D F1              10      POP AF
       436E                     PRTA2:
00036E 436E CD7443          17      CALL    ASC
000371 4371 C35E4D          10      JP  MSG_A
                                    
       4374                     ASC:
000374 4374 E60F             7      AND $0F
000376 4376 F630             7      OR  $30
000378 4378 FE3A             7      CP  $3A
00037A 437A D8              11      RET C
00037B 437B C607             7      ADD A,7
00037D 437D C9              10      RET
                                
       437E                     MSN:
00037E 437E 7E               7      LD  A,(HL)
00037F 437F 23               6      INC HL
000380 4380 CD5E4D          17      CALL    MSG_A
000383 4383 10F9            13      DJNZ    MSN
000385 4385 C9              10      RET
                                
       4386                     ROM_STKE:
000386 4386 3E                      DB  03EH
000387 4387 C9              10      RET
000388 4388 32DAFE          13      LD  (H_STKE),A
00038B 438B E5              11      PUSH    HL
00038C 438C D5              11      PUSH    DE
00038D 438D C5              11      PUSH    BC
00038E 438E 181D            12      JR  BASAUTO
                                
000390 4390 AF               4      XOR A
000391 4391 5F               4      LD  E,A
000392 4392 57               4      LD  D,A
000393 4393 0601             7      LD  B,1
000395 4395 2100C0          10      LD  HL,0C000H
000398 4398 CD6C4B          17      CALL    DISKIO
                                
00039B 439B ED734FF1        20      LD  (BASSTK),SP
00039F 439F 116BF3          10      LD  DE,RAMUSE
0003A2 43A2 AF               4      XOR A
0003A3 43A3 CD1EC0          17      CALL    0C01EH
0003A6 43A6 116BF3          10      LD  DE,RAMUSE
0003A9 43A9 37               4      SCF
0003AA 43AA CD1EC0          17      CALL    0C01EH
       43AD                     BASAUTO:
0003AD 43AD 21FA43          10      LD  HL,AUTOEXEC
0003B0 43B0 1143F1          10      LD  DE,FDRV
0003B3 43B3 010C00          10      LD  BC,1+8+3
0003B6 43B6 EDB0                    LDIR
0003B8 43B8 CD1049          17      CALL    ROM_OPEN
0003BB 43BB 3813            12      JR  C,RSTKEE
0003BD 43BD 210644          10      LD  HL,RUN_AUTOEXEC
0003C0 43C0 11F0FB          10      LD  DE,KEYBUF
0003C3 43C3 ED53FAF3        20      LD  (GETPNT),DE
0003C7 43C7 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003CA 43CA EDB0                    LDIR
0003CC 43CC ED53F8F3        20      LD  (PUTPNT),DE
       43D0                     RSTKEE:
0003D0 43D0 C1              10      POP BC
0003D1 43D1 D1              10      POP DE
0003D2 43D2 E1              10      POP HL
0003D3 43D3 C9              10      RET
                                
       43D4                     MSG_ERROR_ROM_MODE:
0003D4 43D4 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
       43F9                     NULL:
0003F9 43F9 00                      DB  0
                                
       43FA                     AUTOEXEC:
0003FA 43FA 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4406                     RUN_AUTOEXEC:
000406 4406 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4419                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4419                     ROM_LDIR:
                                #if exists USE_RAM_BLOAD_S
                                #else
000419 4419 3A28F1          13      LD  A,(FLG_LDIR)
00041C 441C B7               4      OR  A
00041D 441D 2062            12      JR  NZ,ROM_LDIRVM
                                #endif
00041F 441F CB7A             8      BIT 7,D
000421 4421 CAA944          10      JP  Z,ROM_LDIRSLT
                                
                                #if exists USE_NORMAL_32K_ROM
000424 4424 ED7353F1        20      LD  (_SP),SP
000428 4428 3121FB          10      LD  SP,DRVTBL
       442B                     LDIR1:
00042B 442B 78               4      LD  A,B
00042C 442C B1               4      OR  C
00042D 442D 2841            12      JR  Z,LDIRE
                                
00042F 442F C5              11      PUSH    BC
000430 4430 D5              11      PUSH    DE
000431 4431 E5              11      PUSH    HL
000432 4432 3AFCF0          13      LD  A,(ROM_SLT)
000435 4435 2680             7      LD  H,080H
000437 4437 CD2400          17      CALL    _ENASLT
00043A 443A E1              10      POP HL
00043B 443B D1              10      POP DE
00043C 443C C1              10      POP BC
       443D                     LDIR2:
00043D 443D 7A               4      LD  A,D
00043E 443E FEC0             7      CP  0C0H
000440 4440 302C            12      JR  NC,LDIR4
                                
000442 4442 C5              11      PUSH    BC
000443 4443 D5              11      PUSH    DE
000444 4444 115EF5          10      LD  DE,BUF
                                
000447 4447 78               4      LD  A,B
000448 4448 B7               4      OR  A
000449 4449 2803            12      JR  Z,LDIR3
00044B 444B 010001          10      LD  BC,00100H
       444E                     LDIR3:
00044E 444E C5              11      PUSH    BC
00044F 444F EDB0                    LDIR
000451 4451 2251F1          16      LD  (_HL),HL
                                
000454 4454 3A43F3          13      LD  A,(RAMAD2)
000457 4457 2680             7      LD  H,080H
000459 4459 CD2400          17      CALL    _ENASLT
                                
00045C 445C 215EF5          10      LD  HL,BUF
00045F 445F C1              10      POP BC
000460 4460 D1              10      POP DE
000461 4461 EDB0                    LDIR
                                
000463 4463 2A51F1          16      LD  HL,(_HL)
000466 4466 C1              10      POP BC
000467 4467 78               4      LD  A,B
000468 4468 B7               4      OR  A
000469 4469 2805            12      JR  Z,LDIRE
00046B 446B 05               4      DEC B
00046C 446C 18BD            12      JR  LDIR1
       446E                     LDIR4:
                                #endif
00046E 446E EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       4470                     LDIRE:
000470 4470 D5              11      PUSH    DE
000471 4471 E5              11      PUSH    HL
000472 4472 3A43F3          13      LD  A,(RAMAD2)
000475 4475 2680             7      LD  H,080H
000477 4477 CD2400          17      CALL    _ENASLT
00047A 447A E1              10      POP HL
00047B 447B D1              10      POP DE
00047C 447C ED7B53F1        20      LD  SP,(_SP)
                                #endif
000480 4480 C9              10      RET
                                
       4481                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
000481 4481 C5              11      PUSH    BC
000482 4482 D5              11      PUSH    DE
000483 4483 E5              11      PUSH    HL
000484 4484 3AFCF0          13      LD  A,(ROM_SLT)
000487 4487 2680             7      LD  H,080H
000489 4489 CD2400          17      CALL    _ENASLT
00048C 448C E1              10      POP HL
00048D 448D D1              10      POP DE
00048E 448E C1              10      POP BC
                                #endif
00048F 448F C5              11      PUSH    BC
000490 4490 D5              11      PUSH    DE
000491 4491 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000495 4495 DD215C00        14      LD  IX,LDIRVM
000499 4499 CD1C00          17      CALL    _CALSLT
                                #if exists USE_NORMAL_32K_ROM
00049C 449C 2680             7      LD  H,080H
00049E 449E 3A43F3          13      LD  A,(RAMAD2)
0004A1 44A1 CD2400          17      CALL    _ENASLT
                                #endif
0004A4 44A4 E1              10      POP HL
0004A5 44A5 C1              10      POP BC
0004A6 44A6 09              11      ADD HL,BC
0004A7 44A7 EB               4      EX  DE,HL
0004A8 44A8 C9              10      RET
                                
       44A9                     ROM_LDIRSLT:
0004A9 44A9 EB               4      EX  DE,HL
       44AA                     RLDIRSLT1:
0004AA 44AA 1A               7      LD  A,(DE)
0004AB 44AB 13               6      INC DE
0004AC 44AC C5              11      PUSH    BC
0004AD 44AD D5              11      PUSH    DE
0004AE 44AE E5              11      PUSH    HL
0004AF 44AF 5F               4      LD  E,A
0004B0 44B0 3A42F3          13      LD  A,(RAMAD1)
0004B3 44B3 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004B7 44B7 DD211400        14      LD  IX,_WRSLT
0004BB 44BB CD1C00          17      CALL    _CALSLT
0004BE 44BE E1              10      POP HL
0004BF 44BF D1              10      POP DE
0004C0 44C0 C1              10      POP BC
0004C1 44C1 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004C3 44C3 EAAA44          10      JP  PE,RLDIRSLT1
0004C6 44C6 EB               4      EX  DE,HL
0004C7 44C7 C9              10      RET
                                
       44C8                     END_OF_LINE:
0004C8 44C8 215EF5          10      LD  HL,BUF
       44CB                     EOL1:
0004CB 44CB 7E               7      LD  A,(HL)
0004CC 44CC C8              11      RET Z
0004CD 44CD FE0D             7      CP  00DH
0004CF 44CF 2807            12      JR  Z,EOLE
0004D1 44D1 FE0A             7      CP  00AH
0004D3 44D3 2803            12      JR  Z,EOLE
0004D5 44D5 23               6      INC HL
0004D6 44D6 18F3            12      JR  EOL1
       44D8                     EOLE:
0004D8 44D8 3600            10      LD  (HL),0
0004DA 44DA 23               6      INC HL
0004DB 44DB 7E               7      LD  A,(HL)
0004DC 44DC FE0A             7      CP  00AH
0004DE 44DE C0              11      RET NZ
0004DF 44DF 23               6      INC HL
0004E0 44E0 C9              10      RET
                                
       44E1                     ROM_LOAD_ASCII:
0004E1 44E1 210000          10      LD  HL,0
0004E4 44E4 2231F1          16      LD  (_BUF_ST),HL    ;読み出し位置
0004E7 44E7 2A76F6          16      LD  HL,(TXTTAB)
0004EA 44EA 2233F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
0004ED 44ED 215EF5          10      LD  HL,BUF
0004F0 44F0 2226F1          16      LD  (_DTA),HL
       44F3                     RLOAD_A1:
0004F3 44F3 2A31F1          16      LD  HL,(_BUF_ST)
0004F6 44F6 221CF1          16      LD  (RR_LOW),HL
0004F9 44F9 210201          10      LD  HL,258
0004FC 44FC CD3047          17      CALL    ROM_READ
0004FF 44FF 7C               4      LD  A,H
000500 4500 B5               4      OR  L
000501 4501 2877            12      JR  Z,RLOAD_AEND
000503 4503 015EF5          10      LD  BC,BUF
000506 4506 09              11      ADD HL,BC
000507 4507 3600            10      LD  (HL),0
000509 4509 CDC844          17      CALL    END_OF_LINE
00050C 450C 015EF5          10      LD  BC,BUF
00050F 450F A7               4      AND A
000510 4510 ED42            15      SBC HL,BC
000512 4512 2810            12      JR  Z,RLOAD_A2
000514 4514 4D               4      LD  C,L
000515 4515 44               4      LD  B,H
000516 4516 ED5B31F1        20      LD  DE,(_BUF_ST)
00051A 451A 19              11      ADD HL,DE
00051B 451B 2231F1          16      LD  (_BUF_ST),HL
00051E 451E 3A5EF5          13      LD  A,(BUF)
000521 4521 B7               4      OR  A
000522 4522 28CF            12      JR  Z,RLOAD_A1
       4524                     RLOAD_A2:
000524 4524 115EF5          10      LD  DE,BUF
000527 4527 CDA748          17      CALL    SPCUTEX
00052A 452A 1A               7      LD  A,(DE)
00052B 452B B7               4      OR  A
00052C 452C 284C            12      JR  Z,RLOAD_AEND
00052E 452E CDB948          17      CALL    GETNUM
000531 4531 7C               4      LD  A,H
000532 4532 B5               4      OR  L
000533 4533 CAD145          10      JP  Z,ERROR_DIRECT_IN_FILE
000536 4536 DD2A33F1        20      LD  IX,(_BUF_EN)
00053A 453A DD7502          19      LD  (IX+2),L
00053D 453D DD7403          19      LD  (IX+3),H
                                
000540 4540 CDA048          17      CALL    SPCUT
000543 4543 EB               4      EX  DE,HL
000544 4544 DDE5            15      PUSH    IX
000546 4546 DD21B242        14      LD  IX,CRUNCH
00054A 454A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00054E 454E CD1C00          17      CALL    _CALSLT
000551 4551 DDE1            14      POP IX
000553 4553 EB               4      EX  DE,HL
000554 4554 111FF4          10      LD  DE,KBUF
000557 4557 37               4      SCF
000558 4558 ED52            15      SBC HL,DE
00055A 455A 2875            12      JR  Z,ERROR_DIRECT_IN_FILE
00055C 455C 3873            12      JR  C,ERROR_DIRECT_IN_FILE
00055E 455E 4D               4      LD  C,L
00055F 455F 44               4      LD  B,H
000560 4560 2A33F1          16      LD  HL,(_BUF_EN)
000563 4563 110400          10      LD  DE,4
000566 4566 19              11      ADD HL,DE
000567 4567 111FF4          10      LD  DE,KBUF
                                
00056A 456A EB               4      EX  DE,HL
00056B 456B EDB0                    LDIR
00056D 456D EB               4      EX  DE,HL
                                
00056E 456E DD7500          19      LD  (IX+0),L
000571 4571 DD7401          19      LD  (IX+1),H
000574 4574 2233F1          16      LD  (_BUF_EN),HL
000577 4577 C3F344          10      JP  RLOAD_A1
                                
       457A                     RLOAD_AEND:
00057A 457A 2A33F1          16      LD  HL,(_BUF_EN)
00057D 457D AF               4      XOR A
00057E 457E 77               7      LD  (HL),A
00057F 457F 23               6      INC HL
000580 4580 77               7      LD  (HL),A
000581 4581 23               6      INC HL
000582 4582 2233F1          16      LD  (_BUF_EN),HL
000585 4585 1833            12      JR  RLOAD_END1
                                
       4587                     ROM_LOAD:
000587 4587 CD0547          17      CALL    INIT_PARAM
00058A 458A CDD047          17      CALL    FILE_B
00058D 458D CD1049          17      CALL    ROM_OPEN
000590 4590 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000592 4592 2130F1          10      LD  HL,_BUF
000595 4595 2226F1          16      LD  (_DTA),HL
000598 4598 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
00059B 459B CD3047          17      CALL    ROM_READ
00059E 459E 3A30F1          13      LD  A,(_BUF)
0005A1 45A1 3C               4      INC A
0005A2 45A2 C2E144          10      JP  NZ,ROM_LOAD_ASCII
0005A5 45A5 2A76F6          16      LD  HL,(TXTTAB)
0005A8 45A8 2226F1          16      LD  (_DTA),HL
0005AB 45AB EB               4      EX  DE,HL
0005AC 45AC 2100FF          10      LD  HL,-256
0005AF 45AF 39              11      ADD HL,SP
0005B0 45B0 ED52            15      SBC HL,DE
0005B2 45B2 CD3047          17      CALL    ROM_READ
0005B5 45B5 ED5B26F1        20      LD  DE,(_DTA)
0005B9 45B9 19              11      ADD HL,DE
       45BA                     RLOAD_END1:
0005BA 45BA 22C2F6          16      LD  (VARTAB),HL
0005BD 45BD 22C4F6          16      LD  (ARYTAB),HL
0005C0 45C0 22C6F6          16      LD  (STREND),HL
                                
0005C3 45C3 AF               4      XOR A
0005C4 45C4 2133F1          10      LD  HL,_BUF+3
0005C7 45C7 77               7      LD  (HL),A
0005C8 45C8 2B               6      DEC HL
0005C9 45C9 77               7      LD  (HL),A
0005CA 45CA 2B               6      DEC HL
0005CB 45CB 77               7      LD  (HL),A
0005CC 45CC 2B               6      DEC HL
0005CD 45CD 3E8F             7      LD  A,08FH          ;REM
0005CF 45CF 77               7      LD  (HL),A
0005D0 45D0 C9              10      RET
                                
       45D1                     ERROR_DIRECT_IN_FILE:
0005D1 45D1 1E39             7      LD  E,57            ;Direct statement in file
0005D3 45D3 01                      DB  1           ;LD BC,
       45D4                     ERROR_FILE_NOT_OPEN:
0005D4 45D4 1E3B             7      LD  E,59            ;File not OPEN
0005D6 45D6 01                      DB  1           ;LD BC,
       45D7                     ERROR_FILE_NOT_FOUND:
0005D7 45D7 1E35             7      LD  E,53            ;File not found
       45D9                     ERROR:
0005D9 45D9 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005DD 45DD DD216F40        14      LD  IX,ERRHAND
0005E1 45E1 C31C00          10      JP  _CALSLT
                                
       45E4                     ROM_BLOAD:
0005E4 45E4 CD0547          17      CALL    INIT_PARAM
0005E7 45E7 CDD047          17      CALL    FILE_B
0005EA 45EA CD1049          17      CALL    ROM_OPEN
0005ED 45ED 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005EF 45EF 2130F1          10      LD  HL,_BUF
0005F2 45F2 2226F1          16      LD  (_DTA),HL
0005F5 45F5 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005F8 45F8 CD3047          17      CALL    ROM_READ
0005FB 45FB 3A30F1          13      LD  A,(_BUF)
0005FE 45FE FEFE             7      CP  0FEH
000600 4600 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
000602 4602 210AF1          10      LD  HL,BLOAD_RET
000605 4605 2202F1          16      LD  (SWC_BLOAD),HL
                                
000608 4608 2A41F1          16      LD  HL,(PARAM1)
00060B 460B 7E               7      LD  A,(HL)
00060C 460C FE2C             7      CP  ','
00060E 460E 2048            12      JR  NZ,RBREAD_MEM
000610 4610 23               6      INC HL
000611 4611 7E               7      LD  A,(HL)
000612 4612 CDFA48          17      CALL    CAP
000615 4615 32BEFC          13      LD  (RUNBNF),A
       4618                     RBOS1:
000618 4618 7E               7      LD  A,(HL)
000619 4619 23               6      INC HL
00061A 461A B7               4      OR  A
00061B 461B 282F            12      JR  Z,RBREAD_OSE
00061D 461D FE3A             7      CP  ':'
00061F 461F 282B            12      JR  Z,RBREAD_OSE
000621 4621 FE2C             7      CP  ','     ;次のパラメータを探す
000623 4623 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000625 4625 2241F1          16      LD  (PARAM1),HL
000628 4628 7E               7      LD  A,(HL)
000629 4629 B7               4      OR  A
00062A 462A 2820            12      JR  Z,RBREAD_OSE
00062C 462C DD21644C        14      LD  IX,FRMEVL
000630 4630 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000634 4634 CD1C00          17      CALL    _CALSLT
000637 4637 2241F1          16      LD  (PARAM1),HL
00063A 463A 3A63F6          13      LD  A,(VALTYP)
00063D 463D FE02             7      CP  2
00063F 463F 200B            12      JR  NZ,RBREAD_OSE
000641 4641 2A31F1          16      LD  HL,(_BUF_ST)
000644 4644 ED5BF8F7        20      LD  DE,(DACDAT)
000648 4648 19              11      ADD HL,DE
000649 4649 2231F1          16      LD  (_BUF_ST),HL
       464C                     RBREAD_OSE:
00064C 464C 3ABEFC          13      LD  A,(RUNBNF)
00064F 464F FE53             7      CP  'S'
                                #if exists USE_RAM_BLOAD_S
                                    JR  Z,ROM_BLOAD_SCREEN
                                #else
000651 4651 2005            12      JR  NZ,RBREAD_MEM
000653 4653 3E01             7      LD  A,1
000655 4655 3228F1          13      LD  (FLG_LDIR),A
                                #endif
       4658                     RBREAD_MEM:
000658 4658 2A31F1          16      LD  HL,(_BUF_ST)
00065B 465B 22BFFC          16      LD  (SAVENT),HL
00065E 465E 2226F1          16      LD  (_DTA),HL
000661 4661 21FFFF          10      LD  HL,0FFFFH
000664 4664 CD3047          17      CALL    ROM_READ
000667 4667 3ABEFC          13      LD  A,(RUNBNF)
00066A 466A FE52             7      CP  'R'
00066C 466C 2006            12      JR  NZ,RBREAD1
00066E 466E 2A35F1          16      LD  HL,(_BUF_EX)
000671 4671 2202F1          16      LD  (SWC_BLOAD),HL
       4674                     RBREAD1:
       4674                     ROM_NEXT:
000674 4674 2A41F1          16      LD  HL,(PARAM1)
000677 4677 7E               7      LD  A,(HL)
000678 4678 2B               6      DEC HL
000679 4679 B7               4      OR  A
00067A 467A 2805            12      JR  Z,RN1
00067C 467C FE3A             7      CP  ':'
00067E 467E 2801            12      JR  Z,RN1
000680 4680 23               6      INC HL
       4681                     RN1:
000681 4681 5D               4      LD  E,L
000682 4682 54               4      LD  D,H
                                
000683 4683 CDD048          17      CALL    SEARCH_END
000686 4686 B7               4      OR  A
000687 4687 2815            12      JR  Z,REM
                                                    ;マルチステートメントの処理
000689 4689 7E               7      LD  A,(HL)
                                
00068A 468A FEB5             7      CP  0B5H            ;LOAD
00068C 468C CA8745          10      JP  Z,ROM_LOAD
00068F 468F FE8A             7      CP  08AH            ;RUN
000691 4691 280F            12      JR  Z,ROM_RUN
000693 4693 FEB7             7      CP  0B7H            ;FILES
000695 4695 2818            12      JR  Z,ROM_FILES
000697 4697 3E28             7      LD  A,028H          ;JR Z,
000699 4699 3208F1          13      LD  (SWC_BLOAD_M),A
00069C 469C 7E               7      LD  A,(HL)
00069D 469D C9              10      RET
                                
       469E                     REM:
00069E 469E EB               4      EX  DE,HL
00069F 469F 3E8F             7      LD  A,08FH          ;REM
0006A1 46A1 C9              10      RET
                                
                                #if exists USE_RAM_BLOAD_S
                                ROM_BLOAD_SCREEN:
                                    LD  HL,(STREND)
                                    LD  (_DTA),HL
                                    EX  DE,HL
                                    LD  HL,-512
                                    ADD HL,SP
                                    XOR A
                                    SBC HL,DE
                                    JR  NC,RBS0
                                    LD  HL,BUF
                                    LD  (_DTA),HL
                                    LD  L,A ;0
                                    LD  H,A ;0
                                RBS0:
                                    INC H
                                    LD  (_BUF_EN),HL
                                RBS1:
                                    LD  HL,(_BUF_EN)
                                    CALL    ROM_READ
                                    LD  A,H
                                    OR  L
                                    JR  Z,ROM_NEXT
                                
                                    PUSH    HL
                                    LD  C,L
                                    LD  B,H
                                    LD  HL,(_DTA)   ;転送元
                                    LD  DE,(_BUF_ST)    ;転送先
                                
                                    LD  IY,(EXPTBL-1)   ;メインROMスロット
                                    LD  IX,LDIRVM
                                    CALL    _CALSLT
                                
                                    LD  HL,(_BUF_ST)
                                    POP DE
                                    ADD HL,DE
                                    LD  (_BUF_ST),HL
                                    JR  RBS1
                                #endif
                                
       46A2                     ROM_RUN:
0006A2 46A2 23               6      INC HL
0006A3 46A3 7E               7      LD  A,(HL)
0006A4 46A4 2B               6      DEC HL
0006A5 46A5 B7               4      OR  A
0006A6 46A6 2803            12      JR  Z,ROM_RUN1
0006A8 46A8 CD8745          17      CALL    ROM_LOAD
       46AB                     ROM_RUN1:
0006AB 46AB 3E8A             7      LD  A,08AH          ;RUN
0006AD 46AD 77               7      LD  (HL),A
0006AE 46AE C9              10      RET
                                
       46AF                     ROM_FILES:
0006AF 46AF CD0547          17      CALL    INIT_PARAM
0006B2 46B2 CDD047          17      CALL    FILE_B
0006B5 46B5 CD014D          17      CALL    GET_DISK_BANK_FDRV
0006B8 46B8 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0006BB 46BB 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0006BE 46BE 3A44F1          13      LD  A,(FNAME)
0006C1 46C1 FE21             7      CP  021H
0006C3 46C3 3005            12      JR  NC,RFILES0
0006C5 46C5 060B             7      LD  B,11
0006C7 46C7 CD6448          17      CALL    FILE10
       46CA                     RFILES0:
0006CA 46CA CD2D4B          17      CALL    GET_DIR_DAT
       46CD                     RFILES1:
0006CD 46CD CD2C49          17      CALL    FILESE
0006D0 46D0 302E            12      JR  NC,RFILES_NOT_MATCH
       46D2                     RFILES_DISP:
0006D2 46D2 E5              11      PUSH    HL
0006D3 46D3 0608             7      LD  B,8
0006D5 46D5 CD7E43          17      CALL    MSN
0006D8 46D8 3E2E             7      LD  A,'.'
0006DA 46DA CD5E4D          17      CALL    MSG_A
0006DD 46DD 0603             7      LD  B,3
0006DF 46DF CD7E43          17      CALL    MSN
0006E2 46E2 3ADDF3          13      LD  A,(CSRX)
0006E5 46E5 47               4      LD  B,A
0006E6 46E6 3AB0F3          13      LD  A,(LINLEN)
0006E9 46E9 90               4      SUB B
0006EA 46EA FE0C             7      CP  12
0006EC 46EC 3009            12      JR  NC,RFILES2
0006EE 46EE 3E0D             7      LD  A,00DH      ;改行
0006F0 46F0 CD5E4D          17      CALL    MSG_A
0006F3 46F3 3E0A             7      LD  A,00AH
0006F5 46F5 1802            12      JR  RFILES3
       46F7                     RFILES2:
0006F7 46F7 3E20             7      LD  A,020H
       46F9                     RFILES3:
0006F9 46F9 CD5E4D          17      CALL    MSG_A
0006FC 46FC E1              10      POP HL
0006FD 46FD CD4849          17      CALL    FNEXT
       4700                     RFILES_NOT_MATCH:
000700 4700 20CB            12      JR  NZ,RFILES1
000702 4702 C37446          10      JP  ROM_NEXT
                                
       4705                     INIT_PARAM:
000705 4705 223FF1          16      LD  (PARAM0),HL
000708 4708 2241F1          16      LD  (PARAM1),HL
00070B 470B EB               4      EX  DE,HL
00070C 470C AF               4      XOR A
                                #if exists USE_RAM_BLOAD_S
                                #else
00070D 470D 3228F1          13      LD  (FLG_LDIR),A
                                #endif
000710 4710 32BEFC          13      LD  (RUNBNF),A
000713 4713 3263F6          13      LD  (VALTYP),A
000716 4716 13               6      INC DE
000717 4717 CDA048          17      CALL    SPCUT
00071A 471A 1A               7      LD  A,(DE)
00071B 471B B7               4      OR  A
00071C 471C C8              11      RET Z
00071D 471D FE3A             7      CP  ':'
00071F 471F C8              11      RET Z
000720 4720 EB               4      EX  DE,HL
000721 4721 DD21644C        14      LD  IX,FRMEVL
000725 4725 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000729 4729 CD1C00          17      CALL    _CALSLT
00072C 472C 2241F1          16      LD  (PARAM1),HL
00072F 472F C9              10      RET
                                
       4730                     ROM_READ:
000730 4730 E5              11      PUSH    HL
000731 4731 D5              11      PUSH    DE
000732 4732 C5              11      PUSH    BC
000733 4733 FDE5            15      PUSH    IY
000735 4735 223DF1          16      LD  (LEFTX),HL
000738 4738 2A26F1          16      LD  HL,(_DTA)
00073B 473B 2237F1          16      LD  (DTAX),HL
00073E 473E 2A3DF1          16      LD  HL,(LEFTX)
                                
000741 4741 CD7449          17      CALL    RBX1
000744 4744 3870            12      JR  C,RBRERR1
000746 4746 79               4      LD  A,C
000747 4747 EB               4      EX  DE,HL
000748 4748 ED52            15      SBC HL,DE       ;CP 0HL,CDE
00074A 474A 19              11      ADD HL,DE
00074B 474B DE00             7      SBC A,000H
00074D 474D 3801            12      JR  C,RBR1
00074F 474F EB               4      EX  DE,HL
       4750                     RBR1:
000750 4750 9F               4      SBC A,A
000751 4751 E601             7      AND 1
000753 4753 3216F1          13      LD  (_RESULT),A
000756 4756 7C               4      LD  A,H
000757 4757 B5               4      OR  L
000758 4758 CAAC47          10      JP  Z,RBREND0
                                
00075B 475B 2222F1          16      LD  (_LEFT),HL  ;Read record byte
00075E 475E 223DF1          16      LD  (LEFTX),HL
                                
000761 4761 CD9A49          17      CALL    RBX2
000764 4764 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000766 4766 CDAD49          17      CALL    RBXA
000769 4769 DAC247          10      JP  C,RBRERR
00076C 476C C5              11      PUSH    BC
00076D 476D CD1944          17      CALL    ROM_LDIR
000770 4770 ED5337F1        20      LD  (DTAX),DE
000774 4774 2A3DF1          16      LD  HL,(LEFTX)
000777 4777 D1              10      POP DE
000778 4778 A7               4      AND A
000779 4779 ED52            15      SBC HL,DE
00077B 477B 223DF1          16      LD  (LEFTX),HL
00077E 477E 2829            12      JR  Z,RBREND
                                
       4780                     RBRB:
000780 4780 CDE949          17      CALL    RBXB
000783 4783 2818            12      JR  Z,RBRC
       4785                     RBRB1:
000785 4785 C5              11      PUSH    BC
000786 4786 D5              11      PUSH    DE
000787 4787 CD914A          17      CALL    CLUST
00078A 478A EB               4      EX  DE,HL
00078B 478B ED4B18F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
00078F 478F CD1944          17      CALL    ROM_LDIR
000792 4792 EB               4      EX  DE,HL
000793 4793 D1              10      POP DE
000794 4794 C1              10      POP BC
000795 4795 CD6E4A          17      CALL    GNCL
000798 4798 DAC247          10      JP  C,RBRERR
00079B 479B 10E8            13      DJNZ    RBRB1
       479D                     RBRC:
00079D 479D CD014A          17      CALL    RBXC
0007A0 47A0 2807            12      JR  Z,RBREND
                                
0007A2 47A2 CD914A          17      CALL    CLUST
0007A5 47A5 EB               4      EX  DE,HL
0007A6 47A6 CD1944          17      CALL    ROM_LDIR
       47A9                     RBREND:
0007A9 47A9 CD0D4A          17      CALL    RBXEND
       47AC                     RBREND0:
0007AC 47AC FDE1            14      POP IY
0007AE 47AE C1              10      POP BC
0007AF 47AF D1              10      POP DE
0007B0 47B0 F1              10      POP AF  ;(HL)
0007B1 47B1 AF               4      XOR A
0007B2 47B2 3A16F1          13      LD  A,(_RESULT)
0007B5 47B5 C9              10      RET
                                
       47B6                     RBRERR1:
0007B6 47B6 3E01             7      LD  A,001H
       47B8                     RBRERR2:
0007B8 47B8 FDE1            14      POP IY
0007BA 47BA C1              10      POP BC
0007BB 47BB D1              10      POP DE
0007BC 47BC E1              10      POP HL
0007BD 47BD 37               4      SCF
0007BE 47BE 210000          10      LD  HL,0
0007C1 47C1 C9              10      RET
       47C2                     RBRERR:
0007C2 47C2 3EFF             7      LD  A,0FFH
0007C4 47C4 18F2            12      JR  RBRERR2
                                
       47C6                     FILE_DD:
0007C6 47C6 3E                      DB  03EH
0007C7 47C7 C9              10      RET
0007C8 47C8 3208F1          13      LD  (SWC_BLOAD_M),A
0007CB 47CB 2A3FF1          16      LD  HL,(PARAM0)
0007CE 47CE 7E               7      LD  A,(HL)
0007CF 47CF C9              10      RET
       47D0                     FILE_B:
0007D0 47D0 AF               4      XOR A
0007D1 47D1 3243F1          13      LD  (FDRV),A
0007D4 47D4 1E00             7      LD  E,0
0007D6 47D6 3A63F6          13      LD  A,(VALTYP)
0007D9 47D9 FE03             7      CP  3       ;string
0007DB 47DB 2044            12      JR  NZ,FILED
                                
0007DD 47DD DD21D067        14      LD  IX,FRESTR
0007E1 47E1 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007E5 47E5 CD1C00          17      CALL    _CALSLT
0007E8 47E8 E5              11      PUSH    HL
0007E9 47E9 DDE1            14      POP IX
                                
0007EB 47EB DD5E00          19      LD  E,(IX+0)
0007EE 47EE DD7E01          19      LD  A,(IX+1)
0007F1 47F1 DD5602          19      LD  D,(IX+2)
0007F4 47F4 DD62             9      LD  IXH,D
0007F6 47F6 DD6F             9      LD  IXL,A
0007F8 47F8 7B               4      LD  A,E
0007F9 47F9 FE04             7      CP  4
0007FB 47FB 3808            12      JR  C,FILEB1
0007FD 47FD DD7E03          19      LD  A,(IX+3)
000800 4800 FE3A             7      CP  ':'
000802 4802 28C2            12      JR  Z,FILE_DD
000804 4804 7B               4      LD  A,E
       4805                     FILEB1:
000805 4805 FE02             7      CP  2
000807 4807 3818            12      JR  C,FILED
000809 4809 DD7E01          19      LD  A,(IX+1)
00080C 480C FE3A             7      CP  ':'
00080E 480E 2011            12      JR  NZ,DEVI1
000810 4810 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000813 4813 CDFA48          17      CALL    CAP
000816 4816 D640             7      SUB '@'
000818 4818 DD23            10      INC IX
00081A 481A DD23            10      INC IX
00081C 481C 1D               4      DEC E
00081D 481D 1D               4      DEC E
00081E 481E 3243F1          13      LD  (FDRV),A
       4821                     DEVI1:
                                
       4821                     FILED:
000821 4821 CD6848          17      CALL    FILEI
000824 4824 2144F1          10      LD  HL,FNAME
                                
000827 4827 0608             7      LD  B,8
       4829                     FILE2:
000829 4829 CD7548          17      CALL    CCHKF
00082C 482C C8              11      RET Z
00082D 482D FE2A             7      CP  '*'
00082F 482F 282E            12      JR  Z,FILE9
000831 4831 FE2E             7      CP  '.'
000833 4833 280C            12      JR  Z,FILE4
000835 4835 77               7      LD  (HL),A
000836 4836 23               6      INC HL
000837 4837 10F0            13      DJNZ    FILE2
                                
       4839                     FILE3:
000839 4839 CD7548          17      CALL    CCHKF
00083C 483C C8              11      RET Z
00083D 483D FE2E             7      CP  '.'
00083F 483F 20F8            12      JR  NZ,FILE3
                                
       4841                     FILE4:
000841 4841 214CF1          10      LD  HL,FNAME+8
000844 4844 0603             7      LD  B,3
                                
       4846                     FILE4L:
000846 4846 CD7548          17      CALL    CCHKF
000849 4849 C8              11      RET Z
00084A 484A FE2E             7      CP  '.'
00084C 484C 2008            12      JR  NZ,FILE12
00084E 484E 3244F1          13      LD  (FNAME),A   ;Parent directory(..)
000851 4851 3245F1          13      LD  (FNAME+1),A
000854 4854 3E20             7      LD  A,020H
       4856                     FILE12:
000856 4856 FE2A             7      CP  '*'
000858 4858 280A            12      JR  Z,FILE10
00085A 485A 77               7      LD  (HL),A
00085B 485B 23               6      INC HL
00085C 485C 10E8            13      DJNZ    FILE4L
00085E 485E C9              10      RET
                                
       485F                     FILE9:              ;名前の*処理、名前の残りを?で埋める
00085F 485F CD6448          17      CALL    FILE10
000862 4862 18D5            12      JR  FILE3
                                
       4864                     FILE10:
000864 4864 3E3F             7      LD  A,'?'
000866 4866 1808            12      JR  FILL_MEMORY
       4868                     FILEI:              ;名前＋拡張子をスペースで初期化
000868 4868 3E20             7      LD  A,020H
00086A 486A 01000B          10      LD  BC,11*256   ;C=0にしておく
00086D 486D 2144F1          10      LD  HL,FNAME
       4870                     FILL_MEMORY:            ;HLからBバイトAで埋める
000870 4870 77               7      LD  (HL),A
000871 4871 23               6      INC HL
000872 4872 10FC            13      DJNZ    FILL_MEMORY
000874 4874 C9              10      RET
                                
       4875                     CCHKF:
000875 4875 7B               4      LD  A,E
000876 4876 B7               4      OR  A
000877 4877 C8              11      RET Z
000878 4878 DD7E00          19      LD  A,(IX+0)
00087B 487B CD8248          17      CALL    CCHK2
00087E 487E C8              11      RET Z
00087F 487F C3E548          10      JP  FKAN
                                
       4882                     CCHK2:
000882 4882 0C               4      INC C
000883 4883 0D               4      DEC C
000884 4884 C0              11      RET NZ
       4885                     CCHK3:              ;ZF=1 で使えない文字
000885 4885 FE2B             7      CP  '+'
000887 4887 C8              11      RET Z
000888 4888 FE2C             7      CP  ','
00088A 488A C8              11      RET Z
00088B 488B FE2F             7      CP  '/'
00088D 488D C8              11      RET Z
00088E 488E FE3A             7      CP  ':'
000890 4890 C8              11      RET Z
000891 4891 FE3B             7      CP  ';'
000893 4893 C8              11      RET Z
000894 4894 FE3D             7      CP  '='
000896 4896 C8              11      RET Z
000897 4897 FE5C             7      CP  05CH    ;\
000899 4899 C8              11      RET Z
00089A 489A FE1F             7      CP  01FH
00089C 489C D0              11      RET NC
00089D 489D BF               4      CP  A       ;Z=1
00089E 489E C9              10      RET
                                
       489F                     SS1:
00089F 489F 13               6      INC DE
       48A0                     SPCUT:              ;スペースをカット
0008A0 48A0 1A               7      LD  A,(DE)
0008A1 48A1 FE20             7      CP  020H
0008A3 48A3 28FA            12      JR  Z,SS1
0008A5 48A5 C9              10      RET
                                
       48A6                     SCREOF1:
0008A6 48A6 13               6      INC DE
       48A7                     SPCUTEX:            ;スペース改行などをカット
0008A7 48A7 1A               7      LD  A,(DE)
0008A8 48A8 FE20             7      CP  020H
0008AA 48AA 28FA            12      JR  Z,SCREOF1
0008AC 48AC FE0D             7      CP  00DH
0008AE 48AE 28F6            12      JR  Z,SCREOF1
0008B0 48B0 FE0A             7      CP  00AH
0008B2 48B2 28F2            12      JR  Z,SCREOF1
0008B4 48B4 FE1A             7      CP  01AH
0008B6 48B6 28EE            12      JR  Z,SCREOF1
0008B8 48B8 C9              10      RET
                                
       48B9                     GETNUM:
0008B9 48B9 210000          10      LD  HL,0
       48BC                     GETNUM1:
0008BC 48BC 1A               7      LD  A,(DE)
0008BD 48BD 13               6      INC DE
0008BE 48BE D630             7      SUB '0'
0008C0 48C0 D8              11      RET C
0008C1 48C1 FE0A             7      CP  10
0008C3 48C3 D0              11      RET NC
0008C4 48C4 4D               4      LD  C,L
0008C5 48C5 44               4      LD  B,H
0008C6 48C6 29              11      ADD HL,HL   ;*2
0008C7 48C7 29              11      ADD HL,HL   ;*4
0008C8 48C8 09              11      ADD HL,BC   ;*5
0008C9 48C9 29              11      ADD HL,HL   ;*10
0008CA 48CA 4F               4      LD  C,A
0008CB 48CB 0600             7      LD  B,0
0008CD 48CD 09              11      ADD HL,BC
0008CE 48CE 18EC            12      JR  GETNUM1
                                
       48D0                     SEARCH_END:
0008D0 48D0 7E               7      LD  A,(HL)
       48D1                     SEARCH_END1:
0008D1 48D1 23               6      INC HL
0008D2 48D2 B7               4      OR  A
0008D3 48D3 C8              11      RET Z
0008D4 48D4 FE3A             7      CP  ':'
0008D6 48D6 20F8            12      JR  NZ,SEARCH_END
0008D8 48D8 7E               7      LD  A,(HL)
0008D9 48D9 FE3A             7      CP  ':'
0008DB 48DB 28F4            12      JR  Z,SEARCH_END1
0008DD 48DD C9              10      RET
                                
       48DE                     FKANC:
0008DE 48DE CB41             8      BIT 0,C
0008E0 48E0 CC0349          17      CALL    Z,CAP2
0008E3 48E3 1803            12      JR  FKANX
       48E5                     FKAN:           ;漢字チェック
0008E5 48E5 DD23            10      INC IX
0008E7 48E7 1D               4      DEC E
       48E8                     FKANX:
0008E8 48E8 CB41             8      BIT 0,C
0008EA 48EA CB81             8      RES 0,C
0008EC 48EC C0              11      RET NZ
0008ED 48ED FE80             7      CP  080H
0008EF 48EF D8              11      RET C
0008F0 48F0 FEA0             7      CP  0A0H
0008F2 48F2 3803            12      JR  C,FKAN1
0008F4 48F4 FEE0             7      CP  0E0H
0008F6 48F6 D8              11      RET C
       48F7                     FKAN1:
0008F7 48F7 0C               4      INC C
0008F8 48F8 A7               4      AND A
0008F9 48F9 C9              10      RET
                                
       48FA                     CAP:
0008FA 48FA FE61             7      CP  'a'
0008FC 48FC D8              11      RET C
0008FD 48FD FE7B             7      CP  'z'+1
0008FF 48FF D0              11      RET NC
000900 4900 D620             7      SUB 020H
000902 4902 C9              10      RET
       4903                     CAP2:
000903 4903 CDFA48          17      CALL    CAP
       4906                     CAP3:               ;
000906 4906 FE05             7      CP  5
000908 4908 2803            12      JR  Z,CAP4
00090A 490A FE21             7      CP  021H
00090C 490C C9              10      RET
       490D                     CAP4:
00090D 490D 3EE5             7      LD  A,0E5H
00090F 490F C9              10      RET
                                
       4910                     ROM_OPEN:
000910 4910 CD014D          17      CALL    GET_DISK_BANK_FDRV
                                
000913 4913 CD2D4B          17      CALL    GET_DIR_DAT
000916 4916 D5              11      PUSH    DE
000917 4917 CD2C49          17      CALL    FILESE
00091A 491A D1              10      POP DE
00091B 491B 3F               4      CCF
00091C 491C D8              11      RET C
00091D 491D 223BF1          16      LD  (FCBX),HL
000920 4920 E5              11      PUSH    HL
000921 4921 210000          10      LD  HL,0
000924 4924 221CF1          16      LD  (RR_LOW),HL
000927 4927 221EF1          16      LD  (RR_HIGH),HL
00092A 492A E1              10      POP HL
00092B 492B C9              10      RET
                                
       492C                     FILESE:
00092C 492C 7E               7      LD  A,(HL)
00092D 492D B7               4      OR  A
00092E 492E C8              11      RET Z       ;END:ZF=1 CF=0
00092F 492F FEE5             7      CP  0E5H
000931 4931 280D            12      JR  Z,FILESE1
000933 4933 1144F1          10      LD  DE,FNAME
000936 4936 E5              11      PUSH    HL
000937 4937 CD4E49          17      CALL    CPFILE
00093A 493A CC6F49          17      CALL    Z,CPFILE2
00093D 493D E1              10      POP HL
00093E 493E 37               4      SCF
00093F 493F C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4940                     FILESE1:
000940 4940 CD4849          17      CALL    FNEXT
000943 4943 20E7            12      JR  NZ,FILESE
       4945                     ZF0_CF0_AFF_RET:
000945 4945 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000947 4947 C9              10      RET
                                
       4948                     FNEXT:
000948 4948 112000          10      LD  DE,020H
00094B 494B 19              11      ADD HL,DE
00094C 494C 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
00094D 494D C9              10      RET
                                
       494E                     CPFILE:
00094E 494E C5              11      PUSH    BC
00094F 494F 01000B          10      LD  BC,00B00H
       4952                     CPSTR1:
000952 4952 1A               7      LD  A,(DE)
000953 4953 FE3F             7      CP  '?'     ;Wild card
000955 4955 2812            12      JR  Z,CPSTR2
000957 4957 7E               7      LD  A,(HL)
000958 4958 CDDE48          17      CALL    FKANC
00095B 495B E5              11      PUSH    HL
00095C 495C 67               4      LD  H,A
00095D 495D 1A               7      LD  A,(DE)
00095E 495E CB01             4      RLC C
000960 4960 CDDE48          17      CALL    FKANC
000963 4963 CB09             4      RRC C
000965 4965 BC               4      CP  H       ;CP (HL),(DE)
000966 4966 E1              10      POP HL
000967 4967 2004            12      JR  NZ,CPSTR3
       4969                     CPSTR2:
000969 4969 13               6      INC DE
00096A 496A 23               6      INC HL
00096B 496B 10E5            13      DJNZ    CPSTR1
       496D                     CPSTR3:
00096D 496D C1              10      POP BC
00096E 496E C9              10      RET
                                
       496F                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
00096F 496F 3EE1             7      LD  A,0E1H
000971 4971 2F               4      CPL
000972 4972 A6               7      AND (HL)
000973 4973 C9              10      RET
                                
       4974                     RBX1:
000974 4974 E5              11      PUSH    HL      ;Record byte
                                
000975 4975 ED5B1CF1        20      LD  DE,(RR_LOW) ;CDE=Random record
000979 4979 3A1FF1          13      LD  A,(RR_HIGH+1)
00097C 497C 4F               4      LD  C,A
                                
00097D 497D CD014D          17      CALL    GET_DISK_BANK_FDRV
                                
000980 4980 FD2A3BF1        20      LD  IY,(FCBX)
000984 4984 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000987 4987 FD661D          19      LD  H,(IY+01DH)
00098A 498A FD7E1E          19      LD  A,(IY+01EH)
                                
00098D 498D A7               4      AND A
00098E 498E ED52            15      SBC HL,DE
000990 4990 99               4      SBC A,C
000991 4991 D1              10      POP DE
                                
000992 4992 D8              11      RET C
000993 4993 4F               4      LD  C,A
000994 4994 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000995 4995 B2               4      OR  D
000996 4996 B3               4      OR  E
000997 4997 C0              11      RET NZ
000998 4998 37               4      SCF
000999 4999 C9              10      RET
                                
       499A                     RBX2:
00099A 499A ED4B1DF1        20      LD  BC,(RR_LOW+1)
00099E 499E CD224A          17      CALL    RWXR
0009A1 49A1 3A19F1          13      LD  A,(CLSZ_H)
0009A4 49A4 3D               4      DEC A
0009A5 49A5 E5              11      PUSH    HL
0009A6 49A6 2A1CF1          16      LD  HL,(RR_LOW)
0009A9 49A9 A4               4      AND H
0009AA 49AA B5               4      OR  L
0009AB 49AB E1              10      POP HL
0009AC 49AC C9              10      RET
                                
       49AD                     RBXA:
0009AD 49AD D5              11      PUSH    DE
0009AE 49AE CD914A          17      CALL    CLUST
0009B1 49B1 ED5324F1        20      LD  (_DTPS),DE
0009B5 49B5 D1              10      POP DE
0009B6 49B6 CD6E4A          17      CALL    GNCL
0009B9 49B9 D8              11      RET C
0009BA 49BA ED5320F1        20      LD  (_CLPS),DE
                                
0009BE 49BE ED4B1CF1        20      LD  BC,(RR_LOW)
0009C2 49C2 2A18F1          16      LD  HL,(CLSZ)
0009C5 49C5 7C               4      LD  A,H
0009C6 49C6 3D               4      DEC A
0009C7 49C7 A0               4      AND B
0009C8 49C8 47               4      LD  B,A
0009C9 49C9 ED42            15      SBC HL,BC       ;remaining cluster
                                
0009CB 49CB ED5B3DF1        20      LD  DE,(LEFTX)
0009CF 49CF ED52            15      SBC HL,DE       ;CP HL,DE
0009D1 49D1 19              11      ADD HL,DE
0009D2 49D2 3801            12      JR  C,RBXA1
0009D4 49D4 EB               4      EX  DE,HL
       49D5                     RBXA1:
0009D5 49D5 3A17F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
0009D8 49D8 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0009DB 49DB 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0009DE 49DE E5              11      PUSH    HL
0009DF 49DF 2A24F1          16      LD  HL,(_DTPS)
0009E2 49E2 09              11      ADD HL,BC
0009E3 49E3 ED5B37F1        20      LD  DE,(DTAX)
0009E7 49E7 C1              10      POP BC
0009E8 49E8 C9              10      RET
                                
       49E9                     RBXB:
0009E9 49E9 2A37F1          16      LD  HL,(DTAX)
0009EC 49EC ED5B20F1        20      LD  DE,(_CLPS)
0009F0 49F0 3A3EF1          13      LD  A,(LEFTX+1)
0009F3 49F3 47               4      LD  B,A
0009F4 49F4 3A19F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       49F7                     RBXB1:
0009F7 49F7 1F               4      RRA     ;->CF
0009F8 49F8 3804            12      JR  C,RBXB2
0009FA 49FA CB38             8      SRL B   ;B=B/2
0009FC 49FC 18F9            12      JR  RBXB1
       49FE                     RBXB2:
0009FE 49FE 78               4      LD  A,B
0009FF 49FF B7               4      OR  A
000A00 4A00 C9              10      RET
                                
       4A01                     RBXC:
000A01 4A01 ED4B3DF1        20      LD  BC,(LEFTX)
000A05 4A05 3A19F1          13      LD  A,(CLSZ_H)
000A08 4A08 3D               4      DEC A
000A09 4A09 A0               4      AND B
000A0A 4A0A 47               4      LD  B,A
000A0B 4A0B B1               4      OR  C
000A0C 4A0C C9              10      RET
                                
       4A0D                     RBXEND:
000A0D 4A0D ED5B22F1        20      LD  DE,(_LEFT)
000A11 4A11 2A1CF1          16      LD  HL,(RR_LOW)
000A14 4A14 3A1FF1          13      LD  A,(RR_HIGH+1)
000A17 4A17 19              11      ADD HL,DE
000A18 4A18 CE00             7      ADC A,0
000A1A 4A1A 221CF1          16      LD  (RR_LOW),HL
000A1D 4A1D 321FF1          13      LD  (RR_HIGH+1),A
000A20 4A20 EB               4      EX  DE,HL       ;HL=Read byte
000A21 4A21 C9              10      RET 
                                
       4A22                     RWXR:
000A22 4A22 3A19F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4A25                     L_RWX:
000A25 4A25 1F               4      RRA     ;->CF
000A26 4A26 3806            12      JR  C,E_RWX
000A28 4A28 CB38             8      SRL B   ;BC=BC/2
000A2A 4A2A CB19             8      RR  C   ;
000A2C 4A2C 18F7            12      JR  L_RWX
       4A2E                     E_RWX:
000A2E 4A2E CD014D          17      CALL    GET_DISK_BANK_FDRV
                                
000A31 4A31 FD2A3BF1        20      LD  IY,(FCBX)
000A35 4A35 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000A38 4A38 FD561B          19      LD  D,(IY+01BH)
       4A3B                     RWX1:
000A3B 4A3B ED5320F1        20      LD  (_CLPS),DE
000A3F 4A3F 7A               4      LD  A,D
000A40 4A40 B3               4      OR  E
000A41 4A41 37               4      SCF
000A42 4A42 C8              11      RET Z
                                
000A43 4A43 78               4      LD  A,B
000A44 4A44 B1               4      OR  C
000A45 4A45 C8              11      RET Z
                                
000A46 4A46 CD6E4A          17      CALL    GNCL
000A49 4A49 D8              11      RET C
000A4A 4A4A 0B               6      DEC BC
000A4B 4A4B CDC64A          17      CALL    ENDCL
000A4E 4A4E 38EB            12      JR  C,RWX1
000A50 4A50 37               4      SCF
000A51 4A51 C9              10      RET
                                
       4A52                     NCL3:
000A52 4A52 CD014D          17      CALL    GET_DISK_BANK_FDRV
000A55 4A55 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000A58 4A58 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000A5B 4A5B 6B               4      LD  L,E
000A5C 4A5C 62               4      LD  H,D
000A5D 4A5D CB3C             8      SRL H
000A5F 4A5F CB1D             8      RR  L
000A61 4A61 1F               4      RRA
000A62 4A62 19              11      ADD HL,DE
000A63 4A63 010060          10      LD  BC,BANK1_ADR
000A66 4A66 09              11      ADD HL,BC
000A67 4A67 ED4B1AF1        20      LD  BC,(SECSZ)
000A6B 4A6B 09              11      ADD HL,BC
000A6C 4A6C 17               4      RLA
000A6D 4A6D C9              10      RET
                                
       4A6E                     GNCL:
000A6E 4A6E 7A               4      LD  A,D
000A6F 4A6F B3               4      OR  E
000A70 4A70 37               4      SCF
000A71 4A71 C8              11      RET Z
000A72 4A72 C5              11      PUSH    BC
000A73 4A73 E5              11      PUSH    HL
000A74 4A74 CD524A          17      CALL    NCL3
000A77 4A77 3809            12      JR  C,GNC1
000A79 4A79 5E               7      LD  E,(HL)
000A7A 4A7A 23               6      INC HL
000A7B 4A7B 7E               7      LD  A,(HL)
000A7C 4A7C E60F             7      AND 00FH
000A7E 4A7E 57               4      LD  D,A
000A7F 4A7F E1              10      POP HL
000A80 4A80 C1              10      POP BC
000A81 4A81 C9              10      RET
       4A82                     GNC1:
000A82 4A82 7E               7      LD  A,(HL)
000A83 4A83 23               6      INC HL
000A84 4A84 56               7      LD  D,(HL)
000A85 4A85 0604             7      LD  B,4
       4A87                     GNC1L:
000A87 4A87 CB3A             8      SRL D
000A89 4A89 1F               4      RRA
000A8A 4A8A 10FB            13      DJNZ    GNC1L
                                
000A8C 4A8C 5F               4      LD  E,A
000A8D 4A8D E1              10      POP HL
000A8E 4A8E C1              10      POP BC
000A8F 4A8F A7               4      AND A
000A90 4A90 C9              10      RET
                                
       4A91                     CLUST:
000A91 4A91 EB               4      EX  DE,HL
000A92 4A92 C5              11      PUSH    BC
000A93 4A93 3A19F1          13      LD  A,(CLSZ_H)
000A96 4A96 CD2D4D          17      CALL    MUL_AHL
                                
000A99 4A99 CD3A4B          17      CALL    GET_DIR_POS
000A9C 4A9C 4F               4      LD  C,A
000A9D 4A9D 0600             7      LD  B,0
000A9F 4A9F 09              11      ADD HL,BC
                                
000AA0 4AA0 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000AA3 4AA3 0F               4      RRCA
000AA4 4AA4 0F               4      RRCA
000AA5 4AA5 0F               4      RRCA
000AA6 4AA6 0F               4      RRCA
000AA7 4AA7 4F               4      LD  C,A
                                
000AA8 4AA8 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000AAB 4AAB FE02             7      CP  2
000AAD 4AAD 280C            12      JR  Z,CLUST1
000AAF 4AAF CB01             4      RLC C
000AB1 4AB1 0D               4      DEC C
000AB2 4AB2 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000AB5 4AB5 FE02             7      CP  2
000AB7 4AB7 2002            12      JR  NZ,CLUST1
000AB9 4AB9 0D               4      DEC C
000ABA 4ABA 0D               4      DEC C
       4ABB                     CLUST1:
000ABB 4ABB 0D               4      DEC C
000ABC 4ABC 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000ABD 4ABD 7D               4      LD  A,L
                                #else
                                    PUSH    HL
                                    ADD HL,HL   ;*2
                                    ADD HL,HL   ;*4
                                    ADD HL,HL   ;*8
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    POP HL
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
000ABE 4ABE C660             7      ADD A,high BANK1_ADR
000AC0 4AC0 67               4      LD  H,A
000AC1 4AC1 2E00             7      LD  L,0
000AC3 4AC3 EB               4      EX  DE,HL
000AC4 4AC4 C1              10      POP BC
000AC5 4AC5 C9              10      RET
                                
       4AC6                     ENDCL:
000AC6 4AC6 7A               4      LD  A,D ;END CLUSTER
000AC7 4AC7 FE0F             7      CP  00FH    ;FAT12の最大値
000AC9 4AC9 C0              11      RET NZ
000ACA 4ACA 7B               4      LD  A,E
000ACB 4ACB FEF7             7      CP  0F7H
000ACD 4ACD C9              10      RET
                                
       4ACE                     RB_READ:
000ACE 4ACE AF               4      XOR A   ;HLA = HL*128
000ACF 4ACF CB3C             8      SRL H
000AD1 4AD1 CB1D             8      RR  L
000AD3 4AD3 1F               4      RRA
000AD4 4AD4 321CF1          13      LD  (RR_LOW),A
000AD7 4AD7 221DF1          16      LD  (RR_MID),HL
000ADA 4ADA 218000          10      LD  HL,128
                                
000ADD 4ADD CD3047          17      CALL    ROM_READ
000AE0 4AE0 C9              10      RET
                                
       4AE1                     GETSEQ:
000AE1 4AE1 FD6E20          19      LD  L,(IY+32)
000AE4 4AE4 FD660C          19      LD  H,(IY+12)
                                
000AE7 4AE7 CB25             8      SLA L
                                
000AE9 4AE9 CB3C             8      SRL H
000AEB 4AEB CB1D             8      RR  L
000AED 4AED C9              10      RET
                                
       4AEE                     SETSEQ:
000AEE 4AEE F5              11      PUSH    AF
000AEF 4AEF 3A1CF1          13      LD  A,(RR_LOW)
000AF2 4AF2 2A1DF1          16      LD  HL,(RR_MID)
                                
000AF5 4AF5 CD0C4B          17      CALL    SSQ1
                                
000AF8 4AF8 29              11      ADD HL,HL
000AF9 4AF9 CB3D             8      SRL L
000AFB 4AFB FD7520          19      LD  (IY+32),L
000AFE 4AFE FD740C          19      LD  (IY+12),H
000B01 4B01 F1              10      POP AF
000B02 4B02 C9              10      RET
                                
       4B03                     GETSIZE:
000B03 4B03 FD7E10          19      LD  A,(IY+16)
000B06 4B06 FD6E11          19      LD  L,(IY+17)
000B09 4B09 FD6612          19      LD  H,(IY+18)
       4B0C                     SSQ1:
000B0C 4B0C 87               4      ADD A,A
000B0D 4B0D ED6A            15      ADC HL,HL
000B0F 4B0F B7               4      OR  A
000B10 4B10 C8              11      RET Z
000B11 4B11 23               6      INC HL
000B12 4B12 C9              10      RET
                                
       4B13                     SET_FCB:
000B13 4B13 D5              11      PUSH    DE
000B14 4B14 FDE1            14      POP IY
000B16 4B16 FD7E1C          19      LD  A,(IY+28)
000B19 4B19 FEFF             7      CP  0FFH
000B1B 4B1B 200C            12      JR  NZ,POPAF_SCF_FF_RET
000B1D 4B1D E5              11      PUSH    HL
000B1E 4B1E FD6E1A          19      LD  L,(IY+26)
000B21 4B21 FD661B          19      LD  H,(IY+27)
000B24 4B24 2220F1          16      LD  (_CLPS),HL
000B27 4B27 E1              10      POP HL
000B28 4B28 C9              10      RET
                                
       4B29                     POPAF_SCF_FF_RET:
000B29 4B29 F1              10      POP AF
000B2A 4B2A 37               4      SCF
000B2B 4B2B 9F               4      SBC A,A
000B2C 4B2C C9              10      RET
                                
       4B2D                     GET_DIR_DAT:
000B2D 4B2D CD3A4B          17      CALL    GET_DIR_POS
000B30 4B30 C660             7      ADD A,high BANK1_ADR
000B32 4B32 2E00             7      LD  L,0
000B34 4B34 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000B35 4B35 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000B38 4B38 4F               4      LD  C,A
000B39 4B39 C9              10      RET
                                
       4B3A                     GET_DIR_POS:
000B3A 4B3A CD014D          17      CALL    GET_DISK_BANK_FDRV
000B3D 4B3D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B40 4B40 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B43 4B43 3217F1          13      LD  (_BANK),A
000B46 4B46 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000B49 4B49 47               4      LD  B,A
000B4A 4B4A 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000B4D 4B4D 4F               4      LD  C,A
000B4E 4B4E 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4B51                     GET_DIR_POS1:
000B51 4B51 81               4      ADD A,C
000B52 4B52 10FD            13      DJNZ    GET_DIR_POS1
                                
000B54 4B54 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4B58                     L_MDP:
000B58 4B58 CB18             8      RR  B   ;->CF
000B5A 4B5A D8              11      RET C
000B5B 4B5B 87               4      ADD A,A
000B5C 4B5C 18FA            12      JR  L_MDP
                                
       4B5E                     WILDCARD:
000B5E 4B5E 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4B69                     ERROR_WRITE_PROTECTED:
000B69 4B69 3E00             7      LD  A,0     ;Write protected
000B6B 4B6B C9              10      RET
       4B6C                     DISKIO:
000B6C 4B6C 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000B6E 4B6E 48               4      LD  C,B
000B6F 4B6F CD0B4D          17      CALL    GET_DISK_BANK
       4B72                     SETMAP1:        
000B72 4B72 E5              11      PUSH    HL
       4B73                     DISKIO1:
000B73 4B73 C5              11      PUSH    BC      ;B=残りのセクタ数
000B74 4B74 D5              11      PUSH    DE      ;DE=セクタ番号
000B75 4B75 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000B76 4B76 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000B77 4B77 F5              11      PUSH    AF
000B78 4B78 3A1BF1          13      LD  A,(SECSZ_H)
000B7B 4B7B CD2D4D          17      CALL    MUL_AHL
000B7E 4B7E F1              10      POP AF
000B7F 4B7F 4D               4      LD  C,L     ;C=読み出し元
000B80 4B80 29              11      ADD HL,HL       ;64KB→32KB
000B81 4B81 29              11      ADD HL,HL       ;32KB→16KB
000B82 4B82 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000B83 4B83 84               4      ADD A,H
000B84 4B84 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B87 4B87 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B8A 4B8A 3217F1          13      LD  (_BANK),A
000B8D 4B8D 79               4      LD  A,C     ;C=読み出し元
000B8E 4B8E E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
000B90 4B90 C660             7      ADD A,high BANK1_ADR
000B92 4B92 67               4      LD  H,A
000B93 4B93 ED4B1AF1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000B97 4B97 69               4      LD  L,C     ;C=0
000B98 4B98 EDB0                    LDIR
000B9A 4B9A EB               4      EX  DE,HL
000B9B 4B9B F1              10      POP AF
000B9C 4B9C D1              10      POP DE
000B9D 4B9D 13               6      INC DE
000B9E 4B9E C1              10      POP BC
000B9F 4B9F 10D2            13      DJNZ    DISKIO1
000BA1 4BA1 41               4      LD  B,C
                                
000BA2 4BA2 E1              10      POP HL
000BA3 4BA3 AF               4      XOR A
000BA4 4BA4 FB               4      EI
000BA5 4BA5 C9              10      RET
                                
       4BA6                     DSKCHG:
000BA6 4BA6 CDDF4B          17      CALL    IS_BPB
000BA9 4BA9 3824            12      JR  C,NOTREADY
000BAB 4BAB 3A23FB          13      LD  A,(DRVTBL+2)
000BAE 4BAE B7               4      OR  A
000BAF 4BAF 201A            12      JR  NZ,DSKCHG1
000BB1 4BB1 3A21FB          13      LD  A,(DRVTBL)
000BB4 4BB4 FE02             7      CP  2
000BB6 4BB6 2013            12      JR  NZ,DSKCHG1
000BB8 4BB8 CDDF4B          17      CALL    IS_BPB
000BBB 4BBB 300E            12      JR  NC,DSKCHG1
000BBD 4BBD 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000BBF 4BBF 3221FB          13      LD  (DRVTBL),A
000BC2 4BC2 3223FB          13      LD  (DRVTBL+2),A
000BC5 4BC5 3A48F3          13      LD  A,(MASTERS)
000BC8 4BC8 3224FB          13      LD  (DRVTBL+3),A
       4BCB                     DSKCHG1:
000BCB 4BCB AF               4      XOR A
000BCC 4BCC 0601             7      LD  B,1
000BCE 4BCE C9              10      RET
       4BCF                     NOTREADY:
000BCF 4BCF 3E02             7      LD  A,2
000BD1 4BD1 37               4      SCF
000BD2 4BD2 C9              10      RET
                                
       4BD3                     NO_BPB:
000BD3 4BD3 E1              10      POP HL
000BD4 4BD4 23               6      INC HL
000BD5 4BD5 11324D          10      LD  DE,DPB2DD
000BD8 4BD8 011200          10      LD  BC,DPB2DD_E-DPB2DD
000BDB 4BDB EDB0                    LDIR
000BDD 4BDD AF               4      XOR A
000BDE 4BDE C9              10      RET
                                
       4BDF                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000BDF 4BDF CD0B4D          17      CALL    GET_DISK_BANK
                                
000BE2 4BE2 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000BE5 4BE5 FE01             7      CP  1
000BE7 4BE7 D8              11      RET C
                                
000BE8 4BE8 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000BEB 4BEB C6FF             7      ADD A,0FFH
000BED 4BED D8              11      RET C
                                
000BEE 4BEE 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000BF1 4BF1 FE01             7      CP  1
000BF3 4BF3 C8              11      RET Z
000BF4 4BF4 FE02             7      CP  2
000BF6 4BF6 C8              11      RET Z
000BF7 4BF7 FE04             7      CP  4
000BF9 4BF9 C8              11      RET Z
000BFA 4BFA 37               4      SCF
000BFB 4BFB C9              10      RET
                                
       4BFC                     GETDPB:
000BFC 4BFC E5              11      PUSH    HL
000BFD 4BFD CD0B4D          17      CALL    GET_DISK_BANK
                                
000C00 4C00 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000C03 4C03 B7               4      OR  A
000C04 4C04 28CD            12      JR  Z,NO_BPB
000C06 4C06 DDE1            14      POP IX
000C08 4C08 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000C0B 4C0B 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000C0E 4C0E DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000C11 4C11 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000C14 4C14 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000C17 4C17 87               4      ADD A,A
000C18 4C18 87               4      ADD A,A
000C19 4C19 87               4      ADD A,A
000C1A 4C1A 3D               4      DEC A
000C1B 4C1B DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000C1E 4C1E 06FF             7      LD  B,-1
000C20 4C20 A7               4      AND A           ;無限ループ阻止
       4C21                     GETDPB1:
000C21 4C21 04               4      INC B
000C22 4C22 1F               4      RRA
000C23 4C23 38FC            12      JR  C,GETDPB1
000C25 4C25 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000C28 4C28 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000C2B 4C2B 3D               4      DEC A
000C2C 4C2C DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000C2F 4C2F A7               4      AND A           ;無限ループ阻止
000C30 4C30 06FF             7      LD  B,-1
       4C32                     GETDPB2:
000C32 4C32 04               4      INC B
000C33 4C33 1F               4      RRA
000C34 4C34 38FC            12      JR  C,GETDPB2
000C36 4C36 04               4      INC B
000C37 4C37 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000C3A 4C3A 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000C3D 4C3D DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000C40 4C40 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000C43 4C43 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000C46 4C46 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000C49 4C49 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000C4C 4C4C DD770B          19      LD  (IX+11),A       ;FATCNT
                                
000C4F 4C4F ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000C53 4C53 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000C56 4C56 DD460A          19      LD  B,(IX+10)       ;FATCNT
000C59 4C59 210000          10      LD  HL,0
       4C5C                     GETDPB3:
000C5C 4C5C 19              11      ADD HL,DE
000C5D 4C5D 10FD            13      DJNZ    GETDPB3
       4C5F                     GETDPB4:
000C5F 4C5F DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000C62 4C62 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000C65 4C65 19              11      ADD HL,DE
000C66 4C66 DD7511          19      LD  (IX+17),L       ;FIRDIR
000C69 4C69 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000C6C 4C6C DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C6F 4C6F 87               4      ADD A,A
000C70 4C70 87               4      ADD A,A
000C71 4C71 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4C74                     GETDPB5:
000C74 4C74 CB3B             8      SRL E
000C76 4C76 1F               4      RRA
000C77 4C77 30FB            12      JR  NC,GETDPB5
000C79 4C79 1600             7      LD  D,0
000C7B 4C7B 19              11      ADD HL,DE
000C7C 4C7C DD750C          19      LD  (IX+12),L       ;FIRREC
000C7F 4C7F DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000C82 4C82 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000C85 4C85 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000C88 4C88 DD560D          19      LD  D,(IX+13)       ;FIRREC
000C8B 4C8B A7               4      AND A
000C8C 4C8C ED52            15      SBC HL,DE
                                
000C8E 4C8E DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000C91 4C91 3C               4      INC A
000C92 4C92 37               4      SCF             ;無限ループ阻止
       4C93                     GETDPB6:
000C93 4C93 1F               4      RRA
000C94 4C94 3806            12      JR  C,GETDPB7
000C96 4C96 CB3C             8      SRL H
000C98 4C98 CB1D             8      RR  L
000C9A 4C9A 18F7            12      JR  GETDPB6
       4C9C                     GETDPB7:
000C9C 4C9C 23               6      INC HL
000C9D 4C9D DD750E          19      LD  (IX+14),L       ;MAXCLUS
000CA0 4CA0 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4CA3                     GETDPBD1:
000CA3 4CA3 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000CA6 4CA6 E6FC             7      AND 0FCH
000CA8 4CA8 C8              11      RET Z
                                
000CA9 4CA9 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000CAD 4CAD 37               4      SCF
000CAE 4CAE DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000CB2 4CB2 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000CB5 4CB5 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000CB9 4CB9 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000CBD 4CBD DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000CC1 4CC1 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000CC5 4CC5 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000CC9 4CC9 DDCB1126        23      SLA (IX+17)         ;FIRDIR
000CCD 4CCD DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000CD1 4CD1 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000CD4 4CD4 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000CD7 4CD7 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000CDA 4CDA 87               4      ADD A,A
000CDB 4CDB 87               4      ADD A,A
000CDC 4CDC DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4CDF                     GETDPBD5:
000CDF 4CDF CB3B             8      SRL E
000CE1 4CE1 1F               4      RRA
000CE2 4CE2 30FB            12      JR  NC,GETDPBD5
000CE4 4CE4 1600             7      LD  D,0
000CE6 4CE6 19              11      ADD HL,DE
000CE7 4CE7 DD750C          19      LD  (IX+12),L       ;FIRREC
000CEA 4CEA DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000CED 4CED 18B4            12      JR  GETDPBD1
                                
       4CEF                     CHOICE:
000CEF 4CEF 210000          10      LD  HL,0
000CF2 4CF2 C9              10      RET
                                
       4CF3                     DSKFMT:
000CF3 4CF3 AF               4      XOR A
000CF4 4CF4 37               4      SCF
       4CF5                     DSKSTP:
000CF5 4CF5 C9              10      RET
                                
       4CF6                     BASENT:
000CF6 4CF6 ED7B4FF1        20      LD  SP,(BASSTK)
000CFA 4CFA C3AD43          10      JP  BASAUTO
                                
       4CFD                     GETSLT:
000CFD 4CFD 3A22FB          13      LD  A,(DRVTBL+1)
000D00 4D00 C9              10      RET
                                
       4D01                     GET_DISK_BANK_FDRV:
000D01 4D01 3A43F1          13      LD  A,(FDRV)
000D04 4D04 D601             7      SUB 1
000D06 4D06 3003            12      JR  NC,GET_DISK_BANK
000D08 4D08 3A3AF1          13      LD  A,(_DVSW)
       4D0B                     GET_DISK_BANK:
000D0B 4D0B B7               4      OR  A       ;A=DRIVE
000D0C 4D0C 3E01             7      LD  A,DISK_BANK
000D0E 4D0E 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
000D10 4D10 3A39F1          13      LD  A,(B_DRIVE)
                                #endif
       4D13                     SET_DISK_BANK:
000D13 4D13 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D16 4D16 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D19 4D19 F5              11      PUSH    AF
000D1A 4D1A E5              11      PUSH    HL
000D1B 4D1B 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
000D1E 4D1E 221AF1          16      LD  (SECSZ),HL
000D21 4D21 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D24 4D24 CD2D4D          17      CALL    MUL_AHL
000D27 4D27 2218F1          16      LD  (CLSZ),HL
000D2A 4D2A E1              10      POP HL
000D2B 4D2B F1              10      POP AF
000D2C 4D2C C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)
       4D2D                     MUL_AHL:
000D2D 4D2D 1F               4      RRA     ;->CF
000D2E 4D2E D8              11      RET C
000D2F 4D2F 29              11      ADD HL,HL
000D30 4D30 18FB            12      JR  MUL_AHL
                                
       4D32                     DPB2DD:
000D32 4D32 F9                      DB  0F9H    ;MEDIA
000D33 4D33 0002                    DW  00200H  ;SECSIZ
000D35 4D35 0F                      DB  00FH    ;DIRMSK
000D36 4D36 04                      DB  004H    ;DIRSHFT
000D37 4D37 01                      DB  001H    ;CLUSMSK
000D38 4D38 02                      DB  002H    ;CLUSSHFT
000D39 4D39 0100                    DW  00001H  ;FIRFAT
000D3B 4D3B 02                      DB  002H    ;FATCNT
000D3C 4D3C 70                      DB  070H    ;MAXENT
000D3D 4D3D 0E00                    DW  0000EH  ;FIRREC
000D3F 4D3F CA02                    DW  002CAH  ;MAXCLUS
000D41 4D41 03                      DB  003H    ;FATSIZ
000D42 4D42 0700                    DW  0007H   ;FIRDIR
       4D44                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4D44                     POP_HL_ERROR:
000D44 4D44 E1              10      POP     HL
       4D45                     _ERROR:
000D45 4D45 0600             7      LD  B,0
000D47 4D47 A7               4      AND A
000D48 4D48 C9              10      RET
                                
       4D49                     ROM_BDOS:
000D49 4D49 E5              11      PUSH    HL
000D4A 4D4A 79               4      LD  A,C
000D4B 4D4B 87               4      ADD A,A
000D4C 4D4C 38F7            12      JR  C,_ERROR
000D4E 4D4E 6F               4      LD  L,A
000D4F 4D4F 265F             7      LD  H,high STABLE
000D51 4D51 7E               7      LD  A,(HL)
000D52 4D52 2C               4      INC L
000D53 4D53 66               7      LD  H,(HL)
000D54 4D54 6F               4      LD  L,A
000D55 4D55 E3              19      EX  (SP),HL
000D56 4D56 79               4      LD  A,C
000D57 4D57 C9              10      RET
                                
       4D58                     _PRINT:
       4D58                     PRINT:
000D58 4D58 7B               4      LD  A,E
000D59 4D59 1803            12      JR  MSG_A
                                
       4D5B                     _SYS01:     ;(BDOS)コンソール入力
000D5B 4D5B CDD24D          17      CALL    _SYS07
       4D5E                     MSG_A:
000D5E 4D5E FE03             7      CP  3
000D60 4D60 2814            12      JR  Z,MSG_BR
       4D62                     MSGA1:
000D62 4D62 F5              11      PUSH    AF
000D63 4D63 C5              11      PUSH    BC
000D64 4D64 D5              11      PUSH    DE
000D65 4D65 E5              11      PUSH    HL
000D66 4D66 DDE5            15      PUSH    IX
000D68 4D68 DD21A200        14      LD  IX,CHPUT
000D6C 4D6C CDE442          17      CALL    CALSLT_R
000D6F 4D6F DDE1            14      POP IX
000D71 4D71 E1              10      POP HL
000D72 4D72 D1              10      POP DE
000D73 4D73 C1              10      POP BC
       4D74                     MSGA2:
000D74 4D74 F1              10      POP AF
000D75 4D75 C9              10      RET
       4D76                     MSG_BR:
000D76 4D76 F5              11      PUSH    AF
000D77 4D77 3ADDF3          13      LD  A,(CSRX)
000D7A 4D7A FE02             7      CP  2
000D7C 4D7C 38F6            12      JR  C,MSGA2
000D7E 4D7E F1              10      POP AF
       4D7F                     MSG_CR:
000D7F 4D7F F5              11      PUSH    AF
000D80 4D80 3E0D             7      LD  A,00DH
000D82 4D82 CD624D          17      CALL    MSGA1
000D85 4D85 3E0A             7      LD  A,00AH
000D87 4D87 CD624D          17      CALL    MSGA1
000D8A 4D8A F1              10      POP AF
000D8B 4D8B C9              10      RET
                                
       4D8C                     _SYS02:     ;(BDOS)コンソール出力
000D8C 4D8C CDA74D          17      CALL    BREAK
000D8F 4D8F 1805            12      JR  PRINTX
                                
       4D91                     _SYS06:     ;(BDOS)コンソール直接入出力
000D91 4D91 7B               4      LD  A,E
000D92 4D92 3C               4      INC A
000D93 4D93 CAE64D          10      JP  Z,_INKEY
       4D96                     PRINTX:
000D96 4D96 C3584D          10      JP  _PRINT
                                
       4D99                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D99 4D99 CDD24D          17      CALL    _SYS07
000D9C 4D9C FE03             7      CP  3
000D9E 4D9E CCA74D          17      CALL    Z,_BREAK
000DA1 4DA1 FE13             7      CP  013H        ;CTRL+S
000DA3 4DA3 C0              11      RET NZ
       4DA4                     PAUSE:
000DA4 4DA4 CDBE4D          17      CALL    KEYBC
                                
       4DA7                     _BREAK:
       4DA7                     BREAK:
000DA7 4DA7 F5              11      PUSH    AF
000DA8 4DA8 C5              11      PUSH    BC
000DA9 4DA9 D5              11      PUSH    DE
000DAA 4DAA E5              11      PUSH    HL
000DAB 4DAB DDE5            15      PUSH    IX
000DAD 4DAD DD21B700        14      LD  IX,BREAKX
000DB1 4DB1 CDE442          17      CALL    CALSLT_R
000DB4 4DB4 DDE1            14      POP IX
000DB6 4DB6 E1              10      POP HL
000DB7 4DB7 D1              10      POP DE
000DB8 4DB8 C1              10      POP BC
000DB9 4DB9 DCA74D          17      CALL    C,_BREAK
000DBC 4DBC F1              10      POP AF
000DBD 4DBD C9              10      RET
       4DBE                     KEYBC:
000DBE 4DBE F5              11      PUSH    AF
000DBF 4DBF C5              11      PUSH    BC
000DC0 4DC0 D5              11      PUSH    DE
000DC1 4DC1 E5              11      PUSH    HL
000DC2 4DC2 DDE5            15      PUSH    IX
000DC4 4DC4 DD215601        14      LD  IX,KILBUF
000DC8 4DC8 CDE442          17      CALL    CALSLT_R
000DCB 4DCB DDE1            14      POP IX
000DCD 4DCD E1              10      POP HL
000DCE 4DCE D1              10      POP DE
000DCF 4DCF C1              10      POP BC
000DD0 4DD0 F1              10      POP AF
000DD1 4DD1 C9              10      RET
                                
       4DD2                     _SYS07:
       4DD2                     FLGET:
000DD2 4DD2 C5              11      PUSH    BC
000DD3 4DD3 D5              11      PUSH    DE
000DD4 4DD4 E5              11      PUSH    HL
000DD5 4DD5 DDE5            15      PUSH    IX
000DD7 4DD7 DD219F00        14      LD  IX,CHGET
000DDB 4DDB CDE442          17      CALL    CALSLT_R
000DDE 4DDE DDE1            14      POP IX
000DE0 4DE0 E1              10      POP HL
000DE1 4DE1 D1              10      POP DE
000DE2 4DE2 C1              10      POP BC
000DE3 4DE3 FE03             7      CP  3
000DE5 4DE5 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       4DE6                     _INKEY:
       4DE6                     INKEY:
000DE6 4DE6 CD804E          17      CALL    CPM_CONST
000DE9 4DE9 C8              11      RET Z
000DEA 4DEA 18E6            12      JR  FLGET
                                
       4DEC                     _SYS0A:     ;(BDOS)文字列入力
000DEC 4DEC C5              11      PUSH    BC
000DED 4DED E5              11      PUSH    HL
000DEE 4DEE D5              11      PUSH    DE
000DEF 4DEF CD184E          17      CALL    GETL
000DF2 4DF2 111FF4          10      LD  DE,KBUF
000DF5 4DF5 E1              10      POP HL
000DF6 4DF6 E5              11      PUSH    HL
000DF7 4DF7 0E00             7      LD  C,0
000DF9 4DF9 3004            12      JR  NC,SAX0
000DFB 4DFB 23               6      INC HL
000DFC 4DFC 23               6      INC HL
000DFD 4DFD 1808            12      JR  SAX4
       4DFF                     SAX0:
000DFF 4DFF 46               7      LD  B,(HL)
000E00 4E00 23               6      INC HL
       4E01                     SAX1:
000E01 4E01 23               6      INC HL
000E02 4E02 1A               7      LD  A,(DE)
000E03 4E03 13               6      INC DE
000E04 4E04 B7               4      OR  A
000E05 4E05 2004            12      JR  NZ,SAX2
       4E07                     SAX4:
000E07 4E07 360D            10      LD  (HL),00DH
000E09 4E09 1804            12      JR  SAX3
       4E0B                     SAX2:
000E0B 4E0B 77               7      LD  (HL),A
000E0C 4E0C 0C               4      INC C
000E0D 4E0D 10F2            13      DJNZ    SAX1
       4E0F                     SAX3:
000E0F 4E0F D1              10      POP DE
000E10 4E10 79               4      LD  A,C
000E11 4E11 13               6      INC DE
000E12 4E12 12               7      LD  (DE),A
000E13 4E13 1B               6      DEC DE
000E14 4E14 E1              10      POP HL
000E15 4E15 C1              10      POP BC
000E16 4E16 A7               4      AND A
000E17 4E17 C9              10      RET
       4E18                     GETL:
000E18 4E18 DDE5            15      PUSH    IX
000E1A 4E1A FDE5            15      PUSH    IY
                                
000E1C 4E1C 2ADCF3          16      LD  HL,(CSRY)
000E1F 4E1F 22CAFB          16      LD  (FSTPOS),HL
       4E22                     GETL1:
000E22 4E22 CD994D          17      CALL    _SYS08
000E25 4E25 FE09             7      CP  9
000E27 4E27 2008            12      JR  NZ,GETL1V
000E29 4E29 211FF4          10      LD  HL,KBUF
000E2C 4E2C CD5F43          17      CALL    MSX
000E2F 4E2F 18F1            12      JR  GETL1
       4E31                     GETL1V:
000E31 4E31 5F               4      LD  E,A
000E32 4E32 FE08             7      CP  8
000E34 4E34 CCCE4E          17      CALL    Z,CTRL02
000E37 4E37 FE20             7      CP  020H
000E39 4E39 D4FA4E          17      CALL    NC,INSERT
000E3C 4E3C CD624D          17      CALL    MSGA1
                                
000E3F 4E3F 7B               4      LD  A,E
000E40 4E40 FE0D             7      CP  00DH
000E42 4E42 20DE            12      JR  NZ,GETL1
                                
000E44 4E44 111FF4          10      LD  DE,KBUF
000E47 4E47 3AB0F3          13      LD  A,(LINLEN)
000E4A 4E4A 47               4      LD  B,A
000E4B 4E4B CDAD50          17      CALL    ZERO_MEMORY_DE
                                
000E4E 4E4E 2ACAFB          16      LD  HL,(FSTPOS)
000E51 4E51 3ADCF3          13      LD  A,(CSRY)
000E54 4E54 6F               4      LD  L,A
000E55 4E55 E5              11      PUSH    HL
000E56 4E56 CD2B4F          17      CALL    LOC0
000E59 4E59 4D               4      LD  C,L
000E5A 4E5A 44               4      LD  B,H
000E5B 4E5B E1              10      POP HL
000E5C 4E5C 3AB0F3          13      LD  A,(LINLEN)
000E5F 4E5F 94               4      SUB H
000E60 4E60 3D               4      DEC A
000E61 4E61 5F               4      LD  E,A
000E62 4E62 211FF4          10      LD  HL,KBUF
       4E65                     GETL2:
000E65 4E65 CDBE4E          17      CALL    _SCRN
000E68 4E68 03               6      INC BC
000E69 4E69 77               7      LD  (HL),A
000E6A 4E6A 23               6      INC HL
000E6B 4E6B 1D               4      DEC E
000E6C 4E6C 20F7            12      JR  NZ,GETL2
000E6E 4E6E CD7F4D          17      CALL    MSG_CR
                                
000E71 4E71 FDE1            14      POP IY
000E73 4E73 DDE1            14      POP IX
       4E75                     GETL3:
000E75 4E75 2B               6      DEC HL
000E76 4E76 7E               7      LD  A,(HL)
000E77 4E77 FE21             7      CP  021H
000E79 4E79 D0              11      RET NC
000E7A 4E7A 3600            10      LD  (HL),0
000E7C 4E7C 15               4      DEC D
000E7D 4E7D 20F6            12      JR  NZ,GETL3
000E7F 4E7F C9              10      RET
                                
       4E80                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       4E80                     CONSTX:
       4E80                     CPM_CONST:
000E80 4E80 C5              11      PUSH    BC
000E81 4E81 D5              11      PUSH    DE
000E82 4E82 E5              11      PUSH    HL
000E83 4E83 DDE5            15      PUSH    IX
000E85 4E85 DD219C00        14      LD  IX,CHSNS
000E89 4E89 CDE442          17      CALL    CALSLT_R
000E8C 4E8C DDE1            14      POP IX
000E8E 4E8E E1              10      POP HL
000E8F 4E8F D1              10      POP DE
000E90 4E90 C1              10      POP BC
000E91 4E91 C9              10      RET
                                
       4E92                     _SYS2A:     ;(BDOS)日付の獲得
000E92 4E92 AF               4      XOR A
000E93 4E93 57               4      LD  D,A
000E94 4E94 5F               4      LD  E,A
000E95 4E95 67               4      LD  H,A
000E96 4E96 6F               4      LD  L,A
000E97 4E97 C9              10      RET
                                
       4E98                     _SYS2C:     ;(BDOS)時刻の獲得
000E98 4E98 AF               4      XOR A
000E99 4E99 57               4      LD  D,A
000E9A 4E9A 5F               4      LD  E,A
000E9B 4E9B 67               4      LD  H,A
000E9C 4E9C 6F               4      LD  L,A
000E9D 4E9D C9              10      RET
                                
       4E9E                     POS:
000E9E 4E9E F5              11      PUSH    AF
000E9F 4E9F 2ADCF3          16      LD  HL,(CSRY)
000EA2 4EA2 7D               4      LD  A,L
000EA3 4EA3 6C               4      LD  L,H
000EA4 4EA4 67               4      LD  H,A
000EA5 4EA5 2C               4      INC L
000EA6 4EA6 24               4      INC H
000EA7 4EA7 F1              10      POP AF
000EA8 4EA8 C9              10      RET
                                
       4EA9                     LOC:
000EA9 4EA9 F5              11      PUSH    AF
000EAA 4EAA E5              11      PUSH    HL
000EAB 4EAB 7D               4      LD  A,L
000EAC 4EAC 6C               4      LD  L,H
000EAD 4EAD 67               4      LD  H,A
000EAE 4EAE 2D               4      DEC L
000EAF 4EAF 25               4      DEC H
000EB0 4EB0 DDE5            15      PUSH    IX
000EB2 4EB2 DD21C600        14      LD  IX,POSIT
000EB6 4EB6 CDE442          17      CALL    CALSLT_R
000EB9 4EB9 DDE1            14      POP IX
000EBB 4EBB E1              10      POP HL
000EBC 4EBC F1              10      POP AF
000EBD 4EBD C9              10      RET
                                
       4EBE                     _SCRN:
       4EBE                     SCRN:
000EBE 4EBE E5              11      PUSH    HL
000EBF 4EBF DDE5            15      PUSH    IX
                                
000EC1 4EC1 69               4      LD  L,C
000EC2 4EC2 60               4      LD  H,B
000EC3 4EC3 DD214A00        14      LD  IX,RDVRM
000EC7 4EC7 CDE442          17      CALL    CALSLT_R
                                
000ECA 4ECA DDE1            14      POP IX
000ECC 4ECC E1              10      POP HL
000ECD 4ECD C9              10      RET
                                
       4ECE                     CTRL02:
000ECE 4ECE F5              11      PUSH    AF
000ECF 4ECF D5              11      PUSH    DE
000ED0 4ED0 2ADCF3          16      LD  HL,(CSRY)
000ED3 4ED3 3AB0F3          13      LD  A,(LINLEN)
000ED6 4ED6 4F               4      LD  C,A
000ED7 4ED7 94               4      SUB H   ;CSRX
000ED8 4ED8 C602             7      ADD A,2
000EDA 4EDA 47               4      LD  B,A ;カーソルより右の文字数
000EDB 4EDB 61               4      LD  H,C ;LINLEN
000EDC 4EDC C5              11      PUSH    BC
000EDD 4EDD CD2B4F          17      CALL    LOC0
000EE0 4EE0 C1              10      POP BC
                                
000EE1 4EE1 1620             7      LD  D,020H
       4EE3                     C8X1:
000EE3 4EE3 DD214A00        14      LD  IX,RDVRM
000EE7 4EE7 CDE442          17      CALL    CALSLT_R
000EEA 4EEA 4F               4      LD  C,A
000EEB 4EEB 7A               4      LD  A,D
000EEC 4EEC DD214D00        14      LD  IX,WRTVRM
000EF0 4EF0 CDE442          17      CALL    CALSLT_R
000EF3 4EF3 2B               6      DEC HL
000EF4 4EF4 51               4      LD  D,C
000EF5 4EF5 10EC            13      DJNZ    C8X1
000EF7 4EF7 D1              10      POP DE
000EF8 4EF8 F1              10      POP AF
000EF9 4EF9 C9              10      RET
                                
       4EFA                     INSERT:
000EFA 4EFA F5              11      PUSH    AF
000EFB 4EFB D5              11      PUSH    DE
000EFC 4EFC 2ADCF3          16      LD  HL,(CSRY)
000EFF 4EFF 3AB0F3          13      LD  A,(LINLEN)
000F02 4F02 4F               4      LD  C,A
000F03 4F03 94               4      SUB H   ;CSRX
000F04 4F04 3C               4      INC A
000F05 4F05 47               4      LD  B,A ;カーソルより右の文字数
000F06 4F06 C5              11      PUSH    BC
000F07 4F07 CD2B4F          17      CALL    LOC0
000F0A 4F0A C1              10      POP BC
                                
000F0B 4F0B 1620             7      LD  D,020H
       4F0D                     INS1:
000F0D 4F0D DD214A00        14      LD  IX,RDVRM
000F11 4F11 CDE442          17      CALL    CALSLT_R
000F14 4F14 4F               4      LD  C,A
000F15 4F15 7A               4      LD  A,D
000F16 4F16 DD214D00        14      LD  IX,WRTVRM
000F1A 4F1A CDE442          17      CALL    CALSLT_R
000F1D 4F1D 23               6      INC HL
000F1E 4F1E 51               4      LD  D,C
000F1F 4F1F 10EC            13      DJNZ    INS1
000F21 4F21 D1              10      POP DE
000F22 4F22 F1              10      POP AF
000F23 4F23 C9              10      RET
                                
       4F24                     CONOUT1:
000F24 4F24 59               4      LD  E,C
000F25 4F25 C3584D          10      JP  _PRINT
                                
       4F28                     GETVRAM:
000F28 4F28 2ADCF3          16      LD  HL,(CSRY)
       4F2B                     LOC0:
000F2B 4F2B 2D               4      DEC L
000F2C 4F2C 25               4      DEC H
000F2D 4F2D 4C               4      LD  C,H ;CSRX-1
000F2E 4F2E 5D               4      LD  E,L ;CSRY-1
       4F2F                     LOC1:
000F2F 4F2F 3AB0F3          13      LD  A,(LINLEN)
000F32 4F32 67               4      LD  H,A
000F33 4F33 1600             7      LD  D,0
000F35 4F35 6A               4      LD  L,D ;0
000F36 4F36 0608             7      LD  B,8
       4F38                     LOC2:
000F38 4F38 29              11      ADD HL,HL
000F39 4F39 3001            12      JR  NC,LOC3
000F3B 4F3B 19              11      ADD HL,DE
       4F3C                     LOC3:
000F3C 4F3C 10FA            13      DJNZ    LOC2
000F3E 4F3E 09              11      ADD HL,BC
000F3F 4F3F C9              10      RET
                                
       4F40                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000F40 4F40 212200          10      LD  HL,00022H
000F43 4F43 AF               4      XOR A
000F44 4F44 7D               4      LD  A,L
000F45 4F45 C9              10      RET
                                
       4F46                     _SYS0D:     ;(BDOS)ディスク・リセット
000F46 4F46 218000          10      LD  HL,00080H
000F49 4F49 2226F1          16      LD  (_DTA),HL
000F4C 4F4C C9              10      RET
                                
       4F4D                     _SYS0E:     ;(BDOS)カレントドライブの設定
000F4D 4F4D 323AF1          13      LD  (_DVSW),A
000F50 4F50 C9              10      RET
                                
       4F51                     _SYS0F:     ;(BDOS)ファイルのオープン
000F51 4F51 D5              11      PUSH    DE
000F52 4F52 FDE1            14      POP IY
000F54 4F54 CD9A50          17      CALL    INIT_FILE
000F57 4F57 CD1049          17      CALL    ROM_OPEN
000F5A 4F5A 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
000F5C 4F5C FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
000F60 4F60 FDE5            15      PUSH    IY
000F62 4F62 D1              10      POP DE
000F63 4F63 13               6      INC DE
000F64 4F64 010B00          10      LD  BC,11
000F67 4F67 EDB0                    LDIR
                                ;               Attribute
000F69 4F69 7E               7      LD  A,(HL)
000F6A 4F6A FD770D          19      LD  (IY+13),A
                                ;               TIME
000F6D 4F6D 110B00          10      LD  DE,11
000F70 4F70 19              11      ADD HL,DE
000F71 4F71 7E               7      LD  A,(HL)
000F72 4F72 23               6      INC HL
000F73 4F73 FD7716          19      LD  (IY+22),A
000F76 4F76 7E               7      LD  A,(HL)
000F77 4F77 23               6      INC HL
000F78 4F78 FD7717          19      LD  (IY+23),A
                                ;               DATE
000F7B 4F7B 7E               7      LD  A,(HL)
000F7C 4F7C 23               6      INC HL
000F7D 4F7D FD7714          19      LD  (IY+20),A
000F80 4F80 7E               7      LD  A,(HL)
000F81 4F81 23               6      INC HL
000F82 4F82 FD7715          19      LD  (IY+21),A
                                ;               First cluster
000F85 4F85 7E               7      LD  A,(HL)
000F86 4F86 23               6      INC HL
000F87 4F87 FD771A          19      LD  (IY+26),A
000F8A 4F8A 7E               7      LD  A,(HL)
000F8B 4F8B 23               6      INC HL
000F8C 4F8C FD771B          19      LD  (IY+27),A
                                ;               SIZE
000F8F 4F8F 7E               7      LD  A,(HL)
000F90 4F90 23               6      INC HL
000F91 4F91 FD7710          19      LD  (IY+16),A
000F94 4F94 7E               7      LD  A,(HL)
000F95 4F95 23               6      INC HL
000F96 4F96 FD7711          19      LD  (IY+17),A
000F99 4F99 7E               7      LD  A,(HL)
000F9A 4F9A 23               6      INC HL
000F9B 4F9B FD7712          19      LD  (IY+18),A
000F9E 4F9E 7E               7      LD  A,(HL)
000F9F 4F9F FD7713          19      LD  (IY+19),A
000FA2 4FA2 AF               4      XOR A
000FA3 4FA3 FD770C          19      LD  (IY+12),A
000FA6 4FA6 C9              10      RET
                                
       4FA7                     _SYS10:     ;(BDOS)ファイルのクローズ
000FA7 4FA7 AF               4      XOR A
000FA8 4FA8 C9              10      RET
                                
       4FA9                     S11X1:
000FA9 4FA9 FD7119          19      LD  (IY+25),C       ;RootEntCnt
000FAC 4FAC FD750E          19      LD  (IY+14),L
000FAF 4FAF FD740F          19      LD  (IY+15),H
       4FB2                     SCF_FF_RET:
000FB2 4FB2 37               4      SCF
000FB3 4FB3 9F               4      SBC A,A
000FB4 4FB4 C9              10      RET
                                
       4FB5                     _SYS11:     ;(BDOS)最初のファイルの検索
000FB5 4FB5 ED532EF1        20      LD  (_FCB),DE
000FB9 4FB9 D5              11      PUSH    DE
000FBA 4FBA FDE1            14      POP IY
000FBC 4FBC CD9A50          17      CALL    INIT_FILE
000FBF 4FBF CD2D4B          17      CALL    GET_DIR_DAT
       4FC2                     S12X1:
000FC2 4FC2 CD2C49          17      CALL    FILESE
000FC5 4FC5 30E2            12      JR  NC,S11X1
000FC7 4FC7 0D               4      DEC C
000FC8 4FC8 FD7119          19      LD  (IY+25),C       ;RootEntCnt
000FCB 4FCB 012000          10      LD  BC,32
000FCE 4FCE ED5B26F1        20      LD  DE,(_DTA)
000FD2 4FD2 AF               4      XOR A
000FD3 4FD3 12               7      LD  (DE),A      ;ドライブ番号
000FD4 4FD4 13               6      INC DE
000FD5 4FD5 EDB0                    LDIR            ;ディレクトリエントリ
000FD7 4FD7 FD750E          19      LD  (IY+14),L
000FDA 4FDA FD740F          19      LD  (IY+15),H
000FDD 4FDD C9              10      RET
                                
       4FDE                     _SYS12:
000FDE 4FDE FD2A2EF1        20      LD  IY,(_FCB)
000FE2 4FE2 FDE5            15      PUSH    IY
000FE4 4FE4 D1              10      POP DE
000FE5 4FE5 CD9A50          17      CALL    INIT_FILE
                                
000FE8 4FE8 FD6E0E          19      LD  L,(IY+14)
000FEB 4FEB FD660F          19      LD  H,(IY+15)
000FEE 4FEE FD4E19          19      LD  C,(IY+25)
000FF1 4FF1 18CF            12      JR  S12X1
                                
       4FF3                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000FF3 4FF3 CD134B          17      CALL    SET_FCB
000FF6 4FF6 CDE14A          17      CALL    GETSEQ
000FF9 4FF9 CDCE4A          17      CALL    RB_READ
000FFC 4FFC E5              11      PUSH    HL
000FFD 4FFD CDEE4A          17      CALL    SETSEQ
001000 5000 E1              10      POP HL
       5001                     SREAD:
001001 5001 C601             7      ADD A,001H
001003 5003 D8              11      RET C
                                
001004 5004 7D               4      LD  A,L
001005 5005 D601             7      SUB 001H
001007 5007 9F               4      SBC A,A
001008 5008 E603             7      AND 3
00100A 500A 1F               4      RRA
00100B 500B C9              10      RET
                                
       500C                     _SYS18:     ;(BDOS)ログインベクトルの獲得
00100C 500C 210100          10      LD  HL,00001H
00100F 500F AF               4      XOR A
001010 5010 C9              10      RET
                                
       5011                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001011 5011 3A3AF1          13      LD  A,(_DVSW)
001014 5014 C9              10      RET
                                
       5015                     _SYS1A:     ;(BDOS)DTAの設定
001015 5015 ED5326F1        20      LD  (_DTA),DE
001019 5019 AF               4      XOR A
00101A 501A C9              10      RET
                                
       501B                     _SYS1B:     ;(BDOS)ディスク情報の獲得
00101B 501B 010002          10      LD  BC,512
00101E 501E 11C302          10      LD  DE,707
001021 5021 210000          10      LD  HL,0
001024 5024 DD2130F1        14      LD  IX,_BUF
001028 5028 FD2130F1        14      LD  IY,_BUF
00102C 502C FD3600F9        19      LD  (IY+0),0F9H
001030 5030 3E02             7      LD  A,2
001032 5032 C9              10      RET
                                
       5033                     _SYS21:     ;(BDOS)ランダムな読み出し
001033 5033 CD134B          17      CALL    SET_FCB
                                
001036 5036 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001039 5039 FD6622          19      LD  H,(IY+34)
                                
00103C 503C CDCE4A          17      CALL    RB_READ
00103F 503F 18C0            12      JR  SREAD
                                
       5041                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001041 5041 CD514F          17      CALL    _SYS0F
001044 5044 D8              11      RET C
                                
001045 5045 D5              11      PUSH    DE      ;EX DE,IY
001046 5046 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001048 5048 CD034B          17      CALL    GETSIZE
       504B                     _S24X1:
00104B 504B FD7521          19      LD  (IY+33),L   ;(FCB)Random record
00104E 504E FD7422          19      LD  (IY+34),H
001051 5051 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
001055 5055 FDE3            23      EX  (SP),IY     ;
001057 5057 D1              10      POP DE      ;
                                
001058 5058 AF               4      XOR A
001059 5059 C9              10      RET
                                
       505A                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
00105A 505A E5              11      PUSH    HL
00105B 505B D5              11      PUSH    DE      ;EX DE,IY
00105C 505C FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00105E 505E CDE14A          17      CALL    GETSEQ
001061 5061 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5063                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001063 5063 CD134B          17      CALL    SET_FCB
001066 5066 E5              11      PUSH    HL
001067 5067 FD6E21          19      LD  L,(IY+33)
00106A 506A FD6622          19      LD  H,(IY+34)
00106D 506D 221CF1          16      LD  (RR_LOW),HL
001070 5070 FD6E23          19      LD  L,(IY+35)
001073 5073 FD6624          19      LD  H,(IY+36)
001076 5076 221EF1          16      LD  (RR_HIGH),HL
001079 5079 E1              10      POP HL
00107A 507A CD3047          17      CALL    ROM_READ
00107D 507D ED5B1CF1        20      LD  DE,(RR_LOW)
001081 5081 FD7321          19      LD  (IY+33),E
001084 5084 FD7222          19      LD  (IY+34),D
001087 5087 ED5B1EF1        20      LD  DE,(RR_HIGH)
00108B 508B FD7323          19      LD  (IY+35),E
00108E 508E FD7224          19      LD  (IY+36),D
001091 5091 9F               4      SBC A,A
001092 5092 C9              10      RET
                                
       5093                     _SYS2F:
001093 5093 44               4      LD  B,H
001094 5094 2A26F1          16      LD  HL,(_DTA)
001097 5097 C36C4B          10      JP  DISKIO
                                
       509A                     INIT_FILE:
00109A 509A EB               4      EX  DE,HL
00109B 509B 1143F1          10      LD  DE,FDRV
00109E 509E 010C00          10      LD  BC,1+8+3
0010A1 50A1 EDB0                    LDIR
0010A3 50A3 CD014D          17      CALL    GET_DISK_BANK_FDRV
0010A6 50A6 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0010A9 50A9 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0010AC 50AC C9              10      RET
                                
       50AD                     ZERO_MEMORY_DE:
0010AD 50AD AF               4      XOR A
       50AE                     FILL_MEMORY_DE:
0010AE 50AE 12               7      LD  (DE),A
0010AF 50AF 13               6      INC DE
0010B0 50B0 10FC            13      DJNZ    FILL_MEMORY_DE
0010B2 50B2 C9              10      RET
                                
0010B3 50B3                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 454D5B4D8C4D454D        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 454D454D914DD24D        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 994D454DEC4D804E        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 404F464F4D4F514F        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 A74FB54FDE4F454D        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 F34F454D454D454D        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 0C50115015501B50        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 454D454D454D4150        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 5A50454D454D6350        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 454D454D924E454D        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 984E454D454D9350        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 454D454D454D454D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
