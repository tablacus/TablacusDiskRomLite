                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.21.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
       0001                     USE_MORMAL32K_OR_ASCII16        EQU 1   ;ノーマル32KB/ASCII-16K ROMを作成する
                                
                                    INCLUDE "DISKROM.ASM"
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
       0159                     CALBAS  EQU 00159H
       01F5                     REDCLK  EQU 001F5H  ;SUB
       01F9                     WRTCLK  EQU 001F9H  ;SUB
                                
       269A                     DECADD  EQU 0269AH
       27E6                     DECMUL  EQU 027E6H
       2F8A                     FRCINT  EQU 02F8AH
                                
       303A                     FRCDBL  EQU 0303AH
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
       7D17                     ST_BAS  EQU 07D17H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F847                     ARG EQU 0F847H
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
       FAF8                     EXBRSA  EQU 0FAF8H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBB1                     BASROM  EQU 0FBB1H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCC9                     SLTATR  EQU 0FCC9H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
       FD99                     DEVICE  EQU 0FD99H
                                
       FDDB                     H_PINL  EQU 0FDDBH
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
                                BANK0_SEL EQU   06000H  ;6000-67FF
                                BANK1_SEL EQU   06800H  ;6800-6FFF
                                BANK2_SEL EQU   07000H  ;7000-77FF
                                BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
                                KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
                                KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
                                KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
                                KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
                                KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
                                KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
                                KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
                                #if exists _RAM64K
                                ISC EQU 0F200H
                                #else
       F280                     ISC EQU 0F280H
                                #endif
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
       F240                     NEW_HIMEM   EQU ISC-040H
                                #else
                                NEW_HIMEM   EQU ISC
                                #endif
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU ISC
                                
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0042                    DW  INIT_ROM    ; Main program execution address.
000004 4004 2450                    DW  STATEMENT   ; STATEMENT
000006 4006 5451                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C3AC52          10      JP  DISKIO
000013 4013 C3F252          10      JP  DSKCHG
000016 4016 C34853          10      JP  GETDPB
000019 4019 C33B54          10      JP  CHOICE
00001C 401C C33F54          10      JP  DSKFMT
00001F 401F C34154          10      JP  DSKSTP
000022 4022 C34254          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C33F54          10      JP  DSKFMT
000029 4029 C34154          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C37B54          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite"
            204449534B20524F    
            4D204C697465        
000096 4096                         ALIGN   32
0000A0 40A0 76302E362E302E33        DB  "v0.6.0.3"
0000A8 40A8                         ALIGN   32
       40C0                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
0000C0 40C0 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
0001BD 41BD                         ORG 041BDH
0001BD 41BD C9              10      RET
                                
                                    ;MBR_Partition1 (2DDのデータ)
0001BE 41BE 00                      DB  0       ;ブートフラグ
0001BF 41BF 000000                  DB  0,0,0       ;パーティションの最初のセクタ番号(CHS方式)
0001C2 41C2 01                      DB  1       ;識別子(FAT12)
0001C3 41C3 000000                  DB  0,0,0       ;パーティションの最後のセクタ番号(CHS方式)
0001C6 41C6 10000000                DW  16,0        ;パーティションの最初のセクタ番号(LBA方式)
0001CA 41CA A0050000                DW  1440,0      ;パーティション内のセクタ数(LBA方式)
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    ;MBR_Partition2 (2DDのデータ)
                                    DB  0       ;ブートフラグ
                                    DB  0,0,0       ;パーティションの最初のセクタ番号(CHS方式)
                                    DB  1       ;識別子(FAT12)
                                    DB  0,0,0       ;パーティションの最後のセクタ番号(CHS方式)
                                    DW  16+1440,0   ;パーティションの最初のセクタ番号(LBA方式)
                                    DW  1440,0      ;パーティション内のセクタ数(LBA方式)
                                #endif
                                
0001FE 41FE                         ORG 041FEH
0001FE 41FE 55AA                    DB  055H,0AAH   ;MBR_Sig
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4200                     INIT_ROM:
000200 4200 AF               4      XOR A
000201 4201 2100F3          10      LD  HL,0F300H
000204 4204 0668             7      LD  B,068H
000206 4206 CDDD4C          17      CALL    FILL_MEMORY
                                
000209 4209 3E01             7      LD  A,1
00020B 420B 3221FB          13      LD  (DRVTBL),A
                                
00020E 420E 2140F2          10      LD  HL,NEW_HIMEM
000211 4211 ED4B4AFC        20      LD  BC,(HIMEM)
000215 4215 A7               4      AND A
000216 4216 ED42            15      SBC HL,BC
000218 4218 3008            12      JR  NC,INIT1
00021A 421A ED4B74F6        20      LD  BC,(STKTOP)
00021E 421E 09              11      ADD HL,BC
00021F 421F 2274F6          16      LD  (STKTOP),HL ;起動時の空き容量表示の為
       4222                     INIT1:
000222 4222 AF               4      XOR A
000223 4223 32EAF2          13      LD  (_DVSW),A
000226 4226 3D               4      DEC A       ;0FFH
000227 4227 3299FD          13      LD  (DEVICE),A
                                
00022A 422A 211144          10      LD  HL,AT_ISC
00022D 422D 1180F2          10      LD  DE,ISC
000230 4230 018800          10      LD  BC,ISC_E-ISC
000233 4233 EDB0                    LDIR
                                    
000235 4235 3EC3             7      LD  A,0C3H      ;JP
000237 4237 3243FF          13      LD  (H_GONE),A
00023A 423A 327DF3          13      LD  (BDOS),A
00023D 423D 326BF3          13      LD  (RAMUSE),A
000240 4240 3268F3          13      LD  (ROMUSE),A
000243 4243 2180F2          10      LD  HL,REPLACE_COMMAND
000246 4246 2244FF          16      LD  (H_GONE+1),HL
000249 4249 2131F3          10      LD  HL,H_BDOS
00024C 424C 227EF3          16      LD  (BDOS+1),HL
00024F 424F 21ABF2          10      LD  HL,RAMUSE1
000252 4252 226CF3          16      LD  (RAMUSE+1),HL
000255 4255 21BDF2          10      LD  HL,ROMUSE1
000258 4258 2269F3          16      LD  (ROMUSE+1),HL
                                
00025B 425B 3E                      DB  03EH
00025C 425C F7              12      RST 30H
00025D 425D 3271FE          13      LD  (H_BINS),A
000260 4260 3276FE          13      LD  (H_BINL),A
000263 4263 327BFE          13      LD  (H_FILE),A
000266 4266 3231F3          13      LD  (H_BDOS),A
000269 4269 32DBFD          13      LD  (H_PINL),A
00026C 426C 32A7FF          13      LD  (H_PHYD),A
                                
00026F 426F CD5D43          17      CALL    GTSL1_
000272 4272 3297F2          13      LD  (ROM_SLT),A
000275 4275 32A7F2          13      LD  (ROM_SLT_COPY),A
000278 4278 3272FE          13      LD  (H_BINS+1),A
00027B 427B 3277FE          13      LD  (H_BINL+1),A
00027E 427E 327CFE          13      LD  (H_FILE+1),A
000281 4281 3232F3          13      LD  (H_BDOS+1),A
000284 4284 32DCFD          13      LD  (H_PINL+1),A
000287 4287 32A8FF          13      LD  (H_PHYD+1),A
00028A 428A 3222FB          13      LD  (DRVTBL+1),A
00028D 428D 3248F3          13      LD  (MASTERS),A
                                
000290 4290 21C646          10      LD  HL,ROM_LOAD
000293 4293 2273FE          16      LD  (H_BINS+2),HL
000296 4296 217A48          10      LD  HL,ROM_RUN
000299 4299 2278FE          16      LD  (H_BINL+2),HL
00029C 429C 218848          10      LD  HL,ROM_FILES
00029F 429F 227DFE          16      LD  (H_FILE+2),HL
0002A2 42A2 21E054          10      LD  HL,ROM_BDOS
0002A5 42A5 2233F3          16      LD  (H_BDOS+2),HL
0002A8 42A8 21D644          10      LD  HL,ROM_BOOT
0002AB 42AB 22DDFD          16      LD  (H_PINL+2),HL
0002AE 42AE 21AC52          10      LD  HL,DISKIO
0002B1 42B1 22A9FF          16      LD  (H_PHYD+2),HL
                                
0002B4 42B4 3E                      DB  03EH
0002B5 42B5 C9              10      RET
0002B6 42B6 327FFE          13      LD  (H_FILE+4),A
0002B9 42B9 3275FE          13      LD  (H_BINS+4),A
0002BC 42BC 327AFE          13      LD  (H_BINL+4),A
0002BF 42BF 3235F3          13      LD  (H_BDOS+4),A
0002C2 42C2 32DFFD          13      LD  (H_PINL+4),A
0002C5 42C5 32ABFF          13      LD  (H_PHYD+4),A
                                
0002C8 42C8 AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
0002C9 42C9 320060          13      LD  (ASCII16_BANK0_SEL),A       ;似非RAM対策でバンク0を設定
0002CC 42CC 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK0_SEL),A           ;似非RAM対策でバンク0を設定
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0002CF 42CF 3A0060          13      LD  A,(BANK1_ADR)
0002D2 42D2 FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
0002D4 42D4 2876            12      JR  Z,NOT_BANK_TYPE
0002D6 42D6 3E01             7      LD  A,DISK_BANK
0002D8 42D8 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0002DB 42DB CD3801          17      CALL    RSLREG      ;read primary slot #
0002DE 42DE 07               4      RLCA
0002DF 42DF 07               4      RLCA
0002E0 42E0 F5              11      PUSH    AF
0002E1 42E1 1605             7      LD  D,4+1
0002E3 42E3 CD6443          17      CALL    GTSL2_
0002E6 42E6 3244F3          13      LD  (RAMAD3),A
0002E9 42E9 F1              10      POP AF
0002EA 42EA 07               4      RLCA
0002EB 42EB 07               4      RLCA
0002EC 42EC 1603             7      LD  D,2+1
0002EE 42EE CD6443          17      CALL    GTSL2_
0002F1 42F1 2680             7      LD  H,080H
0002F3 42F3 CD8143          17      CALL    CHK_RAM
0002F6 42F6 3243F3          13      LD  (RAMAD2),A
       42F9                     RAMCHK2:
0002F9 42F9 3A44F3          13      LD  A,(RAMAD3)
0002FC 42FC 2640             7      LD  H,040H
0002FE 42FE CD8143          17      CALL    CHK_RAM
000301 4301 3242F3          13      LD  (RAMAD1),A
       4304                     RAMCHK1:
000304 4304 3A44F3          13      LD  A,(RAMAD3)
000307 4307 2600             7      LD  H,00H
000309 4309 CD8143          17      CALL    CHK_RAM
00030C 430C 3241F3          13      LD  (RAMAD0),A
       430F                     RAMCHK0:
00030F 430F 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000312 4312 010F00          10      LD  BC,0000FH       ;切り上げ
000315 4315 09              11      ADD HL,BC
000316 4316 7D               4      LD  A,L
                                
000317 4317 0604             7      LD  B,4
       4319                     B_DRIVE1:
000319 4319 CB3C             8      SRL H
00031B 431B 1F               4      RRA
00031C 431C 10FB            13      DJNZ    B_DRIVE1
                                
00031E 431E C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000320 4320 32E9F2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
                                    ;拡張スロットの選択を設定する
000323 4323 3A97F2          13      LD  A,(ROM_SLT)
000326 4326 57               4      LD  D,A
000327 4327 E60C             7      AND 00CH
000329 4329 5F               4      LD  E,A
00032A 432A 7A               4      LD  A,D
00032B 432B E603             7      AND 3
00032D 432D 87               4      ADD A,A
00032E 432E 87               4      ADD A,A
00032F 432F 87               4      ADD A,A
000330 4330 37               4      SCF
000331 4331 8F               4      ADC A,A
000332 4332 B3               4      OR  E
000333 4333 5F               4      LD  E,A
000334 4334 1600             7      LD  D,0
000336 4336 21C9FC          10      LD  HL,SLTATR
000339 4339 19              11      ADD HL,DE
00033A 433A 3660            10      LD  (HL),060H
                                    ;CTRL+STOPを抑制する
00033C 433C 3E01             7      LD  A,1
00033E 433E 32B1FB          13      LD  (BASROM),A
                                    ;BASICを起動する
000341 4341 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000345 4345 DD21177D        14      LD  IX,ST_BAS   ;continue start of MSX-BASIC without executing BASIC programs in ROM
000349 4349 C35901          10      JP  CALBAS
                                
       434C                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
00034C 434C 21C040          10      LD  HL,MSG_ERROR_ROM_MODE
00034F 434F CD9C44          17      CALL    MSX
000352 4352 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000356 4356 DD219F00        14      LD  IX,CHGET
00035A 435A C31C00          10      JP  _CALSLT
                                
       435D                     GTSL1_:             ;自分のいるスロットを知る
00035D 435D CD3801          17      CALL    RSLREG      ;read primary slot #
000360 4360 0F               4      RRCA
000361 4361 0F               4      RRCA
000362 4362 1601             7      LD  D,1
       4364                     GTSL2_:
000364 4364 E603             7      AND 3       ;[A]=000000PP
000366 4366 5F               4      LD  E,A     ;[E]=000000PP
000367 4367 21C1FC          10      LD  HL,EXPTBL
00036A 436A 85               4      ADD A,L     ;桁上りは無い
00036B 436B 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00036C 436C 7B               4      LD  A,E     ;[A]=000000PP
00036D 436D CB7E            13      BIT 7,(HL)
00036F 436F C8              11      RET Z
000370 4370 7D               4      LD  A,L     ;point to SLTTBL entry
000371 4371 C604             7      ADD A,4     ;桁上りは無い
000373 4373 6F               4      LD  L,A
000374 4374 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4375                     GTSL3_:
000375 4375 15               4      DEC D
000376 4376 2803            12      JR  Z,GTSL4_:
000378 4378 0F               4      RRCA
000379 4379 18FA            12      JR  GTSL3_:
       437B                     GTSL4_:
00037B 437B E60C             7      AND 00CH        ;[A] = 0000SS00
00037D 437D B3               4      OR  E       ;[A] = 0000SSPP
00037E 437E F680             7      OR  080H        ;[A] = 1000SSPP
000380 4380 C9              10      RET
                                
       4381                     CHK_RAM:
000381 4381 E5              11      PUSH    HL
000382 4382 CDD643          17      CALL    CHK_RAM0
000385 4385 E1              10      POP HL
000386 4386 C8              11      RET Z
000387 4387 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00038A 438A E680             7      AND 080H
00038C 438C CDAD43          17      CALL    CHK_RAM_SLT
00038F 438F C8              11      RET Z
000390 4390 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000393 4393 E680             7      AND 080H
000395 4395 C601             7      ADD A,1
000397 4397 CDAD43          17      CALL    CHK_RAM_SLT
00039A 439A C8              11      RET Z
00039B 439B 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00039E 439E E680             7      AND 080H
0003A0 43A0 C602             7      ADD A,2
0003A2 43A2 CDAD43          17      CALL    CHK_RAM_SLT
0003A5 43A5 C8              11      RET Z
0003A6 43A6 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
0003A9 43A9 E680             7      AND 080H
0003AB 43AB C603             7      ADD A,3
       43AD                     CHK_RAM_SLT:
0003AD 43AD E5              11      PUSH    HL
0003AE 43AE CDD643          17      CALL    CHK_RAM0        ;スロット#X or X-0
0003B1 43B1 E1              10      POP HL
0003B2 43B2 C8              11      RET Z
0003B3 43B3 CB79             8      BIT 7,C
0003B5 43B5 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0003B7 43B7 79               4      LD  A,C
0003B8 43B8 C604             7      ADD A,4*1           ;スロット#X-1
0003BA 43BA E5              11      PUSH    HL
0003BB 43BB CDD643          17      CALL    CHK_RAM0
0003BE 43BE E1              10      POP HL
0003BF 43BF C8              11      RET Z
0003C0 43C0 79               4      LD  A,C
0003C1 43C1 C608             7      ADD A,4*2           ;スロット#X-2
0003C3 43C3 E5              11      PUSH    HL
0003C4 43C4 CDD643          17      CALL    CHK_RAM0
0003C7 43C7 E1              10      POP HL
0003C8 43C8 C8              11      RET Z
0003C9 43C9 79               4      LD  A,C
0003CA 43CA C60C             7      ADD A,4*3           ;スロット#X-3
0003CC 43CC E5              11      PUSH    HL
0003CD 43CD CDD643          17      CALL    CHK_RAM0
0003D0 43D0 E1              10      POP HL
       43D1                     CHK_RAM_E:
0003D1 43D1 AF               4      XOR A
0003D2 43D2 3C               4      INC A           ;ZF=0にする
0003D3 43D3 3E00             7      LD  A,0
0003D5 43D5 C9              10      RET
                                
       43D6                     CHK_RAM0:
0003D6 43D6 4F               4      LD  C,A
0003D7 43D7 3A97F2          13      LD  A,(ROM_SLT)
0003DA 43DA B9               4      CP  C
0003DB 43DB 28F4            12      JR  Z,CHK_RAM_E
0003DD 43DD 2E00             7      LD  L,0
       43DF                     CHK_RAM1:
0003DF 43DF 79               4      LD  A,C
0003E0 43E0 CDCE44          17      CALL    RDSLTX
0003E3 43E3 C6E5             7      ADD A,0E5H
0003E5 43E5 47               4      LD  B,A
0003E6 43E6 5F               4      LD  E,A
0003E7 43E7 79               4      LD  A,C
0003E8 43E8 C5              11      PUSH    BC
0003E9 43E9 CD1400          17      CALL    _WRSLT
0003EC 43EC C1              10      POP BC
0003ED 43ED 79               4      LD  A,C
0003EE 43EE CDCE44          17      CALL    RDSLTX
0003F1 43F1 B8               4      CP  B
0003F2 43F2 C0              11      RET NZ
0003F3 43F3 D6E5             7      SUB 0E5H
0003F5 43F5 79               4      LD  A,C
0003F6 43F6 5F               4      LD  E,A
0003F7 43F7 C5              11      PUSH    BC
0003F8 43F8 CD1400          17      CALL    _WRSLT
0003FB 43FB C1              10      POP BC
0003FC 43FC 24               4      INC H
0003FD 43FD 7D               4      LD  A,L
0003FE 43FE C604             7      ADD A,4
000400 4400 6F               4      LD  L,A
000401 4401 20DC            12      JR  NZ,CHK_RAM1
000403 4403 79               4      LD  A,C     ;ZF=1のハズ
000404 4404 C9              10      RET
                                
       4405                     CALSLT_R:
000405 4405 C5              11      PUSH    BC
000406 4406 E5              11      PUSH    HL
000407 4407 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00040B 440B CD1C00          17      CALL    _CALSLT
00040E 440E E1              10      POP HL
00040F 440F C1              10      POP BC
000410 4410 C9              10      RET
                                
       4411                     AT_ISC:
000411 F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
000411 F280 FEB7             7      CP  0B7H            ;FILES
000413 F282 CC7BFE          17      CALL    Z,H_FILE
000416 F285 FEB5             7      CP  0B5H            ;LOAD
000418 F287 CA71FE          10      JP  Z,H_BINS
00041B F28A FE8A             7      CP  08AH            ;RUN
00041D F28C CA76FE          10      JP  Z,H_BINL
000420 F28F FED6             7      CP  0D6H            ;COPY
000422 F291 2813            12      JR  Z,FIX_COPY
000424 F293 FECF             7      CP  0CFH            ;BLOAD
000426 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
000427 F296 F7              12      RST 30H
       F297                     ROM_SLT:
000428 F297 00                      DB  0
000429 F298 A847                    DW  ROM_BLOAD
00042B F29A F5              11      PUSH    AF
00042C F29B E5              11      PUSH    HL
00042D F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
000430 F29F E1              10      POP HL
000431 F2A0 F1              10      POP AF
000432 F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000434 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000436 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000437 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000438 F2A7 00                      DB  0
000439 F2A8 2A49                    DW  ROM_COPY
00043B F2AA C9              10      RET
       F2AB                     RAMUSE1:
00043C F2AB 3A42F3          13      LD  A,(RAMAD1)
00043F F2AE 1810            12      JR  ENASLT2
       F2B0                     CAL_MP:
000441 F2B0 2640             7      LD  H,040H
000443 F2B2 3AC1FC          13      LD  A,(EXPTBL)
000446 F2B5 CD2400          17      CALL    _ENASLT
000449 F2B8 CD1C00          17      CALL    _CALSLT
00044C F2BB 2640             7      LD  H,040H
       F2BD                     ROMUSE1:
00044E F2BD 3A97F2          13      LD  A,(ROM_SLT)
       F2C0                     ENASLT2:
000451 F2C0 C32400          10      JP  _ENASLT
                                
       F2C3                     _RESULT:
000454 F2C3 00                      DB  0
       F2C4                     _BANK:
000455 F2C4 00                      DB  0
       F2C5                     _BANK1:
000456 F2C5 00                      DB  0
       F2C6                     CLSZ:               ;クラスタサイズ
000457 F2C6 0004                    DW  1024
       F2C7                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2C8                     SECSZ:              ;セクタサイズ
000459 F2C8 0002                    DW  512
       F2C9                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2CA                     RR_LOW:
00045B F2CA 0000                    DW  0
       F2CB                     RR_MID  EQU $-1
       F2CC                     RR_HIGH:
00045D F2CC 0000                    DW  0
       F2CE                     _CLPS:
00045F F2CE 0000                    DW  0
       F2D0                     _LEFT:
000461 F2D0 0000                    DW  0
       F2D2                     _DTPS:
000463 F2D2 0000                    DW  0
       F2D4                     _DTA:
000465 F2D4 0000                    DW  0
       F2D6                     FLG_LDIR:
000467 F2D6 00                      DB  0
       F2D7                     _FCB:
000468 F2D7 0000                    DW  0
       F2D9                     _BUF:
       F2D9                     _BUF_LO:        ;LOGICAL OPERATION
00046A F2D9 00                      DB  0
       F2DA                     _BUF_ST:
00046B F2DA 0000                    DW  0
       F2DC                     _BUF_EN:
00046D F2DC 0000                    DW  0
       F2DE                     _BUF_EX:
       F2DE                     _BUF_W:
00046F F2DE 0000                    DW  0
       F2E0                     _BUF_H:
000471 F2E0 0000                    DW  0
       F2E2                     _BUF_X:
000473 F2E2 0000                    DW  0
       F2E4                     _BUF_Y:
000475 F2E4 00                      DB  0
       F2E5                     _BUF_P:
000476 F2E5 00                      DB  0
       F2E6                     _BUF_O:
000477 F2E6 00                      DB  0
       F2E7                     DTAX:
000478 F2E7 0000                    DW  0
       F2E9                     B_DRIVE:
00047A F2E9 00                      DB  0
       F2EA                     _DVSW:          ;カレントドライブ
00047B F2EA 00                      DB  0
       F2EB                     _CD:            ;カレントディレクトリ
00047C F2EB 0000                    DW  0
       F2ED                     DIRENT1:
00047E F2ED 0000                    DW  0
       F2EF                     _DIR_BANK:
000480 F2EF 00                      DB  0
       F2F0                     LEFTX:
000481 F2F0 0000                    DW  0
       F2F2                     PARAM0:
000483 F2F2 0000                    DW  0
       F2F4                     PARAM1:
000485 F2F4 0000                    DW  0
       F2F6                     _CDX:
000487 F2F6 0000                    DW  0
       F2F8                     FDRV:
000489 F2F8 00                      DB  0
       F2F9                     FNAME:
00048A F2F9                         DS  8+3
       F304                     _HL:
000495 F304 0000                    DW  0
       F306                     _SP:
000497 F306 0000                    DW  0
       F307                     _SP_H   EQU $-1
       F308                     ISC_E:
000499 4499                         ORG $$+RUN          ;$DEPHASE
                                
       4499                     MSX1:
000499 4499 CDF954          17      CALL    MSGA1
       449C                     MSX:
00049C 449C 7E               7      LD  A,(HL)
00049D 449D 23               6      INC HL
00049E 449E B7               4      OR  A
00049F 449F 20F8            12      JR  NZ,MSX1
0004A1 44A1 C9              10      RET
                                
       44A2                     PRTHX:
0004A2 44A2 F5              11      PUSH    AF
0004A3 44A3 07               4      RLCA
0004A4 44A4 07               4      RLCA
0004A5 44A5 07               4      RLCA
0004A6 44A6 07               4      RLCA
0004A7 44A7 CDAB44          17      CALL    PRTA2
0004AA 44AA F1              10      POP AF
       44AB                     PRTA2:
0004AB 44AB CDB144          17      CALL    ASC
0004AE 44AE C3F554          10      JP  MSG_A
                                    
       44B1                     ASC:
0004B1 44B1 E60F             7      AND $0F
0004B3 44B3 F630             7      OR  $30
0004B5 44B5 FE3A             7      CP  $3A
0004B7 44B7 D8              11      RET C
0004B8 44B8 C607             7      ADD A,7
0004BA 44BA C9              10      RET
                                
       44BB                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
0004BB 44BB CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0004BE 44BE 23               6      INC HL
0004BF 44BF CDF554          17      CALL    MSG_A
0004C2 44C2 10F7            13      DJNZ    MSN
0004C4 44C4 C9              10      RET
                                
       44C5                     RDSLT_ROM3:
0004C5 44C5 7E               7      LD  A,(HL)
0004C6 44C6 C9              10      RET
       44C7                     RDSLT_ROM:
0004C7 44C7 CB7C             8      BIT 7,H
0004C9 44C9 28FA            12      JR  Z,RDSLT_ROM3
       44CB                     RDSLT_ROM2:
0004CB 44CB 3A97F2          13      LD  A,(ROM_SLT)
       44CE                     RDSLTX:
0004CE 44CE C5              11      PUSH    BC
0004CF 44CF D5              11      PUSH    DE
0004D0 44D0 CD0C00          17      CALL    _RDSLT
0004D3 44D3 D1              10      POP DE
0004D4 44D4 C1              10      POP BC
0004D5 44D5 C9              10      RET
                                
       44D6                     ROM_BOOT:
0004D6 44D6 3E                      DB  03EH
0004D7 44D7 C9              10      RET
0004D8 44D8 32DBFD          13      LD  (H_PINL),A
0004DB 44DB 3ACAFF          13      LD  A,(EXTBIO)
0004DE 44DE FEF7             7      CP  0F7H        ;RST 30H
0004E0 44E0 280A            12      JR  Z,EXTBIO_OK
0004E2 44E2 3E                      DB  03EH
0004E3 44E3 C9              10      RET
0004E4 44E4 21CAFF          10      LD  HL,EXTBIO
0004E7 44E7 061D             7      LD  B,29
0004E9 44E9 CDDD4C          17      CALL    FILL_MEMORY
       44EC                     EXTBIO_OK:
0004EC 44EC 211945          10      LD  HL,DELOK
0004EF 44EF CD9C44          17      CALL    MSX
                                
0004F2 44F2 AF               4      XOR A
0004F3 44F3 3240F3          13      LD  (REBOOT),A
0004F6 44F6 2A48FC          16      LD  HL,(BOTTOM)
0004F9 44F9 110040          10      LD  DE,16384
0004FC 44FC 19              11      ADD HL,DE
0004FD 44FD 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0004FF 44FF 57               4      LD  D,A
000500 4500 0601             7      LD  B,1
000502 4502 2100C0          10      LD  HL,0C000H
000505 4505 CDAC52          17      CALL    DISKIO
                                
000508 4508 116BF3          10      LD  DE,RAMUSE
00050B 450B AF               4      XOR A
00050C 450C CD1EC0          17      CALL    0C01EH
00050F 450F 116BF3          10      LD  DE,RAMUSE
000512 4512 37               4      SCF
000513 4513 CD1EC0          17      CALL    0C01EH
       4516                     BOOT1:
000516 4516 C34254          10      JP  BASENT
                                
       4519                     DELOK:
000519 4519 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       451D                     ROM_LDIR:
00051D 451D 3AD6F2          13      LD  A,(FLG_LDIR)
000520 4520 B7               4      OR  A
000521 4521 206A            12      JR  NZ,ROM_LDIRVM
000523 4523 CB7A             8      BIT 7,D
000525 4525 CABD45          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
       4528                     LDIRA:
000528 4528 F3               4      DI
000529 4529 ED7306F3        20      LD  (_SP),SP
00052D 452D 3A07F3          13      LD  A,(_SP_H)
000530 4530 FEC0             7      CP  0C0H
000532 4532 3003            12      JR  NC,SPJ1
000534 4534 3180F2          10      LD  SP,SP32
       4537                     SPJ1:
       4537                     LDIR1:
000537 4537 78               4      LD  A,B
000538 4538 B1               4      OR  C
000539 4539 284D            12      JR  Z,LDIRE
                                
00053B 453B C5              11      PUSH    BC
00053C 453C D5              11      PUSH    DE
00053D 453D E5              11      PUSH    HL
00053E 453E 3A97F2          13      LD  A,(ROM_SLT)
000541 4541 2680             7      LD  H,080H
000543 4543 CD2400          17      CALL    _ENASLT
000546 4546 E1              10      POP HL
000547 4547 D1              10      POP DE
000548 4548 C1              10      POP BC
       4549                     LDIR2:
000549 4549 7A               4      LD  A,D
00054A 454A FEC0             7      CP  0C0H
00054C 454C 302C            12      JR  NC,LDIR4
                                
00054E 454E C5              11      PUSH    BC
00054F 454F D5              11      PUSH    DE
000550 4550 115EF5          10      LD  DE,BUF
                                
000553 4553 78               4      LD  A,B
000554 4554 B7               4      OR  A
000555 4555 2803            12      JR  Z,LDIR3
000557 4557 010001          10      LD  BC,00100H
       455A                     LDIR3:
00055A 455A C5              11      PUSH    BC
00055B 455B EDB0                    LDIR
00055D 455D 2204F3          16      LD  (_HL),HL
                                
000560 4560 3A43F3          13      LD  A,(RAMAD2)
000563 4563 2680             7      LD  H,080H
000565 4565 CD2400          17      CALL    _ENASLT
                                
000568 4568 C1              10      POP BC
000569 4569 D1              10      POP DE
00056A 456A 215EF5          10      LD  HL,BUF
00056D 456D EDB0                    LDIR
                                
00056F 456F 2A04F3          16      LD  HL,(_HL)
000572 4572 C1              10      POP BC
000573 4573 78               4      LD  A,B
000574 4574 B7               4      OR  A
000575 4575 2811            12      JR  Z,LDIRE
000577 4577 05               4      DEC B
000578 4578 18BD            12      JR  LDIR1
       457A                     LDIR4:
                                #endif
00057A 457A EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
       457C                     LDIRE2:
00057C 457C D5              11      PUSH    DE
00057D 457D E5              11      PUSH    HL
00057E 457E 3A43F3          13      LD  A,(RAMAD2)
000581 4581 2680             7      LD  H,080H
000583 4583 CD2400          17      CALL    _ENASLT
000586 4586 E1              10      POP HL
000587 4587 D1              10      POP DE
       4588                     LDIRE:
000588 4588 ED7B06F3        20      LD  SP,(_SP)
                                #endif
00058C 458C C9              10      RET
                                
       458D                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
00058D 458D F3               4      DI
00058E 458E ED7306F3        20      LD  (_SP),SP
000592 4592 3A07F3          13      LD  A,(_SP_H)
000595 4595 FEC0             7      CP  0C0H
000597 4597 3003            12      JR  NC,SPJ2
000599 4599 3180F2          10      LD  SP,SP32
       459C                     SPJ2:
00059C 459C C5              11      PUSH    BC
00059D 459D D5              11      PUSH    DE
00059E 459E E5              11      PUSH    HL
00059F 459F 3A97F2          13      LD  A,(ROM_SLT)
0005A2 45A2 2680             7      LD  H,080H
0005A4 45A4 CD2400          17      CALL    _ENASLT
0005A7 45A7 E1              10      POP HL
0005A8 45A8 D1              10      POP DE
0005A9 45A9 C1              10      POP BC
                                #endif
0005AA 45AA C5              11      PUSH    BC
0005AB 45AB D5              11      PUSH    DE
0005AC 45AC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005B0 45B0 DD215C00        14      LD  IX,LDIRVM
0005B4 45B4 CD1C00          17      CALL    _CALSLT
0005B7 45B7 E1              10      POP HL
0005B8 45B8 C1              10      POP BC
0005B9 45B9 09              11      ADD HL,BC
0005BA 45BA EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0005BB 45BB 18BF            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       45BD                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
0005BD 45BD F3               4      DI
0005BE 45BE ED7306F3        20      LD  (_SP),SP
0005C2 45C2 3A07F3          13      LD  A,(_SP_H)
0005C5 45C5 FEC0             7      CP  0C0H
0005C7 45C7 3003            12      JR  NC,SPJ3
0005C9 45C9 3180F2          10      LD  SP,SP32
       45CC                     SPJ3:
0005CC 45CC C5              11      PUSH    BC
0005CD 45CD D5              11      PUSH    DE
0005CE 45CE E5              11      PUSH    HL
0005CF 45CF 3A97F2          13      LD  A,(ROM_SLT)
0005D2 45D2 2680             7      LD  H,080H
0005D4 45D4 CD2400          17      CALL    _ENASLT
0005D7 45D7 E1              10      POP HL
0005D8 45D8 D1              10      POP DE
0005D9 45D9 C1              10      POP BC
                                #endif
       45DA                     ROM_LDIRSLT1:
0005DA 45DA EB               4      EX  DE,HL
       45DB                     RLDIRSLT1:
0005DB 45DB CB7C             8      BIT 7,H
0005DD 45DD 2021            12      JR  NZ,RLDIRSLT_EXIT
0005DF 45DF 1A               7      LD  A,(DE)
0005E0 45E0 13               6      INC DE
0005E1 45E1 C5              11      PUSH    BC
0005E2 45E2 D5              11      PUSH    DE
0005E3 45E3 E5              11      PUSH    HL
0005E4 45E4 5F               4      LD  E,A
                                
0005E5 45E5 0141F3          10      LD  BC,RAMAD0
0005E8 45E8 7C               4      LD  A,H
0005E9 45E9 07               4      RLCA
0005EA 45EA 07               4      RLCA
0005EB 45EB E603             7      AND 3
0005ED 45ED 81               4      ADD A,C
0005EE 45EE 4F               4      LD  C,A
0005EF 45EF 0A               7      LD  A,(BC)
       45F0                     RLDIRSLT2:
0005F0 45F0 CD1400          17      CALL    _WRSLT
0005F3 45F3 08               4      EX  AF,AF'
0005F4 45F4 E1              10      POP HL
0005F5 45F5 D1              10      POP DE
0005F6 45F6 C1              10      POP BC
0005F7 45F7 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0005F9 45F9 EADB45          10      JP  PE,RLDIRSLT1
0005FC 45FC EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0005FD 45FD C37C45          10      JP  LDIRE2
       4600                     RLDIRSLT_EXIT:
000600 4600 EB               4      EX  DE,HL
000601 4601 C33745          10      JP  LDIR1
                                #else
                                    RET
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    LDIR
                                    RET
                                #endif
                                
       4604                     END_OF_LINE:
000604 4604 215EF5          10      LD  HL,BUF
       4607                     EOL1:
000607 4607 7E               7      LD  A,(HL)
000608 4608 C8              11      RET Z
000609 4609 FE0D             7      CP  00DH
00060B 460B 2807            12      JR  Z,EOLE
00060D 460D FE0A             7      CP  00AH
00060F 460F 2803            12      JR  Z,EOLE
000611 4611 23               6      INC HL
000612 4612 18F3            12      JR  EOL1
       4614                     EOLE:
000614 4614 3600            10      LD  (HL),0
000616 4616 23               6      INC HL
000617 4617 7E               7      LD  A,(HL)
000618 4618 FE0A             7      CP  00AH
00061A 461A C0              11      RET NZ
00061B 461B 23               6      INC HL
00061C 461C C9              10      RET
                                
       461D                     ROM_LOAD_ASCII:
00061D 461D 210000          10      LD  HL,0
000620 4620 22DAF2          16      LD  (_BUF_ST),HL    ;読み出し位置
000623 4623 2A76F6          16      LD  HL,(TXTTAB)
000626 4626 22DCF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000629 4629 215EF5          10      LD  HL,BUF
00062C 462C 22D4F2          16      LD  (_DTA),HL
       462F                     RLOAD_A1:
00062F 462F 2ADAF2          16      LD  HL,(_BUF_ST)
000632 4632 22CAF2          16      LD  (RR_LOW),HL
000635 4635 210201          10      LD  HL,258
000638 4638 CD4A4B          17      CALL    ROM_READ
00063B 463B 7C               4      LD  A,H
00063C 463C B5               4      OR  L
00063D 463D 2879            12      JR  Z,RLOAD_AEND
00063F 463F 015EF5          10      LD  BC,BUF
000642 4642 09              11      ADD HL,BC
000643 4643 3600            10      LD  (HL),0
000645 4645 CD0446          17      CALL    END_OF_LINE
000648 4648 015EF5          10      LD  BC,BUF
00064B 464B A7               4      AND A
00064C 464C ED42            15      SBC HL,BC
00064E 464E 2810            12      JR  Z,RLOAD_A2
000650 4650 4D               4      LD  C,L
000651 4651 44               4      LD  B,H
000652 4652 ED5BDAF2        20      LD  DE,(_BUF_ST)
000656 4656 19              11      ADD HL,DE
000657 4657 22DAF2          16      LD  (_BUF_ST),HL
00065A 465A 3A5EF5          13      LD  A,(BUF)
00065D 465D B7               4      OR  A
00065E 465E 28CF            12      JR  Z,RLOAD_A1
       4660                     RLOAD_A2:
000660 4660 115EF5          10      LD  DE,BUF
000663 4663 CD144D          17      CALL    SPCUTEX
000666 4666 1A               7      LD  A,(DE)
000667 4667 B7               4      OR  A
000668 4668 284E            12      JR  Z,RLOAD_AEND
00066A 466A CD264D          17      CALL    GETNUM
00066D 466D 7C               4      LD  A,H
00066E 466E B5               4      OR  L
00066F 466F CA8F47          10      JP  Z,ERROR_DIRECT_IN_FILE
000672 4672 DD2ADCF2        20      LD  IX,(_BUF_EN)
000676 4676 DD7502          19      LD  (IX+2),L
000679 4679 DD7403          19      LD  (IX+3),H
                                
00067C 467C CD0D4D          17      CALL    SPCUT
00067F 467F EB               4      EX  DE,HL
000680 4680 DDE5            15      PUSH    IX
000682 4682 DD21B242        14      LD  IX,CRUNCH
000686 4686 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00068A 468A CD1C00          17      CALL    _CALSLT
00068D 468D DDE1            14      POP IX
00068F 468F EB               4      EX  DE,HL
000690 4690 111FF4          10      LD  DE,KBUF
000693 4693 37               4      SCF
000694 4694 ED52            15      SBC HL,DE
000696 4696 CA8F47          10      JP  Z,ERROR_DIRECT_IN_FILE
000699 4699 DA8F47          10      JP  C,ERROR_DIRECT_IN_FILE
00069C 469C 4D               4      LD  C,L
00069D 469D 44               4      LD  B,H
00069E 469E 2ADCF2          16      LD  HL,(_BUF_EN)
0006A1 46A1 110400          10      LD  DE,4
0006A4 46A4 19              11      ADD HL,DE
0006A5 46A5 111FF4          10      LD  DE,KBUF
                                
0006A8 46A8 EB               4      EX  DE,HL
0006A9 46A9 EDB0                    LDIR
0006AB 46AB EB               4      EX  DE,HL
                                
0006AC 46AC DD7500          19      LD  (IX+0),L
0006AF 46AF DD7401          19      LD  (IX+1),H
0006B2 46B2 22DCF2          16      LD  (_BUF_EN),HL
0006B5 46B5 C32F46          10      JP  RLOAD_A1
                                
       46B8                     RLOAD_AEND:
0006B8 46B8 2ADCF2          16      LD  HL,(_BUF_EN)
0006BB 46BB AF               4      XOR A
0006BC 46BC 77               7      LD  (HL),A
0006BD 46BD 23               6      INC HL
0006BE 46BE 77               7      LD  (HL),A
0006BF 46BF 23               6      INC HL
0006C0 46C0 22DCF2          16      LD  (_BUF_EN),HL
0006C3 46C3 C35247          10      JP  RLOAD_END1
                                
       46C6                     ROM_LOAD:
0006C6 46C6 CDF848          17      CALL    INIT_PARAM
0006C9 46C9 7E               7      LD  A,(HL)
0006CA 46CA FE2C             7      CP  ','
0006CC 46CC 2003            12      JR  NZ,ROM_LOAD0
0006CE 46CE 23               6      INC HL
0006CF 46CF 7E               7      LD  A,(HL)
0006D0 46D0 2B               6      DEC HL
       46D1                     ROM_LOAD0:
0006D1 46D1 32BEFC          13      LD  (RUNBNF),A
0006D4 46D4 CDEB4B          17      CALL    FILE_B
0006D7 46D7 3AF9F2          13      LD  A,(FNAME)
0006DA 46DA FE20             7      CP  020H
0006DC 46DC CAE64B          10      JP  Z,ROM_ORG
                                
0006DF 46DF CD7D4D          17      CALL    ROM_OPEN
0006E2 46E2 DA9B47          10      JP  C,ERROR_FILE_NOT_FOUND
       46E5                     ROM_LOAD1:
0006E5 46E5 21D9F2          10      LD  HL,_BUF
0006E8 46E8 22D4F2          16      LD  (_DTA),HL
0006EB 46EB 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0006EE 46EE CD4A4B          17      CALL    ROM_READ
0006F1 46F1 3AD9F2          13      LD  A,(_BUF)
0006F4 46F4 3C               4      INC A
0006F5 46F5 C21D46          10      JP  NZ,ROM_LOAD_ASCII
0006F8 46F8 2A76F6          16      LD  HL,(TXTTAB)
0006FB 46FB 22D4F2          16      LD  (_DTA),HL
0006FE 46FE EB               4      EX  DE,HL
0006FF 46FF 2100FF          10      LD  HL,-256
000702 4702 39              11      ADD HL,SP
000703 4703 ED52            15      SBC HL,DE
000705 4705 CD4A4B          17      CALL    ROM_READ
000708 4708 ED5BD4F2        20      LD  DE,(_DTA)
00070C 470C 19              11      ADD HL,DE
00070D 470D E5              11      PUSH    HL
00070E 470E 2A76F6          16      LD  HL,(TXTTAB)
       4711                     ROM_LOAD2:          ;リンクポインタをFIX
000711 4711 E5              11      PUSH    HL
000712 4712 DDE1            14      POP IX
000714 4714 7E               7      LD  A,(HL)      ;リンクポインタL
000715 4715 23               6      INC HL
000716 4716 B6               7      OR  (HL)        ;リンクポインタH
000717 4717 23               6      INC HL
000718 4718 2837            12      JR  Z,RLOAD_END0
00071A 471A 23               6      INC HL      ;行番号
00071B 471B 23               6      INC HL      ;行番号
       471C                     ROM_LOAD3:
00071C 471C 7E               7      LD  A,(HL)
00071D 471D 23               6      INC HL
00071E 471E FE0B             7      CP  00BH        ;8進数(&O)
000720 4720 2822            12      JR  Z,INC_HL2
000722 4722 FE0C             7      CP  00CH        ;16進数(&H)
000724 4724 281E            12      JR  Z,INC_HL2
000726 4726 FE0D             7      CP  00DH        ;行番号(RUN後)
000728 4728 281A            12      JR  Z,INC_HL2
00072A 472A FE0E             7      CP  00EH        ;行番号(RUN前)
00072C 472C 2816            12      JR  Z,INC_HL2
00072E 472E FE0F             7      CP  00FH        ;10～255の整数(%)
000730 4730 2813            12      JR  Z,INC_HL1
000732 4732 FE1C             7      CP  01CH        ;256～65535の整数(%)
000734 4734 280E            12      JR  Z,INC_HL2
000736 4736 FE1D             7      CP  01DH        ;単精度実数(!)
000738 4738 2808            12      JR  Z,INC_HL4
00073A 473A FE1F             7      CP  01FH        ;倍制度実数(#)
00073C 473C 2008            12      JR  NZ,INC_HL0
00073E 473E 23               6      INC HL
00073F 473F 23               6      INC HL
000740 4740 23               6      INC HL
000741 4741 23               6      INC HL
       4742                     INC_HL4:
000742 4742 23               6      INC HL
000743 4743 23               6      INC HL
       4744                     INC_HL2:
000744 4744 23               6      INC HL
       4745                     INC_HL1:
000745 4745 23               6      INC HL
       4746                     INC_HL0:
000746 4746 B7               4      OR  A
000747 4747 20D3            12      JR  NZ,ROM_LOAD3
000749 4749 DD7500          19      LD  (IX+0),L
00074C 474C DD7401          19      LD  (IX+1),H
00074F 474F 18C0            12      JR  ROM_LOAD2
       4751                     RLOAD_END0:
000751 4751 E1              10      POP HL
       4752                     RLOAD_END1:
000752 4752 22C2F6          16      LD  (VARTAB),HL
000755 4755 22C4F6          16      LD  (ARYTAB),HL
000758 4758 22C6F6          16      LD  (STREND),HL
                                
00075B 475B 3ABEFC          13      LD  A,(RUNBNF)
00075E 475E CD674D          17      CALL    CAP
000761 4761 FE52             7      CP  'R'
000763 4763 280E            12      JR  Z,RLOAD_END2
000765 4765 AF               4      XOR A
000766 4766 21DCF2          10      LD  HL,_BUF+3
000769 4769 77               7      LD  (HL),A      ;3
00076A 476A 2B               6      DEC HL
00076B 476B 77               7      LD  (HL),A      ;2
00076C 476C 2B               6      DEC HL
00076D 476D 77               7      LD  (HL),A      ;1
00076E 476E 2B               6      DEC HL
00076F 476F 3E8F             7      LD  A,08FH      ;REM
000771 4771 77               7      LD  (HL),A      ;0
000772 4772 C9              10      RET
       4773                     RLOAD_END2:
000773 4773 D5              11      PUSH    DE
000774 4774 ED5B76F6        20      LD  DE,(TXTTAB)
000778 4778 1B               6      DEC DE
000779 4779 AF               4      XOR A
00077A 477A 21DFF2          10      LD  HL,_BUF+6
00077D 477D 77               7      LD  (HL),A      ;6
00077E 477E 2B               6      DEC HL
00077F 477F 77               7      LD  (HL),A      ;5
000780 4780 2B               6      DEC HL
000781 4781 77               7      LD  (HL),A      ;4
000782 4782 2B               6      DEC HL
000783 4783 72               7      LD  (HL),D      ;3 行番号H
000784 4784 2B               6      DEC HL
000785 4785 73               7      LD  (HL),E      ;2 行番号L
000786 4786 2B               6      DEC HL
000787 4787 360D            10      LD  (HL),00DH   ;1 行番号(RUN後)
000789 4789 2B               6      DEC HL
00078A 478A 3E89             7      LD  A,089H      ;GOTO
00078C 478C 77               7      LD  (HL),A      ;0
00078D 478D D1              10      POP DE
00078E 478E C9              10      RET
                                
       478F                     ERROR_DIRECT_IN_FILE:
00078F 478F 1E39             7      LD  E,57            ;Direct statement in file
000791 4791 01                      DB  1           ;LD BC,
       4792                     ERROR_DEVICE_IO_ERROR:
000792 4792 1E13             7      LD  E,19            ;Device I/O error
000794 4794 01                      DB  1           ;LD BC,
       4795                     ERROR_INTERNAL_ERROR:
000795 4795 1E33             7      LD  E,51            ;Internal error
000797 4797 01                      DB  1           ;LD BC,
       4798                     ERROR_FILE_NOT_OPEN:
000798 4798 1E3B             7      LD  E,59            ;File not OPEN
00079A 479A 01                      DB  1           ;LD BC,
       479B                     ERROR_FILE_NOT_FOUND:
00079B 479B 1E35             7      LD  E,53            ;File not found
       479D                     ERROR:
00079D 479D FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0007A1 47A1 DD216F40        14      LD  IX,ERRHAND
0007A5 47A5 C31C00          10      JP  _CALSLT
                                
       47A8                     ROM_BLOAD:
0007A8 47A8 CDF848          17      CALL    INIT_PARAM
0007AB 47AB CDEB4B          17      CALL    FILE_B
0007AE 47AE CD7D4D          17      CALL    ROM_OPEN
0007B1 47B1 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0007B3 47B3 21D9F2          10      LD  HL,_BUF
0007B6 47B6 22D4F2          16      LD  (_DTA),HL
0007B9 47B9 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0007BC 47BC CD4A4B          17      CALL    ROM_READ
0007BF 47BF 3AD9F2          13      LD  A,(_BUF)
0007C2 47C2 FEFE             7      CP  0FEH
0007C4 47C4 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0007C6 47C6 21A5F2          10      LD  HL,BLOAD_RET
0007C9 47C9 229DF2          16      LD  (SWC_BLOAD),HL
                                
0007CC 47CC 2AF4F2          16      LD  HL,(PARAM1)
0007CF 47CF 7E               7      LD  A,(HL)
0007D0 47D0 FE2C             7      CP  ','
0007D2 47D2 204C            12      JR  NZ,RBREAD_MEM
0007D4 47D4 23               6      INC HL
0007D5 47D5 7E               7      LD  A,(HL)
0007D6 47D6 CD674D          17      CALL    CAP
0007D9 47D9 32BEFC          13      LD  (RUNBNF),A
0007DC 47DC FE52             7      CP  'R'     ;R,Sスイッチじゃ無い場合はオフセット値として処理する
0007DE 47DE 2808            12      JR  Z,RBOS1
0007E0 47E0 FE53             7      CP  'S'
0007E2 47E2 2804            12      JR  Z,RBOS1
0007E4 47E4 FE2C             7      CP  ','
0007E6 47E6 200D            12      JR  NZ,RBOS2
       47E8                     RBOS1:
0007E8 47E8 7E               7      LD  A,(HL)
0007E9 47E9 23               6      INC HL
0007EA 47EA B7               4      OR  A
0007EB 47EB 2824            12      JR  Z,RBREAD_OSE
0007ED 47ED FE3A             7      CP  ':'
0007EF 47EF 2820            12      JR  Z,RBREAD_OSE
0007F1 47F1 FE2C             7      CP  ','     ;次のパラメータを探す
0007F3 47F3 20F3            12      JR  NZ,RBOS1
       47F5                     RBOS2:              ;オフセット
0007F5 47F5 22F4F2          16      LD  (PARAM1),HL
0007F8 47F8 7E               7      LD  A,(HL)
0007F9 47F9 B7               4      OR  A
0007FA 47FA 2815            12      JR  Z,RBREAD_OSE
0007FC 47FC DD212F54        14      LD  IX,FRMQNT
000800 4800 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000804 4804 CD1C00          17      CALL    _CALSLT
000807 4807 22F4F2          16      LD  (PARAM1),HL
00080A 480A 2ADAF2          16      LD  HL,(_BUF_ST)
00080D 480D 19              11      ADD HL,DE
00080E 480E 22DAF2          16      LD  (_BUF_ST),HL
       4811                     RBREAD_OSE:
000811 4811 3ABEFC          13      LD  A,(RUNBNF)
000814 4814 FE53             7      CP  'S'
000816 4816 2008            12      JR  NZ,RBREAD_MEM
000818 4818 CDD84A          17      CALL    WAIT_VDP
00081B 481B 3E01             7      LD  A,1
00081D 481D 32D6F2          13      LD  (FLG_LDIR),A
       4820                     RBREAD_MEM:
000820 4820 2ADAF2          16      LD  HL,(_BUF_ST)
000823 4823 22BFFC          16      LD  (SAVENT),HL
000826 4826 22D4F2          16      LD  (_DTA),HL
000829 4829 21FFFF          10      LD  HL,0FFFFH
00082C 482C CD4A4B          17      CALL    ROM_READ
00082F 482F AF               4      XOR A
000830 4830 32D6F2          13      LD  (FLG_LDIR),A
000833 4833 3ABEFC          13      LD  A,(RUNBNF)
000836 4836 FE52             7      CP  'R'
000838 4838 2006            12      JR  NZ,RBREAD1
00083A 483A 2ADEF2          16      LD  HL,(_BUF_EX)
00083D 483D 229DF2          16      LD  (SWC_BLOAD),HL
       4840                     RBREAD1:
       4840                     ROM_NEXT:
000840 4840 2AF4F2          16      LD  HL,(PARAM1)
000843 4843 7E               7      LD  A,(HL)
000844 4844 2B               6      DEC HL
000845 4845 B7               4      OR  A
000846 4846 2805            12      JR  Z,ROM_NEXT1
000848 4848 FE3A             7      CP  ':'
00084A 484A 2801            12      JR  Z,ROM_NEXT1
00084C 484C 23               6      INC HL
       484D                     ROM_NEXT1:
00084D 484D 5D               4      LD  E,L
00084E 484E 54               4      LD  D,H
                                
00084F 484F CD3D4D          17      CALL    SEARCH_END
000852 4852 B7               4      OR  A
000853 4853 2821            12      JR  Z,REM
       4855                     RN3:                    ;マルチステートメントの処理
000855 4855 7E               7      LD  A,(HL)
                                
000856 4856 FEB5             7      CP  0B5H            ;LOAD
000858 4858 CAC646          10      JP  Z,ROM_LOAD
00085B 485B FE8A             7      CP  08AH            ;RUN
00085D 485D 281B            12      JR  Z,ROM_RUN
00085F 485F FEB7             7      CP  0B7H            ;FILES
000861 4861 2825            12      JR  Z,ROM_FILES
000863 4863 FED6             7      CP  0D6H            ;COPY
000865 4865 CA2A49          10      JP  Z,ROM_COPY
000868 4868 FE20             7      CP  020H
00086A 486A 2807            12      JR  Z,RN_SP
                                
00086C 486C 3E28             7      LD  A,028H          ;JR Z,
00086E 486E 32A3F2          13      LD  (SWC_BLOAD_M),A
000871 4871 7E               7      LD  A,(HL)
000872 4872 C9              10      RET
       4873                     RN_SP:
000873 4873 23               6      INC HL
000874 4874 18DF            12      JR  RN3
                                
       4876                     REM:
000876 4876 EB               4      EX  DE,HL
000877 4877 3E8F             7      LD  A,08FH          ;REM
000879 4879 C9              10      RET
                                
       487A                     ROM_RUN:
00087A 487A 23               6      INC HL
00087B 487B 7E               7      LD  A,(HL)
00087C 487C 2B               6      DEC HL
00087D 487D B7               4      OR  A
00087E 487E C4C646          17      CALL    NZ,ROM_LOAD
000881 4881 FE8F             7      CP  08FH            ;REM
000883 4883 3E8A             7      LD  A,08AH          ;RUN
000885 4885 C0              11      RET NZ
000886 4886 77               7      LD  (HL),A
000887 4887 C9              10      RET
                                
       4888                     ROM_FILES:
000888 4888 CDF848          17      CALL    INIT_PARAM
00088B 488B CDEB4B          17      CALL    FILE_B
00088E 488E CD7F54          17      CALL    GET_DISK_BANK_FDRV
000891 4891 3AC9F2          13      LD  A,(SECSZ_H)
000894 4894 CD3D53          17      CALL    IS_BPB1
000897 4897 DA9247          10      JP  C,ERROR_DEVICE_IO_ERROR
00089A 489A 3AF9F2          13      LD  A,(FNAME)
00089D 489D FE21             7      CP  021H
00089F 489F 3005            12      JR  NC,RFILES0
0008A1 48A1 060B             7      LD  B,11
0008A3 48A3 CDD14C          17      CALL    FILE10
       48A6                     RFILES0:
0008A6 48A6 CDD94F          17      CALL    GET_DIR_DAT
       48A9                     RFILES1:
0008A9 48A9 CD994D          17      CALL    FILESE
0008AC 48AC 3045            12      JR  NC,RFILES_NOT_MATCH
       48AE                     RFILES_DISP:
0008AE 48AE E5              11      PUSH    HL
0008AF 48AF 110B00          10      LD  DE,0000BH   ;属性
0008B2 48B2 19              11      ADD HL,DE
                                #if exists USE_MORMAL32K_OR_ASCII16
0008B3 48B3 CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0008B6 48B6 E1              10      POP HL
0008B7 48B7 CB4F             8      BIT 1,A     ;不可視属性
0008B9 48B9 2035            12      JR  NZ,RFILES_NEXT
0008BB 48BB E5              11      PUSH    HL
0008BC 48BC 0608             7      LD  B,8
0008BE 48BE CDBB44          17      CALL    MSN
                                #if exists USE_MORMAL32K_OR_ASCII16
0008C1 48C1 CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
0008C4 48C4 FE20             7      CP  020H
0008C6 48C6 F5              11      PUSH    AF
0008C7 48C7 3E2E             7      LD  A,'.'
0008C9 48C9 C4F554          17      CALL    NZ,MSG_A
0008CC 48CC 0603             7      LD  B,3
0008CE 48CE CDBB44          17      CALL    MSN
0008D1 48D1 F1              10      POP AF
0008D2 48D2 CCF554          17      CALL    Z,MSG_A
0008D5 48D5 3ADDF3          13      LD  A,(CSRX)
0008D8 48D8 47               4      LD  B,A
0008D9 48D9 3AB0F3          13      LD  A,(LINLEN)
0008DC 48DC 90               4      SUB B
0008DD 48DD FE0C             7      CP  12
0008DF 48DF 3009            12      JR  NC,RFILES2
0008E1 48E1 3E0D             7      LD  A,00DH      ;改行
0008E3 48E3 CDF554          17      CALL    MSG_A
0008E6 48E6 3E0A             7      LD  A,00AH
0008E8 48E8 1802            12      JR  RFILES3
       48EA                     RFILES2:
0008EA 48EA 3E20             7      LD  A,020H
       48EC                     RFILES3:
0008EC 48EC CDF554          17      CALL    MSG_A
0008EF 48EF E1              10      POP HL
       48F0                     RFILES_NEXT:
0008F0 48F0 CDB74D          17      CALL    FNEXT
       48F3                     RFILES_NOT_MATCH:
0008F3 48F3 20B4            12      JR  NZ,RFILES1
0008F5 48F5 C34048          10      JP  ROM_NEXT
                                
       48F8                     INIT_PARAM:
0008F8 48F8 22F2F2          16      LD  (PARAM0),HL
0008FB 48FB 22F4F2          16      LD  (PARAM1),HL
0008FE 48FE EB               4      EX  DE,HL
0008FF 48FF 32BEFC          13      LD  (RUNBNF),A
000902 4902 3263F6          13      LD  (VALTYP),A
000905 4905 E5              11      PUSH    HL
000906 4906 2AEBF2          16      LD  HL,(_CD)
000909 4909 22F6F2          16      LD  (_CDX),HL
00090C 490C E1              10      POP HL
00090D 490D 13               6      INC DE
00090E 490E CD0D4D          17      CALL    SPCUT
000911 4911 1A               7      LD  A,(DE)
000912 4912 B7               4      OR  A
000913 4913 C8              11      RET Z
000914 4914 FE3A             7      CP  ':'
000916 4916 C8              11      RET Z
000917 4917 FE28             7      CP  '('
000919 4919 C8              11      RET Z
00091A 491A EB               4      EX  DE,HL
00091B 491B DD21644C        14      LD  IX,FRMEVL
00091F 491F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000923 4923 CD1C00          17      CALL    _CALSLT
000926 4926 22F4F2          16      LD  (PARAM1),HL
000929 4929 C9              10      RET
                                
       492A                     ROM_COPY:
00092A 492A CDF848          17      CALL    INIT_PARAM
00092D 492D 3A63F6          13      LD  A,(VALTYP)
000930 4930 FE03             7      CP  3       ;string
000932 4932 C2E64B          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000935 4935 CDEB4B          17      CALL    FILE_B
000938 4938 CD7D4D          17      CALL    ROM_OPEN
00093B 493B DA9B47          10      JP  C,ERROR_FILE_NOT_FOUND
                                
00093E 493E 21DEF2          10      LD  HL,_BUF_W
000941 4941 22D4F2          16      LD  (_DTA),HL
000944 4944 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000947 4947 CD4A4B          17      CALL    ROM_READ
                                
00094A 494A AF               4      XOR A
00094B 494B 32D9F2          13      LD  (_BUF_LO),A     ;PSET
00094E 494E 32E6F2          13      LD  (_BUF_O),A      ;向き
                                
000951 4951 2AF4F2          16      LD  HL,(PARAM1)
       4954                     RCP_PARAM1:
000954 4954 7E               7      LD  A,(HL)
000955 4955 23               6      INC HL
000956 4956 B7               4      OR  A
000957 4957 CA4D48          10      JP  Z,ROM_NEXT1
00095A 495A FE3A             7      CP  ':'
00095C 495C CA4D48          10      JP  Z,ROM_NEXT1
00095F 495F FE2C             7      CP  ','
000961 4961 2012            12      JR  NZ,RCP_PARAM1_
                                
000963 4963 DD212F54        14      LD  IX,FRMQNT
000967 4967 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00096B 496B CD1C00          17      CALL    _CALSLT
00096E 496E 7B               4      LD  A,E
00096F 496F 87               4      ADD A,A
000970 4970 87               4      ADD A,A
000971 4971 32E6F2          13      LD  (_BUF_O),A
000974 4974 7E               7      LD  A,(HL)
       4975                     RCP_PARAM1_:
000975 4975 FE28             7      CP  '('
000977 4977 20DB            12      JR  NZ,RCP_PARAM1
000979 4979 DD212F54        14      LD  IX,FRMQNT
00097D 497D FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000981 4981 CD1C00          17      CALL    _CALSLT
                                
000984 4984 ED53E2F2        20      LD  (_BUF_X),DE
                                
       4988                     RCP_PARAM2:
000988 4988 23               6      INC HL
000989 4989 7E               7      LD  A,(HL)
00098A 498A FE20             7      CP  020H
00098C 498C 28FA            12      JR  Z,RCP_PARAM2
00098E 498E FE2C             7      CP  ','
000990 4990 28F6            12      JR  Z,RCP_PARAM2
                                
000992 4992 DD212F54        14      LD  IX,FRMQNT
000996 4996 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00099A 499A CD1C00          17      CALL    _CALSLT
                                
00099D 499D 3AF6FA          13      LD  A,(ACPAGE)
0009A0 49A0 57               4      LD  D,A
0009A1 49A1 ED53E4F2        20      LD  (_BUF_Y),DE
       49A5                     RCP_PARAM3:
0009A5 49A5 23               6      INC HL
0009A6 49A6 7E               7      LD  A,(HL)
0009A7 49A7 FE20             7      CP  020H
0009A9 49A9 28FA            12      JR  Z,RCP_PARAM3
0009AB 49AB FE29             7      CP  ')'
0009AD 49AD 28F6            12      JR  Z,RCP_PARAM3
0009AF 49AF FE2C             7      CP  ','
0009B1 49B1 2033            12      JR  NZ,RCP_ST
                                
0009B3 49B3 23               6      INC HL
0009B4 49B4 DD212F54        14      LD  IX,FRMQNT
0009B8 49B8 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0009BC 49BC CD1C00          17      CALL    _CALSLT
                                
0009BF 49BF 7B               4      LD  A,E
0009C0 49C0 32E5F2          13      LD  (_BUF_P),A
                                
       49C3                     RCP_PARAM4:
0009C3 49C3 7E               7      LD  A,(HL)
0009C4 49C4 23               6      INC HL
0009C5 49C5 FE20             7      CP  020H
0009C7 49C7 28FA            12      JR  Z,RCP_PARAM4
                                
0009C9 49C9 FE2C             7      CP  ','
0009CB 49CB 2019            12      JR  NZ,RCP_ST
                                
0009CD 49CD 7E               7      LD  A,(HL)
0009CE 49CE 0604             7      LD  B,4
0009D0 49D0 FEC3             7      CP  0C3H        ;PRESET
0009D2 49D2 280E            12      JR  Z,RCP_LO
0009D4 49D4 05               4      DEC B       ;3
0009D5 49D5 D6F8             7      SUB 0F8H        ;XOR
0009D7 49D7 2809            12      JR  Z,RCP_LO
0009D9 49D9 05               4      DEC B       ;2
0009DA 49DA 3C               4      INC A       ;OR
0009DB 49DB 2805            12      JR  Z,RCP_LO
0009DD 49DD 05               4      DEC B       ;1
0009DE 49DE 3C               4      INC A       ;AND
0009DF 49DF 2801            12      JR  Z,RCP_LO
0009E1 49E1 05               4      DEC B       ;0
                                                ;PSET
       49E2                     RCP_LO:
0009E2 49E2 78               4      LD  A,B
0009E3 49E3 32D9F2          13      LD  (_BUF_LO),A
       49E6                     RCP_ST:
0009E6 49E6 2AC6F6          16      LD  HL,(STREND)
0009E9 49E9 22D4F2          16      LD  (_DTA),HL
0009EC 49EC EB               4      EX  DE,HL
0009ED 49ED 2100FE          10      LD  HL,-512
0009F0 49F0 39              11      ADD HL,SP
0009F1 49F1 AF               4      XOR A
0009F2 49F2 ED52            15      SBC HL,DE
0009F4 49F4 3008            12      JR  NC,RCP0
0009F6 49F6 215EF5          10      LD  HL,BUF
0009F9 49F9 22D4F2          16      LD  (_DTA),HL
0009FC 49FC 6F               4      LD  L,A ;0
0009FD 49FD 67               4      LD  H,A ;0
       49FE                     RCP0:
0009FE 49FE 24               4      INC H
0009FF 49FF 22DCF2          16      LD  (_BUF_EN),HL
       4A02                     RCP1:
000A02 4A02 F3               4      DI
000A03 4A03 CDD84A          17      CALL    WAIT_VDP
                                
000A06 4A06 3A0700          13      LD  A,(WRVDP)
000A09 4A09 4F               4      LD  C,A
000A0A 4A0A 0C               4      INC C       ;C := PORT#1's address(WR)
000A0B 4A0B 3E24             7      LD  A,36
000A0D 4A0D ED79            12      OUT (C),A
000A0F 4A0F 3E91             7      LD  A,080H+17
000A11 4A11 ED79            12      OUT (C),A       ;R#17 := 36
                                
000A13 4A13 0C               4      INC C
000A14 4A14 0C               4      INC C       ;C := PORT#3's address(WR)
000A15 4A15 2AE2F2          16      LD  HL,(_BUF_X)
000A18 4A18 ED69            12      OUT (C),L       ;R#36 DX
000A1A 4A1A ED61            12      OUT (C),H       ;R#37
000A1C 4A1C 2AE4F2          16      LD  HL,(_BUF_Y)
000A1F 4A1F ED69            12      OUT (C),L       ;R#38 DY
000A21 4A21 ED61            12      OUT (C),H       ;R#39
000A23 4A23 2ADEF2          16      LD  HL,(_BUF_W)
000A26 4A26 ED69            12      OUT (C),L       ;R#40 NX
000A28 4A28 ED61            12      OUT (C),H       ;R#41
000A2A 4A2A 2AE0F2          16      LD  HL,(_BUF_H)
000A2D 4A2D ED69            12      OUT (C),L       ;R#42 NY
000A2F 4A2F ED61            12      OUT (C),H       ;R#43
                                
000A31 4A31 DD2AAFFC        20      LD  IX,(SCRMOD)
000A35 4A35 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A38 4A38 B7               4      OR  A
000A39 4A39 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000A3B 4A3B DD7D             9      LD  A,IXL
000A3D 4A3D FE08             7      CP  8
000A3F 4A3F 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000A41 4A41 FE06             7      CP  6
000A43 4A43 2AE2F2          16      LD  HL,(_BUF_X)
000A46 4A46 3ADEF2          13      LD  A,(_BUF_W)
000A49 4A49 2005            12      JR  NZ,SCR57
000A4B 4A4B B5               4      OR  L       ;スクリーン6
000A4C 4A4C E603             7      AND 3
000A4E 4A4E 200D            12      JR  NZ,USE_LMMC
       4A50                     SCR57:              ;スクリーン5,7
000A50 4A50 B5               4      OR  L
000A51 4A51 E601             7      AND 1
000A53 4A53 2008            12      JR  NZ,USE_LMMC
       4A55                     USE_HMMC:
000A55 4A55 DD2E08          10      LD  IXL,8
       4A58                     USE_HMMC8:
000A58 4A58 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
000A5A 4A5A 32D9F2          13      LD  (_BUF_LO),A
       4A5D                     USE_LMMC:
000A5D 4A5D 110000          10      LD  DE,0
000A60 4A60 06FF             7      LD  B,-1
000A62 4A62 CD034B          17      CALL    GET_PIXEL
000A65 4A65 ED79            12      OUT (C),A       ;R#44 first DATA
000A67 4A67 3AE6F2          13      LD  A,(_BUF_O)
000A6A 4A6A ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
000A6C 4A6C 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A6F 4A6F F6B0             7      OR  0B0H        ;R#46 LMMC command
000A71 4A71 ED79            12      OUT (C),A
                                
000A73 4A73 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
000A75 4A75 0D               4      DEC C
000A76 4A76 0D               4      DEC C       ;C := PORT#1's address(WR)
000A77 4A77 3EAC             7      LD  A,080H+44
000A79 4A79 ED79            12      OUT (C),A
000A7B 4A7B 3E91             7      LD  A,080H+17
000A7D 4A7D ED79            12      OUT (C),A       ;R#17 := 44
                                
000A7F 4A7F 3A0600          13      LD  A,(RDVDP)
000A82 4A82 3C               4      INC A
000A83 4A83 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000A85 4A85 3E02             7      LD  A,2
000A87 4A87 ED79            12      OUT (C),A
000A89 4A89 3E8F             7      LD  A,08FH
000A8B 4A8B ED79            12      OUT (C),A
000A8D 4A8D 3AD9F2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000A90 4A90 E640             7      AND 040H
000A92 4A92 201C            12      JR  NZ,LOOP_HMMC
       4A94                     LOOP_COPY:
000A94 4A94 CD034B          17      CALL    GET_PIXEL
000A97 4A97 08               4      EX  AF,AF'
000A98 4A98 FD4C             9      LD  C,IYH
       4A9A                     LOOP_COPY1:
000A9A 4A9A ED78            12      IN  A,(C)
000A9C 4A9C 0F               4      RRCA            ;RRCAではサインフラグは変化しない
000A9D 4A9D 300A            12      JR  NC,EXIT_COPY    ;check CE bit
000A9F 4A9F F29A4A          10      JP  P,LOOP_COPY1    ;check TR bit
000AA2 4AA2 08               4      EX  AF,AF'
000AA3 4AA3 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000AA5 4AA5 ED79            12      OUT (C),A
000AA7 4AA7 18EB            12      JR  LOOP_COPY
                                
       4AA9                     EXIT_COPY:
000AA9 4AA9 CDE04A          17      CALL    GET_STATUS_0
000AAC 4AAC FB               4      EI
000AAD 4AAD C34048          10      JP  ROM_NEXT
                                
       4AB0                     LOOP_HMMC:
000AB0 4AB0 F3               4      DI          ;必要
000AB1 4AB1 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000AB3 4AB3 43               4      LD  B,E
000AB4 4AB4 7B               4      LD  A,E
000AB5 4AB5 B7               4      OR  A
000AB6 4AB6 2802            12      JR  Z,LOOP_HMMC1
000AB8 4AB8 EDB3                    OTIR
       4ABA                     LOOP_HMMC1:
000ABA 4ABA 14               4      INC D
       4ABB                     LOOP_HMMC2:
000ABB 4ABB 15               4      DEC D
000ABC 4ABC 2805            12      JR  Z,LOOP_HMMC3
000ABE 4ABE EDB3                    OTIR
000AC0 4AC0 C3BB4A          10      JP  LOOP_HMMC2
       4AC3                     LOOP_HMMC3:
000AC3 4AC3 ED78            12      IN  A,(C)
000AC5 4AC5 0F               4      RRCA
000AC6 4AC6 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
000AC8 4AC8 2ADCF2          16      LD  HL,(_BUF_EN)
000ACB 4ACB CD4A4B          17      CALL    ROM_READ
000ACE 4ACE EB               4      EX  DE,HL
000ACF 4ACF 2AD4F2          16      LD  HL,(_DTA)
000AD2 4AD2 7A               4      LD  A,D
000AD3 4AD3 B3               4      OR  E
000AD4 4AD4 20DA            12      JR  NZ,LOOP_HMMC
000AD6 4AD6 18C2            12      JR  LOOP_COPY1
                                    
       4AD8                     WAIT_VDP:
000AD8 4AD8 3E02             7      LD  A,2
000ADA 4ADA CDE14A          17      CALL    GET_STATUS
000ADD 4ADD 0F               4      RRCA
000ADE 4ADE 38F8            12      JR  C,WAIT_VDP
       4AE0                     GET_STATUS_0:
000AE0 4AE0 AF               4      XOR A
       4AE1                     GET_STATUS:
000AE1 4AE1 C5              11      PUSH    BC
000AE2 4AE2 ED4B0600        20      LD  BC,(RDVDP)
000AE6 4AE6 0C               4      INC C
000AE7 4AE7 ED79            12      OUT (C),A
000AE9 4AE9 3E8F             7      LD  A,08FH
000AEB 4AEB ED79            12      OUT (C),A
000AED 4AED ED78            12      IN  A,(C)
000AEF 4AEF C1              10      POP BC
000AF0 4AF0 C9              10      RET
                                
       4AF1                     GET_PIXEL256:
000AF1 4AF1 7A               4      LD  A,D
000AF2 4AF2 B3               4      OR  E
000AF3 4AF3 200A            12      JR  NZ,GET_PIXEL1
000AF5 4AF5 2ADCF2          16      LD  HL,(_BUF_EN)
000AF8 4AF8 CD4A4B          17      CALL    ROM_READ
000AFB 4AFB EB               4      EX  DE,HL
000AFC 4AFC 2AD4F2          16      LD  HL,(_DTA)
       4AFF                     GET_PIXEL1:
000AFF 4AFF 7E               7      LD  A,(HL)
000B00 4B00 23               6      INC HL
000B01 4B01 1B               6      DEC DE
000B02 4B02 C9              10      RET
                                
       4B03                     GET_PIXEL:
000B03 4B03 DD7D             9      LD  A,IXL
000B05 4B05 FE08             7      CP  8
000B07 4B07 28E8            12      JR  Z,GET_PIXEL256
000B09 4B09 04               4      INC B
000B0A 4B0A FE06             7      CP  6
000B0C 4B0C 282E            12      JR  Z,GET_PIXEL4
                                
000B0E 4B0E CB40             8      BIT 0,B
000B10 4B10 20ED            12      JR  NZ,GET_PIXEL1
                                
000B12 4B12 7A               4      LD  A,D
000B13 4B13 B3               4      OR  E
000B14 4B14 200A            12      JR  NZ,GET_PIXEL2
                                
000B16 4B16 2ADCF2          16      LD  HL,(_BUF_EN)
000B19 4B19 CD4A4B          17      CALL    ROM_READ
000B1C 4B1C EB               4      EX  DE,HL
000B1D 4B1D 2AD4F2          16      LD  HL,(_DTA)
                                
       4B20                     GET_PIXEL2:
000B20 4B20 7E               7      LD  A,(HL)
000B21 4B21 0F               4      RRCA
000B22 4B22 0F               4      RRCA
000B23 4B23 0F               4      RRCA
000B24 4B24 0F               4      RRCA
000B25 4B25 C9              10      RET
                                
       4B26                     GET_PIXEL3:
000B26 4B26 7A               4      LD  A,D
000B27 4B27 B3               4      OR  E
000B28 4B28 200A            12      JR  NZ,GET_PIXEL5
                                
000B2A 4B2A 2ADCF2          16      LD  HL,(_BUF_EN)
000B2D 4B2D CD4A4B          17      CALL    ROM_READ
000B30 4B30 EB               4      EX  DE,HL
000B31 4B31 2AD4F2          16      LD  HL,(_DTA)
       4B34                     GET_PIXEL5:
000B34 4B34 7E               7      LD  A,(HL)
000B35 4B35 0F               4      RRCA
000B36 4B36 0F               4      RRCA
000B37 4B37 0F               4      RRCA
000B38 4B38 0F               4      RRCA
000B39 4B39 0F               4      RRCA
000B3A 4B3A 0F               4      RRCA
000B3B 4B3B C9              10      RET
                                
       4B3C                     GET_PIXEL4:
000B3C 4B3C 78               4      LD  A,B
000B3D 4B3D E603             7      AND 3   ;+0
000B3F 4B3F 28E5            12      JR  Z,GET_PIXEL3
000B41 4B41 3D               4      DEC A   ;+1
000B42 4B42 28DC            12      JR  Z,GET_PIXEL2
000B44 4B44 3D               4      DEC A   ;+2
000B45 4B45 7E               7      LD  A,(HL)
000B46 4B46 C0              11      RET NZ
000B47 4B47 0F               4      RRCA        ;+3
000B48 4B48 0F               4      RRCA
000B49 4B49 C9              10      RET
                                
       4B4A                     ROM_READ:
000B4A 4B4A E5              11      PUSH    HL
000B4B 4B4B D5              11      PUSH    DE
000B4C 4B4C C5              11      PUSH    BC
000B4D 4B4D FDE5            15      PUSH    IY
000B4F 4B4F 22F0F2          16      LD  (LEFTX),HL
000B52 4B52 2AD4F2          16      LD  HL,(_DTA)
000B55 4B55 22E7F2          16      LD  (DTAX),HL
000B58 4B58 2AF0F2          16      LD  HL,(LEFTX)
                                
000B5B 4B5B CDFE4D          17      CALL    RBX1
000B5E 4B5E 3870            12      JR  C,RBRERR1
000B60 4B60 79               4      LD  A,C
000B61 4B61 EB               4      EX  DE,HL
000B62 4B62 ED52            15      SBC HL,DE       ;CP 0HL,CDE
000B64 4B64 19              11      ADD HL,DE
000B65 4B65 DE00             7      SBC A,000H
000B67 4B67 3801            12      JR  C,RBR1
000B69 4B69 EB               4      EX  DE,HL
       4B6A                     RBR1:
000B6A 4B6A 9F               4      SBC A,A
000B6B 4B6B E601             7      AND 1
000B6D 4B6D 32C3F2          13      LD  (_RESULT),A
000B70 4B70 7C               4      LD  A,H
000B71 4B71 B5               4      OR  L
000B72 4B72 CAC64B          10      JP  Z,RBREND0
                                
000B75 4B75 22D0F2          16      LD  (_LEFT),HL  ;Read record byte
000B78 4B78 22F0F2          16      LD  (LEFTX),HL
                                
000B7B 4B7B CD314E          17      CALL    RBX2
000B7E 4B7E 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000B80 4B80 CD444E          17      CALL    RBXA
000B83 4B83 DADC4B          10      JP  C,RBRERR
000B86 4B86 C5              11      PUSH    BC
000B87 4B87 CD1D45          17      CALL    ROM_LDIR
000B8A 4B8A ED53E7F2        20      LD  (DTAX),DE
000B8E 4B8E 2AF0F2          16      LD  HL,(LEFTX)
000B91 4B91 D1              10      POP DE
000B92 4B92 A7               4      AND A
000B93 4B93 ED52            15      SBC HL,DE
000B95 4B95 22F0F2          16      LD  (LEFTX),HL
000B98 4B98 2829            12      JR  Z,RBREND
                                
       4B9A                     RBRB:
000B9A 4B9A CD7D4E          17      CALL    RBXB
000B9D 4B9D 2818            12      JR  Z,RBRC
       4B9F                     RBRB1:
000B9F 4B9F C5              11      PUSH    BC
000BA0 4BA0 D5              11      PUSH    DE
000BA1 4BA1 CD2E4F          17      CALL    CLUST
000BA4 4BA4 EB               4      EX  DE,HL
000BA5 4BA5 ED4BC6F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000BA9 4BA9 CD1D45          17      CALL    ROM_LDIR
000BAC 4BAC EB               4      EX  DE,HL
000BAD 4BAD D1              10      POP DE
000BAE 4BAE C1              10      POP BC
000BAF 4BAF CD0B4F          17      CALL    GNCL
000BB2 4BB2 DADC4B          10      JP  C,RBRERR
000BB5 4BB5 10E8            13      DJNZ    RBRB1
       4BB7                     RBRC:
000BB7 4BB7 CD954E          17      CALL    RBXC
000BBA 4BBA 2807            12      JR  Z,RBREND
                                
000BBC 4BBC CD2E4F          17      CALL    CLUST
000BBF 4BBF EB               4      EX  DE,HL
000BC0 4BC0 CD1D45          17      CALL    ROM_LDIR
       4BC3                     RBREND:
000BC3 4BC3 CDA14E          17      CALL    RBXEND
       4BC6                     RBREND0:
000BC6 4BC6 FDE1            14      POP IY
000BC8 4BC8 C1              10      POP BC
000BC9 4BC9 D1              10      POP DE
000BCA 4BCA F1              10      POP AF  ;(HL)
000BCB 4BCB AF               4      XOR A
000BCC 4BCC 3AC3F2          13      LD  A,(_RESULT)
000BCF 4BCF C9              10      RET
                                
       4BD0                     RBRERR1:
000BD0 4BD0 3E01             7      LD  A,001H
       4BD2                     RBRERR2:
000BD2 4BD2 FDE1            14      POP IY
000BD4 4BD4 C1              10      POP BC
000BD5 4BD5 D1              10      POP DE
000BD6 4BD6 E1              10      POP HL
000BD7 4BD7 37               4      SCF
000BD8 4BD8 210000          10      LD  HL,0
000BDB 4BDB C9              10      RET
       4BDC                     RBRERR:
000BDC 4BDC 3EFF             7      LD  A,0FFH
000BDE 4BDE 18F2            12      JR  RBRERR2
                                
       4BE0                     FILE_DD:
000BE0 4BE0 E1              10      POP HL
000BE1 4BE1 3E                      DB  03EH
000BE2 4BE2 C9              10      RET
000BE3 4BE3 32A3F2          13      LD  (SWC_BLOAD_M),A
       4BE6                     ROM_ORG:
000BE6 4BE6 2AF2F2          16      LD  HL,(PARAM0)
000BE9 4BE9 7E               7      LD  A,(HL)
000BEA 4BEA C9              10      RET
       4BEB                     FILE_B:
000BEB 4BEB AF               4      XOR A
000BEC 4BEC 32F8F2          13      LD  (FDRV),A
000BEF 4BEF 1E00             7      LD  E,0
000BF1 4BF1 3A63F6          13      LD  A,(VALTYP)
000BF4 4BF4 FE03             7      CP  3       ;string
000BF6 4BF6 C28E4C          10      JP  NZ,FILED
                                
000BF9 4BF9 DD21D067        14      LD  IX,FRESTR
000BFD 4BFD FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000C01 4C01 CD1C00          17      CALL    _CALSLT
000C04 4C04 E5              11      PUSH    HL
000C05 4C05 DDE1            14      POP IX
                                
000C07 4C07 DD5E00          19      LD  E,(IX+0)
000C0A 4C0A DD7E01          19      LD  A,(IX+1)
000C0D 4C0D DD5602          19      LD  D,(IX+2)
000C10 4C10 DD62             9      LD  IXH,D
000C12 4C12 DD6F             9      LD  IXL,A
000C14 4C14 7B               4      LD  A,E
       4C15                     FILE_BDOS:
000C15 4C15 FE04             7      CP  4
000C17 4C17 3808            12      JR  C,FILEB1
000C19 4C19 DD7E03          19      LD  A,(IX+3)
000C1C 4C1C FE3A             7      CP  ':'
000C1E 4C1E 28C0            12      JR  Z,FILE_DD
000C20 4C20 7B               4      LD  A,E
       4C21                     FILEB1:
000C21 4C21 FE02             7      CP  2
000C23 4C23 3818            12      JR  C,DEVI1
000C25 4C25 DD7E01          19      LD  A,(IX+1)
000C28 4C28 FE3A             7      CP  ':'
000C2A 4C2A 2011            12      JR  NZ,DEVI1
000C2C 4C2C DD7E00          19      LD  A,(IX+0)        ;DRIVE
000C2F 4C2F CD674D          17      CALL    CAP
000C32 4C32 D640             7      SUB '@'
000C34 4C34 DD23            10      INC IX
000C36 4C36 DD23            10      INC IX
000C38 4C38 1D               4      DEC E
000C39 4C39 1D               4      DEC E
000C3A 4C3A 32F8F2          13      LD  (FDRV),A
       4C3D                     DEVI1:
000C3D 4C3D DD7E00          19      LD  A,(IX+0)
000C40 4C40 D65C             7      SUB 05CH        ;\
000C42 4C42 2008            12      JR  NZ,NOROOT
000C44 4C44 6F               4      LD  L,A
000C45 4C45 67               4      LD  H,A
000C46 4C46 22F6F2          16      LD  (_CDX),HL
000C49 4C49 DD23            10      INC IX
000C4B 4C4B 1D               4      DEC E
       4C4C                     NOROOT:
                                
       4C4C                     SETDIR:
000C4C 4C4C CD8E4C          17      CALL    FILED
000C4F 4C4F DD7E00          19      LD  A,(IX+0)
000C52 4C52 FE5C             7      CP  05CH        ;\
000C54 4C54 C0              11      RET NZ
000C55 4C55 DD23            10      INC IX
000C57 4C57 1D               4      DEC E
000C58 4C58 3AF9F2          13      LD  A,(FNAME)
000C5B 4C5B FE20             7      CP  020H        ;. の処理
000C5D 4C5D 28ED            12      JR  Z,SETDIR
                                
000C5F 4C5F CD7D4D          17      CALL    ROM_OPEN
000C62 4C62 B7               4      OR  A
000C63 4C63 C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000C64 4C64 D5              11      PUSH    DE
000C65 4C65 2AEDF2          16      LD  HL,(DIRENT1)
000C68 4C68 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000C6B 4C6B 19              11      ADD HL,DE
000C6C 4C6C CDC744          17      CALL    RDSLT_ROM
000C6F 4C6F D1              10      POP DE
000C70 4C70 CB67             8      BIT 4,A     ;ディレクトリ
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000C72 4C72 C8              11      RET Z
000C73 4C73 CDD54C          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
000C76 4C76 D5              11      PUSH    DE
000C77 4C77 2AEDF2          16      LD  HL,(DIRENT1)
000C7A 4C7A 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000C7D 4C7D 19              11      ADD HL,DE
000C7E 4C7E CDC744          17      CALL    RDSLT_ROM
000C81 4C81 23               6      INC HL
000C82 4C82 5F               4      LD  E,A
000C83 4C83 CDC744          17      CALL    RDSLT_ROM
000C86 4C86 57               4      LD  D,A
000C87 4C87 EB               4      EX  DE,HL
000C88 4C88 D1              10      POP DE
                                #else
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
000C89 4C89 22F6F2          16      LD  (_CDX),HL
000C8C 4C8C 18BE            12      JR  SETDIR
                                
       4C8E                     FILED:
000C8E 4C8E CDD54C          17      CALL    FILEI
000C91 4C91 21F9F2          10      LD  HL,FNAME
                                
000C94 4C94 0608             7      LD  B,8
       4C96                     FILE2:
000C96 4C96 CDE24C          17      CALL    CCHKF
000C99 4C99 C8              11      RET Z
000C9A 4C9A FE2A             7      CP  '*'
000C9C 4C9C 282E            12      JR  Z,FILE9
000C9E 4C9E FE2E             7      CP  '.'
000CA0 4CA0 280C            12      JR  Z,FILE4
000CA2 4CA2 77               7      LD  (HL),A
000CA3 4CA3 23               6      INC HL
000CA4 4CA4 10F0            13      DJNZ    FILE2
                                
       4CA6                     FILE3:
000CA6 4CA6 CDE24C          17      CALL    CCHKF
000CA9 4CA9 C8              11      RET Z
000CAA 4CAA FE2E             7      CP  '.'
000CAC 4CAC 20F8            12      JR  NZ,FILE3
                                
       4CAE                     FILE4:
000CAE 4CAE 2101F3          10      LD  HL,FNAME+8
000CB1 4CB1 0603             7      LD  B,3
                                
       4CB3                     FILE4L:
000CB3 4CB3 CDE24C          17      CALL    CCHKF
000CB6 4CB6 C8              11      RET Z
000CB7 4CB7 FE2E             7      CP  '.'
000CB9 4CB9 2008            12      JR  NZ,FILE12
000CBB 4CBB 32F9F2          13      LD  (FNAME),A   ;Parent directory(..)
000CBE 4CBE 32FAF2          13      LD  (FNAME+1),A
000CC1 4CC1 3E20             7      LD  A,020H
       4CC3                     FILE12:
000CC3 4CC3 FE2A             7      CP  '*'
000CC5 4CC5 280A            12      JR  Z,FILE10
000CC7 4CC7 77               7      LD  (HL),A
000CC8 4CC8 23               6      INC HL
000CC9 4CC9 10E8            13      DJNZ    FILE4L
000CCB 4CCB C9              10      RET
                                
       4CCC                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000CCC 4CCC CDD14C          17      CALL    FILE10
000CCF 4CCF 18D5            12      JR  FILE3
                                
       4CD1                     FILE10:
000CD1 4CD1 3E3F             7      LD  A,'?'
000CD3 4CD3 1808            12      JR  FILL_MEMORY
       4CD5                     FILEI:              ;名前＋拡張子をスペースで初期化
000CD5 4CD5 3E20             7      LD  A,020H
000CD7 4CD7 01000B          10      LD  BC,11*256   ;C=0にしておく
000CDA 4CDA 21F9F2          10      LD  HL,FNAME
       4CDD                     FILL_MEMORY:            ;HLからBバイトAで埋める
000CDD 4CDD 77               7      LD  (HL),A
000CDE 4CDE 23               6      INC HL
000CDF 4CDF 10FC            13      DJNZ    FILL_MEMORY
000CE1 4CE1 C9              10      RET
                                
       4CE2                     CCHKF:
000CE2 4CE2 7B               4      LD  A,E
000CE3 4CE3 B7               4      OR  A
000CE4 4CE4 C8              11      RET Z
000CE5 4CE5 DD7E00          19      LD  A,(IX+0)
000CE8 4CE8 CDEF4C          17      CALL    CCHK2
000CEB 4CEB C8              11      RET Z
000CEC 4CEC C3524D          10      JP  FKAN
                                
       4CEF                     CCHK2:
000CEF 4CEF 0C               4      INC C
000CF0 4CF0 0D               4      DEC C
000CF1 4CF1 C0              11      RET NZ
       4CF2                     CCHK3:              ;ZF=1 で使えない文字
000CF2 4CF2 FE2B             7      CP  '+'
000CF4 4CF4 C8              11      RET Z
000CF5 4CF5 FE2C             7      CP  ','
000CF7 4CF7 C8              11      RET Z
000CF8 4CF8 FE2F             7      CP  '/'
000CFA 4CFA C8              11      RET Z
000CFB 4CFB FE3A             7      CP  ':'
000CFD 4CFD C8              11      RET Z
000CFE 4CFE FE3B             7      CP  ';'
000D00 4D00 C8              11      RET Z
000D01 4D01 FE3D             7      CP  '='
000D03 4D03 C8              11      RET Z
000D04 4D04 FE5C             7      CP  05CH    ;\
000D06 4D06 C8              11      RET Z
000D07 4D07 FE1F             7      CP  01FH
000D09 4D09 D0              11      RET NC
000D0A 4D0A BF               4      CP  A       ;Z=1
000D0B 4D0B C9              10      RET
                                
       4D0C                     SS1:
000D0C 4D0C 13               6      INC DE
       4D0D                     SPCUT:              ;スペースをカット
000D0D 4D0D 1A               7      LD  A,(DE)
000D0E 4D0E FE20             7      CP  020H
000D10 4D10 28FA            12      JR  Z,SS1
000D12 4D12 C9              10      RET
                                
       4D13                     SCREOF1:
000D13 4D13 13               6      INC DE
       4D14                     SPCUTEX:            ;スペース改行などをカット
000D14 4D14 1A               7      LD  A,(DE)
000D15 4D15 FE20             7      CP  020H
000D17 4D17 28FA            12      JR  Z,SCREOF1
000D19 4D19 FE0D             7      CP  00DH
000D1B 4D1B 28F6            12      JR  Z,SCREOF1
000D1D 4D1D FE0A             7      CP  00AH
000D1F 4D1F 28F2            12      JR  Z,SCREOF1
000D21 4D21 FE1A             7      CP  01AH
000D23 4D23 28EE            12      JR  Z,SCREOF1
000D25 4D25 C9              10      RET
                                
       4D26                     GETNUM:
000D26 4D26 210000          10      LD  HL,0
       4D29                     GETNUM1:
000D29 4D29 1A               7      LD  A,(DE)
000D2A 4D2A 13               6      INC DE
000D2B 4D2B D630             7      SUB '0'
000D2D 4D2D D8              11      RET C
000D2E 4D2E FE0A             7      CP  10
000D30 4D30 D0              11      RET NC
000D31 4D31 4D               4      LD  C,L
000D32 4D32 44               4      LD  B,H
000D33 4D33 29              11      ADD HL,HL   ;*2
000D34 4D34 29              11      ADD HL,HL   ;*4
000D35 4D35 09              11      ADD HL,BC   ;*5
000D36 4D36 29              11      ADD HL,HL   ;*10
000D37 4D37 4F               4      LD  C,A
000D38 4D38 0600             7      LD  B,0
000D3A 4D3A 09              11      ADD HL,BC
000D3B 4D3B 18EC            12      JR  GETNUM1
                                
       4D3D                     SEARCH_END:
000D3D 4D3D 7E               7      LD  A,(HL)
       4D3E                     SEARCH_END1:
000D3E 4D3E 23               6      INC HL
000D3F 4D3F B7               4      OR  A
000D40 4D40 C8              11      RET Z
000D41 4D41 FE3A             7      CP  ':'
000D43 4D43 20F8            12      JR  NZ,SEARCH_END
000D45 4D45 7E               7      LD  A,(HL)
000D46 4D46 FE3A             7      CP  ':'
000D48 4D48 28F4            12      JR  Z,SEARCH_END1
000D4A 4D4A C9              10      RET
                                
       4D4B                     FKANC:
000D4B 4D4B CB41             8      BIT 0,C
000D4D 4D4D CC704D          17      CALL    Z,CAP2
000D50 4D50 1803            12      JR  FKANX
       4D52                     FKAN:           ;漢字チェック
000D52 4D52 DD23            10      INC IX
000D54 4D54 1D               4      DEC E
       4D55                     FKANX:
000D55 4D55 CB41             8      BIT 0,C
000D57 4D57 CB81             8      RES 0,C
000D59 4D59 C0              11      RET NZ
000D5A 4D5A FE80             7      CP  080H
000D5C 4D5C D8              11      RET C
000D5D 4D5D FEA0             7      CP  0A0H
000D5F 4D5F 3803            12      JR  C,FKAN1
000D61 4D61 FEE0             7      CP  0E0H
000D63 4D63 D8              11      RET C
       4D64                     FKAN1:
000D64 4D64 0C               4      INC C
000D65 4D65 A7               4      AND A
000D66 4D66 C9              10      RET
                                
       4D67                     CAP:
000D67 4D67 FE61             7      CP  'a'
000D69 4D69 D8              11      RET C
000D6A 4D6A FE7B             7      CP  'z'+1
000D6C 4D6C D0              11      RET NC
000D6D 4D6D D620             7      SUB 020H
000D6F 4D6F C9              10      RET
       4D70                     CAP2:
000D70 4D70 CD674D          17      CALL    CAP
       4D73                     CAP3:               ;
000D73 4D73 FE05             7      CP  5
000D75 4D75 2803            12      JR  Z,CAP4
000D77 4D77 FE21             7      CP  021H
000D79 4D79 C9              10      RET
       4D7A                     CAP4:
000D7A 4D7A 3EE5             7      LD  A,0E5H
000D7C 4D7C C9              10      RET
                                
       4D7D                     ROM_OPEN:
000D7D 4D7D CD7F54          17      CALL    GET_DISK_BANK_FDRV
                                
000D80 4D80 CDD94F          17      CALL    GET_DIR_DAT
000D83 4D83 D5              11      PUSH    DE
000D84 4D84 CD994D          17      CALL    FILESE
000D87 4D87 D1              10      POP DE
000D88 4D88 3F               4      CCF
000D89 4D89 D8              11      RET C
000D8A 4D8A 22EDF2          16      LD  (DIRENT1),HL
000D8D 4D8D E5              11      PUSH    HL
000D8E 4D8E 210000          10      LD  HL,0
000D91 4D91 22CAF2          16      LD  (RR_LOW),HL
000D94 4D94 22CCF2          16      LD  (RR_HIGH),HL
000D97 4D97 E1              10      POP HL
000D98 4D98 C9              10      RET
                                
       4D99                     FILESE:
       4D99                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
000D99 4D99 CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000D9C 4D9C B7               4      OR  A
000D9D 4D9D C8              11      RET Z       ;END:ZF=1 CF=0
000D9E 4D9E FEE5             7      CP  0E5H
000DA0 4DA0 280D            12      JR  Z,FILESE1
000DA2 4DA2 11F9F2          10      LD  DE,FNAME
000DA5 4DA5 E5              11      PUSH    HL
000DA6 4DA6 CDD54D          17      CALL    CPFILE
000DA9 4DA9 CCF84D          17      CALL    Z,CPFILE2
000DAC 4DAC E1              10      POP HL
000DAD 4DAD 37               4      SCF
000DAE 4DAE C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4DAF                     FILESE1:
000DAF 4DAF CDB74D          17      CALL    FNEXT
000DB2 4DB2 20E5            12      JR  NZ,FILESE0
000DB4 4DB4 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000DB6 4DB6 C9              10      RET
                                
       4DB7                     FNEXT:
000DB7 4DB7 112000          10      LD  DE,020H
000DBA 4DBA 19              11      ADD HL,DE
000DBB 4DBB ED5BF6F2        20      LD  DE,(_CDX)
000DBF 4DBF 7A               4      LD  A,D
000DC0 4DC0 B3               4      OR  E
000DC1 4DC1 2002            12      JR  NZ,FNEXT_SUBDIR
000DC3 4DC3 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000DC4 4DC4 C9              10      RET
                                
       4DC5                     FNEXT_SUBDIR:           ;サブディレクトリ
000DC5 4DC5 0D               4      DEC C
000DC6 4DC6 C0              11      RET NZ
                                
000DC7 4DC7 ED5BF6F2        20      LD  DE,(_CDX)
000DCB 4DCB CD0B4F          17      CALL    GNCL
000DCE 4DCE EB               4      EX  DE,HL
000DCF 4DCF 22F6F2          16      LD  (_CDX),HL
000DD2 4DD2 C31250          10      JP  GET_SUBDIR
                                
       4DD5                     CPFILE:
000DD5 4DD5 C5              11      PUSH    BC
000DD6 4DD6 01000B          10      LD  BC,00B00H
       4DD9                     CPSTR1:
000DD9 4DD9 1A               7      LD  A,(DE)
000DDA 4DDA FE3F             7      CP  '?'     ;Wild card
000DDC 4DDC 2814            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
000DDE 4DDE CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000DE1 4DE1 CD4B4D          17      CALL    FKANC
000DE4 4DE4 E5              11      PUSH    HL
000DE5 4DE5 67               4      LD  H,A
000DE6 4DE6 1A               7      LD  A,(DE)
000DE7 4DE7 CB01             8      RLC C
000DE9 4DE9 CD4B4D          17      CALL    FKANC
000DEC 4DEC CB09             8      RRC C
000DEE 4DEE BC               4      CP  H       ;CP (HL),(DE)
000DEF 4DEF E1              10      POP HL
000DF0 4DF0 2004            12      JR  NZ,CPSTR3
       4DF2                     CPSTR2:
000DF2 4DF2 13               6      INC DE
000DF3 4DF3 23               6      INC HL
000DF4 4DF4 10E3            13      DJNZ    CPSTR1
       4DF6                     CPSTR3:
000DF6 4DF6 C1              10      POP BC
000DF7 4DF7 C9              10      RET
                                
       4DF8                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
000DF8 4DF8 CDC744          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000DFB 4DFB E608             7      AND 008H    ;~0F7H
000DFD 4DFD C9              10      RET
                                
       4DFE                     RBX1:
000DFE 4DFE E5              11      PUSH    HL      ;Record byte
                                
000DFF 4DFF ED5BCAF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000E03 4E03 3ACDF2          13      LD  A,(RR_HIGH+1)
000E06 4E06 4F               4      LD  C,A
                                
000E07 4E07 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000E0A 4E0A 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
000E0D 4E0D D5              11      PUSH    DE
000E0E 4E0E 2AEDF2          16      LD  HL,(DIRENT1)
000E11 4E11 111C00          10      LD  DE,0001CH
000E14 4E14 19              11      ADD HL,DE
000E15 4E15 CDC744          17      CALL    RDSLT_ROM
000E18 4E18 23               6      INC HL
000E19 4E19 5F               4      LD  E,A
000E1A 4E1A CDC744          17      CALL    RDSLT_ROM
000E1D 4E1D 23               6      INC HL
000E1E 4E1E 57               4      LD  D,A
000E1F 4E1F CDC744          17      CALL    RDSLT_ROM
000E22 4E22 EB               4      EX  DE,HL       ;AHL=File size
000E23 4E23 D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
                                
000E24 4E24 A7               4      AND A
000E25 4E25 ED52            15      SBC HL,DE
000E27 4E27 99               4      SBC A,C
000E28 4E28 D1              10      POP DE
                                
000E29 4E29 D8              11      RET C
000E2A 4E2A 4F               4      LD  C,A
000E2B 4E2B EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000E2C 4E2C B2               4      OR  D
000E2D 4E2D B3               4      OR  E
000E2E 4E2E C0              11      RET NZ
000E2F 4E2F 37               4      SCF
000E30 4E30 C9              10      RET
                                
       4E31                     RBX2:
000E31 4E31 ED4BCBF2        20      LD  BC,(RR_LOW+1)
000E35 4E35 CDB64E          17      CALL    RWXR
000E38 4E38 3AC7F2          13      LD  A,(CLSZ_H)
000E3B 4E3B 3D               4      DEC A
000E3C 4E3C E5              11      PUSH    HL
000E3D 4E3D 2ACAF2          16      LD  HL,(RR_LOW)
000E40 4E40 A4               4      AND H
000E41 4E41 B5               4      OR  L
000E42 4E42 E1              10      POP HL
000E43 4E43 C9              10      RET
                                
       4E44                     RBXA:
000E44 4E44 D5              11      PUSH    DE
000E45 4E45 CD2E4F          17      CALL    CLUST
000E48 4E48 ED53D2F2        20      LD  (_DTPS),DE
000E4C 4E4C D1              10      POP DE
000E4D 4E4D CD0B4F          17      CALL    GNCL
000E50 4E50 D8              11      RET C
000E51 4E51 ED53CEF2        20      LD  (_CLPS),DE
                                
000E55 4E55 ED4BCAF2        20      LD  BC,(RR_LOW)
000E59 4E59 2AC6F2          16      LD  HL,(CLSZ)
000E5C 4E5C 7C               4      LD  A,H
000E5D 4E5D 3D               4      DEC A
000E5E 4E5E A0               4      AND B
000E5F 4E5F 47               4      LD  B,A
000E60 4E60 ED42            15      SBC HL,BC       ;remaining cluster
                                
000E62 4E62 ED5BF0F2        20      LD  DE,(LEFTX)
000E66 4E66 ED52            15      SBC HL,DE       ;CP HL,DE
000E68 4E68 19              11      ADD HL,DE
000E69 4E69 3801            12      JR  C,RBXA1
000E6B 4E6B EB               4      EX  DE,HL
       4E6C                     RBXA1:
000E6C 4E6C 3AC4F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
000E6F 4E6F 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000E72 4E72 E5              11      PUSH    HL
000E73 4E73 2AD2F2          16      LD  HL,(_DTPS)
000E76 4E76 09              11      ADD HL,BC
000E77 4E77 ED5BE7F2        20      LD  DE,(DTAX)
000E7B 4E7B C1              10      POP BC
000E7C 4E7C C9              10      RET
                                
       4E7D                     RBXB:
000E7D 4E7D 2AE7F2          16      LD  HL,(DTAX)
000E80 4E80 ED5BCEF2        20      LD  DE,(_CLPS)
000E84 4E84 3AF1F2          13      LD  A,(LEFTX+1)
000E87 4E87 47               4      LD  B,A
000E88 4E88 3AC7F2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4E8B                     RBXB1:
000E8B 4E8B 1F               4      RRA     ;->CF
000E8C 4E8C 3804            12      JR  C,RBXB2
000E8E 4E8E CB38             8      SRL B   ;B=B/2
000E90 4E90 18F9            12      JR  RBXB1
       4E92                     RBXB2:
000E92 4E92 78               4      LD  A,B
000E93 4E93 B7               4      OR  A
000E94 4E94 C9              10      RET
                                
       4E95                     RBXC:
000E95 4E95 ED4BF0F2        20      LD  BC,(LEFTX)
000E99 4E99 3AC7F2          13      LD  A,(CLSZ_H)
000E9C 4E9C 3D               4      DEC A
000E9D 4E9D A0               4      AND B
000E9E 4E9E 47               4      LD  B,A
000E9F 4E9F B1               4      OR  C
000EA0 4EA0 C9              10      RET
                                
       4EA1                     RBXEND:
000EA1 4EA1 ED5BD0F2        20      LD  DE,(_LEFT)
000EA5 4EA5 2ACAF2          16      LD  HL,(RR_LOW)
000EA8 4EA8 3ACDF2          13      LD  A,(RR_HIGH+1)
000EAB 4EAB 19              11      ADD HL,DE
000EAC 4EAC CE00             7      ADC A,0
000EAE 4EAE 22CAF2          16      LD  (RR_LOW),HL
000EB1 4EB1 32CDF2          13      LD  (RR_HIGH+1),A
000EB4 4EB4 EB               4      EX  DE,HL       ;HL=Read byte
000EB5 4EB5 C9              10      RET 
                                
       4EB6                     RWXR:
000EB6 4EB6 3AC7F2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4EB9                     L_RWX:
000EB9 4EB9 1F               4      RRA     ;->CF
000EBA 4EBA 3806            12      JR  C,E_RWX
000EBC 4EBC CB38             8      SRL B   ;BC=BC/2
000EBE 4EBE CB19             8      RR  C   ;
000EC0 4EC0 18F7            12      JR  L_RWX
       4EC2                     E_RWX:
000EC2 4EC2 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000EC5 4EC5 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
000EC8 4EC8 E5              11      PUSH    HL
000EC9 4EC9 2AEDF2          16      LD  HL,(DIRENT1)
000ECC 4ECC 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000ECF 4ECF 19              11      ADD HL,DE
000ED0 4ED0 CDC744          17      CALL    RDSLT_ROM
000ED3 4ED3 23               6      INC HL
000ED4 4ED4 5F               4      LD  E,A
000ED5 4ED5 CDC744          17      CALL    RDSLT_ROM
000ED8 4ED8 23               6      INC HL
000ED9 4ED9 57               4      LD  D,A
000EDA 4EDA E1              10      POP HL
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  E,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  D,(IY+01BH)
                                #endif
000EDB 4EDB CD7F54          17      CALL    GET_DISK_BANK_FDRV
       4EDE                     RWX1:
000EDE 4EDE ED53CEF2        20      LD  (_CLPS),DE
000EE2 4EE2 7A               4      LD  A,D
000EE3 4EE3 B3               4      OR  E
000EE4 4EE4 37               4      SCF
000EE5 4EE5 C8              11      RET Z
                                
000EE6 4EE6 78               4      LD  A,B
000EE7 4EE7 B1               4      OR  C
000EE8 4EE8 C8              11      RET Z
                                
000EE9 4EE9 CD0B4F          17      CALL    GNCL
000EEC 4EEC D8              11      RET C
000EED 4EED 0B               6      DEC BC
000EEE 4EEE CD724F          17      CALL    ENDCL
000EF1 4EF1 38EB            12      JR  C,RWX1
000EF3 4EF3 37               4      SCF
000EF4 4EF4 C9              10      RET
                                
       4EF5                     NCL3:
000EF5 4EF5 CD7F54          17      CALL    GET_DISK_BANK_FDRV
000EF8 4EF8 6B               4      LD  L,E
000EF9 4EF9 62               4      LD  H,D
000EFA 4EFA CB3C             8      SRL H
000EFC 4EFC CB1D             8      RR  L
000EFE 4EFE 1F               4      RRA
000EFF 4EFF 19              11      ADD HL,DE
000F00 4F00 010060          10      LD  BC,BANK1_ADR
000F03 4F03 09              11      ADD HL,BC
000F04 4F04 ED4BC8F2        20      LD  BC,(SECSZ)
000F08 4F08 09              11      ADD HL,BC
000F09 4F09 17               4      RLA
000F0A 4F0A C9              10      RET
                                
       4F0B                     GNCL:
000F0B 4F0B 7A               4      LD  A,D
000F0C 4F0C B3               4      OR  E
000F0D 4F0D 37               4      SCF
000F0E 4F0E C8              11      RET Z
000F0F 4F0F C5              11      PUSH    BC
000F10 4F10 E5              11      PUSH    HL
000F11 4F11 CDF54E          17      CALL    NCL3
000F14 4F14 3809            12      JR  C,GNC1
000F16 4F16 5E               7      LD  E,(HL)
000F17 4F17 23               6      INC HL
000F18 4F18 7E               7      LD  A,(HL)
000F19 4F19 E60F             7      AND 00FH
000F1B 4F1B 57               4      LD  D,A
000F1C 4F1C E1              10      POP HL
000F1D 4F1D C1              10      POP BC
000F1E 4F1E C9              10      RET
       4F1F                     GNC1:
000F1F 4F1F 7E               7      LD  A,(HL)
000F20 4F20 23               6      INC HL
000F21 4F21 56               7      LD  D,(HL)
000F22 4F22 0604             7      LD  B,4
       4F24                     GNC1L:
000F24 4F24 CB3A             8      SRL D
000F26 4F26 1F               4      RRA
000F27 4F27 10FB            13      DJNZ    GNC1L
                                
000F29 4F29 5F               4      LD  E,A
000F2A 4F2A E1              10      POP HL
000F2B 4F2B C1              10      POP BC
000F2C 4F2C A7               4      AND A
000F2D 4F2D C9              10      RET
                                
       4F2E                     CLUST:
000F2E 4F2E EB               4      EX  DE,HL
       4F2F                     CLUST_HL:
000F2F 4F2F 2B               6      DEC HL
000F30 4F30 2B               6      DEC HL
000F31 4F31 C5              11      PUSH    BC
000F32 4F32 3AC7F2          13      LD  A,(CLSZ_H)
000F35 4F35 CDAC54          17      CALL    MUL_AHL
                                
000F38 4F38 CDF34F          17      CALL    GET_DIR_POS
000F3B 4F3B 4F               4      LD  C,A
000F3C 4F3C 0600             7      LD  B,0
000F3E 4F3E 09              11      ADD HL,BC
                                
000F3F 4F3F ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000F43 4F43 CB38             8      SRL B
000F45 4F45 CB19             8      RR  C           ;/2
000F47 4F47 CB38             8      SRL B
000F49 4F49 CB19             8      RR  C           ;/4
000F4B 4F4B CB38             8      SRL B
000F4D 4F4D CB19             8      RR  C           ;/8
000F4F 4F4F 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
000F50 4F50 7D               4      LD  A,L
000F51 4F51 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000F54 4F54 09              11      ADD HL,BC
000F55 4F55 3013            12      JR  NC,CLUST2
000F57 4F57 4D               4      LD  C,L     ;C=読み出し元
000F58 4F58 29              11      ADD HL,HL   ;64KB→32KB
000F59 4F59 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000F5A 4F5A CD7F54          17      CALL    GET_DISK_BANK_FDRV
000F5D 4F5D 84               4      ADD A,H
000F5E 4F5E 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000F61 4F61 32C4F2          13      LD  (_BANK),A
000F64 4F64 69               4      LD  L,C     ;C=読み出し元
000F65 4F65 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000F67 4F67 A5               4      AND L
000F68 4F68 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4F6A                     CLUST2:
000F6A 4F6A C660             7      ADD A,high BANK1_ADR
000F6C 4F6C 67               4      LD  H,A
000F6D 4F6D 2E00             7      LD  L,0
000F6F 4F6F EB               4      EX  DE,HL
000F70 4F70 C1              10      POP BC
000F71 4F71 C9              10      RET
                                
       4F72                     ENDCL:
000F72 4F72 7A               4      LD  A,D ;END CLUSTER
000F73 4F73 FE0F             7      CP  00FH    ;FAT12の最大値
000F75 4F75 C0              11      RET NZ
000F76 4F76 7B               4      LD  A,E
000F77 4F77 FEF7             7      CP  0F7H
000F79 4F79 C9              10      RET
                                
       4F7A                     RB_READ:
000F7A 4F7A AF               4      XOR A   ;HLA = HL*128
000F7B 4F7B CB3C             8      SRL H
000F7D 4F7D CB1D             8      RR  L
000F7F 4F7F 1F               4      RRA
000F80 4F80 32CAF2          13      LD  (RR_LOW),A
000F83 4F83 22CBF2          16      LD  (RR_MID),HL
000F86 4F86 218000          10      LD  HL,128
                                
000F89 4F89 CD4A4B          17      CALL    ROM_READ
000F8C 4F8C C9              10      RET
                                
       4F8D                     GETSEQ:
000F8D 4F8D FD6E20          19      LD  L,(IY+32)
000F90 4F90 FD660C          19      LD  H,(IY+12)
                                
000F93 4F93 CB25             8      SLA L
                                
000F95 4F95 CB3C             8      SRL H
000F97 4F97 CB1D             8      RR  L
000F99 4F99 C9              10      RET
                                
       4F9A                     SETSEQ:
000F9A 4F9A F5              11      PUSH    AF
000F9B 4F9B 3ACAF2          13      LD  A,(RR_LOW)
000F9E 4F9E 2ACBF2          16      LD  HL,(RR_MID)
                                
000FA1 4FA1 CDB84F          17      CALL    SSQ1
                                
000FA4 4FA4 29              11      ADD HL,HL
000FA5 4FA5 CB3D             8      SRL L
000FA7 4FA7 FD7520          19      LD  (IY+32),L
000FAA 4FAA FD740C          19      LD  (IY+12),H
000FAD 4FAD F1              10      POP AF
000FAE 4FAE C9              10      RET
                                
       4FAF                     GETSIZE:
000FAF 4FAF FD7E10          19      LD  A,(IY+16)
000FB2 4FB2 FD6E11          19      LD  L,(IY+17)
000FB5 4FB5 FD6612          19      LD  H,(IY+18)
       4FB8                     SSQ1:
000FB8 4FB8 87               4      ADD A,A
000FB9 4FB9 ED6A            15      ADC HL,HL
000FBB 4FBB B7               4      OR  A
000FBC 4FBC C8              11      RET Z
000FBD 4FBD 23               6      INC HL
000FBE 4FBE C9              10      RET
                                
       4FBF                     SET_FCB:
000FBF 4FBF D5              11      PUSH    DE
000FC0 4FC0 FDE1            14      POP IY
000FC2 4FC2 FD7E1C          19      LD  A,(IY+28)
000FC5 4FC5 FEFF             7      CP  0FFH
000FC7 4FC7 200C            12      JR  NZ,POPAF_SCF_FF_RET
000FC9 4FC9 E5              11      PUSH    HL
000FCA 4FCA FD6E1A          19      LD  L,(IY+26)
000FCD 4FCD FD661B          19      LD  H,(IY+27)
000FD0 4FD0 22CEF2          16      LD  (_CLPS),HL
000FD3 4FD3 E1              10      POP HL
000FD4 4FD4 C9              10      RET
                                
       4FD5                     POPAF_SCF_FF_RET:
000FD5 4FD5 F1              10      POP AF
000FD6 4FD6 37               4      SCF
000FD7 4FD7 9F               4      SBC A,A
000FD8 4FD8 C9              10      RET
                                
       4FD9                     GET_DIR_DAT:
000FD9 4FD9 2AF6F2          16      LD  HL,(_CDX)
000FDC 4FDC 7C               4      LD  A,H
000FDD 4FDD B5               4      OR  L
000FDE 4FDE 2032            12      JR  NZ,GET_SUBDIR
000FE0 4FE0 CDF34F          17      CALL    GET_DIR_POS
000FE3 4FE3 C660             7      ADD A,high BANK1_ADR
000FE5 4FE5 2E00             7      LD  L,0
000FE7 4FE7 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000FE8 4FE8 3AC5F2          13      LD  A,(_BANK1)
000FEB 4FEB 32EFF2          13      LD  (_DIR_BANK),A
                                
000FEE 4FEE 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000FF1 4FF1 4F               4      LD  C,A
000FF2 4FF2 C9              10      RET
                                
       4FF3                     GET_DIR_POS:                ;ルートディレクトリ
000FF3 4FF3 CD7F54          17      CALL    GET_DISK_BANK_FDRV
000FF6 4FF6 32C5F2          13      LD  (_BANK1),A
000FF9 4FF9 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000FFC 4FFC 47               4      LD  B,A
000FFD 4FFD 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
001000 5000 4F               4      LD  C,A
001001 5001 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       5004                     GET_DIR_POS1:
001004 5004 81               4      ADD A,C
001005 5005 10FD            13      DJNZ    GET_DIR_POS1
                                
001007 5007 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
00100B 500B 37               4      SCF     ;無限ループ回避
       500C                     L_MDP:
00100C 500C CB18             8      RR  B   ;->CF
00100E 500E D8              11      RET C
00100F 500F 87               4      ADD A,A
001010 5010 18FA            12      JR  L_MDP
                                
       5012                     GET_SUBDIR:             ;サブディレクトリ
001012 5012 CD2F4F          17      CALL    CLUST_HL
001015 5015 EB               4      EX  DE,HL
001016 5016 3AC4F2          13      LD  A,(_BANK)
001019 5019 32EFF2          13      LD  (_DIR_BANK),A
00101C 501C 3AC7F2          13      LD  A,(CLSZ_H)
00101F 501F 87               4      ADD A,A     ;*2
001020 5020 87               4      ADD A,A     ;*4
001021 5021 87               4      ADD A,A     ;*8
001022 5022 4F               4      LD  C,A
001023 5023 C9              10      RET
                                
       5024                     STATEMENT:
001024 5024 119152          10      LD  DE,STR_CHDIR
001027 5027 CD7752          17      CALL    CPPROCNM
00102A 502A 2812            12      JR  Z,_CHDIR
00102C 502C 119752          10      LD  DE,STR_CHDRV
00102F 502F CD7752          17      CALL    CPPROCNM
001032 5032 281C            12      JR  Z,_CHDRV
001034 5034 119D52          10      LD  DE,STR_RAMDISK
001037 5037 CD7752          17      CALL    CPPROCNM
00103A 503A 2829            12      JR  Z,_RAMDISK
00103C 503C 37               4      SCF
00103D 503D C9              10      RET
       503E                     _CHDIR:
00103E 503E 7E               7      LD  A,(HL)
00103F 503F FE28             7      CP  '('
001041 5041 37               4      SCF
001042 5042 C0              11      RET NZ
001043 5043 CDF848          17      CALL    INIT_PARAM
001046 5046 CDEB4B          17      CALL    FILE_B
001049 5049 CD7950          17      CALL    ROM_CD
00104C 504C D0              11      RET NC
00104D 504D C39B47          10      JP  ERROR_FILE_NOT_FOUND
                                
       5050                     _CHDRV:
001050 5050 7E               7      LD  A,(HL)
001051 5051 FE28             7      CP  '('
001053 5053 37               4      SCF
001054 5054 C0              11      RET NZ
001055 5055 CDF848          17      CALL    INIT_PARAM
001058 5058 E5              11      PUSH    HL
001059 5059 CDEB4B          17      CALL    FILE_B
00105C 505C E1              10      POP HL
00105D 505D 23               6      INC HL
00105E 505E 3AF8F2          13      LD  A,(FDRV)
001061 5061 3D               4      DEC A
001062 5062 C35257          10      JP  _SYS0EX1
                                
       5065                     _RAMDISK:
001065 5065 7E               7      LD  A,(HL)
001066 5066 FE28             7      CP  '('
001068 5068 37               4      SCF
001069 5069 C0              11      RET NZ
00106A 506A 23               6      INC HL
00106B 506B DD212F54        14      LD  IX,FRMQNT
00106F 506F FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001073 5073 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
                                ;   LD  A,D
                                ;   OR  E
                                ;   JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   XOR A
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
001076 5076 23               6      INC HL
001077 5077 AF               4      XOR A
001078 5078 C9              10      RET
                                
       5079                     ROM_CD:
001079 5079 3AF9F2          13      LD  A,(FNAME)
00107C 507C FE20             7      CP  020H
00107E 507E 2835            12      JR  Z,CD1
001080 5080 CD7D4D          17      CALL    ROM_OPEN
001083 5083 D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
001084 5084 D5              11      PUSH    DE
001085 5085 2AEDF2          16      LD  HL,(DIRENT1)
001088 5088 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
00108B 508B 19              11      ADD HL,DE
00108C 508C CDC744          17      CALL    RDSLT_ROM
00108F 508F D1              10      POP DE
001090 5090 CB67             8      BIT 4,A     ;ディレクトリ
001092 5092 CA9B47          10      JP  Z,ERROR_FILE_NOT_FOUND
001095 5095 D5              11      PUSH    DE
001096 5096 2AEDF2          16      LD  HL,(DIRENT1)
001099 5099 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
00109C 509C 19              11      ADD HL,DE
00109D 509D CDC744          17      CALL    RDSLT_ROM
0010A0 50A0 23               6      INC HL
0010A1 50A1 5F               4      LD  E,A
0010A2 50A2 CDC744          17      CALL    RDSLT_ROM
0010A5 50A5 57               4      LD  D,A
0010A6 50A6 EB               4      EX  DE,HL
0010A7 50A7 D1              10      POP DE
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
       50A8                     CD2:
0010A8 50A8 22EBF2          16      LD  (_CD),HL
0010AB 50AB 2AF4F2          16      LD  HL,(PARAM1)
       50AE                     CD_SKIP:
0010AE 50AE 7E               7      LD  A,(HL)
0010AF 50AF 23               6      INC HL
0010B0 50B0 FE21             7      CP  021H
0010B2 50B2 38FA            12      JR  C,CD_SKIP
0010B4 50B4 C9              10      RET
       50B5                     CD1:
0010B5 50B5 2AF6F2          16      LD  HL,(_CDX)
0010B8 50B8 18EE            12      JR  CD2
                                
       50BA                     GET_BASIC_FCB:
0010BA 50BA D5              11      PUSH    DE
0010BB 50BB 23               6      INC HL  ;+1
0010BC 50BC 5E               7      LD  E,(HL)  ;FCB[1]
0010BD 50BD 23               6      INC HL  ;+2
0010BE 50BE 56               7      LD  D,(HL)  ;FCB[2]
0010BF 50BF 23               6      INC HL  ;+3
0010C0 50C0 ED53EDF2        20      LD  (DIRENT1),DE
                                            ;FCB[3] backup char
0010C4 50C4 23               6      INC HL  ;+4
                                            ;FCB[4]
0010C5 50C5 23               6      INC HL  ;+5
0010C6 50C6 7E               7      LD  A,(HL)  ;FCB[5]
0010C7 50C7 23               6      INC HL  ;+6
0010C8 50C8 32EFF2          13      LD  (_DIR_BANK),A
0010CB 50CB 5E               7      LD  E,(HL)  ;FCB[6]
0010CC 50CC 23               6      INC HL  ;+7
0010CD 50CD 56               7      LD  D,(HL)  ;FCB[7]
0010CE 50CE 23               6      INC HL  ;+8
0010CF 50CF ED53CAF2        20      LD  (RR_LOW),DE
0010D3 50D3 7E               7      LD  A,(HL)  ;FCB[8]
0010D4 50D4 23               6      INC HL  ;+9
0010D5 50D5 32CCF2          13      LD  (RR_HIGH),A
0010D8 50D8 22D4F2          16      LD  (_DTA),HL   ;FCB[9]
0010DB 50DB D1              10      POP DE
0010DC 50DC C9              10      RET
                                
       50DD                     SET_BASIC_FCB:
0010DD 50DD E5              11      PUSH    HL
0010DE 50DE 2A64F8          16      LD  HL,(PTRFIL)
0010E1 50E1 23               6      INC HL  ;+1
0010E2 50E2 D5              11      PUSH    DE
0010E3 50E3 ED5BEDF2        20      LD  DE,(DIRENT1)
0010E7 50E7 73               7      LD  (HL),E  ;FCB[1]
0010E8 50E8 23               6      INC HL  ;+2
0010E9 50E9 72               7      LD  (HL),D  ;FCB[2]
0010EA 50EA 23               6      INC HL  ;+3
0010EB 50EB 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
0010EC 50EC 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
0010ED 50ED 23               6      INC HL  ;+5
0010EE 50EE 3AEFF2          13      LD  A,(_DIR_BANK)
0010F1 50F1 77               7      LD  (HL),A  ;FCB[5]
0010F2 50F2 23               6      INC HL  ;+6
0010F3 50F3 ED5BCAF2        20      LD  DE,(RR_LOW)
0010F7 50F7 73               7      LD  (HL),E  ;FCB[6]
0010F8 50F8 23               6      INC HL  ;+7
0010F9 50F9 72               7      LD  (HL),D  ;FCB[7]
0010FA 50FA 23               6      INC HL  ;+8
0010FB 50FB 3ACCF2          13      LD  A,(RR_HIGH)
0010FE 50FE 77               7      LD  (HL),A  ;FCB[8]
0010FF 50FF D1              10      POP DE
001100 5100 E1              10      POP HL
001101 5101 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_18:BACKUP
                                ;in
                                ;   C : backup charactor
                                ;   HL: FBC pointer
                                ;out
       5102                     DEVICE_18_BACKUP:
001102 5102 D5              11      PUSH    DE
001103 5103 E5              11      PUSH    HL
001104 5104 110300          10      LD  DE,3
001107 5107 19              11      ADD HL,DE
001108 5108 71               7      LD  (HL),C
001109 5109 E1              10      POP HL
00110A 510A D1              10      POP DE
00110B 510B C9              10      RET
                                
       510C                     DEVICE_CHECK:
00110C 510C 3A8AFD          13      LD  A,(PROCNM+1)
00110F 510F B7               4      OR  A
001110 5110 C8              11      RET Z
001111 5111 11A552          10      LD  DE,STR_ROM
001114 5114 CD7752          17      CALL    CPPROCNM
001117 5117 2802            12      JR  Z,DEVICE_OK
001119 5119 37               4      SCF
00111A 511A C9              10      RET
       511B                     DEVICE_OK:
00111B 511B AF               4      XOR A
00111C 511C C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファ
                                
       511D                     DEVICE_0_OPEN:
00111D 511D 7B               4      LD  A,E
00111E 511E FE02             7      CP  2       ;FOR OUTPUT
001120 5120 281B            12      JR  Z,OPEN2
001122 5122 D5              11      PUSH    DE
001123 5123 E5              11      push    hl
                                ;
001124 5124 3E01             7      LD  A,1     ;ドライブA
001126 5126 32F8F2          13      LD  (FDRV),A
001129 5129 2166F8          10      LD  HL,FILNAM
00112C 512C 11F9F2          10      LD  DE,FNAME
00112F 512F 010B00          10      LD  BC,8+3
001132 5132 CDD058          17      CALL    INIT_FILE1
001135 5135 CD7D4D          17      CALL    ROM_OPEN
001138 5138 DA9B47          10      JP  C,ERROR_FILE_NOT_FOUND
00113B 513B E1              10      pop hl
00113C 513C D1              10      POP DE
       513D                     OPEN2:
00113D 513D 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
001140 5140 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
001141 5141 AF               4      XOR A
001142 5142 32F0F2          13      LD  (LEFTX),A
001145 5145 CDDD50          17      CALL    SET_BASIC_FCB
001148 5148 7B               4      ld  a,e
001149 5149 FE08             7      cp  8
00114B 514B 3F               4      ccf
00114C 514C C9              10      ret
                                
       514D                     DEVICE_2_CLOSE:
00114D 514D AF               4      XOR A
                                ;   LD  (HL),A
00114E 514E 6F               4      LD  L,A
00114F 514F 67               4      LD  H,A
001150 5150 2264F8          16      LD  (PTRFIL),HL
001153 5153 C9              10      RET
                                
       5154                     DEVICE_ENTRY:
001154 5154 FE08             7      CP  8
001156 5156 2826            12      JR  Z,DEVICE_8_SIN
001158 5158 3C               4      INC A
001159 5159 28B1            12      JR  Z,DEVICE_CHECK:
00115B 515B 3D               4      DEC A
00115C 515C 28BF            12      JR  Z,DEVICE_0_OPEN
00115E 515E FE0E             7      CP  14
001160 5160 2860            12      JR  Z,DEVICE_14_EOF
001162 5162 FE04             7      CP  4
001164 5164 2834            12      JR  Z,DEVICE_4_RANDOM
001166 5166 FE0A             7      CP  10
001168 5168 2850            12      JR  Z,DEVICE_10_LOC
00116A 516A FE0C             7      CP  12
00116C 516C 2878            12      JR  Z,DEVICE_12_LOF
00116E 516E FE02             7      CP  2
001170 5170 2890            12      JR  Z,DEVICE_18_BACKUP  
001172 5172 FE02             7      CP  2
001174 5174 28D7            12      JR  Z,DEVICE_2_CLOSE
001176 5176 FE06             7      CP  6
001178 5178 2802            12      JR  Z,DEVICE_6_SOUT
00117A 517A 37               4      SCF
00117B 517B C9              10      RET
                                
       517C                     DEVICE_6_SOUT:
00117C 517C AF               4      XOR A
00117D 517D C9              10      RET
                                
       517E                     DEVICE_8_SIN:
00117E 517E CDBA50          17      CALL    GET_BASIC_FCB
001181 5181 210100          10      LD  HL,1
001184 5184 CD4A4B          17      CALL    ROM_READ
001187 5187 7C               4      LD  A,H
001188 5188 B5               4      OR  L
001189 5189 280D            12      JR  Z,CCF_RET
00118B 518B 2AD4F2          16      LD  HL,(_DTA)
00118E 518E 7E               7      LD  A,(HL)
00118F 518F F5              11      PUSH    AF
001190 5190 CDDD50          17      CALL    SET_BASIC_FCB
001193 5193 F1              10      POP AF
001194 5194 FE0A             7      CP  00AH
001196 5196 C8              11      RET Z   ;ZF=separate
                                ;   CP  01AH
                                ;   JR  Z,SCF_RET
001197 5197 37               4      SCF     ;
       5198                     CCF_RET:
001198 5198 3F               4      CCF     ;ZF=0 CF=0にしたい
001199 5199 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_4:RANDOM
                                ;in
                                ;   A : 4
                                ;   unknown
                                ;out
                                ;   unknown
                                ;note:
       519A                     DEVICE_4_RANDOM:
00119A 519A D5              11      PUSH    DE
00119B 519B CDBA50          17      CALL    GET_BASIC_FCB
00119E 519E DDE5            15      PUSH    IX
0011A0 51A0 DD218A2F        14      LD  IX,FRCINT
0011A4 51A4 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0011A8 51A8 CDB0F2          17      CALL    CAL_MP
0011AB 51AB DDE1            14      POP IX
0011AD 51AD 2AF8F7          16      LD  HL,(DACDAT)
0011B0 51B0 22CAF2          16      LD  (RR_LOW),HL
0011B3 51B3 AF               4      XOR A
0011B4 51B4 CDDD50          17      CALL    SET_BASIC_FCB
0011B7 51B7 D1              10      POP DE
0011B8 51B8 AF               4      XOR A
0011B9 51B9 C9              10      RET
                                
                                ;FUNC_10:LOC
                                ;in
                                ;   A : 10
                                ;out
                                ;   DAC    : value of received bytes
                                ;   VALTYP : DAC type
       51BA                     DEVICE_10_LOC:
0011BA 51BA CDBA50          17      CALL    GET_BASIC_FCB
0011BD 51BD 2ACAF2          16      LD  HL,(RR_LOW)
0011C0 51C0 1844            12      JR  RETURN_TYPE8_AHL
                                
                                ;--------------------------------------
                                ;FUNC_14:EOF
                                ;in
                                ;   A : 14
                                ;out
                                ;   DAC    : value of EOF value (EOF=-1)
                                ;   VALTYP : DAC type
       51C2                     DEVICE_14_EOF:
0011C2 51C2 CDBA50          17      CALL    GET_BASIC_FCB
0011C5 51C5 CDFE4D          17      CALL    RBX1
0011C8 51C8 3810            12      JR  C,DEVICE_14_EOF1
0011CA 51CA 210100          10      LD  HL,1
0011CD 51CD CD4A4B          17      CALL    ROM_READ
0011D0 51D0 2AD4F2          16      LD  HL,(_DTA)
0011D3 51D3 7E               7      LD  A,(HL)
0011D4 51D4 FE1A             7      CP  01AH
0011D6 51D6 37               4      SCF
0011D7 51D7 2801            12      JR  Z,DEVICE_14_EOF1
0011D9 51D9 3F               4      CCF
       51DA                     DEVICE_14_EOF1:
0011DA 51DA 9F               4      SBC A,A
0011DB 51DB 6F               4      LD  L,A
0011DC 51DC 67               4      LD  H,A
       51DD                     return_type2_hl:
0011DD 51DD 22F8F7          16      ld  (DACDAT),hl
0011E0 51E0 3E02             7      ld  a,2
0011E2 51E2 3263F6          13      ld  (VALTYP),a
0011E5 51E5 C9              10      ret
                                
                                ;--------------------------------------
                                ;FUNC_16:FPOS
                                ;in
                                ;   unknown
                                ;out
                                ;   unknown
                                ;note:
                                ;   illegal function call
                                
                                ;--------------------------------------
                                ;FUNC_12:LOF
                                ;in
                                ;   A : 12
                                ;out
                                ;   DAC    : value of LOC+RSIQLN
                                ;   VALTYP : DAC type
       51E6                     DEVICE_12_LOF:
0011E6 51E6 CDBA50          17      CALL    GET_BASIC_FCB
                                
0011E9 51E9 3AEFF2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
0011EC 51EC 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
0011EF 51EF D5              11      PUSH    DE
0011F0 51F0 2AEDF2          16      LD  HL,(DIRENT1)
0011F3 51F3 111C00          10      LD  DE,0001CH
0011F6 51F6 19              11      ADD HL,DE
0011F7 51F7 CDC744          17      CALL    RDSLT_ROM
0011FA 51FA 23               6      INC HL
0011FB 51FB 5F               4      LD  E,A
0011FC 51FC CDC744          17      CALL    RDSLT_ROM
0011FF 51FF 23               6      INC HL
001200 5200 57               4      LD  D,A
001201 5201 CDC744          17      CALL    RDSLT_ROM
001204 5204 EB               4      EX  DE,HL       ;AHL=File size
001205 5205 D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
       5206                     RETURN_TYPE8_AHL:
001206 5206 B7               4      OR  A
001207 5207 2004            12      JR  NZ,RT8AHL1
001209 5209 CB7C             8      BIT 7,H
00120B 520B 28D0            12      JR  Z,return_type2_hl
       520D                     RT8AHL1:
00120D 520D E5              11      PUSH    HL
00120E 520E 29              11      ADD HL,HL
00120F 520F 8F               4      ADC A,A
001210 5210 32F8F7          13      LD  (DACDAT),A
001213 5213 3E00             7      LD  A,0
001215 5215 8F               4      ADC A,A
001216 5216 32F9F7          13      LD  (DACDAT+1),A
                                
001219 5219 3E02             7      LD  A,2
00121B 521B 3263F6          13      LD  (VALTYP),A
00121E 521E DD213A30        14      LD  IX,FRCDBL
001222 5222 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001226 5226 CDB0F2          17      CALL    CAL_MP
                                
001229 5229 216F52          10      LD  HL,DBL32768
00122C 522C 1147F8          10      LD  DE,ARG
00122F 522F 010800          10      LD  BC,8
001232 5232 EDB0                    LDIR
                                
001234 5234 DD21E627        14      LD  IX,DECMUL
001238 5238 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00123C 523C CDB0F2          17      CALL    CAL_MP
                                
00123F 523F 21F6F7          10      LD  HL,DAC
001242 5242 1147F8          10      LD  DE,ARG
001245 5245 010800          10      LD  BC,8
001248 5248 EDB0                    LDIR
                                
00124A 524A E1              10      POP HL
00124B 524B 22F8F7          16      LD  (DACDAT),HL
                                
00124E 524E 3E02             7      LD  A,2
001250 5250 3263F6          13      LD  (VALTYP),A
001253 5253 DD213A30        14      LD  IX,FRCDBL
001257 5257 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00125B 525B CDB0F2          17      CALL    CAL_MP
                                
00125E 525E DD219A26        14      LD  IX,DECADD
001262 5262 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
001266 5266 CDB0F2          17      CALL    CAL_MP
                                
001269 5269 3E08             7      LD  A,8
00126B 526B 3263F6          13      LD  (VALTYP),A
00126E 526E C9              10      RET
                                
       526F                     DBL32768:
00126F 526F 4532768000000000        DB  045H,032H,076H,080H,0,0,0,0
                                
       5277                     CPPROCNM:
001277 5277 E5              11      PUSH    HL
001278 5278 2189FD          10      LD  HL,PROCNM
       527B                     CPPROCNM1:
00127B 527B 1A               7      LD  A,(DE)
00127C 527C 13               6      INC DE
00127D 527D BE               7      CP  (HL)
00127E 527E 23               6      INC HL
00127F 527F 2003            12      JR  NZ,CPPROCNM2
001281 5281 B7               4      OR  A
001282 5282 20F7            12      JR  NZ,CPPROCNM1
       5284                     CPPROCNM2:
001284 5284 E1              10      POP HL
001285 5285 C9              10      RET
                                
       5286                     WILDCARD:
001286 5286 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       5291                     STR_CHDIR:
001291 5291 434844495200            DB  "CHDIR",0
       5297                     STR_CHDRV:
001297 5297 434844525600            DB  "CHDRV",0
       529D                     STR_RAMDISK:
00129D 529D 52414D4449534B00        DB  "RAMDISK",0
       52A5                     STR_ROM:
0012A5 52A5 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       52A9                     ERROR_WRITE_PROTECTED:
0012A9 52A9 3E00             7      LD  A,0     ;Write protected
0012AB 52AB C9              10      RET
       52AC                     DISKIO:
0012AC 52AC 38FB            12      JR  C,ERROR_WRITE_PROTECTED
0012AE 52AE 48               4      LD  C,B
0012AF 52AF CD8954          17      CALL    GET_DISK_BANK
       52B2                     SETMAP1:        
0012B2 52B2 E5              11      PUSH    HL
       52B3                     DISKIO1:
0012B3 52B3 C5              11      PUSH    BC      ;B=残りのセクタ数
0012B4 52B4 D5              11      PUSH    DE      ;DE=セクタ番号
0012B5 52B5 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
0012B6 52B6 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
0012B7 52B7 F5              11      PUSH    AF
0012B8 52B8 3AC9F2          13      LD  A,(SECSZ_H)
0012BB 52BB CDAC54          17      CALL    MUL_AHL
0012BE 52BE F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
0012BF 52BF 7D               4      LD  A,L
0012C0 52C0 C5              11      PUSH    BC
0012C1 52C1 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
0012C4 52C4 09              11      ADD HL,BC
0012C5 52C5 C1              10      POP BC
0012C6 52C6 3013            12      JR  NC,DISKIO2
0012C8 52C8 4D               4      LD  C,L     ;C=読み出し元
0012C9 52C9 29              11      ADD HL,HL   ;64KB→32KB
0012CA 52CA 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
0012CB 52CB CD7F54          17      CALL    GET_DISK_BANK_FDRV
0012CE 52CE 84               4      ADD A,H
0012CF 52CF 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
0012D2 52D2 32C4F2          13      LD  (_BANK),A
0012D5 52D5 69               4      LD  L,C     ;C=読み出し元
0012D6 52D6 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
0012D8 52D8 A5               4      AND L
0012D9 52D9 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       52DB                     DISKIO2:
0012DB 52DB C660             7      ADD A,high BANK1_ADR
0012DD 52DD 67               4      LD  H,A
0012DE 52DE ED4BC8F2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
0012E2 52E2 69               4      LD  L,C     ;C=0
0012E3 52E3 CD1D45          17      CALL    ROM_LDIR
0012E6 52E6 EB               4      EX  DE,HL
0012E7 52E7 F1              10      POP AF
0012E8 52E8 D1              10      POP DE
0012E9 52E9 13               6      INC DE
0012EA 52EA C1              10      POP BC
0012EB 52EB 10C6            13      DJNZ    DISKIO1
0012ED 52ED 41               4      LD  B,C
                                
0012EE 52EE E1              10      POP HL
0012EF 52EF AF               4      XOR A
                                
0012F0 52F0 FB               4      EI
0012F1 52F1 C9              10      RET
                                
       52F2                     DSKCHG:
0012F2 52F2 CD2B53          17      CALL    IS_BPB
0012F5 52F5 3824            12      JR  C,NOTREADY
0012F7 52F7 3A23FB          13      LD  A,(DRVTBL+2)
0012FA 52FA B7               4      OR  A
0012FB 52FB 201A            12      JR  NZ,DSKCHG1
0012FD 52FD 3A21FB          13      LD  A,(DRVTBL)
001300 5300 FE02             7      CP  2
001302 5302 2013            12      JR  NZ,DSKCHG1
001304 5304 CD2B53          17      CALL    IS_BPB
001307 5307 300E            12      JR  NC,DSKCHG1
001309 5309 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
00130B 530B 3221FB          13      LD  (DRVTBL),A
00130E 530E 3223FB          13      LD  (DRVTBL+2),A
001311 5311 3A48F3          13      LD  A,(MASTERS)
001314 5314 3224FB          13      LD  (DRVTBL+3),A
       5317                     DSKCHG1:
001317 5317 AF               4      XOR A
001318 5318 0601             7      LD  B,1
00131A 531A C9              10      RET
       531B                     NOTREADY:
00131B 531B 3E02             7      LD  A,2
00131D 531D 37               4      SCF
00131E 531E C9              10      RET
                                
       531F                     NO_BPB:
00131F 531F E1              10      POP HL
001320 5320 23               6      INC HL
001321 5321 11B254          10      LD  DE,DPB2DD
001324 5324 011200          10      LD  BC,DPB2DD_E-DPB2DD
001327 5327 EDB0                    LDIR
001329 5329 AF               4      XOR A
00132A 532A C9              10      RET
                                
       532B                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
00132B 532B CD8954          17      CALL    GET_DISK_BANK
                                
00132E 532E 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
001331 5331 FE01             7      CP  1
001333 5333 D8              11      RET C
                                
001334 5334 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
001337 5337 C6FF             7      ADD A,0FFH
001339 5339 D8              11      RET C
                                
00133A 533A 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       533D                     IS_BPB1:
00133D 533D FE01             7      CP  1
00133F 533F C8              11      RET Z
001340 5340 FE02             7      CP  2
001342 5342 C8              11      RET Z
001343 5343 FE04             7      CP  4
001345 5345 C8              11      RET Z
001346 5346 37               4      SCF
001347 5347 C9              10      RET
                                
       5348                     GETDPB:
001348 5348 E5              11      PUSH    HL
001349 5349 CD8954          17      CALL    GET_DISK_BANK
                                
00134C 534C 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
00134F 534F B7               4      OR  A
001350 5350 28CD            12      JR  Z,NO_BPB
001352 5352 DDE1            14      POP IX
001354 5354 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
001357 5357 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
00135A 535A DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
00135D 535D 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
001360 5360 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
001363 5363 87               4      ADD A,A
001364 5364 87               4      ADD A,A
001365 5365 87               4      ADD A,A
001366 5366 3D               4      DEC A
001367 5367 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
00136A 536A 06FF             7      LD  B,-1
00136C 536C A7               4      AND A           ;無限ループ阻止
       536D                     GETDPB1:
00136D 536D 04               4      INC B
00136E 536E 1F               4      RRA
00136F 536F 38FC            12      JR  C,GETDPB1
001371 5371 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
001374 5374 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001377 5377 3D               4      DEC A
001378 5378 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
00137B 537B A7               4      AND A           ;無限ループ阻止
00137C 537C 06FF             7      LD  B,-1
       537E                     GETDPB2:
00137E 537E 04               4      INC B
00137F 537F 1F               4      RRA
001380 5380 38FC            12      JR  C,GETDPB2
001382 5382 04               4      INC B
001383 5383 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
001386 5386 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
001389 5389 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
00138C 538C DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
00138F 538F 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
001392 5392 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
001395 5395 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
001398 5398 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
00139B 539B ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
00139F 539F DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
0013A2 53A2 DD460A          19      LD  B,(IX+10)       ;FATCNT
0013A5 53A5 210000          10      LD  HL,0
       53A8                     GETDPB3:
0013A8 53A8 19              11      ADD HL,DE
0013A9 53A9 10FD            13      DJNZ    GETDPB3
       53AB                     GETDPB4:
0013AB 53AB DD5E08          19      LD  E,(IX+8)        ;FIRFAT
0013AE 53AE DD5609          19      LD  D,(IX+9)        ;FIRFAT
0013B1 53B1 19              11      ADD HL,DE
0013B2 53B2 DD7511          19      LD  (IX+17),L       ;FIRDIR
0013B5 53B5 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
0013B8 53B8 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0013BB 53BB 87               4      ADD A,A
0013BC 53BC 87               4      ADD A,A
0013BD 53BD DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       53C0                     GETDPB5:
0013C0 53C0 CB3B             8      SRL E
0013C2 53C2 1F               4      RRA
0013C3 53C3 30FB            12      JR  NC,GETDPB5
0013C5 53C5 1600             7      LD  D,0
0013C7 53C7 19              11      ADD HL,DE
0013C8 53C8 DD750C          19      LD  (IX+12),L       ;FIRREC
0013CB 53CB DD740D          19      LD  (IX+13),H       ;FIRREC
                                
0013CE 53CE 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
0013D1 53D1 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
0013D4 53D4 DD560D          19      LD  D,(IX+13)       ;FIRREC
0013D7 53D7 A7               4      AND A
0013D8 53D8 ED52            15      SBC HL,DE
                                
0013DA 53DA DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
0013DD 53DD 3C               4      INC A
0013DE 53DE 37               4      SCF             ;無限ループ阻止
       53DF                     GETDPB6:
0013DF 53DF 1F               4      RRA
0013E0 53E0 3806            12      JR  C,GETDPB7
0013E2 53E2 CB3C             8      SRL H
0013E4 53E4 CB1D             8      RR  L
0013E6 53E6 18F7            12      JR  GETDPB6
       53E8                     GETDPB7:
0013E8 53E8 23               6      INC HL
0013E9 53E9 DD750E          19      LD  (IX+14),L       ;MAXCLUS
0013EC 53EC DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       53EF                     GETDPBD1:
0013EF 53EF DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0013F2 53F2 E6FC             7      AND 0FCH
0013F4 53F4 C8              11      RET Z
                                
0013F5 53F5 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
0013F9 53F9 37               4      SCF
0013FA 53FA DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
0013FE 53FE DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
001401 5401 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
001405 5405 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001409 5409 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
00140D 540D DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
001411 5411 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
001415 5415 DDCB1126        23      SLA (IX+17)         ;FIRDIR
001419 5419 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
00141D 541D DD6E11          19      LD  L,(IX+17)       ;FIRDIR
001420 5420 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
001423 5423 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001426 5426 87               4      ADD A,A
001427 5427 87               4      ADD A,A
001428 5428 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       542B                     GETDPBD5:
00142B 542B CB3B             8      SRL E
00142D 542D 1F               4      RRA
00142E 542E 30FB            12      JR  NC,GETDPBD5
001430 5430 1600             7      LD  D,0
001432 5432 19              11      ADD HL,DE
001433 5433 DD750C          19      LD  (IX+12),L       ;FIRREC
001436 5436 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001439 5439 18B4            12      JR  GETDPBD1
                                
       543B                     CHOICE:
00143B 543B 210000          10      LD  HL,0
00143E 543E C9              10      RET
                                
       543F                     DSKFMT:
00143F 543F AF               4      XOR A
001440 5440 37               4      SCF
       5441                     DSKSTP:
001441 5441 C9              10      RET
                                
       5442                     BASENT:
001442 5442 2A74F6          16      LD  HL,(STKTOP)
001445 5445 3A40F3          13      LD  A,(REBOOT)
001448 5448 C6FF             7      ADD A,0FFH
00144A 544A 3811            12      JR  C,REBOOT1
00144C 544C 21C454          10      LD  HL,AUTOEXEC
00144F 544F 11F8F2          10      LD  DE,FDRV
001452 5452 010C00          10      LD  BC,1+8+3
001455 5455 EDB0                    LDIR
001457 5457 CD7D4D          17      CALL    ROM_OPEN
00145A 545A D4E546          17      CALL    NC,ROM_LOAD1
       545D                     REBOOT1:
00145D 545D 21D054          10      LD  HL,CMD_RUN
001460 5460 111FF4          10      LD  DE,KBUF
001463 5463 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
001466 5466 D5              11      PUSH    DE
001467 5467 EDB0                    LDIR
001469 5469 3004            12      JR  NC,REBOOT2
00146B 546B AF               4      XOR A
00146C 546C 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       546F                     REBOOT2:
00146F 546F E1              10      POP HL
001470 5470 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
001474 5474 DD210146        14      LD  IX,NEWSTT
001478 5478 C31C00          10      JP  _CALSLT
                                
       547B                     GETSLT:
00147B 547B 3A22FB          13      LD  A,(DRVTBL+1)
00147E 547E C9              10      RET
                                
       547F                     GET_DISK_BANK_FDRV:
00147F 547F 3AF8F2          13      LD  A,(FDRV)
001482 5482 D601             7      SUB 1
001484 5484 3003            12      JR  NC,GET_DISK_BANK
001486 5486 3AEAF2          13      LD  A,(_DVSW)
       5489                     GET_DISK_BANK:
001489 5489 FE07             7      CP  7       ;H:
00148B 548B 2801            12      JR  Z,SET_DISK_BANK_A
00148D 548D B7               4      OR  A       ;A=DRIVE
       548E                     SET_DISK_BANK_A:
00148E 548E 3E01             7      LD  A,DISK_BANK
001490 5490 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001492 5492 3AE9F2          13      LD  A,(B_DRIVE)
                                #endif
       5495                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
001495 5495 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
001498 5498 F5              11      PUSH    AF
001499 5499 E5              11      PUSH    HL
00149A 549A 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
00149D 549D 22C8F2          16      LD  (SECSZ),HL
0014A0 54A0 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0014A3 54A3 CDAC54          17      CALL    MUL_AHL
0014A6 54A6 22C6F2          16      LD  (CLSZ),HL
0014A9 54A9 E1              10      POP HL
0014AA 54AA F1              10      POP AF
0014AB 54AB C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       54AC                     MUL_AHL:
0014AC 54AC 37               4      SCF     ;無限ループ回避
       54AD                     MUL_AHL1:
0014AD 54AD 1F               4      RRA     ;->CF
0014AE 54AE D8              11      RET C
0014AF 54AF 29              11      ADD HL,HL
0014B0 54B0 18FB            12      JR  MUL_AHL1
                                
       54B2                     DPB2DD:
0014B2 54B2 F9                      DB  0F9H    ;MEDIA
0014B3 54B3 0002                    DW  00200H  ;SECSIZ
0014B5 54B5 0F                      DB  00FH    ;DIRMSK
0014B6 54B6 04                      DB  004H    ;DIRSHFT
0014B7 54B7 01                      DB  001H    ;CLUSMSK
0014B8 54B8 02                      DB  002H    ;CLUSSHFT
0014B9 54B9 0100                    DW  00001H  ;FIRFAT
0014BB 54BB 02                      DB  002H    ;FATCNT
0014BC 54BC 70                      DB  070H    ;MAXENT
0014BD 54BD 0E00                    DW  0000EH  ;FIRREC
0014BF 54BF CA02                    DW  002CAH  ;MAXCLUS
0014C1 54C1 03                      DB  003H    ;FATSIZ
0014C2 54C2 0700                    DW  0007H   ;FIRDIR
       54C4                     DPB2DD_E:
                                
       54C4                     AUTOEXEC:
0014C4 54C4 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       54D0                     CMD_RUN:
0014D0 54D0 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
0014D6 54D6 40F2                    DW  NEW_HIMEM
       54D8                     CMD_CLEAR_E:
0014D8 54D8 3A8A00                  DB  03AH,08AH,0         ;RUN
       54DB                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       54DB                     POP_HL_ERROR:
0014DB 54DB E1              10      POP     HL
       54DC                     _ERROR:
0014DC 54DC 0600             7      LD  B,0
0014DE 54DE A7               4      AND A
0014DF 54DF C9              10      RET
                                
       54E0                     ROM_BDOS:
0014E0 54E0 E5              11      PUSH    HL
0014E1 54E1 79               4      LD  A,C
0014E2 54E2 87               4      ADD A,A
0014E3 54E3 38F7            12      JR  C,_ERROR
0014E5 54E5 6F               4      LD  L,A
0014E6 54E6 265F             7      LD  H,high STABLE
0014E8 54E8 7E               7      LD  A,(HL)
0014E9 54E9 2C               4      INC L
0014EA 54EA 66               7      LD  H,(HL)
0014EB 54EB 6F               4      LD  L,A
0014EC 54EC E3              19      EX  (SP),HL
0014ED 54ED 79               4      LD  A,C
0014EE 54EE C9              10      RET
                                
       54EF                     _PRINT:
       54EF                     PRINT:
0014EF 54EF 7B               4      LD  A,E
0014F0 54F0 1803            12      JR  MSG_A
                                
       54F2                     _SYS01:     ;(BDOS)コンソール入力
0014F2 54F2 CD7755          17      CALL    _SYS07
       54F5                     MSG_A:
0014F5 54F5 FE03             7      CP  3
0014F7 54F7 2814            12      JR  Z,MSG_BR
       54F9                     MSGA1:
0014F9 54F9 F5              11      PUSH    AF
0014FA 54FA C5              11      PUSH    BC
0014FB 54FB D5              11      PUSH    DE
0014FC 54FC E5              11      PUSH    HL
0014FD 54FD DDE5            15      PUSH    IX
0014FF 54FF DD21A200        14      LD  IX,CHPUT
001503 5503 CD0544          17      CALL    CALSLT_R
001506 5506 DDE1            14      POP IX
001508 5508 E1              10      POP HL
001509 5509 D1              10      POP DE
00150A 550A C1              10      POP BC
       550B                     MSGA2:
00150B 550B F1              10      POP AF
00150C 550C C9              10      RET
       550D                     MSG_BR:
00150D 550D F5              11      PUSH    AF
00150E 550E 3ADDF3          13      LD  A,(CSRX)
001511 5511 FE02             7      CP  2
001513 5513 38F6            12      JR  C,MSGA2
001515 5515 F1              10      POP AF
       5516                     MSG_CR:
001516 5516 F5              11      PUSH    AF
001517 5517 3E0D             7      LD  A,00DH
001519 5519 CDF954          17      CALL    MSGA1
00151C 551C 3E0A             7      LD  A,00AH
00151E 551E CDF954          17      CALL    MSGA1
001521 5521 F1              10      POP AF
001522 5522 C9              10      RET
                                
       5523                     _SYS02:     ;(BDOS)コンソール出力
001523 5523 CD3E55          17      CALL    BREAK
001526 5526 1805            12      JR  PRINTX
                                
       5528                     _SYS06:     ;(BDOS)コンソール直接入出力
001528 5528 7B               4      LD  A,E
001529 5529 3C               4      INC A
00152A 552A CA8B55          10      JP  Z,_INKEY
       552D                     PRINTX:
00152D 552D C3EF54          10      JP  _PRINT
                                
       5530                     _SYS08:     ;(BDOS)エコーなしコンソール入力
001530 5530 CD7755          17      CALL    _SYS07
001533 5533 FE03             7      CP  3
001535 5535 CC3E55          17      CALL    Z,_BREAK
001538 5538 FE13             7      CP  013H        ;CTRL+S
00153A 553A C0              11      RET NZ
       553B                     PAUSE:
00153B 553B CD5555          17      CALL    KEYBC
                                
       553E                     _BREAK:
       553E                     BREAK:
00153E 553E F5              11      PUSH    AF
00153F 553F C5              11      PUSH    BC
001540 5540 D5              11      PUSH    DE
001541 5541 E5              11      PUSH    HL
001542 5542 DDE5            15      PUSH    IX
001544 5544 DD21B700        14      LD  IX,BREAKX
001548 5548 CD0544          17      CALL    CALSLT_R
00154B 554B DDE1            14      POP IX
00154D 554D E1              10      POP HL
00154E 554E D1              10      POP DE
00154F 554F C1              10      POP BC
001550 5550 DC3E55          17      CALL    C,_BREAK
001553 5553 F1              10      POP AF
001554 5554 C9              10      RET
       5555                     KEYBC:
001555 5555 F5              11      PUSH    AF
001556 5556 C5              11      PUSH    BC
001557 5557 D5              11      PUSH    DE
001558 5558 E5              11      PUSH    HL
001559 5559 DDE5            15      PUSH    IX
00155B 555B DD215601        14      LD  IX,KILBUF
00155F 555F CD0544          17      CALL    CALSLT_R
001562 5562 DDE1            14      POP IX
001564 5564 E1              10      POP HL
001565 5565 D1              10      POP DE
001566 5566 C1              10      POP BC
001567 5567 F1              10      POP AF
001568 5568 C9              10      RET
                                
       5569                     _SYS09:     ;(BDOS)文字列出力
001569 5569 D5              11      PUSH    DE
       556A                     _SX09:
00156A 556A 1A               7      LD  A,(DE)
00156B 556B 13               6      INC DE
00156C 556C FE24             7      CP  '$'
00156E 556E 2805            12      JR  Z,POPDE_RET
001570 5570 CDF554          17      CALL    MSG_A
001573 5573 18F5            12      JR  _SX09
       5575                     POPDE_RET:
001575 5575 D1              10      POP DE
001576 5576 C9              10      RET
                                
       5577                     _SYS07:
       5577                     FLGET:
001577 5577 C5              11      PUSH    BC
001578 5578 D5              11      PUSH    DE
001579 5579 E5              11      PUSH    HL
00157A 557A DDE5            15      PUSH    IX
00157C 557C DD219F00        14      LD  IX,CHGET
001580 5580 CD0544          17      CALL    CALSLT_R
001583 5583 DDE1            14      POP IX
001585 5585 E1              10      POP HL
001586 5586 D1              10      POP DE
001587 5587 C1              10      POP BC
001588 5588 FE03             7      CP  3
00158A 558A C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       558B                     _INKEY:
       558B                     INKEY:
00158B 558B CD2556          17      CALL    CPM_CONST
00158E 558E C8              11      RET Z
00158F 558F 18E6            12      JR  FLGET
                                
       5591                     _SYS0A:     ;(BDOS)文字列入力
001591 5591 C5              11      PUSH    BC
001592 5592 E5              11      PUSH    HL
001593 5593 D5              11      PUSH    DE
001594 5594 CDBD55          17      CALL    GETL
001597 5597 111FF4          10      LD  DE,KBUF
00159A 559A E1              10      POP HL
00159B 559B E5              11      PUSH    HL
00159C 559C 0E00             7      LD  C,0
00159E 559E 3004            12      JR  NC,SAX0
0015A0 55A0 23               6      INC HL
0015A1 55A1 23               6      INC HL
0015A2 55A2 1808            12      JR  SAX4
       55A4                     SAX0:
0015A4 55A4 46               7      LD  B,(HL)
0015A5 55A5 23               6      INC HL
       55A6                     SAX1:
0015A6 55A6 23               6      INC HL
0015A7 55A7 1A               7      LD  A,(DE)
0015A8 55A8 13               6      INC DE
0015A9 55A9 B7               4      OR  A
0015AA 55AA 2004            12      JR  NZ,SAX2
       55AC                     SAX4:
0015AC 55AC 360D            10      LD  (HL),00DH
0015AE 55AE 1804            12      JR  SAX3
       55B0                     SAX2:
0015B0 55B0 77               7      LD  (HL),A
0015B1 55B1 0C               4      INC C
0015B2 55B2 10F2            13      DJNZ    SAX1
       55B4                     SAX3:
0015B4 55B4 D1              10      POP DE
0015B5 55B5 79               4      LD  A,C
0015B6 55B6 13               6      INC DE
0015B7 55B7 12               7      LD  (DE),A
0015B8 55B8 1B               6      DEC DE
0015B9 55B9 E1              10      POP HL
0015BA 55BA C1              10      POP BC
0015BB 55BB A7               4      AND A
0015BC 55BC C9              10      RET
       55BD                     GETL:
0015BD 55BD DDE5            15      PUSH    IX
0015BF 55BF FDE5            15      PUSH    IY
                                
0015C1 55C1 2ADCF3          16      LD  HL,(CSRY)
0015C4 55C4 22CAFB          16      LD  (FSTPOS),HL
       55C7                     GETL1:
0015C7 55C7 CD3055          17      CALL    _SYS08
0015CA 55CA FE09             7      CP  9
0015CC 55CC 2008            12      JR  NZ,GETL1V
0015CE 55CE 211FF4          10      LD  HL,KBUF
0015D1 55D1 CD9C44          17      CALL    MSX
0015D4 55D4 18F1            12      JR  GETL1
       55D6                     GETL1V:
0015D6 55D6 5F               4      LD  E,A
0015D7 55D7 FE08             7      CP  8
0015D9 55D9 CCD256          17      CALL    Z,CTRL02
0015DC 55DC FE20             7      CP  020H
0015DE 55DE D4FE56          17      CALL    NC,INSERT
0015E1 55E1 CDF954          17      CALL    MSGA1
                                
0015E4 55E4 7B               4      LD  A,E
0015E5 55E5 FE0D             7      CP  00DH
0015E7 55E7 20DE            12      JR  NZ,GETL1
                                
0015E9 55E9 111FF4          10      LD  DE,KBUF
0015EC 55EC 3AB0F3          13      LD  A,(LINLEN)
0015EF 55EF 47               4      LD  B,A
0015F0 55F0 CDDF58          17      CALL    ZERO_MEMORY_DE
                                
0015F3 55F3 2ACAFB          16      LD  HL,(FSTPOS)
0015F6 55F6 3ADCF3          13      LD  A,(CSRY)
0015F9 55F9 6F               4      LD  L,A
0015FA 55FA E5              11      PUSH    HL
0015FB 55FB CD2F57          17      CALL    LOC0
0015FE 55FE 4D               4      LD  C,L
0015FF 55FF 44               4      LD  B,H
001600 5600 E1              10      POP HL
001601 5601 3AB0F3          13      LD  A,(LINLEN)
001604 5604 94               4      SUB H
001605 5605 3D               4      DEC A
001606 5606 5F               4      LD  E,A
001607 5607 211FF4          10      LD  HL,KBUF
       560A                     GETL2:
00160A 560A CDC256          17      CALL    _SCRN
00160D 560D 03               6      INC BC
00160E 560E 77               7      LD  (HL),A
00160F 560F 23               6      INC HL
001610 5610 1D               4      DEC E
001611 5611 20F7            12      JR  NZ,GETL2
001613 5613 CD1655          17      CALL    MSG_CR
                                
001616 5616 FDE1            14      POP IY
001618 5618 DDE1            14      POP IX
       561A                     GETL3:
00161A 561A 2B               6      DEC HL
00161B 561B 7E               7      LD  A,(HL)
00161C 561C FE21             7      CP  021H
00161E 561E D0              11      RET NC
00161F 561F 3600            10      LD  (HL),0
001621 5621 15               4      DEC D
001622 5622 20F6            12      JR  NZ,GETL3
001624 5624 C9              10      RET
                                
       5625                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       5625                     CONSTX:
       5625                     CPM_CONST:
001625 5625 C5              11      PUSH    BC
001626 5626 D5              11      PUSH    DE
001627 5627 E5              11      PUSH    HL
001628 5628 DDE5            15      PUSH    IX
00162A 562A DD219C00        14      LD  IX,CHSNS
00162E 562E CD0544          17      CALL    CALSLT_R
001631 5631 DDE1            14      POP IX
001633 5633 E1              10      POP HL
001634 5634 D1              10      POP DE
001635 5635 C1              10      POP BC
001636 5636 C9              10      RET
                                
       5637                     _SYS2A:     ;(BDOS)日付の獲得
001637 5637 0E0B             7      LD  C,11        ;年/Year→HL
001639 5639 CD7856          17      CALL    RDCLK_BCD
00163C 563C 6F               4      LD  L,A
00163D 563D 2600             7      LD  H,0
00163F 563F 3AF8FA          13      LD  A,(EXBRSA)
001642 5642 B7               4      OR  A
001643 5643 2804            12      JR  Z,SX2A1
001645 5645 11BC07          10      LD  DE,1980     ;1980年～2079年
001648 5648 19              11      ADD HL,DE
       5649                     SX2A1:
001649 5649 0E09             7      LD  C,9     ;月/Month→D
00164B 564B CD7856          17      CALL    RDCLK_BCD
00164E 564E 57               4      LD  D,A
                                
00164F 564F 0E07             7      LD  C,7     ;日/Day→E
001651 5651 CD7856          17      CALL    RDCLK_BCD
001654 5654 5F               4      LD  E,A
                                
001655 5655 0E06             7      LD  C,6     ;曜日/Week→A
       5657                     RDCLK:
001657 5657 DDE5            15      PUSH    IX
001659 5659 DD21F501        14      LD  IX,REDCLK
       565D                     WRCLK1:
00165D 565D 3AF8FA          13      LD  A,(EXBRSA)
001660 5660 B7               4      OR  A
001661 5661 280A            12      JR  Z,RDCLK1    ;MSX1
001663 5663 FDE5            15      PUSH    IY
001665 5665 FD67             9      LD  IYH,A
001667 5667 78               4      LD  A,B
001668 5668 CD1C00          17      CALL    _CALSLT
00166B 566B FDE1            14      POP IY
       566D                     RDCLK1:
00166D 566D DDE1            14      POP IX
00166F 566F C9              10      RET
       5670                     WRCLK:
001670 5670 DDE5            15      PUSH    IX
001672 5672 DD21F901        14      LD  IX,WRTCLK
001676 5676 18E5            12      JR  WRCLK1
                                
       5678                     RDCLK_BCD:
001678 5678 CD5756          17      CALL    RDCLK       ;1の位
00167B 567B 47               4      LD  B,A
00167C 567C 0C               4      INC C
00167D 567D CD5756          17      CALL    RDCLK       ;10の位
001680 5680 87               4      ADD A,A     ;*2
001681 5681 4F               4      LD  C,A
001682 5682 87               4      ADD A,A     ;*4
001683 5683 87               4      ADD A,A     ;*8
001684 5684 81               4      ADD A,C     ;*10(8+2)
001685 5685 80               4      ADD A,B     ;1の位
001686 5686 C9              10      RET
                                
       5687                     _SYS2C:     ;(BDOS)時刻の獲得
001687 5687 011501          10      LD  BC,00115H       ;12時間計/24時間計の設定を24時間計に
00168A 568A CD7056          17      CALL    WRCLK
00168D 568D 0E04             7      LD  C,4     ;H=時/Hour
00168F 568F CD7856          17      CALL    RDCLK_BCD
001692 5692 67               4      LD  H,A
001693 5693 0E02             7      LD  C,2     ;L=分/Minute
001695 5695 CD7856          17      CALL    RDCLK_BCD
001698 5698 6F               4      LD  L,A
001699 5699 0E00             7      LD  C,0     ;D=秒/Second
00169B 569B CD7856          17      CALL    RDCLK_BCD
00169E 569E 57               4      LD  D,A
00169F 569F AF               4      XOR A       ;E=1/100秒
0016A0 56A0 5F               4      LD  E,A
0016A1 56A1 C9              10      RET
                                
       56A2                     POS:
0016A2 56A2 F5              11      PUSH    AF
0016A3 56A3 2ADCF3          16      LD  HL,(CSRY)
0016A6 56A6 7D               4      LD  A,L
0016A7 56A7 6C               4      LD  L,H
0016A8 56A8 67               4      LD  H,A
0016A9 56A9 2C               4      INC L
0016AA 56AA 24               4      INC H
0016AB 56AB F1              10      POP AF
0016AC 56AC C9              10      RET
                                
       56AD                     LOC:
0016AD 56AD F5              11      PUSH    AF
0016AE 56AE E5              11      PUSH    HL
0016AF 56AF 7D               4      LD  A,L
0016B0 56B0 6C               4      LD  L,H
0016B1 56B1 67               4      LD  H,A
0016B2 56B2 2D               4      DEC L
0016B3 56B3 25               4      DEC H
0016B4 56B4 DDE5            15      PUSH    IX
0016B6 56B6 DD21C600        14      LD  IX,POSIT
0016BA 56BA CD0544          17      CALL    CALSLT_R
0016BD 56BD DDE1            14      POP IX
0016BF 56BF E1              10      POP HL
0016C0 56C0 F1              10      POP AF
0016C1 56C1 C9              10      RET
                                
       56C2                     _SCRN:
       56C2                     SCRN:
0016C2 56C2 E5              11      PUSH    HL
0016C3 56C3 DDE5            15      PUSH    IX
                                
0016C5 56C5 69               4      LD  L,C
0016C6 56C6 60               4      LD  H,B
0016C7 56C7 DD214A00        14      LD  IX,RDVRM
0016CB 56CB CD0544          17      CALL    CALSLT_R
                                
0016CE 56CE DDE1            14      POP IX
0016D0 56D0 E1              10      POP HL
0016D1 56D1 C9              10      RET
                                
       56D2                     CTRL02:
0016D2 56D2 F5              11      PUSH    AF
0016D3 56D3 D5              11      PUSH    DE
0016D4 56D4 2ADCF3          16      LD  HL,(CSRY)
0016D7 56D7 3AB0F3          13      LD  A,(LINLEN)
0016DA 56DA 4F               4      LD  C,A
0016DB 56DB 94               4      SUB H   ;CSRX
0016DC 56DC C602             7      ADD A,2
0016DE 56DE 47               4      LD  B,A ;カーソルより右の文字数
0016DF 56DF 61               4      LD  H,C ;LINLEN
0016E0 56E0 C5              11      PUSH    BC
0016E1 56E1 CD2F57          17      CALL    LOC0
0016E4 56E4 C1              10      POP BC
                                
0016E5 56E5 1620             7      LD  D,020H
       56E7                     C8X1:
0016E7 56E7 DD214A00        14      LD  IX,RDVRM
0016EB 56EB CD0544          17      CALL    CALSLT_R
0016EE 56EE 4F               4      LD  C,A
0016EF 56EF 7A               4      LD  A,D
0016F0 56F0 DD214D00        14      LD  IX,WRTVRM
0016F4 56F4 CD0544          17      CALL    CALSLT_R
0016F7 56F7 2B               6      DEC HL
0016F8 56F8 51               4      LD  D,C
0016F9 56F9 10EC            13      DJNZ    C8X1
0016FB 56FB D1              10      POP DE
0016FC 56FC F1              10      POP AF
0016FD 56FD C9              10      RET
                                
       56FE                     INSERT:
0016FE 56FE F5              11      PUSH    AF
0016FF 56FF D5              11      PUSH    DE
001700 5700 2ADCF3          16      LD  HL,(CSRY)
001703 5703 3AB0F3          13      LD  A,(LINLEN)
001706 5706 4F               4      LD  C,A
001707 5707 94               4      SUB H   ;CSRX
001708 5708 3C               4      INC A
001709 5709 47               4      LD  B,A ;カーソルより右の文字数
00170A 570A C5              11      PUSH    BC
00170B 570B CD2F57          17      CALL    LOC0
00170E 570E C1              10      POP BC
                                
00170F 570F 1620             7      LD  D,020H
       5711                     INS1:
001711 5711 DD214A00        14      LD  IX,RDVRM
001715 5715 CD0544          17      CALL    CALSLT_R
001718 5718 4F               4      LD  C,A
001719 5719 7A               4      LD  A,D
00171A 571A DD214D00        14      LD  IX,WRTVRM
00171E 571E CD0544          17      CALL    CALSLT_R
001721 5721 23               6      INC HL
001722 5722 51               4      LD  D,C
001723 5723 10EC            13      DJNZ    INS1
001725 5725 D1              10      POP DE
001726 5726 F1              10      POP AF
001727 5727 C9              10      RET
                                
       5728                     CONOUT1:
001728 5728 59               4      LD  E,C
001729 5729 C3EF54          10      JP  _PRINT
                                
       572C                     GETVRAM:
00172C 572C 2ADCF3          16      LD  HL,(CSRY)
       572F                     LOC0:
00172F 572F 2D               4      DEC L
001730 5730 25               4      DEC H
001731 5731 4C               4      LD  C,H ;CSRX-1
001732 5732 5D               4      LD  E,L ;CSRY-1
       5733                     LOC1:
001733 5733 3AB0F3          13      LD  A,(LINLEN)
001736 5736 67               4      LD  H,A
001737 5737 1600             7      LD  D,0
001739 5739 6A               4      LD  L,D ;0
00173A 573A 0608             7      LD  B,8
       573C                     LOC2:
00173C 573C 29              11      ADD HL,HL
00173D 573D 3001            12      JR  NC,LOC3
00173F 573F 19              11      ADD HL,DE
       5740                     LOC3:
001740 5740 10FA            13      DJNZ    LOC2
001742 5742 09              11      ADD HL,BC
001743 5743 C9              10      RET
                                
       5744                     _SYS0C:     ;(BDOS)バージョン番号の獲得
001744 5744 212200          10      LD  HL,00022H
001747 5747 AF               4      XOR A
001748 5748 7D               4      LD  A,L
001749 5749 C9              10      RET
                                
       574A                     _SYS0D:     ;(BDOS)ディスク・リセット
00174A 574A 218000          10      LD  HL,00080H
00174D 574D 22D4F2          16      LD  (_DTA),HL
001750 5750 C9              10      RET
                                
       5751                     _SYS0E:     ;(BDOS)カレントドライブの設定
001751 5751 7B               4      LD  A,E
       5752                     _SYS0EX1:
001752 5752 FE08             7      CP  8
001754 5754 3F               4      CCF
001755 5755 D8              11      RET C
001756 5756 32EAF2          13      LD  (_DVSW),A
001759 5759 C9              10      RET
                                
       575A                     _SYS0F:     ;(BDOS)ファイルのオープン
00175A 575A D5              11      PUSH    DE
00175B 575B FDE1            14      POP IY
00175D 575D CDC958          17      CALL    INIT_FILE
001760 5760 CD7D4D          17      CALL    ROM_OPEN
001763 5763 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
001765 5765 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
001769 5769 FDE5            15      PUSH    IY
00176B 576B D1              10      POP DE
00176C 576C 13               6      INC DE
00176D 576D 010B00          10      LD  BC,11
001770 5770 EDB0                    LDIR
                                ;               Attribute
001772 5772 7E               7      LD  A,(HL)
001773 5773 FD770D          19      LD  (IY+13),A
                                ;               TIME
001776 5776 110B00          10      LD  DE,11
001779 5779 19              11      ADD HL,DE
00177A 577A 7E               7      LD  A,(HL)
00177B 577B 23               6      INC HL
00177C 577C FD7716          19      LD  (IY+22),A
00177F 577F 7E               7      LD  A,(HL)
001780 5780 23               6      INC HL
001781 5781 FD7717          19      LD  (IY+23),A
                                ;               DATE
001784 5784 7E               7      LD  A,(HL)
001785 5785 23               6      INC HL
001786 5786 FD7714          19      LD  (IY+20),A
001789 5789 7E               7      LD  A,(HL)
00178A 578A 23               6      INC HL
00178B 578B FD7715          19      LD  (IY+21),A
                                ;               First cluster
00178E 578E 7E               7      LD  A,(HL)
00178F 578F 23               6      INC HL
001790 5790 FD771A          19      LD  (IY+26),A
001793 5793 7E               7      LD  A,(HL)
001794 5794 23               6      INC HL
001795 5795 FD771B          19      LD  (IY+27),A
                                ;               SIZE
001798 5798 7E               7      LD  A,(HL)
001799 5799 23               6      INC HL
00179A 579A FD7710          19      LD  (IY+16),A
00179D 579D 7E               7      LD  A,(HL)
00179E 579E 23               6      INC HL
00179F 579F FD7711          19      LD  (IY+17),A
0017A2 57A2 7E               7      LD  A,(HL)
0017A3 57A3 23               6      INC HL
0017A4 57A4 FD7712          19      LD  (IY+18),A
0017A7 57A7 7E               7      LD  A,(HL)
0017A8 57A8 FD7713          19      LD  (IY+19),A
0017AB 57AB AF               4      XOR A
0017AC 57AC FD770C          19      LD  (IY+12),A
0017AF 57AF C9              10      RET
                                
       57B0                     _SYS10:     ;(BDOS)ファイルのクローズ
0017B0 57B0 AF               4      XOR A
0017B1 57B1 C9              10      RET
                                
       57B2                     S11X1:
0017B2 57B2 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0017B5 57B5 FD750E          19      LD  (IY+14),L
0017B8 57B8 FD740F          19      LD  (IY+15),H
       57BB                     SCF_FF_RET:
0017BB 57BB 37               4      SCF
0017BC 57BC 9F               4      SBC A,A
0017BD 57BD C9              10      RET
                                
       57BE                     _SYS11:     ;(BDOS)最初のファイルの検索
0017BE 57BE ED53D7F2        20      LD  (_FCB),DE
0017C2 57C2 D5              11      PUSH    DE
0017C3 57C3 FDE1            14      POP IY
0017C5 57C5 CDC958          17      CALL    INIT_FILE
0017C8 57C8 CDD94F          17      CALL    GET_DIR_DAT
       57CB                     S12X1:
0017CB 57CB CD994D          17      CALL    FILESE
0017CE 57CE 30E2            12      JR  NC,S11X1
0017D0 57D0 0D               4      DEC C
0017D1 57D1 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0017D4 57D4 FDCB0D66        20      BIT 4,(IY+13)
0017D8 57D8 2809            12      JR  Z,S12X2
0017DA 57DA E5              11      PUSH    HL
0017DB 57DB DDE1            14      POP IX
0017DD 57DD DDCB0E66        20      BIT 4,(IX+1+13)
0017E1 57E1 28E8            12      JR  Z,S12X1
       57E3                     S12X2:
0017E3 57E3 012000          10      LD  BC,32
0017E6 57E6 ED5BD4F2        20      LD  DE,(_DTA)
0017EA 57EA AF               4      XOR A
0017EB 57EB 12               7      LD  (DE),A      ;ドライブ番号
0017EC 57EC 13               6      INC DE
0017ED 57ED EDB0                    LDIR            ;ディレクトリエントリ
0017EF 57EF FD750E          19      LD  (IY+14),L
0017F2 57F2 FD740F          19      LD  (IY+15),H
0017F5 57F5 C9              10      RET
                                
       57F6                     _SYS12:
0017F6 57F6 FD2AD7F2        20      LD  IY,(_FCB)
0017FA 57FA FDE5            15      PUSH    IY
0017FC 57FC D1              10      POP DE
0017FD 57FD CDC958          17      CALL    INIT_FILE
                                
001800 5800 FD6E0E          19      LD  L,(IY+14)
001803 5803 FD660F          19      LD  H,(IY+15)
001806 5806 FD4E19          19      LD  C,(IY+25)
001809 5809 18C0            12      JR  S12X1
                                
       580B                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
00180B 580B CDBF4F          17      CALL    SET_FCB
00180E 580E CD8D4F          17      CALL    GETSEQ
001811 5811 CD7A4F          17      CALL    RB_READ
001814 5814 E5              11      PUSH    HL
001815 5815 CD9A4F          17      CALL    SETSEQ
001818 5818 E1              10      POP HL
       5819                     SREAD:
001819 5819 C601             7      ADD A,001H
00181B 581B D8              11      RET C
                                
00181C 581C 7D               4      LD  A,L
00181D 581D D601             7      SUB 001H
00181F 581F 9F               4      SBC A,A
001820 5820 E603             7      AND 3
001822 5822 1F               4      RRA
001823 5823 C9              10      RET
                                
       5824                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001824 5824 218300          10      LD  HL,00083H
001827 5827 AF               4      XOR A
001828 5828 C9              10      RET
                                
       5829                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001829 5829 3AEAF2          13      LD  A,(_DVSW)
00182C 582C A7               4      AND A
00182D 582D C9              10      RET
                                
       582E                     _SYS1A:     ;(BDOS)DTAの設定
00182E 582E ED53D4F2        20      LD  (_DTA),DE
001832 5832 AF               4      XOR A
001833 5833 C9              10      RET
                                
       5834                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001834 5834 010002          10      LD  BC,512
001837 5837 11C302          10      LD  DE,707
00183A 583A 210000          10      LD  HL,0
00183D 583D DD21D9F2        14      LD  IX,_BUF
001841 5841 FD21D9F2        14      LD  IY,_BUF
001845 5845 FD3600F9        19      LD  (IY+0),0F9H
001849 5849 3E02             7      LD  A,2
00184B 584B C9              10      RET
                                
       584C                     _SYS21:     ;(BDOS)ランダムな読み出し
00184C 584C CDBF4F          17      CALL    SET_FCB
                                
00184F 584F FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001852 5852 FD6622          19      LD  H,(IY+34)
                                
001855 5855 CD7A4F          17      CALL    RB_READ
001858 5858 18BF            12      JR  SREAD
                                
       585A                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00185A 585A CD5A57          17      CALL    _SYS0F
00185D 585D D8              11      RET C
                                
00185E 585E D5              11      PUSH    DE      ;EX DE,IY
00185F 585F FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001861 5861 CDAF4F          17      CALL    GETSIZE
       5864                     _S24X1:
001864 5864 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001867 5867 FD7422          19      LD  (IY+34),H
00186A 586A FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
00186E 586E FDE3            23      EX  (SP),IY     ;
001870 5870 D1              10      POP DE      ;
                                
001871 5871 AF               4      XOR A
001872 5872 C9              10      RET
                                
       5873                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001873 5873 E5              11      PUSH    HL
001874 5874 D5              11      PUSH    DE      ;EX DE,IY
001875 5875 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001877 5877 CD8D4F          17      CALL    GETSEQ
00187A 587A 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       587C                     _SYS27:     ;(BDOS)ランダムブロック読み込み
00187C 587C CDBF4F          17      CALL    SET_FCB
00187F 587F E5              11      PUSH    HL
001880 5880 FD6E21          19      LD  L,(IY+33)
001883 5883 FD6622          19      LD  H,(IY+34)
001886 5886 22CAF2          16      LD  (RR_LOW),HL
001889 5889 FD6E23          19      LD  L,(IY+35)
00188C 588C FD6624          19      LD  H,(IY+36)
00188F 588F 22CCF2          16      LD  (RR_HIGH),HL
001892 5892 E1              10      POP HL
001893 5893 CD4A4B          17      CALL    ROM_READ
001896 5896 ED5BCAF2        20      LD  DE,(RR_LOW)
00189A 589A FD7321          19      LD  (IY+33),E
00189D 589D FD7222          19      LD  (IY+34),D
0018A0 58A0 ED5BCCF2        20      LD  DE,(RR_HIGH)
0018A4 58A4 FD7323          19      LD  (IY+35),E
0018A7 58A7 FD7224          19      LD  (IY+36),D
0018AA 58AA 9F               4      SBC A,A
0018AB 58AB C9              10      RET
                                
       58AC                     _SYS2F:
0018AC 58AC 44               4      LD  B,H
0018AD 58AD 2AD4F2          16      LD  HL,(_DTA)
0018B0 58B0 C3AC52          10      JP  DISKIO
                                
       58B3                     _SYS5A:
0018B3 58B3 0600             7      LD  B,0
0018B5 58B5 D5              11      PUSH    DE
0018B6 58B6 DDE1            14      POP IX
       58B8                     _SX5A1:
0018B8 58B8 1A               7      LD  A,(DE)
0018B9 58B9 B7               4      OR  A
0018BA 58BA 2804            12      JR  Z,_SX5A2
0018BC 58BC 13               6      INC DE
0018BD 58BD 04               4      INC B
0018BE 58BE 18F8            12      JR  _SX5A1
                                
       58C0                     _SX5A2:
0018C0 58C0 78               4      LD  A,B
0018C1 58C1 CD154C          17      CALL    FILE_BDOS
0018C4 58C4 CD7950          17      CALL    ROM_CD
0018C7 58C7 9F               4      SBC A,A
0018C8 58C8 C9              10      RET
                                
       58C9                     INIT_FILE:
0018C9 58C9 EB               4      EX  DE,HL
0018CA 58CA 11F8F2          10      LD  DE,FDRV
0018CD 58CD 010C00          10      LD  BC,1+8+3
       58D0                     INIT_FILE1:
0018D0 58D0 EDB0                    LDIR
0018D2 58D2 CD7F54          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
0018D5 58D5 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0018D8 58D8 2AEBF2          16      LD  HL,(_CD)
0018DB 58DB 22F6F2          16      LD  (_CDX),HL           ;カレントディレクトリ
0018DE 58DE C9              10      RET
                                
       58DF                     ZERO_MEMORY_DE:
0018DF 58DF AF               4      XOR A
       58E0                     FILL_MEMORY_DE:
0018E0 58E0 12               7      LD  (DE),A
0018E1 58E1 13               6      INC DE
0018E2 58E2 10FC            13      DJNZ    FILL_MEMORY_DE
0018E4 58E4 C9              10      RET
                                
0018E5 58E5                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 DC54F2542355DC54        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 DC54DC5428557755        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 3055695591552556        DW  _SYS08,_SYS09,_SYS0A,_SYS0B
001F18 5F18 44574A5751575A57        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 B057BE57F657DC54        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 0B58DC54DC54DC54        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 245829582E583458        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 DC544C58DC545A58        DW  _ERROR,_SYS21,_ERROR,_SYS23
001F48 5F48 7358DC54DC547C58        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 DC54DC543756DC54        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 8756DC54DC54AC58        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 DC54DC54B358DC54        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 DC54DC54DC54DC54        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
[EOF:DISKROM32.ASM:UTF_8]
