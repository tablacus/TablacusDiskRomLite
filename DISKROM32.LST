                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
       0001                     USE_MORMAL32K_OR_ASCII16        EQU 1   ;ノーマル32KB/ASCII-16K ROMを作成する
                                
                                    INCLUDE "DISKROM.ASM"
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       409B                     READYR  EQU 0409BH
       42B2                     CRUNCH  EQU 042B2H
       4601                     NEWSTT  EQU 04601H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F340                     REBOOT  EQU 0F340H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F69B                     FRETOP  EQU 0F69BH
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
       F860                     FILTAB  EQU 0F860H
       F862                     NULBUF  EQU 0F862H
       F864                     PTRFIL  EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
       F866                     FILNAM  EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
       FAF6                     ACPAGE  EQU 0FAF6H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC48                     BOTTOM  EQU 0FC48H
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FDDB                     H_PINL  EQU 0FDDBH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                #else
                                            ;ASCII-8K
                                BANK0_SEL EQU   06000H  ;6000-67FF
                                BANK1_SEL EQU   06800H  ;6800-6FFF
                                BANK2_SEL EQU   07000H  ;7000-77FF
                                BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;Konami-8K
                                KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
                                KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
                                KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;Konami-SCC
                                KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
                                KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
                                KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
                                KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                #endif
                                
       F280                     ISC EQU 0F280H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
       F280                     SP32    EQU 0F280H
[EOF:DEF.ASM:UTF_8]
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"        ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM    ; Main program execution address.
000004 4004 A24E                    DW  STATEMENT   ; STATEMENT
000006 4006 B34F                    DW  DEVICE_ENTRY    ; DEVICE
000008 4008 0000                    DW  0       ; TEXT
00000A 400A 000000000000            DW  0,0,0       ; Reserved
                                
000010 4010 C33450          10      JP  DISKIO
000013 4013 C37A50          10      JP  DSKCHG
000016 4016 C3D050          10      JP  GETDPB
000019 4019 C3C351          10      JP  CHOICE
00001C 401C C3C751          10      JP  DSKFMT
00001F 401F C3C951          10      JP  DSKSTP
000022 4022 C3CA51          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3C751          10      JP  DSKFMT
000029 4029 C3C951          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C30352          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.4.0.1",0
            204449534B20524F    
            4D204C6974652076    
            302E342E302E3100    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 AF               4      XOR A
000107 4107 2100F3          10      LD  HL,0F300H
00010A 410A 0668             7      LD  B,068H
00010C 410C CD5B4B          17      CALL    FILL_MEMORY
                                
00010F 410F 3E01             7      LD  A,1
000111 4111 3221FB          13      LD  (DRVTBL),A
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000114 4114 2A74F6          16      LD  HL,(STKTOP) ;起動時の空き容量表示の為
000117 4117 01C0FE          10      LD  BC,-00140H
00011A 411A 09              11      ADD HL,BC
00011B 411B 2274F6          16      LD  (STKTOP),HL
                                #else
                                    LD  HL,STKTOP+1 ;起動時の空き容量表示の為
                                    DEC (HL)
                                #endif
                                
00011E 411E AF               4      XOR A
00011F 411F 32DDF2          13      LD  (_DVSW),A
000122 4122 3D               4      DEC A       ;0FFH
000123 4123 3299FD          13      LD  (DEVICE),A
                                
000126 4126 21E242          10      LD  HL,AT_ISC
000129 4129 1180F2          10      LD  DE,ISC
00012C 412C 017B00          10      LD  BC,ISC_E-ISC
00012F 412F EDB0                    LDIR
                                    
000131 4131 3EC3             7      LD  A,0C3H      ;JP
000133 4133 3243FF          13      LD  (H_GONE),A
000136 4136 327DF3          13      LD  (BDOS),A
000139 4139 326BF3          13      LD  (RAMUSE),A
00013C 413C 3268F3          13      LD  (ROMUSE),A
00013F 413F 2180F2          10      LD  HL,REPLACE_COMMAND
000142 4142 2244FF          16      LD  (H_GONE+1),HL
000145 4145 2131F3          10      LD  HL,H_BDOS
000148 4148 227EF3          16      LD  (BDOS+1),HL
00014B 414B 21B0F2          10      LD  HL,RAMUSE1
00014E 414E 226CF3          16      LD  (RAMUSE+1),HL
000151 4151 21ABF2          10      LD  HL,ROMUSE1
000154 4154 2269F3          16      LD  (ROMUSE+1),HL
                                
000157 4157 3E                      DB  03EH
000158 4158 F7              12      RST 30H
000159 4159 3271FE          13      LD  (H_BINS),A
00015C 415C 3276FE          13      LD  (H_BINL),A
00015F 415F 327BFE          13      LD  (H_FILE),A
000162 4162 3231F3          13      LD  (H_BDOS),A
000165 4165 32DBFD          13      LD  (H_PINL),A
000168 4168 32A7FF          13      LD  (H_PHYD),A
                                
00016B 416B CD2E42          17      CALL    GTSL1_
00016E 416E 3297F2          13      LD  (ROM_SLT),A
000171 4171 32A7F2          13      LD  (ROM_SLT_COPY),A
000174 4174 3272FE          13      LD  (H_BINS+1),A
000177 4177 3277FE          13      LD  (H_BINL+1),A
00017A 417A 327CFE          13      LD  (H_FILE+1),A
00017D 417D 3232F3          13      LD  (H_BDOS+1),A
000180 4180 32DCFD          13      LD  (H_PINL+1),A
000183 4183 32A8FF          13      LD  (H_PHYD+1),A
000186 4186 3222FB          13      LD  (DRVTBL+1),A
000189 4189 3248F3          13      LD  (MASTERS),A
                                
00018C 418C 21A145          10      LD  HL,ROM_LOAD
00018F 418F 2273FE          16      LD  (H_BINS+2),HL
000192 4192 210F47          10      LD  HL,ROM_RUN
000195 4195 2278FE          16      LD  (H_BINL+2),HL
000198 4198 211D47          10      LD  HL,ROM_FILES
00019B 419B 227DFE          16      LD  (H_FILE+2),HL
00019E 419E 216452          10      LD  HL,ROM_BDOS
0001A1 41A1 2233F3          16      LD  (H_BDOS+2),HL
0001A4 41A4 219A43          10      LD  HL,ROM_BOOT
0001A7 41A7 22DDFD          16      LD  (H_PINL+2),HL
0001AA 41AA 213450          10      LD  HL,DISKIO
0001AD 41AD 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001B0 41B0 3E                      DB  03EH
0001B1 41B1 C9              10      RET
0001B2 41B2 327FFE          13      LD  (H_FILE+4),A
0001B5 41B5 3275FE          13      LD  (H_BINS+4),A
0001B8 41B8 327AFE          13      LD  (H_BINL+4),A
0001BB 41BB 3235F3          13      LD  (H_BDOS+4),A
0001BE 41BE 32DFFD          13      LD  (H_PINL+4),A
0001C1 41C1 32ABFF          13      LD  (H_PHYD+4),A
                                
0001C4 41C4 AF               4      XOR A
                                #if exists USE_MORMAL32K_OR_ASCII16
0001C5 41C5 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001C8 41C8 3A0060          13      LD  A,(BANK1_ADR)
0001CB 41CB FE41             7      CP  'A'
                                #if exists USE_MORMAL32K_OR_ASCII16
0001CD 41CD 284E            12      JR  Z,NOT_BANK_TYPE
0001CF 41CF 3E01             7      LD  A,DISK_BANK
0001D1 41D1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D4 41D4 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D7 41D7 07               4      RLCA
0001D8 41D8 07               4      RLCA
0001D9 41D9 F5              11      PUSH    AF
0001DA 41DA 1605             7      LD  D,4+1
0001DC 41DC CD3542          17      CALL    GTSL2_
0001DF 41DF 3244F3          13      LD  (RAMAD3),A
0001E2 41E2 F1              10      POP AF
0001E3 41E3 07               4      RLCA
0001E4 41E4 07               4      RLCA
0001E5 41E5 1603             7      LD  D,2+1
0001E7 41E7 CD3542          17      CALL    GTSL2_
0001EA 41EA 2680             7      LD  H,080H
0001EC 41EC CD5242          17      CALL    CHK_RAM
0001EF 41EF 3243F3          13      LD  (RAMAD2),A
       41F2                     RAMCHK2:
0001F2 41F2 3A44F3          13      LD  A,(RAMAD3)
0001F5 41F5 2640             7      LD  H,040H
0001F7 41F7 CD5242          17      CALL    CHK_RAM
0001FA 41FA 3242F3          13      LD  (RAMAD1),A
       41FD                     RAMCHK1:
0001FD 41FD 3A44F3          13      LD  A,(RAMAD3)
000200 4200 2600             7      LD  H,00H
000202 4202 CD5242          17      CALL    CHK_RAM
000205 4205 3241F3          13      LD  (RAMAD0),A
       4208                     RAMCHK0:
000208 4208 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
00020B 420B 010F00          10      LD  BC,0000FH       ;切り上げ
00020E 420E 09              11      ADD HL,BC
00020F 420F 7D               4      LD  A,L
                                
000210 4210 0604             7      LD  B,4
       4212                     B_DRIVE1:
000212 4212 CB3C             8      SRL H
000214 4214 1F               4      RRA
000215 4215 10FB            13      DJNZ    B_DRIVE1
                                
000217 4217 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000219 4219 32DCF2          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
00021C 421C C9              10      RET
                                
       421D                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
00021D 421D 21D843          10      LD  HL,MSG_ERROR_ROM_MODE
000220 4220 CD6043          17      CALL    MSX
000223 4223 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000227 4227 DD219F00        14      LD  IX,CHGET
00022B 422B C31C00          10      JP  _CALSLT
                                
       422E                     GTSL1_:             ;自分のいるスロットを知る
00022E 422E CD3801          17      CALL    RSLREG      ;read primary slot #
000231 4231 0F               4      RRCA
000232 4232 0F               4      RRCA
000233 4233 1601             7      LD  D,1
       4235                     GTSL2_:
000235 4235 E603             7      AND 3       ;[A]=000000PP
000237 4237 5F               4      LD  E,A     ;[E]=000000PP
000238 4238 21C1FC          10      LD  HL,EXPTBL
00023B 423B 85               4      ADD A,L     ;桁上りは無い
00023C 423C 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
00023D 423D 7B               4      LD  A,E     ;[A]=000000PP
00023E 423E CB7E            13      BIT 7,(HL)
000240 4240 C8              11      RET Z
000241 4241 7D               4      LD  A,L     ;point to SLTTBL entry
000242 4242 C604             7      ADD A,4     ;桁上りは無い
000244 4244 6F               4      LD  L,A
000245 4245 7E               7      LD  A,(HL)      ;get currently expansion slot register
       4246                     GTSL3_:
000246 4246 15               4      DEC D
000247 4247 2803            12      JR  Z,GTSL4_:
000249 4249 0F               4      RRCA
00024A 424A 18FA            12      JR  GTSL3_:
       424C                     GTSL4_:
00024C 424C E60C             7      AND 00CH        ;[A] = 0000SS00
00024E 424E B3               4      OR  E       ;[A] = 0000SSPP
00024F 424F F680             7      OR  080H        ;[A] = 1000SSPP
000251 4251 C9              10      RET
                                
       4252                     CHK_RAM:
000252 4252 E5              11      PUSH    HL
000253 4253 CDA742          17      CALL    CHK_RAM0
000256 4256 E1              10      POP HL
000257 4257 C8              11      RET Z
000258 4258 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00025B 425B E680             7      AND 080H
00025D 425D CD7E42          17      CALL    CHK_RAM_SLT
000260 4260 C8              11      RET Z
000261 4261 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000264 4264 E680             7      AND 080H
000266 4266 C601             7      ADD A,1
000268 4268 CD7E42          17      CALL    CHK_RAM_SLT
00026B 426B C8              11      RET Z
00026C 426C 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
00026F 426F E680             7      AND 080H
000271 4271 C602             7      ADD A,2
000273 4273 CD7E42          17      CALL    CHK_RAM_SLT
000276 4276 C8              11      RET Z
000277 4277 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00027A 427A E680             7      AND 080H
00027C 427C C603             7      ADD A,3
       427E                     CHK_RAM_SLT:
00027E 427E E5              11      PUSH    HL
00027F 427F CDA742          17      CALL    CHK_RAM0        ;スロット#X or X-0
000282 4282 E1              10      POP HL
000283 4283 C8              11      RET Z
000284 4284 CB79             8      BIT 7,C
000286 4286 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
000288 4288 79               4      LD  A,C
000289 4289 C604             7      ADD A,4*1           ;スロット#X-1
00028B 428B E5              11      PUSH    HL
00028C 428C CDA742          17      CALL    CHK_RAM0
00028F 428F E1              10      POP HL
000290 4290 C8              11      RET Z
000291 4291 79               4      LD  A,C
000292 4292 C608             7      ADD A,4*2           ;スロット#X-2
000294 4294 E5              11      PUSH    HL
000295 4295 CDA742          17      CALL    CHK_RAM0
000298 4298 E1              10      POP HL
000299 4299 C8              11      RET Z
00029A 429A 79               4      LD  A,C
00029B 429B C60C             7      ADD A,4*3           ;スロット#X-3
00029D 429D E5              11      PUSH    HL
00029E 429E CDA742          17      CALL    CHK_RAM0
0002A1 42A1 E1              10      POP HL
       42A2                     CHK_RAM_E:
0002A2 42A2 AF               4      XOR A
0002A3 42A3 3C               4      INC A           ;ZF=0にする
0002A4 42A4 3E00             7      LD  A,0
0002A6 42A6 C9              10      RET
                                
       42A7                     CHK_RAM0:
0002A7 42A7 4F               4      LD  C,A
0002A8 42A8 3A97F2          13      LD  A,(ROM_SLT)
0002AB 42AB B9               4      CP  C
0002AC 42AC 28F4            12      JR  Z,CHK_RAM_E
0002AE 42AE 2E00             7      LD  L,0
       42B0                     CHK_RAM1:
0002B0 42B0 79               4      LD  A,C
0002B1 42B1 CD9243          17      CALL    RDSLTX
0002B4 42B4 C6E5             7      ADD A,0E5H
0002B6 42B6 47               4      LD  B,A
0002B7 42B7 5F               4      LD  E,A
0002B8 42B8 79               4      LD  A,C
0002B9 42B9 C5              11      PUSH    BC
0002BA 42BA CD1400          17      CALL    _WRSLT
0002BD 42BD C1              10      POP BC
0002BE 42BE 79               4      LD  A,C
0002BF 42BF CD9243          17      CALL    RDSLTX
0002C2 42C2 B8               4      CP  B
0002C3 42C3 C0              11      RET NZ
0002C4 42C4 D6E5             7      SUB 0E5H
0002C6 42C6 79               4      LD  A,C
0002C7 42C7 5F               4      LD  E,A
0002C8 42C8 C5              11      PUSH    BC
0002C9 42C9 CD1400          17      CALL    _WRSLT
0002CC 42CC C1              10      POP BC
0002CD 42CD 24               4      INC H
0002CE 42CE 7D               4      LD  A,L
0002CF 42CF C604             7      ADD A,4
0002D1 42D1 6F               4      LD  L,A
0002D2 42D2 20DC            12      JR  NZ,CHK_RAM1
0002D4 42D4 79               4      LD  A,C     ;ZF=1のハズ
0002D5 42D5 C9              10      RET
                                
       42D6                     CALSLT_R:
0002D6 42D6 C5              11      PUSH    BC
0002D7 42D7 E5              11      PUSH    HL
0002D8 42D8 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DC 42DC CD1C00          17      CALL    _CALSLT
0002DF 42DF E1              10      POP HL
0002E0 42E0 C1              10      POP BC
0002E1 42E1 C9              10      RET
                                
       42E2                     AT_ISC:
0002E2 F280                         ORG ISC,AT_ISC-RUN
       F280                     REPLACE_COMMAND:
0002E2 F280 FEB7             7      CP  0B7H            ;FILES
0002E4 F282 CC7BFE          17      CALL    Z,H_FILE
0002E7 F285 FEB5             7      CP  0B5H            ;LOAD
0002E9 F287 CA71FE          10      JP  Z,H_BINS
0002EC F28A FE8A             7      CP  08AH            ;RUN
0002EE F28C CA76FE          10      JP  Z,H_BINL
0002F1 F28F FED6             7      CP  0D6H            ;COPY
0002F3 F291 2813            12      JR  Z,FIX_COPY
0002F5 F293 FECF             7      CP  0CFH            ;BLOAD
0002F7 F295 C0              11      RET NZ
       F296                     FIX_BLOAD:
0002F8 F296 F7              12      RST 30H
       F297                     ROM_SLT:
0002F9 F297 00                      DB  0
0002FA F298 4146                    DW  ROM_BLOAD
0002FC F29A F5              11      PUSH    AF
0002FD F29B E5              11      PUSH    HL
0002FE F29C CDA5F2          17      CALL    BLOAD_RET
       F29D                     SWC_BLOAD   EQU $-2
000301 F29F E1              10      POP HL
000302 F2A0 F1              10      POP AF
000303 F2A1 FECF             7      CP  0CFH            ;BLOAD
       F2A3                     SWC_BLOAD_M:
000305 F2A3 28DB            12      JR  Z,REPLACE_COMMAND
       F2A5                     BLOAD_RET:
000307 F2A5 C9              10      RET
       F2A6                     FIX_COPY:
000308 F2A6 F7              12      RST 30H
       F2A7                     ROM_SLT_COPY:
000309 F2A7 00                      DB  0
00030A F2A8 A847                    DW  ROM_COPY
00030C F2AA C9              10      RET
       F2AB                     ROMUSE1:
00030D F2AB 3A97F2          13      LD  A,(ROM_SLT)
000310 F2AE 1803            12      JR  ROMUSE2
       F2B0                     RAMUSE1:
000312 F2B0 3A42F3          13      LD  A,(RAMAD1)
       F2B3                     ROMUSE2:
000315 F2B3 C32400          10      JP  _ENASLT
                                
       F2B6                     _RESULT:
000318 F2B6 00                      DB  0
       F2B7                     _BANK:
000319 F2B7 00                      DB  0
       F2B8                     _BANK1:
00031A F2B8 00                      DB  0
       F2B9                     CLSZ:               ;クラスタサイズ
00031B F2B9 0004                    DW  1024
       F2BA                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F2BB                     SECSZ:              ;セクタサイズ
00031D F2BB 0002                    DW  512
       F2BC                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F2BD                     RR_LOW:
00031F F2BD 0000                    DW  0
       F2BE                     RR_MID  EQU $-1
       F2BF                     RR_HIGH:
000321 F2BF 0000                    DW  0
       F2C1                     _CLPS:
000323 F2C1 0000                    DW  0
       F2C3                     _LEFT:
000325 F2C3 0000                    DW  0
       F2C5                     _DTPS:
000327 F2C5 0000                    DW  0
       F2C7                     _DTA:
000329 F2C7 0000                    DW  0
       F2C9                     FLG_LDIR:
00032B F2C9 00                      DB  0
       F2CA                     _FCB:
00032C F2CA 0000                    DW  0
       F2CC                     _BUF:
       F2CC                     _BUF_LO:        ;LOGICAL OPERATION
00032E F2CC 00                      DB  0
       F2CD                     _BUF_ST:
00032F F2CD 0000                    DW  0
       F2CF                     _BUF_EN:
000331 F2CF 0000                    DW  0
       F2D1                     _BUF_EX:
       F2D1                     _BUF_W:
000333 F2D1 0000                    DW  0
       F2D3                     _BUF_H:
000335 F2D3 0000                    DW  0
       F2D5                     _BUF_X:
000337 F2D5 0000                    DW  0
       F2D7                     _BUF_Y:
000339 F2D7 00                      DB  0
       F2D8                     _BUF_P:
00033A F2D8 00                      DB  0
       F2D9                     _BUF_O:
00033B F2D9 00                      DB  0
       F2DA                     DTAX:
00033C F2DA 0000                    DW  0
       F2DC                     B_DRIVE:
00033E F2DC 00                      DB  0
       F2DD                     _DVSW:          ;カレントドライブ
00033F F2DD 00                      DB  0
       F2DE                     _CD:            ;カレントディレクトリ
000340 F2DE 0000                    DW  0
       F2E0                     DIRENT1:
000342 F2E0 0000                    DW  0
       F2E2                     _DIR_BANK:
000344 F2E2 00                      DB  0
       F2E3                     LEFTX:
000345 F2E3 0000                    DW  0
       F2E5                     PARAM0:
000347 F2E5 0000                    DW  0
       F2E7                     PARAM1:
000349 F2E7 0000                    DW  0
       F2E9                     _CDX:
00034B F2E9 0000                    DW  0
       F2EB                     FDRV:
00034D F2EB 00                      DB  0
       F2EC                     FNAME:
00034E F2EC                         DS  8+3
       F2F7                     _HL:
000359 F2F7 0000                    DW  0
       F2F9                     _SP:
00035B F2F9 0000                    DW  0
       F2FA                     _SP_H   EQU $-1
       F2FB                     ISC_E:
00035D 435D                         ORG $$+RUN          ;$DEPHASE
                                
       435D                     MSX1:
00035D 435D CD7D52          17      CALL    MSGA1
       4360                     MSX:
000360 4360 7E               7      LD  A,(HL)
000361 4361 23               6      INC HL
000362 4362 B7               4      OR  A
000363 4363 20F8            12      JR  NZ,MSX1
000365 4365 C9              10      RET
                                
       4366                     PRTHX:
000366 4366 F5              11      PUSH    AF
000367 4367 07               4      RLCA
000368 4368 07               4      RLCA
000369 4369 07               4      RLCA
00036A 436A 07               4      RLCA
00036B 436B CD6F43          17      CALL    PRTA2
00036E 436E F1              10      POP AF
       436F                     PRTA2:
00036F 436F CD7543          17      CALL    ASC
000372 4372 C37952          10      JP  MSG_A
                                    
       4375                     ASC:
000375 4375 E60F             7      AND $0F
000377 4377 F630             7      OR  $30
000379 4379 FE3A             7      CP  $3A
00037B 437B D8              11      RET C
00037C 437C C607             7      ADD A,7
00037E 437E C9              10      RET
                                
       437F                     MSN:
                                #if exists USE_MORMAL32K_OR_ASCII16
00037F 437F CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000382 4382 23               6      INC HL
000383 4383 CD7952          17      CALL    MSG_A
000386 4386 10F7            13      DJNZ    MSN
000388 4388 C9              10      RET
                                
       4389                     RDSLT_ROM3:
000389 4389 7E               7      LD  A,(HL)
00038A 438A C9              10      RET
       438B                     RDSLT_ROM:
00038B 438B CB7C             8      BIT 7,H
00038D 438D 28FA            12      JR  Z,RDSLT_ROM3
       438F                     RDSLT_ROM2:
00038F 438F 3A97F2          13      LD  A,(ROM_SLT)
       4392                     RDSLTX:
000392 4392 C5              11      PUSH    BC
000393 4393 D5              11      PUSH    DE
000394 4394 CD0C00          17      CALL    _RDSLT
000397 4397 D1              10      POP DE
000398 4398 C1              10      POP BC
000399 4399 C9              10      RET
                                
       439A                     ROM_BOOT:
00039A 439A 3E                      DB  03EH
00039B 439B C9              10      RET
00039C 439C 32DBFD          13      LD  (H_PINL),A
00039F 439F 3ACAFF          13      LD  A,(EXTBIO)
0003A2 43A2 FEF7             7      CP  0F7H        ;RST 30H
0003A4 43A4 2805            12      JR  Z,EXTBIO_OK
0003A6 43A6 3E                      DB  03EH
0003A7 43A7 C9              10      RET
0003A8 43A8 32CAFF          13      LD  (EXTBIO),A
       43AB                     EXTBIO_OK:
0003AB 43AB 21F543          10      LD  HL,DELOK
0003AE 43AE CD6043          17      CALL    MSX
                                
0003B1 43B1 AF               4      XOR A
0003B2 43B2 3240F3          13      LD  (REBOOT),A
0003B5 43B5 2A48FC          16      LD  HL,(BOTTOM)
0003B8 43B8 110040          10      LD  DE,16384
0003BB 43BB 19              11      ADD HL,DE
0003BC 43BC 3817            12      JR  C,BOOT1     ;RAM16KB以下の場合はブートセクタを実行しない
                                
                                ;   LD  E,A     ;すでにE=0
0003BE 43BE 57               4      LD  D,A
0003BF 43BF 0601             7      LD  B,1
0003C1 43C1 2100C0          10      LD  HL,0C000H
0003C4 43C4 CD3450          17      CALL    DISKIO
                                
0003C7 43C7 116BF3          10      LD  DE,RAMUSE
0003CA 43CA AF               4      XOR A
0003CB 43CB CD1EC0          17      CALL    0C01EH
0003CE 43CE 116BF3          10      LD  DE,RAMUSE
0003D1 43D1 37               4      SCF
0003D2 43D2 CD1EC0          17      CALL    0C01EH
       43D5                     BOOT1:
0003D5 43D5 C3CA51          10      JP  BASENT
                                
       43D8                     MSG_ERROR_ROM_MODE:
                                #if exists USE_MORMAL32K_OR_ASCII16
0003D8 43D8 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
       43F4                     NULL:
0003F4 43F4 00                      DB  0
       43F5                     DELOK:
0003F5 43F5 1E1B4B00                DB  01EH,01BH,'K',0
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       43F9                     ROM_LDIR:
0003F9 43F9 3AC9F2          13      LD  A,(FLG_LDIR)
0003FC 43FC B7               4      OR  A
0003FD 43FD 206A            12      JR  NZ,ROM_LDIRVM
0003FF 43FF CB7A             8      BIT 7,D
000401 4401 CA9944          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_MORMAL32K_OR_ASCII16
       4404                     LDIRA:
000404 4404 F3               4      DI
000405 4405 ED73F9F2        20      LD  (_SP),SP
000409 4409 3AFAF2          13      LD  A,(_SP_H)
00040C 440C FEC0             7      CP  0C0H
00040E 440E 3003            12      JR  NC,SPJ1
000410 4410 3180F2          10      LD  SP,SP32
       4413                     SPJ1:
       4413                     LDIR1:
000413 4413 78               4      LD  A,B
000414 4414 B1               4      OR  C
000415 4415 284D            12      JR  Z,LDIRE
                                
000417 4417 C5              11      PUSH    BC
000418 4418 D5              11      PUSH    DE
000419 4419 E5              11      PUSH    HL
00041A 441A 3A97F2          13      LD  A,(ROM_SLT)
00041D 441D 2680             7      LD  H,080H
00041F 441F CD2400          17      CALL    _ENASLT
000422 4422 E1              10      POP HL
000423 4423 D1              10      POP DE
000424 4424 C1              10      POP BC
       4425                     LDIR2:
000425 4425 7A               4      LD  A,D
000426 4426 FEC0             7      CP  0C0H
000428 4428 302C            12      JR  NC,LDIR4
                                
00042A 442A C5              11      PUSH    BC
00042B 442B D5              11      PUSH    DE
00042C 442C 115EF5          10      LD  DE,BUF
                                
00042F 442F 78               4      LD  A,B
000430 4430 B7               4      OR  A
000431 4431 2803            12      JR  Z,LDIR3
000433 4433 010001          10      LD  BC,00100H
       4436                     LDIR3:
000436 4436 C5              11      PUSH    BC
000437 4437 EDB0                    LDIR
000439 4439 22F7F2          16      LD  (_HL),HL
                                
00043C 443C 3A43F3          13      LD  A,(RAMAD2)
00043F 443F 2680             7      LD  H,080H
000441 4441 CD2400          17      CALL    _ENASLT
                                
000444 4444 C1              10      POP BC
000445 4445 D1              10      POP DE
000446 4446 215EF5          10      LD  HL,BUF
000449 4449 EDB0                    LDIR
                                
00044B 444B 2AF7F2          16      LD  HL,(_HL)
00044E 444E C1              10      POP BC
00044F 444F 78               4      LD  A,B
000450 4450 B7               4      OR  A
000451 4451 2811            12      JR  Z,LDIRE
000453 4453 05               4      DEC B
000454 4454 18BD            12      JR  LDIR1
       4456                     LDIR4:
                                #endif
000456 4456 EDB0                    LDIR
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
       4458                     LDIRE2:
000458 4458 D5              11      PUSH    DE
000459 4459 E5              11      PUSH    HL
00045A 445A 3A43F3          13      LD  A,(RAMAD2)
00045D 445D 2680             7      LD  H,080H
00045F 445F CD2400          17      CALL    _ENASLT
000462 4462 E1              10      POP HL
000463 4463 D1              10      POP DE
       4464                     LDIRE:
000464 4464 ED7BF9F2        20      LD  SP,(_SP)
                                #endif
000468 4468 C9              10      RET
                                
       4469                     ROM_LDIRVM:
                                #if exists USE_MORMAL32K_OR_ASCII16
000469 4469 F3               4      DI
00046A 446A ED73F9F2        20      LD  (_SP),SP
00046E 446E 3AFAF2          13      LD  A,(_SP_H)
000471 4471 FEC0             7      CP  0C0H
000473 4473 3003            12      JR  NC,SPJ2
000475 4475 3180F2          10      LD  SP,SP32
       4478                     SPJ2:
000478 4478 C5              11      PUSH    BC
000479 4479 D5              11      PUSH    DE
00047A 447A E5              11      PUSH    HL
00047B 447B 3A97F2          13      LD  A,(ROM_SLT)
00047E 447E 2680             7      LD  H,080H
000480 4480 CD2400          17      CALL    _ENASLT
000483 4483 E1              10      POP HL
000484 4484 D1              10      POP DE
000485 4485 C1              10      POP BC
                                #endif
000486 4486 C5              11      PUSH    BC
000487 4487 D5              11      PUSH    DE
000488 4488 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00048C 448C DD215C00        14      LD  IX,LDIRVM
000490 4490 CD1C00          17      CALL    _CALSLT
000493 4493 E1              10      POP HL
000494 4494 C1              10      POP BC
000495 4495 09              11      ADD HL,BC
000496 4496 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
000497 4497 18BF            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       4499                     ROM_LDIRSLT:
                                #if exists USE_MORMAL32K_OR_ASCII16
000499 4499 F3               4      DI
00049A 449A ED73F9F2        20      LD  (_SP),SP
00049E 449E 3AFAF2          13      LD  A,(_SP_H)
0004A1 44A1 FEC0             7      CP  0C0H
0004A3 44A3 3003            12      JR  NC,SPJ3
0004A5 44A5 3180F2          10      LD  SP,SP32
       44A8                     SPJ3:
0004A8 44A8 C5              11      PUSH    BC
0004A9 44A9 D5              11      PUSH    DE
0004AA 44AA E5              11      PUSH    HL
0004AB 44AB 3A97F2          13      LD  A,(ROM_SLT)
0004AE 44AE 2680             7      LD  H,080H
0004B0 44B0 CD2400          17      CALL    _ENASLT
0004B3 44B3 E1              10      POP HL
0004B4 44B4 D1              10      POP DE
0004B5 44B5 C1              10      POP BC
                                #endif
       44B6                     ROM_LDIRSLT1:
0004B6 44B6 EB               4      EX  DE,HL
       44B7                     RLDIRSLT1:
0004B7 44B7 CB7C             8      BIT 7,H
0004B9 44B9 2021            12      JR  NZ,RLDIRSLT_EXIT
0004BB 44BB 1A               7      LD  A,(DE)
0004BC 44BC 13               6      INC DE
0004BD 44BD C5              11      PUSH    BC
0004BE 44BE D5              11      PUSH    DE
0004BF 44BF E5              11      PUSH    HL
0004C0 44C0 5F               4      LD  E,A
                                
0004C1 44C1 0141F3          10      LD  BC,RAMAD0
0004C4 44C4 7C               4      LD  A,H
0004C5 44C5 07               4      RLCA
0004C6 44C6 07               4      RLCA
0004C7 44C7 E603             7      AND 3
0004C9 44C9 81               4      ADD A,C
0004CA 44CA 4F               4      LD  C,A
0004CB 44CB 0A               7      LD  A,(BC)
       44CC                     RLDIRSLT2:
0004CC 44CC CD1400          17      CALL    _WRSLT
0004CF 44CF 08               4      EX  AF,AF'
0004D0 44D0 E1              10      POP HL
0004D1 44D1 D1              10      POP DE
0004D2 44D2 C1              10      POP BC
0004D3 44D3 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004D5 44D5 EAB744          10      JP  PE,RLDIRSLT1
0004D8 44D8 EB               4      EX  DE,HL
                                #if exists USE_MORMAL32K_OR_ASCII16
0004D9 44D9 C35844          10      JP  LDIRE2
       44DC                     RLDIRSLT_EXIT:
0004DC 44DC EB               4      EX  DE,HL
0004DD 44DD C31344          10      JP  LDIR1
                                #else
                                    RET
                                RLDIRSLT_EXIT:
                                    EX  DE,HL
                                    LDIR
                                    RET
                                #endif
                                
       44E0                     END_OF_LINE:
0004E0 44E0 215EF5          10      LD  HL,BUF
       44E3                     EOL1:
0004E3 44E3 7E               7      LD  A,(HL)
0004E4 44E4 C8              11      RET Z
0004E5 44E5 FE0D             7      CP  00DH
0004E7 44E7 2807            12      JR  Z,EOLE
0004E9 44E9 FE0A             7      CP  00AH
0004EB 44EB 2803            12      JR  Z,EOLE
0004ED 44ED 23               6      INC HL
0004EE 44EE 18F3            12      JR  EOL1
       44F0                     EOLE:
0004F0 44F0 3600            10      LD  (HL),0
0004F2 44F2 23               6      INC HL
0004F3 44F3 7E               7      LD  A,(HL)
0004F4 44F4 FE0A             7      CP  00AH
0004F6 44F6 C0              11      RET NZ
0004F7 44F7 23               6      INC HL
0004F8 44F8 C9              10      RET
                                
       44F9                     ROM_LOAD_ASCII:
0004F9 44F9 210000          10      LD  HL,0
0004FC 44FC 22CDF2          16      LD  (_BUF_ST),HL    ;読み出し位置
0004FF 44FF 2A76F6          16      LD  HL,(TXTTAB)
000502 4502 22CFF2          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000505 4505 215EF5          10      LD  HL,BUF
000508 4508 22C7F2          16      LD  (_DTA),HL
       450B                     RLOAD_A1:
00050B 450B 2ACDF2          16      LD  HL,(_BUF_ST)
00050E 450E 22BDF2          16      LD  (RR_LOW),HL
000511 4511 210201          10      LD  HL,258
000514 4514 CDC849          17      CALL    ROM_READ
000517 4517 7C               4      LD  A,H
000518 4518 B5               4      OR  L
000519 4519 2879            12      JR  Z,RLOAD_AEND
00051B 451B 015EF5          10      LD  BC,BUF
00051E 451E 09              11      ADD HL,BC
00051F 451F 3600            10      LD  (HL),0
000521 4521 CDE044          17      CALL    END_OF_LINE
000524 4524 015EF5          10      LD  BC,BUF
000527 4527 A7               4      AND A
000528 4528 ED42            15      SBC HL,BC
00052A 452A 2810            12      JR  Z,RLOAD_A2
00052C 452C 4D               4      LD  C,L
00052D 452D 44               4      LD  B,H
00052E 452E ED5BCDF2        20      LD  DE,(_BUF_ST)
000532 4532 19              11      ADD HL,DE
000533 4533 22CDF2          16      LD  (_BUF_ST),HL
000536 4536 3A5EF5          13      LD  A,(BUF)
000539 4539 B7               4      OR  A
00053A 453A 28CF            12      JR  Z,RLOAD_A1
       453C                     RLOAD_A2:
00053C 453C 115EF5          10      LD  DE,BUF
00053F 453F CD924B          17      CALL    SPCUTEX
000542 4542 1A               7      LD  A,(DE)
000543 4543 B7               4      OR  A
000544 4544 284E            12      JR  Z,RLOAD_AEND
000546 4546 CDA44B          17      CALL    GETNUM
000549 4549 7C               4      LD  A,H
00054A 454A B5               4      OR  L
00054B 454B CA2846          10      JP  Z,ERROR_DIRECT_IN_FILE
00054E 454E DD2ACFF2        20      LD  IX,(_BUF_EN)
000552 4552 DD7502          19      LD  (IX+2),L
000555 4555 DD7403          19      LD  (IX+3),H
                                
000558 4558 CD8B4B          17      CALL    SPCUT
00055B 455B EB               4      EX  DE,HL
00055C 455C DDE5            15      PUSH    IX
00055E 455E DD21B242        14      LD  IX,CRUNCH
000562 4562 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000566 4566 CD1C00          17      CALL    _CALSLT
000569 4569 DDE1            14      POP IX
00056B 456B EB               4      EX  DE,HL
00056C 456C 111FF4          10      LD  DE,KBUF
00056F 456F 37               4      SCF
000570 4570 ED52            15      SBC HL,DE
000572 4572 CA2846          10      JP  Z,ERROR_DIRECT_IN_FILE
000575 4575 DA2846          10      JP  C,ERROR_DIRECT_IN_FILE
000578 4578 4D               4      LD  C,L
000579 4579 44               4      LD  B,H
00057A 457A 2ACFF2          16      LD  HL,(_BUF_EN)
00057D 457D 110400          10      LD  DE,4
000580 4580 19              11      ADD HL,DE
000581 4581 111FF4          10      LD  DE,KBUF
                                
000584 4584 EB               4      EX  DE,HL
000585 4585 EDB0                    LDIR
000587 4587 EB               4      EX  DE,HL
                                
000588 4588 DD7500          19      LD  (IX+0),L
00058B 458B DD7401          19      LD  (IX+1),H
00058E 458E 22CFF2          16      LD  (_BUF_EN),HL
000591 4591 C30B45          10      JP  RLOAD_A1
                                
       4594                     RLOAD_AEND:
000594 4594 2ACFF2          16      LD  HL,(_BUF_EN)
000597 4597 AF               4      XOR A
000598 4598 77               7      LD  (HL),A
000599 4599 23               6      INC HL
00059A 459A 77               7      LD  (HL),A
00059B 459B 23               6      INC HL
00059C 459C 22CFF2          16      LD  (_BUF_EN),HL
00059F 459F 1847            12      JR  RLOAD_END1
                                
       45A1                     ROM_LOAD:
0005A1 45A1 CD7647          17      CALL    INIT_PARAM
0005A4 45A4 7E               7      LD  A,(HL)
0005A5 45A5 FE2C             7      CP  ','
0005A7 45A7 2003            12      JR  NZ,ROM_LOAD0
0005A9 45A9 23               6      INC HL
0005AA 45AA 7E               7      LD  A,(HL)
0005AB 45AB 2B               6      DEC HL
       45AC                     ROM_LOAD0:
0005AC 45AC 32BEFC          13      LD  (RUNBNF),A
0005AF 45AF CD694A          17      CALL    FILE_B
0005B2 45B2 3AECF2          13      LD  A,(FNAME)
0005B5 45B5 FE20             7      CP  020H
0005B7 45B7 CA644A          10      JP  Z,ROM_ORG
                                
0005BA 45BA CDFB4B          17      CALL    ROM_OPEN
0005BD 45BD DA3446          10      JP  C,ERROR_FILE_NOT_FOUND
       45C0                     ROM_LOAD1:
0005C0 45C0 21CCF2          10      LD  HL,_BUF
0005C3 45C3 22C7F2          16      LD  (_DTA),HL
0005C6 45C6 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0005C9 45C9 CDC849          17      CALL    ROM_READ
0005CC 45CC 3ACCF2          13      LD  A,(_BUF)
0005CF 45CF 3C               4      INC A
0005D0 45D0 C2F944          10      JP  NZ,ROM_LOAD_ASCII
0005D3 45D3 2A76F6          16      LD  HL,(TXTTAB)
0005D6 45D6 22C7F2          16      LD  (_DTA),HL
0005D9 45D9 EB               4      EX  DE,HL
0005DA 45DA 2100FF          10      LD  HL,-256
0005DD 45DD 39              11      ADD HL,SP
0005DE 45DE ED52            15      SBC HL,DE
0005E0 45E0 CDC849          17      CALL    ROM_READ
0005E3 45E3 ED5BC7F2        20      LD  DE,(_DTA)
0005E7 45E7 19              11      ADD HL,DE
       45E8                     RLOAD_END1:
0005E8 45E8 22C2F6          16      LD  (VARTAB),HL
0005EB 45EB 22C4F6          16      LD  (ARYTAB),HL
0005EE 45EE 22C6F6          16      LD  (STREND),HL
                                
0005F1 45F1 3ABEFC          13      LD  A,(RUNBNF)
0005F4 45F4 CDE54B          17      CALL    CAP
0005F7 45F7 FE52             7      CP  'R'
0005F9 45F9 280E            12      JR  Z,RLOAD_END2
0005FB 45FB AF               4      XOR A
0005FC 45FC 21CFF2          10      LD  HL,_BUF+3
0005FF 45FF 77               7      LD  (HL),A      ;3
000600 4600 2B               6      DEC HL
000601 4601 77               7      LD  (HL),A      ;2
000602 4602 2B               6      DEC HL
000603 4603 77               7      LD  (HL),A      ;1
000604 4604 2B               6      DEC HL
000605 4605 3E8F             7      LD  A,08FH      ;REM
000607 4607 77               7      LD  (HL),A      ;0
000608 4608 C9              10      RET
       4609                     RLOAD_END2:
000609 4609 D5              11      PUSH    DE
00060A 460A 2A76F6          16      LD  HL,(TXTTAB)
00060D 460D 23               6      INC HL
00060E 460E 23               6      INC HL
00060F 460F 5E               7      LD  E,(HL)
000610 4610 23               6      INC HL
000611 4611 56               7      LD  D,(HL)
000612 4612 AF               4      XOR A
000613 4613 21D2F2          10      LD  HL,_BUF+6
000616 4616 77               7      LD  (HL),A      ;6
000617 4617 2B               6      DEC HL
000618 4618 77               7      LD  (HL),A      ;5
000619 4619 2B               6      DEC HL
00061A 461A 77               7      LD  (HL),A      ;4
00061B 461B 2B               6      DEC HL
00061C 461C 72               7      LD  (HL),D      ;3 行番号H
00061D 461D 2B               6      DEC HL
00061E 461E 73               7      LD  (HL),E      ;2 行番号L
00061F 461F 2B               6      DEC HL
000620 4620 360E            10      LD  (HL),00EH   ;1 2桁INT
000622 4622 2B               6      DEC HL
000623 4623 3E89             7      LD  A,089H      ;GOTO
000625 4625 77               7      LD  (HL),A      ;0
000626 4626 D1              10      POP DE
000627 4627 C9              10      RET
                                
       4628                     ERROR_DIRECT_IN_FILE:
000628 4628 1E39             7      LD  E,57            ;Direct statement in file
00062A 462A 01                      DB  1           ;LD BC,
       462B                     ERROR_DEVICE_IO_ERROR:
00062B 462B 1E13             7      LD  E,19            ;Device I/O error
00062D 462D 01                      DB  1           ;LD BC,
       462E                     ERROR_INTERNAL_ERROR:
00062E 462E 1E33             7      LD  E,51            ;Internal error
000630 4630 01                      DB  1           ;LD BC,
       4631                     ERROR_FILE_NOT_OPEN:
000631 4631 1E3B             7      LD  E,59            ;File not OPEN
000633 4633 01                      DB  1           ;LD BC,
       4634                     ERROR_FILE_NOT_FOUND:
000634 4634 1E35             7      LD  E,53            ;File not found
       4636                     ERROR:
000636 4636 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00063A 463A DD216F40        14      LD  IX,ERRHAND
00063E 463E C31C00          10      JP  _CALSLT
                                
       4641                     ROM_BLOAD:
000641 4641 CD7647          17      CALL    INIT_PARAM
000644 4644 CD694A          17      CALL    FILE_B
000647 4647 CDFB4B          17      CALL    ROM_OPEN
00064A 464A 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00064C 464C 21CCF2          10      LD  HL,_BUF
00064F 464F 22C7F2          16      LD  (_DTA),HL
000652 4652 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000655 4655 CDC849          17      CALL    ROM_READ
000658 4658 3ACCF2          13      LD  A,(_BUF)
00065B 465B FEFE             7      CP  0FEH
00065D 465D 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00065F 465F 21A5F2          10      LD  HL,BLOAD_RET
000662 4662 229DF2          16      LD  (SWC_BLOAD),HL
                                
000665 4665 2AE7F2          16      LD  HL,(PARAM1)
000668 4668 7E               7      LD  A,(HL)
000669 4669 FE2C             7      CP  ','
00066B 466B 2048            12      JR  NZ,RBREAD_MEM
00066D 466D 23               6      INC HL
00066E 466E 7E               7      LD  A,(HL)
00066F 466F CDE54B          17      CALL    CAP
000672 4672 32BEFC          13      LD  (RUNBNF),A
       4675                     RBOS1:
000675 4675 7E               7      LD  A,(HL)
000676 4676 23               6      INC HL
000677 4677 B7               4      OR  A
000678 4678 282F            12      JR  Z,RBREAD_OSE
00067A 467A FE3A             7      CP  ':'
00067C 467C 282B            12      JR  Z,RBREAD_OSE
00067E 467E FE2C             7      CP  ','     ;次のパラメータを探す
000680 4680 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000682 4682 22E7F2          16      LD  (PARAM1),HL
000685 4685 7E               7      LD  A,(HL)
000686 4686 B7               4      OR  A
000687 4687 2820            12      JR  Z,RBREAD_OSE
000689 4689 DD21644C        14      LD  IX,FRMEVL
00068D 468D FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000691 4691 CD1C00          17      CALL    _CALSLT
000694 4694 22E7F2          16      LD  (PARAM1),HL
000697 4697 3A63F6          13      LD  A,(VALTYP)
00069A 469A FE02             7      CP  2
00069C 469C 200B            12      JR  NZ,RBREAD_OSE
00069E 469E 2ACDF2          16      LD  HL,(_BUF_ST)
0006A1 46A1 ED5BF8F7        20      LD  DE,(DACDAT)
0006A5 46A5 19              11      ADD HL,DE
0006A6 46A6 22CDF2          16      LD  (_BUF_ST),HL
       46A9                     RBREAD_OSE:
0006A9 46A9 3ABEFC          13      LD  A,(RUNBNF)
0006AC 46AC FE53             7      CP  'S'
0006AE 46AE 2005            12      JR  NZ,RBREAD_MEM
0006B0 46B0 3E01             7      LD  A,1
0006B2 46B2 32C9F2          13      LD  (FLG_LDIR),A
       46B5                     RBREAD_MEM:
0006B5 46B5 2ACDF2          16      LD  HL,(_BUF_ST)
0006B8 46B8 22BFFC          16      LD  (SAVENT),HL
0006BB 46BB 22C7F2          16      LD  (_DTA),HL
0006BE 46BE 21FFFF          10      LD  HL,0FFFFH
0006C1 46C1 CDC849          17      CALL    ROM_READ
0006C4 46C4 AF               4      XOR A
0006C5 46C5 32C9F2          13      LD  (FLG_LDIR),A
0006C8 46C8 3ABEFC          13      LD  A,(RUNBNF)
0006CB 46CB FE52             7      CP  'R'
0006CD 46CD 2006            12      JR  NZ,RBREAD1
0006CF 46CF 2AD1F2          16      LD  HL,(_BUF_EX)
0006D2 46D2 229DF2          16      LD  (SWC_BLOAD),HL
       46D5                     RBREAD1:
       46D5                     ROM_NEXT:
0006D5 46D5 2AE7F2          16      LD  HL,(PARAM1)
0006D8 46D8 7E               7      LD  A,(HL)
0006D9 46D9 2B               6      DEC HL
0006DA 46DA B7               4      OR  A
0006DB 46DB 2805            12      JR  Z,RN1
0006DD 46DD FE3A             7      CP  ':'
0006DF 46DF 2801            12      JR  Z,RN1
0006E1 46E1 23               6      INC HL
       46E2                     RN1:
0006E2 46E2 5D               4      LD  E,L
0006E3 46E3 54               4      LD  D,H
                                
0006E4 46E4 CDBB4B          17      CALL    SEARCH_END
0006E7 46E7 B7               4      OR  A
0006E8 46E8 2821            12      JR  Z,REM
       46EA                     RN3:                    ;マルチステートメントの処理
0006EA 46EA 7E               7      LD  A,(HL)
                                
0006EB 46EB FEB5             7      CP  0B5H            ;LOAD
0006ED 46ED CAA145          10      JP  Z,ROM_LOAD
0006F0 46F0 FE8A             7      CP  08AH            ;RUN
0006F2 46F2 281B            12      JR  Z,ROM_RUN
0006F4 46F4 FEB7             7      CP  0B7H            ;FILES
0006F6 46F6 2825            12      JR  Z,ROM_FILES
0006F8 46F8 FED6             7      CP  0D6H            ;COPY
0006FA 46FA CAA847          10      JP  Z,ROM_COPY
0006FD 46FD FE20             7      CP  020H
0006FF 46FF 2807            12      JR  Z,RN_SP
                                
000701 4701 3E28             7      LD  A,028H          ;JR Z,
000703 4703 32A3F2          13      LD  (SWC_BLOAD_M),A
000706 4706 7E               7      LD  A,(HL)
000707 4707 C9              10      RET
       4708                     RN_SP:
000708 4708 23               6      INC HL
000709 4709 18DF            12      JR  RN3
                                
       470B                     REM:
00070B 470B EB               4      EX  DE,HL
00070C 470C 3E8F             7      LD  A,08FH          ;REM
00070E 470E C9              10      RET
                                
       470F                     ROM_RUN:
00070F 470F 23               6      INC HL
000710 4710 7E               7      LD  A,(HL)
000711 4711 2B               6      DEC HL
000712 4712 B7               4      OR  A
000713 4713 C4A145          17      CALL    NZ,ROM_LOAD
000716 4716 FE8F             7      CP  08FH            ;REM
000718 4718 3E8A             7      LD  A,08AH          ;RUN
00071A 471A C0              11      RET NZ
00071B 471B 77               7      LD  (HL),A
00071C 471C C9              10      RET
                                
       471D                     ROM_FILES:
00071D 471D CD7647          17      CALL    INIT_PARAM
000720 4720 CD694A          17      CALL    FILE_B
000723 4723 CD0752          17      CALL    GET_DISK_BANK_FDRV
000726 4726 3ABCF2          13      LD  A,(SECSZ_H)
000729 4729 CDC550          17      CALL    IS_BPB1
00072C 472C DA2B46          10      JP  C,ERROR_DEVICE_IO_ERROR
00072F 472F 3AECF2          13      LD  A,(FNAME)
000732 4732 FE21             7      CP  021H
000734 4734 3005            12      JR  NC,RFILES0
000736 4736 060B             7      LD  B,11
000738 4738 CD4F4B          17      CALL    FILE10
       473B                     RFILES0:
00073B 473B CD574E          17      CALL    GET_DIR_DAT
       473E                     RFILES1:
00073E 473E CD174C          17      CALL    FILESE
000741 4741 302E            12      JR  NC,RFILES_NOT_MATCH
       4743                     RFILES_DISP:
000743 4743 E5              11      PUSH    HL
000744 4744 0608             7      LD  B,8
000746 4746 CD7F43          17      CALL    MSN
000749 4749 3E2E             7      LD  A,'.'
00074B 474B CD7952          17      CALL    MSG_A
00074E 474E 0603             7      LD  B,3
000750 4750 CD7F43          17      CALL    MSN
000753 4753 3ADDF3          13      LD  A,(CSRX)
000756 4756 47               4      LD  B,A
000757 4757 3AB0F3          13      LD  A,(LINLEN)
00075A 475A 90               4      SUB B
00075B 475B FE0C             7      CP  12
00075D 475D 3009            12      JR  NC,RFILES2
00075F 475F 3E0D             7      LD  A,00DH      ;改行
000761 4761 CD7952          17      CALL    MSG_A
000764 4764 3E0A             7      LD  A,00AH
000766 4766 1802            12      JR  RFILES3
       4768                     RFILES2:
000768 4768 3E20             7      LD  A,020H
       476A                     RFILES3:
00076A 476A CD7952          17      CALL    MSG_A
00076D 476D E1              10      POP HL
00076E 476E CD354C          17      CALL    FNEXT
       4771                     RFILES_NOT_MATCH:
000771 4771 20CB            12      JR  NZ,RFILES1
000773 4773 C3D546          10      JP  ROM_NEXT
                                
       4776                     INIT_PARAM:
000776 4776 22E5F2          16      LD  (PARAM0),HL
000779 4779 22E7F2          16      LD  (PARAM1),HL
00077C 477C EB               4      EX  DE,HL
00077D 477D 32BEFC          13      LD  (RUNBNF),A
000780 4780 3263F6          13      LD  (VALTYP),A
000783 4783 E5              11      PUSH    HL
000784 4784 2ADEF2          16      LD  HL,(_CD)
000787 4787 22E9F2          16      LD  (_CDX),HL
00078A 478A E1              10      POP HL
00078B 478B 13               6      INC DE
00078C 478C CD8B4B          17      CALL    SPCUT
00078F 478F 1A               7      LD  A,(DE)
000790 4790 B7               4      OR  A
000791 4791 C8              11      RET Z
000792 4792 FE3A             7      CP  ':'
000794 4794 C8              11      RET Z
000795 4795 FE28             7      CP  '('
000797 4797 C8              11      RET Z
000798 4798 EB               4      EX  DE,HL
000799 4799 DD21644C        14      LD  IX,FRMEVL
00079D 479D FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007A1 47A1 CD1C00          17      CALL    _CALSLT
0007A4 47A4 22E7F2          16      LD  (PARAM1),HL
0007A7 47A7 C9              10      RET
                                
       47A8                     ROM_COPY:
0007A8 47A8 CD7647          17      CALL    INIT_PARAM
0007AB 47AB 3A63F6          13      LD  A,(VALTYP)
0007AE 47AE FE03             7      CP  3       ;string
0007B0 47B0 C2644A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
0007B3 47B3 CD694A          17      CALL    FILE_B
0007B6 47B6 CDFB4B          17      CALL    ROM_OPEN
0007B9 47B9 DA3446          10      JP  C,ERROR_FILE_NOT_FOUND
                                
0007BC 47BC 21D1F2          10      LD  HL,_BUF_W
0007BF 47BF 22C7F2          16      LD  (_DTA),HL
0007C2 47C2 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
0007C5 47C5 CDC849          17      CALL    ROM_READ
                                
0007C8 47C8 AF               4      XOR A
0007C9 47C9 32CCF2          13      LD  (_BUF_LO),A     ;PSET
0007CC 47CC 32D9F2          13      LD  (_BUF_O),A      ;向き
                                
0007CF 47CF 2AE7F2          16      LD  HL,(PARAM1)
       47D2                     RCP_PARAM1:
0007D2 47D2 7E               7      LD  A,(HL)
0007D3 47D3 23               6      INC HL
0007D4 47D4 B7               4      OR  A
0007D5 47D5 CA644A          10      JP  Z,ROM_ORG
0007D8 47D8 FE3A             7      CP  ':'
0007DA 47DA CA644A          10      JP  Z,ROM_ORG
0007DD 47DD FE2C             7      CP  ','
0007DF 47DF 2012            12      JR  NZ,RCP_PARAM1_
                                
0007E1 47E1 DD212F54        14      LD  IX,FRMQNT
0007E5 47E5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007E9 47E9 CD1C00          17      CALL    _CALSLT
0007EC 47EC 7B               4      LD  A,E
0007ED 47ED 87               4      ADD A,A
0007EE 47EE 87               4      ADD A,A
0007EF 47EF 32D9F2          13      LD  (_BUF_O),A
0007F2 47F2 7E               7      LD  A,(HL)
       47F3                     RCP_PARAM1_:
0007F3 47F3 FE28             7      CP  '('
0007F5 47F5 20DB            12      JR  NZ,RCP_PARAM1
                                
0007F7 47F7 DD212F54        14      LD  IX,FRMQNT
0007FB 47FB FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007FF 47FF CD1C00          17      CALL    _CALSLT
                                
000802 4802 ED53D5F2        20      LD  (_BUF_X),DE
                                
       4806                     RCP_PARAM2:
000806 4806 23               6      INC HL
000807 4807 7E               7      LD  A,(HL)
000808 4808 FE20             7      CP  020H
00080A 480A 28FA            12      JR  Z,RCP_PARAM2
00080C 480C FE2C             7      CP  ','
00080E 480E 28F6            12      JR  Z,RCP_PARAM2
                                
000810 4810 DD212F54        14      LD  IX,FRMQNT
000814 4814 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000818 4818 CD1C00          17      CALL    _CALSLT
                                
00081B 481B 3AF6FA          13      LD  A,(ACPAGE)
00081E 481E 57               4      LD  D,A
00081F 481F ED53D7F2        20      LD  (_BUF_Y),DE
       4823                     RCP_PARAM3:
000823 4823 23               6      INC HL
000824 4824 7E               7      LD  A,(HL)
000825 4825 FE20             7      CP  020H
000827 4827 28FA            12      JR  Z,RCP_PARAM3
000829 4829 FE29             7      CP  ')'
00082B 482B 28F6            12      JR  Z,RCP_PARAM3
00082D 482D FE2C             7      CP  ','
00082F 482F 2033            12      JR  NZ,RCP_ST
                                
000831 4831 23               6      INC HL
000832 4832 DD212F54        14      LD  IX,FRMQNT
000836 4836 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00083A 483A CD1C00          17      CALL    _CALSLT
                                
00083D 483D 7B               4      LD  A,E
00083E 483E 32D8F2          13      LD  (_BUF_P),A
                                
       4841                     RCP_PARAM4:
000841 4841 7E               7      LD  A,(HL)
000842 4842 23               6      INC HL
000843 4843 FE20             7      CP  020H
000845 4845 28FA            12      JR  Z,RCP_PARAM4
                                
000847 4847 FE2C             7      CP  ','
000849 4849 2019            12      JR  NZ,RCP_ST
                                
00084B 484B 7E               7      LD  A,(HL)
00084C 484C 0604             7      LD  B,4
00084E 484E FEC3             7      CP  0C3H        ;PRESET
000850 4850 280E            12      JR  Z,RCP_LO
000852 4852 05               4      DEC B       ;3
000853 4853 D6F8             7      SUB 0F8H        ;XOR
000855 4855 2809            12      JR  Z,RCP_LO
000857 4857 05               4      DEC B       ;2
000858 4858 3C               4      INC A       ;OR
000859 4859 2805            12      JR  Z,RCP_LO
00085B 485B 05               4      DEC B       ;1
00085C 485C 3C               4      INC A       ;AND
00085D 485D 2801            12      JR  Z,RCP_LO
00085F 485F 05               4      DEC B       ;0
                                                ;PSET
       4860                     RCP_LO:
000860 4860 78               4      LD  A,B
000861 4861 32CCF2          13      LD  (_BUF_LO),A
       4864                     RCP_ST:
000864 4864 2AC6F6          16      LD  HL,(STREND)
000867 4867 22C7F2          16      LD  (_DTA),HL
00086A 486A EB               4      EX  DE,HL
00086B 486B 2100FE          10      LD  HL,-512
00086E 486E 39              11      ADD HL,SP
00086F 486F AF               4      XOR A
000870 4870 ED52            15      SBC HL,DE
000872 4872 3008            12      JR  NC,RCP0
000874 4874 215EF5          10      LD  HL,BUF
000877 4877 22C7F2          16      LD  (_DTA),HL
00087A 487A 6F               4      LD  L,A ;0
00087B 487B 67               4      LD  H,A ;0
       487C                     RCP0:
00087C 487C 24               4      INC H
00087D 487D 22CFF2          16      LD  (_BUF_EN),HL
       4880                     RCP1:
000880 4880 F3               4      DI
000881 4881 CD5649          17      CALL    WAIT_VDP
                                
000884 4884 3A0700          13      LD  A,(WRVDP)
000887 4887 4F               4      LD  C,A
000888 4888 0C               4      INC C       ;C := PORT#1's address(WR)
000889 4889 3E24             7      LD  A,36
00088B 488B ED79            12      OUT (C),A
00088D 488D 3E91             7      LD  A,080H+17
00088F 488F ED79            12      OUT (C),A       ;R#17 := 36
                                
000891 4891 0C               4      INC C
000892 4892 0C               4      INC C       ;C := PORT#3's address(WR)
000893 4893 2AD5F2          16      LD  HL,(_BUF_X)
000896 4896 ED69            12      OUT (C),L       ;R#36 DX
000898 4898 ED61            12      OUT (C),H       ;R#37
00089A 489A 2AD7F2          16      LD  HL,(_BUF_Y)
00089D 489D ED69            12      OUT (C),L       ;R#38 DY
00089F 489F ED61            12      OUT (C),H       ;R#39
0008A1 48A1 2AD1F2          16      LD  HL,(_BUF_W)
0008A4 48A4 ED69            12      OUT (C),L       ;R#40 NX
0008A6 48A6 ED61            12      OUT (C),H       ;R#41
0008A8 48A8 2AD3F2          16      LD  HL,(_BUF_H)
0008AB 48AB ED69            12      OUT (C),L       ;R#42 NY
0008AD 48AD ED61            12      OUT (C),H       ;R#43
                                
0008AF 48AF DD2AAFFC        20      LD  IX,(SCRMOD)
0008B3 48B3 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008B6 48B6 B7               4      OR  A
0008B7 48B7 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
0008B9 48B9 DD7D             9      LD  A,IXL
0008BB 48BB FE08             7      CP  8
0008BD 48BD 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
0008BF 48BF FE06             7      CP  6
0008C1 48C1 2AD5F2          16      LD  HL,(_BUF_X)
0008C4 48C4 3AD1F2          13      LD  A,(_BUF_W)
0008C7 48C7 2005            12      JR  NZ,SCR57
0008C9 48C9 B5               4      OR  L       ;スクリーン6
0008CA 48CA E603             7      AND 3
0008CC 48CC 200D            12      JR  NZ,USE_LMMC
       48CE                     SCR57:              ;スクリーン5,7
0008CE 48CE B5               4      OR  L
0008CF 48CF E601             7      AND 1
0008D1 48D1 2008            12      JR  NZ,USE_LMMC
       48D3                     USE_HMMC:
0008D3 48D3 DD2E08          10      LD  IXL,8
       48D6                     USE_HMMC8:
0008D6 48D6 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
0008D8 48D8 32CCF2          13      LD  (_BUF_LO),A
       48DB                     USE_LMMC:
0008DB 48DB 110000          10      LD  DE,0
0008DE 48DE 06FF             7      LD  B,-1
0008E0 48E0 CD8149          17      CALL    GET_PIXEL
0008E3 48E3 ED79            12      OUT (C),A       ;R#44 first DATA
0008E5 48E5 3AD9F2          13      LD  A,(_BUF_O)
0008E8 48E8 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
0008EA 48EA 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008ED 48ED F6B0             7      OR  0B0H        ;R#46 LMMC command
0008EF 48EF ED79            12      OUT (C),A
                                
0008F1 48F1 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008F3 48F3 0D               4      DEC C
0008F4 48F4 0D               4      DEC C       ;C := PORT#1's address(WR)
0008F5 48F5 3EAC             7      LD  A,080H+44
0008F7 48F7 ED79            12      OUT (C),A
0008F9 48F9 3E91             7      LD  A,080H+17
0008FB 48FB ED79            12      OUT (C),A       ;R#17 := 44
                                
0008FD 48FD 3A0600          13      LD  A,(RDVDP)
000900 4900 3C               4      INC A
000901 4901 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
000903 4903 3E02             7      LD  A,2
000905 4905 ED79            12      OUT (C),A
000907 4907 3E8F             7      LD  A,08FH
000909 4909 ED79            12      OUT (C),A
00090B 490B 3ACCF2          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00090E 490E E640             7      AND 040H
000910 4910 201C            12      JR  NZ,LOOP_HMMC
       4912                     LOOP_COPY:
000912 4912 CD8149          17      CALL    GET_PIXEL
000915 4915 08               4      EX  AF,AF'
000916 4916 FD4C             9      LD  C,IYH
       4918                     LOOP_COPY1:
000918 4918 ED78            12      IN  A,(C)
00091A 491A 0F               4      RRCA            ;RRCAではサインフラグは変化しない
00091B 491B 300A            12      JR  NC,EXIT_COPY    ;check CE bit
00091D 491D F21849          10      JP  P,LOOP_COPY1    ;check TR bit
000920 4920 08               4      EX  AF,AF'
000921 4921 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000923 4923 ED79            12      OUT (C),A
000925 4925 18EB            12      JR  LOOP_COPY
                                
       4927                     EXIT_COPY:
000927 4927 CD5E49          17      CALL    GET_STATUS_0
00092A 492A FB               4      EI
00092B 492B C3D546          10      JP  ROM_NEXT
                                
       492E                     LOOP_HMMC:
00092E 492E F3               4      DI          ;必要
00092F 492F FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000931 4931 43               4      LD  B,E
000932 4932 7B               4      LD  A,E
000933 4933 B7               4      OR  A
000934 4934 2802            12      JR  Z,LOOP_HMMC1
000936 4936 EDB3                    OTIR
       4938                     LOOP_HMMC1:
000938 4938 14               4      INC D
       4939                     LOOP_HMMC2:
000939 4939 15               4      DEC D
00093A 493A 2805            12      JR  Z,LOOP_HMMC3
00093C 493C EDB3                    OTIR
00093E 493E C33949          10      JP  LOOP_HMMC2
       4941                     LOOP_HMMC3:
000941 4941 ED78            12      IN  A,(C)
000943 4943 0F               4      RRCA
000944 4944 30E1            12      JR  NC,EXIT_COPY    ;check CE bit
000946 4946 2ACFF2          16      LD  HL,(_BUF_EN)
000949 4949 CDC849          17      CALL    ROM_READ
00094C 494C EB               4      EX  DE,HL
00094D 494D 2AC7F2          16      LD  HL,(_DTA)
000950 4950 7A               4      LD  A,D
000951 4951 B3               4      OR  E
000952 4952 20DA            12      JR  NZ,LOOP_HMMC
000954 4954 18C2            12      JR  LOOP_COPY1
                                    
       4956                     WAIT_VDP:
000956 4956 3E02             7      LD  A,2
000958 4958 CD5F49          17      CALL    GET_STATUS
00095B 495B 0F               4      RRCA
00095C 495C 38F8            12      JR  C,WAIT_VDP
       495E                     GET_STATUS_0:
00095E 495E AF               4      XOR A
       495F                     GET_STATUS:
00095F 495F C5              11      PUSH    BC
000960 4960 ED4B0600        20      LD  BC,(RDVDP)
000964 4964 0C               4      INC C
000965 4965 ED79            12      OUT (C),A
000967 4967 3E8F             7      LD  A,08FH
000969 4969 ED79            12      OUT (C),A
00096B 496B ED78            12      IN  A,(C)
00096D 496D C1              10      POP BC
00096E 496E C9              10      RET
                                
       496F                     GET_PIXEL256:
00096F 496F 7A               4      LD  A,D
000970 4970 B3               4      OR  E
000971 4971 200A            12      JR  NZ,GET_PIXEL1
000973 4973 2ACFF2          16      LD  HL,(_BUF_EN)
000976 4976 CDC849          17      CALL    ROM_READ
000979 4979 EB               4      EX  DE,HL
00097A 497A 2AC7F2          16      LD  HL,(_DTA)
       497D                     GET_PIXEL1:
00097D 497D 7E               7      LD  A,(HL)
00097E 497E 23               6      INC HL
00097F 497F 1B               6      DEC DE
000980 4980 C9              10      RET
                                
       4981                     GET_PIXEL:
000981 4981 DD7D             9      LD  A,IXL
000983 4983 FE08             7      CP  8
000985 4985 28E8            12      JR  Z,GET_PIXEL256
000987 4987 04               4      INC B
000988 4988 FE06             7      CP  6
00098A 498A 282E            12      JR  Z,GET_PIXEL4
                                
00098C 498C CB40             8      BIT 0,B
00098E 498E 20ED            12      JR  NZ,GET_PIXEL1
                                
000990 4990 7A               4      LD  A,D
000991 4991 B3               4      OR  E
000992 4992 200A            12      JR  NZ,GET_PIXEL2
                                
000994 4994 2ACFF2          16      LD  HL,(_BUF_EN)
000997 4997 CDC849          17      CALL    ROM_READ
00099A 499A EB               4      EX  DE,HL
00099B 499B 2AC7F2          16      LD  HL,(_DTA)
                                
       499E                     GET_PIXEL2:
00099E 499E 7E               7      LD  A,(HL)
00099F 499F 0F               4      RRCA
0009A0 49A0 0F               4      RRCA
0009A1 49A1 0F               4      RRCA
0009A2 49A2 0F               4      RRCA
0009A3 49A3 C9              10      RET
                                
       49A4                     GET_PIXEL3:
0009A4 49A4 7A               4      LD  A,D
0009A5 49A5 B3               4      OR  E
0009A6 49A6 200A            12      JR  NZ,GET_PIXEL5
                                
0009A8 49A8 2ACFF2          16      LD  HL,(_BUF_EN)
0009AB 49AB CDC849          17      CALL    ROM_READ
0009AE 49AE EB               4      EX  DE,HL
0009AF 49AF 2AC7F2          16      LD  HL,(_DTA)
       49B2                     GET_PIXEL5:
0009B2 49B2 7E               7      LD  A,(HL)
0009B3 49B3 0F               4      RRCA
0009B4 49B4 0F               4      RRCA
0009B5 49B5 0F               4      RRCA
0009B6 49B6 0F               4      RRCA
0009B7 49B7 0F               4      RRCA
0009B8 49B8 0F               4      RRCA
0009B9 49B9 C9              10      RET
                                
       49BA                     GET_PIXEL4:
0009BA 49BA 78               4      LD  A,B
0009BB 49BB E603             7      AND 3   ;+0
0009BD 49BD 28E5            12      JR  Z,GET_PIXEL3
0009BF 49BF 3D               4      DEC A   ;+1
0009C0 49C0 28DC            12      JR  Z,GET_PIXEL2
0009C2 49C2 3D               4      DEC A   ;+2
0009C3 49C3 7E               7      LD  A,(HL)
0009C4 49C4 C0              11      RET NZ
0009C5 49C5 0F               4      RRCA        ;+3
0009C6 49C6 0F               4      RRCA
0009C7 49C7 C9              10      RET
                                
       49C8                     ROM_READ:
0009C8 49C8 E5              11      PUSH    HL
0009C9 49C9 D5              11      PUSH    DE
0009CA 49CA C5              11      PUSH    BC
0009CB 49CB FDE5            15      PUSH    IY
0009CD 49CD 22E3F2          16      LD  (LEFTX),HL
0009D0 49D0 2AC7F2          16      LD  HL,(_DTA)
0009D3 49D3 22DAF2          16      LD  (DTAX),HL
0009D6 49D6 2AE3F2          16      LD  HL,(LEFTX)
                                
0009D9 49D9 CD7C4C          17      CALL    RBX1
0009DC 49DC 3870            12      JR  C,RBRERR1
0009DE 49DE 79               4      LD  A,C
0009DF 49DF EB               4      EX  DE,HL
0009E0 49E0 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0009E2 49E2 19              11      ADD HL,DE
0009E3 49E3 DE00             7      SBC A,000H
0009E5 49E5 3801            12      JR  C,RBR1
0009E7 49E7 EB               4      EX  DE,HL
       49E8                     RBR1:
0009E8 49E8 9F               4      SBC A,A
0009E9 49E9 E601             7      AND 1
0009EB 49EB 32B6F2          13      LD  (_RESULT),A
0009EE 49EE 7C               4      LD  A,H
0009EF 49EF B5               4      OR  L
0009F0 49F0 CA444A          10      JP  Z,RBREND0
                                
0009F3 49F3 22C3F2          16      LD  (_LEFT),HL  ;Read record byte
0009F6 49F6 22E3F2          16      LD  (LEFTX),HL
                                
0009F9 49F9 CDAF4C          17      CALL    RBX2
0009FC 49FC 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009FE 49FE CDC24C          17      CALL    RBXA
000A01 4A01 DA5A4A          10      JP  C,RBRERR
000A04 4A04 C5              11      PUSH    BC
000A05 4A05 CDF943          17      CALL    ROM_LDIR
000A08 4A08 ED53DAF2        20      LD  (DTAX),DE
000A0C 4A0C 2AE3F2          16      LD  HL,(LEFTX)
000A0F 4A0F D1              10      POP DE
000A10 4A10 A7               4      AND A
000A11 4A11 ED52            15      SBC HL,DE
000A13 4A13 22E3F2          16      LD  (LEFTX),HL
000A16 4A16 2829            12      JR  Z,RBREND
                                
       4A18                     RBRB:
000A18 4A18 CDFB4C          17      CALL    RBXB
000A1B 4A1B 2818            12      JR  Z,RBRC
       4A1D                     RBRB1:
000A1D 4A1D C5              11      PUSH    BC
000A1E 4A1E D5              11      PUSH    DE
000A1F 4A1F CDAC4D          17      CALL    CLUST
000A22 4A22 EB               4      EX  DE,HL
000A23 4A23 ED4BB9F2        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000A27 4A27 CDF943          17      CALL    ROM_LDIR
000A2A 4A2A EB               4      EX  DE,HL
000A2B 4A2B D1              10      POP DE
000A2C 4A2C C1              10      POP BC
000A2D 4A2D CD894D          17      CALL    GNCL
000A30 4A30 DA5A4A          10      JP  C,RBRERR
000A33 4A33 10E8            13      DJNZ    RBRB1
       4A35                     RBRC:
000A35 4A35 CD134D          17      CALL    RBXC
000A38 4A38 2807            12      JR  Z,RBREND
                                
000A3A 4A3A CDAC4D          17      CALL    CLUST
000A3D 4A3D EB               4      EX  DE,HL
000A3E 4A3E CDF943          17      CALL    ROM_LDIR
       4A41                     RBREND:
000A41 4A41 CD1F4D          17      CALL    RBXEND
       4A44                     RBREND0:
000A44 4A44 FDE1            14      POP IY
000A46 4A46 C1              10      POP BC
000A47 4A47 D1              10      POP DE
000A48 4A48 F1              10      POP AF  ;(HL)
000A49 4A49 AF               4      XOR A
000A4A 4A4A 3AB6F2          13      LD  A,(_RESULT)
000A4D 4A4D C9              10      RET
                                
       4A4E                     RBRERR1:
000A4E 4A4E 3E01             7      LD  A,001H
       4A50                     RBRERR2:
000A50 4A50 FDE1            14      POP IY
000A52 4A52 C1              10      POP BC
000A53 4A53 D1              10      POP DE
000A54 4A54 E1              10      POP HL
000A55 4A55 37               4      SCF
000A56 4A56 210000          10      LD  HL,0
000A59 4A59 C9              10      RET
       4A5A                     RBRERR:
000A5A 4A5A 3EFF             7      LD  A,0FFH
000A5C 4A5C 18F2            12      JR  RBRERR2
                                
       4A5E                     FILE_DD:
000A5E 4A5E E1              10      POP HL
000A5F 4A5F 3E                      DB  03EH
000A60 4A60 C9              10      RET
000A61 4A61 32A3F2          13      LD  (SWC_BLOAD_M),A
       4A64                     ROM_ORG:
000A64 4A64 2AE5F2          16      LD  HL,(PARAM0)
000A67 4A67 7E               7      LD  A,(HL)
000A68 4A68 C9              10      RET
       4A69                     FILE_B:
000A69 4A69 AF               4      XOR A
000A6A 4A6A 32EBF2          13      LD  (FDRV),A
000A6D 4A6D 1E00             7      LD  E,0
000A6F 4A6F 3A63F6          13      LD  A,(VALTYP)
000A72 4A72 FE03             7      CP  3       ;string
000A74 4A74 C20C4B          10      JP  NZ,FILED
                                
000A77 4A77 DD21D067        14      LD  IX,FRESTR
000A7B 4A7B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A7F 4A7F CD1C00          17      CALL    _CALSLT
000A82 4A82 E5              11      PUSH    HL
000A83 4A83 DDE1            14      POP IX
                                
000A85 4A85 DD5E00          19      LD  E,(IX+0)
000A88 4A88 DD7E01          19      LD  A,(IX+1)
000A8B 4A8B DD5602          19      LD  D,(IX+2)
000A8E 4A8E DD62             9      LD  IXH,D
000A90 4A90 DD6F             9      LD  IXL,A
000A92 4A92 7B               4      LD  A,E
       4A93                     FILE_BDOS:
000A93 4A93 FE04             7      CP  4
000A95 4A95 3808            12      JR  C,FILEB1
000A97 4A97 DD7E03          19      LD  A,(IX+3)
000A9A 4A9A FE3A             7      CP  ':'
000A9C 4A9C 28C0            12      JR  Z,FILE_DD
000A9E 4A9E 7B               4      LD  A,E
       4A9F                     FILEB1:
000A9F 4A9F FE02             7      CP  2
000AA1 4AA1 3818            12      JR  C,DEVI1
000AA3 4AA3 DD7E01          19      LD  A,(IX+1)
000AA6 4AA6 FE3A             7      CP  ':'
000AA8 4AA8 2011            12      JR  NZ,DEVI1
000AAA 4AAA DD7E00          19      LD  A,(IX+0)        ;DRIVE
000AAD 4AAD CDE54B          17      CALL    CAP
000AB0 4AB0 D640             7      SUB '@'
000AB2 4AB2 DD23            10      INC IX
000AB4 4AB4 DD23            10      INC IX
000AB6 4AB6 1D               4      DEC E
000AB7 4AB7 1D               4      DEC E
000AB8 4AB8 32EBF2          13      LD  (FDRV),A
       4ABB                     DEVI1:
000ABB 4ABB DD7E00          19      LD  A,(IX+0)
000ABE 4ABE D65C             7      SUB 05CH        ;\
000AC0 4AC0 2008            12      JR  NZ,NOROOT
000AC2 4AC2 6F               4      LD  L,A
000AC3 4AC3 67               4      LD  H,A
000AC4 4AC4 22E9F2          16      LD  (_CDX),HL
000AC7 4AC7 DD23            10      INC IX
000AC9 4AC9 1D               4      DEC E
       4ACA                     NOROOT:
                                
       4ACA                     SETDIR:
000ACA 4ACA CD0C4B          17      CALL    FILED
000ACD 4ACD DD7E00          19      LD  A,(IX+0)
000AD0 4AD0 FE5C             7      CP  05CH        ;\
000AD2 4AD2 C0              11      RET NZ
000AD3 4AD3 DD23            10      INC IX
000AD5 4AD5 1D               4      DEC E
000AD6 4AD6 3AECF2          13      LD  A,(FNAME)
000AD9 4AD9 FE20             7      CP  020H        ;. の処理
000ADB 4ADB 28ED            12      JR  Z,SETDIR
                                
000ADD 4ADD CDFB4B          17      CALL    ROM_OPEN
000AE0 4AE0 B7               4      OR  A
000AE1 4AE1 C0              11      RET NZ
                                
                                #if exists USE_MORMAL32K_OR_ASCII16
000AE2 4AE2 D5              11      PUSH    DE
000AE3 4AE3 2AE0F2          16      LD  HL,(DIRENT1)
000AE6 4AE6 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000AE9 4AE9 19              11      ADD HL,DE
000AEA 4AEA CD8B43          17      CALL    RDSLT_ROM
000AED 4AED D1              10      POP DE
000AEE 4AEE CB67             8      BIT 4,A     ;ディレクトリ
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                #endif
000AF0 4AF0 C8              11      RET Z
000AF1 4AF1 CD534B          17      CALL    FILEI
                                #if exists USE_MORMAL32K_OR_ASCII16
000AF4 4AF4 D5              11      PUSH    DE
000AF5 4AF5 2AE0F2          16      LD  HL,(DIRENT1)
000AF8 4AF8 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000AFB 4AFB 19              11      ADD HL,DE
000AFC 4AFC CD8B43          17      CALL    RDSLT_ROM
000AFF 4AFF 23               6      INC HL
000B00 4B00 5F               4      LD  E,A
000B01 4B01 CD8B43          17      CALL    RDSLT_ROM
000B04 4B04 57               4      LD  D,A
000B05 4B05 EB               4      EX  DE,HL
000B06 4B06 D1              10      POP DE
                                #else
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
000B07 4B07 22E9F2          16      LD  (_CDX),HL
000B0A 4B0A 18BE            12      JR  SETDIR
                                
       4B0C                     FILED:
000B0C 4B0C CD534B          17      CALL    FILEI
000B0F 4B0F 21ECF2          10      LD  HL,FNAME
                                
000B12 4B12 0608             7      LD  B,8
       4B14                     FILE2:
000B14 4B14 CD604B          17      CALL    CCHKF
000B17 4B17 C8              11      RET Z
000B18 4B18 FE2A             7      CP  '*'
000B1A 4B1A 282E            12      JR  Z,FILE9
000B1C 4B1C FE2E             7      CP  '.'
000B1E 4B1E 280C            12      JR  Z,FILE4
000B20 4B20 77               7      LD  (HL),A
000B21 4B21 23               6      INC HL
000B22 4B22 10F0            13      DJNZ    FILE2
                                
       4B24                     FILE3:
000B24 4B24 CD604B          17      CALL    CCHKF
000B27 4B27 C8              11      RET Z
000B28 4B28 FE2E             7      CP  '.'
000B2A 4B2A 20F8            12      JR  NZ,FILE3
                                
       4B2C                     FILE4:
000B2C 4B2C 21F4F2          10      LD  HL,FNAME+8
000B2F 4B2F 0603             7      LD  B,3
                                
       4B31                     FILE4L:
000B31 4B31 CD604B          17      CALL    CCHKF
000B34 4B34 C8              11      RET Z
000B35 4B35 FE2E             7      CP  '.'
000B37 4B37 2008            12      JR  NZ,FILE12
000B39 4B39 32ECF2          13      LD  (FNAME),A   ;Parent directory(..)
000B3C 4B3C 32EDF2          13      LD  (FNAME+1),A
000B3F 4B3F 3E20             7      LD  A,020H
       4B41                     FILE12:
000B41 4B41 FE2A             7      CP  '*'
000B43 4B43 280A            12      JR  Z,FILE10
000B45 4B45 77               7      LD  (HL),A
000B46 4B46 23               6      INC HL
000B47 4B47 10E8            13      DJNZ    FILE4L
000B49 4B49 C9              10      RET
                                
       4B4A                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000B4A 4B4A CD4F4B          17      CALL    FILE10
000B4D 4B4D 18D5            12      JR  FILE3
                                
       4B4F                     FILE10:
000B4F 4B4F 3E3F             7      LD  A,'?'
000B51 4B51 1808            12      JR  FILL_MEMORY
       4B53                     FILEI:              ;名前＋拡張子をスペースで初期化
000B53 4B53 3E20             7      LD  A,020H
000B55 4B55 01000B          10      LD  BC,11*256   ;C=0にしておく
000B58 4B58 21ECF2          10      LD  HL,FNAME
       4B5B                     FILL_MEMORY:            ;HLからBバイトAで埋める
000B5B 4B5B 77               7      LD  (HL),A
000B5C 4B5C 23               6      INC HL
000B5D 4B5D 10FC            13      DJNZ    FILL_MEMORY
000B5F 4B5F C9              10      RET
                                
       4B60                     CCHKF:
000B60 4B60 7B               4      LD  A,E
000B61 4B61 B7               4      OR  A
000B62 4B62 C8              11      RET Z
000B63 4B63 DD7E00          19      LD  A,(IX+0)
000B66 4B66 CD6D4B          17      CALL    CCHK2
000B69 4B69 C8              11      RET Z
000B6A 4B6A C3D04B          10      JP  FKAN
                                
       4B6D                     CCHK2:
000B6D 4B6D 0C               4      INC C
000B6E 4B6E 0D               4      DEC C
000B6F 4B6F C0              11      RET NZ
       4B70                     CCHK3:              ;ZF=1 で使えない文字
000B70 4B70 FE2B             7      CP  '+'
000B72 4B72 C8              11      RET Z
000B73 4B73 FE2C             7      CP  ','
000B75 4B75 C8              11      RET Z
000B76 4B76 FE2F             7      CP  '/'
000B78 4B78 C8              11      RET Z
000B79 4B79 FE3A             7      CP  ':'
000B7B 4B7B C8              11      RET Z
000B7C 4B7C FE3B             7      CP  ';'
000B7E 4B7E C8              11      RET Z
000B7F 4B7F FE3D             7      CP  '='
000B81 4B81 C8              11      RET Z
000B82 4B82 FE5C             7      CP  05CH    ;\
000B84 4B84 C8              11      RET Z
000B85 4B85 FE1F             7      CP  01FH
000B87 4B87 D0              11      RET NC
000B88 4B88 BF               4      CP  A       ;Z=1
000B89 4B89 C9              10      RET
                                
       4B8A                     SS1:
000B8A 4B8A 13               6      INC DE
       4B8B                     SPCUT:              ;スペースをカット
000B8B 4B8B 1A               7      LD  A,(DE)
000B8C 4B8C FE20             7      CP  020H
000B8E 4B8E 28FA            12      JR  Z,SS1
000B90 4B90 C9              10      RET
                                
       4B91                     SCREOF1:
000B91 4B91 13               6      INC DE
       4B92                     SPCUTEX:            ;スペース改行などをカット
000B92 4B92 1A               7      LD  A,(DE)
000B93 4B93 FE20             7      CP  020H
000B95 4B95 28FA            12      JR  Z,SCREOF1
000B97 4B97 FE0D             7      CP  00DH
000B99 4B99 28F6            12      JR  Z,SCREOF1
000B9B 4B9B FE0A             7      CP  00AH
000B9D 4B9D 28F2            12      JR  Z,SCREOF1
000B9F 4B9F FE1A             7      CP  01AH
000BA1 4BA1 28EE            12      JR  Z,SCREOF1
000BA3 4BA3 C9              10      RET
                                
       4BA4                     GETNUM:
000BA4 4BA4 210000          10      LD  HL,0
       4BA7                     GETNUM1:
000BA7 4BA7 1A               7      LD  A,(DE)
000BA8 4BA8 13               6      INC DE
000BA9 4BA9 D630             7      SUB '0'
000BAB 4BAB D8              11      RET C
000BAC 4BAC FE0A             7      CP  10
000BAE 4BAE D0              11      RET NC
000BAF 4BAF 4D               4      LD  C,L
000BB0 4BB0 44               4      LD  B,H
000BB1 4BB1 29              11      ADD HL,HL   ;*2
000BB2 4BB2 29              11      ADD HL,HL   ;*4
000BB3 4BB3 09              11      ADD HL,BC   ;*5
000BB4 4BB4 29              11      ADD HL,HL   ;*10
000BB5 4BB5 4F               4      LD  C,A
000BB6 4BB6 0600             7      LD  B,0
000BB8 4BB8 09              11      ADD HL,BC
000BB9 4BB9 18EC            12      JR  GETNUM1
                                
       4BBB                     SEARCH_END:
000BBB 4BBB 7E               7      LD  A,(HL)
       4BBC                     SEARCH_END1:
000BBC 4BBC 23               6      INC HL
000BBD 4BBD B7               4      OR  A
000BBE 4BBE C8              11      RET Z
000BBF 4BBF FE3A             7      CP  ':'
000BC1 4BC1 20F8            12      JR  NZ,SEARCH_END
000BC3 4BC3 7E               7      LD  A,(HL)
000BC4 4BC4 FE3A             7      CP  ':'
000BC6 4BC6 28F4            12      JR  Z,SEARCH_END1
000BC8 4BC8 C9              10      RET
                                
       4BC9                     FKANC:
000BC9 4BC9 CB41             8      BIT 0,C
000BCB 4BCB CCEE4B          17      CALL    Z,CAP2
000BCE 4BCE 1803            12      JR  FKANX
       4BD0                     FKAN:           ;漢字チェック
000BD0 4BD0 DD23            10      INC IX
000BD2 4BD2 1D               4      DEC E
       4BD3                     FKANX:
000BD3 4BD3 CB41             8      BIT 0,C
000BD5 4BD5 CB81             8      RES 0,C
000BD7 4BD7 C0              11      RET NZ
000BD8 4BD8 FE80             7      CP  080H
000BDA 4BDA D8              11      RET C
000BDB 4BDB FEA0             7      CP  0A0H
000BDD 4BDD 3803            12      JR  C,FKAN1
000BDF 4BDF FEE0             7      CP  0E0H
000BE1 4BE1 D8              11      RET C
       4BE2                     FKAN1:
000BE2 4BE2 0C               4      INC C
000BE3 4BE3 A7               4      AND A
000BE4 4BE4 C9              10      RET
                                
       4BE5                     CAP:
000BE5 4BE5 FE61             7      CP  'a'
000BE7 4BE7 D8              11      RET C
000BE8 4BE8 FE7B             7      CP  'z'+1
000BEA 4BEA D0              11      RET NC
000BEB 4BEB D620             7      SUB 020H
000BED 4BED C9              10      RET
       4BEE                     CAP2:
000BEE 4BEE CDE54B          17      CALL    CAP
       4BF1                     CAP3:               ;
000BF1 4BF1 FE05             7      CP  5
000BF3 4BF3 2803            12      JR  Z,CAP4
000BF5 4BF5 FE21             7      CP  021H
000BF7 4BF7 C9              10      RET
       4BF8                     CAP4:
000BF8 4BF8 3EE5             7      LD  A,0E5H
000BFA 4BFA C9              10      RET
                                
       4BFB                     ROM_OPEN:
000BFB 4BFB CD0752          17      CALL    GET_DISK_BANK_FDRV
                                
000BFE 4BFE CD574E          17      CALL    GET_DIR_DAT
000C01 4C01 D5              11      PUSH    DE
000C02 4C02 CD174C          17      CALL    FILESE
000C05 4C05 D1              10      POP DE
000C06 4C06 3F               4      CCF
000C07 4C07 D8              11      RET C
000C08 4C08 22E0F2          16      LD  (DIRENT1),HL
000C0B 4C0B E5              11      PUSH    HL
000C0C 4C0C 210000          10      LD  HL,0
000C0F 4C0F 22BDF2          16      LD  (RR_LOW),HL
000C12 4C12 22BFF2          16      LD  (RR_HIGH),HL
000C15 4C15 E1              10      POP HL
000C16 4C16 C9              10      RET
                                
       4C17                     FILESE:
       4C17                     FILESE0:
                                #if exists USE_MORMAL32K_OR_ASCII16
000C17 4C17 CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000C1A 4C1A B7               4      OR  A
000C1B 4C1B C8              11      RET Z       ;END:ZF=1 CF=0
000C1C 4C1C FEE5             7      CP  0E5H
000C1E 4C1E 280D            12      JR  Z,FILESE1
000C20 4C20 11ECF2          10      LD  DE,FNAME
000C23 4C23 E5              11      PUSH    HL
000C24 4C24 CD534C          17      CALL    CPFILE
000C27 4C27 CC764C          17      CALL    Z,CPFILE2
000C2A 4C2A E1              10      POP HL
000C2B 4C2B 37               4      SCF
000C2C 4C2C C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4C2D                     FILESE1:
000C2D 4C2D CD354C          17      CALL    FNEXT
000C30 4C30 20E5            12      JR  NZ,FILESE0
000C32 4C32 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000C34 4C34 C9              10      RET
                                
       4C35                     FNEXT:
000C35 4C35 112000          10      LD  DE,020H
000C38 4C38 19              11      ADD HL,DE
000C39 4C39 ED5BE9F2        20      LD  DE,(_CDX)
000C3D 4C3D 7A               4      LD  A,D
000C3E 4C3E B3               4      OR  E
000C3F 4C3F 2002            12      JR  NZ,FNEXT_SUBDIR
000C41 4C41 0D               4      DEC C
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000C42 4C42 C9              10      RET
                                
       4C43                     FNEXT_SUBDIR:           ;サブディレクトリ
000C43 4C43 0D               4      DEC C
000C44 4C44 C0              11      RET NZ
                                
000C45 4C45 ED5BE9F2        20      LD  DE,(_CDX)
000C49 4C49 CD894D          17      CALL    GNCL
000C4C 4C4C EB               4      EX  DE,HL
000C4D 4C4D 22E9F2          16      LD  (_CDX),HL
000C50 4C50 C3904E          10      JP  GET_SUBDIR
                                
       4C53                     CPFILE:
000C53 4C53 C5              11      PUSH    BC
000C54 4C54 01000B          10      LD  BC,00B00H
       4C57                     CPSTR1:
000C57 4C57 1A               7      LD  A,(DE)
000C58 4C58 FE3F             7      CP  '?'     ;Wild card
000C5A 4C5A 2814            12      JR  Z,CPSTR2
                                #if exists USE_MORMAL32K_OR_ASCII16
000C5C 4C5C CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000C5F 4C5F CDC94B          17      CALL    FKANC
000C62 4C62 E5              11      PUSH    HL
000C63 4C63 67               4      LD  H,A
000C64 4C64 1A               7      LD  A,(DE)
000C65 4C65 CB01             4      RLC C
000C67 4C67 CDC94B          17      CALL    FKANC
000C6A 4C6A CB09             4      RRC C
000C6C 4C6C BC               4      CP  H       ;CP (HL),(DE)
000C6D 4C6D E1              10      POP HL
000C6E 4C6E 2004            12      JR  NZ,CPSTR3
       4C70                     CPSTR2:
000C70 4C70 13               6      INC DE
000C71 4C71 23               6      INC HL
000C72 4C72 10E3            13      DJNZ    CPSTR1
       4C74                     CPSTR3:
000C74 4C74 C1              10      POP BC
000C75 4C75 C9              10      RET
                                
       4C76                     CPFILE2:
                                #if exists USE_MORMAL32K_OR_ASCII16
000C76 4C76 CD8B43          17      CALL    RDSLT_ROM
                                #else
                                    LD  A,(HL)
                                #endif
000C79 4C79 E60E             7      AND 00EH    ;~0F1H
000C7B 4C7B C9              10      RET
                                
       4C7C                     RBX1:
000C7C 4C7C E5              11      PUSH    HL      ;Record byte
                                
000C7D 4C7D ED5BBDF2        20      LD  DE,(RR_LOW) ;CDE=Random record
000C81 4C81 3AC0F2          13      LD  A,(RR_HIGH+1)
000C84 4C84 4F               4      LD  C,A
                                
000C85 4C85 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000C88 4C88 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
000C8B 4C8B D5              11      PUSH    DE
000C8C 4C8C 2AE0F2          16      LD  HL,(DIRENT1)
000C8F 4C8F 111C00          10      LD  DE,0001CH
000C92 4C92 19              11      ADD HL,DE
000C93 4C93 CD8B43          17      CALL    RDSLT_ROM
000C96 4C96 23               6      INC HL
000C97 4C97 5F               4      LD  E,A
000C98 4C98 CD8B43          17      CALL    RDSLT_ROM
000C9B 4C9B 23               6      INC HL
000C9C 4C9C 57               4      LD  D,A
000C9D 4C9D CD8B43          17      CALL    RDSLT_ROM
000CA0 4CA0 EB               4      EX  DE,HL       ;AHL=File size
000CA1 4CA1 D1              10      POP DE
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  L,(IY+01CH) ;AHL=File size
                                    LD  H,(IY+01DH)
                                    LD  A,(IY+01EH)
                                #endif
                                
000CA2 4CA2 A7               4      AND A
000CA3 4CA3 ED52            15      SBC HL,DE
000CA5 4CA5 99               4      SBC A,C
000CA6 4CA6 D1              10      POP DE
                                
000CA7 4CA7 D8              11      RET C
000CA8 4CA8 4F               4      LD  C,A
000CA9 4CA9 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000CAA 4CAA B2               4      OR  D
000CAB 4CAB B3               4      OR  E
000CAC 4CAC C0              11      RET NZ
000CAD 4CAD 37               4      SCF
000CAE 4CAE C9              10      RET
                                
       4CAF                     RBX2:
000CAF 4CAF ED4BBEF2        20      LD  BC,(RR_LOW+1)
000CB3 4CB3 CD344D          17      CALL    RWXR
000CB6 4CB6 3ABAF2          13      LD  A,(CLSZ_H)
000CB9 4CB9 3D               4      DEC A
000CBA 4CBA E5              11      PUSH    HL
000CBB 4CBB 2ABDF2          16      LD  HL,(RR_LOW)
000CBE 4CBE A4               4      AND H
000CBF 4CBF B5               4      OR  L
000CC0 4CC0 E1              10      POP HL
000CC1 4CC1 C9              10      RET
                                
       4CC2                     RBXA:
000CC2 4CC2 D5              11      PUSH    DE
000CC3 4CC3 CDAC4D          17      CALL    CLUST
000CC6 4CC6 ED53C5F2        20      LD  (_DTPS),DE
000CCA 4CCA D1              10      POP DE
000CCB 4CCB CD894D          17      CALL    GNCL
000CCE 4CCE D8              11      RET C
000CCF 4CCF ED53C1F2        20      LD  (_CLPS),DE
                                
000CD3 4CD3 ED4BBDF2        20      LD  BC,(RR_LOW)
000CD7 4CD7 2AB9F2          16      LD  HL,(CLSZ)
000CDA 4CDA 7C               4      LD  A,H
000CDB 4CDB 3D               4      DEC A
000CDC 4CDC A0               4      AND B
000CDD 4CDD 47               4      LD  B,A
000CDE 4CDE ED42            15      SBC HL,BC       ;remaining cluster
                                
000CE0 4CE0 ED5BE3F2        20      LD  DE,(LEFTX)
000CE4 4CE4 ED52            15      SBC HL,DE       ;CP HL,DE
000CE6 4CE6 19              11      ADD HL,DE
000CE7 4CE7 3801            12      JR  C,RBXA1
000CE9 4CE9 EB               4      EX  DE,HL
       4CEA                     RBXA1:
000CEA 4CEA 3AB7F2          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_MORMAL32K_OR_ASCII16
000CED 4CED 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000CF0 4CF0 E5              11      PUSH    HL
000CF1 4CF1 2AC5F2          16      LD  HL,(_DTPS)
000CF4 4CF4 09              11      ADD HL,BC
000CF5 4CF5 ED5BDAF2        20      LD  DE,(DTAX)
000CF9 4CF9 C1              10      POP BC
000CFA 4CFA C9              10      RET
                                
       4CFB                     RBXB:
000CFB 4CFB 2ADAF2          16      LD  HL,(DTAX)
000CFE 4CFE ED5BC1F2        20      LD  DE,(_CLPS)
000D02 4D02 3AE4F2          13      LD  A,(LEFTX+1)
000D05 4D05 47               4      LD  B,A
000D06 4D06 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4D09                     RBXB1:
000D09 4D09 1F               4      RRA     ;->CF
000D0A 4D0A 3804            12      JR  C,RBXB2
000D0C 4D0C CB38             8      SRL B   ;B=B/2
000D0E 4D0E 18F9            12      JR  RBXB1
       4D10                     RBXB2:
000D10 4D10 78               4      LD  A,B
000D11 4D11 B7               4      OR  A
000D12 4D12 C9              10      RET
                                
       4D13                     RBXC:
000D13 4D13 ED4BE3F2        20      LD  BC,(LEFTX)
000D17 4D17 3ABAF2          13      LD  A,(CLSZ_H)
000D1A 4D1A 3D               4      DEC A
000D1B 4D1B A0               4      AND B
000D1C 4D1C 47               4      LD  B,A
000D1D 4D1D B1               4      OR  C
000D1E 4D1E C9              10      RET
                                
       4D1F                     RBXEND:
000D1F 4D1F ED5BC3F2        20      LD  DE,(_LEFT)
000D23 4D23 2ABDF2          16      LD  HL,(RR_LOW)
000D26 4D26 3AC0F2          13      LD  A,(RR_HIGH+1)
000D29 4D29 19              11      ADD HL,DE
000D2A 4D2A CE00             7      ADC A,0
000D2C 4D2C 22BDF2          16      LD  (RR_LOW),HL
000D2F 4D2F 32C0F2          13      LD  (RR_HIGH+1),A
000D32 4D32 EB               4      EX  DE,HL       ;HL=Read byte
000D33 4D33 C9              10      RET 
                                
       4D34                     RWXR:
000D34 4D34 3ABAF2          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4D37                     L_RWX:
000D37 4D37 1F               4      RRA     ;->CF
000D38 4D38 3806            12      JR  C,E_RWX
000D3A 4D3A CB38             8      SRL B   ;BC=BC/2
000D3C 4D3C CB19             8      RR  C   ;
000D3E 4D3E 18F7            12      JR  L_RWX
       4D40                     E_RWX:
000D40 4D40 3AE2F2          13      LD  A,(_DIR_BANK)
                                #if exists USE_MORMAL32K_OR_ASCII16
000D43 4D43 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                
000D46 4D46 E5              11      PUSH    HL
000D47 4D47 2AE0F2          16      LD  HL,(DIRENT1)
000D4A 4D4A 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000D4D 4D4D 19              11      ADD HL,DE
000D4E 4D4E CD8B43          17      CALL    RDSLT_ROM
000D51 4D51 23               6      INC HL
000D52 4D52 5F               4      LD  E,A
000D53 4D53 CD8B43          17      CALL    RDSLT_ROM
000D56 4D56 23               6      INC HL
000D57 4D57 57               4      LD  D,A
000D58 4D58 E1              10      POP HL
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  IY,(DIRENT1)
                                    LD  E,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  D,(IY+01BH)
                                #endif
000D59 4D59 CD0752          17      CALL    GET_DISK_BANK_FDRV
       4D5C                     RWX1:
000D5C 4D5C ED53C1F2        20      LD  (_CLPS),DE
000D60 4D60 7A               4      LD  A,D
000D61 4D61 B3               4      OR  E
000D62 4D62 37               4      SCF
000D63 4D63 C8              11      RET Z
                                
000D64 4D64 78               4      LD  A,B
000D65 4D65 B1               4      OR  C
000D66 4D66 C8              11      RET Z
                                
000D67 4D67 CD894D          17      CALL    GNCL
000D6A 4D6A D8              11      RET C
000D6B 4D6B 0B               6      DEC BC
000D6C 4D6C CDF04D          17      CALL    ENDCL
000D6F 4D6F 38EB            12      JR  C,RWX1
000D71 4D71 37               4      SCF
000D72 4D72 C9              10      RET
                                
       4D73                     NCL3:
000D73 4D73 CD0752          17      CALL    GET_DISK_BANK_FDRV
000D76 4D76 6B               4      LD  L,E
000D77 4D77 62               4      LD  H,D
000D78 4D78 CB3C             8      SRL H
000D7A 4D7A CB1D             8      RR  L
000D7C 4D7C 1F               4      RRA
000D7D 4D7D 19              11      ADD HL,DE
000D7E 4D7E 010060          10      LD  BC,BANK1_ADR
000D81 4D81 09              11      ADD HL,BC
000D82 4D82 ED4BBBF2        20      LD  BC,(SECSZ)
000D86 4D86 09              11      ADD HL,BC
000D87 4D87 17               4      RLA
000D88 4D88 C9              10      RET
                                
       4D89                     GNCL:
000D89 4D89 7A               4      LD  A,D
000D8A 4D8A B3               4      OR  E
000D8B 4D8B 37               4      SCF
000D8C 4D8C C8              11      RET Z
000D8D 4D8D C5              11      PUSH    BC
000D8E 4D8E E5              11      PUSH    HL
000D8F 4D8F CD734D          17      CALL    NCL3
000D92 4D92 3809            12      JR  C,GNC1
000D94 4D94 5E               7      LD  E,(HL)
000D95 4D95 23               6      INC HL
000D96 4D96 7E               7      LD  A,(HL)
000D97 4D97 E60F             7      AND 00FH
000D99 4D99 57               4      LD  D,A
000D9A 4D9A E1              10      POP HL
000D9B 4D9B C1              10      POP BC
000D9C 4D9C C9              10      RET
       4D9D                     GNC1:
000D9D 4D9D 7E               7      LD  A,(HL)
000D9E 4D9E 23               6      INC HL
000D9F 4D9F 56               7      LD  D,(HL)
000DA0 4DA0 0604             7      LD  B,4
       4DA2                     GNC1L:
000DA2 4DA2 CB3A             8      SRL D
000DA4 4DA4 1F               4      RRA
000DA5 4DA5 10FB            13      DJNZ    GNC1L
                                
000DA7 4DA7 5F               4      LD  E,A
000DA8 4DA8 E1              10      POP HL
000DA9 4DA9 C1              10      POP BC
000DAA 4DAA A7               4      AND A
000DAB 4DAB C9              10      RET
                                
       4DAC                     CLUST:
000DAC 4DAC EB               4      EX  DE,HL
       4DAD                     CLUST_HL:
000DAD 4DAD 2B               6      DEC HL
000DAE 4DAE 2B               6      DEC HL
000DAF 4DAF C5              11      PUSH    BC
000DB0 4DB0 3ABAF2          13      LD  A,(CLSZ_H)
000DB3 4DB3 CD3052          17      CALL    MUL_AHL
                                
000DB6 4DB6 CD714E          17      CALL    GET_DIR_POS
000DB9 4DB9 4F               4      LD  C,A
000DBA 4DBA 0600             7      LD  B,0
000DBC 4DBC 09              11      ADD HL,BC
                                
000DBD 4DBD ED4B1160        20      LD  BC,(BANK1_ADR+17)   ;BPB_RootEntCnt
000DC1 4DC1 CB38             8      SRL B
000DC3 4DC3 CB19             8      RR  C           ;/2
000DC5 4DC5 CB38             8      SRL B
000DC7 4DC7 CB19             8      RR  C           ;/4
000DC9 4DC9 CB38             8      SRL B
000DCB 4DCB CB19             8      RR  C           ;/8
000DCD 4DCD 09              11      ADD HL,BC
                                #if exists USE_MORMAL32K_OR_ASCII16
000DCE 4DCE 7D               4      LD  A,L
000DCF 4DCF 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000DD2 4DD2 09              11      ADD HL,BC
000DD3 4DD3 3013            12      JR  NC,CLUST2
000DD5 4DD5 4D               4      LD  C,L     ;C=読み出し元
000DD6 4DD6 29              11      ADD HL,HL   ;64KB→32KB
000DD7 4DD7 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000DD8 4DD8 CD0752          17      CALL    GET_DISK_BANK_FDRV
000DDB 4DDB 84               4      ADD A,H
000DDC 4DDC 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000DDF 4DDF 32B7F2          13      LD  (_BANK),A
000DE2 4DE2 69               4      LD  L,C     ;C=読み出し元
000DE3 4DE3 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000DE5 4DE5 A5               4      AND L
000DE6 4DE6 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4DE8                     CLUST2:
000DE8 4DE8 C660             7      ADD A,high BANK1_ADR
000DEA 4DEA 67               4      LD  H,A
000DEB 4DEB 2E00             7      LD  L,0
000DED 4DED EB               4      EX  DE,HL
000DEE 4DEE C1              10      POP BC
000DEF 4DEF C9              10      RET
                                
       4DF0                     ENDCL:
000DF0 4DF0 7A               4      LD  A,D ;END CLUSTER
000DF1 4DF1 FE0F             7      CP  00FH    ;FAT12の最大値
000DF3 4DF3 C0              11      RET NZ
000DF4 4DF4 7B               4      LD  A,E
000DF5 4DF5 FEF7             7      CP  0F7H
000DF7 4DF7 C9              10      RET
                                
       4DF8                     RB_READ:
000DF8 4DF8 AF               4      XOR A   ;HLA = HL*128
000DF9 4DF9 CB3C             8      SRL H
000DFB 4DFB CB1D             8      RR  L
000DFD 4DFD 1F               4      RRA
000DFE 4DFE 32BDF2          13      LD  (RR_LOW),A
000E01 4E01 22BEF2          16      LD  (RR_MID),HL
000E04 4E04 218000          10      LD  HL,128
                                
000E07 4E07 CDC849          17      CALL    ROM_READ
000E0A 4E0A C9              10      RET
                                
       4E0B                     GETSEQ:
000E0B 4E0B FD6E20          19      LD  L,(IY+32)
000E0E 4E0E FD660C          19      LD  H,(IY+12)
                                
000E11 4E11 CB25             8      SLA L
                                
000E13 4E13 CB3C             8      SRL H
000E15 4E15 CB1D             8      RR  L
000E17 4E17 C9              10      RET
                                
       4E18                     SETSEQ:
000E18 4E18 F5              11      PUSH    AF
000E19 4E19 3ABDF2          13      LD  A,(RR_LOW)
000E1C 4E1C 2ABEF2          16      LD  HL,(RR_MID)
                                
000E1F 4E1F CD364E          17      CALL    SSQ1
                                
000E22 4E22 29              11      ADD HL,HL
000E23 4E23 CB3D             8      SRL L
000E25 4E25 FD7520          19      LD  (IY+32),L
000E28 4E28 FD740C          19      LD  (IY+12),H
000E2B 4E2B F1              10      POP AF
000E2C 4E2C C9              10      RET
                                
       4E2D                     GETSIZE:
000E2D 4E2D FD7E10          19      LD  A,(IY+16)
000E30 4E30 FD6E11          19      LD  L,(IY+17)
000E33 4E33 FD6612          19      LD  H,(IY+18)
       4E36                     SSQ1:
000E36 4E36 87               4      ADD A,A
000E37 4E37 ED6A            15      ADC HL,HL
000E39 4E39 B7               4      OR  A
000E3A 4E3A C8              11      RET Z
000E3B 4E3B 23               6      INC HL
000E3C 4E3C C9              10      RET
                                
       4E3D                     SET_FCB:
000E3D 4E3D D5              11      PUSH    DE
000E3E 4E3E FDE1            14      POP IY
000E40 4E40 FD7E1C          19      LD  A,(IY+28)
000E43 4E43 FEFF             7      CP  0FFH
000E45 4E45 200C            12      JR  NZ,POPAF_SCF_FF_RET
000E47 4E47 E5              11      PUSH    HL
000E48 4E48 FD6E1A          19      LD  L,(IY+26)
000E4B 4E4B FD661B          19      LD  H,(IY+27)
000E4E 4E4E 22C1F2          16      LD  (_CLPS),HL
000E51 4E51 E1              10      POP HL
000E52 4E52 C9              10      RET
                                
       4E53                     POPAF_SCF_FF_RET:
000E53 4E53 F1              10      POP AF
000E54 4E54 37               4      SCF
000E55 4E55 9F               4      SBC A,A
000E56 4E56 C9              10      RET
                                
       4E57                     GET_DIR_DAT:
000E57 4E57 2AE9F2          16      LD  HL,(_CDX)
000E5A 4E5A 7C               4      LD  A,H
000E5B 4E5B B5               4      OR  L
000E5C 4E5C 2032            12      JR  NZ,GET_SUBDIR
000E5E 4E5E CD714E          17      CALL    GET_DIR_POS
000E61 4E61 C660             7      ADD A,high BANK1_ADR
000E63 4E63 2E00             7      LD  L,0
000E65 4E65 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_MORMAL32K_OR_ASCII16
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000E66 4E66 3AB8F2          13      LD  A,(_BANK1)
000E69 4E69 32E2F2          13      LD  (_DIR_BANK),A
                                
000E6C 4E6C 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000E6F 4E6F 4F               4      LD  C,A
000E70 4E70 C9              10      RET
                                
       4E71                     GET_DIR_POS:                ;ルートディレクトリ
000E71 4E71 CD0752          17      CALL    GET_DISK_BANK_FDRV
000E74 4E74 32B8F2          13      LD  (_BANK1),A
000E77 4E77 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000E7A 4E7A 47               4      LD  B,A
000E7B 4E7B 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000E7E 4E7E 4F               4      LD  C,A
000E7F 4E7F 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4E82                     GET_DIR_POS1:
000E82 4E82 81               4      ADD A,C
000E83 4E83 10FD            13      DJNZ    GET_DIR_POS1
                                
000E85 4E85 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec
000E89 4E89 37               4      SCF     ;無限ループ回避
       4E8A                     L_MDP:
000E8A 4E8A CB18             8      RR  B   ;->CF
000E8C 4E8C D8              11      RET C
000E8D 4E8D 87               4      ADD A,A
000E8E 4E8E 18FA            12      JR  L_MDP
                                
       4E90                     GET_SUBDIR:             ;サブディレクトリ
000E90 4E90 CDAD4D          17      CALL    CLUST_HL
000E93 4E93 EB               4      EX  DE,HL
000E94 4E94 3AB7F2          13      LD  A,(_BANK)
000E97 4E97 32E2F2          13      LD  (_DIR_BANK),A
000E9A 4E9A 3ABAF2          13      LD  A,(CLSZ_H)
000E9D 4E9D 87               4      ADD A,A     ;*2
000E9E 4E9E 87               4      ADD A,A     ;*4
000E9F 4E9F 87               4      ADD A,A     ;*8
000EA0 4EA0 4F               4      LD  C,A
000EA1 4EA1 C9              10      RET
                                
       4EA2                     STATEMENT:
000EA2 4EA2 111D50          10      LD  DE,STR_CHDIR
000EA5 4EA5 CD0350          17      CALL    CPPROCNM
000EA8 4EA8 280A            12      JR  Z,_CHDIR
000EAA 4EAA 112350          10      LD  DE,STR_RAMDISK
000EAD 4EAD CD0350          17      CALL    CPPROCNM
000EB0 4EB0 2814            12      JR  Z,_RAMDISK
000EB2 4EB2 37               4      SCF
000EB3 4EB3 C9              10      RET
       4EB4                     _CHDIR:
000EB4 4EB4 7E               7      LD  A,(HL)
000EB5 4EB5 FE28             7      CP  '('
000EB7 4EB7 37               4      SCF
000EB8 4EB8 C0              11      RET NZ
000EB9 4EB9 CD7647          17      CALL    INIT_PARAM
000EBC 4EBC CD694A          17      CALL    FILE_B
000EBF 4EBF CDDE4E          17      CALL    ROM_CD
000EC2 4EC2 DA3446          10      JP  C,ERROR_FILE_NOT_FOUND
000EC5 4EC5 C9              10      RET
                                
       4EC6                     _RAMDISK:
000EC6 4EC6 7E               7      LD  A,(HL)
000EC7 4EC7 FE28             7      CP  '('
000EC9 4EC9 37               4      SCF
000ECA 4ECA C0              11      RET NZ
000ECB 4ECB 23               6      INC HL
000ECC 4ECC DD212F54        14      LD  IX,FRMQNT
000ED0 4ED0 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000ED4 4ED4 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000ED7 4ED7 7A               4      LD  A,D
000ED8 4ED8 B3               4      OR  E
000ED9 4ED9 C22E46          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000EDC 4EDC 23               6      INC HL
000EDD 4EDD C9              10      RET
                                
       4EDE                     ROM_CD:
000EDE 4EDE 3AECF2          13      LD  A,(FNAME)
000EE1 4EE1 FE20             7      CP  020H
000EE3 4EE3 2835            12      JR  Z,CD1
000EE5 4EE5 CDFB4B          17      CALL    ROM_OPEN
000EE8 4EE8 D8              11      RET C
                                #if exists USE_MORMAL32K_OR_ASCII16
000EE9 4EE9 D5              11      PUSH    DE
000EEA 4EEA 2AE0F2          16      LD  HL,(DIRENT1)
000EED 4EED 110B00          10      LD  DE,0000BH   ;属性(アトリビュート)
000EF0 4EF0 19              11      ADD HL,DE
000EF1 4EF1 CD8B43          17      CALL    RDSLT_ROM
000EF4 4EF4 D1              10      POP DE
000EF5 4EF5 CB67             8      BIT 4,A     ;ディレクトリ
000EF7 4EF7 CA3446          10      JP  Z,ERROR_FILE_NOT_FOUND
000EFA 4EFA D5              11      PUSH    DE
000EFB 4EFB 2AE0F2          16      LD  HL,(DIRENT1)
000EFE 4EFE 111A00          10      LD  DE,0001AH   ;ファイルの先頭クラスタ
000F01 4F01 19              11      ADD HL,DE
000F02 4F02 CD8B43          17      CALL    RDSLT_ROM
000F05 4F05 23               6      INC HL
000F06 4F06 5F               4      LD  E,A
000F07 4F07 CD8B43          17      CALL    RDSLT_ROM
000F0A 4F0A 57               4      LD  D,A
000F0B 4F0B EB               4      EX  DE,HL
000F0C 4F0C D1              10      POP DE
                                #else
                                    LD  IY,(DIRENT1)
                                    BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
                                    JP  Z,ERROR_FILE_NOT_FOUND
                                    LD  L,(IY+01AH) ;ファイルの先頭クラスタ
                                    LD  H,(IY+01BH)
                                #endif
       4F0D                     CD2:
000F0D 4F0D 22DEF2          16      LD  (_CD),HL
000F10 4F10 2AE7F2          16      LD  HL,(PARAM1)
       4F13                     CD_SKIP:
000F13 4F13 7E               7      LD  A,(HL)
000F14 4F14 23               6      INC HL
000F15 4F15 FE21             7      CP  021H
000F17 4F17 38FA            12      JR  C,CD_SKIP
000F19 4F19 C9              10      RET
       4F1A                     CD1:
000F1A 4F1A 2AE9F2          16      LD  HL,(_CDX)
000F1D 4F1D 18EE            12      JR  CD2
                                
       4F1F                     GET_BASIC_FCB:
000F1F 4F1F D5              11      PUSH    DE
000F20 4F20 23               6      INC HL  ;+1
000F21 4F21 5E               7      LD  E,(HL)  ;FCB[1]
000F22 4F22 23               6      INC HL  ;+2
000F23 4F23 56               7      LD  D,(HL)  ;FCB[2]
000F24 4F24 23               6      INC HL  ;+3
000F25 4F25 ED53E0F2        20      LD  (DIRENT1),DE
                                            ;FCB[3]
000F29 4F29 23               6      INC HL  ;+4
                                            ;FCB[4]
000F2A 4F2A 23               6      INC HL  ;+5
000F2B 4F2B 7E               7      LD  A,(HL)  ;FCB[5]
000F2C 4F2C 23               6      INC HL  ;+6
000F2D 4F2D 32E2F2          13      LD  (_DIR_BANK),A
000F30 4F30 5E               7      LD  E,(HL)  ;FCB[6]
000F31 4F31 23               6      INC HL  ;+7
000F32 4F32 56               7      LD  D,(HL)  ;FCB[7]
000F33 4F33 23               6      INC HL  ;+8
000F34 4F34 ED53BDF2        20      LD  (RR_LOW),DE
000F38 4F38 7E               7      LD  A,(HL)  ;FCB[8]
000F39 4F39 23               6      INC HL  ;+9
000F3A 4F3A 32BFF2          13      LD  (RR_HIGH),A
000F3D 4F3D 7E               7      LD  A,(HL)  ;FCB[9]
000F3E 4F3E 23               6      INC HL  ;+10
000F3F 4F3F 22C7F2          16      LD  (_DTA),HL   ;FCB[10]
000F42 4F42 D1              10      POP DE
000F43 4F43 C9              10      RET
                                
       4F44                     SET_BASIC_FCB:
000F44 4F44 E5              11      PUSH    HL
000F45 4F45 2A64F8          16      LD  HL,(PTRFIL)
000F48 4F48 23               6      INC HL  ;+1
000F49 4F49 D5              11      PUSH    DE
000F4A 4F4A ED5BE0F2        20      LD  DE,(DIRENT1)
000F4E 4F4E 73               7      LD  (HL),E  ;FCB[1]
000F4F 4F4F 23               6      INC HL  ;+2
000F50 4F50 72               7      LD  (HL),D  ;FCB[2]
000F51 4F51 23               6      INC HL  ;+3
000F52 4F52 AF               4      XOR A
000F53 4F53 77               7      LD  (HL),A  ;FCB[3] backup char ハンドリング必要
000F54 4F54 23               6      INC HL  ;+4
                                            ;FCB[4] 変更しない
000F55 4F55 23               6      INC HL  ;+5
000F56 4F56 3AE2F2          13      LD  A,(_DIR_BANK)
000F59 4F59 77               7      LD  (HL),A  ;FCB[5]
000F5A 4F5A 23               6      INC HL  ;+6
000F5B 4F5B ED5BBDF2        20      LD  DE,(RR_LOW)
000F5F 4F5F 73               7      LD  (HL),E  ;FCB[6]
000F60 4F60 23               6      INC HL  ;+7
000F61 4F61 72               7      LD  (HL),D  ;FCB[7]
000F62 4F62 23               6      INC HL  ;+8
000F63 4F63 3ABFF2          13      LD  A,(RR_HIGH)
000F66 4F66 77               7      LD  (HL),A  ;FCB[8]
000F67 4F67 23               6      INC HL  ;+9
000F68 4F68 3600            10      LD  (HL),0  ;FCB[9]
000F6A 4F6A D1              10      POP DE
000F6B 4F6B E1              10      POP HL
000F6C 4F6C C9              10      RET
                                
       4F6D                     DEVICE_CHECK:
000F6D 4F6D 112B50          10      LD  DE,STR_A
000F70 4F70 CD0350          17      CALL    CPPROCNM
000F73 4F73 280A            12      JR  Z,DEVICE_OK
000F75 4F75 112D50          10      LD  DE,STR_ROM
000F78 4F78 CD0350          17      CALL    CPPROCNM
000F7B 4F7B 2802            12      JR  Z,DEVICE_OK
000F7D 4F7D 37               4      SCF
000F7E 4F7E C9              10      RET
       4F7F                     DEVICE_OK:
000F7F 4F7F AF               4      XOR A
000F80 4F80 C9              10      RET
                                
                                ;--------------------------------------
                                ;FUNC_0:open
                                ;in
                                ;   A : 0
                                ;   C : receive buffer size ?
                                ;   E : open mode
                                ;   HL: FCB pointer
                                ;out
                                ;   CF: 0=OK ,1=ERROR
                                ;note:
                                ;
                                ; FCB
                                ; +00: OPEN MODE
                                ; +01: 対象ファイルのディレクトリエントリのアドレスL
                                ; +02: 対象ファイルのディレクトリエントリのアドレスH
                                ; +03: backup charactor buffer
                                ; +04: device ID (FF=CAS,FE=LPT,FD=CRT,FC=?,other=ROM-SLOT)
                                ; +05: 対象ディレクトリのバンク
                                ; +06: ランダムレコードL
                                ; +07: ランダムレコードM
                                ; +08: ランダムレコードH
                                ; +09: バッファインデックス
                                ; +10: バッファ
                                
       4F81                     DEVICE_0_OPEN:
000F81 4F81 D5              11      PUSH    DE
000F82 4F82 E5              11      push    hl
                                ;
000F83 4F83 3E01             7      LD  A,1     ;ドライブA
000F85 4F85 32EBF2          13      LD  (FDRV),A
000F88 4F88 2166F8          10      LD  HL,FILNAM
000F8B 4F8B 11ECF2          10      LD  DE,FNAME
000F8E 4F8E 010B00          10      LD  BC,8+3
000F91 4F91 CDE555          17      CALL    INIT_FILE1
000F94 4F94 CDFB4B          17      CALL    ROM_OPEN
000F97 4F97 DA3446          10      JP  C,ERROR_FILE_NOT_FOUND
000F9A 4F9A E1              10      pop hl
000F9B 4F9B D1              10      POP DE
000F9C 4F9C 2264F8          16      ld  (PTRFIL),hl ;ストアしないとエラーになる
000F9F 4F9F 73               7      ld  (hl),e  ;FCB[0] ;open type : 合わせないとエラーになる
000FA0 4FA0 AF               4      XOR A
000FA1 4FA1 32E3F2          13      LD  (LEFTX),A
000FA4 4FA4 CD444F          17      CALL    SET_BASIC_FCB
000FA7 4FA7 7B               4      ld  a,e
000FA8 4FA8 FE08             7      cp  8
000FAA 4FAA 3F               4      ccf
000FAB 4FAB C9              10      ret
                                
       4FAC                     DEVICE_2_CLOSE:
000FAC 4FAC AF               4      XOR A
                                ;   LD  (HL),A
000FAD 4FAD 6F               4      LD  L,A
000FAE 4FAE 67               4      LD  H,A
000FAF 4FAF 2264F8          16      LD  (PTRFIL),HL
000FB2 4FB2 C9              10      RET
                                
       4FB3                     DEVICE_ENTRY:
000FB3 4FB3 FE08             7      CP  8
000FB5 4FB5 280C            12      JR  Z,DEVICE_8_SIN
000FB7 4FB7 3C               4      INC A
000FB8 4FB8 28B3            12      JR  Z,DEVICE_CHECK:
000FBA 4FBA 3D               4      DEC A
000FBB 4FBB 28C4            12      JR  Z,DEVICE_0_OPEN
000FBD 4FBD FE02             7      CP  2
000FBF 4FBF 28EB            12      JR  Z,DEVICE_2_CLOSE
000FC1 4FC1 37               4      SCF
000FC2 4FC2 C9              10      RET
                                
       4FC3                     DEVICE_8_SIN:
000FC3 4FC3 CD1F4F          17      CALL    GET_BASIC_FCB
000FC6 4FC6 E67F             7      AND 127
000FC8 4FC8 281D            12      JR  Z,SIN_READ_DISK
000FCA 4FCA 2AC7F2          16      LD  HL,(_DTA)
000FCD 4FCD 2B               6      DEC HL
000FCE 4FCE 34              11      INC (HL)
000FCF 4FCF 3C               4      INC A   ;(INC HL)
000FD0 4FD0 85               4      ADD A,L ;ADD HL,A
000FD1 4FD1 6F               4      LD  L,A ;
000FD2 4FD2 8C               4      ADC A,H ;
000FD3 4FD3 95               4      SUB L   ;
000FD4 4FD4 67               4      LD  H,A ;
       4FD5                     SIN_READ1:
000FD5 4FD5 7E               7      LD  A,(HL)
000FD6 4FD6 FE0A             7      CP  00AH
000FD8 4FD8 C8              11      RET Z   ;ZF=separate
000FD9 4FD9 FE1A             7      CP  01AH
000FDB 4FDB 2803            12      JR  Z,SIN_EOF
000FDD 4FDD 37               4      SCF
000FDE 4FDE 3F               4      CCF     ;ZF=0 CF=0にしたい
000FDF 4FDF C9              10      RET
       4FE0                     SIN_EOF:
000FE0 4FE0 2AC7F2          16      LD  HL,(_DTA)
000FE3 4FE3 2B               6      DEC HL
000FE4 4FE4 35              11      DEC (HL)
       4FE5                     SCF_RET:
000FE5 4FE5 37               4      SCF
000FE6 4FE6 C9              10      RET
                                
       4FE7                     SIN_READ_DISK:
000FE7 4FE7 218000          10      LD  HL,128
000FEA 4FEA CDC849          17      CALL    ROM_READ
000FED 4FED CD444F          17      CALL    SET_BASIC_FCB
000FF0 4FF0 7C               4      LD  A,H
000FF1 4FF1 B5               4      OR  L
000FF2 4FF2 28F1            12      JR  Z,SCF_RET
000FF4 4FF4 ED5BC7F2        20      LD  DE,(_DTA)
000FF8 4FF8 19              11      ADD HL,DE
000FF9 4FF9 361A            10      LD  (HL),01AH
000FFB 4FFB 2AC7F2          16      LD  HL,(_DTA)
000FFE 4FFE 2B               6      DEC HL
000FFF 4FFF 34              11      INC (HL)
001000 5000 23               6      INC HL
001001 5001 18D2            12      JR  SIN_READ1
                                
       5003                     CPPROCNM:
001003 5003 E5              11      PUSH    HL
001004 5004 2189FD          10      LD  HL,PROCNM
       5007                     CPPROCNM1:
001007 5007 1A               7      LD  A,(DE)
001008 5008 13               6      INC DE
001009 5009 BE               7      CP  (HL)
00100A 500A 23               6      INC HL
00100B 500B 2003            12      JR  NZ,CPPROCNM2
00100D 500D B7               4      OR  A
00100E 500E 20F7            12      JR  NZ,CPPROCNM1
       5010                     CPPROCNM2:
001010 5010 E1              10      POP HL
001011 5011 C9              10      RET
                                
       5012                     WILDCARD:
001012 5012 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       501D                     STR_CHDIR:
00101D 501D 434844495200            DB  "CHDIR",0
       5023                     STR_RAMDISK:
001023 5023 52414D4449534B00        DB  "RAMDISK",0
       502B                     STR_A:
00102B 502B 4100                    DB  "A",0
       502D                     STR_ROM:
00102D 502D 524F4D00                DB  "ROM",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       5031                     ERROR_WRITE_PROTECTED:
001031 5031 3E00             7      LD  A,0     ;Write protected
001033 5033 C9              10      RET
       5034                     DISKIO:
001034 5034 38FB            12      JR  C,ERROR_WRITE_PROTECTED
001036 5036 48               4      LD  C,B
001037 5037 CD1152          17      CALL    GET_DISK_BANK
       503A                     SETMAP1:        
00103A 503A E5              11      PUSH    HL
       503B                     DISKIO1:
00103B 503B C5              11      PUSH    BC      ;B=残りのセクタ数
00103C 503C D5              11      PUSH    DE      ;DE=セクタ番号
00103D 503D F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
00103E 503E EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
00103F 503F F5              11      PUSH    AF
001040 5040 3ABCF2          13      LD  A,(SECSZ_H)
001043 5043 CD3052          17      CALL    MUL_AHL
001046 5046 F1              10      POP AF
                                #if exists USE_MORMAL32K_OR_ASCII16
001047 5047 7D               4      LD  A,L
001048 5048 C5              11      PUSH    BC
001049 5049 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
00104C 504C 09              11      ADD HL,BC
00104D 504D C1              10      POP BC
00104E 504E 3013            12      JR  NC,DISKIO2
001050 5050 4D               4      LD  C,L     ;C=読み出し元
001051 5051 29              11      ADD HL,HL   ;64KB→32KB
001052 5052 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
001053 5053 CD0752          17      CALL    GET_DISK_BANK_FDRV
001056 5056 84               4      ADD A,H
001057 5057 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
00105A 505A 32B7F2          13      LD  (_BANK),A
00105D 505D 69               4      LD  L,C     ;C=読み出し元
00105E 505E 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
001060 5060 A5               4      AND L
001061 5061 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       5063                     DISKIO2:
001063 5063 C660             7      ADD A,high BANK1_ADR
001065 5065 67               4      LD  H,A
001066 5066 ED4BBBF2        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
00106A 506A 69               4      LD  L,C     ;C=0
00106B 506B CDF943          17      CALL    ROM_LDIR
00106E 506E EB               4      EX  DE,HL
00106F 506F F1              10      POP AF
001070 5070 D1              10      POP DE
001071 5071 13               6      INC DE
001072 5072 C1              10      POP BC
001073 5073 10C6            13      DJNZ    DISKIO1
001075 5075 41               4      LD  B,C
                                
001076 5076 E1              10      POP HL
001077 5077 AF               4      XOR A
                                
001078 5078 FB               4      EI
001079 5079 C9              10      RET
                                
       507A                     DSKCHG:
00107A 507A CDB350          17      CALL    IS_BPB
00107D 507D 3824            12      JR  C,NOTREADY
00107F 507F 3A23FB          13      LD  A,(DRVTBL+2)
001082 5082 B7               4      OR  A
001083 5083 201A            12      JR  NZ,DSKCHG1
001085 5085 3A21FB          13      LD  A,(DRVTBL)
001088 5088 FE02             7      CP  2
00108A 508A 2013            12      JR  NZ,DSKCHG1
00108C 508C CDB350          17      CALL    IS_BPB
00108F 508F 300E            12      JR  NC,DSKCHG1
001091 5091 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
001093 5093 3221FB          13      LD  (DRVTBL),A
001096 5096 3223FB          13      LD  (DRVTBL+2),A
001099 5099 3A48F3          13      LD  A,(MASTERS)
00109C 509C 3224FB          13      LD  (DRVTBL+3),A
       509F                     DSKCHG1:
00109F 509F AF               4      XOR A
0010A0 50A0 0601             7      LD  B,1
0010A2 50A2 C9              10      RET
       50A3                     NOTREADY:
0010A3 50A3 3E02             7      LD  A,2
0010A5 50A5 37               4      SCF
0010A6 50A6 C9              10      RET
                                
       50A7                     NO_BPB:
0010A7 50A7 E1              10      POP HL
0010A8 50A8 23               6      INC HL
0010A9 50A9 113652          10      LD  DE,DPB2DD
0010AC 50AC 011200          10      LD  BC,DPB2DD_E-DPB2DD
0010AF 50AF EDB0                    LDIR
0010B1 50B1 AF               4      XOR A
0010B2 50B2 C9              10      RET
                                
       50B3                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
0010B3 50B3 CD1152          17      CALL    GET_DISK_BANK
                                
0010B6 50B6 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
0010B9 50B9 FE01             7      CP  1
0010BB 50BB D8              11      RET C
                                
0010BC 50BC 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
0010BF 50BF C6FF             7      ADD A,0FFH
0010C1 50C1 D8              11      RET C
                                
0010C2 50C2 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
       50C5                     IS_BPB1:
0010C5 50C5 FE01             7      CP  1
0010C7 50C7 C8              11      RET Z
0010C8 50C8 FE02             7      CP  2
0010CA 50CA C8              11      RET Z
0010CB 50CB FE04             7      CP  4
0010CD 50CD C8              11      RET Z
0010CE 50CE 37               4      SCF
0010CF 50CF C9              10      RET
                                
       50D0                     GETDPB:
0010D0 50D0 E5              11      PUSH    HL
0010D1 50D1 CD1152          17      CALL    GET_DISK_BANK
                                
0010D4 50D4 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
0010D7 50D7 B7               4      OR  A
0010D8 50D8 28CD            12      JR  Z,NO_BPB
0010DA 50DA DDE1            14      POP IX
0010DC 50DC DD7701          19      LD  (IX+1),A        ;MEDIA
                                
0010DF 50DF 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
0010E2 50E2 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
0010E5 50E5 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
0010E8 50E8 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
0010EB 50EB 87               4      ADD A,A
0010EC 50EC 87               4      ADD A,A
0010ED 50ED 87               4      ADD A,A
0010EE 50EE 3D               4      DEC A
0010EF 50EF DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
0010F2 50F2 06FF             7      LD  B,-1
0010F4 50F4 A7               4      AND A           ;無限ループ阻止
       50F5                     GETDPB1:
0010F5 50F5 04               4      INC B
0010F6 50F6 1F               4      RRA
0010F7 50F7 38FC            12      JR  C,GETDPB1
0010F9 50F9 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
0010FC 50FC 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0010FF 50FF 3D               4      DEC A
001100 5100 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
001103 5103 A7               4      AND A           ;無限ループ阻止
001104 5104 06FF             7      LD  B,-1
       5106                     GETDPB2:
001106 5106 04               4      INC B
001107 5107 1F               4      RRA
001108 5108 38FC            12      JR  C,GETDPB2
00110A 510A 04               4      INC B
00110B 510B DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
00110E 510E 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
001111 5111 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
001114 5114 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
001117 5117 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
00111A 511A DD770A          19      LD  (IX+10),A       ;FATCNT
                                
00111D 511D 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
001120 5120 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
001123 5123 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
001127 5127 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
00112A 512A DD460A          19      LD  B,(IX+10)       ;FATCNT
00112D 512D 210000          10      LD  HL,0
       5130                     GETDPB3:
001130 5130 19              11      ADD HL,DE
001131 5131 10FD            13      DJNZ    GETDPB3
       5133                     GETDPB4:
001133 5133 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
001136 5136 DD5609          19      LD  D,(IX+9)        ;FIRFAT
001139 5139 19              11      ADD HL,DE
00113A 513A DD7511          19      LD  (IX+17),L       ;FIRDIR
00113D 513D DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
001140 5140 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001143 5143 87               4      ADD A,A
001144 5144 87               4      ADD A,A
001145 5145 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5148                     GETDPB5:
001148 5148 CB3B             8      SRL E
00114A 514A 1F               4      RRA
00114B 514B 30FB            12      JR  NC,GETDPB5
00114D 514D 1600             7      LD  D,0
00114F 514F 19              11      ADD HL,DE
001150 5150 DD750C          19      LD  (IX+12),L       ;FIRREC
001153 5153 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001156 5156 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
001159 5159 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
00115C 515C DD560D          19      LD  D,(IX+13)       ;FIRREC
00115F 515F A7               4      AND A
001160 5160 ED52            15      SBC HL,DE
                                
001162 5162 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
001165 5165 3C               4      INC A
001166 5166 37               4      SCF             ;無限ループ阻止
       5167                     GETDPB6:
001167 5167 1F               4      RRA
001168 5168 3806            12      JR  C,GETDPB7
00116A 516A CB3C             8      SRL H
00116C 516C CB1D             8      RR  L
00116E 516E 18F7            12      JR  GETDPB6
       5170                     GETDPB7:
001170 5170 23               6      INC HL
001171 5171 DD750E          19      LD  (IX+14),L       ;MAXCLUS
001174 5174 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       5177                     GETDPBD1:
001177 5177 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00117A 517A E6FC             7      AND 0FCH
00117C 517C C8              11      RET Z
                                
00117D 517D DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
001181 5181 37               4      SCF
001182 5182 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
001186 5186 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
001189 5189 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
00118D 518D DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001191 5191 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
001195 5195 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
001199 5199 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
00119D 519D DDCB1126        23      SLA (IX+17)         ;FIRDIR
0011A1 51A1 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
0011A5 51A5 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
0011A8 51A8 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
0011AB 51AB DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
0011AE 51AE 87               4      ADD A,A
0011AF 51AF 87               4      ADD A,A
0011B0 51B0 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       51B3                     GETDPBD5:
0011B3 51B3 CB3B             8      SRL E
0011B5 51B5 1F               4      RRA
0011B6 51B6 30FB            12      JR  NC,GETDPBD5
0011B8 51B8 1600             7      LD  D,0
0011BA 51BA 19              11      ADD HL,DE
0011BB 51BB DD750C          19      LD  (IX+12),L       ;FIRREC
0011BE 51BE DD740D          19      LD  (IX+13),H       ;FIRREC
                                
0011C1 51C1 18B4            12      JR  GETDPBD1
                                
       51C3                     CHOICE:
0011C3 51C3 210000          10      LD  HL,0
0011C6 51C6 C9              10      RET
                                
       51C7                     DSKFMT:
0011C7 51C7 AF               4      XOR A
0011C8 51C8 37               4      SCF
       51C9                     DSKSTP:
0011C9 51C9 C9              10      RET
                                
       51CA                     BASENT:
0011CA 51CA 2A74F6          16      LD  HL,(STKTOP)
0011CD 51CD 3A40F3          13      LD  A,(REBOOT)
0011D0 51D0 C6FF             7      ADD A,0FFH
0011D2 51D2 3811            12      JR  C,REBOOT1
0011D4 51D4 214852          10      LD  HL,AUTOEXEC
0011D7 51D7 11EBF2          10      LD  DE,FDRV
0011DA 51DA 010C00          10      LD  BC,1+8+3
0011DD 51DD EDB0                    LDIR
0011DF 51DF CDFB4B          17      CALL    ROM_OPEN
0011E2 51E2 D4C045          17      CALL    NC,ROM_LOAD1
       51E5                     REBOOT1:
0011E5 51E5 215452          10      LD  HL,CMD_RUN
0011E8 51E8 111FF4          10      LD  DE,KBUF
0011EB 51EB 010B00          10      LD  BC,CMD_RUN_E-CMD_RUN
0011EE 51EE D5              11      PUSH    DE
0011EF 51EF EDB0                    LDIR
0011F1 51F1 3004            12      JR  NC,REBOOT2
0011F3 51F3 AF               4      XOR A
0011F4 51F4 3227F4          13      LD  (KBUF+CMD_CLEAR_E-CMD_RUN),A
       51F7                     REBOOT2:
0011F7 51F7 E1              10      POP HL
0011F8 51F8 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0011FC 51FC DD210146        14      LD  IX,NEWSTT
001200 5200 C31C00          10      JP  _CALSLT
                                
       5203                     GETSLT:
001203 5203 3A22FB          13      LD  A,(DRVTBL+1)
001206 5206 C9              10      RET
                                
       5207                     GET_DISK_BANK_FDRV:
001207 5207 3AEBF2          13      LD  A,(FDRV)
00120A 520A D601             7      SUB 1
00120C 520C 3003            12      JR  NC,GET_DISK_BANK
00120E 520E 3ADDF2          13      LD  A,(_DVSW)
       5211                     GET_DISK_BANK:
001211 5211 B7               4      OR  A       ;A=DRIVE
001212 5212 3E01             7      LD  A,DISK_BANK
001214 5214 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001216 5216 3ADCF2          13      LD  A,(B_DRIVE)
                                #endif
       5219                     SET_DISK_BANK:
                                #if exists USE_MORMAL32K_OR_ASCII16
001219 5219 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
00121C 521C F5              11      PUSH    AF
00121D 521D E5              11      PUSH    HL
00121E 521E 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001221 5221 22BBF2          16      LD  (SECSZ),HL
001224 5224 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001227 5227 CD3052          17      CALL    MUL_AHL
00122A 522A 22B9F2          16      LD  (CLSZ),HL
00122D 522D E1              10      POP HL
00122E 522E F1              10      POP AF
00122F 522F C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5230                     MUL_AHL:
001230 5230 37               4      SCF     ;無限ループ回避
       5231                     MUL_AHL1:
001231 5231 1F               4      RRA     ;->CF
001232 5232 D8              11      RET C
001233 5233 29              11      ADD HL,HL
001234 5234 18FB            12      JR  MUL_AHL1
                                
       5236                     DPB2DD:
001236 5236 F9                      DB  0F9H    ;MEDIA
001237 5237 0002                    DW  00200H  ;SECSIZ
001239 5239 0F                      DB  00FH    ;DIRMSK
00123A 523A 04                      DB  004H    ;DIRSHFT
00123B 523B 01                      DB  001H    ;CLUSMSK
00123C 523C 02                      DB  002H    ;CLUSSHFT
00123D 523D 0100                    DW  00001H  ;FIRFAT
00123F 523F 02                      DB  002H    ;FATCNT
001240 5240 70                      DB  070H    ;MAXENT
001241 5241 0E00                    DW  0000EH  ;FIRREC
001243 5243 CA02                    DW  002CAH  ;MAXCLUS
001245 5245 03                      DB  003H    ;FATSIZ
001246 5246 0700                    DW  0007H   ;FIRDIR
       5248                     DPB2DD_E:
                                
       5248                     AUTOEXEC:
001248 5248 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       5254                     CMD_RUN:
001254 5254 3A920FC82C0C            DB  03AH,092H,00FH,200,',',00CH ;CLEAR200,&HF280
                                #if exists USE_MORMAL32K_OR_ASCII16
00125A 525A 80F2                    DW  0F280H
                                #else
                                    DW  0F240H
                                #endif
       525C                     CMD_CLEAR_E:
00125C 525C 3A8A00                  DB  03AH,08AH,0         ;RUN
       525F                     CMD_RUN_E:
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       525F                     POP_HL_ERROR:
00125F 525F E1              10      POP     HL
       5260                     _ERROR:
001260 5260 0600             7      LD  B,0
001262 5262 A7               4      AND A
001263 5263 C9              10      RET
                                
       5264                     ROM_BDOS:
001264 5264 E5              11      PUSH    HL
001265 5265 79               4      LD  A,C
001266 5266 87               4      ADD A,A
001267 5267 38F7            12      JR  C,_ERROR
001269 5269 6F               4      LD  L,A
00126A 526A 265F             7      LD  H,high STABLE
00126C 526C 7E               7      LD  A,(HL)
00126D 526D 2C               4      INC L
00126E 526E 66               7      LD  H,(HL)
00126F 526F 6F               4      LD  L,A
001270 5270 E3              19      EX  (SP),HL
001271 5271 79               4      LD  A,C
001272 5272 C9              10      RET
                                
       5273                     _PRINT:
       5273                     PRINT:
001273 5273 7B               4      LD  A,E
001274 5274 1803            12      JR  MSG_A
                                
       5276                     _SYS01:     ;(BDOS)コンソール入力
001276 5276 CDED52          17      CALL    _SYS07
       5279                     MSG_A:
001279 5279 FE03             7      CP  3
00127B 527B 2814            12      JR  Z,MSG_BR
       527D                     MSGA1:
00127D 527D F5              11      PUSH    AF
00127E 527E C5              11      PUSH    BC
00127F 527F D5              11      PUSH    DE
001280 5280 E5              11      PUSH    HL
001281 5281 DDE5            15      PUSH    IX
001283 5283 DD21A200        14      LD  IX,CHPUT
001287 5287 CDD642          17      CALL    CALSLT_R
00128A 528A DDE1            14      POP IX
00128C 528C E1              10      POP HL
00128D 528D D1              10      POP DE
00128E 528E C1              10      POP BC
       528F                     MSGA2:
00128F 528F F1              10      POP AF
001290 5290 C9              10      RET
       5291                     MSG_BR:
001291 5291 F5              11      PUSH    AF
001292 5292 3ADDF3          13      LD  A,(CSRX)
001295 5295 FE02             7      CP  2
001297 5297 38F6            12      JR  C,MSGA2
001299 5299 F1              10      POP AF
       529A                     MSG_CR:
00129A 529A F5              11      PUSH    AF
00129B 529B 3E0D             7      LD  A,00DH
00129D 529D CD7D52          17      CALL    MSGA1
0012A0 52A0 3E0A             7      LD  A,00AH
0012A2 52A2 CD7D52          17      CALL    MSGA1
0012A5 52A5 F1              10      POP AF
0012A6 52A6 C9              10      RET
                                
       52A7                     _SYS02:     ;(BDOS)コンソール出力
0012A7 52A7 CDC252          17      CALL    BREAK
0012AA 52AA 1805            12      JR  PRINTX
                                
       52AC                     _SYS06:     ;(BDOS)コンソール直接入出力
0012AC 52AC 7B               4      LD  A,E
0012AD 52AD 3C               4      INC A
0012AE 52AE CA0153          10      JP  Z,_INKEY
       52B1                     PRINTX:
0012B1 52B1 C37352          10      JP  _PRINT
                                
       52B4                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0012B4 52B4 CDED52          17      CALL    _SYS07
0012B7 52B7 FE03             7      CP  3
0012B9 52B9 CCC252          17      CALL    Z,_BREAK
0012BC 52BC FE13             7      CP  013H        ;CTRL+S
0012BE 52BE C0              11      RET NZ
       52BF                     PAUSE:
0012BF 52BF CDD952          17      CALL    KEYBC
                                
       52C2                     _BREAK:
       52C2                     BREAK:
0012C2 52C2 F5              11      PUSH    AF
0012C3 52C3 C5              11      PUSH    BC
0012C4 52C4 D5              11      PUSH    DE
0012C5 52C5 E5              11      PUSH    HL
0012C6 52C6 DDE5            15      PUSH    IX
0012C8 52C8 DD21B700        14      LD  IX,BREAKX
0012CC 52CC CDD642          17      CALL    CALSLT_R
0012CF 52CF DDE1            14      POP IX
0012D1 52D1 E1              10      POP HL
0012D2 52D2 D1              10      POP DE
0012D3 52D3 C1              10      POP BC
0012D4 52D4 DCC252          17      CALL    C,_BREAK
0012D7 52D7 F1              10      POP AF
0012D8 52D8 C9              10      RET
       52D9                     KEYBC:
0012D9 52D9 F5              11      PUSH    AF
0012DA 52DA C5              11      PUSH    BC
0012DB 52DB D5              11      PUSH    DE
0012DC 52DC E5              11      PUSH    HL
0012DD 52DD DDE5            15      PUSH    IX
0012DF 52DF DD215601        14      LD  IX,KILBUF
0012E3 52E3 CDD642          17      CALL    CALSLT_R
0012E6 52E6 DDE1            14      POP IX
0012E8 52E8 E1              10      POP HL
0012E9 52E9 D1              10      POP DE
0012EA 52EA C1              10      POP BC
0012EB 52EB F1              10      POP AF
0012EC 52EC C9              10      RET
                                
       52ED                     _SYS07:
       52ED                     FLGET:
0012ED 52ED C5              11      PUSH    BC
0012EE 52EE D5              11      PUSH    DE
0012EF 52EF E5              11      PUSH    HL
0012F0 52F0 DDE5            15      PUSH    IX
0012F2 52F2 DD219F00        14      LD  IX,CHGET
0012F6 52F6 CDD642          17      CALL    CALSLT_R
0012F9 52F9 DDE1            14      POP IX
0012FB 52FB E1              10      POP HL
0012FC 52FC D1              10      POP DE
0012FD 52FD C1              10      POP BC
0012FE 52FE FE03             7      CP  3
001300 5300 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5301                     _INKEY:
       5301                     INKEY:
001301 5301 CD9B53          17      CALL    CPM_CONST
001304 5304 C8              11      RET Z
001305 5305 18E6            12      JR  FLGET
                                
       5307                     _SYS0A:     ;(BDOS)文字列入力
001307 5307 C5              11      PUSH    BC
001308 5308 E5              11      PUSH    HL
001309 5309 D5              11      PUSH    DE
00130A 530A CD3353          17      CALL    GETL
00130D 530D 111FF4          10      LD  DE,KBUF
001310 5310 E1              10      POP HL
001311 5311 E5              11      PUSH    HL
001312 5312 0E00             7      LD  C,0
001314 5314 3004            12      JR  NC,SAX0
001316 5316 23               6      INC HL
001317 5317 23               6      INC HL
001318 5318 1808            12      JR  SAX4
       531A                     SAX0:
00131A 531A 46               7      LD  B,(HL)
00131B 531B 23               6      INC HL
       531C                     SAX1:
00131C 531C 23               6      INC HL
00131D 531D 1A               7      LD  A,(DE)
00131E 531E 13               6      INC DE
00131F 531F B7               4      OR  A
001320 5320 2004            12      JR  NZ,SAX2
       5322                     SAX4:
001322 5322 360D            10      LD  (HL),00DH
001324 5324 1804            12      JR  SAX3
       5326                     SAX2:
001326 5326 77               7      LD  (HL),A
001327 5327 0C               4      INC C
001328 5328 10F2            13      DJNZ    SAX1
       532A                     SAX3:
00132A 532A D1              10      POP DE
00132B 532B 79               4      LD  A,C
00132C 532C 13               6      INC DE
00132D 532D 12               7      LD  (DE),A
00132E 532E 1B               6      DEC DE
00132F 532F E1              10      POP HL
001330 5330 C1              10      POP BC
001331 5331 A7               4      AND A
001332 5332 C9              10      RET
       5333                     GETL:
001333 5333 DDE5            15      PUSH    IX
001335 5335 FDE5            15      PUSH    IY
                                
001337 5337 2ADCF3          16      LD  HL,(CSRY)
00133A 533A 22CAFB          16      LD  (FSTPOS),HL
       533D                     GETL1:
00133D 533D CDB452          17      CALL    _SYS08
001340 5340 FE09             7      CP  9
001342 5342 2008            12      JR  NZ,GETL1V
001344 5344 211FF4          10      LD  HL,KBUF
001347 5347 CD6043          17      CALL    MSX
00134A 534A 18F1            12      JR  GETL1
       534C                     GETL1V:
00134C 534C 5F               4      LD  E,A
00134D 534D FE08             7      CP  8
00134F 534F CCE953          17      CALL    Z,CTRL02
001352 5352 FE20             7      CP  020H
001354 5354 D41554          17      CALL    NC,INSERT
001357 5357 CD7D52          17      CALL    MSGA1
                                
00135A 535A 7B               4      LD  A,E
00135B 535B FE0D             7      CP  00DH
00135D 535D 20DE            12      JR  NZ,GETL1
                                
00135F 535F 111FF4          10      LD  DE,KBUF
001362 5362 3AB0F3          13      LD  A,(LINLEN)
001365 5365 47               4      LD  B,A
001366 5366 CDF455          17      CALL    ZERO_MEMORY_DE
                                
001369 5369 2ACAFB          16      LD  HL,(FSTPOS)
00136C 536C 3ADCF3          13      LD  A,(CSRY)
00136F 536F 6F               4      LD  L,A
001370 5370 E5              11      PUSH    HL
001371 5371 CD4654          17      CALL    LOC0
001374 5374 4D               4      LD  C,L
001375 5375 44               4      LD  B,H
001376 5376 E1              10      POP HL
001377 5377 3AB0F3          13      LD  A,(LINLEN)
00137A 537A 94               4      SUB H
00137B 537B 3D               4      DEC A
00137C 537C 5F               4      LD  E,A
00137D 537D 211FF4          10      LD  HL,KBUF
       5380                     GETL2:
001380 5380 CDD953          17      CALL    _SCRN
001383 5383 03               6      INC BC
001384 5384 77               7      LD  (HL),A
001385 5385 23               6      INC HL
001386 5386 1D               4      DEC E
001387 5387 20F7            12      JR  NZ,GETL2
001389 5389 CD9A52          17      CALL    MSG_CR
                                
00138C 538C FDE1            14      POP IY
00138E 538E DDE1            14      POP IX
       5390                     GETL3:
001390 5390 2B               6      DEC HL
001391 5391 7E               7      LD  A,(HL)
001392 5392 FE21             7      CP  021H
001394 5394 D0              11      RET NC
001395 5395 3600            10      LD  (HL),0
001397 5397 15               4      DEC D
001398 5398 20F6            12      JR  NZ,GETL3
00139A 539A C9              10      RET
                                
       539B                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       539B                     CONSTX:
       539B                     CPM_CONST:
00139B 539B C5              11      PUSH    BC
00139C 539C D5              11      PUSH    DE
00139D 539D E5              11      PUSH    HL
00139E 539E DDE5            15      PUSH    IX
0013A0 53A0 DD219C00        14      LD  IX,CHSNS
0013A4 53A4 CDD642          17      CALL    CALSLT_R
0013A7 53A7 DDE1            14      POP IX
0013A9 53A9 E1              10      POP HL
0013AA 53AA D1              10      POP DE
0013AB 53AB C1              10      POP BC
0013AC 53AC C9              10      RET
                                
       53AD                     _SYS2A:     ;(BDOS)日付の獲得
0013AD 53AD AF               4      XOR A
0013AE 53AE 57               4      LD  D,A
0013AF 53AF 5F               4      LD  E,A
0013B0 53B0 67               4      LD  H,A
0013B1 53B1 6F               4      LD  L,A
0013B2 53B2 C9              10      RET
                                
       53B3                     _SYS2C:     ;(BDOS)時刻の獲得
0013B3 53B3 AF               4      XOR A
0013B4 53B4 57               4      LD  D,A
0013B5 53B5 5F               4      LD  E,A
0013B6 53B6 67               4      LD  H,A
0013B7 53B7 6F               4      LD  L,A
0013B8 53B8 C9              10      RET
                                
       53B9                     POS:
0013B9 53B9 F5              11      PUSH    AF
0013BA 53BA 2ADCF3          16      LD  HL,(CSRY)
0013BD 53BD 7D               4      LD  A,L
0013BE 53BE 6C               4      LD  L,H
0013BF 53BF 67               4      LD  H,A
0013C0 53C0 2C               4      INC L
0013C1 53C1 24               4      INC H
0013C2 53C2 F1              10      POP AF
0013C3 53C3 C9              10      RET
                                
       53C4                     LOC:
0013C4 53C4 F5              11      PUSH    AF
0013C5 53C5 E5              11      PUSH    HL
0013C6 53C6 7D               4      LD  A,L
0013C7 53C7 6C               4      LD  L,H
0013C8 53C8 67               4      LD  H,A
0013C9 53C9 2D               4      DEC L
0013CA 53CA 25               4      DEC H
0013CB 53CB DDE5            15      PUSH    IX
0013CD 53CD DD21C600        14      LD  IX,POSIT
0013D1 53D1 CDD642          17      CALL    CALSLT_R
0013D4 53D4 DDE1            14      POP IX
0013D6 53D6 E1              10      POP HL
0013D7 53D7 F1              10      POP AF
0013D8 53D8 C9              10      RET
                                
       53D9                     _SCRN:
       53D9                     SCRN:
0013D9 53D9 E5              11      PUSH    HL
0013DA 53DA DDE5            15      PUSH    IX
                                
0013DC 53DC 69               4      LD  L,C
0013DD 53DD 60               4      LD  H,B
0013DE 53DE DD214A00        14      LD  IX,RDVRM
0013E2 53E2 CDD642          17      CALL    CALSLT_R
                                
0013E5 53E5 DDE1            14      POP IX
0013E7 53E7 E1              10      POP HL
0013E8 53E8 C9              10      RET
                                
       53E9                     CTRL02:
0013E9 53E9 F5              11      PUSH    AF
0013EA 53EA D5              11      PUSH    DE
0013EB 53EB 2ADCF3          16      LD  HL,(CSRY)
0013EE 53EE 3AB0F3          13      LD  A,(LINLEN)
0013F1 53F1 4F               4      LD  C,A
0013F2 53F2 94               4      SUB H   ;CSRX
0013F3 53F3 C602             7      ADD A,2
0013F5 53F5 47               4      LD  B,A ;カーソルより右の文字数
0013F6 53F6 61               4      LD  H,C ;LINLEN
0013F7 53F7 C5              11      PUSH    BC
0013F8 53F8 CD4654          17      CALL    LOC0
0013FB 53FB C1              10      POP BC
                                
0013FC 53FC 1620             7      LD  D,020H
       53FE                     C8X1:
0013FE 53FE DD214A00        14      LD  IX,RDVRM
001402 5402 CDD642          17      CALL    CALSLT_R
001405 5405 4F               4      LD  C,A
001406 5406 7A               4      LD  A,D
001407 5407 DD214D00        14      LD  IX,WRTVRM
00140B 540B CDD642          17      CALL    CALSLT_R
00140E 540E 2B               6      DEC HL
00140F 540F 51               4      LD  D,C
001410 5410 10EC            13      DJNZ    C8X1
001412 5412 D1              10      POP DE
001413 5413 F1              10      POP AF
001414 5414 C9              10      RET
                                
       5415                     INSERT:
001415 5415 F5              11      PUSH    AF
001416 5416 D5              11      PUSH    DE
001417 5417 2ADCF3          16      LD  HL,(CSRY)
00141A 541A 3AB0F3          13      LD  A,(LINLEN)
00141D 541D 4F               4      LD  C,A
00141E 541E 94               4      SUB H   ;CSRX
00141F 541F 3C               4      INC A
001420 5420 47               4      LD  B,A ;カーソルより右の文字数
001421 5421 C5              11      PUSH    BC
001422 5422 CD4654          17      CALL    LOC0
001425 5425 C1              10      POP BC
                                
001426 5426 1620             7      LD  D,020H
       5428                     INS1:
001428 5428 DD214A00        14      LD  IX,RDVRM
00142C 542C CDD642          17      CALL    CALSLT_R
00142F 542F 4F               4      LD  C,A
001430 5430 7A               4      LD  A,D
001431 5431 DD214D00        14      LD  IX,WRTVRM
001435 5435 CDD642          17      CALL    CALSLT_R
001438 5438 23               6      INC HL
001439 5439 51               4      LD  D,C
00143A 543A 10EC            13      DJNZ    INS1
00143C 543C D1              10      POP DE
00143D 543D F1              10      POP AF
00143E 543E C9              10      RET
                                
       543F                     CONOUT1:
00143F 543F 59               4      LD  E,C
001440 5440 C37352          10      JP  _PRINT
                                
       5443                     GETVRAM:
001443 5443 2ADCF3          16      LD  HL,(CSRY)
       5446                     LOC0:
001446 5446 2D               4      DEC L
001447 5447 25               4      DEC H
001448 5448 4C               4      LD  C,H ;CSRX-1
001449 5449 5D               4      LD  E,L ;CSRY-1
       544A                     LOC1:
00144A 544A 3AB0F3          13      LD  A,(LINLEN)
00144D 544D 67               4      LD  H,A
00144E 544E 1600             7      LD  D,0
001450 5450 6A               4      LD  L,D ;0
001451 5451 0608             7      LD  B,8
       5453                     LOC2:
001453 5453 29              11      ADD HL,HL
001454 5454 3001            12      JR  NC,LOC3
001456 5456 19              11      ADD HL,DE
       5457                     LOC3:
001457 5457 10FA            13      DJNZ    LOC2
001459 5459 09              11      ADD HL,BC
00145A 545A C9              10      RET
                                
       545B                     _SYS0C:     ;(BDOS)バージョン番号の獲得
00145B 545B 212200          10      LD  HL,00022H
00145E 545E AF               4      XOR A
00145F 545F 7D               4      LD  A,L
001460 5460 C9              10      RET
                                
       5461                     _SYS0D:     ;(BDOS)ディスク・リセット
001461 5461 218000          10      LD  HL,00080H
001464 5464 22C7F2          16      LD  (_DTA),HL
001467 5467 C9              10      RET
                                
       5468                     _SYS0E:     ;(BDOS)カレントドライブの設定
001468 5468 7B               4      LD  A,E
001469 5469 FE02             7      CP  2
00146B 546B D0              11      RET NC
00146C 546C 32DDF2          13      LD  (_DVSW),A
00146F 546F C9              10      RET
                                
       5470                     _SYS0F:     ;(BDOS)ファイルのオープン
001470 5470 D5              11      PUSH    DE
001471 5471 FDE1            14      POP IY
001473 5473 CDDE55          17      CALL    INIT_FILE
001476 5476 CDFB4B          17      CALL    ROM_OPEN
001479 5479 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
00147B 547B FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
00147F 547F FDE5            15      PUSH    IY
001481 5481 D1              10      POP DE
001482 5482 13               6      INC DE
001483 5483 010B00          10      LD  BC,11
001486 5486 EDB0                    LDIR
                                ;               Attribute
001488 5488 7E               7      LD  A,(HL)
001489 5489 FD770D          19      LD  (IY+13),A
                                ;               TIME
00148C 548C 110B00          10      LD  DE,11
00148F 548F 19              11      ADD HL,DE
001490 5490 7E               7      LD  A,(HL)
001491 5491 23               6      INC HL
001492 5492 FD7716          19      LD  (IY+22),A
001495 5495 7E               7      LD  A,(HL)
001496 5496 23               6      INC HL
001497 5497 FD7717          19      LD  (IY+23),A
                                ;               DATE
00149A 549A 7E               7      LD  A,(HL)
00149B 549B 23               6      INC HL
00149C 549C FD7714          19      LD  (IY+20),A
00149F 549F 7E               7      LD  A,(HL)
0014A0 54A0 23               6      INC HL
0014A1 54A1 FD7715          19      LD  (IY+21),A
                                ;               First cluster
0014A4 54A4 7E               7      LD  A,(HL)
0014A5 54A5 23               6      INC HL
0014A6 54A6 FD771A          19      LD  (IY+26),A
0014A9 54A9 7E               7      LD  A,(HL)
0014AA 54AA 23               6      INC HL
0014AB 54AB FD771B          19      LD  (IY+27),A
                                ;               SIZE
0014AE 54AE 7E               7      LD  A,(HL)
0014AF 54AF 23               6      INC HL
0014B0 54B0 FD7710          19      LD  (IY+16),A
0014B3 54B3 7E               7      LD  A,(HL)
0014B4 54B4 23               6      INC HL
0014B5 54B5 FD7711          19      LD  (IY+17),A
0014B8 54B8 7E               7      LD  A,(HL)
0014B9 54B9 23               6      INC HL
0014BA 54BA FD7712          19      LD  (IY+18),A
0014BD 54BD 7E               7      LD  A,(HL)
0014BE 54BE FD7713          19      LD  (IY+19),A
0014C1 54C1 AF               4      XOR A
0014C2 54C2 FD770C          19      LD  (IY+12),A
0014C5 54C5 C9              10      RET
                                
       54C6                     _SYS10:     ;(BDOS)ファイルのクローズ
0014C6 54C6 AF               4      XOR A
0014C7 54C7 C9              10      RET
                                
       54C8                     S11X1:
0014C8 54C8 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0014CB 54CB FD750E          19      LD  (IY+14),L
0014CE 54CE FD740F          19      LD  (IY+15),H
       54D1                     SCF_FF_RET:
0014D1 54D1 37               4      SCF
0014D2 54D2 9F               4      SBC A,A
0014D3 54D3 C9              10      RET
                                
       54D4                     _SYS11:     ;(BDOS)最初のファイルの検索
0014D4 54D4 ED53CAF2        20      LD  (_FCB),DE
0014D8 54D8 D5              11      PUSH    DE
0014D9 54D9 FDE1            14      POP IY
0014DB 54DB CDDE55          17      CALL    INIT_FILE
0014DE 54DE CD574E          17      CALL    GET_DIR_DAT
       54E1                     S12X1:
0014E1 54E1 CD174C          17      CALL    FILESE
0014E4 54E4 30E2            12      JR  NC,S11X1
0014E6 54E6 0D               4      DEC C
0014E7 54E7 FD7119          19      LD  (IY+25),C       ;RootEntCnt
0014EA 54EA FDCB0D66        20      BIT 4,(IY+13)
0014EE 54EE 2809            12      JR  Z,S12X2
0014F0 54F0 E5              11      PUSH    HL
0014F1 54F1 DDE1            14      POP IX
0014F3 54F3 DDCB0E66        20      BIT 4,(IX+1+13)
0014F7 54F7 28E8            12      JR  Z,S12X1
       54F9                     S12X2:
0014F9 54F9 012000          10      LD  BC,32
0014FC 54FC ED5BC7F2        20      LD  DE,(_DTA)
001500 5500 AF               4      XOR A
001501 5501 12               7      LD  (DE),A      ;ドライブ番号
001502 5502 13               6      INC DE
001503 5503 EDB0                    LDIR            ;ディレクトリエントリ
001505 5505 FD750E          19      LD  (IY+14),L
001508 5508 FD740F          19      LD  (IY+15),H
00150B 550B C9              10      RET
                                
       550C                     _SYS12:
00150C 550C FD2ACAF2        20      LD  IY,(_FCB)
001510 5510 FDE5            15      PUSH    IY
001512 5512 D1              10      POP DE
001513 5513 CDDE55          17      CALL    INIT_FILE
                                
001516 5516 FD6E0E          19      LD  L,(IY+14)
001519 5519 FD660F          19      LD  H,(IY+15)
00151C 551C FD4E19          19      LD  C,(IY+25)
00151F 551F 18C0            12      JR  S12X1
                                
       5521                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001521 5521 CD3D4E          17      CALL    SET_FCB
001524 5524 CD0B4E          17      CALL    GETSEQ
001527 5527 CDF84D          17      CALL    RB_READ
00152A 552A E5              11      PUSH    HL
00152B 552B CD184E          17      CALL    SETSEQ
00152E 552E E1              10      POP HL
       552F                     SREAD:
00152F 552F C601             7      ADD A,001H
001531 5531 D8              11      RET C
                                
001532 5532 7D               4      LD  A,L
001533 5533 D601             7      SUB 001H
001535 5535 9F               4      SBC A,A
001536 5536 E603             7      AND 3
001538 5538 1F               4      RRA
001539 5539 C9              10      RET
                                
       553A                     _SYS18:     ;(BDOS)ログインベクトルの獲得
00153A 553A 210100          10      LD  HL,00001H
00153D 553D AF               4      XOR A
00153E 553E C9              10      RET
                                
       553F                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
00153F 553F 3ADDF2          13      LD  A,(_DVSW)
001542 5542 C9              10      RET
                                
       5543                     _SYS1A:     ;(BDOS)DTAの設定
001543 5543 ED53C7F2        20      LD  (_DTA),DE
001547 5547 AF               4      XOR A
001548 5548 C9              10      RET
                                
       5549                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001549 5549 010002          10      LD  BC,512
00154C 554C 11C302          10      LD  DE,707
00154F 554F 210000          10      LD  HL,0
001552 5552 DD21CCF2        14      LD  IX,_BUF
001556 5556 FD21CCF2        14      LD  IY,_BUF
00155A 555A FD3600F9        19      LD  (IY+0),0F9H
00155E 555E 3E02             7      LD  A,2
001560 5560 C9              10      RET
                                
       5561                     _SYS21:     ;(BDOS)ランダムな読み出し
001561 5561 CD3D4E          17      CALL    SET_FCB
                                
001564 5564 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
001567 5567 FD6622          19      LD  H,(IY+34)
                                
00156A 556A CDF84D          17      CALL    RB_READ
00156D 556D 18C0            12      JR  SREAD
                                
       556F                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
00156F 556F CD7054          17      CALL    _SYS0F
001572 5572 D8              11      RET C
                                
001573 5573 D5              11      PUSH    DE      ;EX DE,IY
001574 5574 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001576 5576 CD2D4E          17      CALL    GETSIZE
       5579                     _S24X1:
001579 5579 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
00157C 557C FD7422          19      LD  (IY+34),H
00157F 557F FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
001583 5583 FDE3            23      EX  (SP),IY     ;
001585 5585 D1              10      POP DE      ;
                                
001586 5586 AF               4      XOR A
001587 5587 C9              10      RET
                                
       5588                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
001588 5588 E5              11      PUSH    HL
001589 5589 D5              11      PUSH    DE      ;EX DE,IY
00158A 558A FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00158C 558C CD0B4E          17      CALL    GETSEQ
00158F 558F 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5591                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001591 5591 CD3D4E          17      CALL    SET_FCB
001594 5594 E5              11      PUSH    HL
001595 5595 FD6E21          19      LD  L,(IY+33)
001598 5598 FD6622          19      LD  H,(IY+34)
00159B 559B 22BDF2          16      LD  (RR_LOW),HL
00159E 559E FD6E23          19      LD  L,(IY+35)
0015A1 55A1 FD6624          19      LD  H,(IY+36)
0015A4 55A4 22BFF2          16      LD  (RR_HIGH),HL
0015A7 55A7 E1              10      POP HL
0015A8 55A8 CDC849          17      CALL    ROM_READ
0015AB 55AB ED5BBDF2        20      LD  DE,(RR_LOW)
0015AF 55AF FD7321          19      LD  (IY+33),E
0015B2 55B2 FD7222          19      LD  (IY+34),D
0015B5 55B5 ED5BBFF2        20      LD  DE,(RR_HIGH)
0015B9 55B9 FD7323          19      LD  (IY+35),E
0015BC 55BC FD7224          19      LD  (IY+36),D
0015BF 55BF 9F               4      SBC A,A
0015C0 55C0 C9              10      RET
                                
       55C1                     _SYS2F:
0015C1 55C1 44               4      LD  B,H
0015C2 55C2 2AC7F2          16      LD  HL,(_DTA)
0015C5 55C5 C33450          10      JP  DISKIO
                                
       55C8                     _SYS5A:
0015C8 55C8 0600             7      LD  B,0
0015CA 55CA D5              11      PUSH    DE
0015CB 55CB DDE1            14      POP IX
       55CD                     _SX5A1:
0015CD 55CD 1A               7      LD  A,(DE)
0015CE 55CE B7               4      OR  A
0015CF 55CF 2804            12      JR  Z,_SX5A2
0015D1 55D1 13               6      INC DE
0015D2 55D2 04               4      INC B
0015D3 55D3 18F8            12      JR  _SX5A1
                                
       55D5                     _SX5A2:
0015D5 55D5 78               4      LD  A,B
0015D6 55D6 CD934A          17      CALL    FILE_BDOS
0015D9 55D9 CDDE4E          17      CALL    ROM_CD
0015DC 55DC 9F               4      SBC A,A
0015DD 55DD C9              10      RET
                                
       55DE                     INIT_FILE:
0015DE 55DE EB               4      EX  DE,HL
0015DF 55DF 11EBF2          10      LD  DE,FDRV
0015E2 55E2 010C00          10      LD  BC,1+8+3
       55E5                     INIT_FILE1:
0015E5 55E5 EDB0                    LDIR
0015E7 55E7 CD0752          17      CALL    GET_DISK_BANK_FDRV
                                #if exists USE_MORMAL32K_OR_ASCII16
0015EA 55EA 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0015ED 55ED 2ADEF2          16      LD  HL,(_CD)
0015F0 55F0 22E9F2          16      LD  (_CDX),HL           ;カレントディレクトリ
0015F3 55F3 C9              10      RET
                                
       55F4                     ZERO_MEMORY_DE:
0015F4 55F4 AF               4      XOR A
       55F5                     FILL_MEMORY_DE:
0015F5 55F5 12               7      LD  (DE),A
0015F6 55F6 13               6      INC DE
0015F7 55F7 10FC            13      DJNZ    FILL_MEMORY_DE
0015F9 55F9 C9              10      RET
                                
0015FA 55FA                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 60527652A7526052        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 60526052AC52ED52        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 B452605207539B53        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 5B54615468547054        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 C654D4540C556052        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 2155605260526052        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 3A553F5543554955        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 6052605260526F55        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 8855605260529155        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 60526052AD536052        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 B35360526052C155        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 60526052C8556052        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 6052605260526052        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM.ASM:UTF_8]
[EOF:DISKROM32.ASM:UTF_8]
