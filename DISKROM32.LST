                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB20                     HOKVLD  EQU 0FB20H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
       FFCA                     EXTBIO  EQU 0FFCAH
                                
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 534E                    DW  STATEMENT  ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3F44E          10      JP  DISKIO
000013 4013 C33A4F          10      JP  DSKCHG
000016 4016 C3904F          10      JP  GETDPB
000019 4019 C38350          10      JP  CHOICE
00001C 401C C38750          10      JP  DSKFMT
00001F 401F C38950          10      JP  DSKSTP
000022 4022 C38A50          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C38750          10      JP  DSKFMT
000029 4029 C38950          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C39150          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.1",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3100    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2260F1          16      LD  (BASSTK),HL
000129 4129 ED7B60F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210643          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017D00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4642          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DBFE          13      LD  (H_STKE+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 21B745          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 21E946          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 21F646          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 21DB50          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AD43          10      LD  HL,ROM_STKE
0001BC 41BC 22DCFE          16      LD  (H_STKE+2),HL
0001BF 41BF 21F44E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DEFE          13      LD  (H_STKE+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
0001E5 41E5 284E            12      JR  Z,NOT_BANK_TYPE
0001E7 41E7 3E01             7      LD  A,DISK_BANK
0001E9 41E9 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001EC 41EC CD3801          17      CALL    RSLREG      ;read primary slot #
0001EF 41EF 07               4      RLCA
0001F0 41F0 07               4      RLCA
0001F1 41F1 F5              11      PUSH    AF
0001F2 41F2 1605             7      LD  D,4+1
0001F4 41F4 CD4D42          17      CALL    GTSL2_
0001F7 41F7 3244F3          13      LD  (RAMAD3),A
0001FA 41FA F1              10      POP AF
0001FB 41FB 07               4      RLCA
0001FC 41FC 07               4      RLCA
0001FD 41FD 1603             7      LD  D,2+1
0001FF 41FF CD4D42          17      CALL    GTSL2_
000202 4202 2680             7      LD  H,080H
000204 4204 CD6A42          17      CALL    CHK_RAM
000207 4207 3243F3          13      LD  (RAMAD2),A
       420A                     RAMCHK2:
00020A 420A 3A44F3          13      LD  A,(RAMAD3)
00020D 420D 2640             7      LD  H,040H
00020F 420F CD6A42          17      CALL    CHK_RAM
000212 4212 3242F3          13      LD  (RAMAD1),A
       4215                     RAMCHK1:
000215 4215 3A44F3          13      LD  A,(RAMAD3)
000218 4218 2600             7      LD  H,00H
00021A 421A CD6A42          17      CALL    CHK_RAM
00021D 421D 3241F3          13      LD  (RAMAD0),A
       4220                     RAMCHK0:
000220 4220 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000223 4223 010F00          10      LD  BC,0000FH       ;切り上げ
000226 4226 09              11      ADD HL,BC
000227 4227 7D               4      LD  A,L
                                
000228 4228 0604             7      LD  B,4
       422A                     B_DRIVE1:
00022A 422A CB3C             8      SRL H
00022C 422C 1F               4      RRA
00022D 422D 10FB            13      DJNZ    B_DRIVE1
                                
00022F 422F C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000231 4231 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000234 4234 C9              10      RET
                                
       4235                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000235 4235 21F243          10      LD  HL,MSG_ERROR_ROM_MODE
000238 4238 CD8643          17      CALL    MSX
00023B 423B FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00023F 423F DD219F00        14      LD  IX,CHGET
000243 4243 C31C00          10      JP  _CALSLT
                                
       4246                     GTSL1_:             ;自分のいるスロットを知る
000246 4246 CD3801          17      CALL    RSLREG      ;read primary slot #
000249 4249 0F               4      RRCA
00024A 424A 0F               4      RRCA
00024B 424B 1601             7      LD  D,1
       424D                     GTSL2_:
00024D 424D E603             7      AND 3       ;[A]=000000PP
00024F 424F 5F               4      LD  E,A     ;[E]=000000PP
000250 4250 21C1FC          10      LD  HL,EXPTBL
000253 4253 85               4      ADD A,L     ;桁上りは無い
000254 4254 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000255 4255 7B               4      LD  A,E     ;[A]=000000PP
000256 4256 CB7E            13      BIT 7,(HL)
000258 4258 C8              11      RET Z
000259 4259 7D               4      LD  A,L     ;point to SLTTBL entry
00025A 425A C604             7      ADD A,4     ;桁上りは無い
00025C 425C 6F               4      LD  L,A
00025D 425D 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425E                     GTSL3_:
00025E 425E 15               4      DEC D
00025F 425F 2803            12      JR  Z,GTSL4_:
000261 4261 0F               4      RRCA
000262 4262 18FA            12      JR  GTSL3_:
       4264                     GTSL4_:
000264 4264 E60C             7      AND 00CH        ;[A] = 0000SS00
000266 4266 B3               4      OR  E       ;[A] = 0000SSPP
000267 4267 F680             7      OR  080H        ;[A] = 1000SSPP
000269 4269 C9              10      RET
                                
       426A                     CHK_RAM:
00026A 426A E5              11      PUSH    HL
00026B 426B CDBF42          17      CALL    CHK_RAM0
00026E 426E E1              10      POP HL
00026F 426F C8              11      RET Z
000270 4270 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000273 4273 E680             7      AND 080H
000275 4275 CD9642          17      CALL    CHK_RAM_SLT
000278 4278 C8              11      RET Z
000279 4279 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027C 427C E680             7      AND 080H
00027E 427E C601             7      ADD A,1
000280 4280 CD9642          17      CALL    CHK_RAM_SLT
000283 4283 C8              11      RET Z
000284 4284 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000287 4287 E680             7      AND 080H
000289 4289 C602             7      ADD A,2
00028B 428B CD9642          17      CALL    CHK_RAM_SLT
00028E 428E C8              11      RET Z
00028F 428F 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000292 4292 E680             7      AND 080H
000294 4294 C603             7      ADD A,3
       4296                     CHK_RAM_SLT:
000296 4296 E5              11      PUSH    HL
000297 4297 CDBF42          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029A 429A E1              10      POP HL
00029B 429B C8              11      RET Z
00029C 429C CB79             8      BIT 7,C
00029E 429E 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A0 42A0 79               4      LD  A,C
0002A1 42A1 C604             7      ADD A,4*1           ;スロット#X-1
0002A3 42A3 E5              11      PUSH    HL
0002A4 42A4 CDBF42          17      CALL    CHK_RAM0
0002A7 42A7 E1              10      POP HL
0002A8 42A8 C8              11      RET Z
0002A9 42A9 79               4      LD  A,C
0002AA 42AA C608             7      ADD A,4*2           ;スロット#X-2
0002AC 42AC E5              11      PUSH    HL
0002AD 42AD CDBF42          17      CALL    CHK_RAM0
0002B0 42B0 E1              10      POP HL
0002B1 42B1 C8              11      RET Z
0002B2 42B2 79               4      LD  A,C
0002B3 42B3 C60C             7      ADD A,4*3           ;スロット#X-3
0002B5 42B5 E5              11      PUSH    HL
0002B6 42B6 CDBF42          17      CALL    CHK_RAM0
0002B9 42B9 E1              10      POP HL
       42BA                     CHK_RAM_E:
0002BA 42BA AF               4      XOR A
0002BB 42BB 3C               4      INC A           ;ZF=0にする
0002BC 42BC 3E00             7      LD  A,0
0002BE 42BE C9              10      RET
                                
       42BF                     CHK_RAM0:
0002BF 42BF 4F               4      LD  C,A
0002C0 42C0 3A00F1          13      LD  A,(ROM_SLT)
0002C3 42C3 B9               4      CP  C
0002C4 42C4 28F4            12      JR  Z,CHK_RAM_E
0002C6 42C6 2E00             7      LD  L,0
       42C8                     CHK_RAM1:
0002C8 42C8 79               4      LD  A,C
0002C9 42C9 DD210C00        14      LD  IX,_RDSLT
0002CD 42CD CDFA42          17      CALL    CALSLT_R
0002D0 42D0 C6E5             7      ADD A,0E5H
0002D2 42D2 47               4      LD  B,A
0002D3 42D3 5F               4      LD  E,A
0002D4 42D4 79               4      LD  A,C
0002D5 42D5 DD211400        14      LD  IX,_WRSLT
0002D9 42D9 CDFA42          17      CALL    CALSLT_R
0002DC 42DC 79               4      LD  A,C
0002DD 42DD DD210C00        14      LD  IX,_RDSLT
0002E1 42E1 CDFA42          17      CALL    CALSLT_R
0002E4 42E4 B8               4      CP  B
0002E5 42E5 C0              11      RET NZ
0002E6 42E6 D6E5             7      SUB 0E5H
0002E8 42E8 79               4      LD  A,C
0002E9 42E9 5F               4      LD  E,A
0002EA 42EA DD211400        14      LD  IX,_WRSLT
0002EE 42EE CDFA42          17      CALL    CALSLT_R
0002F1 42F1 24               4      INC H
0002F2 42F2 7D               4      LD  A,L
0002F3 42F3 C604             7      ADD A,4
0002F5 42F5 6F               4      LD  L,A
0002F6 42F6 20D0            12      JR  NZ,CHK_RAM1
0002F8 42F8 79               4      LD  A,C     ;ZF=1のハズ
0002F9 42F9 C9              10      RET
                                
       42FA                     CALSLT_R:
0002FA 42FA C5              11      PUSH    BC
0002FB 42FB E5              11      PUSH    HL
0002FC 42FC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000300 4300 CD1C00          17      CALL    _CALSLT
000303 4303 E1              10      POP HL
000304 4304 C1              10      POP BC
000305 4305 C9              10      RET
                                
       4306                     AT_ISC:
000306 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000306 F0E9 FEB7             7      CP  0B7H            ;FILES
000308 F0EB CC7BFE          17      CALL    Z,H_FILE
00030B F0EE FEB5             7      CP  0B5H            ;LOAD
00030D F0F0 CA71FE          10      JP  Z,H_BINS
000310 F0F3 FE8A             7      CP  08AH            ;RUN
000312 F0F5 CA76FE          10      JP  Z,H_BINL
000315 F0F8 FED6             7      CP  0D6H            ;COPY
000317 F0FA 2813            12      JR  Z,FIX_COPY
000319 F0FC FECF             7      CP  0CFH            ;BLOAD
00031B F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031C F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031D F100 00                      DB  0
00031E F101 1F46                    DW  ROM_BLOAD
000320 F103 F5              11      PUSH    AF
000321 F104 E5              11      PUSH    HL
000322 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000325 F108 E1              10      POP HL
000326 F109 F1              10      POP AF
000327 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
000329 F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032B F10E C9              10      RET
       F10F                     FIX_COPY:
00032C F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032D F110 00                      DB  0
00032E F111 7C47                    DW  ROM_COPY
000330 F113 C9              10      RET
       F114                     ROMUSE1:
000331 F114 3A00F1          13      LD  A,(ROM_SLT)
000334 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000336 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
000339 F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033C F11F 00                      DB  0
       F120                     _BANK:
00033D F120 00                      DB  0
       F121                     _BANK1:
00033E F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
00033F F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000341 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000343 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000345 F128 0000                    DW  0
       F12A                     _CLPS:
000347 F12A 0000                    DW  0
       F12C                     _LEFT:
000349 F12C 0000                    DW  0
       F12E                     _DTPS:
00034B F12E 0000                    DW  0
       F130                     _DTA:
00034D F130 0000                    DW  0
       F132                     FLG_LDIR:
00034F F132 00                      DB  0
       F133                     _FCB:
000350 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000352 F135 00                      DB  0
       F136                     _BUF_ST:
000353 F136 0000                    DW  0
       F138                     _BUF_EN:
000355 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000357 F13A 0000                    DW  0
       F13C                     _BUF_H:
000359 F13C 0000                    DW  0
       F13E                     _BUF_X:
00035B F13E 0000                    DW  0
       F140                     _BUF_Y:
00035D F140 00                      DB  0
       F141                     _BUF_P:
00035E F141 00                      DB  0
       F142                     _BUF_O:
00035F F142 00                      DB  0
       F143                     DTAX:
000360 F143 0000                    DW  0
       F145                     B_DRIVE:
000362 F145 00                      DB  0
       F146                     _DVSW:
000363 F146 00                      DB  0
       F147                     DIRENT1:
000364 F147 0000                    DW  0
       F149                     _DIR_BANK:
000366 F149 00                      DB  0
       F14A                     LEFTX:
000367 F14A 0000                    DW  0
       F14C                     PARAM0:
000369 F14C 0000                    DW  0
       F14E                     PARAM1:
00036B F14E 0000                    DW  0
       F150                     FDRV:
00036D F150 00                      DB  0
       F151                     FNAME:
00036E F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
000379 F15C 0000                    DW  0
       F15E                     _CDX:
00037B F15E 0000                    DW  0
       F160                     BASSTK:
00037D F160 0000                    DW  0
       F162                     _HL:
00037F F162 0000                    DW  0
       F164                     _SP:
000381 F164 0000                    DW  0
                                
       F166                     ISC_E:
000383 4383                         ORG $$+RUN          ;$DEPHASE
                                
       4383                     MSX1:
000383 4383 CDF450          17      CALL    MSGA1
       4386                     MSX:
000386 4386 7E               7      LD  A,(HL)
000387 4387 23               6      INC HL
000388 4388 B7               4      OR  A
000389 4389 20F8            12      JR  NZ,MSX1
00038B 438B C9              10      RET
                                
       438C                     PRTHX:
00038C 438C F5              11      PUSH    AF
00038D 438D 07               4      RLCA
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 07               4      RLCA
000391 4391 CD9543          17      CALL    PRTA2
000394 4394 F1              10      POP AF
       4395                     PRTA2:
000395 4395 CD9B43          17      CALL    ASC
000398 4398 C3F050          10      JP  MSG_A
                                    
       439B                     ASC:
00039B 439B E60F             7      AND $0F
00039D 439D F630             7      OR  $30
00039F 439F FE3A             7      CP  $3A
0003A1 43A1 D8              11      RET C
0003A2 43A2 C607             7      ADD A,7
0003A4 43A4 C9              10      RET
                                
       43A5                     MSN:
0003A5 43A5 7E               7      LD  A,(HL)
0003A6 43A6 23               6      INC HL
0003A7 43A7 CDF050          17      CALL    MSG_A
0003AA 43AA 10F9            13      DJNZ    MSN
0003AC 43AC C9              10      RET
                                
       43AD                     ROM_STKE:
0003AD 43AD 3E                      DB  03EH
0003AE 43AE C9              10      RET
0003AF 43AF 32DAFE          13      LD  (H_STKE),A
0003B2 43B2 E5              11      PUSH    HL
0003B3 43B3 D5              11      PUSH    DE
0003B4 43B4 C5              11      PUSH    BC
                                
0003B5 43B5 AF               4      XOR A
0003B6 43B6 5F               4      LD  E,A
0003B7 43B7 57               4      LD  D,A
0003B8 43B8 0601             7      LD  B,1
0003BA 43BA 2100C0          10      LD  HL,0C000H
0003BD 43BD CDF44E          17      CALL    DISKIO
                                
0003C0 43C0 ED7360F1        20      LD  (BASSTK),SP
0003C4 43C4 116BF3          10      LD  DE,RAMUSE
0003C7 43C7 AF               4      XOR A
0003C8 43C8 CD1EC0          17      CALL    0C01EH
                                ;   LD  DE,RAMUSE
                                ;   SCF
                                ;   CALL    0C01EH
       43CB                     BASAUTO:
0003CB 43CB 210F44          10      LD  HL,AUTOEXEC
0003CE 43CE 1150F1          10      LD  DE,FDRV
0003D1 43D1 010C00          10      LD  BC,1+8+3
0003D4 43D4 EDB0                    LDIR
0003D6 43D6 CDB74B          17      CALL    ROM_OPEN
0003D9 43D9 3813            12      JR  C,RSTKEE
0003DB 43DB 211B44          10      LD  HL,RUN_AUTOEXEC
0003DE 43DE 11F0FB          10      LD  DE,KEYBUF
0003E1 43E1 ED53FAF3        20      LD  (GETPNT),DE
0003E5 43E5 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003E8 43E8 EDB0                    LDIR
0003EA 43EA ED53F8F3        20      LD  (PUTPNT),DE
       43EE                     RSTKEE:
0003EE 43EE C1              10      POP BC
0003EF 43EF D1              10      POP DE
0003F0 43F0 E1              10      POP HL
0003F1 43F1 C9              10      RET
                                
       43F2                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
0003F2 43F2 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
       440E                     NULL:
00040E 440E 00                      DB  0
                                
       440F                     AUTOEXEC:
00040F 440F 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       441B                     RUN_AUTOEXEC:
00041B 441B 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       442E                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       442E                     ROM_LDIR:
00042E 442E 3A32F1          13      LD  A,(FLG_LDIR)
000431 4431 B7               4      OR  A
000432 4432 2064            12      JR  NZ,ROM_LDIRVM
000434 4434 CB7A             8      BIT 7,D
000436 4436 CAC144          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
       4439                     LDIRA:
000439 4439 F3               4      DI
00043A 443A ED7364F1        20      LD  (_SP),SP
00043E 443E 3121FB          10      LD  SP,DRVTBL
       4441                     LDIR1:
000441 4441 78               4      LD  A,B
000442 4442 B1               4      OR  C
000443 4443 284D            12      JR  Z,LDIRE
                                
000445 4445 C5              11      PUSH    BC
000446 4446 D5              11      PUSH    DE
000447 4447 E5              11      PUSH    HL
000448 4448 3A00F1          13      LD  A,(ROM_SLT)
00044B 444B 2680             7      LD  H,080H
00044D 444D CD2400          17      CALL    _ENASLT
000450 4450 E1              10      POP HL
000451 4451 D1              10      POP DE
000452 4452 C1              10      POP BC
       4453                     LDIR2:
000453 4453 7A               4      LD  A,D
000454 4454 FEC0             7      CP  0C0H
000456 4456 302C            12      JR  NC,LDIR4
                                
000458 4458 C5              11      PUSH    BC
000459 4459 D5              11      PUSH    DE
00045A 445A 115EF5          10      LD  DE,BUF
                                
00045D 445D 78               4      LD  A,B
00045E 445E B7               4      OR  A
00045F 445F 2803            12      JR  Z,LDIR3
000461 4461 010001          10      LD  BC,00100H
       4464                     LDIR3:
000464 4464 C5              11      PUSH    BC
000465 4465 EDB0                    LDIR
000467 4467 2262F1          16      LD  (_HL),HL
                                
00046A 446A 3A43F3          13      LD  A,(RAMAD2)
00046D 446D 2680             7      LD  H,080H
00046F 446F CD2400          17      CALL    _ENASLT
                                
000472 4472 C1              10      POP BC
000473 4473 D1              10      POP DE
000474 4474 215EF5          10      LD  HL,BUF
000477 4477 EDB0                    LDIR
                                
000479 4479 2A62F1          16      LD  HL,(_HL)
00047C 447C C1              10      POP BC
00047D 447D 78               4      LD  A,B
00047E 447E B7               4      OR  A
00047F 447F 2811            12      JR  Z,LDIRE
000481 4481 05               4      DEC B
000482 4482 18BD            12      JR  LDIR1
       4484                     LDIR4:
                                #endif
000484 4484 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       4486                     LDIRE2:
000486 4486 D5              11      PUSH    DE
000487 4487 E5              11      PUSH    HL
000488 4488 3A43F3          13      LD  A,(RAMAD2)
00048B 448B 2680             7      LD  H,080H
00048D 448D CD2400          17      CALL    _ENASLT
000490 4490 E1              10      POP HL
000491 4491 D1              10      POP DE
       4492                     LDIRE:
000492 4492 ED7B64F1        20      LD  SP,(_SP)
000496 4496 FB               4      EI
                                #endif
000497 4497 C9              10      RET
                                
       4498                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
000498 4498 F3               4      DI
000499 4499 ED7364F1        20      LD  (_SP),SP
00049D 449D 3121FB          10      LD  SP,DRVTBL
0004A0 44A0 C5              11      PUSH    BC
0004A1 44A1 D5              11      PUSH    DE
0004A2 44A2 E5              11      PUSH    HL
0004A3 44A3 3A00F1          13      LD  A,(ROM_SLT)
0004A6 44A6 2680             7      LD  H,080H
0004A8 44A8 CD2400          17      CALL    _ENASLT
0004AB 44AB E1              10      POP HL
0004AC 44AC D1              10      POP DE
0004AD 44AD C1              10      POP BC
                                #endif
0004AE 44AE C5              11      PUSH    BC
0004AF 44AF D5              11      PUSH    DE
0004B0 44B0 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0004B4 44B4 DD215C00        14      LD  IX,LDIRVM
0004B8 44B8 CD1C00          17      CALL    _CALSLT
0004BB 44BB E1              10      POP HL
0004BC 44BC C1              10      POP BC
0004BD 44BD 09              11      ADD HL,BC
0004BE 44BE EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
0004BF 44BF 18C5            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       44C1                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
0004C1 44C1 F3               4      DI
0004C2 44C2 ED7364F1        20      LD  (_SP),SP
0004C6 44C6 3121FB          10      LD  SP,DRVTBL
0004C9 44C9 C5              11      PUSH    BC
0004CA 44CA D5              11      PUSH    DE
0004CB 44CB E5              11      PUSH    HL
0004CC 44CC 3A00F1          13      LD  A,(ROM_SLT)
0004CF 44CF 2680             7      LD  H,080H
0004D1 44D1 CD2400          17      CALL    _ENASLT
0004D4 44D4 E1              10      POP HL
0004D5 44D5 D1              10      POP DE
0004D6 44D6 C1              10      POP BC
                                #endif
       44D7                     ROM_LDIRSLT1:
0004D7 44D7 EB               4      EX  DE,HL
       44D8                     RLDIRSLT1:
0004D8 44D8 1A               7      LD  A,(DE)
0004D9 44D9 13               6      INC DE
0004DA 44DA C5              11      PUSH    BC
0004DB 44DB D5              11      PUSH    DE
0004DC 44DC E5              11      PUSH    HL
0004DD 44DD 5F               4      LD  E,A
                                
0004DE 44DE 0141F3          10      LD  BC,RAMAD0
0004E1 44E1 7C               4      LD  A,H
0004E2 44E2 07               4      RLCA
0004E3 44E3 07               4      RLCA
0004E4 44E4 E603             7      AND 3
0004E6 44E6 81               4      ADD A,C
0004E7 44E7 4F               4      LD  C,A
0004E8 44E8 0A               7      LD  A,(BC)
       44E9                     RLDIRSLT2:
0004E9 44E9 CD1400          17      CALL    _WRSLT
0004EC 44EC 08               4      EX  AF,AF'
0004ED 44ED E1              10      POP HL
0004EE 44EE D1              10      POP DE
0004EF 44EF C1              10      POP BC
0004F0 44F0 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004F2 44F2 EAD844          10      JP  PE,RLDIRSLT1
0004F5 44F5 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
0004F6 44F6 188E            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       44F8                     END_OF_LINE:
0004F8 44F8 215EF5          10      LD  HL,BUF
       44FB                     EOL1:
0004FB 44FB 7E               7      LD  A,(HL)
0004FC 44FC C8              11      RET Z
0004FD 44FD FE0D             7      CP  00DH
0004FF 44FF 2807            12      JR  Z,EOLE
000501 4501 FE0A             7      CP  00AH
000503 4503 2803            12      JR  Z,EOLE
000505 4505 23               6      INC HL
000506 4506 18F3            12      JR  EOL1
       4508                     EOLE:
000508 4508 3600            10      LD  (HL),0
00050A 450A 23               6      INC HL
00050B 450B 7E               7      LD  A,(HL)
00050C 450C FE0A             7      CP  00AH
00050E 450E C0              11      RET NZ
00050F 450F 23               6      INC HL
000510 4510 C9              10      RET
                                
       4511                     ROM_LOAD_ASCII:
000511 4511 210000          10      LD  HL,0
000514 4514 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000517 4517 2A76F6          16      LD  HL,(TXTTAB)
00051A 451A 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
00051D 451D 215EF5          10      LD  HL,BUF
000520 4520 2230F1          16      LD  (_DTA),HL
       4523                     RLOAD_A1:
000523 4523 2A36F1          16      LD  HL,(_BUF_ST)
000526 4526 2226F1          16      LD  (RR_LOW),HL
000529 4529 210201          10      LD  HL,258
00052C 452C CD9749          17      CALL    ROM_READ
00052F 452F 7C               4      LD  A,H
000530 4530 B5               4      OR  L
000531 4531 2877            12      JR  Z,RLOAD_AEND
000533 4533 015EF5          10      LD  BC,BUF
000536 4536 09              11      ADD HL,BC
000537 4537 3600            10      LD  (HL),0
000539 4539 CDF844          17      CALL    END_OF_LINE
00053C 453C 015EF5          10      LD  BC,BUF
00053F 453F A7               4      AND A
000540 4540 ED42            15      SBC HL,BC
000542 4542 2810            12      JR  Z,RLOAD_A2
000544 4544 4D               4      LD  C,L
000545 4545 44               4      LD  B,H
000546 4546 ED5B36F1        20      LD  DE,(_BUF_ST)
00054A 454A 19              11      ADD HL,DE
00054B 454B 2236F1          16      LD  (_BUF_ST),HL
00054E 454E 3A5EF5          13      LD  A,(BUF)
000551 4551 B7               4      OR  A
000552 4552 28CF            12      JR  Z,RLOAD_A1
       4554                     RLOAD_A2:
000554 4554 115EF5          10      LD  DE,BUF
000557 4557 CD4E4B          17      CALL    SPCUTEX
00055A 455A 1A               7      LD  A,(DE)
00055B 455B B7               4      OR  A
00055C 455C 284C            12      JR  Z,RLOAD_AEND
00055E 455E CD604B          17      CALL    GETNUM
000561 4561 7C               4      LD  A,H
000562 4562 B5               4      OR  L
000563 4563 CA0946          10      JP  Z,ERROR_DIRECT_IN_FILE
000566 4566 DD2A38F1        20      LD  IX,(_BUF_EN)
00056A 456A DD7502          19      LD  (IX+2),L
00056D 456D DD7403          19      LD  (IX+3),H
                                
000570 4570 CD474B          17      CALL    SPCUT
000573 4573 EB               4      EX  DE,HL
000574 4574 DDE5            15      PUSH    IX
000576 4576 DD21B242        14      LD  IX,CRUNCH
00057A 457A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00057E 457E CD1C00          17      CALL    _CALSLT
000581 4581 DDE1            14      POP IX
000583 4583 EB               4      EX  DE,HL
000584 4584 111FF4          10      LD  DE,KBUF
000587 4587 37               4      SCF
000588 4588 ED52            15      SBC HL,DE
00058A 458A 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
00058C 458C 387B            12      JR  C,ERROR_DIRECT_IN_FILE
00058E 458E 4D               4      LD  C,L
00058F 458F 44               4      LD  B,H
000590 4590 2A38F1          16      LD  HL,(_BUF_EN)
000593 4593 110400          10      LD  DE,4
000596 4596 19              11      ADD HL,DE
000597 4597 111FF4          10      LD  DE,KBUF
                                
00059A 459A EB               4      EX  DE,HL
00059B 459B EDB0                    LDIR
00059D 459D EB               4      EX  DE,HL
                                
00059E 459E DD7500          19      LD  (IX+0),L
0005A1 45A1 DD7401          19      LD  (IX+1),H
0005A4 45A4 2238F1          16      LD  (_BUF_EN),HL
0005A7 45A7 C32345          10      JP  RLOAD_A1
                                
       45AA                     RLOAD_AEND:
0005AA 45AA 2A38F1          16      LD  HL,(_BUF_EN)
0005AD 45AD AF               4      XOR A
0005AE 45AE 77               7      LD  (HL),A
0005AF 45AF 23               6      INC HL
0005B0 45B0 77               7      LD  (HL),A
0005B1 45B1 23               6      INC HL
0005B2 45B2 2238F1          16      LD  (_BUF_EN),HL
0005B5 45B5 183B            12      JR  RLOAD_END1
                                
       45B7                     ROM_LOAD:
0005B7 45B7 CD4647          17      CALL    INIT_PARAM
0005BA 45BA CD384A          17      CALL    FILE_B
0005BD 45BD 3A51F1          13      LD  A,(FNAME)
0005C0 45C0 FE20             7      CP  020H
0005C2 45C2 CA334A          10      JP  Z,ROM_ORG
                                
0005C5 45C5 CDB74B          17      CALL    ROM_OPEN
0005C8 45C8 3848            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005CA 45CA 2135F1          10      LD  HL,_BUF
0005CD 45CD 2230F1          16      LD  (_DTA),HL
0005D0 45D0 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0005D3 45D3 CD9749          17      CALL    ROM_READ
0005D6 45D6 3A35F1          13      LD  A,(_BUF)
0005D9 45D9 3C               4      INC A
0005DA 45DA C21145          10      JP  NZ,ROM_LOAD_ASCII
0005DD 45DD 2A76F6          16      LD  HL,(TXTTAB)
0005E0 45E0 2230F1          16      LD  (_DTA),HL
0005E3 45E3 EB               4      EX  DE,HL
0005E4 45E4 2100FF          10      LD  HL,-256
0005E7 45E7 39              11      ADD HL,SP
0005E8 45E8 ED52            15      SBC HL,DE
0005EA 45EA CD9749          17      CALL    ROM_READ
0005ED 45ED ED5B30F1        20      LD  DE,(_DTA)
0005F1 45F1 19              11      ADD HL,DE
       45F2                     RLOAD_END1:
0005F2 45F2 22C2F6          16      LD  (VARTAB),HL
0005F5 45F5 22C4F6          16      LD  (ARYTAB),HL
0005F8 45F8 22C6F6          16      LD  (STREND),HL
                                
0005FB 45FB AF               4      XOR A
0005FC 45FC 2138F1          10      LD  HL,_BUF+3
0005FF 45FF 77               7      LD  (HL),A
000600 4600 2B               6      DEC HL
000601 4601 77               7      LD  (HL),A
000602 4602 2B               6      DEC HL
000603 4603 77               7      LD  (HL),A
000604 4604 2B               6      DEC HL
000605 4605 3E8F             7      LD  A,08FH          ;REM
000607 4607 77               7      LD  (HL),A
000608 4608 C9              10      RET
                                
       4609                     ERROR_DIRECT_IN_FILE:
000609 4609 1E39             7      LD  E,57            ;Direct statement in file
00060B 460B 01                      DB  1           ;LD BC,
       460C                     ERROR_INTERNAL_ERROR:
00060C 460C 1E33             7      LD  E,51            ;Internal error
00060E 460E 01                      DB  1           ;LD BC,
       460F                     ERROR_FILE_NOT_OPEN:
00060F 460F 1E3B             7      LD  E,59            ;File not OPEN
000611 4611 01                      DB  1           ;LD BC,
       4612                     ERROR_FILE_NOT_FOUND:
000612 4612 1E35             7      LD  E,53            ;File not found
       4614                     ERROR:
000614 4614 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000618 4618 DD216F40        14      LD  IX,ERRHAND
00061C 461C C31C00          10      JP  _CALSLT
                                
       461F                     ROM_BLOAD:
00061F 461F CD4647          17      CALL    INIT_PARAM
000622 4622 CD384A          17      CALL    FILE_B
000625 4625 CDB74B          17      CALL    ROM_OPEN
000628 4628 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
00062A 462A 2135F1          10      LD  HL,_BUF
00062D 462D 2230F1          16      LD  (_DTA),HL
000630 4630 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000633 4633 CD9749          17      CALL    ROM_READ
000636 4636 3A35F1          13      LD  A,(_BUF)
000639 4639 FEFE             7      CP  0FEH
00063B 463B 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
00063D 463D 210EF1          10      LD  HL,BLOAD_RET
000640 4640 2206F1          16      LD  (SWC_BLOAD),HL
                                
000643 4643 2A4EF1          16      LD  HL,(PARAM1)
000646 4646 7E               7      LD  A,(HL)
000647 4647 FE2C             7      CP  ','
000649 4649 2048            12      JR  NZ,RBREAD_MEM
00064B 464B 23               6      INC HL
00064C 464C 7E               7      LD  A,(HL)
00064D 464D CDA14B          17      CALL    CAP
000650 4650 32BEFC          13      LD  (RUNBNF),A
       4653                     RBOS1:
000653 4653 7E               7      LD  A,(HL)
000654 4654 23               6      INC HL
000655 4655 B7               4      OR  A
000656 4656 282F            12      JR  Z,RBREAD_OSE
000658 4658 FE3A             7      CP  ':'
00065A 465A 282B            12      JR  Z,RBREAD_OSE
00065C 465C FE2C             7      CP  ','     ;次のパラメータを探す
00065E 465E 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000660 4660 224EF1          16      LD  (PARAM1),HL
000663 4663 7E               7      LD  A,(HL)
000664 4664 B7               4      OR  A
000665 4665 2820            12      JR  Z,RBREAD_OSE
000667 4667 DD21644C        14      LD  IX,FRMEVL
00066B 466B FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00066F 466F CD1C00          17      CALL    _CALSLT
000672 4672 224EF1          16      LD  (PARAM1),HL
000675 4675 3A63F6          13      LD  A,(VALTYP)
000678 4678 FE02             7      CP  2
00067A 467A 200B            12      JR  NZ,RBREAD_OSE
00067C 467C 2A36F1          16      LD  HL,(_BUF_ST)
00067F 467F ED5BF8F7        20      LD  DE,(DACDAT)
000683 4683 19              11      ADD HL,DE
000684 4684 2236F1          16      LD  (_BUF_ST),HL
       4687                     RBREAD_OSE:
000687 4687 3ABEFC          13      LD  A,(RUNBNF)
00068A 468A FE53             7      CP  'S'
00068C 468C 2005            12      JR  NZ,RBREAD_MEM
00068E 468E 3E01             7      LD  A,1
000690 4690 3232F1          13      LD  (FLG_LDIR),A
       4693                     RBREAD_MEM:
000693 4693 2A36F1          16      LD  HL,(_BUF_ST)
000696 4696 22BFFC          16      LD  (SAVENT),HL
000699 4699 2230F1          16      LD  (_DTA),HL
00069C 469C 21FFFF          10      LD  HL,0FFFFH
00069F 469F CD9749          17      CALL    ROM_READ
0006A2 46A2 3ABEFC          13      LD  A,(RUNBNF)
0006A5 46A5 FE52             7      CP  'R'
0006A7 46A7 2006            12      JR  NZ,RBREAD1
0006A9 46A9 2A3AF1          16      LD  HL,(_BUF_EX)
0006AC 46AC 2206F1          16      LD  (SWC_BLOAD),HL
       46AF                     RBREAD1:
       46AF                     ROM_NEXT:
0006AF 46AF 2A4EF1          16      LD  HL,(PARAM1)
0006B2 46B2 7E               7      LD  A,(HL)
0006B3 46B3 2B               6      DEC HL
0006B4 46B4 B7               4      OR  A
0006B5 46B5 2805            12      JR  Z,RN1
0006B7 46B7 FE3A             7      CP  ':'
0006B9 46B9 2801            12      JR  Z,RN1
0006BB 46BB 23               6      INC HL
       46BC                     RN1:
0006BC 46BC 5D               4      LD  E,L
0006BD 46BD 54               4      LD  D,H
                                
0006BE 46BE CD774B          17      CALL    SEARCH_END
0006C1 46C1 B7               4      OR  A
0006C2 46C2 2821            12      JR  Z,REM
       46C4                     RN3:                    ;マルチステートメントの処理
0006C4 46C4 7E               7      LD  A,(HL)
                                
0006C5 46C5 FEB5             7      CP  0B5H            ;LOAD
0006C7 46C7 CAB745          10      JP  Z,ROM_LOAD
0006CA 46CA FE8A             7      CP  08AH            ;RUN
0006CC 46CC 281B            12      JR  Z,ROM_RUN
0006CE 46CE FEB7             7      CP  0B7H            ;FILES
0006D0 46D0 2824            12      JR  Z,ROM_FILES
0006D2 46D2 FED6             7      CP  0D6H            ;COPY
0006D4 46D4 CA7C47          10      JP  Z,ROM_COPY
0006D7 46D7 FE20             7      CP  020H
0006D9 46D9 2807            12      JR  Z,RN_SP
                                
0006DB 46DB 3E28             7      LD  A,028H          ;JR Z,
0006DD 46DD 320CF1          13      LD  (SWC_BLOAD_M),A
0006E0 46E0 7E               7      LD  A,(HL)
0006E1 46E1 C9              10      RET
       46E2                     RN_SP:
0006E2 46E2 23               6      INC HL
0006E3 46E3 18DF            12      JR  RN3
                                
       46E5                     REM:
0006E5 46E5 EB               4      EX  DE,HL
0006E6 46E6 3E8F             7      LD  A,08FH          ;REM
0006E8 46E8 C9              10      RET
                                
       46E9                     ROM_RUN:
0006E9 46E9 23               6      INC HL
0006EA 46EA 7E               7      LD  A,(HL)
0006EB 46EB 2B               6      DEC HL
0006EC 46EC B7               4      OR  A
0006ED 46ED 2803            12      JR  Z,ROM_RUN1
0006EF 46EF CDB745          17      CALL    ROM_LOAD
       46F2                     ROM_RUN1:
0006F2 46F2 3E8A             7      LD  A,08AH          ;RUN
0006F4 46F4 77               7      LD  (HL),A
0006F5 46F5 C9              10      RET
                                
       46F6                     ROM_FILES:
0006F6 46F6 CD4647          17      CALL    INIT_PARAM
0006F9 46F9 CD384A          17      CALL    FILE_B
0006FC 46FC CD9550          17      CALL    GET_DISK_BANK_FDRV
0006FF 46FF 3A51F1          13      LD  A,(FNAME)
000702 4702 FE21             7      CP  021H
000704 4704 3005            12      JR  NC,RFILES0
000706 4706 060B             7      LD  B,11
000708 4708 CD0B4B          17      CALL    FILE10
       470B                     RFILES0:
00070B 470B CD094E          17      CALL    GET_DIR_DAT
       470E                     RFILES1:
00070E 470E CDD34B          17      CALL    FILESE
000711 4711 302E            12      JR  NC,RFILES_NOT_MATCH
       4713                     RFILES_DISP:
000713 4713 E5              11      PUSH    HL
000714 4714 0608             7      LD  B,8
000716 4716 CDA543          17      CALL    MSN
000719 4719 3E2E             7      LD  A,'.'
00071B 471B CDF050          17      CALL    MSG_A
00071E 471E 0603             7      LD  B,3
000720 4720 CDA543          17      CALL    MSN
000723 4723 3ADDF3          13      LD  A,(CSRX)
000726 4726 47               4      LD  B,A
000727 4727 3AB0F3          13      LD  A,(LINLEN)
00072A 472A 90               4      SUB B
00072B 472B FE0C             7      CP  12
00072D 472D 3009            12      JR  NC,RFILES2
00072F 472F 3E0D             7      LD  A,00DH      ;改行
000731 4731 CDF050          17      CALL    MSG_A
000734 4734 3E0A             7      LD  A,00AH
000736 4736 1802            12      JR  RFILES3
       4738                     RFILES2:
000738 4738 3E20             7      LD  A,020H
       473A                     RFILES3:
00073A 473A CDF050          17      CALL    MSG_A
00073D 473D E1              10      POP HL
00073E 473E CDEF4B          17      CALL    FNEXT
       4741                     RFILES_NOT_MATCH:
000741 4741 20CB            12      JR  NZ,RFILES1
000743 4743 C3AF46          10      JP  ROM_NEXT
                                
       4746                     INIT_PARAM:
000746 4746 224CF1          16      LD  (PARAM0),HL
000749 4749 224EF1          16      LD  (PARAM1),HL
00074C 474C EB               4      EX  DE,HL
00074D 474D AF               4      XOR A
00074E 474E 3232F1          13      LD  (FLG_LDIR),A
000751 4751 32BEFC          13      LD  (RUNBNF),A
000754 4754 3263F6          13      LD  (VALTYP),A
000757 4757 E5              11      PUSH    HL
000758 4758 2A5CF1          16      LD  HL,(_CD)
00075B 475B 225EF1          16      LD  (_CDX),HL
00075E 475E E1              10      POP HL
00075F 475F 13               6      INC DE
000760 4760 CD474B          17      CALL    SPCUT
000763 4763 1A               7      LD  A,(DE)
000764 4764 B7               4      OR  A
000765 4765 C8              11      RET Z
000766 4766 FE3A             7      CP  ':'
000768 4768 C8              11      RET Z
000769 4769 FE28             7      CP  '('
00076B 476B C8              11      RET Z
00076C 476C EB               4      EX  DE,HL
00076D 476D DD21644C        14      LD  IX,FRMEVL
000771 4771 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000775 4775 CD1C00          17      CALL    _CALSLT
000778 4778 224EF1          16      LD  (PARAM1),HL
00077B 477B C9              10      RET
                                
       477C                     ROM_COPY:
00077C 477C CD4647          17      CALL    INIT_PARAM
00077F 477F 3A63F6          13      LD  A,(VALTYP)
000782 4782 FE03             7      CP  3       ;string
000784 4784 C2334A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
000787 4787 CD384A          17      CALL    FILE_B
00078A 478A CDB74B          17      CALL    ROM_OPEN
00078D 478D DA1246          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000790 4790 213AF1          10      LD  HL,_BUF_W
000793 4793 2230F1          16      LD  (_DTA),HL
000796 4796 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
000799 4799 CD9749          17      CALL    ROM_READ
                                
00079C 479C AF               4      XOR A
00079D 479D 3235F1          13      LD  (_BUF_LO),A     ;PSET
0007A0 47A0 3242F1          13      LD  (_BUF_O),A      ;向き
                                
0007A3 47A3 2A4EF1          16      LD  HL,(PARAM1)
       47A6                     RCP_PARAM1:
0007A6 47A6 7E               7      LD  A,(HL)
0007A7 47A7 23               6      INC HL
0007A8 47A8 B7               4      OR  A
0007A9 47A9 CA334A          10      JP  Z,ROM_ORG
0007AC 47AC FE3A             7      CP  ':'
0007AE 47AE CA334A          10      JP  Z,ROM_ORG
0007B1 47B1 FE2C             7      CP  ','
0007B3 47B3 2012            12      JR  NZ,RCP_PARAM1_
                                
0007B5 47B5 DD212F54        14      LD  IX,FRMQNT
0007B9 47B9 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007BD 47BD CD1C00          17      CALL    _CALSLT
0007C0 47C0 7B               4      LD  A,E
0007C1 47C1 87               4      ADD A,A
0007C2 47C2 87               4      ADD A,A
0007C3 47C3 3242F1          13      LD  (_BUF_O),A
0007C6 47C6 7E               7      LD  A,(HL)
       47C7                     RCP_PARAM1_:
0007C7 47C7 FE28             7      CP  '('
0007C9 47C9 20DB            12      JR  NZ,RCP_PARAM1
                                
0007CB 47CB DD212F54        14      LD  IX,FRMQNT
0007CF 47CF FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007D3 47D3 CD1C00          17      CALL    _CALSLT
                                
0007D6 47D6 ED533EF1        20      LD  (_BUF_X),DE
                                
       47DA                     RCP_PARAM2:
0007DA 47DA 23               6      INC HL
0007DB 47DB 7E               7      LD  A,(HL)
0007DC 47DC FE20             7      CP  020H
0007DE 47DE 28FA            12      JR  Z,RCP_PARAM2
0007E0 47E0 FE2C             7      CP  ','
0007E2 47E2 28F6            12      JR  Z,RCP_PARAM2
                                
0007E4 47E4 DD212F54        14      LD  IX,FRMQNT
0007E8 47E8 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007EC 47EC CD1C00          17      CALL    _CALSLT
                                
0007EF 47EF ED5340F1        20      LD  (_BUF_Y),DE
       47F3                     RCP_PARAM3:
0007F3 47F3 23               6      INC HL
0007F4 47F4 7E               7      LD  A,(HL)
0007F5 47F5 FE20             7      CP  020H
0007F7 47F7 28FA            12      JR  Z,RCP_PARAM3
0007F9 47F9 FE29             7      CP  ')'
0007FB 47FB 28F6            12      JR  Z,RCP_PARAM3
0007FD 47FD FE2C             7      CP  ','
0007FF 47FF 2033            12      JR  NZ,RCP_ST
                                
000801 4801 23               6      INC HL
000802 4802 DD212F54        14      LD  IX,FRMQNT
000806 4806 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00080A 480A CD1C00          17      CALL    _CALSLT
                                
00080D 480D 7B               4      LD  A,E
00080E 480E 3241F1          13      LD  (_BUF_P),A
                                
       4811                     RCP_PARAM4:
000811 4811 7E               7      LD  A,(HL)
000812 4812 23               6      INC HL
000813 4813 FE20             7      CP  020H
000815 4815 28FA            12      JR  Z,RCP_PARAM4
                                
000817 4817 FE2C             7      CP  ','
000819 4819 2019            12      JR  NZ,RCP_ST
                                
00081B 481B 7E               7      LD  A,(HL)
00081C 481C 0604             7      LD  B,4
00081E 481E FEC3             7      CP  0C3H        ;PRESET
000820 4820 280E            12      JR  Z,RCP_LO
000822 4822 05               4      DEC B       ;3
000823 4823 D6F8             7      SUB 0F8H        ;XOR
000825 4825 2809            12      JR  Z,RCP_LO
000827 4827 05               4      DEC B       ;2
000828 4828 3C               4      INC A       ;OR
000829 4829 2805            12      JR  Z,RCP_LO
00082B 482B 05               4      DEC B       ;1
00082C 482C 3C               4      INC A       ;AND
00082D 482D 2801            12      JR  Z,RCP_LO
00082F 482F 05               4      DEC B       ;0
                                                ;PSET
       4830                     RCP_LO:
000830 4830 78               4      LD  A,B
000831 4831 3235F1          13      LD  (_BUF_LO),A
       4834                     RCP_ST:
000834 4834 2AC6F6          16      LD  HL,(STREND)
000837 4837 2230F1          16      LD  (_DTA),HL
00083A 483A EB               4      EX  DE,HL
00083B 483B 2100FE          10      LD  HL,-512
00083E 483E 39              11      ADD HL,SP
00083F 483F AF               4      XOR A
000840 4840 ED52            15      SBC HL,DE
000842 4842 3008            12      JR  NC,RCP0
000844 4844 215EF5          10      LD  HL,BUF
000847 4847 2230F1          16      LD  (_DTA),HL
00084A 484A 6F               4      LD  L,A ;0
00084B 484B 67               4      LD  H,A ;0
       484C                     RCP0:
00084C 484C 24               4      INC H
00084D 484D 2238F1          16      LD  (_BUF_EN),HL
       4850                     RCP1:
000850 4850 F3               4      DI
000851 4851 CD2549          17      CALL    WAIT_VDP
                                
000854 4854 3A0700          13      LD  A,(WRVDP)
000857 4857 4F               4      LD  C,A
000858 4858 0C               4      INC C       ;C := PORT#1's address(WR)
000859 4859 3E24             7      LD  A,36
00085B 485B ED79            12      OUT (C),A
00085D 485D 3E91             7      LD  A,080H+17
00085F 485F ED79            12      OUT (C),A       ;R#17 := 36
                                
000861 4861 0C               4      INC C
000862 4862 0C               4      INC C       ;C := PORT#3's address(WR)
000863 4863 2A3EF1          16      LD  HL,(_BUF_X)
000866 4866 ED69            12      OUT (C),L       ;R#36 DX
000868 4868 ED61            12      OUT (C),H       ;R#37
00086A 486A 2A40F1          16      LD  HL,(_BUF_Y)
00086D 486D ED69            12      OUT (C),L       ;R#38 DY
00086F 486F ED61            12      OUT (C),H       ;R#39
000871 4871 2A3AF1          16      LD  HL,(_BUF_W)
000874 4874 ED69            12      OUT (C),L       ;R#40 NX
000876 4876 ED61            12      OUT (C),H       ;R#41
000878 4878 2A3CF1          16      LD  HL,(_BUF_H)
00087B 487B ED69            12      OUT (C),L       ;R#42 NY
00087D 487D ED61            12      OUT (C),H       ;R#43
                                
00087F 487F DD2AAFFC        20      LD  IX,(SCRMOD)
000883 4883 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
000886 4886 B7               4      OR  A
000887 4887 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
000889 4889 DD7D             9      LD  A,IXL
00088B 488B FE08             7      CP  8
00088D 488D 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
00088F 488F FE06             7      CP  6
000891 4891 2A3EF1          16      LD  HL,(_BUF_X)
000894 4894 3A3AF1          13      LD  A,(_BUF_W)
000897 4897 2005            12      JR  NZ,SCR57
000899 4899 B5               4      OR  L       ;スクリーン6
00089A 489A E603             7      AND 3
00089C 489C 200D            12      JR  NZ,USE_LMMC
       489E                     SCR57:              ;スクリーン5,7
00089E 489E B5               4      OR  L
00089F 489F E601             7      AND 1
0008A1 48A1 2008            12      JR  NZ,USE_LMMC
       48A3                     USE_HMMC:
0008A3 48A3 DD2E08          10      LD  IXL,8
       48A6                     USE_HMMC8:
0008A6 48A6 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
0008A8 48A8 3235F1          13      LD  (_BUF_LO),A
       48AB                     USE_LMMC:
0008AB 48AB 110000          10      LD  DE,0
0008AE 48AE 06FF             7      LD  B,-1
0008B0 48B0 CD5049          17      CALL    GET_PIXEL
0008B3 48B3 ED79            12      OUT (C),A       ;R#44 first DATA
0008B5 48B5 3A42F1          13      LD  A,(_BUF_O)
0008B8 48B8 ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
0008BA 48BA 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008BD 48BD F6B0             7      OR  0B0H        ;R#46 LMMC command
0008BF 48BF ED79            12      OUT (C),A
                                
0008C1 48C1 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008C3 48C3 0D               4      DEC C
0008C4 48C4 0D               4      DEC C       ;C := PORT#1's address(WR)
0008C5 48C5 3EAC             7      LD  A,080H+44
0008C7 48C7 ED79            12      OUT (C),A
0008C9 48C9 3E91             7      LD  A,080H+17
0008CB 48CB ED79            12      OUT (C),A       ;R#17 := 44
                                
0008CD 48CD 3A0600          13      LD  A,(RDVDP)
0008D0 48D0 3C               4      INC A
0008D1 48D1 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
0008D3 48D3 3E02             7      LD  A,2
0008D5 48D5 ED79            12      OUT (C),A
0008D7 48D7 3E8F             7      LD  A,08FH
0008D9 48D9 ED79            12      OUT (C),A
0008DB 48DB 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008DE 48DE E640             7      AND 040H
0008E0 48E0 201C            12      JR  NZ,LOOP_HMMC
       48E2                     LOOP_COPY:
0008E2 48E2 CD5049          17      CALL    GET_PIXEL
0008E5 48E5 08               4      EX  AF,AF'
0008E6 48E6 FD4C             9      LD  C,IYH
       48E8                     LOOP_COPY1:
0008E8 48E8 ED78            12      IN  A,(C)
0008EA 48EA 0F               4      RRCA            ;RRCAではサインフラグは変化しない
0008EB 48EB 300A            12      JR  NC,EXIT_COPY    ;check CE bit
0008ED 48ED F2E848          10      JP  P,LOOP_COPY1    ;check TR bit
0008F0 48F0 08               4      EX  AF,AF'
0008F1 48F1 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008F3 48F3 ED79            12      OUT (C),A
0008F5 48F5 18EB            12      JR  LOOP_COPY
                                
       48F7                     EXIT_COPY:
0008F7 48F7 CD2D49          17      CALL    GET_STATUS_0
0008FA 48FA FB               4      EI
0008FB 48FB C3AF46          10      JP  ROM_NEXT
                                
       48FE                     LOOP_HMMC:
0008FE 48FE FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000900 4900 43               4      LD  B,E
000901 4901 7B               4      LD  A,E
000902 4902 B7               4      OR  A
000903 4903 2802            12      JR  Z,LOOP_HMMC1
000905 4905 EDB3                    OTIR
       4907                     LOOP_HMMC1:
000907 4907 14               4      INC D
       4908                     LOOP_HMMC2:
000908 4908 15               4      DEC D
000909 4909 2805            12      JR  Z,LOOP_HMMC3
00090B 490B EDB3                    OTIR
00090D 490D C30849          10      JP  LOOP_HMMC2
       4910                     LOOP_HMMC3:
000910 4910 ED78            12      IN  A,(C)
000912 4912 0F               4      RRCA
000913 4913 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
000915 4915 2A38F1          16      LD  HL,(_BUF_EN)
000918 4918 CD9749          17      CALL    ROM_READ
00091B 491B EB               4      EX  DE,HL
00091C 491C 2A30F1          16      LD  HL,(_DTA)
00091F 491F 7A               4      LD  A,D
000920 4920 B3               4      OR  E
000921 4921 20DB            12      JR  NZ,LOOP_HMMC
000923 4923 18C3            12      JR  LOOP_COPY1
                                    
       4925                     WAIT_VDP:
000925 4925 3E02             7      LD  A,2
000927 4927 CD2E49          17      CALL    GET_STATUS
00092A 492A 0F               4      RRCA
00092B 492B 38F8            12      JR  C,WAIT_VDP
       492D                     GET_STATUS_0:
00092D 492D AF               4      XOR A
       492E                     GET_STATUS:
00092E 492E C5              11      PUSH    BC
00092F 492F ED4B0600        20      LD  BC,(RDVDP)
000933 4933 0C               4      INC C
000934 4934 ED79            12      OUT (C),A
000936 4936 3E8F             7      LD  A,08FH
000938 4938 ED79            12      OUT (C),A
00093A 493A ED78            12      IN  A,(C)
00093C 493C C1              10      POP BC
00093D 493D C9              10      RET
                                
       493E                     GET_PIXEL256:
00093E 493E 7A               4      LD  A,D
00093F 493F B3               4      OR  E
000940 4940 200A            12      JR  NZ,GET_PIXEL1
000942 4942 2A38F1          16      LD  HL,(_BUF_EN)
000945 4945 CD9749          17      CALL    ROM_READ
000948 4948 EB               4      EX  DE,HL
000949 4949 2A30F1          16      LD  HL,(_DTA)
       494C                     GET_PIXEL1:
00094C 494C 7E               7      LD  A,(HL)
00094D 494D 23               6      INC HL
00094E 494E 1B               6      DEC DE
00094F 494F C9              10      RET
                                
       4950                     GET_PIXEL:
000950 4950 04               4      INC B
000951 4951 DD7D             9      LD  A,IXL
000953 4953 FE08             7      CP  8
000955 4955 28E7            12      JR  Z,GET_PIXEL256
000957 4957 FE06             7      CP  6
000959 4959 282E            12      JR  Z,GET_PIXEL4
                                
00095B 495B CB40             8      BIT 0,B
00095D 495D 20ED            12      JR  NZ,GET_PIXEL1
                                
00095F 495F 7A               4      LD  A,D
000960 4960 B3               4      OR  E
000961 4961 200A            12      JR  NZ,GET_PIXEL2
                                
000963 4963 2A38F1          16      LD  HL,(_BUF_EN)
000966 4966 CD9749          17      CALL    ROM_READ
000969 4969 EB               4      EX  DE,HL
00096A 496A 2A30F1          16      LD  HL,(_DTA)
                                
       496D                     GET_PIXEL2:
00096D 496D 7E               7      LD  A,(HL)
00096E 496E 0F               4      RRCA
00096F 496F 0F               4      RRCA
000970 4970 0F               4      RRCA
000971 4971 0F               4      RRCA
000972 4972 C9              10      RET
                                
       4973                     GET_PIXEL3:
000973 4973 7A               4      LD  A,D
000974 4974 B3               4      OR  E
000975 4975 200A            12      JR  NZ,GET_PIXEL5
                                
000977 4977 2A38F1          16      LD  HL,(_BUF_EN)
00097A 497A CD9749          17      CALL    ROM_READ
00097D 497D EB               4      EX  DE,HL
00097E 497E 2A30F1          16      LD  HL,(_DTA)
       4981                     GET_PIXEL5:
000981 4981 7E               7      LD  A,(HL)
000982 4982 0F               4      RRCA
000983 4983 0F               4      RRCA
000984 4984 0F               4      RRCA
000985 4985 0F               4      RRCA
000986 4986 0F               4      RRCA
000987 4987 0F               4      RRCA
000988 4988 C9              10      RET
                                
       4989                     GET_PIXEL4:
000989 4989 78               4      LD  A,B
00098A 498A E603             7      AND 3   ;+0
00098C 498C 28E5            12      JR  Z,GET_PIXEL3
00098E 498E 3D               4      DEC A   ;+1
00098F 498F 28DC            12      JR  Z,GET_PIXEL2
000991 4991 3D               4      DEC A   ;+2
000992 4992 7E               7      LD  A,(HL)
000993 4993 C0              11      RET NZ
000994 4994 0F               4      RRCA        ;+3
000995 4995 0F               4      RRCA
000996 4996 C9              10      RET
                                
       4997                     ROM_READ:
000997 4997 E5              11      PUSH    HL
000998 4998 D5              11      PUSH    DE
000999 4999 C5              11      PUSH    BC
00099A 499A FDE5            15      PUSH    IY
00099C 499C 224AF1          16      LD  (LEFTX),HL
00099F 499F 2A30F1          16      LD  HL,(_DTA)
0009A2 49A2 2243F1          16      LD  (DTAX),HL
0009A5 49A5 2A4AF1          16      LD  HL,(LEFTX)
                                
0009A8 49A8 CD334C          17      CALL    RBX1
0009AB 49AB 3870            12      JR  C,RBRERR1
0009AD 49AD 79               4      LD  A,C
0009AE 49AE EB               4      EX  DE,HL
0009AF 49AF ED52            15      SBC HL,DE       ;CP 0HL,CDE
0009B1 49B1 19              11      ADD HL,DE
0009B2 49B2 DE00             7      SBC A,000H
0009B4 49B4 3801            12      JR  C,RBR1
0009B6 49B6 EB               4      EX  DE,HL
       49B7                     RBR1:
0009B7 49B7 9F               4      SBC A,A
0009B8 49B8 E601             7      AND 1
0009BA 49BA 321FF1          13      LD  (_RESULT),A
0009BD 49BD 7C               4      LD  A,H
0009BE 49BE B5               4      OR  L
0009BF 49BF CA134A          10      JP  Z,RBREND0
                                
0009C2 49C2 222CF1          16      LD  (_LEFT),HL  ;Read record byte
0009C5 49C5 224AF1          16      LD  (LEFTX),HL
                                
0009C8 49C8 CD5C4C          17      CALL    RBX2
0009CB 49CB 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009CD 49CD CD6F4C          17      CALL    RBXA
0009D0 49D0 DA294A          10      JP  C,RBRERR
0009D3 49D3 C5              11      PUSH    BC
0009D4 49D4 CD2E44          17      CALL    ROM_LDIR
0009D7 49D7 ED5343F1        20      LD  (DTAX),DE
0009DB 49DB 2A4AF1          16      LD  HL,(LEFTX)
0009DE 49DE D1              10      POP DE
0009DF 49DF A7               4      AND A
0009E0 49E0 ED52            15      SBC HL,DE
0009E2 49E2 224AF1          16      LD  (LEFTX),HL
0009E5 49E5 2829            12      JR  Z,RBREND
                                
       49E7                     RBRB:
0009E7 49E7 CDA84C          17      CALL    RBXB
0009EA 49EA 2818            12      JR  Z,RBRC
       49EC                     RBRB1:
0009EC 49EC C5              11      PUSH    BC
0009ED 49ED D5              11      PUSH    DE
0009EE 49EE CD504D          17      CALL    CLUST
0009F1 49F1 EB               4      EX  DE,HL
0009F2 49F2 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
0009F6 49F6 CD2E44          17      CALL    ROM_LDIR
0009F9 49F9 EB               4      EX  DE,HL
0009FA 49FA D1              10      POP DE
0009FB 49FB C1              10      POP BC
0009FC 49FC CD2D4D          17      CALL    GNCL
0009FF 49FF DA294A          10      JP  C,RBRERR
000A02 4A02 10E8            13      DJNZ    RBRB1
       4A04                     RBRC:
000A04 4A04 CDC04C          17      CALL    RBXC
000A07 4A07 2807            12      JR  Z,RBREND
                                
000A09 4A09 CD504D          17      CALL    CLUST
000A0C 4A0C EB               4      EX  DE,HL
000A0D 4A0D CD2E44          17      CALL    ROM_LDIR
       4A10                     RBREND:
000A10 4A10 CDCC4C          17      CALL    RBXEND
       4A13                     RBREND0:
000A13 4A13 FDE1            14      POP IY
000A15 4A15 C1              10      POP BC
000A16 4A16 D1              10      POP DE
000A17 4A17 F1              10      POP AF  ;(HL)
000A18 4A18 AF               4      XOR A
000A19 4A19 3A1FF1          13      LD  A,(_RESULT)
000A1C 4A1C C9              10      RET
                                
       4A1D                     RBRERR1:
000A1D 4A1D 3E01             7      LD  A,001H
       4A1F                     RBRERR2:
000A1F 4A1F FDE1            14      POP IY
000A21 4A21 C1              10      POP BC
000A22 4A22 D1              10      POP DE
000A23 4A23 E1              10      POP HL
000A24 4A24 37               4      SCF
000A25 4A25 210000          10      LD  HL,0
000A28 4A28 C9              10      RET
       4A29                     RBRERR:
000A29 4A29 3EFF             7      LD  A,0FFH
000A2B 4A2B 18F2            12      JR  RBRERR2
                                
       4A2D                     FILE_DD:
000A2D 4A2D E1              10      POP HL
000A2E 4A2E 3E                      DB  03EH
000A2F 4A2F C9              10      RET
000A30 4A30 320CF1          13      LD  (SWC_BLOAD_M),A
       4A33                     ROM_ORG:
000A33 4A33 2A4CF1          16      LD  HL,(PARAM0)
000A36 4A36 7E               7      LD  A,(HL)
000A37 4A37 C9              10      RET
       4A38                     FILE_B:
000A38 4A38 AF               4      XOR A
000A39 4A39 3250F1          13      LD  (FDRV),A
000A3C 4A3C 1E00             7      LD  E,0
000A3E 4A3E 3A63F6          13      LD  A,(VALTYP)
000A41 4A41 FE03             7      CP  3       ;string
000A43 4A43 C2C84A          10      JP  NZ,FILED
                                
000A46 4A46 DD21D067        14      LD  IX,FRESTR
000A4A 4A4A FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A4E 4A4E CD1C00          17      CALL    _CALSLT
000A51 4A51 E5              11      PUSH    HL
000A52 4A52 DDE1            14      POP IX
                                
000A54 4A54 DD5E00          19      LD  E,(IX+0)
000A57 4A57 DD7E01          19      LD  A,(IX+1)
000A5A 4A5A DD5602          19      LD  D,(IX+2)
000A5D 4A5D DD62             9      LD  IXH,D
000A5F 4A5F DD6F             9      LD  IXL,A
000A61 4A61 7B               4      LD  A,E
       4A62                     FILE_BDOS:
000A62 4A62 FE04             7      CP  4
000A64 4A64 3808            12      JR  C,FILEB1
000A66 4A66 DD7E03          19      LD  A,(IX+3)
000A69 4A69 FE3A             7      CP  ':'
000A6B 4A6B 28C0            12      JR  Z,FILE_DD
000A6D 4A6D 7B               4      LD  A,E
       4A6E                     FILEB1:
000A6E 4A6E FE02             7      CP  2
000A70 4A70 3818            12      JR  C,DEVI1
000A72 4A72 DD7E01          19      LD  A,(IX+1)
000A75 4A75 FE3A             7      CP  ':'
000A77 4A77 2011            12      JR  NZ,DEVI1
000A79 4A79 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A7C 4A7C CDA14B          17      CALL    CAP
000A7F 4A7F D640             7      SUB '@'
000A81 4A81 DD23            10      INC IX
000A83 4A83 DD23            10      INC IX
000A85 4A85 1D               4      DEC E
000A86 4A86 1D               4      DEC E
000A87 4A87 3250F1          13      LD  (FDRV),A
       4A8A                     DEVI1:
000A8A 4A8A DD7E00          19      LD  A,(IX+0)
000A8D 4A8D D65C             7      SUB 05CH        ;\
000A8F 4A8F 2008            12      JR  NZ,NOROOT
000A91 4A91 6F               4      LD  L,A
000A92 4A92 67               4      LD  H,A
000A93 4A93 225EF1          16      LD  (_CDX),HL
000A96 4A96 DD23            10      INC IX
000A98 4A98 1D               4      DEC E
       4A99                     NOROOT:
                                
       4A99                     SETDIR:
000A99 4A99 CDC84A          17      CALL    FILED
000A9C 4A9C DD7E00          19      LD  A,(IX+0)
000A9F 4A9F FE5C             7      CP  05CH        ;\
000AA1 4AA1 C0              11      RET NZ
000AA2 4AA2 DD23            10      INC IX
000AA4 4AA4 1D               4      DEC E
000AA5 4AA5 3A51F1          13      LD  A,(FNAME)
000AA8 4AA8 FE20             7      CP  020H        ;. の処理
000AAA 4AAA 28ED            12      JR  Z,SETDIR
                                
000AAC 4AAC CDB74B          17      CALL    ROM_OPEN
000AAF 4AAF B7               4      OR  A
000AB0 4AB0 C0              11      RET NZ
                                
000AB1 4AB1 FD2A47F1        20      LD  IY,(DIRENT1)
000AB5 4AB5 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000AB9 4AB9 C8              11      RET Z
000ABA 4ABA CD0F4B          17      CALL    FILEI
000ABD 4ABD FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000AC0 4AC0 FD661B          19      LD  H,(IY+01BH)
000AC3 4AC3 225EF1          16      LD  (_CDX),HL
000AC6 4AC6 18D1            12      JR  SETDIR
                                
       4AC8                     FILED:
000AC8 4AC8 CD0F4B          17      CALL    FILEI
000ACB 4ACB 2151F1          10      LD  HL,FNAME
                                
000ACE 4ACE 0608             7      LD  B,8
       4AD0                     FILE2:
000AD0 4AD0 CD1C4B          17      CALL    CCHKF
000AD3 4AD3 C8              11      RET Z
000AD4 4AD4 FE2A             7      CP  '*'
000AD6 4AD6 282E            12      JR  Z,FILE9
000AD8 4AD8 FE2E             7      CP  '.'
000ADA 4ADA 280C            12      JR  Z,FILE4
000ADC 4ADC 77               7      LD  (HL),A
000ADD 4ADD 23               6      INC HL
000ADE 4ADE 10F0            13      DJNZ    FILE2
                                
       4AE0                     FILE3:
000AE0 4AE0 CD1C4B          17      CALL    CCHKF
000AE3 4AE3 C8              11      RET Z
000AE4 4AE4 FE2E             7      CP  '.'
000AE6 4AE6 20F8            12      JR  NZ,FILE3
                                
       4AE8                     FILE4:
000AE8 4AE8 2159F1          10      LD  HL,FNAME+8
000AEB 4AEB 0603             7      LD  B,3
                                
       4AED                     FILE4L:
000AED 4AED CD1C4B          17      CALL    CCHKF
000AF0 4AF0 C8              11      RET Z
000AF1 4AF1 FE2E             7      CP  '.'
000AF3 4AF3 2008            12      JR  NZ,FILE12
000AF5 4AF5 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000AF8 4AF8 3252F1          13      LD  (FNAME+1),A
000AFB 4AFB 3E20             7      LD  A,020H
       4AFD                     FILE12:
000AFD 4AFD FE2A             7      CP  '*'
000AFF 4AFF 280A            12      JR  Z,FILE10
000B01 4B01 77               7      LD  (HL),A
000B02 4B02 23               6      INC HL
000B03 4B03 10E8            13      DJNZ    FILE4L
000B05 4B05 C9              10      RET
                                
       4B06                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000B06 4B06 CD0B4B          17      CALL    FILE10
000B09 4B09 18D5            12      JR  FILE3
                                
       4B0B                     FILE10:
000B0B 4B0B 3E3F             7      LD  A,'?'
000B0D 4B0D 1808            12      JR  FILL_MEMORY
       4B0F                     FILEI:              ;名前＋拡張子をスペースで初期化
000B0F 4B0F 3E20             7      LD  A,020H
000B11 4B11 01000B          10      LD  BC,11*256   ;C=0にしておく
000B14 4B14 2151F1          10      LD  HL,FNAME
       4B17                     FILL_MEMORY:            ;HLからBバイトAで埋める
000B17 4B17 77               7      LD  (HL),A
000B18 4B18 23               6      INC HL
000B19 4B19 10FC            13      DJNZ    FILL_MEMORY
000B1B 4B1B C9              10      RET
                                
       4B1C                     CCHKF:
000B1C 4B1C 7B               4      LD  A,E
000B1D 4B1D B7               4      OR  A
000B1E 4B1E C8              11      RET Z
000B1F 4B1F DD7E00          19      LD  A,(IX+0)
000B22 4B22 CD294B          17      CALL    CCHK2
000B25 4B25 C8              11      RET Z
000B26 4B26 C38C4B          10      JP  FKAN
                                
       4B29                     CCHK2:
000B29 4B29 0C               4      INC C
000B2A 4B2A 0D               4      DEC C
000B2B 4B2B C0              11      RET NZ
       4B2C                     CCHK3:              ;ZF=1 で使えない文字
000B2C 4B2C FE2B             7      CP  '+'
000B2E 4B2E C8              11      RET Z
000B2F 4B2F FE2C             7      CP  ','
000B31 4B31 C8              11      RET Z
000B32 4B32 FE2F             7      CP  '/'
000B34 4B34 C8              11      RET Z
000B35 4B35 FE3A             7      CP  ':'
000B37 4B37 C8              11      RET Z
000B38 4B38 FE3B             7      CP  ';'
000B3A 4B3A C8              11      RET Z
000B3B 4B3B FE3D             7      CP  '='
000B3D 4B3D C8              11      RET Z
000B3E 4B3E FE5C             7      CP  05CH    ;\
000B40 4B40 C8              11      RET Z
000B41 4B41 FE1F             7      CP  01FH
000B43 4B43 D0              11      RET NC
000B44 4B44 BF               4      CP  A       ;Z=1
000B45 4B45 C9              10      RET
                                
       4B46                     SS1:
000B46 4B46 13               6      INC DE
       4B47                     SPCUT:              ;スペースをカット
000B47 4B47 1A               7      LD  A,(DE)
000B48 4B48 FE20             7      CP  020H
000B4A 4B4A 28FA            12      JR  Z,SS1
000B4C 4B4C C9              10      RET
                                
       4B4D                     SCREOF1:
000B4D 4B4D 13               6      INC DE
       4B4E                     SPCUTEX:            ;スペース改行などをカット
000B4E 4B4E 1A               7      LD  A,(DE)
000B4F 4B4F FE20             7      CP  020H
000B51 4B51 28FA            12      JR  Z,SCREOF1
000B53 4B53 FE0D             7      CP  00DH
000B55 4B55 28F6            12      JR  Z,SCREOF1
000B57 4B57 FE0A             7      CP  00AH
000B59 4B59 28F2            12      JR  Z,SCREOF1
000B5B 4B5B FE1A             7      CP  01AH
000B5D 4B5D 28EE            12      JR  Z,SCREOF1
000B5F 4B5F C9              10      RET
                                
       4B60                     GETNUM:
000B60 4B60 210000          10      LD  HL,0
       4B63                     GETNUM1:
000B63 4B63 1A               7      LD  A,(DE)
000B64 4B64 13               6      INC DE
000B65 4B65 D630             7      SUB '0'
000B67 4B67 D8              11      RET C
000B68 4B68 FE0A             7      CP  10
000B6A 4B6A D0              11      RET NC
000B6B 4B6B 4D               4      LD  C,L
000B6C 4B6C 44               4      LD  B,H
000B6D 4B6D 29              11      ADD HL,HL   ;*2
000B6E 4B6E 29              11      ADD HL,HL   ;*4
000B6F 4B6F 09              11      ADD HL,BC   ;*5
000B70 4B70 29              11      ADD HL,HL   ;*10
000B71 4B71 4F               4      LD  C,A
000B72 4B72 0600             7      LD  B,0
000B74 4B74 09              11      ADD HL,BC
000B75 4B75 18EC            12      JR  GETNUM1
                                
       4B77                     SEARCH_END:
000B77 4B77 7E               7      LD  A,(HL)
       4B78                     SEARCH_END1:
000B78 4B78 23               6      INC HL
000B79 4B79 B7               4      OR  A
000B7A 4B7A C8              11      RET Z
000B7B 4B7B FE3A             7      CP  ':'
000B7D 4B7D 20F8            12      JR  NZ,SEARCH_END
000B7F 4B7F 7E               7      LD  A,(HL)
000B80 4B80 FE3A             7      CP  ':'
000B82 4B82 28F4            12      JR  Z,SEARCH_END1
000B84 4B84 C9              10      RET
                                
       4B85                     FKANC:
000B85 4B85 CB41             8      BIT 0,C
000B87 4B87 CCAA4B          17      CALL    Z,CAP2
000B8A 4B8A 1803            12      JR  FKANX
       4B8C                     FKAN:           ;漢字チェック
000B8C 4B8C DD23            10      INC IX
000B8E 4B8E 1D               4      DEC E
       4B8F                     FKANX:
000B8F 4B8F CB41             8      BIT 0,C
000B91 4B91 CB81             8      RES 0,C
000B93 4B93 C0              11      RET NZ
000B94 4B94 FE80             7      CP  080H
000B96 4B96 D8              11      RET C
000B97 4B97 FEA0             7      CP  0A0H
000B99 4B99 3803            12      JR  C,FKAN1
000B9B 4B9B FEE0             7      CP  0E0H
000B9D 4B9D D8              11      RET C
       4B9E                     FKAN1:
000B9E 4B9E 0C               4      INC C
000B9F 4B9F A7               4      AND A
000BA0 4BA0 C9              10      RET
                                
       4BA1                     CAP:
000BA1 4BA1 FE61             7      CP  'a'
000BA3 4BA3 D8              11      RET C
000BA4 4BA4 FE7B             7      CP  'z'+1
000BA6 4BA6 D0              11      RET NC
000BA7 4BA7 D620             7      SUB 020H
000BA9 4BA9 C9              10      RET
       4BAA                     CAP2:
000BAA 4BAA CDA14B          17      CALL    CAP
       4BAD                     CAP3:               ;
000BAD 4BAD FE05             7      CP  5
000BAF 4BAF 2803            12      JR  Z,CAP4
000BB1 4BB1 FE21             7      CP  021H
000BB3 4BB3 C9              10      RET
       4BB4                     CAP4:
000BB4 4BB4 3EE5             7      LD  A,0E5H
000BB6 4BB6 C9              10      RET
                                
       4BB7                     ROM_OPEN:
000BB7 4BB7 CD9550          17      CALL    GET_DISK_BANK_FDRV
                                
000BBA 4BBA CD094E          17      CALL    GET_DIR_DAT
000BBD 4BBD D5              11      PUSH    DE
000BBE 4BBE CDD34B          17      CALL    FILESE
000BC1 4BC1 D1              10      POP DE
000BC2 4BC2 3F               4      CCF
000BC3 4BC3 D8              11      RET C
000BC4 4BC4 2247F1          16      LD  (DIRENT1),HL
000BC7 4BC7 E5              11      PUSH    HL
000BC8 4BC8 210000          10      LD  HL,0
000BCB 4BCB 2226F1          16      LD  (RR_LOW),HL
000BCE 4BCE 2228F1          16      LD  (RR_HIGH),HL
000BD1 4BD1 E1              10      POP HL
000BD2 4BD2 C9              10      RET
                                
       4BD3                     FILESE:
000BD3 4BD3 7E               7      LD  A,(HL)
000BD4 4BD4 B7               4      OR  A
000BD5 4BD5 C8              11      RET Z       ;END:ZF=1 CF=0
000BD6 4BD6 FEE5             7      CP  0E5H
000BD8 4BD8 280D            12      JR  Z,FILESE1
000BDA 4BDA 1151F1          10      LD  DE,FNAME
000BDD 4BDD E5              11      PUSH    HL
000BDE 4BDE CD0D4C          17      CALL    CPFILE
000BE1 4BE1 CC2E4C          17      CALL    Z,CPFILE2
000BE4 4BE4 E1              10      POP HL
000BE5 4BE5 37               4      SCF
000BE6 4BE6 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4BE7                     FILESE1:
000BE7 4BE7 CDEF4B          17      CALL    FNEXT
000BEA 4BEA 20E7            12      JR  NZ,FILESE
000BEC 4BEC F6FF             7      OR  0FFH        ;ZF=0 CF=0
000BEE 4BEE C9              10      RET
                                
       4BEF                     FNEXT:
000BEF 4BEF 112000          10      LD  DE,020H
000BF2 4BF2 19              11      ADD HL,DE
000BF3 4BF3 ED5B5EF1        20      LD  DE,(_CDX)
000BF7 4BF7 7A               4      LD  A,D
000BF8 4BF8 B3               4      OR  E
000BF9 4BF9 2002            12      JR  NZ,FNEXT_SUBDIR
000BFB 4BFB 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000BFC 4BFC C9              10      RET
                                
       4BFD                     FNEXT_SUBDIR:           ;サブディレクトリ
000BFD 4BFD 0D               4      DEC C
000BFE 4BFE C0              11      RET NZ
                                
000BFF 4BFF ED5B5EF1        20      LD  DE,(_CDX)
000C03 4C03 CD2D4D          17      CALL    GNCL
000C06 4C06 EB               4      EX  DE,HL
000C07 4C07 225EF1          16      LD  (_CDX),HL
000C0A 4C0A C3414E          10      JP  GET_SUBDIR
                                
       4C0D                     CPFILE:
000C0D 4C0D C5              11      PUSH    BC
000C0E 4C0E 01000B          10      LD  BC,00B00H
       4C11                     CPSTR1:
000C11 4C11 1A               7      LD  A,(DE)
000C12 4C12 FE3F             7      CP  '?'     ;Wild card
000C14 4C14 2812            12      JR  Z,CPSTR2
000C16 4C16 7E               7      LD  A,(HL)
000C17 4C17 CD854B          17      CALL    FKANC
000C1A 4C1A E5              11      PUSH    HL
000C1B 4C1B 67               4      LD  H,A
000C1C 4C1C 1A               7      LD  A,(DE)
000C1D 4C1D CB01             4      RLC C
000C1F 4C1F CD854B          17      CALL    FKANC
000C22 4C22 CB09             4      RRC C
000C24 4C24 BC               4      CP  H       ;CP (HL),(DE)
000C25 4C25 E1              10      POP HL
000C26 4C26 2004            12      JR  NZ,CPSTR3
       4C28                     CPSTR2:
000C28 4C28 13               6      INC DE
000C29 4C29 23               6      INC HL
000C2A 4C2A 10E5            13      DJNZ    CPSTR1
       4C2C                     CPSTR3:
000C2C 4C2C C1              10      POP BC
000C2D 4C2D C9              10      RET
                                
       4C2E                     CPFILE2:
                                ;   LD  A,0E1H
000C2E 4C2E 3EF1             7      LD  A,0F1H
000C30 4C30 2F               4      CPL
000C31 4C31 A6               7      AND (HL)
000C32 4C32 C9              10      RET
                                
       4C33                     RBX1:
000C33 4C33 E5              11      PUSH    HL      ;Record byte
                                
000C34 4C34 ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000C38 4C38 3A29F1          13      LD  A,(RR_HIGH+1)
000C3B 4C3B 4F               4      LD  C,A
                                
000C3C 4C3C 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
000C3F 4C3F 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C42 4C42 FD2A47F1        20      LD  IY,(DIRENT1)
000C46 4C46 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000C49 4C49 FD661D          19      LD  H,(IY+01DH)
000C4C 4C4C FD7E1E          19      LD  A,(IY+01EH)
                                
000C4F 4C4F A7               4      AND A
000C50 4C50 ED52            15      SBC HL,DE
000C52 4C52 99               4      SBC A,C
000C53 4C53 D1              10      POP DE
                                
000C54 4C54 D8              11      RET C
000C55 4C55 4F               4      LD  C,A
000C56 4C56 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000C57 4C57 B2               4      OR  D
000C58 4C58 B3               4      OR  E
000C59 4C59 C0              11      RET NZ
000C5A 4C5A 37               4      SCF
000C5B 4C5B C9              10      RET
                                
       4C5C                     RBX2:
000C5C 4C5C ED4B27F1        20      LD  BC,(RR_LOW+1)
000C60 4C60 CDE14C          17      CALL    RWXR
000C63 4C63 3A23F1          13      LD  A,(CLSZ_H)
000C66 4C66 3D               4      DEC A
000C67 4C67 E5              11      PUSH    HL
000C68 4C68 2A26F1          16      LD  HL,(RR_LOW)
000C6B 4C6B A4               4      AND H
000C6C 4C6C B5               4      OR  L
000C6D 4C6D E1              10      POP HL
000C6E 4C6E C9              10      RET
                                
       4C6F                     RBXA:
000C6F 4C6F D5              11      PUSH    DE
000C70 4C70 CD504D          17      CALL    CLUST
000C73 4C73 ED532EF1        20      LD  (_DTPS),DE
000C77 4C77 D1              10      POP DE
000C78 4C78 CD2D4D          17      CALL    GNCL
000C7B 4C7B D8              11      RET C
000C7C 4C7C ED532AF1        20      LD  (_CLPS),DE
                                
000C80 4C80 ED4B26F1        20      LD  BC,(RR_LOW)
000C84 4C84 2A22F1          16      LD  HL,(CLSZ)
000C87 4C87 7C               4      LD  A,H
000C88 4C88 3D               4      DEC A
000C89 4C89 A0               4      AND B
000C8A 4C8A 47               4      LD  B,A
000C8B 4C8B ED42            15      SBC HL,BC       ;remaining cluster
                                
000C8D 4C8D ED5B4AF1        20      LD  DE,(LEFTX)
000C91 4C91 ED52            15      SBC HL,DE       ;CP HL,DE
000C93 4C93 19              11      ADD HL,DE
000C94 4C94 3801            12      JR  C,RBXA1
000C96 4C96 EB               4      EX  DE,HL
       4C97                     RBXA1:
000C97 4C97 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
000C9A 4C9A 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C9D 4C9D E5              11      PUSH    HL
000C9E 4C9E 2A2EF1          16      LD  HL,(_DTPS)
000CA1 4CA1 09              11      ADD HL,BC
000CA2 4CA2 ED5B43F1        20      LD  DE,(DTAX)
000CA6 4CA6 C1              10      POP BC
000CA7 4CA7 C9              10      RET
                                
       4CA8                     RBXB:
000CA8 4CA8 2A43F1          16      LD  HL,(DTAX)
000CAB 4CAB ED5B2AF1        20      LD  DE,(_CLPS)
000CAF 4CAF 3A4BF1          13      LD  A,(LEFTX+1)
000CB2 4CB2 47               4      LD  B,A
000CB3 4CB3 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CB6                     RBXB1:
000CB6 4CB6 1F               4      RRA     ;->CF
000CB7 4CB7 3804            12      JR  C,RBXB2
000CB9 4CB9 CB38             8      SRL B   ;B=B/2
000CBB 4CBB 18F9            12      JR  RBXB1
       4CBD                     RBXB2:
000CBD 4CBD 78               4      LD  A,B
000CBE 4CBE B7               4      OR  A
000CBF 4CBF C9              10      RET
                                
       4CC0                     RBXC:
000CC0 4CC0 ED4B4AF1        20      LD  BC,(LEFTX)
000CC4 4CC4 3A23F1          13      LD  A,(CLSZ_H)
000CC7 4CC7 3D               4      DEC A
000CC8 4CC8 A0               4      AND B
000CC9 4CC9 47               4      LD  B,A
000CCA 4CCA B1               4      OR  C
000CCB 4CCB C9              10      RET
                                
       4CCC                     RBXEND:
000CCC 4CCC ED5B2CF1        20      LD  DE,(_LEFT)
000CD0 4CD0 2A26F1          16      LD  HL,(RR_LOW)
000CD3 4CD3 3A29F1          13      LD  A,(RR_HIGH+1)
000CD6 4CD6 19              11      ADD HL,DE
000CD7 4CD7 CE00             7      ADC A,0
000CD9 4CD9 2226F1          16      LD  (RR_LOW),HL
000CDC 4CDC 3229F1          13      LD  (RR_HIGH+1),A
000CDF 4CDF EB               4      EX  DE,HL       ;HL=Read byte
000CE0 4CE0 C9              10      RET 
                                
       4CE1                     RWXR:
000CE1 4CE1 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CE4                     L_RWX:
000CE4 4CE4 1F               4      RRA     ;->CF
000CE5 4CE5 3806            12      JR  C,E_RWX
000CE7 4CE7 CB38             8      SRL B   ;BC=BC/2
000CE9 4CE9 CB19             8      RR  C   ;
000CEB 4CEB 18F7            12      JR  L_RWX
       4CED                     E_RWX:
000CED 4CED 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
000CF0 4CF0 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000CF3 4CF3 FD2A47F1        20      LD  IY,(DIRENT1)
000CF7 4CF7 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000CFA 4CFA FD561B          19      LD  D,(IY+01BH)
000CFD 4CFD CD9550          17      CALL    GET_DISK_BANK_FDRV
       4D00                     RWX1:
000D00 4D00 ED532AF1        20      LD  (_CLPS),DE
000D04 4D04 7A               4      LD  A,D
000D05 4D05 B3               4      OR  E
000D06 4D06 37               4      SCF
000D07 4D07 C8              11      RET Z
                                
000D08 4D08 78               4      LD  A,B
000D09 4D09 B1               4      OR  C
000D0A 4D0A C8              11      RET Z
                                
000D0B 4D0B CD2D4D          17      CALL    GNCL
000D0E 4D0E D8              11      RET C
000D0F 4D0F 0B               6      DEC BC
000D10 4D10 CDA24D          17      CALL    ENDCL
000D13 4D13 38EB            12      JR  C,RWX1
000D15 4D15 37               4      SCF
000D16 4D16 C9              10      RET
                                
       4D17                     NCL3:
000D17 4D17 CD9550          17      CALL    GET_DISK_BANK_FDRV
000D1A 4D1A 6B               4      LD  L,E
000D1B 4D1B 62               4      LD  H,D
000D1C 4D1C CB3C             8      SRL H
000D1E 4D1E CB1D             8      RR  L
000D20 4D20 1F               4      RRA
000D21 4D21 19              11      ADD HL,DE
000D22 4D22 010060          10      LD  BC,BANK1_ADR
000D25 4D25 09              11      ADD HL,BC
000D26 4D26 ED4B24F1        20      LD  BC,(SECSZ)
000D2A 4D2A 09              11      ADD HL,BC
000D2B 4D2B 17               4      RLA
000D2C 4D2C C9              10      RET
                                
       4D2D                     GNCL:
000D2D 4D2D 7A               4      LD  A,D
000D2E 4D2E B3               4      OR  E
000D2F 4D2F 37               4      SCF
000D30 4D30 C8              11      RET Z
000D31 4D31 C5              11      PUSH    BC
000D32 4D32 E5              11      PUSH    HL
000D33 4D33 CD174D          17      CALL    NCL3
000D36 4D36 3809            12      JR  C,GNC1
000D38 4D38 5E               7      LD  E,(HL)
000D39 4D39 23               6      INC HL
000D3A 4D3A 7E               7      LD  A,(HL)
000D3B 4D3B E60F             7      AND 00FH
000D3D 4D3D 57               4      LD  D,A
000D3E 4D3E E1              10      POP HL
000D3F 4D3F C1              10      POP BC
000D40 4D40 C9              10      RET
       4D41                     GNC1:
000D41 4D41 7E               7      LD  A,(HL)
000D42 4D42 23               6      INC HL
000D43 4D43 56               7      LD  D,(HL)
000D44 4D44 0604             7      LD  B,4
       4D46                     GNC1L:
000D46 4D46 CB3A             8      SRL D
000D48 4D48 1F               4      RRA
000D49 4D49 10FB            13      DJNZ    GNC1L
                                
000D4B 4D4B 5F               4      LD  E,A
000D4C 4D4C E1              10      POP HL
000D4D 4D4D C1              10      POP BC
000D4E 4D4E A7               4      AND A
000D4F 4D4F C9              10      RET
                                
       4D50                     CLUST:
000D50 4D50 EB               4      EX  DE,HL
       4D51                     CLUST_HL:
000D51 4D51 C5              11      PUSH    BC
000D52 4D52 3A23F1          13      LD  A,(CLSZ_H)
000D55 4D55 CDBE50          17      CALL    MUL_AHL
                                
000D58 4D58 CD234E          17      CALL    GET_DIR_POS
000D5B 4D5B 4F               4      LD  C,A
000D5C 4D5C 0600             7      LD  B,0
000D5E 4D5E 09              11      ADD HL,BC
                                
000D5F 4D5F 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000D62 4D62 1F               4      RRA
000D63 4D63 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D66 4D66 1F               4      RRA
000D67 4D67 0F               4      RRCA
000D68 4D68 0F               4      RRCA
000D69 4D69 0F               4      RRCA
000D6A 4D6A 4F               4      LD  C,A
                                
000D6B 4D6B 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D6E 4D6E FE02             7      CP  2
000D70 4D70 280C            12      JR  Z,CLUST1
000D72 4D72 CB01             4      RLC C
000D74 4D74 0D               4      DEC C
000D75 4D75 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000D78 4D78 FE02             7      CP  2
000D7A 4D7A 2002            12      JR  NZ,CLUST1
000D7C 4D7C 0D               4      DEC C
000D7D 4D7D 0D               4      DEC C
       4D7E                     CLUST1:
000D7E 4D7E 0D               4      DEC C
000D7F 4D7F 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000D80 4D80 7D               4      LD  A,L
000D81 4D81 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000D84 4D84 09              11      ADD HL,BC
000D85 4D85 3013            12      JR  NC,CLUST2
000D87 4D87 4D               4      LD  C,L     ;C=読み出し元
000D88 4D88 29              11      ADD HL,HL   ;64KB→32KB
000D89 4D89 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000D8A 4D8A CD9550          17      CALL    GET_DISK_BANK_FDRV
000D8D 4D8D 84               4      ADD A,H
000D8E 4D8E 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000D91 4D91 3220F1          13      LD  (_BANK),A
000D94 4D94 69               4      LD  L,C     ;C=読み出し元
000D95 4D95 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000D97 4D97 A5               4      AND L
000D98 4D98 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4D9A                     CLUST2:
000D9A 4D9A C660             7      ADD A,high BANK1_ADR
000D9C 4D9C 67               4      LD  H,A
000D9D 4D9D 2E00             7      LD  L,0
000D9F 4D9F EB               4      EX  DE,HL
000DA0 4DA0 C1              10      POP BC
000DA1 4DA1 C9              10      RET
                                
       4DA2                     ENDCL:
000DA2 4DA2 7A               4      LD  A,D ;END CLUSTER
000DA3 4DA3 FE0F             7      CP  00FH    ;FAT12の最大値
000DA5 4DA5 C0              11      RET NZ
000DA6 4DA6 7B               4      LD  A,E
000DA7 4DA7 FEF7             7      CP  0F7H
000DA9 4DA9 C9              10      RET
                                
       4DAA                     RB_READ:
000DAA 4DAA AF               4      XOR A   ;HLA = HL*128
000DAB 4DAB CB3C             8      SRL H
000DAD 4DAD CB1D             8      RR  L
000DAF 4DAF 1F               4      RRA
000DB0 4DB0 3226F1          13      LD  (RR_LOW),A
000DB3 4DB3 2227F1          16      LD  (RR_MID),HL
000DB6 4DB6 218000          10      LD  HL,128
                                
000DB9 4DB9 CD9749          17      CALL    ROM_READ
000DBC 4DBC C9              10      RET
                                
       4DBD                     GETSEQ:
000DBD 4DBD FD6E20          19      LD  L,(IY+32)
000DC0 4DC0 FD660C          19      LD  H,(IY+12)
                                
000DC3 4DC3 CB25             8      SLA L
                                
000DC5 4DC5 CB3C             8      SRL H
000DC7 4DC7 CB1D             8      RR  L
000DC9 4DC9 C9              10      RET
                                
       4DCA                     SETSEQ:
000DCA 4DCA F5              11      PUSH    AF
000DCB 4DCB 3A26F1          13      LD  A,(RR_LOW)
000DCE 4DCE 2A27F1          16      LD  HL,(RR_MID)
                                
000DD1 4DD1 CDE84D          17      CALL    SSQ1
                                
000DD4 4DD4 29              11      ADD HL,HL
000DD5 4DD5 CB3D             8      SRL L
000DD7 4DD7 FD7520          19      LD  (IY+32),L
000DDA 4DDA FD740C          19      LD  (IY+12),H
000DDD 4DDD F1              10      POP AF
000DDE 4DDE C9              10      RET
                                
       4DDF                     GETSIZE:
000DDF 4DDF FD7E10          19      LD  A,(IY+16)
000DE2 4DE2 FD6E11          19      LD  L,(IY+17)
000DE5 4DE5 FD6612          19      LD  H,(IY+18)
       4DE8                     SSQ1:
000DE8 4DE8 87               4      ADD A,A
000DE9 4DE9 ED6A            15      ADC HL,HL
000DEB 4DEB B7               4      OR  A
000DEC 4DEC C8              11      RET Z
000DED 4DED 23               6      INC HL
000DEE 4DEE C9              10      RET
                                
       4DEF                     SET_FCB:
000DEF 4DEF D5              11      PUSH    DE
000DF0 4DF0 FDE1            14      POP IY
000DF2 4DF2 FD7E1C          19      LD  A,(IY+28)
000DF5 4DF5 FEFF             7      CP  0FFH
000DF7 4DF7 200C            12      JR  NZ,POPAF_SCF_FF_RET
000DF9 4DF9 E5              11      PUSH    HL
000DFA 4DFA FD6E1A          19      LD  L,(IY+26)
000DFD 4DFD FD661B          19      LD  H,(IY+27)
000E00 4E00 222AF1          16      LD  (_CLPS),HL
000E03 4E03 E1              10      POP HL
000E04 4E04 C9              10      RET
                                
       4E05                     POPAF_SCF_FF_RET:
000E05 4E05 F1              10      POP AF
000E06 4E06 37               4      SCF
000E07 4E07 9F               4      SBC A,A
000E08 4E08 C9              10      RET
                                
       4E09                     GET_DIR_DAT:
000E09 4E09 2A5EF1          16      LD  HL,(_CDX)
000E0C 4E0C 7C               4      LD  A,H
000E0D 4E0D B5               4      OR  L
000E0E 4E0E 2031            12      JR  NZ,GET_SUBDIR
000E10 4E10 CD234E          17      CALL    GET_DIR_POS
000E13 4E13 C660             7      ADD A,high BANK1_ADR
000E15 4E15 2E00             7      LD  L,0
000E17 4E17 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000E18 4E18 3A21F1          13      LD  A,(_BANK1)
000E1B 4E1B 3249F1          13      LD  (_DIR_BANK),A
                                
000E1E 4E1E 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000E21 4E21 4F               4      LD  C,A
000E22 4E22 C9              10      RET
                                
       4E23                     GET_DIR_POS:                ;ルートディレクトリ
000E23 4E23 CD9550          17      CALL    GET_DISK_BANK_FDRV
000E26 4E26 3221F1          13      LD  (_BANK1),A
000E29 4E29 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000E2C 4E2C 47               4      LD  B,A
000E2D 4E2D 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000E30 4E30 4F               4      LD  C,A
000E31 4E31 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4E34                     GET_DIR_POS1:
000E34 4E34 81               4      ADD A,C
000E35 4E35 10FD            13      DJNZ    GET_DIR_POS1
                                
000E37 4E37 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4E3B                     L_MDP:
000E3B 4E3B CB18             8      RR  B   ;->CF
000E3D 4E3D D8              11      RET C
000E3E 4E3E 87               4      ADD A,A
000E3F 4E3F 18FA            12      JR  L_MDP
                                
       4E41                     GET_SUBDIR:             ;サブディレクトリ
000E41 4E41 CD514D          17      CALL    CLUST_HL
000E44 4E44 EB               4      EX  DE,HL
000E45 4E45 3A20F1          13      LD  A,(_BANK)
000E48 4E48 3249F1          13      LD  (_DIR_BANK),A
000E4B 4E4B 3A23F1          13      LD  A,(CLSZ_H)
000E4E 4E4E 87               4      ADD A,A     ;*2
000E4F 4E4F 87               4      ADD A,A     ;*4
000E50 4E50 87               4      ADD A,A     ;*8
000E51 4E51 4F               4      LD  C,A
000E52 4E52 C9              10      RET
                                
       4E53                     STATEMENT:
000E53 4E53 11E14E          10      LD  DE,STR_CHDIR
000E56 4E56 CDC74E          17      CALL    CPPROCNM
000E59 4E59 280A            12      JR  Z,_CHDIR
000E5B 4E5B 11E74E          10      LD  DE,STR_RAMDISK
000E5E 4E5E CDC74E          17      CALL    CPPROCNM
000E61 4E61 2814            12      JR  Z,_RAMDISK
000E63 4E63 37               4      SCF
000E64 4E64 C9              10      RET
       4E65                     _CHDIR:
000E65 4E65 7E               7      LD  A,(HL)
000E66 4E66 FE28             7      CP  '('
000E68 4E68 37               4      SCF
000E69 4E69 C0              11      RET NZ
000E6A 4E6A CD4647          17      CALL    INIT_PARAM
000E6D 4E6D CD384A          17      CALL    FILE_B
000E70 4E70 CD8F4E          17      CALL    ROM_CD
000E73 4E73 DA1246          10      JP  C,ERROR_FILE_NOT_FOUND
000E76 4E76 C9              10      RET
                                
       4E77                     _RAMDISK:
000E77 4E77 7E               7      LD  A,(HL)
000E78 4E78 FE28             7      CP  '('
000E7A 4E7A 37               4      SCF
000E7B 4E7B C0              11      RET NZ
000E7C 4E7C 23               6      INC HL
000E7D 4E7D DD212F54        14      LD  IX,FRMQNT
000E81 4E81 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000E85 4E85 CD1C00          17      CALL    _CALSLT
                                ;   LD  A,(HOKVLD)  ;bit0: 拡張 BIOSの存在
                                ;   CPL
                                ;   AND 1
000E88 4E88 7A               4      LD  A,D
000E89 4E89 B3               4      OR  E
000E8A 4E8A C20C46          10      JP  NZ,ERROR_INTERNAL_ERROR
                                ;   PUSH    HL      ;EXTBIOもDISK BIOSで初期化してそう
                                ;   LD  A,0     ;すでにA=0になっている
                                ;   LD  DE,0401H    ;D=マッパサポートルチン(4) E=機能番号(1)
                                ;   CALL    EXTBIO
                                ;   POP HL
                                ;   OR  A
                                ;   JP  Z,ERROR_INTERNAL_ERROR
000E8D 4E8D 23               6      INC HL
000E8E 4E8E C9              10      RET
                                
       4E8F                     ROM_CD:
000E8F 4E8F 3A51F1          13      LD  A,(FNAME)
000E92 4E92 FE20             7      CP  020H
000E94 4E94 2822            12      JR  Z,CD1
000E96 4E96 CDB74B          17      CALL    ROM_OPEN
000E99 4E99 D8              11      RET C
000E9A 4E9A FD2A47F1        20      LD  IY,(DIRENT1)
000E9E 4E9E FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000EA2 4EA2 CA1246          10      JP  Z,ERROR_FILE_NOT_FOUND
000EA5 4EA5 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000EA8 4EA8 FD661B          19      LD  H,(IY+01BH)
       4EAB                     CD2:
000EAB 4EAB 225CF1          16      LD  (_CD),HL
000EAE 4EAE 2A4EF1          16      LD  HL,(PARAM1)
       4EB1                     CD_SKIP:
000EB1 4EB1 7E               7      LD  A,(HL)
000EB2 4EB2 23               6      INC HL
000EB3 4EB3 FE21             7      CP  021H
000EB5 4EB5 38FA            12      JR  C,CD_SKIP
000EB7 4EB7 C9              10      RET
       4EB8                     CD1:
000EB8 4EB8 2A5EF1          16      LD  HL,(_CDX)
000EBB 4EBB 18EE            12      JR  CD2
                                
       4EBD                     DEVICE1:
000EBD 4EBD 11EF4E          10      LD  DE,STR_A
000EC0 4EC0 CDC74E          17      CALL    CPPROCNM
000EC3 4EC3 37               4      SCF
000EC4 4EC4 C0              11      RET NZ
000EC5 4EC5 AF               4      XOR A
000EC6 4EC6 C9              10      RET
                                
       4EC7                     CPPROCNM:
000EC7 4EC7 E5              11      PUSH    HL
000EC8 4EC8 2189FD          10      LD  HL,PROCNM
       4ECB                     CPPROCNM1:
000ECB 4ECB 1A               7      LD  A,(DE)
000ECC 4ECC 13               6      INC DE
000ECD 4ECD BE               7      CP  (HL)
000ECE 4ECE 23               6      INC HL
000ECF 4ECF 2003            12      JR  NZ,CPPROCNM2
000ED1 4ED1 B7               4      OR  A
000ED2 4ED2 20F7            12      JR  NZ,CPPROCNM1
       4ED4                     CPPROCNM2:
000ED4 4ED4 E1              10      POP HL
000ED5 4ED5 C9              10      RET
                                
       4ED6                     WILDCARD:
000ED6 4ED6 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
                                
       4EE1                     STR_CHDIR:
000EE1 4EE1 434844495200            DB  "CHDIR",0
       4EE7                     STR_RAMDISK:
000EE7 4EE7 52414D4449534B00        DB  "RAMDISK",0
       4EEF                     STR_A:
000EEF 4EEF 4100                    DB  "A",0
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4EF1                     ERROR_WRITE_PROTECTED:
000EF1 4EF1 3E00             7      LD  A,0     ;Write protected
000EF3 4EF3 C9              10      RET
       4EF4                     DISKIO:
000EF4 4EF4 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000EF6 4EF6 48               4      LD  C,B
000EF7 4EF7 CD9F50          17      CALL    GET_DISK_BANK
       4EFA                     SETMAP1:        
000EFA 4EFA E5              11      PUSH    HL
       4EFB                     DISKIO1:
000EFB 4EFB C5              11      PUSH    BC      ;B=残りのセクタ数
000EFC 4EFC D5              11      PUSH    DE      ;DE=セクタ番号
000EFD 4EFD F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000EFE 4EFE EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000EFF 4EFF F5              11      PUSH    AF
000F00 4F00 3A25F1          13      LD  A,(SECSZ_H)
000F03 4F03 CDBE50          17      CALL    MUL_AHL
000F06 4F06 F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
000F07 4F07 7D               4      LD  A,L
000F08 4F08 C5              11      PUSH    BC
000F09 4F09 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000F0C 4F0C 09              11      ADD HL,BC
000F0D 4F0D C1              10      POP BC
000F0E 4F0E 3013            12      JR  NC,DISKIO2
000F10 4F10 4D               4      LD  C,L     ;C=読み出し元
000F11 4F11 29              11      ADD HL,HL   ;64KB→32KB
000F12 4F12 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000F13 4F13 CD9550          17      CALL    GET_DISK_BANK_FDRV
000F16 4F16 84               4      ADD A,H
000F17 4F17 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000F1A 4F1A 3220F1          13      LD  (_BANK),A
000F1D 4F1D 69               4      LD  L,C     ;C=読み出し元
000F1E 4F1E 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000F20 4F20 A5               4      AND L
000F21 4F21 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4F23                     DISKIO2:
000F23 4F23 C660             7      ADD A,high BANK1_ADR
000F25 4F25 67               4      LD  H,A
000F26 4F26 ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000F2A 4F2A 69               4      LD  L,C     ;C=0
000F2B 4F2B CD2E44          17      CALL    ROM_LDIR
000F2E 4F2E EB               4      EX  DE,HL
000F2F 4F2F F1              10      POP AF
000F30 4F30 D1              10      POP DE
000F31 4F31 13               6      INC DE
000F32 4F32 C1              10      POP BC
000F33 4F33 10C6            13      DJNZ    DISKIO1
000F35 4F35 41               4      LD  B,C
                                
000F36 4F36 E1              10      POP HL
000F37 4F37 AF               4      XOR A
                                
000F38 4F38 FB               4      EI
000F39 4F39 C9              10      RET
                                
       4F3A                     DSKCHG:
000F3A 4F3A CD734F          17      CALL    IS_BPB
000F3D 4F3D 3824            12      JR  C,NOTREADY
000F3F 4F3F 3A23FB          13      LD  A,(DRVTBL+2)
000F42 4F42 B7               4      OR  A
000F43 4F43 201A            12      JR  NZ,DSKCHG1
000F45 4F45 3A21FB          13      LD  A,(DRVTBL)
000F48 4F48 FE02             7      CP  2
000F4A 4F4A 2013            12      JR  NZ,DSKCHG1
000F4C 4F4C CD734F          17      CALL    IS_BPB
000F4F 4F4F 300E            12      JR  NC,DSKCHG1
000F51 4F51 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000F53 4F53 3221FB          13      LD  (DRVTBL),A
000F56 4F56 3223FB          13      LD  (DRVTBL+2),A
000F59 4F59 3A48F3          13      LD  A,(MASTERS)
000F5C 4F5C 3224FB          13      LD  (DRVTBL+3),A
       4F5F                     DSKCHG1:
000F5F 4F5F AF               4      XOR A
000F60 4F60 0601             7      LD  B,1
000F62 4F62 C9              10      RET
       4F63                     NOTREADY:
000F63 4F63 3E02             7      LD  A,2
000F65 4F65 37               4      SCF
000F66 4F66 C9              10      RET
                                
       4F67                     NO_BPB:
000F67 4F67 E1              10      POP HL
000F68 4F68 23               6      INC HL
000F69 4F69 11C450          10      LD  DE,DPB2DD
000F6C 4F6C 011200          10      LD  BC,DPB2DD_E-DPB2DD
000F6F 4F6F EDB0                    LDIR
000F71 4F71 AF               4      XOR A
000F72 4F72 C9              10      RET
                                
       4F73                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000F73 4F73 CD9F50          17      CALL    GET_DISK_BANK
                                
000F76 4F76 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000F79 4F79 FE01             7      CP  1
000F7B 4F7B D8              11      RET C
                                
000F7C 4F7C 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000F7F 4F7F C6FF             7      ADD A,0FFH
000F81 4F81 D8              11      RET C
                                
000F82 4F82 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000F85 4F85 FE01             7      CP  1
000F87 4F87 C8              11      RET Z
000F88 4F88 FE02             7      CP  2
000F8A 4F8A C8              11      RET Z
000F8B 4F8B FE04             7      CP  4
000F8D 4F8D C8              11      RET Z
000F8E 4F8E 37               4      SCF
000F8F 4F8F C9              10      RET
                                
       4F90                     GETDPB:
000F90 4F90 E5              11      PUSH    HL
000F91 4F91 CD9F50          17      CALL    GET_DISK_BANK
                                
000F94 4F94 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000F97 4F97 B7               4      OR  A
000F98 4F98 28CD            12      JR  Z,NO_BPB
000F9A 4F9A DDE1            14      POP IX
000F9C 4F9C DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F9F 4F9F 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000FA2 4FA2 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000FA5 4FA5 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000FA8 4FA8 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000FAB 4FAB 87               4      ADD A,A
000FAC 4FAC 87               4      ADD A,A
000FAD 4FAD 87               4      ADD A,A
000FAE 4FAE 3D               4      DEC A
000FAF 4FAF DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000FB2 4FB2 06FF             7      LD  B,-1
000FB4 4FB4 A7               4      AND A           ;無限ループ阻止
       4FB5                     GETDPB1:
000FB5 4FB5 04               4      INC B
000FB6 4FB6 1F               4      RRA
000FB7 4FB7 38FC            12      JR  C,GETDPB1
000FB9 4FB9 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000FBC 4FBC 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000FBF 4FBF 3D               4      DEC A
000FC0 4FC0 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000FC3 4FC3 A7               4      AND A           ;無限ループ阻止
000FC4 4FC4 06FF             7      LD  B,-1
       4FC6                     GETDPB2:
000FC6 4FC6 04               4      INC B
000FC7 4FC7 1F               4      RRA
000FC8 4FC8 38FC            12      JR  C,GETDPB2
000FCA 4FCA 04               4      INC B
000FCB 4FCB DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000FCE 4FCE 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000FD1 4FD1 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000FD4 4FD4 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000FD7 4FD7 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000FDA 4FDA DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000FDD 4FDD 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000FE0 4FE0 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000FE3 4FE3 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000FE7 4FE7 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000FEA 4FEA DD460A          19      LD  B,(IX+10)       ;FATCNT
000FED 4FED 210000          10      LD  HL,0
       4FF0                     GETDPB3:
000FF0 4FF0 19              11      ADD HL,DE
000FF1 4FF1 10FD            13      DJNZ    GETDPB3
       4FF3                     GETDPB4:
000FF3 4FF3 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000FF6 4FF6 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000FF9 4FF9 19              11      ADD HL,DE
000FFA 4FFA DD7511          19      LD  (IX+17),L       ;FIRDIR
000FFD 4FFD DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
001000 5000 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001003 5003 87               4      ADD A,A
001004 5004 87               4      ADD A,A
001005 5005 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5008                     GETDPB5:
001008 5008 CB3B             8      SRL E
00100A 500A 1F               4      RRA
00100B 500B 30FB            12      JR  NC,GETDPB5
00100D 500D 1600             7      LD  D,0
00100F 500F 19              11      ADD HL,DE
001010 5010 DD750C          19      LD  (IX+12),L       ;FIRREC
001013 5013 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001016 5016 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
001019 5019 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
00101C 501C DD560D          19      LD  D,(IX+13)       ;FIRREC
00101F 501F A7               4      AND A
001020 5020 ED52            15      SBC HL,DE
                                
001022 5022 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
001025 5025 3C               4      INC A
001026 5026 37               4      SCF             ;無限ループ阻止
       5027                     GETDPB6:
001027 5027 1F               4      RRA
001028 5028 3806            12      JR  C,GETDPB7
00102A 502A CB3C             8      SRL H
00102C 502C CB1D             8      RR  L
00102E 502E 18F7            12      JR  GETDPB6
       5030                     GETDPB7:
001030 5030 23               6      INC HL
001031 5031 DD750E          19      LD  (IX+14),L       ;MAXCLUS
001034 5034 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       5037                     GETDPBD1:
001037 5037 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00103A 503A E6FC             7      AND 0FCH
00103C 503C C8              11      RET Z
                                
00103D 503D DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
001041 5041 37               4      SCF
001042 5042 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
001046 5046 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
001049 5049 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
00104D 504D DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001051 5051 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
001055 5055 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
001059 5059 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
00105D 505D DDCB1126        23      SLA (IX+17)         ;FIRDIR
001061 5061 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
001065 5065 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
001068 5068 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
00106B 506B DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00106E 506E 87               4      ADD A,A
00106F 506F 87               4      ADD A,A
001070 5070 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5073                     GETDPBD5:
001073 5073 CB3B             8      SRL E
001075 5075 1F               4      RRA
001076 5076 30FB            12      JR  NC,GETDPBD5
001078 5078 1600             7      LD  D,0
00107A 507A 19              11      ADD HL,DE
00107B 507B DD750C          19      LD  (IX+12),L       ;FIRREC
00107E 507E DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001081 5081 18B4            12      JR  GETDPBD1
                                
       5083                     CHOICE:
001083 5083 210000          10      LD  HL,0
001086 5086 C9              10      RET
                                
       5087                     DSKFMT:
001087 5087 AF               4      XOR A
001088 5088 37               4      SCF
       5089                     DSKSTP:
001089 5089 C9              10      RET
                                
       508A                     BASENT:
00108A 508A ED7B60F1        20      LD  SP,(BASSTK)
00108E 508E C3CB43          10      JP  BASAUTO
                                
       5091                     GETSLT:
001091 5091 3A22FB          13      LD  A,(DRVTBL+1)
001094 5094 C9              10      RET
                                
       5095                     GET_DISK_BANK_FDRV:
001095 5095 3A50F1          13      LD  A,(FDRV)
001098 5098 D601             7      SUB 1
00109A 509A 3003            12      JR  NC,GET_DISK_BANK
00109C 509C 3A46F1          13      LD  A,(_DVSW)
       509F                     GET_DISK_BANK:
00109F 509F B7               4      OR  A       ;A=DRIVE
0010A0 50A0 3E01             7      LD  A,DISK_BANK
0010A2 50A2 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
0010A4 50A4 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       50A7                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
0010A7 50A7 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0010AA 50AA F5              11      PUSH    AF
0010AB 50AB E5              11      PUSH    HL
0010AC 50AC 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
0010AF 50AF 2224F1          16      LD  (SECSZ),HL
0010B2 50B2 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
0010B5 50B5 CDBE50          17      CALL    MUL_AHL
0010B8 50B8 2222F1          16      LD  (CLSZ),HL
0010BB 50BB E1              10      POP HL
0010BC 50BC F1              10      POP AF
0010BD 50BD C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       50BE                     MUL_AHL:
0010BE 50BE 37               4      SCF     ;無限ループ回避
       50BF                     MUL_AHL1:
0010BF 50BF 1F               4      RRA     ;->CF
0010C0 50C0 D8              11      RET C
0010C1 50C1 29              11      ADD HL,HL
0010C2 50C2 18FB            12      JR  MUL_AHL1
                                
       50C4                     DPB2DD:
0010C4 50C4 F9                      DB  0F9H    ;MEDIA
0010C5 50C5 0002                    DW  00200H  ;SECSIZ
0010C7 50C7 0F                      DB  00FH    ;DIRMSK
0010C8 50C8 04                      DB  004H    ;DIRSHFT
0010C9 50C9 01                      DB  001H    ;CLUSMSK
0010CA 50CA 02                      DB  002H    ;CLUSSHFT
0010CB 50CB 0100                    DW  00001H  ;FIRFAT
0010CD 50CD 02                      DB  002H    ;FATCNT
0010CE 50CE 70                      DB  070H    ;MAXENT
0010CF 50CF 0E00                    DW  0000EH  ;FIRREC
0010D1 50D1 CA02                    DW  002CAH  ;MAXCLUS
0010D3 50D3 03                      DB  003H    ;FATSIZ
0010D4 50D4 0700                    DW  0007H   ;FIRDIR
       50D6                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       50D6                     POP_HL_ERROR:
0010D6 50D6 E1              10      POP     HL
       50D7                     _ERROR:
0010D7 50D7 0600             7      LD  B,0
0010D9 50D9 A7               4      AND A
0010DA 50DA C9              10      RET
                                
       50DB                     ROM_BDOS:
0010DB 50DB E5              11      PUSH    HL
0010DC 50DC 79               4      LD  A,C
0010DD 50DD 87               4      ADD A,A
0010DE 50DE 38F7            12      JR  C,_ERROR
0010E0 50E0 6F               4      LD  L,A
0010E1 50E1 265F             7      LD  H,high STABLE
0010E3 50E3 7E               7      LD  A,(HL)
0010E4 50E4 2C               4      INC L
0010E5 50E5 66               7      LD  H,(HL)
0010E6 50E6 6F               4      LD  L,A
0010E7 50E7 E3              19      EX  (SP),HL
0010E8 50E8 79               4      LD  A,C
0010E9 50E9 C9              10      RET
                                
       50EA                     _PRINT:
       50EA                     PRINT:
0010EA 50EA 7B               4      LD  A,E
0010EB 50EB 1803            12      JR  MSG_A
                                
       50ED                     _SYS01:     ;(BDOS)コンソール入力
0010ED 50ED CD6451          17      CALL    _SYS07
       50F0                     MSG_A:
0010F0 50F0 FE03             7      CP  3
0010F2 50F2 2814            12      JR  Z,MSG_BR
       50F4                     MSGA1:
0010F4 50F4 F5              11      PUSH    AF
0010F5 50F5 C5              11      PUSH    BC
0010F6 50F6 D5              11      PUSH    DE
0010F7 50F7 E5              11      PUSH    HL
0010F8 50F8 DDE5            15      PUSH    IX
0010FA 50FA DD21A200        14      LD  IX,CHPUT
0010FE 50FE CDFA42          17      CALL    CALSLT_R
001101 5101 DDE1            14      POP IX
001103 5103 E1              10      POP HL
001104 5104 D1              10      POP DE
001105 5105 C1              10      POP BC
       5106                     MSGA2:
001106 5106 F1              10      POP AF
001107 5107 C9              10      RET
       5108                     MSG_BR:
001108 5108 F5              11      PUSH    AF
001109 5109 3ADDF3          13      LD  A,(CSRX)
00110C 510C FE02             7      CP  2
00110E 510E 38F6            12      JR  C,MSGA2
001110 5110 F1              10      POP AF
       5111                     MSG_CR:
001111 5111 F5              11      PUSH    AF
001112 5112 3E0D             7      LD  A,00DH
001114 5114 CDF450          17      CALL    MSGA1
001117 5117 3E0A             7      LD  A,00AH
001119 5119 CDF450          17      CALL    MSGA1
00111C 511C F1              10      POP AF
00111D 511D C9              10      RET
                                
       511E                     _SYS02:     ;(BDOS)コンソール出力
00111E 511E CD3951          17      CALL    BREAK
001121 5121 1805            12      JR  PRINTX
                                
       5123                     _SYS06:     ;(BDOS)コンソール直接入出力
001123 5123 7B               4      LD  A,E
001124 5124 3C               4      INC A
001125 5125 CA7851          10      JP  Z,_INKEY
       5128                     PRINTX:
001128 5128 C3EA50          10      JP  _PRINT
                                
       512B                     _SYS08:     ;(BDOS)エコーなしコンソール入力
00112B 512B CD6451          17      CALL    _SYS07
00112E 512E FE03             7      CP  3
001130 5130 CC3951          17      CALL    Z,_BREAK
001133 5133 FE13             7      CP  013H        ;CTRL+S
001135 5135 C0              11      RET NZ
       5136                     PAUSE:
001136 5136 CD5051          17      CALL    KEYBC
                                
       5139                     _BREAK:
       5139                     BREAK:
001139 5139 F5              11      PUSH    AF
00113A 513A C5              11      PUSH    BC
00113B 513B D5              11      PUSH    DE
00113C 513C E5              11      PUSH    HL
00113D 513D DDE5            15      PUSH    IX
00113F 513F DD21B700        14      LD  IX,BREAKX
001143 5143 CDFA42          17      CALL    CALSLT_R
001146 5146 DDE1            14      POP IX
001148 5148 E1              10      POP HL
001149 5149 D1              10      POP DE
00114A 514A C1              10      POP BC
00114B 514B DC3951          17      CALL    C,_BREAK
00114E 514E F1              10      POP AF
00114F 514F C9              10      RET
       5150                     KEYBC:
001150 5150 F5              11      PUSH    AF
001151 5151 C5              11      PUSH    BC
001152 5152 D5              11      PUSH    DE
001153 5153 E5              11      PUSH    HL
001154 5154 DDE5            15      PUSH    IX
001156 5156 DD215601        14      LD  IX,KILBUF
00115A 515A CDFA42          17      CALL    CALSLT_R
00115D 515D DDE1            14      POP IX
00115F 515F E1              10      POP HL
001160 5160 D1              10      POP DE
001161 5161 C1              10      POP BC
001162 5162 F1              10      POP AF
001163 5163 C9              10      RET
                                
       5164                     _SYS07:
       5164                     FLGET:
001164 5164 C5              11      PUSH    BC
001165 5165 D5              11      PUSH    DE
001166 5166 E5              11      PUSH    HL
001167 5167 DDE5            15      PUSH    IX
001169 5169 DD219F00        14      LD  IX,CHGET
00116D 516D CDFA42          17      CALL    CALSLT_R
001170 5170 DDE1            14      POP IX
001172 5172 E1              10      POP HL
001173 5173 D1              10      POP DE
001174 5174 C1              10      POP BC
001175 5175 FE03             7      CP  3
001177 5177 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       5178                     _INKEY:
       5178                     INKEY:
001178 5178 CD1252          17      CALL    CPM_CONST
00117B 517B C8              11      RET Z
00117C 517C 18E6            12      JR  FLGET
                                
       517E                     _SYS0A:     ;(BDOS)文字列入力
00117E 517E C5              11      PUSH    BC
00117F 517F E5              11      PUSH    HL
001180 5180 D5              11      PUSH    DE
001181 5181 CDAA51          17      CALL    GETL
001184 5184 111FF4          10      LD  DE,KBUF
001187 5187 E1              10      POP HL
001188 5188 E5              11      PUSH    HL
001189 5189 0E00             7      LD  C,0
00118B 518B 3004            12      JR  NC,SAX0
00118D 518D 23               6      INC HL
00118E 518E 23               6      INC HL
00118F 518F 1808            12      JR  SAX4
       5191                     SAX0:
001191 5191 46               7      LD  B,(HL)
001192 5192 23               6      INC HL
       5193                     SAX1:
001193 5193 23               6      INC HL
001194 5194 1A               7      LD  A,(DE)
001195 5195 13               6      INC DE
001196 5196 B7               4      OR  A
001197 5197 2004            12      JR  NZ,SAX2
       5199                     SAX4:
001199 5199 360D            10      LD  (HL),00DH
00119B 519B 1804            12      JR  SAX3
       519D                     SAX2:
00119D 519D 77               7      LD  (HL),A
00119E 519E 0C               4      INC C
00119F 519F 10F2            13      DJNZ    SAX1
       51A1                     SAX3:
0011A1 51A1 D1              10      POP DE
0011A2 51A2 79               4      LD  A,C
0011A3 51A3 13               6      INC DE
0011A4 51A4 12               7      LD  (DE),A
0011A5 51A5 1B               6      DEC DE
0011A6 51A6 E1              10      POP HL
0011A7 51A7 C1              10      POP BC
0011A8 51A8 A7               4      AND A
0011A9 51A9 C9              10      RET
       51AA                     GETL:
0011AA 51AA DDE5            15      PUSH    IX
0011AC 51AC FDE5            15      PUSH    IY
                                
0011AE 51AE 2ADCF3          16      LD  HL,(CSRY)
0011B1 51B1 22CAFB          16      LD  (FSTPOS),HL
       51B4                     GETL1:
0011B4 51B4 CD2B51          17      CALL    _SYS08
0011B7 51B7 FE09             7      CP  9
0011B9 51B9 2008            12      JR  NZ,GETL1V
0011BB 51BB 211FF4          10      LD  HL,KBUF
0011BE 51BE CD8643          17      CALL    MSX
0011C1 51C1 18F1            12      JR  GETL1
       51C3                     GETL1V:
0011C3 51C3 5F               4      LD  E,A
0011C4 51C4 FE08             7      CP  8
0011C6 51C6 CC6052          17      CALL    Z,CTRL02
0011C9 51C9 FE20             7      CP  020H
0011CB 51CB D48C52          17      CALL    NC,INSERT
0011CE 51CE CDF450          17      CALL    MSGA1
                                
0011D1 51D1 7B               4      LD  A,E
0011D2 51D2 FE0D             7      CP  00DH
0011D4 51D4 20DE            12      JR  NZ,GETL1
                                
0011D6 51D6 111FF4          10      LD  DE,KBUF
0011D9 51D9 3AB0F3          13      LD  A,(LINLEN)
0011DC 51DC 47               4      LD  B,A
0011DD 51DD CD6A54          17      CALL    ZERO_MEMORY_DE
                                
0011E0 51E0 2ACAFB          16      LD  HL,(FSTPOS)
0011E3 51E3 3ADCF3          13      LD  A,(CSRY)
0011E6 51E6 6F               4      LD  L,A
0011E7 51E7 E5              11      PUSH    HL
0011E8 51E8 CDBD52          17      CALL    LOC0
0011EB 51EB 4D               4      LD  C,L
0011EC 51EC 44               4      LD  B,H
0011ED 51ED E1              10      POP HL
0011EE 51EE 3AB0F3          13      LD  A,(LINLEN)
0011F1 51F1 94               4      SUB H
0011F2 51F2 3D               4      DEC A
0011F3 51F3 5F               4      LD  E,A
0011F4 51F4 211FF4          10      LD  HL,KBUF
       51F7                     GETL2:
0011F7 51F7 CD5052          17      CALL    _SCRN
0011FA 51FA 03               6      INC BC
0011FB 51FB 77               7      LD  (HL),A
0011FC 51FC 23               6      INC HL
0011FD 51FD 1D               4      DEC E
0011FE 51FE 20F7            12      JR  NZ,GETL2
001200 5200 CD1151          17      CALL    MSG_CR
                                
001203 5203 FDE1            14      POP IY
001205 5205 DDE1            14      POP IX
       5207                     GETL3:
001207 5207 2B               6      DEC HL
001208 5208 7E               7      LD  A,(HL)
001209 5209 FE21             7      CP  021H
00120B 520B D0              11      RET NC
00120C 520C 3600            10      LD  (HL),0
00120E 520E 15               4      DEC D
00120F 520F 20F6            12      JR  NZ,GETL3
001211 5211 C9              10      RET
                                
       5212                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       5212                     CONSTX:
       5212                     CPM_CONST:
001212 5212 C5              11      PUSH    BC
001213 5213 D5              11      PUSH    DE
001214 5214 E5              11      PUSH    HL
001215 5215 DDE5            15      PUSH    IX
001217 5217 DD219C00        14      LD  IX,CHSNS
00121B 521B CDFA42          17      CALL    CALSLT_R
00121E 521E DDE1            14      POP IX
001220 5220 E1              10      POP HL
001221 5221 D1              10      POP DE
001222 5222 C1              10      POP BC
001223 5223 C9              10      RET
                                
       5224                     _SYS2A:     ;(BDOS)日付の獲得
001224 5224 AF               4      XOR A
001225 5225 57               4      LD  D,A
001226 5226 5F               4      LD  E,A
001227 5227 67               4      LD  H,A
001228 5228 6F               4      LD  L,A
001229 5229 C9              10      RET
                                
       522A                     _SYS2C:     ;(BDOS)時刻の獲得
00122A 522A AF               4      XOR A
00122B 522B 57               4      LD  D,A
00122C 522C 5F               4      LD  E,A
00122D 522D 67               4      LD  H,A
00122E 522E 6F               4      LD  L,A
00122F 522F C9              10      RET
                                
       5230                     POS:
001230 5230 F5              11      PUSH    AF
001231 5231 2ADCF3          16      LD  HL,(CSRY)
001234 5234 7D               4      LD  A,L
001235 5235 6C               4      LD  L,H
001236 5236 67               4      LD  H,A
001237 5237 2C               4      INC L
001238 5238 24               4      INC H
001239 5239 F1              10      POP AF
00123A 523A C9              10      RET
                                
       523B                     LOC:
00123B 523B F5              11      PUSH    AF
00123C 523C E5              11      PUSH    HL
00123D 523D 7D               4      LD  A,L
00123E 523E 6C               4      LD  L,H
00123F 523F 67               4      LD  H,A
001240 5240 2D               4      DEC L
001241 5241 25               4      DEC H
001242 5242 DDE5            15      PUSH    IX
001244 5244 DD21C600        14      LD  IX,POSIT
001248 5248 CDFA42          17      CALL    CALSLT_R
00124B 524B DDE1            14      POP IX
00124D 524D E1              10      POP HL
00124E 524E F1              10      POP AF
00124F 524F C9              10      RET
                                
       5250                     _SCRN:
       5250                     SCRN:
001250 5250 E5              11      PUSH    HL
001251 5251 DDE5            15      PUSH    IX
                                
001253 5253 69               4      LD  L,C
001254 5254 60               4      LD  H,B
001255 5255 DD214A00        14      LD  IX,RDVRM
001259 5259 CDFA42          17      CALL    CALSLT_R
                                
00125C 525C DDE1            14      POP IX
00125E 525E E1              10      POP HL
00125F 525F C9              10      RET
                                
       5260                     CTRL02:
001260 5260 F5              11      PUSH    AF
001261 5261 D5              11      PUSH    DE
001262 5262 2ADCF3          16      LD  HL,(CSRY)
001265 5265 3AB0F3          13      LD  A,(LINLEN)
001268 5268 4F               4      LD  C,A
001269 5269 94               4      SUB H   ;CSRX
00126A 526A C602             7      ADD A,2
00126C 526C 47               4      LD  B,A ;カーソルより右の文字数
00126D 526D 61               4      LD  H,C ;LINLEN
00126E 526E C5              11      PUSH    BC
00126F 526F CDBD52          17      CALL    LOC0
001272 5272 C1              10      POP BC
                                
001273 5273 1620             7      LD  D,020H
       5275                     C8X1:
001275 5275 DD214A00        14      LD  IX,RDVRM
001279 5279 CDFA42          17      CALL    CALSLT_R
00127C 527C 4F               4      LD  C,A
00127D 527D 7A               4      LD  A,D
00127E 527E DD214D00        14      LD  IX,WRTVRM
001282 5282 CDFA42          17      CALL    CALSLT_R
001285 5285 2B               6      DEC HL
001286 5286 51               4      LD  D,C
001287 5287 10EC            13      DJNZ    C8X1
001289 5289 D1              10      POP DE
00128A 528A F1              10      POP AF
00128B 528B C9              10      RET
                                
       528C                     INSERT:
00128C 528C F5              11      PUSH    AF
00128D 528D D5              11      PUSH    DE
00128E 528E 2ADCF3          16      LD  HL,(CSRY)
001291 5291 3AB0F3          13      LD  A,(LINLEN)
001294 5294 4F               4      LD  C,A
001295 5295 94               4      SUB H   ;CSRX
001296 5296 3C               4      INC A
001297 5297 47               4      LD  B,A ;カーソルより右の文字数
001298 5298 C5              11      PUSH    BC
001299 5299 CDBD52          17      CALL    LOC0
00129C 529C C1              10      POP BC
                                
00129D 529D 1620             7      LD  D,020H
       529F                     INS1:
00129F 529F DD214A00        14      LD  IX,RDVRM
0012A3 52A3 CDFA42          17      CALL    CALSLT_R
0012A6 52A6 4F               4      LD  C,A
0012A7 52A7 7A               4      LD  A,D
0012A8 52A8 DD214D00        14      LD  IX,WRTVRM
0012AC 52AC CDFA42          17      CALL    CALSLT_R
0012AF 52AF 23               6      INC HL
0012B0 52B0 51               4      LD  D,C
0012B1 52B1 10EC            13      DJNZ    INS1
0012B3 52B3 D1              10      POP DE
0012B4 52B4 F1              10      POP AF
0012B5 52B5 C9              10      RET
                                
       52B6                     CONOUT1:
0012B6 52B6 59               4      LD  E,C
0012B7 52B7 C3EA50          10      JP  _PRINT
                                
       52BA                     GETVRAM:
0012BA 52BA 2ADCF3          16      LD  HL,(CSRY)
       52BD                     LOC0:
0012BD 52BD 2D               4      DEC L
0012BE 52BE 25               4      DEC H
0012BF 52BF 4C               4      LD  C,H ;CSRX-1
0012C0 52C0 5D               4      LD  E,L ;CSRY-1
       52C1                     LOC1:
0012C1 52C1 3AB0F3          13      LD  A,(LINLEN)
0012C4 52C4 67               4      LD  H,A
0012C5 52C5 1600             7      LD  D,0
0012C7 52C7 6A               4      LD  L,D ;0
0012C8 52C8 0608             7      LD  B,8
       52CA                     LOC2:
0012CA 52CA 29              11      ADD HL,HL
0012CB 52CB 3001            12      JR  NC,LOC3
0012CD 52CD 19              11      ADD HL,DE
       52CE                     LOC3:
0012CE 52CE 10FA            13      DJNZ    LOC2
0012D0 52D0 09              11      ADD HL,BC
0012D1 52D1 C9              10      RET
                                
       52D2                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0012D2 52D2 212200          10      LD  HL,00022H
0012D5 52D5 AF               4      XOR A
0012D6 52D6 7D               4      LD  A,L
0012D7 52D7 C9              10      RET
                                
       52D8                     _SYS0D:     ;(BDOS)ディスク・リセット
0012D8 52D8 218000          10      LD  HL,00080H
0012DB 52DB 2230F1          16      LD  (_DTA),HL
0012DE 52DE C9              10      RET
                                
       52DF                     _SYS0E:     ;(BDOS)カレントドライブの設定
0012DF 52DF 3246F1          13      LD  (_DVSW),A
0012E2 52E2 C9              10      RET
                                
       52E3                     _SYS0F:     ;(BDOS)ファイルのオープン
0012E3 52E3 D5              11      PUSH    DE
0012E4 52E4 FDE1            14      POP IY
0012E6 52E6 CD5154          17      CALL    INIT_FILE
0012E9 52E9 CDB74B          17      CALL    ROM_OPEN
0012EC 52EC 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0012EE 52EE FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0012F2 52F2 FDE5            15      PUSH    IY
0012F4 52F4 D1              10      POP DE
0012F5 52F5 13               6      INC DE
0012F6 52F6 010B00          10      LD  BC,11
0012F9 52F9 EDB0                    LDIR
                                ;               Attribute
0012FB 52FB 7E               7      LD  A,(HL)
0012FC 52FC FD770D          19      LD  (IY+13),A
                                ;               TIME
0012FF 52FF 110B00          10      LD  DE,11
001302 5302 19              11      ADD HL,DE
001303 5303 7E               7      LD  A,(HL)
001304 5304 23               6      INC HL
001305 5305 FD7716          19      LD  (IY+22),A
001308 5308 7E               7      LD  A,(HL)
001309 5309 23               6      INC HL
00130A 530A FD7717          19      LD  (IY+23),A
                                ;               DATE
00130D 530D 7E               7      LD  A,(HL)
00130E 530E 23               6      INC HL
00130F 530F FD7714          19      LD  (IY+20),A
001312 5312 7E               7      LD  A,(HL)
001313 5313 23               6      INC HL
001314 5314 FD7715          19      LD  (IY+21),A
                                ;               First cluster
001317 5317 7E               7      LD  A,(HL)
001318 5318 23               6      INC HL
001319 5319 FD771A          19      LD  (IY+26),A
00131C 531C 7E               7      LD  A,(HL)
00131D 531D 23               6      INC HL
00131E 531E FD771B          19      LD  (IY+27),A
                                ;               SIZE
001321 5321 7E               7      LD  A,(HL)
001322 5322 23               6      INC HL
001323 5323 FD7710          19      LD  (IY+16),A
001326 5326 7E               7      LD  A,(HL)
001327 5327 23               6      INC HL
001328 5328 FD7711          19      LD  (IY+17),A
00132B 532B 7E               7      LD  A,(HL)
00132C 532C 23               6      INC HL
00132D 532D FD7712          19      LD  (IY+18),A
001330 5330 7E               7      LD  A,(HL)
001331 5331 FD7713          19      LD  (IY+19),A
001334 5334 AF               4      XOR A
001335 5335 FD770C          19      LD  (IY+12),A
001338 5338 C9              10      RET
                                
       5339                     _SYS10:     ;(BDOS)ファイルのクローズ
001339 5339 AF               4      XOR A
00133A 533A C9              10      RET
                                
       533B                     S11X1:
00133B 533B FD7119          19      LD  (IY+25),C       ;RootEntCnt
00133E 533E FD750E          19      LD  (IY+14),L
001341 5341 FD740F          19      LD  (IY+15),H
       5344                     SCF_FF_RET:
001344 5344 37               4      SCF
001345 5345 9F               4      SBC A,A
001346 5346 C9              10      RET
                                
       5347                     _SYS11:     ;(BDOS)最初のファイルの検索
001347 5347 ED5333F1        20      LD  (_FCB),DE
00134B 534B D5              11      PUSH    DE
00134C 534C FDE1            14      POP IY
00134E 534E CD5154          17      CALL    INIT_FILE
001351 5351 CD094E          17      CALL    GET_DIR_DAT
       5354                     S12X1:
001354 5354 CDD34B          17      CALL    FILESE
001357 5357 30E2            12      JR  NC,S11X1
001359 5359 0D               4      DEC C
00135A 535A FD7119          19      LD  (IY+25),C       ;RootEntCnt
00135D 535D FDCB0D66        20      BIT 4,(IY+13)
001361 5361 2809            12      JR  Z,S12X2
001363 5363 E5              11      PUSH    HL
001364 5364 DDE1            14      POP IX
001366 5366 DDCB0E66        20      BIT 4,(IX+1+13)
00136A 536A 28E8            12      JR  Z,S12X1
       536C                     S12X2:
00136C 536C 012000          10      LD  BC,32
00136F 536F ED5B30F1        20      LD  DE,(_DTA)
001373 5373 AF               4      XOR A
001374 5374 12               7      LD  (DE),A      ;ドライブ番号
001375 5375 13               6      INC DE
001376 5376 EDB0                    LDIR            ;ディレクトリエントリ
001378 5378 FD750E          19      LD  (IY+14),L
00137B 537B FD740F          19      LD  (IY+15),H
00137E 537E C9              10      RET
                                
       537F                     _SYS12:
00137F 537F FD2A33F1        20      LD  IY,(_FCB)
001383 5383 FDE5            15      PUSH    IY
001385 5385 D1              10      POP DE
001386 5386 CD5154          17      CALL    INIT_FILE
                                
001389 5389 FD6E0E          19      LD  L,(IY+14)
00138C 538C FD660F          19      LD  H,(IY+15)
00138F 538F FD4E19          19      LD  C,(IY+25)
001392 5392 18C0            12      JR  S12X1
                                
       5394                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001394 5394 CDEF4D          17      CALL    SET_FCB
001397 5397 CDBD4D          17      CALL    GETSEQ
00139A 539A CDAA4D          17      CALL    RB_READ
00139D 539D E5              11      PUSH    HL
00139E 539E CDCA4D          17      CALL    SETSEQ
0013A1 53A1 E1              10      POP HL
       53A2                     SREAD:
0013A2 53A2 C601             7      ADD A,001H
0013A4 53A4 D8              11      RET C
                                
0013A5 53A5 7D               4      LD  A,L
0013A6 53A6 D601             7      SUB 001H
0013A8 53A8 9F               4      SBC A,A
0013A9 53A9 E603             7      AND 3
0013AB 53AB 1F               4      RRA
0013AC 53AC C9              10      RET
                                
       53AD                     _SYS18:     ;(BDOS)ログインベクトルの獲得
0013AD 53AD 210100          10      LD  HL,00001H
0013B0 53B0 AF               4      XOR A
0013B1 53B1 C9              10      RET
                                
       53B2                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
0013B2 53B2 3A46F1          13      LD  A,(_DVSW)
0013B5 53B5 C9              10      RET
                                
       53B6                     _SYS1A:     ;(BDOS)DTAの設定
0013B6 53B6 ED5330F1        20      LD  (_DTA),DE
0013BA 53BA AF               4      XOR A
0013BB 53BB C9              10      RET
                                
       53BC                     _SYS1B:     ;(BDOS)ディスク情報の獲得
0013BC 53BC 010002          10      LD  BC,512
0013BF 53BF 11C302          10      LD  DE,707
0013C2 53C2 210000          10      LD  HL,0
0013C5 53C5 DD2135F1        14      LD  IX,_BUF
0013C9 53C9 FD2135F1        14      LD  IY,_BUF
0013CD 53CD FD3600F9        19      LD  (IY+0),0F9H
0013D1 53D1 3E02             7      LD  A,2
0013D3 53D3 C9              10      RET
                                
       53D4                     _SYS21:     ;(BDOS)ランダムな読み出し
0013D4 53D4 CDEF4D          17      CALL    SET_FCB
                                
0013D7 53D7 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0013DA 53DA FD6622          19      LD  H,(IY+34)
                                
0013DD 53DD CDAA4D          17      CALL    RB_READ
0013E0 53E0 18C0            12      JR  SREAD
                                
       53E2                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
0013E2 53E2 CDE352          17      CALL    _SYS0F
0013E5 53E5 D8              11      RET C
                                
0013E6 53E6 D5              11      PUSH    DE      ;EX DE,IY
0013E7 53E7 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013E9 53E9 CDDF4D          17      CALL    GETSIZE
       53EC                     _S24X1:
0013EC 53EC FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013EF 53EF FD7422          19      LD  (IY+34),H
0013F2 53F2 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0013F6 53F6 FDE3            23      EX  (SP),IY     ;
0013F8 53F8 D1              10      POP DE      ;
                                
0013F9 53F9 AF               4      XOR A
0013FA 53FA C9              10      RET
                                
       53FB                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0013FB 53FB E5              11      PUSH    HL
0013FC 53FC D5              11      PUSH    DE      ;EX DE,IY
0013FD 53FD FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013FF 53FF CDBD4D          17      CALL    GETSEQ
001402 5402 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5404                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001404 5404 CDEF4D          17      CALL    SET_FCB
001407 5407 E5              11      PUSH    HL
001408 5408 FD6E21          19      LD  L,(IY+33)
00140B 540B FD6622          19      LD  H,(IY+34)
00140E 540E 2226F1          16      LD  (RR_LOW),HL
001411 5411 FD6E23          19      LD  L,(IY+35)
001414 5414 FD6624          19      LD  H,(IY+36)
001417 5417 2228F1          16      LD  (RR_HIGH),HL
00141A 541A E1              10      POP HL
00141B 541B CD9749          17      CALL    ROM_READ
00141E 541E ED5B26F1        20      LD  DE,(RR_LOW)
001422 5422 FD7321          19      LD  (IY+33),E
001425 5425 FD7222          19      LD  (IY+34),D
001428 5428 ED5B28F1        20      LD  DE,(RR_HIGH)
00142C 542C FD7323          19      LD  (IY+35),E
00142F 542F FD7224          19      LD  (IY+36),D
001432 5432 9F               4      SBC A,A
001433 5433 C9              10      RET
                                
       5434                     _SYS2F:
001434 5434 44               4      LD  B,H
001435 5435 2A30F1          16      LD  HL,(_DTA)
001438 5438 C3F44E          10      JP  DISKIO
                                
       543B                     _SYS5A:
00143B 543B 0600             7      LD  B,0
00143D 543D D5              11      PUSH    DE
00143E 543E DDE1            14      POP IX
       5440                     _SX5A1:
001440 5440 1A               7      LD  A,(DE)
001441 5441 B7               4      OR  A
001442 5442 2804            12      JR  Z,_SX5A2
001444 5444 13               6      INC DE
001445 5445 04               4      INC B
001446 5446 18F8            12      JR  _SX5A1
                                
       5448                     _SX5A2:
001448 5448 78               4      LD  A,B
001449 5449 CD624A          17      CALL    FILE_BDOS
00144C 544C CD8F4E          17      CALL    ROM_CD
00144F 544F 9F               4      SBC A,A
001450 5450 C9              10      RET
                                
       5451                     INIT_FILE:
001451 5451 EB               4      EX  DE,HL
001452 5452 1150F1          10      LD  DE,FDRV
001455 5455 010C00          10      LD  BC,1+8+3
001458 5458 EDB0                    LDIR
00145A 545A CD9550          17      CALL    GET_DISK_BANK_FDRV
00145D 545D 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001460 5460 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
001463 5463 2A5CF1          16      LD  HL,(_CD)
001466 5466 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
001469 5469 C9              10      RET
                                
       546A                     ZERO_MEMORY_DE:
00146A 546A AF               4      XOR A
       546B                     FILL_MEMORY_DE:
00146B 546B 12               7      LD  (DE),A
00146C 546C 13               6      INC DE
00146D 546D 10FC            13      DJNZ    FILL_MEMORY_DE
00146F 546F C9              10      RET
                                
001470 5470                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 D750ED501E51D750        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 D750D75023516451        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 2B51D7507E511252        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 D252D852DF52E352        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 395347537F53D750        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 9453D750D750D750        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 AD53B253B653BC53        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 D750D750D750E253        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 FB53D750D7500454        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 D750D7502452D750        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 2A52D750D7503454        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 D750D7503B54D750        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 D750D750D750D750        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
