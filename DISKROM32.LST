                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
                                ;BANK0_SEL EQU 06000H
                                ;BANK1_SEL EQU 07000H
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                ;USE_RAM_BLOAD_S    EQU 1   ;先頭のコメントを外すとBLOAD,SでRAMを使う
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 0000                    DW  0      ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C35E4B          10      JP  DISKIO
000013 4013 C3984B          10      JP  DSKCHG
000016 4016 C3EE4B          10      JP  GETDPB
000019 4019 C3E14C          10      JP  CHOICE
00001C 401C C3E54C          10      JP  DSKFMT
00001F 401F C3E74C          10      JP  DSKSTP
000022 4022 C3E84C          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C3E54C          10      JP  DSKFMT
000029 4029 C3E74C          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C3EF4C          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.1.4.3",0
            204449534B20524F    
            4D204C6974652076    
            302E312E342E3300    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 224FF1          16      LD  (BASSTK),HL
000129 4129 ED7B4FF1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 323AF1          13      LD  (_DVSW),A
                                
00013B 413B 21E242          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 016C00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2110F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 210BF1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD2A42          17      CALL    GTSL1_
000183 4183 32FCF0          13      LD  (ROM_SLT),A
000186 4186 3272FE          13      LD  (H_BINS+1),A
000189 4189 3277FE          13      LD  (H_BINL+1),A
00018C 418C 327CFE          13      LD  (H_FILE+1),A
00018F 418F 3232F3          13      LD  (H_BDOS+1),A
000192 4192 32DBFE          13      LD  (H_STKE+1),A
000195 4195 32A8FF          13      LD  (H_PHYD+1),A
000198 4198 3222FB          13      LD  (DRVTBL+1),A
00019B 419B 3248F3          13      LD  (MASTERS),A
                                
00019E 419E 217945          10      LD  HL,ROM_LOAD
0001A1 41A1 2273FE          16      LD  (H_BINS+2),HL
0001A4 41A4 219446          10      LD  HL,ROM_RUN
0001A7 41A7 2278FE          16      LD  (H_BINL+2),HL
0001AA 41AA 21A146          10      LD  HL,ROM_FILES
0001AD 41AD 227DFE          16      LD  (H_FILE+2),HL
0001B0 41B0 213B4D          10      LD  HL,ROM_BDOS
0001B3 41B3 2233F3          16      LD  (H_BDOS+2),HL
0001B6 41B6 217843          10      LD  HL,ROM_STKE
0001B9 41B9 22DCFE          16      LD  (H_STKE+2),HL
0001BC 41BC 215E4B          10      LD  HL,DISKIO
0001BF 41BF 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C2 41C2 3E                      DB  03EH
0001C3 41C3 C9              10      RET
0001C4 41C4 327FFE          13      LD  (H_FILE+4),A
0001C7 41C7 3275FE          13      LD  (H_BINS+4),A
0001CA 41CA 327AFE          13      LD  (H_BINL+4),A
0001CD 41CD 3235F3          13      LD  (H_BDOS+4),A
0001D0 41D0 32DEFE          13      LD  (H_STKE+4),A
0001D3 41D3 32ABFF          13      LD  (H_PHYD+4),A
                                
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    XOR A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  A,(BANK1_ADR)
                                    CP  'A'
                                    JR  NZ,NOT_8K_BANK
                                    LD  A,DISK_BANK
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001D6 41D6 CD3801          17      CALL    RSLREG      ;read primary slot #
0001D9 41D9 07               4      RLCA
0001DA 41DA 07               4      RLCA
0001DB 41DB F5              11      PUSH    AF
0001DC 41DC CD2F42          17      CALL    GTSL2_
0001DF 41DF 3244F3          13      LD  (RAMAD3),A
0001E2 41E2 F1              10      POP AF  
0001E3 41E3 CD2F42          17      CALL    GTSL2_
0001E6 41E6 2680             7      LD  H,080H
0001E8 41E8 CD4642          17      CALL    CHK_RAM
0001EB 41EB 3243F3          13      LD  (RAMAD2),A
       41EE                     RAMCHK2:
0001EE 41EE 3A44F3          13      LD  A,(RAMAD3)
0001F1 41F1 2640             7      LD  H,040H
0001F3 41F3 CD4642          17      CALL    CHK_RAM
0001F6 41F6 3242F3          13      LD  (RAMAD1),A
       41F9                     RAMCHK1:
0001F9 41F9 3A44F3          13      LD  A,(RAMAD3)
0001FC 41FC 2600             7      LD  H,00H
0001FE 41FE CD4642          17      CALL    CHK_RAM
000201 4201 3241F3          13      LD  (RAMAD0),A
       4204                     RAMCHK0:
000204 4204 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000207 4207 010F00          10      LD  BC,0000FH       ;切り上げ
00020A 420A 09              11      ADD HL,BC
00020B 420B 7D               4      LD  A,L
                                
00020C 420C 0604             7      LD  B,4
       420E                     B_DRIVE1:
00020E 420E CB3C             8      SRL H
000210 4210 1F               4      RRA
000211 4211 10FB            13      DJNZ    B_DRIVE1
                                
000213 4213 C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000215 4215 3239F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000218 4218 C9              10      RET
                                
       4219                     NOT_8K_BANK:
                                                ;ASCII-8K/Konami-8Kではない(ASCII-16K等)
000219 4219 21C643          10      LD  HL,MSG_ERROR_ROM_MODE
00021C 421C CD5143          17      CALL    MSX
00021F 421F FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000223 4223 DD219F00        14      LD  IX,CHGET
000227 4227 C31C00          10      JP  _CALSLT
                                
       422A                     GTSL1_:             ;自分のいるスロットを知る
00022A 422A CD3801          17      CALL    RSLREG      ;read primary slot #
00022D 422D 0F               4      RRCA
00022E 422E 0F               4      RRCA
       422F                     GTSL2_:
00022F 422F E603             7      AND 3       ;[A]=000000PP
000231 4231 5F               4      LD  E,A     ;[E]=000000PP
000232 4232 21C1FC          10      LD  HL,EXPTBL
000235 4235 85               4      ADD A,L     ;桁上りは無い
000236 4236 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000237 4237 7B               4      LD  A,E     ;[A]=000000PP
000238 4238 CB7E            13      BIT 7,(HL)
00023A 423A C8              11      RET Z
00023B 423B 7D               4      LD  A,L     ;point to SLTTBL entry
00023C 423C C604             7      ADD A,4     ;桁上りは無い
00023E 423E 6F               4      LD  L,A
00023F 423F 7E               7      LD  A,(HL)      ;get currently expansion slot register
000240 4240 E60C             7      AND 00CH        ;[A] = 0000SS00
000242 4242 B3               4      OR  E       ;[A] = 0000SSPP
000243 4243 F680             7      OR  080H        ;[A] = 1000SSPP
000245 4245 C9              10      RET
       4246                     GTSL1_E:
                                
       4246                     CHK_RAM:
000246 4246 E5              11      PUSH    HL
000247 4247 CD9B42          17      CALL    CHK_RAM0
00024A 424A E1              10      POP HL
00024B 424B C8              11      RET Z
00024C 424C 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
00024F 424F E680             7      AND 080H
000251 4251 CD7242          17      CALL    CHK_RAM_SLT
000254 4254 C8              11      RET Z
000255 4255 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
000258 4258 E680             7      AND 080H
00025A 425A C601             7      ADD A,1
00025C 425C CD7242          17      CALL    CHK_RAM_SLT
00025F 425F C8              11      RET Z
000260 4260 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000263 4263 E680             7      AND 080H
000265 4265 C602             7      ADD A,2
000267 4267 CD7242          17      CALL    CHK_RAM_SLT
00026A 426A C8              11      RET Z
00026B 426B 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
00026E 426E E680             7      AND 080H
000270 4270 C603             7      ADD A,3
       4272                     CHK_RAM_SLT:
000272 4272 E5              11      PUSH    HL
000273 4273 CD9B42          17      CALL    CHK_RAM0        ;スロット#X or X-0
000276 4276 E1              10      POP HL
000277 4277 C8              11      RET Z
000278 4278 CB79             8      BIT 7,C
00027A 427A 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
00027C 427C 79               4      LD  A,C
00027D 427D C604             7      ADD A,4         ;スロット#X-1
00027F 427F E5              11      PUSH    HL
000280 4280 CD9B42          17      CALL    CHK_RAM0
000283 4283 E1              10      POP HL
000284 4284 C8              11      RET Z
000285 4285 79               4      LD  A,C
000286 4286 C604             7      ADD A,4         ;スロット#X-2
000288 4288 E5              11      PUSH    HL
000289 4289 CD9B42          17      CALL    CHK_RAM0
00028C 428C E1              10      POP HL
00028D 428D C8              11      RET Z
00028E 428E 79               4      LD  A,C
00028F 428F C604             7      ADD A,4         ;スロット#X-3
000291 4291 E5              11      PUSH    HL
000292 4292 CD9B42          17      CALL    CHK_RAM0
000295 4295 E1              10      POP HL
       4296                     CHK_RAM_E:
000296 4296 AF               4      XOR A
000297 4297 3C               4      INC A           ;ZF=0にする
000298 4298 3E00             7      LD  A,0
00029A 429A C9              10      RET
                                
       429B                     CHK_RAM0:
00029B 429B 4F               4      LD  C,A
00029C 429C 3AFCF0          13      LD  A,(ROM_SLT)
00029F 429F B9               4      CP  C
0002A0 42A0 28F4            12      JR  Z,CHK_RAM_E
0002A2 42A2 2E00             7      LD  L,0
       42A4                     CHK_RAM1:
0002A4 42A4 79               4      LD  A,C
0002A5 42A5 DD210C00        14      LD  IX,_RDSLT
0002A9 42A9 CDD642          17      CALL    CALSLT_R
0002AC 42AC C6E5             7      ADD A,0E5H
0002AE 42AE 47               4      LD  B,A
0002AF 42AF 5F               4      LD  E,A
0002B0 42B0 79               4      LD  A,C
0002B1 42B1 DD211400        14      LD  IX,_WRSLT
0002B5 42B5 CDD642          17      CALL    CALSLT_R
0002B8 42B8 79               4      LD  A,C
0002B9 42B9 DD210C00        14      LD  IX,_RDSLT
0002BD 42BD CDD642          17      CALL    CALSLT_R
0002C0 42C0 B8               4      CP  B
0002C1 42C1 C0              11      RET NZ
0002C2 42C2 D6E5             7      SUB 0E5H
0002C4 42C4 79               4      LD  A,C
0002C5 42C5 5F               4      LD  E,A
0002C6 42C6 DD211400        14      LD  IX,_WRSLT
0002CA 42CA CDD642          17      CALL    CALSLT_R
0002CD 42CD 24               4      INC H
0002CE 42CE 7D               4      LD  A,L
0002CF 42CF C604             7      ADD A,4
0002D1 42D1 6F               4      LD  L,A
0002D2 42D2 20D0            12      JR  NZ,CHK_RAM1
0002D4 42D4 79               4      LD  A,C     ;ZF=1のハズ
0002D5 42D5 C9              10      RET
                                
       42D6                     CALSLT_R:
0002D6 42D6 C5              11      PUSH    BC
0002D7 42D7 E5              11      PUSH    HL
0002D8 42D8 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0002DC 42DC CD1C00          17      CALL    _CALSLT
0002DF 42DF E1              10      POP HL
0002E0 42E0 C1              10      POP BC
0002E1 42E1 C9              10      RET
                                
       42E2                     AT_ISC:
0002E2 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
0002E2 F0E9 FEB7             7      CP  0B7H            ;FILES
0002E4 F0EB CC7BFE          17      CALL    Z,H_FILE
0002E7 F0EE FEB5             7      CP  0B5H            ;LOAD
0002E9 F0F0 CA71FE          10      JP  Z,H_BINS
0002EC F0F3 FE8A             7      CP  08AH            ;RUN
0002EE F0F5 CA76FE          10      JP  Z,H_BINL
0002F1 F0F8 FECF             7      CP  0CFH            ;BLOAD
0002F3 F0FA C0              11      RET NZ
       F0FB                     FIX_BLOAD:
0002F4 F0FB F7              12      RST 30H
       F0FC                     ROM_SLT:
0002F5 F0FC 00                      DB  0
0002F6 F0FD D645                    DW  ROM_BLOAD
0002F8 F0FF F5              11      PUSH    AF
0002F9 F100 E5              11      PUSH    HL
0002FA F101 CD0AF1          17      CALL    BLOAD_RET
       F102                     SWC_BLOAD   EQU $-2
0002FD F104 E1              10      POP HL
0002FE F105 F1              10      POP AF
0002FF F106 FECF             7      CP  0CFH            ;BLOAD
       F108                     SWC_BLOAD_M:
000301 F108 28DF            12      JR  Z,REPLACE_COMMAND
       F10A                     BLOAD_RET:
000303 F10A C9              10      RET
       F10B                     ROMUSE1:
000304 F10B 3AFCF0          13      LD  A,(ROM_SLT)
000307 F10E 1803            12      JR  ROMUSE2
       F110                     RAMUSE1:
000309 F110 3A42F3          13      LD  A,(RAMAD1)
       F113                     ROMUSE2:
00030C F113 C32400          10      JP  _ENASLT
                                
       F116                     _RESULT:
00030F F116 00                      DB  0
       F117                     _BANK:
000310 F117 00                      DB  0
       F118                     CLSZ:               ;クラスタサイズ
000311 F118 0004                    DW  1024
       F119                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F11A                     SECSZ:              ;セクタサイズ
000313 F11A 0002                    DW  512
       F11B                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F11C                     RR_LOW:
000315 F11C 0000                    DW  0
       F11D                     RR_MID  EQU $-1
       F11E                     RR_HIGH:
000317 F11E 0000                    DW  0
       F120                     _CLPS:
000319 F120 0000                    DW  0
       F122                     _LEFT:
00031B F122 0000                    DW  0
       F124                     _DTPS:
00031D F124 0000                    DW  0
       F126                     _DTA:
00031F F126 0000                    DW  0
                                #if exists USE_RAM_BLOAD_S
                                #else
       F128                     FLG_LDIR:
000321 F128 00                      DB  0
                                #endif
                                ;   BDOS
000322 F129 F7              12      RST 30H
000323 F12A 00                      DB  0
000324 F12B 3B4D                    DW  ROM_BDOS
000326 F12D C9              10      RET 
       F12E                     _FCB:
000327 F12E 0000                    DW  0
       F130                     _BUF:
000329 F130 00                      DB  0
       F131                     _BUF_ST:
00032A F131 0000                    DW  0
       F133                     _BUF_EN:
00032C F133 0000                    DW  0
       F135                     _BUF_EX:
00032E F135 0000                    DW  0
                                
       F137                     DTAX:
000330 F137 0000                    DW  0
       F139                     B_DRIVE:
000332 F139 00                      DB  0
       F13A                     _DVSW:
000333 F13A 00                      DB  0
       F13B                     FCBX:
000334 F13B 0000                    DW  0
       F13D                     LEFTX:
000336 F13D 0000                    DW  0
       F13F                     PARAM0:
000338 F13F 0000                    DW  0
       F141                     PARAM1:
00033A F141 0000                    DW  0
       F143                     FDRV:
00033C F143 00                      DB  0
       F144                     FNAME:
00033D F144                         DS  8+3
                                
       F14F                     BASSTK:
000348 F14F 0000                    DW  0
       F151                     _HL:
00034A F151 0000                    DW  0
       F153                     _SP:
00034C F153 0000                    DW  0
                                
       F155                     ISC_E:
00034E 434E                         ORG $$+RUN          ;$DEPHASE
                                
       434E                     MSX1:
00034E 434E CD544D          17      CALL    MSGA1
       4351                     MSX:
000351 4351 7E               7      LD  A,(HL)
000352 4352 23               6      INC HL
000353 4353 B7               4      OR  A
000354 4354 20F8            12      JR  NZ,MSX1
000356 4356 C9              10      RET
                                
       4357                     PRTHX:
000357 4357 F5              11      PUSH    AF
000358 4358 07               4      RLCA
000359 4359 07               4      RLCA
00035A 435A 07               4      RLCA
00035B 435B 07               4      RLCA
00035C 435C CD6043          17      CALL    PRTA2
00035F 435F F1              10      POP AF
       4360                     PRTA2:
000360 4360 CD6643          17      CALL    ASC
000363 4363 C3504D          10      JP  MSG_A
                                    
       4366                     ASC:
000366 4366 E60F             7      AND $0F
000368 4368 F630             7      OR  $30
00036A 436A FE3A             7      CP  $3A
00036C 436C D8              11      RET C
00036D 436D C607             7      ADD A,7
00036F 436F C9              10      RET
                                
       4370                     MSN:
000370 4370 7E               7      LD  A,(HL)
000371 4371 23               6      INC HL
000372 4372 CD504D          17      CALL    MSG_A
000375 4375 10F9            13      DJNZ    MSN
000377 4377 C9              10      RET
                                
       4378                     ROM_STKE:
000378 4378 3E                      DB  03EH
000379 4379 C9              10      RET
00037A 437A 32DAFE          13      LD  (H_STKE),A
00037D 437D E5              11      PUSH    HL
00037E 437E D5              11      PUSH    DE
00037F 437F C5              11      PUSH    BC
000380 4380 181D            12      JR  BASAUTO
                                
000382 4382 AF               4      XOR A
000383 4383 5F               4      LD  E,A
000384 4384 57               4      LD  D,A
000385 4385 0601             7      LD  B,1
000387 4387 2100C0          10      LD  HL,0C000H
00038A 438A CD5E4B          17      CALL    DISKIO
                                
00038D 438D ED734FF1        20      LD  (BASSTK),SP
000391 4391 116BF3          10      LD  DE,RAMUSE
000394 4394 AF               4      XOR A
000395 4395 CD1EC0          17      CALL    0C01EH
000398 4398 116BF3          10      LD  DE,RAMUSE
00039B 439B 37               4      SCF
00039C 439C CD1EC0          17      CALL    0C01EH
       439F                     BASAUTO:
00039F 439F 21EC43          10      LD  HL,AUTOEXEC
0003A2 43A2 1143F1          10      LD  DE,FDRV
0003A5 43A5 010C00          10      LD  BC,1+8+3
0003A8 43A8 EDB0                    LDIR
0003AA 43AA CD0249          17      CALL    ROM_OPEN
0003AD 43AD 3813            12      JR  C,RSTKEE
0003AF 43AF 21F843          10      LD  HL,RUN_AUTOEXEC
0003B2 43B2 11F0FB          10      LD  DE,KEYBUF
0003B5 43B5 ED53FAF3        20      LD  (GETPNT),DE
0003B9 43B9 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003BC 43BC EDB0                    LDIR
0003BE 43BE ED53F8F3        20      LD  (PUTPNT),DE
       43C2                     RSTKEE:
0003C2 43C2 C1              10      POP BC
0003C3 43C3 D1              10      POP DE
0003C4 43C4 E1              10      POP HL
0003C5 43C5 C9              10      RET
                                
       43C6                     MSG_ERROR_ROM_MODE:
0003C6 43C6 41534349492D384B        DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
            2F4B6F6E616D692D    
            384B2F4B6F6E616D    
            692D534343206F6E    
            6C79210D0A          
       43EB                     NULL:
0003EB 43EB 00                      DB  0
                                
       43EC                     AUTOEXEC:
0003EC 43EC 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       43F8                     RUN_AUTOEXEC:
0003F8 43F8 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       440B                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       440B                     ROM_LDIR:
                                #if exists USE_RAM_BLOAD_S
                                #else
00040B 440B 3A28F1          13      LD  A,(FLG_LDIR)
00040E 440E B7               4      OR  A
00040F 440F 2062            12      JR  NZ,ROM_LDIRVM
                                #endif
000411 4411 CB7A             8      BIT 7,D
000413 4413 CA9B44          10      JP  Z,ROM_LDIRSLT
                                
                                #if exists USE_NORMAL_32K_ROM
000416 4416 ED7353F1        20      LD  (_SP),SP
00041A 441A 3121FB          10      LD  SP,DRVTBL
       441D                     LDIR1:
00041D 441D 78               4      LD  A,B
00041E 441E B1               4      OR  C
00041F 441F 2841            12      JR  Z,LDIRE
                                
000421 4421 C5              11      PUSH    BC
000422 4422 D5              11      PUSH    DE
000423 4423 E5              11      PUSH    HL
000424 4424 3AFCF0          13      LD  A,(ROM_SLT)
000427 4427 2680             7      LD  H,080H
000429 4429 CD2400          17      CALL    _ENASLT
00042C 442C E1              10      POP HL
00042D 442D D1              10      POP DE
00042E 442E C1              10      POP BC
       442F                     LDIR2:
00042F 442F 7A               4      LD  A,D
000430 4430 FEC0             7      CP  0C0H
000432 4432 302C            12      JR  NC,LDIR4
                                
000434 4434 C5              11      PUSH    BC
000435 4435 D5              11      PUSH    DE
000436 4436 115EF5          10      LD  DE,BUF
                                
000439 4439 78               4      LD  A,B
00043A 443A B7               4      OR  A
00043B 443B 2803            12      JR  Z,LDIR3
00043D 443D 010001          10      LD  BC,00100H
       4440                     LDIR3:
000440 4440 C5              11      PUSH    BC
000441 4441 EDB0                    LDIR
000443 4443 2251F1          16      LD  (_HL),HL
                                
000446 4446 3A43F3          13      LD  A,(RAMAD2)
000449 4449 2680             7      LD  H,080H
00044B 444B CD2400          17      CALL    _ENASLT
                                
00044E 444E 215EF5          10      LD  HL,BUF
000451 4451 C1              10      POP BC
000452 4452 D1              10      POP DE
000453 4453 EDB0                    LDIR
                                
000455 4455 2A51F1          16      LD  HL,(_HL)
000458 4458 C1              10      POP BC
000459 4459 78               4      LD  A,B
00045A 445A B7               4      OR  A
00045B 445B 2805            12      JR  Z,LDIRE
00045D 445D 05               4      DEC B
00045E 445E 18BD            12      JR  LDIR1
       4460                     LDIR4:
                                #endif
000460 4460 EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       4462                     LDIRE:
000462 4462 D5              11      PUSH    DE
000463 4463 E5              11      PUSH    HL
000464 4464 3A43F3          13      LD  A,(RAMAD2)
000467 4467 2680             7      LD  H,080H
000469 4469 CD2400          17      CALL    _ENASLT
00046C 446C E1              10      POP HL
00046D 446D D1              10      POP DE
00046E 446E ED7B53F1        20      LD  SP,(_SP)
                                #endif
000472 4472 C9              10      RET
                                
       4473                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
000473 4473 C5              11      PUSH    BC
000474 4474 D5              11      PUSH    DE
000475 4475 E5              11      PUSH    HL
000476 4476 3AFCF0          13      LD  A,(ROM_SLT)
000479 4479 2680             7      LD  H,080H
00047B 447B CD2400          17      CALL    _ENASLT
00047E 447E E1              10      POP HL
00047F 447F D1              10      POP DE
000480 4480 C1              10      POP BC
                                #endif
000481 4481 C5              11      PUSH    BC
000482 4482 D5              11      PUSH    DE
000483 4483 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000487 4487 DD215C00        14      LD  IX,LDIRVM
00048B 448B CD1C00          17      CALL    _CALSLT
                                #if exists USE_NORMAL_32K_ROM
00048E 448E 2680             7      LD  H,080H
000490 4490 3A43F3          13      LD  A,(RAMAD2)
000493 4493 CD2400          17      CALL    _ENASLT
                                #endif
000496 4496 E1              10      POP HL
000497 4497 C1              10      POP BC
000498 4498 09              11      ADD HL,BC
000499 4499 EB               4      EX  DE,HL
00049A 449A C9              10      RET
                                
       449B                     ROM_LDIRSLT:
00049B 449B EB               4      EX  DE,HL
       449C                     RLDIRSLT1:
00049C 449C 1A               7      LD  A,(DE)
00049D 449D 13               6      INC DE
00049E 449E C5              11      PUSH    BC
00049F 449F D5              11      PUSH    DE
0004A0 44A0 E5              11      PUSH    HL
0004A1 44A1 5F               4      LD  E,A
0004A2 44A2 3A42F3          13      LD  A,(RAMAD1)
0004A5 44A5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0004A9 44A9 DD211400        14      LD  IX,_WRSLT
0004AD 44AD CD1C00          17      CALL    _CALSLT
0004B0 44B0 E1              10      POP HL
0004B1 44B1 D1              10      POP DE
0004B2 44B2 C1              10      POP BC
0004B3 44B3 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004B5 44B5 EA9C44          10      JP  PE,RLDIRSLT1
0004B8 44B8 EB               4      EX  DE,HL
0004B9 44B9 C9              10      RET
                                
       44BA                     END_OF_LINE:
0004BA 44BA 215EF5          10      LD  HL,BUF
       44BD                     EOL1:
0004BD 44BD 7E               7      LD  A,(HL)
0004BE 44BE C8              11      RET Z
0004BF 44BF FE0D             7      CP  00DH
0004C1 44C1 2807            12      JR  Z,EOLE
0004C3 44C3 FE0A             7      CP  00AH
0004C5 44C5 2803            12      JR  Z,EOLE
0004C7 44C7 23               6      INC HL
0004C8 44C8 18F3            12      JR  EOL1
       44CA                     EOLE:
0004CA 44CA 3600            10      LD  (HL),0
0004CC 44CC 23               6      INC HL
0004CD 44CD 7E               7      LD  A,(HL)
0004CE 44CE FE0A             7      CP  00AH
0004D0 44D0 C0              11      RET NZ
0004D1 44D1 23               6      INC HL
0004D2 44D2 C9              10      RET
                                
       44D3                     ROM_LOAD_ASCII:
0004D3 44D3 210000          10      LD  HL,0
0004D6 44D6 2231F1          16      LD  (_BUF_ST),HL    ;読み出し位置
0004D9 44D9 2A76F6          16      LD  HL,(TXTTAB)
0004DC 44DC 2233F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
0004DF 44DF 215EF5          10      LD  HL,BUF
0004E2 44E2 2226F1          16      LD  (_DTA),HL
       44E5                     RLOAD_A1:
0004E5 44E5 2A31F1          16      LD  HL,(_BUF_ST)
0004E8 44E8 221CF1          16      LD  (RR_LOW),HL
0004EB 44EB 210201          10      LD  HL,258
0004EE 44EE CD2247          17      CALL    ROM_READ
0004F1 44F1 7C               4      LD  A,H
0004F2 44F2 B5               4      OR  L
0004F3 44F3 2877            12      JR  Z,RLOAD_AEND
0004F5 44F5 015EF5          10      LD  BC,BUF
0004F8 44F8 09              11      ADD HL,BC
0004F9 44F9 3600            10      LD  (HL),0
0004FB 44FB CDBA44          17      CALL    END_OF_LINE
0004FE 44FE 015EF5          10      LD  BC,BUF
000501 4501 A7               4      AND A
000502 4502 ED42            15      SBC HL,BC
000504 4504 2810            12      JR  Z,RLOAD_A2
000506 4506 4D               4      LD  C,L
000507 4507 44               4      LD  B,H
000508 4508 ED5B31F1        20      LD  DE,(_BUF_ST)
00050C 450C 19              11      ADD HL,DE
00050D 450D 2231F1          16      LD  (_BUF_ST),HL
000510 4510 3A5EF5          13      LD  A,(BUF)
000513 4513 B7               4      OR  A
000514 4514 28CF            12      JR  Z,RLOAD_A1
       4516                     RLOAD_A2:
000516 4516 115EF5          10      LD  DE,BUF
000519 4519 CD9948          17      CALL    SPCUTEX
00051C 451C 1A               7      LD  A,(DE)
00051D 451D B7               4      OR  A
00051E 451E 284C            12      JR  Z,RLOAD_AEND
000520 4520 CDAB48          17      CALL    GETNUM
000523 4523 7C               4      LD  A,H
000524 4524 B5               4      OR  L
000525 4525 CAC345          10      JP  Z,ERROR_DIRECT_IN_FILE
000528 4528 DD2A33F1        20      LD  IX,(_BUF_EN)
00052C 452C DD7502          19      LD  (IX+2),L
00052F 452F DD7403          19      LD  (IX+3),H
                                
000532 4532 CD9248          17      CALL    SPCUT
000535 4535 EB               4      EX  DE,HL
000536 4536 DDE5            15      PUSH    IX
000538 4538 DD21B242        14      LD  IX,CRUNCH
00053C 453C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000540 4540 CD1C00          17      CALL    _CALSLT
000543 4543 DDE1            14      POP IX
000545 4545 EB               4      EX  DE,HL
000546 4546 111FF4          10      LD  DE,KBUF
000549 4549 37               4      SCF
00054A 454A ED52            15      SBC HL,DE
00054C 454C 2875            12      JR  Z,ERROR_DIRECT_IN_FILE
00054E 454E 3873            12      JR  C,ERROR_DIRECT_IN_FILE
000550 4550 4D               4      LD  C,L
000551 4551 44               4      LD  B,H
000552 4552 2A33F1          16      LD  HL,(_BUF_EN)
000555 4555 110400          10      LD  DE,4
000558 4558 19              11      ADD HL,DE
000559 4559 111FF4          10      LD  DE,KBUF
                                
00055C 455C EB               4      EX  DE,HL
00055D 455D EDB0                    LDIR
00055F 455F EB               4      EX  DE,HL
                                
000560 4560 DD7500          19      LD  (IX+0),L
000563 4563 DD7401          19      LD  (IX+1),H
000566 4566 2233F1          16      LD  (_BUF_EN),HL
000569 4569 C3E544          10      JP  RLOAD_A1
                                
       456C                     RLOAD_AEND:
00056C 456C 2A33F1          16      LD  HL,(_BUF_EN)
00056F 456F AF               4      XOR A
000570 4570 77               7      LD  (HL),A
000571 4571 23               6      INC HL
000572 4572 77               7      LD  (HL),A
000573 4573 23               6      INC HL
000574 4574 2233F1          16      LD  (_BUF_EN),HL
000577 4577 1833            12      JR  RLOAD_END1
                                
       4579                     ROM_LOAD:
000579 4579 CDF746          17      CALL    INIT_PARAM
00057C 457C CDC247          17      CALL    FILE_B
00057F 457F CD0249          17      CALL    ROM_OPEN
000582 4582 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000584 4584 2130F1          10      LD  HL,_BUF
000587 4587 2226F1          16      LD  (_DTA),HL
00058A 458A 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
00058D 458D CD2247          17      CALL    ROM_READ
000590 4590 3A30F1          13      LD  A,(_BUF)
000593 4593 3C               4      INC A
000594 4594 C2D344          10      JP  NZ,ROM_LOAD_ASCII
000597 4597 2A76F6          16      LD  HL,(TXTTAB)
00059A 459A 2226F1          16      LD  (_DTA),HL
00059D 459D EB               4      EX  DE,HL
00059E 459E 2100FF          10      LD  HL,-256
0005A1 45A1 39              11      ADD HL,SP
0005A2 45A2 ED52            15      SBC HL,DE
0005A4 45A4 CD2247          17      CALL    ROM_READ
0005A7 45A7 ED5B26F1        20      LD  DE,(_DTA)
0005AB 45AB 19              11      ADD HL,DE
       45AC                     RLOAD_END1:
0005AC 45AC 22C2F6          16      LD  (VARTAB),HL
0005AF 45AF 22C4F6          16      LD  (ARYTAB),HL
0005B2 45B2 22C6F6          16      LD  (STREND),HL
                                
0005B5 45B5 AF               4      XOR A
0005B6 45B6 2133F1          10      LD  HL,_BUF+3
0005B9 45B9 77               7      LD  (HL),A
0005BA 45BA 2B               6      DEC HL
0005BB 45BB 77               7      LD  (HL),A
0005BC 45BC 2B               6      DEC HL
0005BD 45BD 77               7      LD  (HL),A
0005BE 45BE 2B               6      DEC HL
0005BF 45BF 3E8F             7      LD  A,08FH          ;REM
0005C1 45C1 77               7      LD  (HL),A
0005C2 45C2 C9              10      RET
                                
       45C3                     ERROR_DIRECT_IN_FILE:
0005C3 45C3 1E39             7      LD  E,57            ;Direct statement in file
0005C5 45C5 01                      DB  1           ;LD BC,
       45C6                     ERROR_FILE_NOT_OPEN:
0005C6 45C6 1E3B             7      LD  E,59            ;File not OPEN
0005C8 45C8 01                      DB  1           ;LD BC,
       45C9                     ERROR_FILE_NOT_FOUND:
0005C9 45C9 1E35             7      LD  E,53            ;File not found
       45CB                     ERROR:
0005CB 45CB FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0005CF 45CF DD216F40        14      LD  IX,ERRHAND
0005D3 45D3 C31C00          10      JP  _CALSLT
                                
       45D6                     ROM_BLOAD:
0005D6 45D6 CDF746          17      CALL    INIT_PARAM
0005D9 45D9 CDC247          17      CALL    FILE_B
0005DC 45DC CD0249          17      CALL    ROM_OPEN
0005DF 45DF 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005E1 45E1 2130F1          10      LD  HL,_BUF
0005E4 45E4 2226F1          16      LD  (_DTA),HL
0005E7 45E7 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
0005EA 45EA CD2247          17      CALL    ROM_READ
0005ED 45ED 3A30F1          13      LD  A,(_BUF)
0005F0 45F0 FEFE             7      CP  0FEH
0005F2 45F2 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
0005F4 45F4 210AF1          10      LD  HL,BLOAD_RET
0005F7 45F7 2202F1          16      LD  (SWC_BLOAD),HL
                                
0005FA 45FA 2A41F1          16      LD  HL,(PARAM1)
0005FD 45FD 7E               7      LD  A,(HL)
0005FE 45FE FE2C             7      CP  ','
000600 4600 2048            12      JR  NZ,RBREAD_MEM
000602 4602 23               6      INC HL
000603 4603 7E               7      LD  A,(HL)
000604 4604 CDEC48          17      CALL    CAP
000607 4607 32BEFC          13      LD  (RUNBNF),A
       460A                     RBOS1:
00060A 460A 7E               7      LD  A,(HL)
00060B 460B 23               6      INC HL
00060C 460C B7               4      OR  A
00060D 460D 282F            12      JR  Z,RBREAD_OSE
00060F 460F FE3A             7      CP  ':'
000611 4611 282B            12      JR  Z,RBREAD_OSE
000613 4613 FE2C             7      CP  ','     ;次のパラメータを探す
000615 4615 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000617 4617 2241F1          16      LD  (PARAM1),HL
00061A 461A 7E               7      LD  A,(HL)
00061B 461B B7               4      OR  A
00061C 461C 2820            12      JR  Z,RBREAD_OSE
00061E 461E DD21644C        14      LD  IX,FRMEVL
000622 4622 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000626 4626 CD1C00          17      CALL    _CALSLT
000629 4629 2241F1          16      LD  (PARAM1),HL
00062C 462C 3A63F6          13      LD  A,(VALTYP)
00062F 462F FE02             7      CP  2
000631 4631 200B            12      JR  NZ,RBREAD_OSE
000633 4633 2A31F1          16      LD  HL,(_BUF_ST)
000636 4636 ED5BF8F7        20      LD  DE,(DACDAT)
00063A 463A 19              11      ADD HL,DE
00063B 463B 2231F1          16      LD  (_BUF_ST),HL
       463E                     RBREAD_OSE:
00063E 463E 3ABEFC          13      LD  A,(RUNBNF)
000641 4641 FE53             7      CP  'S'
                                #if exists USE_RAM_BLOAD_S
                                    JR  Z,ROM_BLOAD_SCREEN
                                #else
000643 4643 2005            12      JR  NZ,RBREAD_MEM
000645 4645 3E01             7      LD  A,1
000647 4647 3228F1          13      LD  (FLG_LDIR),A
                                #endif
       464A                     RBREAD_MEM:
00064A 464A 2A31F1          16      LD  HL,(_BUF_ST)
00064D 464D 22BFFC          16      LD  (SAVENT),HL
000650 4650 2226F1          16      LD  (_DTA),HL
000653 4653 21FFFF          10      LD  HL,0FFFFH
000656 4656 CD2247          17      CALL    ROM_READ
000659 4659 3ABEFC          13      LD  A,(RUNBNF)
00065C 465C FE52             7      CP  'R'
00065E 465E 2006            12      JR  NZ,RBREAD1
000660 4660 2A35F1          16      LD  HL,(_BUF_EX)
000663 4663 2202F1          16      LD  (SWC_BLOAD),HL
       4666                     RBREAD1:
       4666                     ROM_NEXT:
000666 4666 2A41F1          16      LD  HL,(PARAM1)
000669 4669 7E               7      LD  A,(HL)
00066A 466A 2B               6      DEC HL
00066B 466B B7               4      OR  A
00066C 466C 2805            12      JR  Z,RN1
00066E 466E FE3A             7      CP  ':'
000670 4670 2801            12      JR  Z,RN1
000672 4672 23               6      INC HL
       4673                     RN1:
000673 4673 5D               4      LD  E,L
000674 4674 54               4      LD  D,H
                                
000675 4675 CDC248          17      CALL    SEARCH_END
000678 4678 B7               4      OR  A
000679 4679 2815            12      JR  Z,REM
                                                    ;マルチステートメントの処理
00067B 467B 7E               7      LD  A,(HL)
                                
00067C 467C FEB5             7      CP  0B5H            ;LOAD
00067E 467E CA7945          10      JP  Z,ROM_LOAD
000681 4681 FE8A             7      CP  08AH            ;RUN
000683 4683 280F            12      JR  Z,ROM_RUN
000685 4685 FEB7             7      CP  0B7H            ;FILES
000687 4687 2818            12      JR  Z,ROM_FILES
000689 4689 3E28             7      LD  A,028H          ;JR Z,
00068B 468B 3208F1          13      LD  (SWC_BLOAD_M),A
00068E 468E 7E               7      LD  A,(HL)
00068F 468F C9              10      RET
                                
       4690                     REM:
000690 4690 EB               4      EX  DE,HL
000691 4691 3E8F             7      LD  A,08FH          ;REM
000693 4693 C9              10      RET
                                
                                #if exists USE_RAM_BLOAD_S
                                ROM_BLOAD_SCREEN:
                                    LD  HL,(STREND)
                                    LD  (_DTA),HL
                                    EX  DE,HL
                                    LD  HL,-512
                                    ADD HL,SP
                                    XOR A
                                    SBC HL,DE
                                    JR  NC,RBS0
                                    LD  HL,BUF
                                    LD  (_DTA),HL
                                    LD  L,A ;0
                                    LD  H,A ;0
                                RBS0:
                                    INC H
                                    LD  (_BUF_EN),HL
                                RBS1:
                                    LD  HL,(_BUF_EN)
                                    CALL    ROM_READ
                                    LD  A,H
                                    OR  L
                                    JR  Z,ROM_NEXT
                                
                                    PUSH    HL
                                    LD  C,L
                                    LD  B,H
                                    LD  HL,(_DTA)   ;転送元
                                    LD  DE,(_BUF_ST)    ;転送先
                                
                                    LD  IY,(EXPTBL-1)   ;メインROMスロット
                                    LD  IX,LDIRVM
                                    CALL    _CALSLT
                                
                                    LD  HL,(_BUF_ST)
                                    POP DE
                                    ADD HL,DE
                                    LD  (_BUF_ST),HL
                                    JR  RBS1
                                #endif
                                
       4694                     ROM_RUN:
000694 4694 23               6      INC HL
000695 4695 7E               7      LD  A,(HL)
000696 4696 2B               6      DEC HL
000697 4697 B7               4      OR  A
000698 4698 2803            12      JR  Z,ROM_RUN1
00069A 469A CD7945          17      CALL    ROM_LOAD
       469D                     ROM_RUN1:
00069D 469D 3E8A             7      LD  A,08AH          ;RUN
00069F 469F 77               7      LD  (HL),A
0006A0 46A0 C9              10      RET
                                
       46A1                     ROM_FILES:
0006A1 46A1 CDF746          17      CALL    INIT_PARAM
0006A4 46A4 CDC247          17      CALL    FILE_B
0006A7 46A7 CDF34C          17      CALL    GET_DISK_BANK_FDRV
0006AA 46AA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0006AD 46AD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0006B0 46B0 3A44F1          13      LD  A,(FNAME)
0006B3 46B3 FE21             7      CP  021H
0006B5 46B5 3005            12      JR  NC,RFILES0
0006B7 46B7 060B             7      LD  B,11
0006B9 46B9 CD5648          17      CALL    FILE10
       46BC                     RFILES0:
0006BC 46BC CD1F4B          17      CALL    GET_DIR_DAT
       46BF                     RFILES1:
0006BF 46BF CD1E49          17      CALL    FILESE
0006C2 46C2 302E            12      JR  NC,RFILES_NOT_MATCH
       46C4                     RFILES_DISP:
0006C4 46C4 E5              11      PUSH    HL
0006C5 46C5 0608             7      LD  B,8
0006C7 46C7 CD7043          17      CALL    MSN
0006CA 46CA 3E2E             7      LD  A,'.'
0006CC 46CC CD504D          17      CALL    MSG_A
0006CF 46CF 0603             7      LD  B,3
0006D1 46D1 CD7043          17      CALL    MSN
0006D4 46D4 3ADDF3          13      LD  A,(CSRX)
0006D7 46D7 47               4      LD  B,A
0006D8 46D8 3AB0F3          13      LD  A,(LINLEN)
0006DB 46DB 90               4      SUB B
0006DC 46DC FE0C             7      CP  12
0006DE 46DE 3009            12      JR  NC,RFILES2
0006E0 46E0 3E0D             7      LD  A,00DH      ;改行
0006E2 46E2 CD504D          17      CALL    MSG_A
0006E5 46E5 3E0A             7      LD  A,00AH
0006E7 46E7 1802            12      JR  RFILES3
       46E9                     RFILES2:
0006E9 46E9 3E20             7      LD  A,020H
       46EB                     RFILES3:
0006EB 46EB CD504D          17      CALL    MSG_A
0006EE 46EE E1              10      POP HL
0006EF 46EF CD3A49          17      CALL    FNEXT
       46F2                     RFILES_NOT_MATCH:
0006F2 46F2 20CB            12      JR  NZ,RFILES1
0006F4 46F4 C36646          10      JP  ROM_NEXT
                                
       46F7                     INIT_PARAM:
0006F7 46F7 223FF1          16      LD  (PARAM0),HL
0006FA 46FA 2241F1          16      LD  (PARAM1),HL
0006FD 46FD EB               4      EX  DE,HL
0006FE 46FE AF               4      XOR A
                                #if exists USE_RAM_BLOAD_S
                                #else
0006FF 46FF 3228F1          13      LD  (FLG_LDIR),A
                                #endif
000702 4702 32BEFC          13      LD  (RUNBNF),A
000705 4705 3263F6          13      LD  (VALTYP),A
000708 4708 13               6      INC DE
000709 4709 CD9248          17      CALL    SPCUT
00070C 470C 1A               7      LD  A,(DE)
00070D 470D B7               4      OR  A
00070E 470E C8              11      RET Z
00070F 470F FE3A             7      CP  ':'
000711 4711 C8              11      RET Z
000712 4712 EB               4      EX  DE,HL
000713 4713 DD21644C        14      LD  IX,FRMEVL
000717 4717 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00071B 471B CD1C00          17      CALL    _CALSLT
00071E 471E 2241F1          16      LD  (PARAM1),HL
000721 4721 C9              10      RET
                                
       4722                     ROM_READ:
000722 4722 E5              11      PUSH    HL
000723 4723 D5              11      PUSH    DE
000724 4724 C5              11      PUSH    BC
000725 4725 FDE5            15      PUSH    IY
000727 4727 223DF1          16      LD  (LEFTX),HL
00072A 472A 2A26F1          16      LD  HL,(_DTA)
00072D 472D 2237F1          16      LD  (DTAX),HL
000730 4730 2A3DF1          16      LD  HL,(LEFTX)
                                
000733 4733 CD6649          17      CALL    RBX1
000736 4736 3870            12      JR  C,RBRERR1
000738 4738 79               4      LD  A,C
000739 4739 EB               4      EX  DE,HL
00073A 473A ED52            15      SBC HL,DE       ;CP 0HL,CDE
00073C 473C 19              11      ADD HL,DE
00073D 473D DE00             7      SBC A,000H
00073F 473F 3801            12      JR  C,RBR1
000741 4741 EB               4      EX  DE,HL
       4742                     RBR1:
000742 4742 9F               4      SBC A,A
000743 4743 E601             7      AND 1
000745 4745 3216F1          13      LD  (_RESULT),A
000748 4748 7C               4      LD  A,H
000749 4749 B5               4      OR  L
00074A 474A CA9E47          10      JP  Z,RBREND0
                                
00074D 474D 2222F1          16      LD  (_LEFT),HL  ;Read record byte
000750 4750 223DF1          16      LD  (LEFTX),HL
                                
000753 4753 CD8C49          17      CALL    RBX2
000756 4756 281A            12      JR  Z,RBRB
                                                ;先頭の端数
000758 4758 CD9F49          17      CALL    RBXA
00075B 475B DAB447          10      JP  C,RBRERR
00075E 475E C5              11      PUSH    BC
00075F 475F CD0B44          17      CALL    ROM_LDIR
000762 4762 ED5337F1        20      LD  (DTAX),DE
000766 4766 2A3DF1          16      LD  HL,(LEFTX)
000769 4769 D1              10      POP DE
00076A 476A A7               4      AND A
00076B 476B ED52            15      SBC HL,DE
00076D 476D 223DF1          16      LD  (LEFTX),HL
000770 4770 2829            12      JR  Z,RBREND
                                
       4772                     RBRB:
000772 4772 CDDB49          17      CALL    RBXB
000775 4775 2818            12      JR  Z,RBRC
       4777                     RBRB1:
000777 4777 C5              11      PUSH    BC
000778 4778 D5              11      PUSH    DE
000779 4779 CD834A          17      CALL    CLUST
00077C 477C EB               4      EX  DE,HL
00077D 477D ED4B18F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
000781 4781 CD0B44          17      CALL    ROM_LDIR
000784 4784 EB               4      EX  DE,HL
000785 4785 D1              10      POP DE
000786 4786 C1              10      POP BC
000787 4787 CD604A          17      CALL    GNCL
00078A 478A DAB447          10      JP  C,RBRERR
00078D 478D 10E8            13      DJNZ    RBRB1
       478F                     RBRC:
00078F 478F CDF349          17      CALL    RBXC
000792 4792 2807            12      JR  Z,RBREND
                                
000794 4794 CD834A          17      CALL    CLUST
000797 4797 EB               4      EX  DE,HL
000798 4798 CD0B44          17      CALL    ROM_LDIR
       479B                     RBREND:
00079B 479B CDFF49          17      CALL    RBXEND
       479E                     RBREND0:
00079E 479E FDE1            14      POP IY
0007A0 47A0 C1              10      POP BC
0007A1 47A1 D1              10      POP DE
0007A2 47A2 F1              10      POP AF  ;(HL)
0007A3 47A3 AF               4      XOR A
0007A4 47A4 3A16F1          13      LD  A,(_RESULT)
0007A7 47A7 C9              10      RET
                                
       47A8                     RBRERR1:
0007A8 47A8 3E01             7      LD  A,001H
       47AA                     RBRERR2:
0007AA 47AA FDE1            14      POP IY
0007AC 47AC C1              10      POP BC
0007AD 47AD D1              10      POP DE
0007AE 47AE E1              10      POP HL
0007AF 47AF 37               4      SCF
0007B0 47B0 210000          10      LD  HL,0
0007B3 47B3 C9              10      RET
       47B4                     RBRERR:
0007B4 47B4 3EFF             7      LD  A,0FFH
0007B6 47B6 18F2            12      JR  RBRERR2
                                
       47B8                     FILE_DD:
0007B8 47B8 3E                      DB  03EH
0007B9 47B9 C9              10      RET
0007BA 47BA 3208F1          13      LD  (SWC_BLOAD_M),A
0007BD 47BD 2A3FF1          16      LD  HL,(PARAM0)
0007C0 47C0 7E               7      LD  A,(HL)
0007C1 47C1 C9              10      RET
       47C2                     FILE_B:
0007C2 47C2 AF               4      XOR A
0007C3 47C3 3243F1          13      LD  (FDRV),A
0007C6 47C6 1E00             7      LD  E,0
0007C8 47C8 3A63F6          13      LD  A,(VALTYP)
0007CB 47CB FE03             7      CP  3       ;string
0007CD 47CD 2044            12      JR  NZ,FILED
                                
0007CF 47CF DD21D067        14      LD  IX,FRESTR
0007D3 47D3 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007D7 47D7 CD1C00          17      CALL    _CALSLT
0007DA 47DA E5              11      PUSH    HL
0007DB 47DB DDE1            14      POP IX
                                
0007DD 47DD DD5E00          19      LD  E,(IX+0)
0007E0 47E0 DD7E01          19      LD  A,(IX+1)
0007E3 47E3 DD5602          19      LD  D,(IX+2)
0007E6 47E6 DD62             9      LD  IXH,D
0007E8 47E8 DD6F             9      LD  IXL,A
0007EA 47EA 7B               4      LD  A,E
0007EB 47EB FE04             7      CP  4
0007ED 47ED 3808            12      JR  C,FILEB1
0007EF 47EF DD7E03          19      LD  A,(IX+3)
0007F2 47F2 FE3A             7      CP  ':'
0007F4 47F4 28C2            12      JR  Z,FILE_DD
0007F6 47F6 7B               4      LD  A,E
       47F7                     FILEB1:
0007F7 47F7 FE02             7      CP  2
0007F9 47F9 3818            12      JR  C,FILED
0007FB 47FB DD7E01          19      LD  A,(IX+1)
0007FE 47FE FE3A             7      CP  ':'
000800 4800 2011            12      JR  NZ,DEVI1
000802 4802 DD7E00          19      LD  A,(IX+0)        ;DRIVE
000805 4805 CDEC48          17      CALL    CAP
000808 4808 D640             7      SUB '@'
00080A 480A DD23            10      INC IX
00080C 480C DD23            10      INC IX
00080E 480E 1D               4      DEC E
00080F 480F 1D               4      DEC E
000810 4810 3243F1          13      LD  (FDRV),A
       4813                     DEVI1:
                                
       4813                     FILED:
000813 4813 CD5A48          17      CALL    FILEI
000816 4816 2144F1          10      LD  HL,FNAME
                                
000819 4819 0608             7      LD  B,8
       481B                     FILE2:
00081B 481B CD6748          17      CALL    CCHKF
00081E 481E C8              11      RET Z
00081F 481F FE2A             7      CP  '*'
000821 4821 282E            12      JR  Z,FILE9
000823 4823 FE2E             7      CP  '.'
000825 4825 280C            12      JR  Z,FILE4
000827 4827 77               7      LD  (HL),A
000828 4828 23               6      INC HL
000829 4829 10F0            13      DJNZ    FILE2
                                
       482B                     FILE3:
00082B 482B CD6748          17      CALL    CCHKF
00082E 482E C8              11      RET Z
00082F 482F FE2E             7      CP  '.'
000831 4831 20F8            12      JR  NZ,FILE3
                                
       4833                     FILE4:
000833 4833 214CF1          10      LD  HL,FNAME+8
000836 4836 0603             7      LD  B,3
                                
       4838                     FILE4L:
000838 4838 CD6748          17      CALL    CCHKF
00083B 483B C8              11      RET Z
00083C 483C FE2E             7      CP  '.'
00083E 483E 2008            12      JR  NZ,FILE12
000840 4840 3244F1          13      LD  (FNAME),A   ;Parent directory(..)
000843 4843 3245F1          13      LD  (FNAME+1),A
000846 4846 3E20             7      LD  A,020H
       4848                     FILE12:
000848 4848 FE2A             7      CP  '*'
00084A 484A 280A            12      JR  Z,FILE10
00084C 484C 77               7      LD  (HL),A
00084D 484D 23               6      INC HL
00084E 484E 10E8            13      DJNZ    FILE4L
000850 4850 C9              10      RET
                                
       4851                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000851 4851 CD5648          17      CALL    FILE10
000854 4854 18D5            12      JR  FILE3
                                
       4856                     FILE10:
000856 4856 3E3F             7      LD  A,'?'
000858 4858 1808            12      JR  FILL_MEMORY
       485A                     FILEI:              ;名前＋拡張子をスペースで初期化
00085A 485A 3E20             7      LD  A,020H
00085C 485C 01000B          10      LD  BC,11*256   ;C=0にしておく
00085F 485F 2144F1          10      LD  HL,FNAME
       4862                     FILL_MEMORY:            ;HLからBバイトAで埋める
000862 4862 77               7      LD  (HL),A
000863 4863 23               6      INC HL
000864 4864 10FC            13      DJNZ    FILL_MEMORY
000866 4866 C9              10      RET
                                
       4867                     CCHKF:
000867 4867 7B               4      LD  A,E
000868 4868 B7               4      OR  A
000869 4869 C8              11      RET Z
00086A 486A DD7E00          19      LD  A,(IX+0)
00086D 486D CD7448          17      CALL    CCHK2
000870 4870 C8              11      RET Z
000871 4871 C3D748          10      JP  FKAN
                                
       4874                     CCHK2:
000874 4874 0C               4      INC C
000875 4875 0D               4      DEC C
000876 4876 C0              11      RET NZ
       4877                     CCHK3:              ;ZF=1 で使えない文字
000877 4877 FE2B             7      CP  '+'
000879 4879 C8              11      RET Z
00087A 487A FE2C             7      CP  ','
00087C 487C C8              11      RET Z
00087D 487D FE2F             7      CP  '/'
00087F 487F C8              11      RET Z
000880 4880 FE3A             7      CP  ':'
000882 4882 C8              11      RET Z
000883 4883 FE3B             7      CP  ';'
000885 4885 C8              11      RET Z
000886 4886 FE3D             7      CP  '='
000888 4888 C8              11      RET Z
000889 4889 FE5C             7      CP  05CH    ;\
00088B 488B C8              11      RET Z
00088C 488C FE1F             7      CP  01FH
00088E 488E D0              11      RET NC
00088F 488F BF               4      CP  A       ;Z=1
000890 4890 C9              10      RET
                                
       4891                     SS1:
000891 4891 13               6      INC DE
       4892                     SPCUT:              ;スペースをカット
000892 4892 1A               7      LD  A,(DE)
000893 4893 FE20             7      CP  020H
000895 4895 28FA            12      JR  Z,SS1
000897 4897 C9              10      RET
                                
       4898                     SCREOF1:
000898 4898 13               6      INC DE
       4899                     SPCUTEX:            ;スペース改行などをカット
000899 4899 1A               7      LD  A,(DE)
00089A 489A FE20             7      CP  020H
00089C 489C 28FA            12      JR  Z,SCREOF1
00089E 489E FE0D             7      CP  00DH
0008A0 48A0 28F6            12      JR  Z,SCREOF1
0008A2 48A2 FE0A             7      CP  00AH
0008A4 48A4 28F2            12      JR  Z,SCREOF1
0008A6 48A6 FE1A             7      CP  01AH
0008A8 48A8 28EE            12      JR  Z,SCREOF1
0008AA 48AA C9              10      RET
                                
       48AB                     GETNUM:
0008AB 48AB 210000          10      LD  HL,0
       48AE                     GETNUM1:
0008AE 48AE 1A               7      LD  A,(DE)
0008AF 48AF 13               6      INC DE
0008B0 48B0 D630             7      SUB '0'
0008B2 48B2 D8              11      RET C
0008B3 48B3 FE0A             7      CP  10
0008B5 48B5 D0              11      RET NC
0008B6 48B6 4D               4      LD  C,L
0008B7 48B7 44               4      LD  B,H
0008B8 48B8 29              11      ADD HL,HL   ;*2
0008B9 48B9 29              11      ADD HL,HL   ;*4
0008BA 48BA 09              11      ADD HL,BC   ;*5
0008BB 48BB 29              11      ADD HL,HL   ;*10
0008BC 48BC 4F               4      LD  C,A
0008BD 48BD 0600             7      LD  B,0
0008BF 48BF 09              11      ADD HL,BC
0008C0 48C0 18EC            12      JR  GETNUM1
                                
       48C2                     SEARCH_END:
0008C2 48C2 7E               7      LD  A,(HL)
       48C3                     SEARCH_END1:
0008C3 48C3 23               6      INC HL
0008C4 48C4 B7               4      OR  A
0008C5 48C5 C8              11      RET Z
0008C6 48C6 FE3A             7      CP  ':'
0008C8 48C8 20F8            12      JR  NZ,SEARCH_END
0008CA 48CA 7E               7      LD  A,(HL)
0008CB 48CB FE3A             7      CP  ':'
0008CD 48CD 28F4            12      JR  Z,SEARCH_END1
0008CF 48CF C9              10      RET
                                
       48D0                     FKANC:
0008D0 48D0 CB41             8      BIT 0,C
0008D2 48D2 CCF548          17      CALL    Z,CAP2
0008D5 48D5 1803            12      JR  FKANX
       48D7                     FKAN:           ;漢字チェック
0008D7 48D7 DD23            10      INC IX
0008D9 48D9 1D               4      DEC E
       48DA                     FKANX:
0008DA 48DA CB41             8      BIT 0,C
0008DC 48DC CB81             8      RES 0,C
0008DE 48DE C0              11      RET NZ
0008DF 48DF FE80             7      CP  080H
0008E1 48E1 D8              11      RET C
0008E2 48E2 FEA0             7      CP  0A0H
0008E4 48E4 3803            12      JR  C,FKAN1
0008E6 48E6 FEE0             7      CP  0E0H
0008E8 48E8 D8              11      RET C
       48E9                     FKAN1:
0008E9 48E9 0C               4      INC C
0008EA 48EA A7               4      AND A
0008EB 48EB C9              10      RET
                                
       48EC                     CAP:
0008EC 48EC FE61             7      CP  'a'
0008EE 48EE D8              11      RET C
0008EF 48EF FE7B             7      CP  'z'+1
0008F1 48F1 D0              11      RET NC
0008F2 48F2 D620             7      SUB 020H
0008F4 48F4 C9              10      RET
       48F5                     CAP2:
0008F5 48F5 CDEC48          17      CALL    CAP
       48F8                     CAP3:               ;
0008F8 48F8 FE05             7      CP  5
0008FA 48FA 2803            12      JR  Z,CAP4
0008FC 48FC FE21             7      CP  021H
0008FE 48FE C9              10      RET
       48FF                     CAP4:
0008FF 48FF 3EE5             7      LD  A,0E5H
000901 4901 C9              10      RET
                                
       4902                     ROM_OPEN:
000902 4902 CDF34C          17      CALL    GET_DISK_BANK_FDRV
                                
000905 4905 CD1F4B          17      CALL    GET_DIR_DAT
000908 4908 D5              11      PUSH    DE
000909 4909 CD1E49          17      CALL    FILESE
00090C 490C D1              10      POP DE
00090D 490D 3F               4      CCF
00090E 490E D8              11      RET C
00090F 490F 223BF1          16      LD  (FCBX),HL
000912 4912 E5              11      PUSH    HL
000913 4913 210000          10      LD  HL,0
000916 4916 221CF1          16      LD  (RR_LOW),HL
000919 4919 221EF1          16      LD  (RR_HIGH),HL
00091C 491C E1              10      POP HL
00091D 491D C9              10      RET
                                
       491E                     FILESE:
00091E 491E 7E               7      LD  A,(HL)
00091F 491F B7               4      OR  A
000920 4920 C8              11      RET Z       ;END:ZF=1 CF=0
000921 4921 FEE5             7      CP  0E5H
000923 4923 280D            12      JR  Z,FILESE1
000925 4925 1144F1          10      LD  DE,FNAME
000928 4928 E5              11      PUSH    HL
000929 4929 CD4049          17      CALL    CPFILE
00092C 492C CC6149          17      CALL    Z,CPFILE2
00092F 492F E1              10      POP HL
000930 4930 37               4      SCF
000931 4931 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4932                     FILESE1:
000932 4932 CD3A49          17      CALL    FNEXT
000935 4935 20E7            12      JR  NZ,FILESE
       4937                     ZF0_CF0_AFF_RET:
000937 4937 F6FF             7      OR  0FFH        ;ZF=0 CF=0
000939 4939 C9              10      RET
                                
       493A                     FNEXT:
00093A 493A 112000          10      LD  DE,020H
00093D 493D 19              11      ADD HL,DE
00093E 493E 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
00093F 493F C9              10      RET
                                
       4940                     CPFILE:
000940 4940 C5              11      PUSH    BC
000941 4941 01000B          10      LD  BC,00B00H
       4944                     CPSTR1:
000944 4944 1A               7      LD  A,(DE)
000945 4945 FE3F             7      CP  '?'     ;Wild card
000947 4947 2812            12      JR  Z,CPSTR2
000949 4949 7E               7      LD  A,(HL)
00094A 494A CDD048          17      CALL    FKANC
00094D 494D E5              11      PUSH    HL
00094E 494E 67               4      LD  H,A
00094F 494F 1A               7      LD  A,(DE)
000950 4950 CB01             4      RLC C
000952 4952 CDD048          17      CALL    FKANC
000955 4955 CB09             4      RRC C
000957 4957 BC               4      CP  H       ;CP (HL),(DE)
000958 4958 E1              10      POP HL
000959 4959 2004            12      JR  NZ,CPSTR3
       495B                     CPSTR2:
00095B 495B 13               6      INC DE
00095C 495C 23               6      INC HL
00095D 495D 10E5            13      DJNZ    CPSTR1
       495F                     CPSTR3:
00095F 495F C1              10      POP BC
000960 4960 C9              10      RET
                                
       4961                     CPFILE2:
                                ;   LD  A,(IY+13)   ;(FCB)属性(アトリビュート)
                                ;   OR  0E1H
000961 4961 3EE1             7      LD  A,0E1H
000963 4963 2F               4      CPL
000964 4964 A6               7      AND (HL)
000965 4965 C9              10      RET
                                
       4966                     RBX1:
000966 4966 E5              11      PUSH    HL      ;Record byte
                                
000967 4967 ED5B1CF1        20      LD  DE,(RR_LOW) ;CDE=Random record
00096B 496B 3A1FF1          13      LD  A,(RR_HIGH+1)
00096E 496E 4F               4      LD  C,A
                                
00096F 496F CDF34C          17      CALL    GET_DISK_BANK_FDRV
                                
000972 4972 FD2A3BF1        20      LD  IY,(FCBX)
000976 4976 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000979 4979 FD661D          19      LD  H,(IY+01DH)
00097C 497C FD7E1E          19      LD  A,(IY+01EH)
                                
00097F 497F A7               4      AND A
000980 4980 ED52            15      SBC HL,DE
000982 4982 99               4      SBC A,C
000983 4983 D1              10      POP DE
                                
000984 4984 D8              11      RET C
000985 4985 4F               4      LD  C,A
000986 4986 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000987 4987 B2               4      OR  D
000988 4988 B3               4      OR  E
000989 4989 C0              11      RET NZ
00098A 498A 37               4      SCF
00098B 498B C9              10      RET
                                
       498C                     RBX2:
00098C 498C ED4B1DF1        20      LD  BC,(RR_LOW+1)
000990 4990 CD144A          17      CALL    RWXR
000993 4993 3A19F1          13      LD  A,(CLSZ_H)
000996 4996 3D               4      DEC A
000997 4997 E5              11      PUSH    HL
000998 4998 2A1CF1          16      LD  HL,(RR_LOW)
00099B 499B A4               4      AND H
00099C 499C B5               4      OR  L
00099D 499D E1              10      POP HL
00099E 499E C9              10      RET
                                
       499F                     RBXA:
00099F 499F D5              11      PUSH    DE
0009A0 49A0 CD834A          17      CALL    CLUST
0009A3 49A3 ED5324F1        20      LD  (_DTPS),DE
0009A7 49A7 D1              10      POP DE
0009A8 49A8 CD604A          17      CALL    GNCL
0009AB 49AB D8              11      RET C
0009AC 49AC ED5320F1        20      LD  (_CLPS),DE
                                
0009B0 49B0 ED4B1CF1        20      LD  BC,(RR_LOW)
0009B4 49B4 2A18F1          16      LD  HL,(CLSZ)
0009B7 49B7 7C               4      LD  A,H
0009B8 49B8 3D               4      DEC A
0009B9 49B9 A0               4      AND B
0009BA 49BA 47               4      LD  B,A
0009BB 49BB ED42            15      SBC HL,BC       ;remaining cluster
                                
0009BD 49BD ED5B3DF1        20      LD  DE,(LEFTX)
0009C1 49C1 ED52            15      SBC HL,DE       ;CP HL,DE
0009C3 49C3 19              11      ADD HL,DE
0009C4 49C4 3801            12      JR  C,RBXA1
0009C6 49C6 EB               4      EX  DE,HL
       49C7                     RBXA1:
0009C7 49C7 3A17F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
0009CA 49CA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0009CD 49CD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0009D0 49D0 E5              11      PUSH    HL
0009D1 49D1 2A24F1          16      LD  HL,(_DTPS)
0009D4 49D4 09              11      ADD HL,BC
0009D5 49D5 ED5B37F1        20      LD  DE,(DTAX)
0009D9 49D9 C1              10      POP BC
0009DA 49DA C9              10      RET
                                
       49DB                     RBXB:
0009DB 49DB 2A37F1          16      LD  HL,(DTAX)
0009DE 49DE ED5B20F1        20      LD  DE,(_CLPS)
0009E2 49E2 3A3EF1          13      LD  A,(LEFTX+1)
0009E5 49E5 47               4      LD  B,A
0009E6 49E6 3A19F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       49E9                     RBXB1:
0009E9 49E9 1F               4      RRA     ;->CF
0009EA 49EA 3804            12      JR  C,RBXB2
0009EC 49EC CB38             8      SRL B   ;B=B/2
0009EE 49EE 18F9            12      JR  RBXB1
       49F0                     RBXB2:
0009F0 49F0 78               4      LD  A,B
0009F1 49F1 B7               4      OR  A
0009F2 49F2 C9              10      RET
                                
       49F3                     RBXC:
0009F3 49F3 ED4B3DF1        20      LD  BC,(LEFTX)
0009F7 49F7 3A19F1          13      LD  A,(CLSZ_H)
0009FA 49FA 3D               4      DEC A
0009FB 49FB A0               4      AND B
0009FC 49FC 47               4      LD  B,A
0009FD 49FD B1               4      OR  C
0009FE 49FE C9              10      RET
                                
       49FF                     RBXEND:
0009FF 49FF ED5B22F1        20      LD  DE,(_LEFT)
000A03 4A03 2A1CF1          16      LD  HL,(RR_LOW)
000A06 4A06 3A1FF1          13      LD  A,(RR_HIGH+1)
000A09 4A09 19              11      ADD HL,DE
000A0A 4A0A CE00             7      ADC A,0
000A0C 4A0C 221CF1          16      LD  (RR_LOW),HL
000A0F 4A0F 321FF1          13      LD  (RR_HIGH+1),A
000A12 4A12 EB               4      EX  DE,HL       ;HL=Read byte
000A13 4A13 C9              10      RET 
                                
       4A14                     RWXR:
000A14 4A14 3A19F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4A17                     L_RWX:
000A17 4A17 1F               4      RRA     ;->CF
000A18 4A18 3806            12      JR  C,E_RWX
000A1A 4A1A CB38             8      SRL B   ;BC=BC/2
000A1C 4A1C CB19             8      RR  C   ;
000A1E 4A1E 18F7            12      JR  L_RWX
       4A20                     E_RWX:
000A20 4A20 CDF34C          17      CALL    GET_DISK_BANK_FDRV
                                
000A23 4A23 FD2A3BF1        20      LD  IY,(FCBX)
000A27 4A27 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000A2A 4A2A FD561B          19      LD  D,(IY+01BH)
       4A2D                     RWX1:
000A2D 4A2D ED5320F1        20      LD  (_CLPS),DE
000A31 4A31 7A               4      LD  A,D
000A32 4A32 B3               4      OR  E
000A33 4A33 37               4      SCF
000A34 4A34 C8              11      RET Z
                                
000A35 4A35 78               4      LD  A,B
000A36 4A36 B1               4      OR  C
000A37 4A37 C8              11      RET Z
                                
000A38 4A38 CD604A          17      CALL    GNCL
000A3B 4A3B D8              11      RET C
000A3C 4A3C 0B               6      DEC BC
000A3D 4A3D CDB84A          17      CALL    ENDCL
000A40 4A40 38EB            12      JR  C,RWX1
000A42 4A42 37               4      SCF
000A43 4A43 C9              10      RET
                                
       4A44                     NCL3:
000A44 4A44 CDF34C          17      CALL    GET_DISK_BANK_FDRV
000A47 4A47 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000A4A 4A4A 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000A4D 4A4D 6B               4      LD  L,E
000A4E 4A4E 62               4      LD  H,D
000A4F 4A4F CB3C             8      SRL H
000A51 4A51 CB1D             8      RR  L
000A53 4A53 1F               4      RRA
000A54 4A54 19              11      ADD HL,DE
000A55 4A55 010060          10      LD  BC,BANK1_ADR
000A58 4A58 09              11      ADD HL,BC
000A59 4A59 ED4B1AF1        20      LD  BC,(SECSZ)
000A5D 4A5D 09              11      ADD HL,BC
000A5E 4A5E 17               4      RLA
000A5F 4A5F C9              10      RET
                                
       4A60                     GNCL:
000A60 4A60 7A               4      LD  A,D
000A61 4A61 B3               4      OR  E
000A62 4A62 37               4      SCF
000A63 4A63 C8              11      RET Z
000A64 4A64 C5              11      PUSH    BC
000A65 4A65 E5              11      PUSH    HL
000A66 4A66 CD444A          17      CALL    NCL3
000A69 4A69 3809            12      JR  C,GNC1
000A6B 4A6B 5E               7      LD  E,(HL)
000A6C 4A6C 23               6      INC HL
000A6D 4A6D 7E               7      LD  A,(HL)
000A6E 4A6E E60F             7      AND 00FH
000A70 4A70 57               4      LD  D,A
000A71 4A71 E1              10      POP HL
000A72 4A72 C1              10      POP BC
000A73 4A73 C9              10      RET
       4A74                     GNC1:
000A74 4A74 7E               7      LD  A,(HL)
000A75 4A75 23               6      INC HL
000A76 4A76 56               7      LD  D,(HL)
000A77 4A77 0604             7      LD  B,4
       4A79                     GNC1L:
000A79 4A79 CB3A             8      SRL D
000A7B 4A7B 1F               4      RRA
000A7C 4A7C 10FB            13      DJNZ    GNC1L
                                
000A7E 4A7E 5F               4      LD  E,A
000A7F 4A7F E1              10      POP HL
000A80 4A80 C1              10      POP BC
000A81 4A81 A7               4      AND A
000A82 4A82 C9              10      RET
                                
       4A83                     CLUST:
000A83 4A83 EB               4      EX  DE,HL
000A84 4A84 C5              11      PUSH    BC
000A85 4A85 3A19F1          13      LD  A,(CLSZ_H)
000A88 4A88 CD1F4D          17      CALL    MUL_AHL
                                
000A8B 4A8B CD2C4B          17      CALL    GET_DIR_POS
000A8E 4A8E 4F               4      LD  C,A
000A8F 4A8F 0600             7      LD  B,0
000A91 4A91 09              11      ADD HL,BC
                                
000A92 4A92 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000A95 4A95 0F               4      RRCA
000A96 4A96 0F               4      RRCA
000A97 4A97 0F               4      RRCA
000A98 4A98 0F               4      RRCA
000A99 4A99 4F               4      LD  C,A
                                
000A9A 4A9A 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000A9D 4A9D FE02             7      CP  2
000A9F 4A9F 280C            12      JR  Z,CLUST1
000AA1 4AA1 CB01             4      RLC C
000AA3 4AA3 0D               4      DEC C
000AA4 4AA4 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000AA7 4AA7 FE02             7      CP  2
000AA9 4AA9 2002            12      JR  NZ,CLUST1
000AAB 4AAB 0D               4      DEC C
000AAC 4AAC 0D               4      DEC C
       4AAD                     CLUST1:
000AAD 4AAD 0D               4      DEC C
000AAE 4AAE 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000AAF 4AAF 7D               4      LD  A,L
                                #else
                                    PUSH    HL
                                    ADD HL,HL   ;*2
                                    ADD HL,HL   ;*4
                                    ADD HL,HL   ;*8
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    POP HL
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
000AB0 4AB0 C660             7      ADD A,high BANK1_ADR
000AB2 4AB2 67               4      LD  H,A
000AB3 4AB3 2E00             7      LD  L,0
000AB5 4AB5 EB               4      EX  DE,HL
000AB6 4AB6 C1              10      POP BC
000AB7 4AB7 C9              10      RET
                                
       4AB8                     ENDCL:
000AB8 4AB8 7A               4      LD  A,D ;END CLUSTER
000AB9 4AB9 FE0F             7      CP  00FH    ;FAT12の最大値
000ABB 4ABB C0              11      RET NZ
000ABC 4ABC 7B               4      LD  A,E
000ABD 4ABD FEF7             7      CP  0F7H
000ABF 4ABF C9              10      RET
                                
       4AC0                     RB_READ:
000AC0 4AC0 AF               4      XOR A   ;HLA = HL*128
000AC1 4AC1 CB3C             8      SRL H
000AC3 4AC3 CB1D             8      RR  L
000AC5 4AC5 1F               4      RRA
000AC6 4AC6 321CF1          13      LD  (RR_LOW),A
000AC9 4AC9 221DF1          16      LD  (RR_MID),HL
000ACC 4ACC 218000          10      LD  HL,128
                                
000ACF 4ACF CD2247          17      CALL    ROM_READ
000AD2 4AD2 C9              10      RET
                                
       4AD3                     GETSEQ:
000AD3 4AD3 FD6E20          19      LD  L,(IY+32)
000AD6 4AD6 FD660C          19      LD  H,(IY+12)
                                
000AD9 4AD9 CB25             8      SLA L
                                
000ADB 4ADB CB3C             8      SRL H
000ADD 4ADD CB1D             8      RR  L
000ADF 4ADF C9              10      RET
                                
       4AE0                     SETSEQ:
000AE0 4AE0 F5              11      PUSH    AF
000AE1 4AE1 3A1CF1          13      LD  A,(RR_LOW)
000AE4 4AE4 2A1DF1          16      LD  HL,(RR_MID)
                                
000AE7 4AE7 CDFE4A          17      CALL    SSQ1
                                
000AEA 4AEA 29              11      ADD HL,HL
000AEB 4AEB CB3D             8      SRL L
000AED 4AED FD7520          19      LD  (IY+32),L
000AF0 4AF0 FD740C          19      LD  (IY+12),H
000AF3 4AF3 F1              10      POP AF
000AF4 4AF4 C9              10      RET
                                
       4AF5                     GETSIZE:
000AF5 4AF5 FD7E10          19      LD  A,(IY+16)
000AF8 4AF8 FD6E11          19      LD  L,(IY+17)
000AFB 4AFB FD6612          19      LD  H,(IY+18)
       4AFE                     SSQ1:
000AFE 4AFE 87               4      ADD A,A
000AFF 4AFF ED6A            15      ADC HL,HL
000B01 4B01 B7               4      OR  A
000B02 4B02 C8              11      RET Z
000B03 4B03 23               6      INC HL
000B04 4B04 C9              10      RET
                                
       4B05                     SET_FCB:
000B05 4B05 D5              11      PUSH    DE
000B06 4B06 FDE1            14      POP IY
000B08 4B08 FD7E1C          19      LD  A,(IY+28)
000B0B 4B0B FEFF             7      CP  0FFH
000B0D 4B0D 200C            12      JR  NZ,POPAF_SCF_FF_RET
000B0F 4B0F E5              11      PUSH    HL
000B10 4B10 FD6E1A          19      LD  L,(IY+26)
000B13 4B13 FD661B          19      LD  H,(IY+27)
000B16 4B16 2220F1          16      LD  (_CLPS),HL
000B19 4B19 E1              10      POP HL
000B1A 4B1A C9              10      RET
                                
       4B1B                     POPAF_SCF_FF_RET:
000B1B 4B1B F1              10      POP AF
000B1C 4B1C 37               4      SCF
000B1D 4B1D 9F               4      SBC A,A
000B1E 4B1E C9              10      RET
                                
       4B1F                     GET_DIR_DAT:
000B1F 4B1F CD2C4B          17      CALL    GET_DIR_POS
000B22 4B22 C660             7      ADD A,high BANK1_ADR
000B24 4B24 2E00             7      LD  L,0
000B26 4B26 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000B27 4B27 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000B2A 4B2A 4F               4      LD  C,A
000B2B 4B2B C9              10      RET
                                
       4B2C                     GET_DIR_POS:
000B2C 4B2C CDF34C          17      CALL    GET_DISK_BANK_FDRV
000B2F 4B2F 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B32 4B32 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B35 4B35 3217F1          13      LD  (_BANK),A
000B38 4B38 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000B3B 4B3B 47               4      LD  B,A
000B3C 4B3C 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000B3F 4B3F 4F               4      LD  C,A
000B40 4B40 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4B43                     GET_DIR_POS1:
000B43 4B43 81               4      ADD A,C
000B44 4B44 10FD            13      DJNZ    GET_DIR_POS1
                                
000B46 4B46 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4B4A                     L_MDP:
000B4A 4B4A CB18             8      RR  B   ;->CF
000B4C 4B4C D8              11      RET C
000B4D 4B4D 87               4      ADD A,A
000B4E 4B4E 18FA            12      JR  L_MDP
                                
       4B50                     WILDCARD:
000B50 4B50 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4B5B                     ERROR_WRITE_PROTECTED:
000B5B 4B5B 3E00             7      LD  A,0     ;Write protected
000B5D 4B5D C9              10      RET
       4B5E                     DISKIO:
000B5E 4B5E 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000B60 4B60 48               4      LD  C,B
000B61 4B61 CDFD4C          17      CALL    GET_DISK_BANK
       4B64                     SETMAP1:        
000B64 4B64 E5              11      PUSH    HL
       4B65                     DISKIO1:
000B65 4B65 C5              11      PUSH    BC      ;B=残りのセクタ数
000B66 4B66 D5              11      PUSH    DE      ;DE=セクタ番号
000B67 4B67 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000B68 4B68 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000B69 4B69 F5              11      PUSH    AF
000B6A 4B6A 3A1BF1          13      LD  A,(SECSZ_H)
000B6D 4B6D CD1F4D          17      CALL    MUL_AHL
000B70 4B70 F1              10      POP AF
000B71 4B71 4D               4      LD  C,L     ;C=読み出し元
000B72 4B72 29              11      ADD HL,HL       ;64KB→32KB
000B73 4B73 29              11      ADD HL,HL       ;32KB→16KB
000B74 4B74 29              11      ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
000B75 4B75 84               4      ADD A,H
000B76 4B76 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000B79 4B79 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000B7C 4B7C 3217F1          13      LD  (_BANK),A
000B7F 4B7F 79               4      LD  A,C     ;C=読み出し元
000B80 4B80 E61F             7      AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
000B82 4B82 C660             7      ADD A,high BANK1_ADR
000B84 4B84 67               4      LD  H,A
000B85 4B85 ED4B1AF1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000B89 4B89 69               4      LD  L,C     ;C=0
000B8A 4B8A EDB0                    LDIR
000B8C 4B8C EB               4      EX  DE,HL
000B8D 4B8D F1              10      POP AF
000B8E 4B8E D1              10      POP DE
000B8F 4B8F 13               6      INC DE
000B90 4B90 C1              10      POP BC
000B91 4B91 10D2            13      DJNZ    DISKIO1
000B93 4B93 41               4      LD  B,C
                                
000B94 4B94 E1              10      POP HL
000B95 4B95 AF               4      XOR A
000B96 4B96 FB               4      EI
000B97 4B97 C9              10      RET
                                
       4B98                     DSKCHG:
000B98 4B98 CDD14B          17      CALL    IS_BPB
000B9B 4B9B 3824            12      JR  C,NOTREADY
000B9D 4B9D 3A23FB          13      LD  A,(DRVTBL+2)
000BA0 4BA0 B7               4      OR  A
000BA1 4BA1 201A            12      JR  NZ,DSKCHG1
000BA3 4BA3 3A21FB          13      LD  A,(DRVTBL)
000BA6 4BA6 FE02             7      CP  2
000BA8 4BA8 2013            12      JR  NZ,DSKCHG1
000BAA 4BAA CDD14B          17      CALL    IS_BPB
000BAD 4BAD 300E            12      JR  NC,DSKCHG1
000BAF 4BAF 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000BB1 4BB1 3221FB          13      LD  (DRVTBL),A
000BB4 4BB4 3223FB          13      LD  (DRVTBL+2),A
000BB7 4BB7 3A48F3          13      LD  A,(MASTERS)
000BBA 4BBA 3224FB          13      LD  (DRVTBL+3),A
       4BBD                     DSKCHG1:
000BBD 4BBD AF               4      XOR A
000BBE 4BBE 0601             7      LD  B,1
000BC0 4BC0 C9              10      RET
       4BC1                     NOTREADY:
000BC1 4BC1 3E02             7      LD  A,2
000BC3 4BC3 37               4      SCF
000BC4 4BC4 C9              10      RET
                                
       4BC5                     NO_BPB:
000BC5 4BC5 E1              10      POP HL
000BC6 4BC6 23               6      INC HL
000BC7 4BC7 11244D          10      LD  DE,DPB2DD
000BCA 4BCA 011200          10      LD  BC,DPB2DD_E-DPB2DD
000BCD 4BCD EDB0                    LDIR
000BCF 4BCF AF               4      XOR A
000BD0 4BD0 C9              10      RET
                                
       4BD1                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000BD1 4BD1 CDFD4C          17      CALL    GET_DISK_BANK
                                
000BD4 4BD4 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000BD7 4BD7 FE01             7      CP  1
000BD9 4BD9 D8              11      RET C
                                
000BDA 4BDA 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000BDD 4BDD C6FF             7      ADD A,0FFH
000BDF 4BDF D8              11      RET C
                                
000BE0 4BE0 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000BE3 4BE3 FE01             7      CP  1
000BE5 4BE5 C8              11      RET Z
000BE6 4BE6 FE02             7      CP  2
000BE8 4BE8 C8              11      RET Z
000BE9 4BE9 FE04             7      CP  4
000BEB 4BEB C8              11      RET Z
000BEC 4BEC 37               4      SCF
000BED 4BED C9              10      RET
                                
       4BEE                     GETDPB:
000BEE 4BEE E5              11      PUSH    HL
000BEF 4BEF CDFD4C          17      CALL    GET_DISK_BANK
                                
000BF2 4BF2 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000BF5 4BF5 B7               4      OR  A
000BF6 4BF6 28CD            12      JR  Z,NO_BPB
000BF8 4BF8 DDE1            14      POP IX
000BFA 4BFA DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000BFD 4BFD 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000C00 4C00 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000C03 4C03 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000C06 4C06 DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000C09 4C09 87               4      ADD A,A
000C0A 4C0A 87               4      ADD A,A
000C0B 4C0B 87               4      ADD A,A
000C0C 4C0C 3D               4      DEC A
000C0D 4C0D DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000C10 4C10 06FF             7      LD  B,-1
000C12 4C12 A7               4      AND A           ;無限ループ阻止
       4C13                     GETDPB1:
000C13 4C13 04               4      INC B
000C14 4C14 1F               4      RRA
000C15 4C15 38FC            12      JR  C,GETDPB1
000C17 4C17 DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000C1A 4C1A 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000C1D 4C1D 3D               4      DEC A
000C1E 4C1E DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000C21 4C21 A7               4      AND A           ;無限ループ阻止
000C22 4C22 06FF             7      LD  B,-1
       4C24                     GETDPB2:
000C24 4C24 04               4      INC B
000C25 4C25 1F               4      RRA
000C26 4C26 38FC            12      JR  C,GETDPB2
000C28 4C28 04               4      INC B
000C29 4C29 DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000C2C 4C2C 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000C2F 4C2F DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000C32 4C32 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000C35 4C35 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000C38 4C38 DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000C3B 4C3B 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000C3E 4C3E DD770B          19      LD  (IX+11),A       ;FATCNT
                                
000C41 4C41 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000C45 4C45 DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000C48 4C48 DD460A          19      LD  B,(IX+10)       ;FATCNT
000C4B 4C4B 210000          10      LD  HL,0
       4C4E                     GETDPB3:
000C4E 4C4E 19              11      ADD HL,DE
000C4F 4C4F 10FD            13      DJNZ    GETDPB3
       4C51                     GETDPB4:
000C51 4C51 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000C54 4C54 DD5609          19      LD  D,(IX+9)        ;FIRFAT
000C57 4C57 19              11      ADD HL,DE
000C58 4C58 DD7511          19      LD  (IX+17),L       ;FIRDIR
000C5B 4C5B DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000C5E 4C5E DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C61 4C61 87               4      ADD A,A
000C62 4C62 87               4      ADD A,A
000C63 4C63 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4C66                     GETDPB5:
000C66 4C66 CB3B             8      SRL E
000C68 4C68 1F               4      RRA
000C69 4C69 30FB            12      JR  NC,GETDPB5
000C6B 4C6B 1600             7      LD  D,0
000C6D 4C6D 19              11      ADD HL,DE
000C6E 4C6E DD750C          19      LD  (IX+12),L       ;FIRREC
000C71 4C71 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000C74 4C74 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000C77 4C77 DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000C7A 4C7A DD560D          19      LD  D,(IX+13)       ;FIRREC
000C7D 4C7D A7               4      AND A
000C7E 4C7E ED52            15      SBC HL,DE
                                
000C80 4C80 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000C83 4C83 3C               4      INC A
000C84 4C84 37               4      SCF             ;無限ループ阻止
       4C85                     GETDPB6:
000C85 4C85 1F               4      RRA
000C86 4C86 3806            12      JR  C,GETDPB7
000C88 4C88 CB3C             8      SRL H
000C8A 4C8A CB1D             8      RR  L
000C8C 4C8C 18F7            12      JR  GETDPB6
       4C8E                     GETDPB7:
000C8E 4C8E 23               6      INC HL
000C8F 4C8F DD750E          19      LD  (IX+14),L       ;MAXCLUS
000C92 4C92 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       4C95                     GETDPBD1:
000C95 4C95 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000C98 4C98 E6FC             7      AND 0FCH
000C9A 4C9A C8              11      RET Z
                                
000C9B 4C9B DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
000C9F 4C9F 37               4      SCF
000CA0 4CA0 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
000CA4 4CA4 DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
000CA7 4CA7 DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
000CAB 4CAB DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
000CAF 4CAF DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
000CB3 4CB3 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
000CB7 4CB7 DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
000CBB 4CBB DDCB1126        23      SLA (IX+17)         ;FIRDIR
000CBF 4CBF DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
000CC3 4CC3 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
000CC6 4CC6 DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
000CC9 4CC9 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000CCC 4CCC 87               4      ADD A,A
000CCD 4CCD 87               4      ADD A,A
000CCE 4CCE DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4CD1                     GETDPBD5:
000CD1 4CD1 CB3B             8      SRL E
000CD3 4CD3 1F               4      RRA
000CD4 4CD4 30FB            12      JR  NC,GETDPBD5
000CD6 4CD6 1600             7      LD  D,0
000CD8 4CD8 19              11      ADD HL,DE
000CD9 4CD9 DD750C          19      LD  (IX+12),L       ;FIRREC
000CDC 4CDC DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000CDF 4CDF 18B4            12      JR  GETDPBD1
                                
       4CE1                     CHOICE:
000CE1 4CE1 210000          10      LD  HL,0
000CE4 4CE4 C9              10      RET
                                
       4CE5                     DSKFMT:
000CE5 4CE5 AF               4      XOR A
000CE6 4CE6 37               4      SCF
       4CE7                     DSKSTP:
000CE7 4CE7 C9              10      RET
                                
       4CE8                     BASENT:
000CE8 4CE8 ED7B4FF1        20      LD  SP,(BASSTK)
000CEC 4CEC C39F43          10      JP  BASAUTO
                                
       4CEF                     GETSLT:
000CEF 4CEF 3A22FB          13      LD  A,(DRVTBL+1)
000CF2 4CF2 C9              10      RET
                                
       4CF3                     GET_DISK_BANK_FDRV:
000CF3 4CF3 3A43F1          13      LD  A,(FDRV)
000CF6 4CF6 D601             7      SUB 1
000CF8 4CF8 3003            12      JR  NC,GET_DISK_BANK
000CFA 4CFA 3A3AF1          13      LD  A,(_DVSW)
       4CFD                     GET_DISK_BANK:
000CFD 4CFD B7               4      OR  A       ;A=DRIVE
000CFE 4CFE 3E01             7      LD  A,DISK_BANK
000D00 4D00 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
000D02 4D02 3A39F1          13      LD  A,(B_DRIVE)
                                #endif
       4D05                     SET_DISK_BANK:
000D05 4D05 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
000D08 4D08 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
000D0B 4D0B F5              11      PUSH    AF
000D0C 4D0C E5              11      PUSH    HL
000D0D 4D0D 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
000D10 4D10 221AF1          16      LD  (SECSZ),HL
000D13 4D13 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D16 4D16 CD1F4D          17      CALL    MUL_AHL
000D19 4D19 2218F1          16      LD  (CLSZ),HL
000D1C 4D1C E1              10      POP HL
000D1D 4D1D F1              10      POP AF
000D1E 4D1E C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)
       4D1F                     MUL_AHL:
000D1F 4D1F 1F               4      RRA     ;->CF
000D20 4D20 D8              11      RET C
000D21 4D21 29              11      ADD HL,HL
000D22 4D22 18FB            12      JR  MUL_AHL
                                
       4D24                     DPB2DD:
000D24 4D24 F9                      DB  0F9H    ;MEDIA
000D25 4D25 0002                    DW  00200H  ;SECSIZ
000D27 4D27 0F                      DB  00FH    ;DIRMSK
000D28 4D28 04                      DB  004H    ;DIRSHFT
000D29 4D29 01                      DB  001H    ;CLUSMSK
000D2A 4D2A 02                      DB  002H    ;CLUSSHFT
000D2B 4D2B 0100                    DW  00001H  ;FIRFAT
000D2D 4D2D 02                      DB  002H    ;FATCNT
000D2E 4D2E 70                      DB  070H    ;MAXENT
000D2F 4D2F 0E00                    DW  0000EH  ;FIRREC
000D31 4D31 CA02                    DW  002CAH  ;MAXCLUS
000D33 4D33 03                      DB  003H    ;FATSIZ
000D34 4D34 0700                    DW  0007H   ;FIRDIR
       4D36                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       4D36                     POP_HL_ERROR:
000D36 4D36 E1              10      POP     HL
       4D37                     _ERROR:
000D37 4D37 0600             7      LD  B,0
000D39 4D39 A7               4      AND A
000D3A 4D3A C9              10      RET
                                
       4D3B                     ROM_BDOS:
000D3B 4D3B E5              11      PUSH    HL
000D3C 4D3C 79               4      LD  A,C
000D3D 4D3D 87               4      ADD A,A
000D3E 4D3E 38F7            12      JR  C,_ERROR
000D40 4D40 6F               4      LD  L,A
000D41 4D41 265F             7      LD  H,high STABLE
000D43 4D43 7E               7      LD  A,(HL)
000D44 4D44 2C               4      INC L
000D45 4D45 66               7      LD  H,(HL)
000D46 4D46 6F               4      LD  L,A
000D47 4D47 E3              19      EX  (SP),HL
000D48 4D48 79               4      LD  A,C
000D49 4D49 C9              10      RET
                                
       4D4A                     _PRINT:
       4D4A                     PRINT:
000D4A 4D4A 7B               4      LD  A,E
000D4B 4D4B 1803            12      JR  MSG_A
                                
       4D4D                     _SYS01:     ;(BDOS)コンソール入力
000D4D 4D4D CDC44D          17      CALL    _SYS07
       4D50                     MSG_A:
000D50 4D50 FE03             7      CP  3
000D52 4D52 2814            12      JR  Z,MSG_BR
       4D54                     MSGA1:
000D54 4D54 F5              11      PUSH    AF
000D55 4D55 C5              11      PUSH    BC
000D56 4D56 D5              11      PUSH    DE
000D57 4D57 E5              11      PUSH    HL
000D58 4D58 DDE5            15      PUSH    IX
000D5A 4D5A DD21A200        14      LD  IX,CHPUT
000D5E 4D5E CDD642          17      CALL    CALSLT_R
000D61 4D61 DDE1            14      POP IX
000D63 4D63 E1              10      POP HL
000D64 4D64 D1              10      POP DE
000D65 4D65 C1              10      POP BC
       4D66                     MSGA2:
000D66 4D66 F1              10      POP AF
000D67 4D67 C9              10      RET
       4D68                     MSG_BR:
000D68 4D68 F5              11      PUSH    AF
000D69 4D69 3ADDF3          13      LD  A,(CSRX)
000D6C 4D6C FE02             7      CP  2
000D6E 4D6E 38F6            12      JR  C,MSGA2
000D70 4D70 F1              10      POP AF
       4D71                     MSG_CR:
000D71 4D71 F5              11      PUSH    AF
000D72 4D72 3E0D             7      LD  A,00DH
000D74 4D74 CD544D          17      CALL    MSGA1
000D77 4D77 3E0A             7      LD  A,00AH
000D79 4D79 CD544D          17      CALL    MSGA1
000D7C 4D7C F1              10      POP AF
000D7D 4D7D C9              10      RET
                                
       4D7E                     _SYS02:     ;(BDOS)コンソール出力
000D7E 4D7E CD994D          17      CALL    BREAK
000D81 4D81 1805            12      JR  PRINTX
                                
       4D83                     _SYS06:     ;(BDOS)コンソール直接入出力
000D83 4D83 7B               4      LD  A,E
000D84 4D84 3C               4      INC A
000D85 4D85 CAD84D          10      JP  Z,_INKEY
       4D88                     PRINTX:
000D88 4D88 C34A4D          10      JP  _PRINT
                                
       4D8B                     _SYS08:     ;(BDOS)エコーなしコンソール入力
000D8B 4D8B CDC44D          17      CALL    _SYS07
000D8E 4D8E FE03             7      CP  3
000D90 4D90 CC994D          17      CALL    Z,_BREAK
000D93 4D93 FE13             7      CP  013H        ;CTRL+S
000D95 4D95 C0              11      RET NZ
       4D96                     PAUSE:
000D96 4D96 CDB04D          17      CALL    KEYBC
                                
       4D99                     _BREAK:
       4D99                     BREAK:
000D99 4D99 F5              11      PUSH    AF
000D9A 4D9A C5              11      PUSH    BC
000D9B 4D9B D5              11      PUSH    DE
000D9C 4D9C E5              11      PUSH    HL
000D9D 4D9D DDE5            15      PUSH    IX
000D9F 4D9F DD21B700        14      LD  IX,BREAKX
000DA3 4DA3 CDD642          17      CALL    CALSLT_R
000DA6 4DA6 DDE1            14      POP IX
000DA8 4DA8 E1              10      POP HL
000DA9 4DA9 D1              10      POP DE
000DAA 4DAA C1              10      POP BC
000DAB 4DAB DC994D          17      CALL    C,_BREAK
000DAE 4DAE F1              10      POP AF
000DAF 4DAF C9              10      RET
       4DB0                     KEYBC:
000DB0 4DB0 F5              11      PUSH    AF
000DB1 4DB1 C5              11      PUSH    BC
000DB2 4DB2 D5              11      PUSH    DE
000DB3 4DB3 E5              11      PUSH    HL
000DB4 4DB4 DDE5            15      PUSH    IX
000DB6 4DB6 DD215601        14      LD  IX,KILBUF
000DBA 4DBA CDD642          17      CALL    CALSLT_R
000DBD 4DBD DDE1            14      POP IX
000DBF 4DBF E1              10      POP HL
000DC0 4DC0 D1              10      POP DE
000DC1 4DC1 C1              10      POP BC
000DC2 4DC2 F1              10      POP AF
000DC3 4DC3 C9              10      RET
                                
       4DC4                     _SYS07:
       4DC4                     FLGET:
000DC4 4DC4 C5              11      PUSH    BC
000DC5 4DC5 D5              11      PUSH    DE
000DC6 4DC6 E5              11      PUSH    HL
000DC7 4DC7 DDE5            15      PUSH    IX
000DC9 4DC9 DD219F00        14      LD  IX,CHGET
000DCD 4DCD CDD642          17      CALL    CALSLT_R
000DD0 4DD0 DDE1            14      POP IX
000DD2 4DD2 E1              10      POP HL
000DD3 4DD3 D1              10      POP DE
000DD4 4DD4 C1              10      POP BC
000DD5 4DD5 FE03             7      CP  3
000DD7 4DD7 C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       4DD8                     _INKEY:
       4DD8                     INKEY:
000DD8 4DD8 CD724E          17      CALL    CPM_CONST
000DDB 4DDB C8              11      RET Z
000DDC 4DDC 18E6            12      JR  FLGET
                                
       4DDE                     _SYS0A:     ;(BDOS)文字列入力
000DDE 4DDE C5              11      PUSH    BC
000DDF 4DDF E5              11      PUSH    HL
000DE0 4DE0 D5              11      PUSH    DE
000DE1 4DE1 CD0A4E          17      CALL    GETL
000DE4 4DE4 111FF4          10      LD  DE,KBUF
000DE7 4DE7 E1              10      POP HL
000DE8 4DE8 E5              11      PUSH    HL
000DE9 4DE9 0E00             7      LD  C,0
000DEB 4DEB 3004            12      JR  NC,SAX0
000DED 4DED 23               6      INC HL
000DEE 4DEE 23               6      INC HL
000DEF 4DEF 1808            12      JR  SAX4
       4DF1                     SAX0:
000DF1 4DF1 46               7      LD  B,(HL)
000DF2 4DF2 23               6      INC HL
       4DF3                     SAX1:
000DF3 4DF3 23               6      INC HL
000DF4 4DF4 1A               7      LD  A,(DE)
000DF5 4DF5 13               6      INC DE
000DF6 4DF6 B7               4      OR  A
000DF7 4DF7 2004            12      JR  NZ,SAX2
       4DF9                     SAX4:
000DF9 4DF9 360D            10      LD  (HL),00DH
000DFB 4DFB 1804            12      JR  SAX3
       4DFD                     SAX2:
000DFD 4DFD 77               7      LD  (HL),A
000DFE 4DFE 0C               4      INC C
000DFF 4DFF 10F2            13      DJNZ    SAX1
       4E01                     SAX3:
000E01 4E01 D1              10      POP DE
000E02 4E02 79               4      LD  A,C
000E03 4E03 13               6      INC DE
000E04 4E04 12               7      LD  (DE),A
000E05 4E05 1B               6      DEC DE
000E06 4E06 E1              10      POP HL
000E07 4E07 C1              10      POP BC
000E08 4E08 A7               4      AND A
000E09 4E09 C9              10      RET
       4E0A                     GETL:
000E0A 4E0A DDE5            15      PUSH    IX
000E0C 4E0C FDE5            15      PUSH    IY
                                
000E0E 4E0E 2ADCF3          16      LD  HL,(CSRY)
000E11 4E11 22CAFB          16      LD  (FSTPOS),HL
       4E14                     GETL1:
000E14 4E14 CD8B4D          17      CALL    _SYS08
000E17 4E17 FE09             7      CP  9
000E19 4E19 2008            12      JR  NZ,GETL1V
000E1B 4E1B 211FF4          10      LD  HL,KBUF
000E1E 4E1E CD5143          17      CALL    MSX
000E21 4E21 18F1            12      JR  GETL1
       4E23                     GETL1V:
000E23 4E23 5F               4      LD  E,A
000E24 4E24 FE08             7      CP  8
000E26 4E26 CCC04E          17      CALL    Z,CTRL02
000E29 4E29 FE20             7      CP  020H
000E2B 4E2B D4EC4E          17      CALL    NC,INSERT
000E2E 4E2E CD544D          17      CALL    MSGA1
                                
000E31 4E31 7B               4      LD  A,E
000E32 4E32 FE0D             7      CP  00DH
000E34 4E34 20DE            12      JR  NZ,GETL1
                                
000E36 4E36 111FF4          10      LD  DE,KBUF
000E39 4E39 3AB0F3          13      LD  A,(LINLEN)
000E3C 4E3C 47               4      LD  B,A
000E3D 4E3D CD9F50          17      CALL    ZERO_MEMORY_DE
                                
000E40 4E40 2ACAFB          16      LD  HL,(FSTPOS)
000E43 4E43 3ADCF3          13      LD  A,(CSRY)
000E46 4E46 6F               4      LD  L,A
000E47 4E47 E5              11      PUSH    HL
000E48 4E48 CD1D4F          17      CALL    LOC0
000E4B 4E4B 4D               4      LD  C,L
000E4C 4E4C 44               4      LD  B,H
000E4D 4E4D E1              10      POP HL
000E4E 4E4E 3AB0F3          13      LD  A,(LINLEN)
000E51 4E51 94               4      SUB H
000E52 4E52 3D               4      DEC A
000E53 4E53 5F               4      LD  E,A
000E54 4E54 211FF4          10      LD  HL,KBUF
       4E57                     GETL2:
000E57 4E57 CDB04E          17      CALL    _SCRN
000E5A 4E5A 03               6      INC BC
000E5B 4E5B 77               7      LD  (HL),A
000E5C 4E5C 23               6      INC HL
000E5D 4E5D 1D               4      DEC E
000E5E 4E5E 20F7            12      JR  NZ,GETL2
000E60 4E60 CD714D          17      CALL    MSG_CR
                                
000E63 4E63 FDE1            14      POP IY
000E65 4E65 DDE1            14      POP IX
       4E67                     GETL3:
000E67 4E67 2B               6      DEC HL
000E68 4E68 7E               7      LD  A,(HL)
000E69 4E69 FE21             7      CP  021H
000E6B 4E6B D0              11      RET NC
000E6C 4E6C 3600            10      LD  (HL),0
000E6E 4E6E 15               4      DEC D
000E6F 4E6F 20F6            12      JR  NZ,GETL3
000E71 4E71 C9              10      RET
                                
       4E72                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       4E72                     CONSTX:
       4E72                     CPM_CONST:
000E72 4E72 C5              11      PUSH    BC
000E73 4E73 D5              11      PUSH    DE
000E74 4E74 E5              11      PUSH    HL
000E75 4E75 DDE5            15      PUSH    IX
000E77 4E77 DD219C00        14      LD  IX,CHSNS
000E7B 4E7B CDD642          17      CALL    CALSLT_R
000E7E 4E7E DDE1            14      POP IX
000E80 4E80 E1              10      POP HL
000E81 4E81 D1              10      POP DE
000E82 4E82 C1              10      POP BC
000E83 4E83 C9              10      RET
                                
       4E84                     _SYS2A:     ;(BDOS)日付の獲得
000E84 4E84 AF               4      XOR A
000E85 4E85 57               4      LD  D,A
000E86 4E86 5F               4      LD  E,A
000E87 4E87 67               4      LD  H,A
000E88 4E88 6F               4      LD  L,A
000E89 4E89 C9              10      RET
                                
       4E8A                     _SYS2C:     ;(BDOS)時刻の獲得
000E8A 4E8A AF               4      XOR A
000E8B 4E8B 57               4      LD  D,A
000E8C 4E8C 5F               4      LD  E,A
000E8D 4E8D 67               4      LD  H,A
000E8E 4E8E 6F               4      LD  L,A
000E8F 4E8F C9              10      RET
                                
       4E90                     POS:
000E90 4E90 F5              11      PUSH    AF
000E91 4E91 2ADCF3          16      LD  HL,(CSRY)
000E94 4E94 7D               4      LD  A,L
000E95 4E95 6C               4      LD  L,H
000E96 4E96 67               4      LD  H,A
000E97 4E97 2C               4      INC L
000E98 4E98 24               4      INC H
000E99 4E99 F1              10      POP AF
000E9A 4E9A C9              10      RET
                                
       4E9B                     LOC:
000E9B 4E9B F5              11      PUSH    AF
000E9C 4E9C E5              11      PUSH    HL
000E9D 4E9D 7D               4      LD  A,L
000E9E 4E9E 6C               4      LD  L,H
000E9F 4E9F 67               4      LD  H,A
000EA0 4EA0 2D               4      DEC L
000EA1 4EA1 25               4      DEC H
000EA2 4EA2 DDE5            15      PUSH    IX
000EA4 4EA4 DD21C600        14      LD  IX,POSIT
000EA8 4EA8 CDD642          17      CALL    CALSLT_R
000EAB 4EAB DDE1            14      POP IX
000EAD 4EAD E1              10      POP HL
000EAE 4EAE F1              10      POP AF
000EAF 4EAF C9              10      RET
                                
       4EB0                     _SCRN:
       4EB0                     SCRN:
000EB0 4EB0 E5              11      PUSH    HL
000EB1 4EB1 DDE5            15      PUSH    IX
                                
000EB3 4EB3 69               4      LD  L,C
000EB4 4EB4 60               4      LD  H,B
000EB5 4EB5 DD214A00        14      LD  IX,RDVRM
000EB9 4EB9 CDD642          17      CALL    CALSLT_R
                                
000EBC 4EBC DDE1            14      POP IX
000EBE 4EBE E1              10      POP HL
000EBF 4EBF C9              10      RET
                                
       4EC0                     CTRL02:
000EC0 4EC0 F5              11      PUSH    AF
000EC1 4EC1 D5              11      PUSH    DE
000EC2 4EC2 2ADCF3          16      LD  HL,(CSRY)
000EC5 4EC5 3AB0F3          13      LD  A,(LINLEN)
000EC8 4EC8 4F               4      LD  C,A
000EC9 4EC9 94               4      SUB H   ;CSRX
000ECA 4ECA C602             7      ADD A,2
000ECC 4ECC 47               4      LD  B,A ;カーソルより右の文字数
000ECD 4ECD 61               4      LD  H,C ;LINLEN
000ECE 4ECE C5              11      PUSH    BC
000ECF 4ECF CD1D4F          17      CALL    LOC0
000ED2 4ED2 C1              10      POP BC
                                
000ED3 4ED3 1620             7      LD  D,020H
       4ED5                     C8X1:
000ED5 4ED5 DD214A00        14      LD  IX,RDVRM
000ED9 4ED9 CDD642          17      CALL    CALSLT_R
000EDC 4EDC 4F               4      LD  C,A
000EDD 4EDD 7A               4      LD  A,D
000EDE 4EDE DD214D00        14      LD  IX,WRTVRM
000EE2 4EE2 CDD642          17      CALL    CALSLT_R
000EE5 4EE5 2B               6      DEC HL
000EE6 4EE6 51               4      LD  D,C
000EE7 4EE7 10EC            13      DJNZ    C8X1
000EE9 4EE9 D1              10      POP DE
000EEA 4EEA F1              10      POP AF
000EEB 4EEB C9              10      RET
                                
       4EEC                     INSERT:
000EEC 4EEC F5              11      PUSH    AF
000EED 4EED D5              11      PUSH    DE
000EEE 4EEE 2ADCF3          16      LD  HL,(CSRY)
000EF1 4EF1 3AB0F3          13      LD  A,(LINLEN)
000EF4 4EF4 4F               4      LD  C,A
000EF5 4EF5 94               4      SUB H   ;CSRX
000EF6 4EF6 3C               4      INC A
000EF7 4EF7 47               4      LD  B,A ;カーソルより右の文字数
000EF8 4EF8 C5              11      PUSH    BC
000EF9 4EF9 CD1D4F          17      CALL    LOC0
000EFC 4EFC C1              10      POP BC
                                
000EFD 4EFD 1620             7      LD  D,020H
       4EFF                     INS1:
000EFF 4EFF DD214A00        14      LD  IX,RDVRM
000F03 4F03 CDD642          17      CALL    CALSLT_R
000F06 4F06 4F               4      LD  C,A
000F07 4F07 7A               4      LD  A,D
000F08 4F08 DD214D00        14      LD  IX,WRTVRM
000F0C 4F0C CDD642          17      CALL    CALSLT_R
000F0F 4F0F 23               6      INC HL
000F10 4F10 51               4      LD  D,C
000F11 4F11 10EC            13      DJNZ    INS1
000F13 4F13 D1              10      POP DE
000F14 4F14 F1              10      POP AF
000F15 4F15 C9              10      RET
                                
       4F16                     CONOUT1:
000F16 4F16 59               4      LD  E,C
000F17 4F17 C34A4D          10      JP  _PRINT
                                
       4F1A                     GETVRAM:
000F1A 4F1A 2ADCF3          16      LD  HL,(CSRY)
       4F1D                     LOC0:
000F1D 4F1D 2D               4      DEC L
000F1E 4F1E 25               4      DEC H
000F1F 4F1F 4C               4      LD  C,H ;CSRX-1
000F20 4F20 5D               4      LD  E,L ;CSRY-1
       4F21                     LOC1:
000F21 4F21 3AB0F3          13      LD  A,(LINLEN)
000F24 4F24 67               4      LD  H,A
000F25 4F25 1600             7      LD  D,0
000F27 4F27 6A               4      LD  L,D ;0
000F28 4F28 0608             7      LD  B,8
       4F2A                     LOC2:
000F2A 4F2A 29              11      ADD HL,HL
000F2B 4F2B 3001            12      JR  NC,LOC3
000F2D 4F2D 19              11      ADD HL,DE
       4F2E                     LOC3:
000F2E 4F2E 10FA            13      DJNZ    LOC2
000F30 4F30 09              11      ADD HL,BC
000F31 4F31 C9              10      RET
                                
       4F32                     _SYS0C:     ;(BDOS)バージョン番号の獲得
000F32 4F32 212200          10      LD  HL,00022H
000F35 4F35 AF               4      XOR A
000F36 4F36 7D               4      LD  A,L
000F37 4F37 C9              10      RET
                                
       4F38                     _SYS0D:     ;(BDOS)ディスク・リセット
000F38 4F38 218000          10      LD  HL,00080H
000F3B 4F3B 2226F1          16      LD  (_DTA),HL
000F3E 4F3E C9              10      RET
                                
       4F3F                     _SYS0E:     ;(BDOS)カレントドライブの設定
000F3F 4F3F 323AF1          13      LD  (_DVSW),A
000F42 4F42 C9              10      RET
                                
       4F43                     _SYS0F:     ;(BDOS)ファイルのオープン
000F43 4F43 D5              11      PUSH    DE
000F44 4F44 FDE1            14      POP IY
000F46 4F46 CD8C50          17      CALL    INIT_FILE
000F49 4F49 CD0249          17      CALL    ROM_OPEN
000F4C 4F4C 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
000F4E 4F4E FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
000F52 4F52 FDE5            15      PUSH    IY
000F54 4F54 D1              10      POP DE
000F55 4F55 13               6      INC DE
000F56 4F56 010B00          10      LD  BC,11
000F59 4F59 EDB0                    LDIR
                                ;               Attribute
000F5B 4F5B 7E               7      LD  A,(HL)
000F5C 4F5C FD770D          19      LD  (IY+13),A
                                ;               TIME
000F5F 4F5F 110B00          10      LD  DE,11
000F62 4F62 19              11      ADD HL,DE
000F63 4F63 7E               7      LD  A,(HL)
000F64 4F64 23               6      INC HL
000F65 4F65 FD7716          19      LD  (IY+22),A
000F68 4F68 7E               7      LD  A,(HL)
000F69 4F69 23               6      INC HL
000F6A 4F6A FD7717          19      LD  (IY+23),A
                                ;               DATE
000F6D 4F6D 7E               7      LD  A,(HL)
000F6E 4F6E 23               6      INC HL
000F6F 4F6F FD7714          19      LD  (IY+20),A
000F72 4F72 7E               7      LD  A,(HL)
000F73 4F73 23               6      INC HL
000F74 4F74 FD7715          19      LD  (IY+21),A
                                ;               First cluster
000F77 4F77 7E               7      LD  A,(HL)
000F78 4F78 23               6      INC HL
000F79 4F79 FD771A          19      LD  (IY+26),A
000F7C 4F7C 7E               7      LD  A,(HL)
000F7D 4F7D 23               6      INC HL
000F7E 4F7E FD771B          19      LD  (IY+27),A
                                ;               SIZE
000F81 4F81 7E               7      LD  A,(HL)
000F82 4F82 23               6      INC HL
000F83 4F83 FD7710          19      LD  (IY+16),A
000F86 4F86 7E               7      LD  A,(HL)
000F87 4F87 23               6      INC HL
000F88 4F88 FD7711          19      LD  (IY+17),A
000F8B 4F8B 7E               7      LD  A,(HL)
000F8C 4F8C 23               6      INC HL
000F8D 4F8D FD7712          19      LD  (IY+18),A
000F90 4F90 7E               7      LD  A,(HL)
000F91 4F91 FD7713          19      LD  (IY+19),A
000F94 4F94 AF               4      XOR A
000F95 4F95 FD770C          19      LD  (IY+12),A
000F98 4F98 C9              10      RET
                                
       4F99                     _SYS10:     ;(BDOS)ファイルのクローズ
000F99 4F99 AF               4      XOR A
000F9A 4F9A C9              10      RET
                                
       4F9B                     S11X1:
000F9B 4F9B FD7119          19      LD  (IY+25),C       ;RootEntCnt
000F9E 4F9E FD750E          19      LD  (IY+14),L
000FA1 4FA1 FD740F          19      LD  (IY+15),H
       4FA4                     SCF_FF_RET:
000FA4 4FA4 37               4      SCF
000FA5 4FA5 9F               4      SBC A,A
000FA6 4FA6 C9              10      RET
                                
       4FA7                     _SYS11:     ;(BDOS)最初のファイルの検索
000FA7 4FA7 ED532EF1        20      LD  (_FCB),DE
000FAB 4FAB D5              11      PUSH    DE
000FAC 4FAC FDE1            14      POP IY
000FAE 4FAE CD8C50          17      CALL    INIT_FILE
000FB1 4FB1 CD1F4B          17      CALL    GET_DIR_DAT
       4FB4                     S12X1:
000FB4 4FB4 CD1E49          17      CALL    FILESE
000FB7 4FB7 30E2            12      JR  NC,S11X1
000FB9 4FB9 0D               4      DEC C
000FBA 4FBA FD7119          19      LD  (IY+25),C       ;RootEntCnt
000FBD 4FBD 012000          10      LD  BC,32
000FC0 4FC0 ED5B26F1        20      LD  DE,(_DTA)
000FC4 4FC4 AF               4      XOR A
000FC5 4FC5 12               7      LD  (DE),A      ;ドライブ番号
000FC6 4FC6 13               6      INC DE
000FC7 4FC7 EDB0                    LDIR            ;ディレクトリエントリ
000FC9 4FC9 FD750E          19      LD  (IY+14),L
000FCC 4FCC FD740F          19      LD  (IY+15),H
000FCF 4FCF C9              10      RET
                                
       4FD0                     _SYS12:
000FD0 4FD0 FD2A2EF1        20      LD  IY,(_FCB)
000FD4 4FD4 FDE5            15      PUSH    IY
000FD6 4FD6 D1              10      POP DE
000FD7 4FD7 CD8C50          17      CALL    INIT_FILE
                                
000FDA 4FDA FD6E0E          19      LD  L,(IY+14)
000FDD 4FDD FD660F          19      LD  H,(IY+15)
000FE0 4FE0 FD4E19          19      LD  C,(IY+25)
000FE3 4FE3 18CF            12      JR  S12X1
                                
       4FE5                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
000FE5 4FE5 CD054B          17      CALL    SET_FCB
000FE8 4FE8 CDD34A          17      CALL    GETSEQ
000FEB 4FEB CDC04A          17      CALL    RB_READ
000FEE 4FEE E5              11      PUSH    HL
000FEF 4FEF CDE04A          17      CALL    SETSEQ
000FF2 4FF2 E1              10      POP HL
       4FF3                     SREAD:
000FF3 4FF3 C601             7      ADD A,001H
000FF5 4FF5 D8              11      RET C
                                
000FF6 4FF6 7D               4      LD  A,L
000FF7 4FF7 D601             7      SUB 001H
000FF9 4FF9 9F               4      SBC A,A
000FFA 4FFA E603             7      AND 3
000FFC 4FFC 1F               4      RRA
000FFD 4FFD C9              10      RET
                                
       4FFE                     _SYS18:     ;(BDOS)ログインベクトルの獲得
000FFE 4FFE 210100          10      LD  HL,00001H
001001 5001 AF               4      XOR A
001002 5002 C9              10      RET
                                
       5003                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001003 5003 3A3AF1          13      LD  A,(_DVSW)
001006 5006 C9              10      RET
                                
       5007                     _SYS1A:     ;(BDOS)DTAの設定
001007 5007 ED5326F1        20      LD  (_DTA),DE
00100B 500B AF               4      XOR A
00100C 500C C9              10      RET
                                
       500D                     _SYS1B:     ;(BDOS)ディスク情報の獲得
00100D 500D 010002          10      LD  BC,512
001010 5010 11C302          10      LD  DE,707
001013 5013 210000          10      LD  HL,0
001016 5016 DD2130F1        14      LD  IX,_BUF
00101A 501A FD2130F1        14      LD  IY,_BUF
00101E 501E FD3600F9        19      LD  (IY+0),0F9H
001022 5022 3E02             7      LD  A,2
001024 5024 C9              10      RET
                                
       5025                     _SYS21:     ;(BDOS)ランダムな読み出し
001025 5025 CD054B          17      CALL    SET_FCB
                                
001028 5028 FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
00102B 502B FD6622          19      LD  H,(IY+34)
                                
00102E 502E CDC04A          17      CALL    RB_READ
001031 5031 18C0            12      JR  SREAD
                                
       5033                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
001033 5033 CD434F          17      CALL    _SYS0F
001036 5036 D8              11      RET C
                                
001037 5037 D5              11      PUSH    DE      ;EX DE,IY
001038 5038 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
00103A 503A CDF54A          17      CALL    GETSIZE
       503D                     _S24X1:
00103D 503D FD7521          19      LD  (IY+33),L   ;(FCB)Random record
001040 5040 FD7422          19      LD  (IY+34),H
001043 5043 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
001047 5047 FDE3            23      EX  (SP),IY     ;
001049 5049 D1              10      POP DE      ;
                                
00104A 504A AF               4      XOR A
00104B 504B C9              10      RET
                                
       504C                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
00104C 504C E5              11      PUSH    HL
00104D 504D D5              11      PUSH    DE      ;EX DE,IY
00104E 504E FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
001050 5050 CDD34A          17      CALL    GETSEQ
001053 5053 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       5055                     _SYS27:     ;(BDOS)ランダムブロック読み込み
001055 5055 CD054B          17      CALL    SET_FCB
001058 5058 E5              11      PUSH    HL
001059 5059 FD6E21          19      LD  L,(IY+33)
00105C 505C FD6622          19      LD  H,(IY+34)
00105F 505F 221CF1          16      LD  (RR_LOW),HL
001062 5062 FD6E23          19      LD  L,(IY+35)
001065 5065 FD6624          19      LD  H,(IY+36)
001068 5068 221EF1          16      LD  (RR_HIGH),HL
00106B 506B E1              10      POP HL
00106C 506C CD2247          17      CALL    ROM_READ
00106F 506F ED5B1CF1        20      LD  DE,(RR_LOW)
001073 5073 FD7321          19      LD  (IY+33),E
001076 5076 FD7222          19      LD  (IY+34),D
001079 5079 ED5B1EF1        20      LD  DE,(RR_HIGH)
00107D 507D FD7323          19      LD  (IY+35),E
001080 5080 FD7224          19      LD  (IY+36),D
001083 5083 9F               4      SBC A,A
001084 5084 C9              10      RET
                                
       5085                     _SYS2F:
001085 5085 44               4      LD  B,H
001086 5086 2A26F1          16      LD  HL,(_DTA)
001089 5089 C35E4B          10      JP  DISKIO
                                
       508C                     INIT_FILE:
00108C 508C EB               4      EX  DE,HL
00108D 508D 1143F1          10      LD  DE,FDRV
001090 5090 010C00          10      LD  BC,1+8+3
001093 5093 EDB0                    LDIR
001095 5095 CDF34C          17      CALL    GET_DISK_BANK_FDRV
001098 5098 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
00109B 509B 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
00109E 509E C9              10      RET
                                
       509F                     ZERO_MEMORY_DE:
00109F 509F AF               4      XOR A
       50A0                     FILL_MEMORY_DE:
0010A0 50A0 12               7      LD  (DE),A
0010A1 50A1 13               6      INC DE
0010A2 50A2 10FC            13      DJNZ    FILL_MEMORY_DE
0010A4 50A4 C9              10      RET
                                
0010A5 50A5                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 374D4D4D7E4D374D        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 374D374D834DC44D        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 8B4D374DDE4D724E        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 324F384F3F4F434F        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 994FA74FD04F374D        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 E54F374D374D374D        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 FE4F035007500D50        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 374D374D374D3350        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 4C50374D374D5550        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 374D374D844E374D        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 8A4E374D374D8550        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB8 5FB8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 374D374D374D374D        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
