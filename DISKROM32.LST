                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;   Tablacus DISK ROM Lite for MSX
                                ;   Programmed by
                                ;   Gaku (Lovers/Tablacus)
                                ;
                                    INCLUDE "DEF.ASM"
                                
                                ;   LSX-Dodgers DEF
                                ;   MSX
                                
       4000                     RUN EQU 04000H
                                
       0006                     RDVDP   EQU 0006H
       0007                     WRVDP   EQU 0007H
                                
       000C                     _RDSLT  EQU 0000CH
       0014                     _WRSLT  EQU 00014H
       001C                     _CALSLT EQU 0001CH
       0024                     _ENASLT EQU 00024H
       0030                     _CALLF  EQU 00030H
       004A                     RDVRM   EQU 0004AH
       004D                     WRTVRM  EQU 0004DH
       005C                     LDIRVM  EQU 0005CH
       009C                     CHSNS   EQU 0009CH
       009F                     CHGET   EQU 0009FH
       00A2                     CHPUT   EQU 000A2H
       00B7                     BREAKX  EQU 000B7H
       00C6                     POSIT   EQU 000C6H
       0138                     RSLREG  EQU 00138H
       0156                     KILBUF  EQU 00156H
                                
       406F                     ERRHAND EQU 0406FH
       42B2                     CRUNCH  EQU 042B2H
       4C64                     FRMEVL  EQU 04C64H
       542F                     FRMQNT  EQU 0542FH
       67D0                     FRESTR  EQU 067D0H
                                
       F331                     H_BDOS  EQU 0F331H
       F341                     RAMAD0  EQU 0F341H
       F342                     RAMAD1  EQU 0F342H
       F343                     RAMAD2  EQU 0F343H
       F344                     RAMAD3  EQU 0F344H
       F348                     MASTERS EQU 0F348H
       F368                     ROMUSE  EQU 0F368H
       F36B                     RAMUSE  EQU 0F36BH
       F37D                     BDOS    EQU 0F37DH
       F38C                     CLPRIM  EQU 0F38CH
       F3B0                     LINLEN  EQU 0F3B0H
       F3B9                     TXTATR  EQU 0F3B9H
       F3BB                     TXTPAT  EQU 0F3BBH
       F3D3                     MLTCOL  EQU 0F3D3H
       F3DC                     CSRY    EQU 0F3DCH
       F3DD                     CSRX    EQU 0F3DDH
       F3F8                     PUTPNT  EQU 0F3F8H
       F3FA                     GETPNT  EQU 0F3FAH
       F3FC                     CS120   EQU 0F3FCH
                                
                                
       F41F                     KBUF    EQU 0F41FH
                                
       F55E                     BUF EQU 0F55EH
                                
       F663                     VALTYP  EQU 0F663H
       F672                     MEMSIZ  EQU 0F672H
       F674                     STKTOP  EQU 0F674H
       F676                     TXTTAB  EQU 0F676H
       F6B1                     SAVSTK  EQU 0F6B1H
       F6C2                     VARTAB  EQU 0F6C2H
       F6C4                     ARYTAB  EQU 0F6C4H
       F6C6                     STREND  EQU 0F6C6H
                                
       F7F6                     DAC EQU 0F7F6H
                                
                                ;FBUFFR EQU 0F7C5H
                                
                                ;PTRFIL EQU 0F864H
       F866                     RUNFLG  EQU 0F866H
                                ;FILNAM EQU 0F866H
                                ;FILNM2 EQU 0F871H
                                
                                ;RSTMP  EQU 0FB03H
       FB21                     DRVTBL  EQU 0FB21H
       FBCA                     FSTPOS  EQU 0FBCAH
       FBF0                     KEYBUF  EQU 0FBF0H
                                
       FC4A                     HIMEM   EQU 0FC4AH
       FCC1                     EXPTBL  EQU 0FCC1H
       FCAF                     SCRMOD  EQU 0FCAFH
       FCBE                     RUNBNF  EQU 0FCBEH
       FCBF                     SAVENT  EQU 0FCBFH
                                
       FD89                     PROCNM  EQU 0FD89H
                                
       FD99                     DEVICE  EQU 0FD99H
       FE71                     H_BINS  EQU 0FE71H
       FE76                     H_BINL  EQU 0FE76H
       FE7B                     H_FILE  EQU 0FE7BH
       FFA7                     H_PHYD  EQU 0FFA7H
       FEDA                     H_STKE  EQU 0FEDAH
                                
       FF43                     H_GONE  EQU 0FF43H
                                            ;ASCII-8K
       6000                     BANK0_SEL EQU   06000H  ;6000-67FF
       6800                     BANK1_SEL EQU   06800H  ;6800-6FFF
       7000                     BANK2_SEL EQU   07000H  ;7000-77FF
       7800                     BANK3_SEL EQU   07800H  ;7800-7FFF
                                            ;ASCII-16K
       6000                     ASCII16_BANK0_SEL EQU 06000H    ;6000-67FF
       7000                     ASCII16_BANK1_SEL EQU 07000H    ;7000-77FF
                                            ;KONAMI-8K
       6000                     KONAMI_BANK1_SEL EQU    06000H  ;6000-7FFF
       8000                     KONAMI_BANK2_SEL EQU    08000H  ;8000-9FFF
       A000                     KONAMI_BANK3_SEL EQU    0A000H  ;A000-BFFF
                                                ;KONAMI-SCC
       5000                     KONAMI_SCC_BANK0_SEL EQU    05000H  ;5000-57FF
       7000                     KONAMI_SCC_BANK1_SEL EQU    07000H  ;7000-77FF
       9000                     KONAMI_SCC_BANK2_SEL EQU    09000H  ;9000-97FF
       B000                     KONAMI_SCC_BANK3_SEL EQU    0B000H  ;B000-B7FF
                                
       F0E9                     ISC EQU 0F0E9H
                                
       0001                     DISK_BANK   EQU 1       ;ドライブAが始まるバンク#
       6000                     BANK1_ADR   EQU 06000H      ;バンク1の開始アドレス
                                
       F7F8                     DACDAT  EQU DAC+2
[EOF:DEF.ASM:UTF_8]
                                
       0001                     USE_NORMAL_32K_ROM      EQU 1   ;ノーマル32KB ROMを作成する
                                
000000 4000                         ORG RUN
                                
                                ; MSX ROM header
000000 4000 4142                    DB  "AB"   ; ID for auto-executable ROM
000002 4002 0041                    DW  INIT_ROM   ; Main program execution address.
000004 4004 544E                    DW  STATEMENT  ; STATEMENT
000006 4006 0000                    DW  0      ; DEVICE
000008 4008 0000                    DW  0      ; TEXT
00000A 400A 000000000000            DW  0,0,0  ; Reserved
                                
000010 4010 C3C84E          10      JP  DISKIO
000013 4013 C30E4F          10      JP  DSKCHG
000016 4016 C3644F          10      JP  GETDPB
000019 4019 C35750          10      JP  CHOICE
00001C 401C C35B50          10      JP  DSKFMT
00001F 401F C35D50          10      JP  DSKSTP
000022 4022 C35E50          10      JP  BASENT
000025 4025 37               4      SCF
000026 4026 C35B50          10      JP  DSKFMT
000029 4029 C35D50          10      JP  DSKSTP
00002C 402C 00               4      NOP
00002D 402D C36550          10      JP  GETSLT
000030 4030 2A4BF3          16      LD  HL,(0F34BH)
000033 4033 C9              10      RET
                                
00007F 407F                         ORG 0407FH
00007F 407F C9              10      RET
                                ; Version
000080 4080 5461626C61637573        DB  "Tablacus DISK ROM Lite v0.2.0.0",0
            204449534B20524F    
            4D204C6974652076    
            302E322E302E3000    
                                
0000FF 40FF                         ORG 040FFH
0000FF 40FF C9              10      RET
                                
                                    INCLUDE "INIT.ASM"
                                
                                ;   Tablacus DISK ROM - INIT
                                ;
                                
       4100                     INIT_ROM:
000100 4100 3A21FB          13      LD  A,(DRVTBL)
000103 4103 FE01             7      CP  1
000105 4105 C8              11      RET Z
                                
000106 4106 0180FF          10      LD  BC,-00080H
000109 4109 2A72F6          16      LD  HL,(MEMSIZ)
00010C 410C 09              11      ADD HL,BC
00010D 410D 2272F6          16      LD  (MEMSIZ),HL
000110 4110 2A74F6          16      LD  HL,(STKTOP)
000113 4113 09              11      ADD HL,BC
000114 4114 2274F6          16      LD  (STKTOP),HL
000117 4117 2180F0          10      LD  HL,0F080H
00011A 411A 1100F0          10      LD  DE,0F000H
00011D 411D 012000          10      LD  BC,00020H
000120 4120 EDB0                    LDIR
000122 4122 2180FF          10      LD  HL,-00080H
000125 4125 39              11      ADD HL,SP
000126 4126 2260F1          16      LD  (BASSTK),HL
000129 4129 ED7B60F1        20      LD  SP,(BASSTK)
                                
00012D 412D 3EFF             7      LD  A,0FFH
00012F 412F 3299FD          13      LD  (DEVICE),A
                                
000132 4132 3E01             7      LD  A,1
000134 4134 3221FB          13      LD  (DRVTBL),A
                                
000137 4137 AF               4      XOR A
000138 4138 3246F1          13      LD  (_DVSW),A
                                
00013B 413B 210643          10      LD  HL,AT_ISC
00013E 413E 11E9F0          10      LD  DE,ISC
000141 4141 017D00          10      LD  BC,ISC_E-ISC
000144 4144 EDB0                    LDIR
                                    
000146 4146 3EC3             7      LD  A,0C3H      ;JP
000148 4148 3243FF          13      LD  (H_GONE),A
00014B 414B 327DF3          13      LD  (BDOS),A
00014E 414E 326BF3          13      LD  (RAMUSE),A
000151 4151 3268F3          13      LD  (ROMUSE),A
000154 4154 21E9F0          10      LD  HL,REPLACE_COMMAND
000157 4157 2244FF          16      LD  (H_GONE+1),HL
00015A 415A 2131F3          10      LD  HL,H_BDOS
00015D 415D 227EF3          16      LD  (BDOS+1),HL
000160 4160 2119F1          10      LD  HL,RAMUSE1
000163 4163 226CF3          16      LD  (RAMUSE+1),HL
000166 4166 2114F1          10      LD  HL,ROMUSE1
000169 4169 2269F3          16      LD  (ROMUSE+1),HL
                                
00016C 416C 3E                      DB  03EH
00016D 416D F7              12      RST 30H
00016E 416E 3271FE          13      LD  (H_BINS),A
000171 4171 3276FE          13      LD  (H_BINL),A
000174 4174 327BFE          13      LD  (H_FILE),A
000177 4177 3231F3          13      LD  (H_BDOS),A
00017A 417A 32DAFE          13      LD  (H_STKE),A
00017D 417D 32A7FF          13      LD  (H_PHYD),A
                                
000180 4180 CD4642          17      CALL    GTSL1_
000183 4183 3200F1          13      LD  (ROM_SLT),A
000186 4186 3210F1          13      LD  (ROM_SLT_COPY),A
000189 4189 3272FE          13      LD  (H_BINS+1),A
00018C 418C 3277FE          13      LD  (H_BINL+1),A
00018F 418F 327CFE          13      LD  (H_FILE+1),A
000192 4192 3232F3          13      LD  (H_BDOS+1),A
000195 4195 32DBFE          13      LD  (H_STKE+1),A
000198 4198 32A8FF          13      LD  (H_PHYD+1),A
00019B 419B 3222FB          13      LD  (DRVTBL+1),A
00019E 419E 3248F3          13      LD  (MASTERS),A
                                
0001A1 41A1 21C045          10      LD  HL,ROM_LOAD
0001A4 41A4 2273FE          16      LD  (H_BINS+2),HL
0001A7 41A7 21EF46          10      LD  HL,ROM_RUN
0001AA 41AA 2278FE          16      LD  (H_BINL+2),HL
0001AD 41AD 21FC46          10      LD  HL,ROM_FILES
0001B0 41B0 227DFE          16      LD  (H_FILE+2),HL
0001B3 41B3 21AF50          10      LD  HL,ROM_BDOS
0001B6 41B6 2233F3          16      LD  (H_BDOS+2),HL
0001B9 41B9 21AD43          10      LD  HL,ROM_STKE
0001BC 41BC 22DCFE          16      LD  (H_STKE+2),HL
0001BF 41BF 21C84E          10      LD  HL,DISKIO
0001C2 41C2 22A9FF          16      LD  (H_PHYD+2),HL
                                
0001C5 41C5 3E                      DB  03EH
0001C6 41C6 C9              10      RET
0001C7 41C7 327FFE          13      LD  (H_FILE+4),A
0001CA 41CA 3275FE          13      LD  (H_BINS+4),A
0001CD 41CD 327AFE          13      LD  (H_BINL+4),A
0001D0 41D0 3235F3          13      LD  (H_BDOS+4),A
0001D3 41D3 32DEFE          13      LD  (H_STKE+4),A
0001D6 41D6 32ABFF          13      LD  (H_PHYD+4),A
                                
0001D9 41D9 AF               4      XOR A
0001DA 41DA 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
0001DD 41DD 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
0001E0 41E0 3A0060          13      LD  A,(BANK1_ADR)
0001E3 41E3 FE41             7      CP  'A'
                                #if exists USE_NORMAL_32K_ROM
0001E5 41E5 284E            12      JR  Z,NOT_BANK_TYPE
0001E7 41E7 3E01             7      LD  A,DISK_BANK
0001E9 41E9 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    JR  NZ,NOT_BANK_TYPE
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
0001EC 41EC CD3801          17      CALL    RSLREG      ;read primary slot #
0001EF 41EF 07               4      RLCA
0001F0 41F0 07               4      RLCA
0001F1 41F1 F5              11      PUSH    AF
0001F2 41F2 1605             7      LD  D,4+1
0001F4 41F4 CD4D42          17      CALL    GTSL2_
0001F7 41F7 3244F3          13      LD  (RAMAD3),A
0001FA 41FA F1              10      POP AF
0001FB 41FB 07               4      RLCA
0001FC 41FC 07               4      RLCA
0001FD 41FD 1603             7      LD  D,2+1
0001FF 41FF CD4D42          17      CALL    GTSL2_
000202 4202 2680             7      LD  H,080H
000204 4204 CD6A42          17      CALL    CHK_RAM
000207 4207 3243F3          13      LD  (RAMAD2),A
       420A                     RAMCHK2:
00020A 420A 3A44F3          13      LD  A,(RAMAD3)
00020D 420D 2640             7      LD  H,040H
00020F 420F CD6A42          17      CALL    CHK_RAM
000212 4212 3242F3          13      LD  (RAMAD1),A
       4215                     RAMCHK1:
000215 4215 3A44F3          13      LD  A,(RAMAD3)
000218 4218 2600             7      LD  H,00H
00021A 421A CD6A42          17      CALL    CHK_RAM
00021D 421D 3241F3          13      LD  (RAMAD0),A
       4220                     RAMCHK0:
000220 4220 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
000223 4223 010F00          10      LD  BC,0000FH       ;切り上げ
000226 4226 09              11      ADD HL,BC
000227 4227 7D               4      LD  A,L
                                
000228 4228 0604             7      LD  B,4
       422A                     B_DRIVE1:
00022A 422A CB3C             8      SRL H
00022C 422C 1F               4      RRA
00022D 422D 10FB            13      DJNZ    B_DRIVE1
                                
00022F 422F C601             7      ADD A,DISK_BANK     ;A=(TotSec16/16)+DISK_BANK
000231 4231 3245F1          13      LD  (B_DRIVE),A
                                
                                #if exists FIX_DRIVE
                                    LD  A,(B_DRIVE)
                                    CP  FIX_DRIVE
                                    JR  Z,OK_FIX_DRIVE
                                    LD  HL,MSG_ERROR_DRIVE
                                    CALL    MSX
                                    LD  A,(B_DRIVE)
                                    CALL    PRTHX
                                    LD  IY,(EXPTBL-1) ;メインROMスロット
                                    LD  IX,CHGET
                                    CALL    _CALSLT
                                    LD  HL,MSG_CRLF
                                    CALL    MSX
                                OK_FIX_DRIVE:
                                #endif
000234 4234 C9              10      RET
                                
       4235                     NOT_BANK_TYPE:
                                                ;ROMのタイプが違う
000235 4235 21FB43          10      LD  HL,MSG_ERROR_ROM_MODE
000238 4238 CD8643          17      CALL    MSX
00023B 423B FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00023F 423F DD219F00        14      LD  IX,CHGET
000243 4243 C31C00          10      JP  _CALSLT
                                
       4246                     GTSL1_:             ;自分のいるスロットを知る
000246 4246 CD3801          17      CALL    RSLREG      ;read primary slot #
000249 4249 0F               4      RRCA
00024A 424A 0F               4      RRCA
00024B 424B 1601             7      LD  D,1
       424D                     GTSL2_:
00024D 424D E603             7      AND 3       ;[A]=000000PP
00024F 424F 5F               4      LD  E,A     ;[E]=000000PP
000250 4250 21C1FC          10      LD  HL,EXPTBL
000253 4253 85               4      ADD A,L     ;桁上りは無い
000254 4254 6F               4      LD  L,A     ;[HL]=EXPTBL+000000PP
000255 4255 7B               4      LD  A,E     ;[A]=000000PP
000256 4256 CB7E            13      BIT 7,(HL)
000258 4258 C8              11      RET Z
000259 4259 7D               4      LD  A,L     ;point to SLTTBL entry
00025A 425A C604             7      ADD A,4     ;桁上りは無い
00025C 425C 6F               4      LD  L,A
00025D 425D 7E               7      LD  A,(HL)      ;get currently expansion slot register
       425E                     GTSL3_:
00025E 425E 15               4      DEC D
00025F 425F 2803            12      JR  Z,GTSL4_:
000261 4261 0F               4      RRCA
000262 4262 18FA            12      JR  GTSL3_:
       4264                     GTSL4_:
000264 4264 E60C             7      AND 00CH        ;[A] = 0000SS00
000266 4266 B3               4      OR  E       ;[A] = 0000SSPP
000267 4267 F680             7      OR  080H        ;[A] = 1000SSPP
000269 4269 C9              10      RET
                                
       426A                     CHK_RAM:
00026A 426A E5              11      PUSH    HL
00026B 426B CDBF42          17      CALL    CHK_RAM0
00026E 426E E1              10      POP HL
00026F 426F C8              11      RET Z
000270 4270 3AC1FC          13      LD  A,(EXPTBL)      ;スロット#0
000273 4273 E680             7      AND 080H
000275 4275 CD9642          17      CALL    CHK_RAM_SLT
000278 4278 C8              11      RET Z
000279 4279 3AC2FC          13      LD  A,(EXPTBL+1)        ;スロット#1
00027C 427C E680             7      AND 080H
00027E 427E C601             7      ADD A,1
000280 4280 CD9642          17      CALL    CHK_RAM_SLT
000283 4283 C8              11      RET Z
000284 4284 3AC3FC          13      LD  A,(EXPTBL+2)        ;スロット#2
000287 4287 E680             7      AND 080H
000289 4289 C602             7      ADD A,2
00028B 428B CD9642          17      CALL    CHK_RAM_SLT
00028E 428E C8              11      RET Z
00028F 428F 3AC4FC          13      LD  A,(EXPTBL+3)        ;スロット#3
000292 4292 E680             7      AND 080H
000294 4294 C603             7      ADD A,3
       4296                     CHK_RAM_SLT:
000296 4296 E5              11      PUSH    HL
000297 4297 CDBF42          17      CALL    CHK_RAM0        ;スロット#X or X-0
00029A 429A E1              10      POP HL
00029B 429B C8              11      RET Z
00029C 429C CB79             8      BIT 7,C
00029E 429E 281A            12      JR  Z,CHK_RAM_E     ;スロットは拡張されていない
0002A0 42A0 79               4      LD  A,C
0002A1 42A1 C604             7      ADD A,4*1           ;スロット#X-1
0002A3 42A3 E5              11      PUSH    HL
0002A4 42A4 CDBF42          17      CALL    CHK_RAM0
0002A7 42A7 E1              10      POP HL
0002A8 42A8 C8              11      RET Z
0002A9 42A9 79               4      LD  A,C
0002AA 42AA C608             7      ADD A,4*2           ;スロット#X-2
0002AC 42AC E5              11      PUSH    HL
0002AD 42AD CDBF42          17      CALL    CHK_RAM0
0002B0 42B0 E1              10      POP HL
0002B1 42B1 C8              11      RET Z
0002B2 42B2 79               4      LD  A,C
0002B3 42B3 C60C             7      ADD A,4*3           ;スロット#X-3
0002B5 42B5 E5              11      PUSH    HL
0002B6 42B6 CDBF42          17      CALL    CHK_RAM0
0002B9 42B9 E1              10      POP HL
       42BA                     CHK_RAM_E:
0002BA 42BA AF               4      XOR A
0002BB 42BB 3C               4      INC A           ;ZF=0にする
0002BC 42BC 3E00             7      LD  A,0
0002BE 42BE C9              10      RET
                                
       42BF                     CHK_RAM0:
0002BF 42BF 4F               4      LD  C,A
0002C0 42C0 3A00F1          13      LD  A,(ROM_SLT)
0002C3 42C3 B9               4      CP  C
0002C4 42C4 28F4            12      JR  Z,CHK_RAM_E
0002C6 42C6 2E00             7      LD  L,0
       42C8                     CHK_RAM1:
0002C8 42C8 79               4      LD  A,C
0002C9 42C9 DD210C00        14      LD  IX,_RDSLT
0002CD 42CD CDFA42          17      CALL    CALSLT_R
0002D0 42D0 C6E5             7      ADD A,0E5H
0002D2 42D2 47               4      LD  B,A
0002D3 42D3 5F               4      LD  E,A
0002D4 42D4 79               4      LD  A,C
0002D5 42D5 DD211400        14      LD  IX,_WRSLT
0002D9 42D9 CDFA42          17      CALL    CALSLT_R
0002DC 42DC 79               4      LD  A,C
0002DD 42DD DD210C00        14      LD  IX,_RDSLT
0002E1 42E1 CDFA42          17      CALL    CALSLT_R
0002E4 42E4 B8               4      CP  B
0002E5 42E5 C0              11      RET NZ
0002E6 42E6 D6E5             7      SUB 0E5H
0002E8 42E8 79               4      LD  A,C
0002E9 42E9 5F               4      LD  E,A
0002EA 42EA DD211400        14      LD  IX,_WRSLT
0002EE 42EE CDFA42          17      CALL    CALSLT_R
0002F1 42F1 24               4      INC H
0002F2 42F2 7D               4      LD  A,L
0002F3 42F3 C604             7      ADD A,4
0002F5 42F5 6F               4      LD  L,A
0002F6 42F6 20D0            12      JR  NZ,CHK_RAM1
0002F8 42F8 79               4      LD  A,C     ;ZF=1のハズ
0002F9 42F9 C9              10      RET
                                
       42FA                     CALSLT_R:
0002FA 42FA C5              11      PUSH    BC
0002FB 42FB E5              11      PUSH    HL
0002FC 42FC FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
000300 4300 CD1C00          17      CALL    _CALSLT
000303 4303 E1              10      POP HL
000304 4304 C1              10      POP BC
000305 4305 C9              10      RET
                                
       4306                     AT_ISC:
000306 F0E9                         ORG ISC,AT_ISC-RUN
       F0E9                     REPLACE_COMMAND:
000306 F0E9 FEB7             7      CP  0B7H            ;FILES
000308 F0EB CC7BFE          17      CALL    Z,H_FILE
00030B F0EE FEB5             7      CP  0B5H            ;LOAD
00030D F0F0 CA71FE          10      JP  Z,H_BINS
000310 F0F3 FE8A             7      CP  08AH            ;RUN
000312 F0F5 CA76FE          10      JP  Z,H_BINL
000315 F0F8 FED6             7      CP  0D6H            ;COPY
000317 F0FA 2813            12      JR  Z,FIX_COPY
000319 F0FC FECF             7      CP  0CFH            ;BLOAD
00031B F0FE C0              11      RET NZ
       F0FF                     FIX_BLOAD:
00031C F0FF F7              12      RST 30H
       F100                     ROM_SLT:
00031D F100 00                      DB  0
00031E F101 2546                    DW  ROM_BLOAD
000320 F103 F5              11      PUSH    AF
000321 F104 E5              11      PUSH    HL
000322 F105 CD0EF1          17      CALL    BLOAD_RET
       F106                     SWC_BLOAD   EQU $-2
000325 F108 E1              10      POP HL
000326 F109 F1              10      POP AF
000327 F10A FECF             7      CP  0CFH            ;BLOAD
       F10C                     SWC_BLOAD_M:
000329 F10C 28DB            12      JR  Z,REPLACE_COMMAND
       F10E                     BLOAD_RET:
00032B F10E C9              10      RET
       F10F                     FIX_COPY:
00032C F10F F7              12      RST 30H
       F110                     ROM_SLT_COPY:
00032D F110 00                      DB  0
00032E F111 8247                    DW  ROM_COPY
000330 F113 C9              10      RET
       F114                     ROMUSE1:
000331 F114 3A00F1          13      LD  A,(ROM_SLT)
000334 F117 1803            12      JR  ROMUSE2
       F119                     RAMUSE1:
000336 F119 3A42F3          13      LD  A,(RAMAD1)
       F11C                     ROMUSE2:
000339 F11C C32400          10      JP  _ENASLT
                                
       F11F                     _RESULT:
00033C F11F 00                      DB  0
       F120                     _BANK:
00033D F120 00                      DB  0
       F121                     _BANK1:
00033E F121 00                      DB  0
       F122                     CLSZ:               ;クラスタサイズ
00033F F122 0004                    DW  1024
       F123                     CLSZ_H  EQU $-1     ;クラスタサイズ上位8ビット
       F124                     SECSZ:              ;セクタサイズ
000341 F124 0002                    DW  512
       F125                     SECSZ_H EQU $-1     ;セクタサイズ上位8ビット
       F126                     RR_LOW:
000343 F126 0000                    DW  0
       F127                     RR_MID  EQU $-1
       F128                     RR_HIGH:
000345 F128 0000                    DW  0
       F12A                     _CLPS:
000347 F12A 0000                    DW  0
       F12C                     _LEFT:
000349 F12C 0000                    DW  0
       F12E                     _DTPS:
00034B F12E 0000                    DW  0
       F130                     _DTA:
00034D F130 0000                    DW  0
       F132                     FLG_LDIR:
00034F F132 00                      DB  0
       F133                     _FCB:
000350 F133 0000                    DW  0
       F135                     _BUF:
       F135                     _BUF_LO:        ;LOGICAL OPERATION
000352 F135 00                      DB  0
       F136                     _BUF_ST:
000353 F136 0000                    DW  0
       F138                     _BUF_EN:
000355 F138 0000                    DW  0
       F13A                     _BUF_EX:
       F13A                     _BUF_W:
000357 F13A 0000                    DW  0
       F13C                     _BUF_H:
000359 F13C 0000                    DW  0
       F13E                     _BUF_X:
00035B F13E 0000                    DW  0
       F140                     _BUF_Y:
00035D F140 00                      DB  0
       F141                     _BUF_P:
00035E F141 00                      DB  0
       F142                     _BUF_O:
00035F F142 00                      DB  0
       F143                     DTAX:
000360 F143 0000                    DW  0
       F145                     B_DRIVE:
000362 F145 00                      DB  0
       F146                     _DVSW:
000363 F146 00                      DB  0
       F147                     DIRENT1:
000364 F147 0000                    DW  0
       F149                     _DIR_BANK:
000366 F149 00                      DB  0
       F14A                     LEFTX:
000367 F14A 0000                    DW  0
       F14C                     PARAM0:
000369 F14C 0000                    DW  0
       F14E                     PARAM1:
00036B F14E 0000                    DW  0
       F150                     FDRV:
00036D F150 00                      DB  0
       F151                     FNAME:
00036E F151                         DS  8+3
       F15C                     _CD:            ;カレントディレクトリ
000379 F15C 0000                    DW  0
       F15E                     _CDX:
00037B F15E 0000                    DW  0
       F160                     BASSTK:
00037D F160 0000                    DW  0
       F162                     _HL:
00037F F162 0000                    DW  0
       F164                     _SP:
000381 F164 0000                    DW  0
                                
       F166                     ISC_E:
000383 4383                         ORG $$+RUN          ;$DEPHASE
                                
       4383                     MSX1:
000383 4383 CDC850          17      CALL    MSGA1
       4386                     MSX:
000386 4386 7E               7      LD  A,(HL)
000387 4387 23               6      INC HL
000388 4388 B7               4      OR  A
000389 4389 20F8            12      JR  NZ,MSX1
00038B 438B C9              10      RET
                                
       438C                     PRTHX:
00038C 438C F5              11      PUSH    AF
00038D 438D 07               4      RLCA
00038E 438E 07               4      RLCA
00038F 438F 07               4      RLCA
000390 4390 07               4      RLCA
000391 4391 CD9543          17      CALL    PRTA2
000394 4394 F1              10      POP AF
       4395                     PRTA2:
000395 4395 CD9B43          17      CALL    ASC
000398 4398 C3C450          10      JP  MSG_A
                                    
       439B                     ASC:
00039B 439B E60F             7      AND $0F
00039D 439D F630             7      OR  $30
00039F 439F FE3A             7      CP  $3A
0003A1 43A1 D8              11      RET C
0003A2 43A2 C607             7      ADD A,7
0003A4 43A4 C9              10      RET
                                
       43A5                     MSN:
0003A5 43A5 7E               7      LD  A,(HL)
0003A6 43A6 23               6      INC HL
0003A7 43A7 CDC450          17      CALL    MSG_A
0003AA 43AA 10F9            13      DJNZ    MSN
0003AC 43AC C9              10      RET
                                
       43AD                     ROM_STKE:
0003AD 43AD 3E                      DB  03EH
0003AE 43AE C9              10      RET
0003AF 43AF 32DAFE          13      LD  (H_STKE),A
0003B2 43B2 E5              11      PUSH    HL
0003B3 43B3 D5              11      PUSH    DE
0003B4 43B4 C5              11      PUSH    BC
0003B5 43B5 181D            12      JR  BASAUTO
                                
0003B7 43B7 AF               4      XOR A
0003B8 43B8 5F               4      LD  E,A
0003B9 43B9 57               4      LD  D,A
0003BA 43BA 0601             7      LD  B,1
0003BC 43BC 2100C0          10      LD  HL,0C000H
0003BF 43BF CDC84E          17      CALL    DISKIO
                                
0003C2 43C2 ED7360F1        20      LD  (BASSTK),SP
0003C6 43C6 116BF3          10      LD  DE,RAMUSE
0003C9 43C9 AF               4      XOR A
0003CA 43CA CD1EC0          17      CALL    0C01EH
0003CD 43CD 116BF3          10      LD  DE,RAMUSE
0003D0 43D0 37               4      SCF
0003D1 43D1 CD1EC0          17      CALL    0C01EH
       43D4                     BASAUTO:
0003D4 43D4 211844          10      LD  HL,AUTOEXEC
0003D7 43D7 1150F1          10      LD  DE,FDRV
0003DA 43DA 010C00          10      LD  BC,1+8+3
0003DD 43DD EDB0                    LDIR
0003DF 43DF CDB84B          17      CALL    ROM_OPEN
0003E2 43E2 3813            12      JR  C,RSTKEE
0003E4 43E4 212444          10      LD  HL,RUN_AUTOEXEC
0003E7 43E7 11F0FB          10      LD  DE,KEYBUF
0003EA 43EA ED53FAF3        20      LD  (GETPNT),DE
0003EE 43EE 011300          10      LD  BC,RUN_AUTOEXEC_E-RUN_AUTOEXEC
0003F1 43F1 EDB0                    LDIR
0003F3 43F3 ED53F8F3        20      LD  (PUTPNT),DE
       43F7                     RSTKEE:
0003F7 43F7 C1              10      POP BC
0003F8 43F8 D1              10      POP DE
0003F9 43F9 E1              10      POP HL
0003FA 43FA C9              10      RET
                                
       43FB                     MSG_ERROR_ROM_MODE:
                                #if exists USE_NORMAL_32K_ROM
0003FB 43FB 4E6F726D616C2052        DB  "Normal ROM/ASCII-16K only!",13,10
            4F4D2F4153434949    
            2D31364B206F6E6C    
            79210D0A            
                                #else
                                    DB  "ASCII-8K/Konami-8K/Konami-SCC only!",13,10
                                #endif
       4417                     NULL:
000417 4417 00                      DB  0
                                
       4418                     AUTOEXEC:
000418 4418 004155544F455845        DB  0,"AUTOEXECBAS"
            43424153            
       4424                     RUN_AUTOEXEC:
000424 4424 52554E2022415554        DB  'RUN "AUTOEXEC.BAS"',00DH
            4F455845432E4241    
            53220D              
                                ;   DB  'LOAD "AUTOEXEC.BAS"',00DH  ;テスト用
       4437                     RUN_AUTOEXEC_E:
[EOF:INIT.ASM:UTF_8]
                                    INCLUDE "FILE.ASM"
       4437                     ROM_LDIR:
000437 4437 3A32F1          13      LD  A,(FLG_LDIR)
00043A 443A B7               4      OR  A
00043B 443B 2064            12      JR  NZ,ROM_LDIRVM
00043D 443D CB7A             8      BIT 7,D
00043F 443F CACA44          10      JP  Z,ROM_LDIRSLT
                                #if exists USE_NORMAL_32K_ROM
       4442                     LDIRA:
000442 4442 F3               4      DI
000443 4443 ED7364F1        20      LD  (_SP),SP
000447 4447 3121FB          10      LD  SP,DRVTBL
       444A                     LDIR1:
00044A 444A 78               4      LD  A,B
00044B 444B B1               4      OR  C
00044C 444C 284D            12      JR  Z,LDIRE
                                
00044E 444E C5              11      PUSH    BC
00044F 444F D5              11      PUSH    DE
000450 4450 E5              11      PUSH    HL
000451 4451 3A00F1          13      LD  A,(ROM_SLT)
000454 4454 2680             7      LD  H,080H
000456 4456 CD2400          17      CALL    _ENASLT
000459 4459 E1              10      POP HL
00045A 445A D1              10      POP DE
00045B 445B C1              10      POP BC
       445C                     LDIR2:
00045C 445C 7A               4      LD  A,D
00045D 445D FEC0             7      CP  0C0H
00045F 445F 302C            12      JR  NC,LDIR4
                                
000461 4461 C5              11      PUSH    BC
000462 4462 D5              11      PUSH    DE
000463 4463 115EF5          10      LD  DE,BUF
                                
000466 4466 78               4      LD  A,B
000467 4467 B7               4      OR  A
000468 4468 2803            12      JR  Z,LDIR3
00046A 446A 010001          10      LD  BC,00100H
       446D                     LDIR3:
00046D 446D C5              11      PUSH    BC
00046E 446E EDB0                    LDIR
000470 4470 2262F1          16      LD  (_HL),HL
                                
000473 4473 3A43F3          13      LD  A,(RAMAD2)
000476 4476 2680             7      LD  H,080H
000478 4478 CD2400          17      CALL    _ENASLT
                                
00047B 447B C1              10      POP BC
00047C 447C D1              10      POP DE
00047D 447D 215EF5          10      LD  HL,BUF
000480 4480 EDB0                    LDIR
                                
000482 4482 2A62F1          16      LD  HL,(_HL)
000485 4485 C1              10      POP BC
000486 4486 78               4      LD  A,B
000487 4487 B7               4      OR  A
000488 4488 2811            12      JR  Z,LDIRE
00048A 448A 05               4      DEC B
00048B 448B 18BD            12      JR  LDIR1
       448D                     LDIR4:
                                #endif
00048D 448D EDB0                    LDIR
                                
                                #if exists USE_NORMAL_32K_ROM
       448F                     LDIRE2:
00048F 448F D5              11      PUSH    DE
000490 4490 E5              11      PUSH    HL
000491 4491 3A43F3          13      LD  A,(RAMAD2)
000494 4494 2680             7      LD  H,080H
000496 4496 CD2400          17      CALL    _ENASLT
000499 4499 E1              10      POP HL
00049A 449A D1              10      POP DE
       449B                     LDIRE:
00049B 449B ED7B64F1        20      LD  SP,(_SP)
00049F 449F FB               4      EI
                                #endif
0004A0 44A0 C9              10      RET
                                
       44A1                     ROM_LDIRVM:
                                #if exists USE_NORMAL_32K_ROM
0004A1 44A1 F3               4      DI
0004A2 44A2 ED7364F1        20      LD  (_SP),SP
0004A6 44A6 3121FB          10      LD  SP,DRVTBL
0004A9 44A9 C5              11      PUSH    BC
0004AA 44AA D5              11      PUSH    DE
0004AB 44AB E5              11      PUSH    HL
0004AC 44AC 3A00F1          13      LD  A,(ROM_SLT)
0004AF 44AF 2680             7      LD  H,080H
0004B1 44B1 CD2400          17      CALL    _ENASLT
0004B4 44B4 E1              10      POP HL
0004B5 44B5 D1              10      POP DE
0004B6 44B6 C1              10      POP BC
                                #endif
0004B7 44B7 C5              11      PUSH    BC
0004B8 44B8 D5              11      PUSH    DE
0004B9 44B9 FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
0004BD 44BD DD215C00        14      LD  IX,LDIRVM
0004C1 44C1 CD1C00          17      CALL    _CALSLT
0004C4 44C4 E1              10      POP HL
0004C5 44C5 C1              10      POP BC
0004C6 44C6 09              11      ADD HL,BC
0004C7 44C7 EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
0004C8 44C8 18C5            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       44CA                     ROM_LDIRSLT:
                                #if exists USE_NORMAL_32K_ROM
0004CA 44CA F3               4      DI
0004CB 44CB ED7364F1        20      LD  (_SP),SP
0004CF 44CF 3121FB          10      LD  SP,DRVTBL
0004D2 44D2 C5              11      PUSH    BC
0004D3 44D3 D5              11      PUSH    DE
0004D4 44D4 E5              11      PUSH    HL
0004D5 44D5 3A00F1          13      LD  A,(ROM_SLT)
0004D8 44D8 2680             7      LD  H,080H
0004DA 44DA CD2400          17      CALL    _ENASLT
0004DD 44DD E1              10      POP HL
0004DE 44DE D1              10      POP DE
0004DF 44DF C1              10      POP BC
                                #endif
       44E0                     ROM_LDIRSLT1:
0004E0 44E0 EB               4      EX  DE,HL
       44E1                     RLDIRSLT1:
0004E1 44E1 1A               7      LD  A,(DE)
0004E2 44E2 13               6      INC DE
0004E3 44E3 C5              11      PUSH    BC
0004E4 44E4 D5              11      PUSH    DE
0004E5 44E5 E5              11      PUSH    HL
0004E6 44E6 5F               4      LD  E,A
                                
0004E7 44E7 0141F3          10      LD  BC,RAMAD0
0004EA 44EA 7C               4      LD  A,H
0004EB 44EB 07               4      RLCA
0004EC 44EC 07               4      RLCA
0004ED 44ED E603             7      AND 3
0004EF 44EF 81               4      ADD A,C
0004F0 44F0 4F               4      LD  C,A
0004F1 44F1 0A               7      LD  A,(BC)
       44F2                     RLDIRSLT2:
0004F2 44F2 CD1400          17      CALL    _WRSLT
0004F5 44F5 08               4      EX  AF,AF'
0004F6 44F6 E1              10      POP HL
0004F7 44F7 D1              10      POP DE
0004F8 44F8 C1              10      POP BC
0004F9 44F9 EDA1            16      CPI         ;HL=HL+1 BC=BC-1 BCが0の場合にP/V=0
0004FB 44FB EAE144          10      JP  PE,RLDIRSLT1
0004FE 44FE EB               4      EX  DE,HL
                                #if exists USE_NORMAL_32K_ROM
0004FF 44FF 188E            12      JR  LDIRE2
                                #else
                                    RET
                                #endif
                                
       4501                     END_OF_LINE:
000501 4501 215EF5          10      LD  HL,BUF
       4504                     EOL1:
000504 4504 7E               7      LD  A,(HL)
000505 4505 C8              11      RET Z
000506 4506 FE0D             7      CP  00DH
000508 4508 2807            12      JR  Z,EOLE
00050A 450A FE0A             7      CP  00AH
00050C 450C 2803            12      JR  Z,EOLE
00050E 450E 23               6      INC HL
00050F 450F 18F3            12      JR  EOL1
       4511                     EOLE:
000511 4511 3600            10      LD  (HL),0
000513 4513 23               6      INC HL
000514 4514 7E               7      LD  A,(HL)
000515 4515 FE0A             7      CP  00AH
000517 4517 C0              11      RET NZ
000518 4518 23               6      INC HL
000519 4519 C9              10      RET
                                
       451A                     ROM_LOAD_ASCII:
00051A 451A 210000          10      LD  HL,0
00051D 451D 2236F1          16      LD  (_BUF_ST),HL    ;読み出し位置
000520 4520 2A76F6          16      LD  HL,(TXTTAB)
000523 4523 2238F1          16      LD  (_BUF_EN),HL    ;書き出し位置
                                
000526 4526 215EF5          10      LD  HL,BUF
000529 4529 2230F1          16      LD  (_DTA),HL
       452C                     RLOAD_A1:
00052C 452C 2A36F1          16      LD  HL,(_BUF_ST)
00052F 452F 2226F1          16      LD  (RR_LOW),HL
000532 4532 210201          10      LD  HL,258
000535 4535 CD9D49          17      CALL    ROM_READ
000538 4538 7C               4      LD  A,H
000539 4539 B5               4      OR  L
00053A 453A 2877            12      JR  Z,RLOAD_AEND
00053C 453C 015EF5          10      LD  BC,BUF
00053F 453F 09              11      ADD HL,BC
000540 4540 3600            10      LD  (HL),0
000542 4542 CD0145          17      CALL    END_OF_LINE
000545 4545 015EF5          10      LD  BC,BUF
000548 4548 A7               4      AND A
000549 4549 ED42            15      SBC HL,BC
00054B 454B 2810            12      JR  Z,RLOAD_A2
00054D 454D 4D               4      LD  C,L
00054E 454E 44               4      LD  B,H
00054F 454F ED5B36F1        20      LD  DE,(_BUF_ST)
000553 4553 19              11      ADD HL,DE
000554 4554 2236F1          16      LD  (_BUF_ST),HL
000557 4557 3A5EF5          13      LD  A,(BUF)
00055A 455A B7               4      OR  A
00055B 455B 28CF            12      JR  Z,RLOAD_A1
       455D                     RLOAD_A2:
00055D 455D 115EF5          10      LD  DE,BUF
000560 4560 CD4F4B          17      CALL    SPCUTEX
000563 4563 1A               7      LD  A,(DE)
000564 4564 B7               4      OR  A
000565 4565 284C            12      JR  Z,RLOAD_AEND
000567 4567 CD614B          17      CALL    GETNUM
00056A 456A 7C               4      LD  A,H
00056B 456B B5               4      OR  L
00056C 456C CA1246          10      JP  Z,ERROR_DIRECT_IN_FILE
00056F 456F DD2A38F1        20      LD  IX,(_BUF_EN)
000573 4573 DD7502          19      LD  (IX+2),L
000576 4576 DD7403          19      LD  (IX+3),H
                                
000579 4579 CD484B          17      CALL    SPCUT
00057C 457C EB               4      EX  DE,HL
00057D 457D DDE5            15      PUSH    IX
00057F 457F DD21B242        14      LD  IX,CRUNCH
000583 4583 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000587 4587 CD1C00          17      CALL    _CALSLT
00058A 458A DDE1            14      POP IX
00058C 458C EB               4      EX  DE,HL
00058D 458D 111FF4          10      LD  DE,KBUF
000590 4590 37               4      SCF
000591 4591 ED52            15      SBC HL,DE
000593 4593 287D            12      JR  Z,ERROR_DIRECT_IN_FILE
000595 4595 387B            12      JR  C,ERROR_DIRECT_IN_FILE
000597 4597 4D               4      LD  C,L
000598 4598 44               4      LD  B,H
000599 4599 2A38F1          16      LD  HL,(_BUF_EN)
00059C 459C 110400          10      LD  DE,4
00059F 459F 19              11      ADD HL,DE
0005A0 45A0 111FF4          10      LD  DE,KBUF
                                
0005A3 45A3 EB               4      EX  DE,HL
0005A4 45A4 EDB0                    LDIR
0005A6 45A6 EB               4      EX  DE,HL
                                
0005A7 45A7 DD7500          19      LD  (IX+0),L
0005AA 45AA DD7401          19      LD  (IX+1),H
0005AD 45AD 2238F1          16      LD  (_BUF_EN),HL
0005B0 45B0 C32C45          10      JP  RLOAD_A1
                                
       45B3                     RLOAD_AEND:
0005B3 45B3 2A38F1          16      LD  HL,(_BUF_EN)
0005B6 45B6 AF               4      XOR A
0005B7 45B7 77               7      LD  (HL),A
0005B8 45B8 23               6      INC HL
0005B9 45B9 77               7      LD  (HL),A
0005BA 45BA 23               6      INC HL
0005BB 45BB 2238F1          16      LD  (_BUF_EN),HL
0005BE 45BE 183B            12      JR  RLOAD_END1
                                
       45C0                     ROM_LOAD:
0005C0 45C0 CD4C47          17      CALL    INIT_PARAM
0005C3 45C3 CD3D4A          17      CALL    FILE_B
0005C6 45C6 3A51F1          13      LD  A,(FNAME)
0005C9 45C9 FE20             7      CP  020H
0005CB 45CB CA384A          10      JP  Z,ROM_ORG
                                
0005CE 45CE CDB84B          17      CALL    ROM_OPEN
0005D1 45D1 3845            12      JR  C,ERROR_FILE_NOT_FOUND
                                
0005D3 45D3 2135F1          10      LD  HL,_BUF
0005D6 45D6 2230F1          16      LD  (_DTA),HL
0005D9 45D9 210100          10      LD  HL,1            ;ヘッダを1バイト読み込む
0005DC 45DC CD9D49          17      CALL    ROM_READ
0005DF 45DF 3A35F1          13      LD  A,(_BUF)
0005E2 45E2 3C               4      INC A
0005E3 45E3 C21A45          10      JP  NZ,ROM_LOAD_ASCII
0005E6 45E6 2A76F6          16      LD  HL,(TXTTAB)
0005E9 45E9 2230F1          16      LD  (_DTA),HL
0005EC 45EC EB               4      EX  DE,HL
0005ED 45ED 2100FF          10      LD  HL,-256
0005F0 45F0 39              11      ADD HL,SP
0005F1 45F1 ED52            15      SBC HL,DE
0005F3 45F3 CD9D49          17      CALL    ROM_READ
0005F6 45F6 ED5B30F1        20      LD  DE,(_DTA)
0005FA 45FA 19              11      ADD HL,DE
       45FB                     RLOAD_END1:
0005FB 45FB 22C2F6          16      LD  (VARTAB),HL
0005FE 45FE 22C4F6          16      LD  (ARYTAB),HL
000601 4601 22C6F6          16      LD  (STREND),HL
                                
000604 4604 AF               4      XOR A
000605 4605 2138F1          10      LD  HL,_BUF+3
000608 4608 77               7      LD  (HL),A
000609 4609 2B               6      DEC HL
00060A 460A 77               7      LD  (HL),A
00060B 460B 2B               6      DEC HL
00060C 460C 77               7      LD  (HL),A
00060D 460D 2B               6      DEC HL
00060E 460E 3E8F             7      LD  A,08FH          ;REM
000610 4610 77               7      LD  (HL),A
000611 4611 C9              10      RET
                                
       4612                     ERROR_DIRECT_IN_FILE:
000612 4612 1E39             7      LD  E,57            ;Direct statement in file
000614 4614 01                      DB  1           ;LD BC,
       4615                     ERROR_FILE_NOT_OPEN:
000615 4615 1E3B             7      LD  E,59            ;File not OPEN
000617 4617 01                      DB  1           ;LD BC,
       4618                     ERROR_FILE_NOT_FOUND:
000618 4618 1E35             7      LD  E,53            ;File not found
       461A                     ERROR:
00061A 461A FD2AC0FC        20      LD  IY,(EXPTBL-1) ;メインROMスロット
00061E 461E DD216F40        14      LD  IX,ERRHAND
000622 4622 C31C00          10      JP  _CALSLT
                                
       4625                     ROM_BLOAD:
000625 4625 CD4C47          17      CALL    INIT_PARAM
000628 4628 CD3D4A          17      CALL    FILE_B
00062B 462B CDB84B          17      CALL    ROM_OPEN
00062E 462E 38E8            12      JR  C,ERROR_FILE_NOT_FOUND
                                
000630 4630 2135F1          10      LD  HL,_BUF
000633 4633 2230F1          16      LD  (_DTA),HL
000636 4636 210700          10      LD  HL,7            ;ヘッダを7バイト読み込む
000639 4639 CD9D49          17      CALL    ROM_READ
00063C 463C 3A35F1          13      LD  A,(_BUF)
00063F 463F FEFE             7      CP  0FEH
000641 4641 20D2            12      JR  NZ,ERROR_FILE_NOT_OPEN
                                
000643 4643 210EF1          10      LD  HL,BLOAD_RET
000646 4646 2206F1          16      LD  (SWC_BLOAD),HL
                                
000649 4649 2A4EF1          16      LD  HL,(PARAM1)
00064C 464C 7E               7      LD  A,(HL)
00064D 464D FE2C             7      CP  ','
00064F 464F 2048            12      JR  NZ,RBREAD_MEM
000651 4651 23               6      INC HL
000652 4652 7E               7      LD  A,(HL)
000653 4653 CDA24B          17      CALL    CAP
000656 4656 32BEFC          13      LD  (RUNBNF),A
       4659                     RBOS1:
000659 4659 7E               7      LD  A,(HL)
00065A 465A 23               6      INC HL
00065B 465B B7               4      OR  A
00065C 465C 282F            12      JR  Z,RBREAD_OSE
00065E 465E FE3A             7      CP  ':'
000660 4660 282B            12      JR  Z,RBREAD_OSE
000662 4662 FE2C             7      CP  ','     ;次のパラメータを探す
000664 4664 20F3            12      JR  NZ,RBOS1
                                                ;オフセット
000666 4666 224EF1          16      LD  (PARAM1),HL
000669 4669 7E               7      LD  A,(HL)
00066A 466A B7               4      OR  A
00066B 466B 2820            12      JR  Z,RBREAD_OSE
00066D 466D DD21644C        14      LD  IX,FRMEVL
000671 4671 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000675 4675 CD1C00          17      CALL    _CALSLT
000678 4678 224EF1          16      LD  (PARAM1),HL
00067B 467B 3A63F6          13      LD  A,(VALTYP)
00067E 467E FE02             7      CP  2
000680 4680 200B            12      JR  NZ,RBREAD_OSE
000682 4682 2A36F1          16      LD  HL,(_BUF_ST)
000685 4685 ED5BF8F7        20      LD  DE,(DACDAT)
000689 4689 19              11      ADD HL,DE
00068A 468A 2236F1          16      LD  (_BUF_ST),HL
       468D                     RBREAD_OSE:
00068D 468D 3ABEFC          13      LD  A,(RUNBNF)
000690 4690 FE53             7      CP  'S'
000692 4692 2005            12      JR  NZ,RBREAD_MEM
000694 4694 3E01             7      LD  A,1
000696 4696 3232F1          13      LD  (FLG_LDIR),A
       4699                     RBREAD_MEM:
000699 4699 2A36F1          16      LD  HL,(_BUF_ST)
00069C 469C 22BFFC          16      LD  (SAVENT),HL
00069F 469F 2230F1          16      LD  (_DTA),HL
0006A2 46A2 21FFFF          10      LD  HL,0FFFFH
0006A5 46A5 CD9D49          17      CALL    ROM_READ
0006A8 46A8 3ABEFC          13      LD  A,(RUNBNF)
0006AB 46AB FE52             7      CP  'R'
0006AD 46AD 2006            12      JR  NZ,RBREAD1
0006AF 46AF 2A3AF1          16      LD  HL,(_BUF_EX)
0006B2 46B2 2206F1          16      LD  (SWC_BLOAD),HL
       46B5                     RBREAD1:
       46B5                     ROM_NEXT:
0006B5 46B5 2A4EF1          16      LD  HL,(PARAM1)
0006B8 46B8 7E               7      LD  A,(HL)
0006B9 46B9 2B               6      DEC HL
0006BA 46BA B7               4      OR  A
0006BB 46BB 2805            12      JR  Z,RN1
0006BD 46BD FE3A             7      CP  ':'
0006BF 46BF 2801            12      JR  Z,RN1
0006C1 46C1 23               6      INC HL
       46C2                     RN1:
0006C2 46C2 5D               4      LD  E,L
0006C3 46C3 54               4      LD  D,H
                                
0006C4 46C4 CD784B          17      CALL    SEARCH_END
0006C7 46C7 B7               4      OR  A
0006C8 46C8 2821            12      JR  Z,REM
       46CA                     RN3:                    ;マルチステートメントの処理
0006CA 46CA 7E               7      LD  A,(HL)
                                
0006CB 46CB FEB5             7      CP  0B5H            ;LOAD
0006CD 46CD CAC045          10      JP  Z,ROM_LOAD
0006D0 46D0 FE8A             7      CP  08AH            ;RUN
0006D2 46D2 281B            12      JR  Z,ROM_RUN
0006D4 46D4 FEB7             7      CP  0B7H            ;FILES
0006D6 46D6 2824            12      JR  Z,ROM_FILES
0006D8 46D8 FED6             7      CP  0D6H            ;COPY
0006DA 46DA CA8247          10      JP  Z,ROM_COPY
0006DD 46DD FE20             7      CP  020H
0006DF 46DF 2807            12      JR  Z,RN_SP
                                
0006E1 46E1 3E28             7      LD  A,028H          ;JR Z,
0006E3 46E3 320CF1          13      LD  (SWC_BLOAD_M),A
0006E6 46E6 7E               7      LD  A,(HL)
0006E7 46E7 C9              10      RET
       46E8                     RN_SP:
0006E8 46E8 23               6      INC HL
0006E9 46E9 18DF            12      JR  RN3
                                
       46EB                     REM:
0006EB 46EB EB               4      EX  DE,HL
0006EC 46EC 3E8F             7      LD  A,08FH          ;REM
0006EE 46EE C9              10      RET
                                
       46EF                     ROM_RUN:
0006EF 46EF 23               6      INC HL
0006F0 46F0 7E               7      LD  A,(HL)
0006F1 46F1 2B               6      DEC HL
0006F2 46F2 B7               4      OR  A
0006F3 46F3 2803            12      JR  Z,ROM_RUN1
0006F5 46F5 CDC045          17      CALL    ROM_LOAD
       46F8                     ROM_RUN1:
0006F8 46F8 3E8A             7      LD  A,08AH          ;RUN
0006FA 46FA 77               7      LD  (HL),A
0006FB 46FB C9              10      RET
                                
       46FC                     ROM_FILES:
0006FC 46FC CD4C47          17      CALL    INIT_PARAM
0006FF 46FF CD3D4A          17      CALL    FILE_B
000702 4702 CD6950          17      CALL    GET_DISK_BANK_FDRV
000705 4705 3A51F1          13      LD  A,(FNAME)
000708 4708 FE21             7      CP  021H
00070A 470A 3005            12      JR  NC,RFILES0
00070C 470C 060B             7      LD  B,11
00070E 470E CD0C4B          17      CALL    FILE10
       4711                     RFILES0:
000711 4711 CD0A4E          17      CALL    GET_DIR_DAT
       4714                     RFILES1:
000714 4714 CDD44B          17      CALL    FILESE
000717 4717 302E            12      JR  NC,RFILES_NOT_MATCH
       4719                     RFILES_DISP:
000719 4719 E5              11      PUSH    HL
00071A 471A 0608             7      LD  B,8
00071C 471C CDA543          17      CALL    MSN
00071F 471F 3E2E             7      LD  A,'.'
000721 4721 CDC450          17      CALL    MSG_A
000724 4724 0603             7      LD  B,3
000726 4726 CDA543          17      CALL    MSN
000729 4729 3ADDF3          13      LD  A,(CSRX)
00072C 472C 47               4      LD  B,A
00072D 472D 3AB0F3          13      LD  A,(LINLEN)
000730 4730 90               4      SUB B
000731 4731 FE0C             7      CP  12
000733 4733 3009            12      JR  NC,RFILES2
000735 4735 3E0D             7      LD  A,00DH      ;改行
000737 4737 CDC450          17      CALL    MSG_A
00073A 473A 3E0A             7      LD  A,00AH
00073C 473C 1802            12      JR  RFILES3
       473E                     RFILES2:
00073E 473E 3E20             7      LD  A,020H
       4740                     RFILES3:
000740 4740 CDC450          17      CALL    MSG_A
000743 4743 E1              10      POP HL
000744 4744 CDF04B          17      CALL    FNEXT
       4747                     RFILES_NOT_MATCH:
000747 4747 20CB            12      JR  NZ,RFILES1
000749 4749 C3B546          10      JP  ROM_NEXT
                                
       474C                     INIT_PARAM:
00074C 474C 224CF1          16      LD  (PARAM0),HL
00074F 474F 224EF1          16      LD  (PARAM1),HL
000752 4752 EB               4      EX  DE,HL
000753 4753 AF               4      XOR A
000754 4754 3232F1          13      LD  (FLG_LDIR),A
000757 4757 32BEFC          13      LD  (RUNBNF),A
00075A 475A 3263F6          13      LD  (VALTYP),A
00075D 475D E5              11      PUSH    HL
00075E 475E 2A5CF1          16      LD  HL,(_CD)
000761 4761 225EF1          16      LD  (_CDX),HL
000764 4764 E1              10      POP HL
000765 4765 13               6      INC DE
000766 4766 CD484B          17      CALL    SPCUT
000769 4769 1A               7      LD  A,(DE)
00076A 476A B7               4      OR  A
00076B 476B C8              11      RET Z
00076C 476C FE3A             7      CP  ':'
00076E 476E C8              11      RET Z
00076F 476F FE28             7      CP  '('
000771 4771 C8              11      RET Z
000772 4772 EB               4      EX  DE,HL
000773 4773 DD21644C        14      LD  IX,FRMEVL
000777 4777 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
00077B 477B CD1C00          17      CALL    _CALSLT
00077E 477E 224EF1          16      LD  (PARAM1),HL
000781 4781 C9              10      RET
                                
       4782                     ROM_COPY:
000782 4782 CD4C47          17      CALL    INIT_PARAM
000785 4785 3A63F6          13      LD  A,(VALTYP)
000788 4788 FE03             7      CP  3       ;string
00078A 478A C2384A          10      JP  NZ,ROM_ORG  ;最初の引数が文字列ではない場合はオリジナルを実行する
                                
00078D 478D CD3D4A          17      CALL    FILE_B
000790 4790 CDB84B          17      CALL    ROM_OPEN
000793 4793 DA1846          10      JP  C,ERROR_FILE_NOT_FOUND
                                
000796 4796 213AF1          10      LD  HL,_BUF_W
000799 4799 2230F1          16      LD  (_DTA),HL
00079C 479C 210400          10      LD  HL,4            ;ヘッダを4バイト読み込む
00079F 479F CD9D49          17      CALL    ROM_READ
                                
0007A2 47A2 AF               4      XOR A
0007A3 47A3 3235F1          13      LD  (_BUF_LO),A     ;PSET
0007A6 47A6 3242F1          13      LD  (_BUF_O),A      ;向き
                                
0007A9 47A9 2A4EF1          16      LD  HL,(PARAM1)
       47AC                     RCP_PARAM1:
0007AC 47AC 7E               7      LD  A,(HL)
0007AD 47AD 23               6      INC HL
0007AE 47AE B7               4      OR  A
0007AF 47AF CA384A          10      JP  Z,ROM_ORG
0007B2 47B2 FE3A             7      CP  ':'
0007B4 47B4 CA384A          10      JP  Z,ROM_ORG
0007B7 47B7 FE2C             7      CP  ','
0007B9 47B9 2012            12      JR  NZ,RCP_PARAM1_
                                
0007BB 47BB DD212F54        14      LD  IX,FRMQNT
0007BF 47BF FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007C3 47C3 CD1C00          17      CALL    _CALSLT
0007C6 47C6 7B               4      LD  A,E
0007C7 47C7 87               4      ADD A,A
0007C8 47C8 87               4      ADD A,A
0007C9 47C9 3242F1          13      LD  (_BUF_O),A
0007CC 47CC 7E               7      LD  A,(HL)
       47CD                     RCP_PARAM1_:
0007CD 47CD FE28             7      CP  '('
0007CF 47CF 20DB            12      JR  NZ,RCP_PARAM1
                                
0007D1 47D1 DD212F54        14      LD  IX,FRMQNT
0007D5 47D5 FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007D9 47D9 CD1C00          17      CALL    _CALSLT
                                
0007DC 47DC ED533EF1        20      LD  (_BUF_X),DE
                                
       47E0                     RCP_PARAM2:
0007E0 47E0 23               6      INC HL
0007E1 47E1 7E               7      LD  A,(HL)
0007E2 47E2 FE20             7      CP  020H
0007E4 47E4 28FA            12      JR  Z,RCP_PARAM2
0007E6 47E6 FE2C             7      CP  ','
0007E8 47E8 28F6            12      JR  Z,RCP_PARAM2
                                
0007EA 47EA DD212F54        14      LD  IX,FRMQNT
0007EE 47EE FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
0007F2 47F2 CD1C00          17      CALL    _CALSLT
                                
0007F5 47F5 ED5340F1        20      LD  (_BUF_Y),DE
       47F9                     RCP_PARAM3:
0007F9 47F9 23               6      INC HL
0007FA 47FA 7E               7      LD  A,(HL)
0007FB 47FB FE20             7      CP  020H
0007FD 47FD 28FA            12      JR  Z,RCP_PARAM3
0007FF 47FF FE29             7      CP  ')'
000801 4801 28F6            12      JR  Z,RCP_PARAM3
000803 4803 FE2C             7      CP  ','
000805 4805 2033            12      JR  NZ,RCP_ST
                                
000807 4807 23               6      INC HL
000808 4808 DD212F54        14      LD  IX,FRMQNT
00080C 480C FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000810 4810 CD1C00          17      CALL    _CALSLT
                                
000813 4813 7B               4      LD  A,E
000814 4814 3241F1          13      LD  (_BUF_P),A
                                
       4817                     RCP_PARAM4:
000817 4817 7E               7      LD  A,(HL)
000818 4818 23               6      INC HL
000819 4819 FE20             7      CP  020H
00081B 481B 28FA            12      JR  Z,RCP_PARAM4
                                
00081D 481D FE2C             7      CP  ','
00081F 481F 2019            12      JR  NZ,RCP_ST
                                
000821 4821 7E               7      LD  A,(HL)
000822 4822 0604             7      LD  B,4
000824 4824 FEC3             7      CP  0C3H        ;PRESET
000826 4826 280E            12      JR  Z,RCP_LO
000828 4828 05               4      DEC B       ;3
000829 4829 D6F8             7      SUB 0F8H        ;XOR
00082B 482B 2809            12      JR  Z,RCP_LO
00082D 482D 05               4      DEC B       ;2
00082E 482E 3C               4      INC A       ;OR
00082F 482F 2805            12      JR  Z,RCP_LO
000831 4831 05               4      DEC B       ;1
000832 4832 3C               4      INC A       ;AND
000833 4833 2801            12      JR  Z,RCP_LO
000835 4835 05               4      DEC B       ;0
                                                ;PSET
       4836                     RCP_LO:
000836 4836 78               4      LD  A,B
000837 4837 3235F1          13      LD  (_BUF_LO),A
       483A                     RCP_ST:
00083A 483A 2AC6F6          16      LD  HL,(STREND)
00083D 483D 2230F1          16      LD  (_DTA),HL
000840 4840 EB               4      EX  DE,HL
000841 4841 2100FE          10      LD  HL,-512
000844 4844 39              11      ADD HL,SP
000845 4845 AF               4      XOR A
000846 4846 ED52            15      SBC HL,DE
000848 4848 3008            12      JR  NC,RCP0
00084A 484A 215EF5          10      LD  HL,BUF
00084D 484D 2230F1          16      LD  (_DTA),HL
000850 4850 6F               4      LD  L,A ;0
000851 4851 67               4      LD  H,A ;0
       4852                     RCP0:
000852 4852 24               4      INC H
000853 4853 2238F1          16      LD  (_BUF_EN),HL
       4856                     RCP1:
000856 4856 F3               4      DI
000857 4857 CD2B49          17      CALL    WAIT_VDP
                                
00085A 485A 3A0700          13      LD  A,(WRVDP)
00085D 485D 4F               4      LD  C,A
00085E 485E 0C               4      INC C       ;C := PORT#1's address(WR)
00085F 485F 3E24             7      LD  A,36
000861 4861 ED79            12      OUT (C),A
000863 4863 3E91             7      LD  A,080H+17
000865 4865 ED79            12      OUT (C),A       ;R#17 := 36
                                
000867 4867 0C               4      INC C
000868 4868 0C               4      INC C       ;C := PORT#3's address(WR)
000869 4869 2A3EF1          16      LD  HL,(_BUF_X)
00086C 486C ED69            12      OUT (C),L       ;R#36 DX
00086E 486E ED61            12      OUT (C),H       ;R#37
000870 4870 2A40F1          16      LD  HL,(_BUF_Y)
000873 4873 ED69            12      OUT (C),L       ;R#38 DY
000875 4875 ED61            12      OUT (C),H       ;R#39
000877 4877 2A3AF1          16      LD  HL,(_BUF_W)
00087A 487A ED69            12      OUT (C),L       ;R#40 NX
00087C 487C ED61            12      OUT (C),H       ;R#41
00087E 487E 2A3CF1          16      LD  HL,(_BUF_H)
000881 4881 ED69            12      OUT (C),L       ;R#42 NY
000883 4883 ED61            12      OUT (C),H       ;R#43
                                
000885 4885 DD2AAFFC        20      LD  IX,(SCRMOD)
000889 4889 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
00088C 488C B7               4      OR  A
00088D 488D 2022            12      JR  NZ,USE_LMMC ;PSETじゃない場合はLMMC
                                
00088F 488F DD7D             9      LD  A,IXL
000891 4891 FE08             7      CP  8
000893 4893 2817            12      JR  Z,USE_HMMC8 ;スクリーン8でPSET
000895 4895 FE06             7      CP  6
000897 4897 2A3EF1          16      LD  HL,(_BUF_X)
00089A 489A 3A3AF1          13      LD  A,(_BUF_W)
00089D 489D 2005            12      JR  NZ,SCR57
00089F 489F B5               4      OR  L       ;スクリーン6
0008A0 48A0 E603             7      AND 3
0008A2 48A2 200D            12      JR  NZ,USE_LMMC
       48A4                     SCR57:              ;スクリーン5,7
0008A4 48A4 B5               4      OR  L
0008A5 48A5 E601             7      AND 1
0008A7 48A7 2008            12      JR  NZ,USE_LMMC
       48A9                     USE_HMMC:
0008A9 48A9 DD2E08          10      LD  IXL,8
       48AC                     USE_HMMC8:
0008AC 48AC 3EF0             7      LD  A,0F0H      ;R#46 HMMC command
0008AE 48AE 3235F1          13      LD  (_BUF_LO),A
       48B1                     USE_LMMC:
0008B1 48B1 110000          10      LD  DE,0
0008B4 48B4 06FF             7      LD  B,-1
0008B6 48B6 CD5649          17      CALL    GET_PIXEL
0008B9 48B9 ED79            12      OUT (C),A       ;R#44 first DATA
0008BB 48BB 3A42F1          13      LD  A,(_BUF_O)
0008BE 48BE ED79            12      OUT (C),A       ;R#45 DIX and DIY
                                
0008C0 48C0 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008C3 48C3 F6B0             7      OR  0B0H        ;R#46 LMMC command
0008C5 48C5 ED79            12      OUT (C),A
                                
0008C7 48C7 FD69             9      LD  IYL,C       ;IYL := PORT#3's address(WR)
0008C9 48C9 0D               4      DEC C
0008CA 48CA 0D               4      DEC C       ;C := PORT#1's address(WR)
0008CB 48CB 3EAC             7      LD  A,080H+44
0008CD 48CD ED79            12      OUT (C),A
0008CF 48CF 3E91             7      LD  A,080H+17
0008D1 48D1 ED79            12      OUT (C),A       ;R#17 := 44
                                
0008D3 48D3 3A0600          13      LD  A,(RDVDP)
0008D6 48D6 3C               4      INC A
0008D7 48D7 FD67             9      LD  IYH,A       ;IYX := PORT#1's address(RD)
0008D9 48D9 3E02             7      LD  A,2
0008DB 48DB ED79            12      OUT (C),A
0008DD 48DD 3E8F             7      LD  A,08FH
0008DF 48DF ED79            12      OUT (C),A
0008E1 48E1 3A35F1          13      LD  A,(_BUF_LO) ;LOGICAL OPERATION
0008E4 48E4 E640             7      AND 040H
0008E6 48E6 201C            12      JR  NZ,LOOP_HMMC
       48E8                     LOOP_COPY:
0008E8 48E8 CD5649          17      CALL    GET_PIXEL
0008EB 48EB 08               4      EX  AF,AF'
0008EC 48EC FD4C             9      LD  C,IYH
       48EE                     LOOP_COPY1:
0008EE 48EE ED78            12      IN  A,(C)
0008F0 48F0 0F               4      RRCA            ;RRCAではサインフラグは変化しない
0008F1 48F1 300A            12      JR  NC,EXIT_COPY    ;check CE bit
0008F3 48F3 F2EE48          10      JP  P,LOOP_COPY1    ;check TR bit
0008F6 48F6 08               4      EX  AF,AF'
0008F7 48F7 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
0008F9 48F9 ED79            12      OUT (C),A
0008FB 48FB 18EB            12      JR  LOOP_COPY
                                
       48FD                     EXIT_COPY:
0008FD 48FD CD3349          17      CALL    GET_STATUS_0
000900 4900 FB               4      EI
000901 4901 C3B546          10      JP  ROM_NEXT
                                
       4904                     LOOP_HMMC:
000904 4904 FD4D             9      LD  C,IYL       ;IYL := PORT#3's address(WR)
000906 4906 43               4      LD  B,E
000907 4907 7B               4      LD  A,E
000908 4908 B7               4      OR  A
000909 4909 2802            12      JR  Z,LOOP_HMMC1
00090B 490B EDB3                    OTIR
       490D                     LOOP_HMMC1:
00090D 490D 14               4      INC D
       490E                     LOOP_HMMC2:
00090E 490E 15               4      DEC D
00090F 490F 2805            12      JR  Z,LOOP_HMMC3
000911 4911 EDB3                    OTIR
000913 4913 C30E49          10      JP  LOOP_HMMC2
       4916                     LOOP_HMMC3:
000916 4916 ED78            12      IN  A,(C)
000918 4918 0F               4      RRCA
000919 4919 30E2            12      JR  NC,EXIT_COPY    ;check CE bit
00091B 491B 2A38F1          16      LD  HL,(_BUF_EN)
00091E 491E CD9D49          17      CALL    ROM_READ
000921 4921 EB               4      EX  DE,HL
000922 4922 2A30F1          16      LD  HL,(_DTA)
000925 4925 7A               4      LD  A,D
000926 4926 B3               4      OR  E
000927 4927 20DB            12      JR  NZ,LOOP_HMMC
000929 4929 18C3            12      JR  LOOP_COPY1
                                    
       492B                     WAIT_VDP:
00092B 492B 3E02             7      LD  A,2
00092D 492D CD3449          17      CALL    GET_STATUS
000930 4930 0F               4      RRCA
000931 4931 38F8            12      JR  C,WAIT_VDP
       4933                     GET_STATUS_0:
000933 4933 AF               4      XOR A
       4934                     GET_STATUS:
000934 4934 C5              11      PUSH    BC
000935 4935 ED4B0600        20      LD  BC,(RDVDP)
000939 4939 0C               4      INC C
00093A 493A ED79            12      OUT (C),A
00093C 493C 3E8F             7      LD  A,08FH
00093E 493E ED79            12      OUT (C),A
000940 4940 ED78            12      IN  A,(C)
000942 4942 C1              10      POP BC
000943 4943 C9              10      RET
                                
       4944                     GET_PIXEL256:
000944 4944 7A               4      LD  A,D
000945 4945 B3               4      OR  E
000946 4946 200A            12      JR  NZ,GET_PIXEL1
000948 4948 2A38F1          16      LD  HL,(_BUF_EN)
00094B 494B CD9D49          17      CALL    ROM_READ
00094E 494E EB               4      EX  DE,HL
00094F 494F 2A30F1          16      LD  HL,(_DTA)
       4952                     GET_PIXEL1:
000952 4952 7E               7      LD  A,(HL)
000953 4953 23               6      INC HL
000954 4954 1B               6      DEC DE
000955 4955 C9              10      RET
                                
       4956                     GET_PIXEL:
000956 4956 04               4      INC B
000957 4957 DD7D             9      LD  A,IXL
000959 4959 FE08             7      CP  8
00095B 495B 28E7            12      JR  Z,GET_PIXEL256
00095D 495D FE06             7      CP  6
00095F 495F 282E            12      JR  Z,GET_PIXEL4
                                
000961 4961 CB40             8      BIT 0,B
000963 4963 20ED            12      JR  NZ,GET_PIXEL1
                                
000965 4965 7A               4      LD  A,D
000966 4966 B3               4      OR  E
000967 4967 200A            12      JR  NZ,GET_PIXEL2
                                
000969 4969 2A38F1          16      LD  HL,(_BUF_EN)
00096C 496C CD9D49          17      CALL    ROM_READ
00096F 496F EB               4      EX  DE,HL
000970 4970 2A30F1          16      LD  HL,(_DTA)
                                
       4973                     GET_PIXEL2:
000973 4973 7E               7      LD  A,(HL)
000974 4974 0F               4      RRCA
000975 4975 0F               4      RRCA
000976 4976 0F               4      RRCA
000977 4977 0F               4      RRCA
000978 4978 C9              10      RET
                                
       4979                     GET_PIXEL3:
000979 4979 7A               4      LD  A,D
00097A 497A B3               4      OR  E
00097B 497B 200A            12      JR  NZ,GET_PIXEL5
                                
00097D 497D 2A38F1          16      LD  HL,(_BUF_EN)
000980 4980 CD9D49          17      CALL    ROM_READ
000983 4983 EB               4      EX  DE,HL
000984 4984 2A30F1          16      LD  HL,(_DTA)
       4987                     GET_PIXEL5:
000987 4987 7E               7      LD  A,(HL)
000988 4988 0F               4      RRCA
000989 4989 0F               4      RRCA
00098A 498A 0F               4      RRCA
00098B 498B 0F               4      RRCA
00098C 498C 0F               4      RRCA
00098D 498D 0F               4      RRCA
00098E 498E C9              10      RET
                                
       498F                     GET_PIXEL4:
00098F 498F 78               4      LD  A,B
000990 4990 E603             7      AND 3   ;+0
000992 4992 28E5            12      JR  Z,GET_PIXEL3
000994 4994 3D               4      DEC A   ;+1
000995 4995 28DC            12      JR  Z,GET_PIXEL2
000997 4997 3D               4      DEC A   ;+2
000998 4998 7E               7      LD  A,(HL)
000999 4999 C0              11      RET NZ
00099A 499A 0F               4      RRCA        ;+3
00099B 499B 0F               4      RRCA
00099C 499C C9              10      RET
                                
       499D                     ROM_READ:
00099D 499D E5              11      PUSH    HL
00099E 499E D5              11      PUSH    DE
00099F 499F C5              11      PUSH    BC
0009A0 49A0 FDE5            15      PUSH    IY
0009A2 49A2 224AF1          16      LD  (LEFTX),HL
0009A5 49A5 2A30F1          16      LD  HL,(_DTA)
0009A8 49A8 2243F1          16      LD  (DTAX),HL
0009AB 49AB 2A4AF1          16      LD  HL,(LEFTX)
                                
0009AE 49AE CD344C          17      CALL    RBX1
0009B1 49B1 3870            12      JR  C,RBRERR1
0009B3 49B3 79               4      LD  A,C
0009B4 49B4 EB               4      EX  DE,HL
0009B5 49B5 ED52            15      SBC HL,DE       ;CP 0HL,CDE
0009B7 49B7 19              11      ADD HL,DE
0009B8 49B8 DE00             7      SBC A,000H
0009BA 49BA 3801            12      JR  C,RBR1
0009BC 49BC EB               4      EX  DE,HL
       49BD                     RBR1:
0009BD 49BD 9F               4      SBC A,A
0009BE 49BE E601             7      AND 1
0009C0 49C0 321FF1          13      LD  (_RESULT),A
0009C3 49C3 7C               4      LD  A,H
0009C4 49C4 B5               4      OR  L
0009C5 49C5 CA194A          10      JP  Z,RBREND0
                                
0009C8 49C8 222CF1          16      LD  (_LEFT),HL  ;Read record byte
0009CB 49CB 224AF1          16      LD  (LEFTX),HL
                                
0009CE 49CE CD5D4C          17      CALL    RBX2
0009D1 49D1 281A            12      JR  Z,RBRB
                                                ;先頭の端数
0009D3 49D3 CD704C          17      CALL    RBXA
0009D6 49D6 DA2F4A          10      JP  C,RBRERR
0009D9 49D9 C5              11      PUSH    BC
0009DA 49DA CD3744          17      CALL    ROM_LDIR
0009DD 49DD ED5343F1        20      LD  (DTAX),DE
0009E1 49E1 2A4AF1          16      LD  HL,(LEFTX)
0009E4 49E4 D1              10      POP DE
0009E5 49E5 A7               4      AND A
0009E6 49E6 ED52            15      SBC HL,DE
0009E8 49E8 224AF1          16      LD  (LEFTX),HL
0009EB 49EB 2829            12      JR  Z,RBREND
                                
       49ED                     RBRB:
0009ED 49ED CDA94C          17      CALL    RBXB
0009F0 49F0 2818            12      JR  Z,RBRC
       49F2                     RBRB1:
0009F2 49F2 C5              11      PUSH    BC
0009F3 49F3 D5              11      PUSH    DE
0009F4 49F4 CD514D          17      CALL    CLUST
0009F7 49F7 EB               4      EX  DE,HL
0009F8 49F8 ED4B22F1        20      LD  BC,(CLSZ)       ;1クラスタのサイズ
0009FC 49FC CD3744          17      CALL    ROM_LDIR
0009FF 49FF EB               4      EX  DE,HL
000A00 4A00 D1              10      POP DE
000A01 4A01 C1              10      POP BC
000A02 4A02 CD2E4D          17      CALL    GNCL
000A05 4A05 DA2F4A          10      JP  C,RBRERR
000A08 4A08 10E8            13      DJNZ    RBRB1
       4A0A                     RBRC:
000A0A 4A0A CDC14C          17      CALL    RBXC
000A0D 4A0D 2807            12      JR  Z,RBREND
                                
000A0F 4A0F CD514D          17      CALL    CLUST
000A12 4A12 EB               4      EX  DE,HL
000A13 4A13 CD3744          17      CALL    ROM_LDIR
       4A16                     RBREND:
000A16 4A16 CDCD4C          17      CALL    RBXEND
       4A19                     RBREND0:
000A19 4A19 FDE1            14      POP IY
000A1B 4A1B C1              10      POP BC
000A1C 4A1C D1              10      POP DE
000A1D 4A1D F1              10      POP AF  ;(HL)
000A1E 4A1E AF               4      XOR A
000A1F 4A1F 3A1FF1          13      LD  A,(_RESULT)
000A22 4A22 C9              10      RET
                                
       4A23                     RBRERR1:
000A23 4A23 3E01             7      LD  A,001H
       4A25                     RBRERR2:
000A25 4A25 FDE1            14      POP IY
000A27 4A27 C1              10      POP BC
000A28 4A28 D1              10      POP DE
000A29 4A29 E1              10      POP HL
000A2A 4A2A 37               4      SCF
000A2B 4A2B 210000          10      LD  HL,0
000A2E 4A2E C9              10      RET
       4A2F                     RBRERR:
000A2F 4A2F 3EFF             7      LD  A,0FFH
000A31 4A31 18F2            12      JR  RBRERR2
                                
       4A33                     FILE_DD:
000A33 4A33 3E                      DB  03EH
000A34 4A34 C9              10      RET
000A35 4A35 320CF1          13      LD  (SWC_BLOAD_M),A
       4A38                     ROM_ORG:
000A38 4A38 2A4CF1          16      LD  HL,(PARAM0)
000A3B 4A3B 7E               7      LD  A,(HL)
000A3C 4A3C C9              10      RET
       4A3D                     FILE_B:
000A3D 4A3D AF               4      XOR A
000A3E 4A3E 3250F1          13      LD  (FDRV),A
000A41 4A41 1E00             7      LD  E,0
000A43 4A43 3A63F6          13      LD  A,(VALTYP)
000A46 4A46 FE03             7      CP  3       ;string
000A48 4A48 207F            12      JR  NZ,FILED
                                
000A4A 4A4A DD21D067        14      LD  IX,FRESTR
000A4E 4A4E FD2AC0FC        20      LD  IY,(EXPTBL-1)   ;メインROMスロット
000A52 4A52 CD1C00          17      CALL    _CALSLT
000A55 4A55 E5              11      PUSH    HL
000A56 4A56 DDE1            14      POP IX
                                
000A58 4A58 DD5E00          19      LD  E,(IX+0)
000A5B 4A5B DD7E01          19      LD  A,(IX+1)
000A5E 4A5E DD5602          19      LD  D,(IX+2)
000A61 4A61 DD62             9      LD  IXH,D
000A63 4A63 DD6F             9      LD  IXL,A
000A65 4A65 7B               4      LD  A,E
       4A66                     FILE_BDOS:
000A66 4A66 FE04             7      CP  4
000A68 4A68 3808            12      JR  C,FILEB1
000A6A 4A6A DD7E03          19      LD  A,(IX+3)
000A6D 4A6D FE3A             7      CP  ':'
000A6F 4A6F 28C2            12      JR  Z,FILE_DD
000A71 4A71 7B               4      LD  A,E
       4A72                     FILEB1:
000A72 4A72 FE02             7      CP  2
000A74 4A74 3818            12      JR  C,DEVI1
000A76 4A76 DD7E01          19      LD  A,(IX+1)
000A79 4A79 FE3A             7      CP  ':'
000A7B 4A7B 2011            12      JR  NZ,DEVI1
000A7D 4A7D DD7E00          19      LD  A,(IX+0)        ;DRIVE
000A80 4A80 CDA24B          17      CALL    CAP
000A83 4A83 D640             7      SUB '@'
000A85 4A85 DD23            10      INC IX
000A87 4A87 DD23            10      INC IX
000A89 4A89 1D               4      DEC E
000A8A 4A8A 1D               4      DEC E
000A8B 4A8B 3250F1          13      LD  (FDRV),A
       4A8E                     DEVI1:
000A8E 4A8E DD7E00          19      LD  A,(IX+0)
000A91 4A91 D65C             7      SUB 05CH        ;\
000A93 4A93 2008            12      JR  NZ,NOROOT
000A95 4A95 6F               4      LD  L,A
000A96 4A96 67               4      LD  H,A
000A97 4A97 225EF1          16      LD  (_CDX),HL
000A9A 4A9A DD23            10      INC IX
000A9C 4A9C 1D               4      DEC E
       4A9D                     NOROOT:
                                
       4A9D                     SETDIR:
000A9D 4A9D CDC94A          17      CALL    FILED
000AA0 4AA0 DD7E00          19      LD  A,(IX+0)
000AA3 4AA3 FE5C             7      CP  05CH        ;\
000AA5 4AA5 C0              11      RET NZ
000AA6 4AA6 DD23            10      INC IX
000AA8 4AA8 1D               4      DEC E
       4AA9                     SETDIR1:
000AA9 4AA9 DDE5            15      PUSH    IX
000AAB 4AAB CDB84B          17      CALL    ROM_OPEN
000AAE 4AAE DDE1            14      POP IX
000AB0 4AB0 B7               4      OR  A
000AB1 4AB1 C0              11      RET NZ
                                
000AB2 4AB2 FD2A47F1        20      LD  IY,(DIRENT1)
000AB6 4AB6 FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000ABA 4ABA C8              11      RET Z
000ABB 4ABB CD104B          17      CALL    FILEI
000ABE 4ABE FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000AC1 4AC1 FD661B          19      LD  H,(IY+01BH)
000AC4 4AC4 225EF1          16      LD  (_CDX),HL
000AC7 4AC7 18D4            12      JR  SETDIR
                                
       4AC9                     FILED:
000AC9 4AC9 CD104B          17      CALL    FILEI
000ACC 4ACC 2151F1          10      LD  HL,FNAME
                                
000ACF 4ACF 0608             7      LD  B,8
       4AD1                     FILE2:
000AD1 4AD1 CD1D4B          17      CALL    CCHKF
000AD4 4AD4 C8              11      RET Z
000AD5 4AD5 FE2A             7      CP  '*'
000AD7 4AD7 282E            12      JR  Z,FILE9
000AD9 4AD9 FE2E             7      CP  '.'
000ADB 4ADB 280C            12      JR  Z,FILE4
000ADD 4ADD 77               7      LD  (HL),A
000ADE 4ADE 23               6      INC HL
000ADF 4ADF 10F0            13      DJNZ    FILE2
                                
       4AE1                     FILE3:
000AE1 4AE1 CD1D4B          17      CALL    CCHKF
000AE4 4AE4 C8              11      RET Z
000AE5 4AE5 FE2E             7      CP  '.'
000AE7 4AE7 20F8            12      JR  NZ,FILE3
                                
       4AE9                     FILE4:
000AE9 4AE9 2159F1          10      LD  HL,FNAME+8
000AEC 4AEC 0603             7      LD  B,3
                                
       4AEE                     FILE4L:
000AEE 4AEE CD1D4B          17      CALL    CCHKF
000AF1 4AF1 C8              11      RET Z
000AF2 4AF2 FE2E             7      CP  '.'
000AF4 4AF4 2008            12      JR  NZ,FILE12
000AF6 4AF6 3251F1          13      LD  (FNAME),A   ;Parent directory(..)
000AF9 4AF9 3252F1          13      LD  (FNAME+1),A
000AFC 4AFC 3E20             7      LD  A,020H
       4AFE                     FILE12:
000AFE 4AFE FE2A             7      CP  '*'
000B00 4B00 280A            12      JR  Z,FILE10
000B02 4B02 77               7      LD  (HL),A
000B03 4B03 23               6      INC HL
000B04 4B04 10E8            13      DJNZ    FILE4L
000B06 4B06 C9              10      RET
                                
       4B07                     FILE9:              ;名前の*処理、名前の残りを?で埋める
000B07 4B07 CD0C4B          17      CALL    FILE10
000B0A 4B0A 18D5            12      JR  FILE3
                                
       4B0C                     FILE10:
000B0C 4B0C 3E3F             7      LD  A,'?'
000B0E 4B0E 1808            12      JR  FILL_MEMORY
       4B10                     FILEI:              ;名前＋拡張子をスペースで初期化
000B10 4B10 3E20             7      LD  A,020H
000B12 4B12 01000B          10      LD  BC,11*256   ;C=0にしておく
000B15 4B15 2151F1          10      LD  HL,FNAME
       4B18                     FILL_MEMORY:            ;HLからBバイトAで埋める
000B18 4B18 77               7      LD  (HL),A
000B19 4B19 23               6      INC HL
000B1A 4B1A 10FC            13      DJNZ    FILL_MEMORY
000B1C 4B1C C9              10      RET
                                
       4B1D                     CCHKF:
000B1D 4B1D 7B               4      LD  A,E
000B1E 4B1E B7               4      OR  A
000B1F 4B1F C8              11      RET Z
000B20 4B20 DD7E00          19      LD  A,(IX+0)
000B23 4B23 CD2A4B          17      CALL    CCHK2
000B26 4B26 C8              11      RET Z
000B27 4B27 C38D4B          10      JP  FKAN
                                
       4B2A                     CCHK2:
000B2A 4B2A 0C               4      INC C
000B2B 4B2B 0D               4      DEC C
000B2C 4B2C C0              11      RET NZ
       4B2D                     CCHK3:              ;ZF=1 で使えない文字
000B2D 4B2D FE2B             7      CP  '+'
000B2F 4B2F C8              11      RET Z
000B30 4B30 FE2C             7      CP  ','
000B32 4B32 C8              11      RET Z
000B33 4B33 FE2F             7      CP  '/'
000B35 4B35 C8              11      RET Z
000B36 4B36 FE3A             7      CP  ':'
000B38 4B38 C8              11      RET Z
000B39 4B39 FE3B             7      CP  ';'
000B3B 4B3B C8              11      RET Z
000B3C 4B3C FE3D             7      CP  '='
000B3E 4B3E C8              11      RET Z
000B3F 4B3F FE5C             7      CP  05CH    ;\
000B41 4B41 C8              11      RET Z
000B42 4B42 FE1F             7      CP  01FH
000B44 4B44 D0              11      RET NC
000B45 4B45 BF               4      CP  A       ;Z=1
000B46 4B46 C9              10      RET
                                
       4B47                     SS1:
000B47 4B47 13               6      INC DE
       4B48                     SPCUT:              ;スペースをカット
000B48 4B48 1A               7      LD  A,(DE)
000B49 4B49 FE20             7      CP  020H
000B4B 4B4B 28FA            12      JR  Z,SS1
000B4D 4B4D C9              10      RET
                                
       4B4E                     SCREOF1:
000B4E 4B4E 13               6      INC DE
       4B4F                     SPCUTEX:            ;スペース改行などをカット
000B4F 4B4F 1A               7      LD  A,(DE)
000B50 4B50 FE20             7      CP  020H
000B52 4B52 28FA            12      JR  Z,SCREOF1
000B54 4B54 FE0D             7      CP  00DH
000B56 4B56 28F6            12      JR  Z,SCREOF1
000B58 4B58 FE0A             7      CP  00AH
000B5A 4B5A 28F2            12      JR  Z,SCREOF1
000B5C 4B5C FE1A             7      CP  01AH
000B5E 4B5E 28EE            12      JR  Z,SCREOF1
000B60 4B60 C9              10      RET
                                
       4B61                     GETNUM:
000B61 4B61 210000          10      LD  HL,0
       4B64                     GETNUM1:
000B64 4B64 1A               7      LD  A,(DE)
000B65 4B65 13               6      INC DE
000B66 4B66 D630             7      SUB '0'
000B68 4B68 D8              11      RET C
000B69 4B69 FE0A             7      CP  10
000B6B 4B6B D0              11      RET NC
000B6C 4B6C 4D               4      LD  C,L
000B6D 4B6D 44               4      LD  B,H
000B6E 4B6E 29              11      ADD HL,HL   ;*2
000B6F 4B6F 29              11      ADD HL,HL   ;*4
000B70 4B70 09              11      ADD HL,BC   ;*5
000B71 4B71 29              11      ADD HL,HL   ;*10
000B72 4B72 4F               4      LD  C,A
000B73 4B73 0600             7      LD  B,0
000B75 4B75 09              11      ADD HL,BC
000B76 4B76 18EC            12      JR  GETNUM1
                                
       4B78                     SEARCH_END:
000B78 4B78 7E               7      LD  A,(HL)
       4B79                     SEARCH_END1:
000B79 4B79 23               6      INC HL
000B7A 4B7A B7               4      OR  A
000B7B 4B7B C8              11      RET Z
000B7C 4B7C FE3A             7      CP  ':'
000B7E 4B7E 20F8            12      JR  NZ,SEARCH_END
000B80 4B80 7E               7      LD  A,(HL)
000B81 4B81 FE3A             7      CP  ':'
000B83 4B83 28F4            12      JR  Z,SEARCH_END1
000B85 4B85 C9              10      RET
                                
       4B86                     FKANC:
000B86 4B86 CB41             8      BIT 0,C
000B88 4B88 CCAB4B          17      CALL    Z,CAP2
000B8B 4B8B 1803            12      JR  FKANX
       4B8D                     FKAN:           ;漢字チェック
000B8D 4B8D DD23            10      INC IX
000B8F 4B8F 1D               4      DEC E
       4B90                     FKANX:
000B90 4B90 CB41             8      BIT 0,C
000B92 4B92 CB81             8      RES 0,C
000B94 4B94 C0              11      RET NZ
000B95 4B95 FE80             7      CP  080H
000B97 4B97 D8              11      RET C
000B98 4B98 FEA0             7      CP  0A0H
000B9A 4B9A 3803            12      JR  C,FKAN1
000B9C 4B9C FEE0             7      CP  0E0H
000B9E 4B9E D8              11      RET C
       4B9F                     FKAN1:
000B9F 4B9F 0C               4      INC C
000BA0 4BA0 A7               4      AND A
000BA1 4BA1 C9              10      RET
                                
       4BA2                     CAP:
000BA2 4BA2 FE61             7      CP  'a'
000BA4 4BA4 D8              11      RET C
000BA5 4BA5 FE7B             7      CP  'z'+1
000BA7 4BA7 D0              11      RET NC
000BA8 4BA8 D620             7      SUB 020H
000BAA 4BAA C9              10      RET
       4BAB                     CAP2:
000BAB 4BAB CDA24B          17      CALL    CAP
       4BAE                     CAP3:               ;
000BAE 4BAE FE05             7      CP  5
000BB0 4BB0 2803            12      JR  Z,CAP4
000BB2 4BB2 FE21             7      CP  021H
000BB4 4BB4 C9              10      RET
       4BB5                     CAP4:
000BB5 4BB5 3EE5             7      LD  A,0E5H
000BB7 4BB7 C9              10      RET
                                
       4BB8                     ROM_OPEN:
000BB8 4BB8 CD6950          17      CALL    GET_DISK_BANK_FDRV
                                
000BBB 4BBB CD0A4E          17      CALL    GET_DIR_DAT
000BBE 4BBE D5              11      PUSH    DE
000BBF 4BBF CDD44B          17      CALL    FILESE
000BC2 4BC2 D1              10      POP DE
000BC3 4BC3 3F               4      CCF
000BC4 4BC4 D8              11      RET C
000BC5 4BC5 2247F1          16      LD  (DIRENT1),HL
000BC8 4BC8 E5              11      PUSH    HL
000BC9 4BC9 210000          10      LD  HL,0
000BCC 4BCC 2226F1          16      LD  (RR_LOW),HL
000BCF 4BCF 2228F1          16      LD  (RR_HIGH),HL
000BD2 4BD2 E1              10      POP HL
000BD3 4BD3 C9              10      RET
                                
       4BD4                     FILESE:
000BD4 4BD4 7E               7      LD  A,(HL)
000BD5 4BD5 B7               4      OR  A
000BD6 4BD6 C8              11      RET Z       ;END:ZF=1 CF=0
000BD7 4BD7 FEE5             7      CP  0E5H
000BD9 4BD9 280D            12      JR  Z,FILESE1
000BDB 4BDB 1151F1          10      LD  DE,FNAME
000BDE 4BDE E5              11      PUSH    HL
000BDF 4BDF CD0E4C          17      CALL    CPFILE
000BE2 4BE2 CC2F4C          17      CALL    Z,CPFILE2
000BE5 4BE5 E1              10      POP HL
000BE6 4BE6 37               4      SCF
000BE7 4BE7 C8              11      RET Z       ;!!!:(ZF=1) CF=1
       4BE8                     FILESE1:
000BE8 4BE8 CDF04B          17      CALL    FNEXT
000BEB 4BEB 20E7            12      JR  NZ,FILESE
000BED 4BED F6FF             7      OR  0FFH        ;ZF=0 CF=0
000BEF 4BEF C9              10      RET
                                
       4BF0                     FNEXT:
000BF0 4BF0 112000          10      LD  DE,020H
000BF3 4BF3 19              11      ADD HL,DE
000BF4 4BF4 ED5B5EF1        20      LD  DE,(_CDX)
000BF8 4BF8 7A               4      LD  A,D
000BF9 4BF9 B3               4      OR  E
000BFA 4BFA 2002            12      JR  NZ,FNEXT_SUBDIR
000BFC 4BFC 0D               4      DEC C
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                CHECK_DIR_PAGE:         ;ディレクトリが2ページ目に跨るかチェックする
                                    PUSH    AF      ;※フラグを保存する必要あり
                                    BIT 7,H
                                    JR  Z,CHECK_DIR_PAGE1
                                    LD  A,H
                                    SUB 020H
                                    LD  H,A
                                    LD  A,(_DIR_BANK)
                                    INC A
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_DIR_BANK),A
                                CHECK_DIR_PAGE1:
                                    POP AF
                                #endif
000BFD 4BFD C9              10      RET
                                
       4BFE                     FNEXT_SUBDIR:           ;サブディレクトリ
000BFE 4BFE 0D               4      DEC C
000BFF 4BFF C0              11      RET NZ
                                
000C00 4C00 ED5B5EF1        20      LD  DE,(_CDX)
000C04 4C04 CD2E4D          17      CALL    GNCL
000C07 4C07 EB               4      EX  DE,HL
000C08 4C08 225EF1          16      LD  (_CDX),HL
000C0B 4C0B C3424E          10      JP  GET_SUBDIR
                                
       4C0E                     CPFILE:
000C0E 4C0E C5              11      PUSH    BC
000C0F 4C0F 01000B          10      LD  BC,00B00H
       4C12                     CPSTR1:
000C12 4C12 1A               7      LD  A,(DE)
000C13 4C13 FE3F             7      CP  '?'     ;Wild card
000C15 4C15 2812            12      JR  Z,CPSTR2
000C17 4C17 7E               7      LD  A,(HL)
000C18 4C18 CD864B          17      CALL    FKANC
000C1B 4C1B E5              11      PUSH    HL
000C1C 4C1C 67               4      LD  H,A
000C1D 4C1D 1A               7      LD  A,(DE)
000C1E 4C1E CB01             4      RLC C
000C20 4C20 CD864B          17      CALL    FKANC
000C23 4C23 CB09             4      RRC C
000C25 4C25 BC               4      CP  H       ;CP (HL),(DE)
000C26 4C26 E1              10      POP HL
000C27 4C27 2004            12      JR  NZ,CPSTR3
       4C29                     CPSTR2:
000C29 4C29 13               6      INC DE
000C2A 4C2A 23               6      INC HL
000C2B 4C2B 10E5            13      DJNZ    CPSTR1
       4C2D                     CPSTR3:
000C2D 4C2D C1              10      POP BC
000C2E 4C2E C9              10      RET
                                
       4C2F                     CPFILE2:
                                ;   LD  A,0E1H
000C2F 4C2F 3EF1             7      LD  A,0F1H
000C31 4C31 2F               4      CPL
000C32 4C32 A6               7      AND (HL)
000C33 4C33 C9              10      RET
                                
       4C34                     RBX1:
000C34 4C34 E5              11      PUSH    HL      ;Record byte
                                
000C35 4C35 ED5B26F1        20      LD  DE,(RR_LOW) ;CDE=Random record
000C39 4C39 3A29F1          13      LD  A,(RR_HIGH+1)
000C3C 4C3C 4F               4      LD  C,A
                                
000C3D 4C3D 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
000C40 4C40 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C43 4C43 FD2A47F1        20      LD  IY,(DIRENT1)
000C47 4C47 FD6E1C          19      LD  L,(IY+01CH) ;AHL=File size
000C4A 4C4A FD661D          19      LD  H,(IY+01DH)
000C4D 4C4D FD7E1E          19      LD  A,(IY+01EH)
                                
000C50 4C50 A7               4      AND A
000C51 4C51 ED52            15      SBC HL,DE
000C53 4C53 99               4      SBC A,C
000C54 4C54 D1              10      POP DE
                                
000C55 4C55 D8              11      RET C
000C56 4C56 4F               4      LD  C,A
000C57 4C57 EB               4      EX  DE,HL   ;CDE=File byte  HL=Record byte
000C58 4C58 B2               4      OR  D
000C59 4C59 B3               4      OR  E
000C5A 4C5A C0              11      RET NZ
000C5B 4C5B 37               4      SCF
000C5C 4C5C C9              10      RET
                                
       4C5D                     RBX2:
000C5D 4C5D ED4B27F1        20      LD  BC,(RR_LOW+1)
000C61 4C61 CDE24C          17      CALL    RWXR
000C64 4C64 3A23F1          13      LD  A,(CLSZ_H)
000C67 4C67 3D               4      DEC A
000C68 4C68 E5              11      PUSH    HL
000C69 4C69 2A26F1          16      LD  HL,(RR_LOW)
000C6C 4C6C A4               4      AND H
000C6D 4C6D B5               4      OR  L
000C6E 4C6E E1              10      POP HL
000C6F 4C6F C9              10      RET
                                
       4C70                     RBXA:
000C70 4C70 D5              11      PUSH    DE
000C71 4C71 CD514D          17      CALL    CLUST
000C74 4C74 ED532EF1        20      LD  (_DTPS),DE
000C78 4C78 D1              10      POP DE
000C79 4C79 CD2E4D          17      CALL    GNCL
000C7C 4C7C D8              11      RET C
000C7D 4C7D ED532AF1        20      LD  (_CLPS),DE
                                
000C81 4C81 ED4B26F1        20      LD  BC,(RR_LOW)
000C85 4C85 2A22F1          16      LD  HL,(CLSZ)
000C88 4C88 7C               4      LD  A,H
000C89 4C89 3D               4      DEC A
000C8A 4C8A A0               4      AND B
000C8B 4C8B 47               4      LD  B,A
000C8C 4C8C ED42            15      SBC HL,BC       ;remaining cluster
                                
000C8E 4C8E ED5B4AF1        20      LD  DE,(LEFTX)
000C92 4C92 ED52            15      SBC HL,DE       ;CP HL,DE
000C94 4C94 19              11      ADD HL,DE
000C95 4C95 3801            12      JR  C,RBXA1
000C97 4C97 EB               4      EX  DE,HL
       4C98                     RBXA1:
000C98 4C98 3A20F1          13      LD  A,(_BANK)   ;GNCLでバンクを切り替えたのでデータのあるバンク
                                #if exists USE_NORMAL_32K_ROM
000C9B 4C9B 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000C9E 4C9E E5              11      PUSH    HL
000C9F 4C9F 2A2EF1          16      LD  HL,(_DTPS)
000CA2 4CA2 09              11      ADD HL,BC
000CA3 4CA3 ED5B43F1        20      LD  DE,(DTAX)
000CA7 4CA7 C1              10      POP BC
000CA8 4CA8 C9              10      RET
                                
       4CA9                     RBXB:
000CA9 4CA9 2A43F1          16      LD  HL,(DTAX)
000CAC 4CAC ED5B2AF1        20      LD  DE,(_CLPS)
000CB0 4CB0 3A4BF1          13      LD  A,(LEFTX+1)
000CB3 4CB3 47               4      LD  B,A
000CB4 4CB4 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CB7                     RBXB1:
000CB7 4CB7 1F               4      RRA     ;->CF
000CB8 4CB8 3804            12      JR  C,RBXB2
000CBA 4CBA CB38             8      SRL B   ;B=B/2
000CBC 4CBC 18F9            12      JR  RBXB1
       4CBE                     RBXB2:
000CBE 4CBE 78               4      LD  A,B
000CBF 4CBF B7               4      OR  A
000CC0 4CC0 C9              10      RET
                                
       4CC1                     RBXC:
000CC1 4CC1 ED4B4AF1        20      LD  BC,(LEFTX)
000CC5 4CC5 3A23F1          13      LD  A,(CLSZ_H)
000CC8 4CC8 3D               4      DEC A
000CC9 4CC9 A0               4      AND B
000CCA 4CCA 47               4      LD  B,A
000CCB 4CCB B1               4      OR  C
000CCC 4CCC C9              10      RET
                                
       4CCD                     RBXEND:
000CCD 4CCD ED5B2CF1        20      LD  DE,(_LEFT)
000CD1 4CD1 2A26F1          16      LD  HL,(RR_LOW)
000CD4 4CD4 3A29F1          13      LD  A,(RR_HIGH+1)
000CD7 4CD7 19              11      ADD HL,DE
000CD8 4CD8 CE00             7      ADC A,0
000CDA 4CDA 2226F1          16      LD  (RR_LOW),HL
000CDD 4CDD 3229F1          13      LD  (RR_HIGH+1),A
000CE0 4CE0 EB               4      EX  DE,HL       ;HL=Read byte
000CE1 4CE1 C9              10      RET 
                                
       4CE2                     RWXR:
000CE2 4CE2 3A23F1          13      LD  A,(CLSZ_H)  ;1024=4 / 512=2 / 256=1
       4CE5                     L_RWX:
000CE5 4CE5 1F               4      RRA     ;->CF
000CE6 4CE6 3806            12      JR  C,E_RWX
000CE8 4CE8 CB38             8      SRL B   ;BC=BC/2
000CEA 4CEA CB19             8      RR  C   ;
000CEC 4CEC 18F7            12      JR  L_RWX
       4CEE                     E_RWX:
000CEE 4CEE 3A49F1          13      LD  A,(_DIR_BANK)
                                #if exists USE_NORMAL_32K_ROM
000CF1 4CF1 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
000CF4 4CF4 FD2A47F1        20      LD  IY,(DIRENT1)
000CF8 4CF8 FD5E1A          19      LD  E,(IY+01AH) ;ファイルの先頭クラスタ
000CFB 4CFB FD561B          19      LD  D,(IY+01BH)
000CFE 4CFE CD6950          17      CALL    GET_DISK_BANK_FDRV
       4D01                     RWX1:
000D01 4D01 ED532AF1        20      LD  (_CLPS),DE
000D05 4D05 7A               4      LD  A,D
000D06 4D06 B3               4      OR  E
000D07 4D07 37               4      SCF
000D08 4D08 C8              11      RET Z
                                
000D09 4D09 78               4      LD  A,B
000D0A 4D0A B1               4      OR  C
000D0B 4D0B C8              11      RET Z
                                
000D0C 4D0C CD2E4D          17      CALL    GNCL
000D0F 4D0F D8              11      RET C
000D10 4D10 0B               6      DEC BC
000D11 4D11 CDA34D          17      CALL    ENDCL
000D14 4D14 38EB            12      JR  C,RWX1
000D16 4D16 37               4      SCF
000D17 4D17 C9              10      RET
                                
       4D18                     NCL3:
000D18 4D18 CD6950          17      CALL    GET_DISK_BANK_FDRV
000D1B 4D1B 6B               4      LD  L,E
000D1C 4D1C 62               4      LD  H,D
000D1D 4D1D CB3C             8      SRL H
000D1F 4D1F CB1D             8      RR  L
000D21 4D21 1F               4      RRA
000D22 4D22 19              11      ADD HL,DE
000D23 4D23 010060          10      LD  BC,BANK1_ADR
000D26 4D26 09              11      ADD HL,BC
000D27 4D27 ED4B24F1        20      LD  BC,(SECSZ)
000D2B 4D2B 09              11      ADD HL,BC
000D2C 4D2C 17               4      RLA
000D2D 4D2D C9              10      RET
                                
       4D2E                     GNCL:
000D2E 4D2E 7A               4      LD  A,D
000D2F 4D2F B3               4      OR  E
000D30 4D30 37               4      SCF
000D31 4D31 C8              11      RET Z
000D32 4D32 C5              11      PUSH    BC
000D33 4D33 E5              11      PUSH    HL
000D34 4D34 CD184D          17      CALL    NCL3
000D37 4D37 3809            12      JR  C,GNC1
000D39 4D39 5E               7      LD  E,(HL)
000D3A 4D3A 23               6      INC HL
000D3B 4D3B 7E               7      LD  A,(HL)
000D3C 4D3C E60F             7      AND 00FH
000D3E 4D3E 57               4      LD  D,A
000D3F 4D3F E1              10      POP HL
000D40 4D40 C1              10      POP BC
000D41 4D41 C9              10      RET
       4D42                     GNC1:
000D42 4D42 7E               7      LD  A,(HL)
000D43 4D43 23               6      INC HL
000D44 4D44 56               7      LD  D,(HL)
000D45 4D45 0604             7      LD  B,4
       4D47                     GNC1L:
000D47 4D47 CB3A             8      SRL D
000D49 4D49 1F               4      RRA
000D4A 4D4A 10FB            13      DJNZ    GNC1L
                                
000D4C 4D4C 5F               4      LD  E,A
000D4D 4D4D E1              10      POP HL
000D4E 4D4E C1              10      POP BC
000D4F 4D4F A7               4      AND A
000D50 4D50 C9              10      RET
                                
       4D51                     CLUST:
000D51 4D51 EB               4      EX  DE,HL
       4D52                     CLUST_HL:
000D52 4D52 C5              11      PUSH    BC
000D53 4D53 3A23F1          13      LD  A,(CLSZ_H)
000D56 4D56 CD9250          17      CALL    MUL_AHL
                                
000D59 4D59 CD244E          17      CALL    GET_DIR_POS
000D5C 4D5C 4F               4      LD  C,A
000D5D 4D5D 0600             7      LD  B,0
000D5F 4D5F 09              11      ADD HL,BC
                                
000D60 4D60 3A1260          13      LD  A,(BANK1_ADR+17+1)  ;BPB_RootEntCnt High
000D63 4D63 1F               4      RRA
000D64 4D64 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000D67 4D67 1F               4      RRA
000D68 4D68 0F               4      RRCA
000D69 4D69 0F               4      RRCA
000D6A 4D6A 0F               4      RRCA
000D6B 4D6B 4F               4      LD  C,A
                                
000D6C 4D6C 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000D6F 4D6F FE02             7      CP  2
000D71 4D71 280C            12      JR  Z,CLUST1
000D73 4D73 CB01             4      RLC C
000D75 4D75 0D               4      DEC C
000D76 4D76 3A0C60          13      LD  A,(BANK1_ADR+11+1)  ;BPB_BytsPerSec High    
000D79 4D79 FE02             7      CP  2
000D7B 4D7B 2002            12      JR  NZ,CLUST1
000D7D 4D7D 0D               4      DEC C
000D7E 4D7E 0D               4      DEC C
       4D7F                     CLUST1:
000D7F 4D7F 0D               4      DEC C
000D80 4D80 09              11      ADD HL,BC
                                
                                #if exists USE_NORMAL_32K_ROM
000D81 4D81 7D               4      LD  A,L
000D82 4D82 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000D85 4D85 09              11      ADD HL,BC
000D86 4D86 3013            12      JR  NC,CLUST2
000D88 4D88 4D               4      LD  C,L     ;C=読み出し元
000D89 4D89 29              11      ADD HL,HL   ;64KB→32KB
000D8A 4D8A 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000D8B 4D8B CD6950          17      CALL    GET_DISK_BANK_FDRV
000D8E 4D8E 84               4      ADD A,H
000D8F 4D8F 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000D92 4D92 3220F1          13      LD  (_BANK),A
000D95 4D95 69               4      LD  L,C     ;C=読み出し元
000D96 4D96 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000D98 4D98 A5               4      AND L
000D99 4D99 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL   ;64KB→32KB
                                    ADD HL,HL   ;32KB→16KB
                                    ADD HL,HL   ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    CALL    GET_DISK_BANK_FDRV
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  L,C     ;C=読み出し元
                                    LD  A,01FH          ;セグメントのサイズでフィルタする(8K:1F)
                                    AND L
                                #endif
       4D9B                     CLUST2:
000D9B 4D9B C660             7      ADD A,high BANK1_ADR
000D9D 4D9D 67               4      LD  H,A
000D9E 4D9E 2E00             7      LD  L,0
000DA0 4DA0 EB               4      EX  DE,HL
000DA1 4DA1 C1              10      POP BC
000DA2 4DA2 C9              10      RET
                                
       4DA3                     ENDCL:
000DA3 4DA3 7A               4      LD  A,D ;END CLUSTER
000DA4 4DA4 FE0F             7      CP  00FH    ;FAT12の最大値
000DA6 4DA6 C0              11      RET NZ
000DA7 4DA7 7B               4      LD  A,E
000DA8 4DA8 FEF7             7      CP  0F7H
000DAA 4DAA C9              10      RET
                                
       4DAB                     RB_READ:
000DAB 4DAB AF               4      XOR A   ;HLA = HL*128
000DAC 4DAC CB3C             8      SRL H
000DAE 4DAE CB1D             8      RR  L
000DB0 4DB0 1F               4      RRA
000DB1 4DB1 3226F1          13      LD  (RR_LOW),A
000DB4 4DB4 2227F1          16      LD  (RR_MID),HL
000DB7 4DB7 218000          10      LD  HL,128
                                
000DBA 4DBA CD9D49          17      CALL    ROM_READ
000DBD 4DBD C9              10      RET
                                
       4DBE                     GETSEQ:
000DBE 4DBE FD6E20          19      LD  L,(IY+32)
000DC1 4DC1 FD660C          19      LD  H,(IY+12)
                                
000DC4 4DC4 CB25             8      SLA L
                                
000DC6 4DC6 CB3C             8      SRL H
000DC8 4DC8 CB1D             8      RR  L
000DCA 4DCA C9              10      RET
                                
       4DCB                     SETSEQ:
000DCB 4DCB F5              11      PUSH    AF
000DCC 4DCC 3A26F1          13      LD  A,(RR_LOW)
000DCF 4DCF 2A27F1          16      LD  HL,(RR_MID)
                                
000DD2 4DD2 CDE94D          17      CALL    SSQ1
                                
000DD5 4DD5 29              11      ADD HL,HL
000DD6 4DD6 CB3D             8      SRL L
000DD8 4DD8 FD7520          19      LD  (IY+32),L
000DDB 4DDB FD740C          19      LD  (IY+12),H
000DDE 4DDE F1              10      POP AF
000DDF 4DDF C9              10      RET
                                
       4DE0                     GETSIZE:
000DE0 4DE0 FD7E10          19      LD  A,(IY+16)
000DE3 4DE3 FD6E11          19      LD  L,(IY+17)
000DE6 4DE6 FD6612          19      LD  H,(IY+18)
       4DE9                     SSQ1:
000DE9 4DE9 87               4      ADD A,A
000DEA 4DEA ED6A            15      ADC HL,HL
000DEC 4DEC B7               4      OR  A
000DED 4DED C8              11      RET Z
000DEE 4DEE 23               6      INC HL
000DEF 4DEF C9              10      RET
                                
       4DF0                     SET_FCB:
000DF0 4DF0 D5              11      PUSH    DE
000DF1 4DF1 FDE1            14      POP IY
000DF3 4DF3 FD7E1C          19      LD  A,(IY+28)
000DF6 4DF6 FEFF             7      CP  0FFH
000DF8 4DF8 200C            12      JR  NZ,POPAF_SCF_FF_RET
000DFA 4DFA E5              11      PUSH    HL
000DFB 4DFB FD6E1A          19      LD  L,(IY+26)
000DFE 4DFE FD661B          19      LD  H,(IY+27)
000E01 4E01 222AF1          16      LD  (_CLPS),HL
000E04 4E04 E1              10      POP HL
000E05 4E05 C9              10      RET
                                
       4E06                     POPAF_SCF_FF_RET:
000E06 4E06 F1              10      POP AF
000E07 4E07 37               4      SCF
000E08 4E08 9F               4      SBC A,A
000E09 4E09 C9              10      RET
                                
       4E0A                     GET_DIR_DAT:
000E0A 4E0A 2A5EF1          16      LD  HL,(_CDX)
000E0D 4E0D 7C               4      LD  A,H
000E0E 4E0E B5               4      OR  L
000E0F 4E0F 2031            12      JR  NZ,GET_SUBDIR
000E11 4E11 CD244E          17      CALL    GET_DIR_POS
000E14 4E14 C660             7      ADD A,high BANK1_ADR
000E16 4E16 2E00             7      LD  L,0
000E18 4E18 67               4      LD  H,A         ;HL=BANK1_ADR+(BPB_RsvdSecCnt+BPB_FATSz16*BPB_NumFATs)*BPB_BytsPerSec
                                #if exists USE_NORMAL_32K_ROM
                                #else
                                    CALL    CHECK_DIR_PAGE
                                #endif
000E19 4E19 3A21F1          13      LD  A,(_BANK1)
000E1C 4E1C 3249F1          13      LD  (_DIR_BANK),A
                                
000E1F 4E1F 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt
000E22 4E22 4F               4      LD  C,A
000E23 4E23 C9              10      RET
                                
       4E24                     GET_DIR_POS:                ;ルートディレクトリ
000E24 4E24 CD6950          17      CALL    GET_DISK_BANK_FDRV
000E27 4E27 3221F1          13      LD  (_BANK1),A
000E2A 4E2A 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs
000E2D 4E2D 47               4      LD  B,A
000E2E 4E2E 3A1660          13      LD  A,(BANK1_ADR+22)    ;BPB_FATSz16
000E31 4E31 4F               4      LD  C,A
000E32 4E32 3A0E60          13      LD  A,(BANK1_ADR+14)    ;BPB_RsvdSecCnt
       4E35                     GET_DIR_POS1:
000E35 4E35 81               4      ADD A,C
000E36 4E36 10FD            13      DJNZ    GET_DIR_POS1
                                
000E38 4E38 ED4B0B60        20      LD  BC,(BANK1_ADR+11)   ;BPB_BytsPerSec 
       4E3C                     L_MDP:
000E3C 4E3C CB18             8      RR  B   ;->CF
000E3E 4E3E D8              11      RET C
000E3F 4E3F 87               4      ADD A,A
000E40 4E40 18FA            12      JR  L_MDP
                                
       4E42                     GET_SUBDIR:             ;サブディレクトリ
000E42 4E42 CD524D          17      CALL    CLUST_HL
000E45 4E45 EB               4      EX  DE,HL
000E46 4E46 3A20F1          13      LD  A,(_BANK)
000E49 4E49 3249F1          13      LD  (_DIR_BANK),A
000E4C 4E4C 3A23F1          13      LD  A,(CLSZ_H)
000E4F 4E4F 87               4      ADD A,A     ;*2
000E50 4E50 87               4      ADD A,A     ;*4
000E51 4E51 87               4      ADD A,A     ;*8
000E52 4E52 4F               4      LD  C,A
000E53 4E53 C9              10      RET
                                
       4E54                     STATEMENT:
000E54 4E54 1189FD          10      LD  DE,PROCNM
000E57 4E57 1A               7      LD  A,(DE)
000E58 4E58 FE43             7      CP  'C'
000E5A 4E5A 37               4      SCF
000E5B 4E5B C0              11      RET NZ
000E5C 4E5C 13               6      INC DE
000E5D 4E5D 1A               7      LD  A,(DE)
000E5E 4E5E FE48             7      CP  'H'
000E60 4E60 37               4      SCF
000E61 4E61 C0              11      RET NZ
000E62 4E62 13               6      INC DE
000E63 4E63 1A               7      LD  A,(DE)
000E64 4E64 FE44             7      CP  'D'
000E66 4E66 37               4      SCF
000E67 4E67 C0              11      RET NZ
000E68 4E68 13               6      INC DE
000E69 4E69 1A               7      LD  A,(DE)
000E6A 4E6A FE49             7      CP  'I'
000E6C 4E6C 37               4      SCF
000E6D 4E6D C0              11      RET NZ
000E6E 4E6E 13               6      INC DE
000E6F 4E6F 1A               7      LD  A,(DE)
000E70 4E70 FE52             7      CP  'R'
000E72 4E72 37               4      SCF
000E73 4E73 C0              11      RET NZ
000E74 4E74 13               6      INC DE
000E75 4E75 1A               7      LD  A,(DE)
000E76 4E76 C6FF             7      ADD A,0FFH
000E78 4E78 D8              11      RET C
000E79 4E79 7E               7      LD  A,(HL)
000E7A 4E7A FE28             7      CP  '('
000E7C 4E7C 37               4      SCF
000E7D 4E7D C0              11      RET NZ
000E7E 4E7E CD4C47          17      CALL    INIT_PARAM
000E81 4E81 CD3D4A          17      CALL    FILE_B
000E84 4E84 CD8B4E          17      CALL    ROM_CD
000E87 4E87 DA1846          10      JP  C,ERROR_FILE_NOT_FOUND
000E8A 4E8A C9              10      RET
                                
       4E8B                     ROM_CD:
000E8B 4E8B 3A51F1          13      LD  A,(FNAME)
000E8E 4E8E FE20             7      CP  020H
000E90 4E90 2822            12      JR  Z,CD1
000E92 4E92 CDB84B          17      CALL    ROM_OPEN
000E95 4E95 D8              11      RET C
000E96 4E96 FD2A47F1        20      LD  IY,(DIRENT1)
000E9A 4E9A FDCB0B66        20      BIT 4,(IY+00BH) ;属性(アトリビュート) ディレクトリ
000E9E 4E9E CA1846          10      JP  Z,ERROR_FILE_NOT_FOUND
000EA1 4EA1 FD6E1A          19      LD  L,(IY+01AH) ;ファイルの先頭クラスタ
000EA4 4EA4 FD661B          19      LD  H,(IY+01BH)
       4EA7                     CD2:
000EA7 4EA7 225CF1          16      LD  (_CD),HL
000EAA 4EAA 2A4EF1          16      LD  HL,(PARAM1)
       4EAD                     CD_SKIP:
000EAD 4EAD 7E               7      LD  A,(HL)
000EAE 4EAE 23               6      INC HL
000EAF 4EAF FE21             7      CP  021H
000EB1 4EB1 38FA            12      JR  C,CD_SKIP
000EB3 4EB3 C9              10      RET
       4EB4                     CD1:
000EB4 4EB4 2A5EF1          16      LD  HL,(_CDX)
000EB7 4EB7 18EE            12      JR  CD2
                                
       4EB9                     ERROR_ST:
000EB9 4EB9 C9              10      RET
                                
       4EBA                     WILDCARD:
000EBA 4EBA 3F3F3F3F3F3F3F3F        DB  "???????????"
            3F3F3F              
[EOF:FILE.ASM:UTF_8]
                                    INCLUDE "DISK.ASM"
                                
                                ;   Tablacus DISK ROM - DISK
                                
                                ;   ROM DISK DRIVER
                                ;   1セクタ512
                                
       4EC5                     ERROR_WRITE_PROTECTED:
000EC5 4EC5 3E00             7      LD  A,0     ;Write protected
000EC7 4EC7 C9              10      RET
       4EC8                     DISKIO:
000EC8 4EC8 38FB            12      JR  C,ERROR_WRITE_PROTECTED
000ECA 4ECA 48               4      LD  C,B
000ECB 4ECB CD7350          17      CALL    GET_DISK_BANK
       4ECE                     SETMAP1:        
000ECE 4ECE E5              11      PUSH    HL
       4ECF                     DISKIO1:
000ECF 4ECF C5              11      PUSH    BC      ;B=残りのセクタ数
000ED0 4ED0 D5              11      PUSH    DE      ;DE=セクタ番号
000ED1 4ED1 F5              11      PUSH    AF      ;A=8KB単位でカートリッジ内のディスクが存在する位置を指定
                                
000ED2 4ED2 EB               4      EX  DE,HL       ;DE=受け取る読み出し先のメモリアドレス HL=セクタ番号
000ED3 4ED3 F5              11      PUSH    AF
000ED4 4ED4 3A25F1          13      LD  A,(SECSZ_H)
000ED7 4ED7 CD9250          17      CALL    MUL_AHL
000EDA 4EDA F1              10      POP AF
                                #if exists USE_NORMAL_32K_ROM
000EDB 4EDB 7D               4      LD  A,L
000EDC 4EDC C5              11      PUSH    BC
000EDD 4EDD 01E0FF          10      LD  BC,-00020H  ;先頭の8KB部分
000EE0 4EE0 09              11      ADD HL,BC
000EE1 4EE1 C1              10      POP BC
000EE2 4EE2 3013            12      JR  NC,DISKIO2
000EE4 4EE4 4D               4      LD  C,L     ;C=読み出し元
000EE5 4EE5 29              11      ADD HL,HL   ;64KB→32KB
000EE6 4EE6 29              11      ADD HL,HL   ;32KB→16KB バンク切り替えのサイズに合わせる
000EE7 4EE7 CD6950          17      CALL    GET_DISK_BANK_FDRV
000EEA 4EEA 84               4      ADD A,H
000EEB 4EEB 320070          13      LD  (ASCII16_BANK1_SEL),A   ;ASCII-16K
000EEE 4EEE 3220F1          13      LD  (_BANK),A
000EF1 4EF1 69               4      LD  L,C     ;C=読み出し元
000EF2 4EF2 3E3F             7      LD  A,03FH      ;セグメントのサイズでフィルタする(16K:3F)
000EF4 4EF4 A5               4      AND L
000EF5 4EF5 C620             7      ADD A,020H
                                #else
                                    LD  C,L     ;C=読み出し元
                                    ADD HL,HL       ;64KB→32KB
                                    ADD HL,HL       ;32KB→16KB
                                    ADD HL,HL       ;16KB→8KB  バンク切り替えのサイズに合わせる
                                    ADD A,H
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                    LD  (_BANK),A
                                    LD  A,C     ;C=読み出し元
                                    AND 01FH        ;セグメントのサイズでフィルタする(8K:1F)
                                #endif
       4EF7                     DISKIO2:
000EF7 4EF7 C660             7      ADD A,high BANK1_ADR
000EF9 4EF9 67               4      LD  H,A
000EFA 4EFA ED4B24F1        20      LD  BC,(SECSZ)  ;BCは読み出すセクタサイズ
000EFE 4EFE 69               4      LD  L,C     ;C=0
000EFF 4EFF CD3744          17      CALL    ROM_LDIR
000F02 4F02 EB               4      EX  DE,HL
000F03 4F03 F1              10      POP AF
000F04 4F04 D1              10      POP DE
000F05 4F05 13               6      INC DE
000F06 4F06 C1              10      POP BC
000F07 4F07 10C6            13      DJNZ    DISKIO1
000F09 4F09 41               4      LD  B,C
                                
000F0A 4F0A E1              10      POP HL
000F0B 4F0B AF               4      XOR A
                                
000F0C 4F0C FB               4      EI
000F0D 4F0D C9              10      RET
                                
       4F0E                     DSKCHG:
000F0E 4F0E CD474F          17      CALL    IS_BPB
000F11 4F11 3824            12      JR  C,NOTREADY
000F13 4F13 3A23FB          13      LD  A,(DRVTBL+2)
000F16 4F16 B7               4      OR  A
000F17 4F17 201A            12      JR  NZ,DSKCHG1
000F19 4F19 3A21FB          13      LD  A,(DRVTBL)
000F1C 4F1C FE02             7      CP  2
000F1E 4F1E 2013            12      JR  NZ,DSKCHG1
000F20 4F20 CD474F          17      CALL    IS_BPB
000F23 4F23 300E            12      JR  NC,DSKCHG1
000F25 4F25 3E01             7      LD  A,1         ;ドライブテーブルを拡張 A:Tablacus DISK ROM B:MASTER SLOT ROM
000F27 4F27 3221FB          13      LD  (DRVTBL),A
000F2A 4F2A 3223FB          13      LD  (DRVTBL+2),A
000F2D 4F2D 3A48F3          13      LD  A,(MASTERS)
000F30 4F30 3224FB          13      LD  (DRVTBL+3),A
       4F33                     DSKCHG1:
000F33 4F33 AF               4      XOR A
000F34 4F34 0601             7      LD  B,1
000F36 4F36 C9              10      RET
       4F37                     NOTREADY:
000F37 4F37 3E02             7      LD  A,2
000F39 4F39 37               4      SCF
000F3A 4F3A C9              10      RET
                                
       4F3B                     NO_BPB:
000F3B 4F3B E1              10      POP HL
000F3C 4F3C 23               6      INC HL
000F3D 4F3D 119850          10      LD  DE,DPB2DD
000F40 4F40 011200          10      LD  BC,DPB2DD_E-DPB2DD
000F43 4F43 EDB0                    LDIR
000F45 4F45 AF               4      XOR A
000F46 4F46 C9              10      RET
                                
       4F47                     IS_BPB:
                                ; in
                                ; A=DRIVE 0:A 1:B
                                ; out
                                ; CF=0ディスクは存在する CF=1 ディスクは存在しない
000F47 4F47 CD7350          17      CALL    GET_DISK_BANK
                                
000F4A 4F4A 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media
000F4D 4F4D FE01             7      CP  1
000F4F 4F4F D8              11      RET C
                                
000F50 4F50 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec
000F53 4F53 C6FF             7      ADD A,0FFH
000F55 4F55 D8              11      RET C
                                
000F56 4F56 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec
000F59 4F59 FE01             7      CP  1
000F5B 4F5B C8              11      RET Z
000F5C 4F5C FE02             7      CP  2
000F5E 4F5E C8              11      RET Z
000F5F 4F5F FE04             7      CP  4
000F61 4F61 C8              11      RET Z
000F62 4F62 37               4      SCF
000F63 4F63 C9              10      RET
                                
       4F64                     GETDPB:
000F64 4F64 E5              11      PUSH    HL
000F65 4F65 CD7350          17      CALL    GET_DISK_BANK
                                
000F68 4F68 3A1560          13      LD  A,(BANK1_ADR+21)    ;BPB_Media  
000F6B 4F6B B7               4      OR  A
000F6C 4F6C 28CD            12      JR  Z,NO_BPB
000F6E 4F6E DDE1            14      POP IX
000F70 4F70 DD7701          19      LD  (IX+1),A        ;MEDIA
                                
000F73 4F73 3A0B60          13      LD  A,(BANK1_ADR+11)    ;BPB_BytsPerSec 
000F76 4F76 DD7702          19      LD  (IX+2),A        ;SECSIZ LOW
                                
000F79 4F79 3A0C60          13      LD  A,(BANK1_ADR+12)    ;BPB_BytsPerSec 
000F7C 4F7C DD7703          19      LD  (IX+3),A        ;SECSIZ HIGH
                                
000F7F 4F7F 87               4      ADD A,A
000F80 4F80 87               4      ADD A,A
000F81 4F81 87               4      ADD A,A
000F82 4F82 3D               4      DEC A
000F83 4F83 DD7704          19      LD  (IX+4),A        ;DIRMSK
                                
000F86 4F86 06FF             7      LD  B,-1
000F88 4F88 A7               4      AND A           ;無限ループ阻止
       4F89                     GETDPB1:
000F89 4F89 04               4      INC B
000F8A 4F8A 1F               4      RRA
000F8B 4F8B 38FC            12      JR  C,GETDPB1
000F8D 4F8D DD7005          19      LD  (IX+5),B        ;DIRSHFT
                                
000F90 4F90 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
000F93 4F93 3D               4      DEC A
000F94 4F94 DD7706          19      LD  (IX+6),A        ;CLUSMSK
                                
000F97 4F97 A7               4      AND A           ;無限ループ阻止
000F98 4F98 06FF             7      LD  B,-1
       4F9A                     GETDPB2:
000F9A 4F9A 04               4      INC B
000F9B 4F9B 1F               4      RRA
000F9C 4F9C 38FC            12      JR  C,GETDPB2
000F9E 4F9E 04               4      INC B
000F9F 4F9F DD7007          19      LD  (IX+7),B        ;CLUSSHFT
                                
000FA2 4FA2 2A0E60          16      LD  HL,(BANK1_ADR+14)   ;BPB_RsvdSecCnt 
000FA5 4FA5 DD7508          19      LD  (IX+8),L        ;FIRFAT LOW
000FA8 4FA8 DD7409          19      LD  (IX+9),H        ;FIRFAT HIGH
                                
000FAB 4FAB 3A1060          13      LD  A,(BANK1_ADR+16)    ;BPB_NumFATs    
000FAE 4FAE DD770A          19      LD  (IX+10),A       ;FATCNT
                                
000FB1 4FB1 3A1160          13      LD  A,(BANK1_ADR+17)    ;BPB_RootEntCnt 
000FB4 4FB4 DD770B          19      LD  (IX+11),A       ;MAXENT
                                
000FB7 4FB7 ED5B1660        20      LD  DE,(BANK1_ADR+22)   ;BPB_FATSz16    
000FBB 4FBB DD7310          19      LD  (IX+16),E       ;FATSIZ
                                
000FBE 4FBE DD460A          19      LD  B,(IX+10)       ;FATCNT
000FC1 4FC1 210000          10      LD  HL,0
       4FC4                     GETDPB3:
000FC4 4FC4 19              11      ADD HL,DE
000FC5 4FC5 10FD            13      DJNZ    GETDPB3
       4FC7                     GETDPB4:
000FC7 4FC7 DD5E08          19      LD  E,(IX+8)        ;FIRFAT
000FCA 4FCA DD5609          19      LD  D,(IX+9)        ;FIRFAT
000FCD 4FCD 19              11      ADD HL,DE
000FCE 4FCE DD7511          19      LD  (IX+17),L       ;FIRDIR
000FD1 4FD1 DD7412          19      LD  (IX+18),H       ;FIRDIR
                                
000FD4 4FD4 DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
000FD7 4FD7 87               4      ADD A,A
000FD8 4FD8 87               4      ADD A,A
000FD9 4FD9 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       4FDC                     GETDPB5:
000FDC 4FDC CB3B             8      SRL E
000FDE 4FDE 1F               4      RRA
000FDF 4FDF 30FB            12      JR  NC,GETDPB5
000FE1 4FE1 1600             7      LD  D,0
000FE3 4FE3 19              11      ADD HL,DE
000FE4 4FE4 DD750C          19      LD  (IX+12),L       ;FIRREC
000FE7 4FE7 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
000FEA 4FEA 2A1360          16      LD  HL,(BANK1_ADR+19)   ;BPB_TotSec16   
                                
000FED 4FED DD5E0C          19      LD  E,(IX+12)       ;FIRREC
000FF0 4FF0 DD560D          19      LD  D,(IX+13)       ;FIRREC
000FF3 4FF3 A7               4      AND A
000FF4 4FF4 ED52            15      SBC HL,DE
                                
000FF6 4FF6 DD7E06          19      LD  A,(IX+6)        ;CLUSMSK
000FF9 4FF9 3C               4      INC A
000FFA 4FFA 37               4      SCF             ;無限ループ阻止
       4FFB                     GETDPB6:
000FFB 4FFB 1F               4      RRA
000FFC 4FFC 3806            12      JR  C,GETDPB7
000FFE 4FFE CB3C             8      SRL H
001000 5000 CB1D             8      RR  L
001002 5002 18F7            12      JR  GETDPB6
       5004                     GETDPB7:
001004 5004 23               6      INC HL
001005 5005 DD750E          19      LD  (IX+14),L       ;MAXCLUS
001008 5008 DD740F          19      LD  (IX+15),H       ;MAXCLUS
                                
                                    ;1セクタが512バイト以上の場合を考慮(2HD/1セクタ1024バイト/1.23MB等)
       500B                     GETDPBD1:
00100B 500B DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
00100E 500E E6FC             7      AND 0FCH
001010 5010 C8              11      RET Z
                                
001011 5011 DDCB033E        23      SRL (IX+3)          ;SECSIZ HIGH
                                
001015 5015 37               4      SCF
001016 5016 DDCB0616        23      RL  (IX+6)          ;CLUSMSK
                                
00101A 501A DD3407          23      INC (IX+7)          ;CLUSSHFT
                                
00101D 501D DDCB0826        23      SLA (IX+8)          ;FIRFAT LOW
001021 5021 DDCB0916        23      RL  (IX+9)          ;FIRFAT HIGH
                                
001025 5025 DDCB0E25        23      SLA (IX+14),L       ;MAXCLUS
001029 5029 DDCB0F14        23      RL  (IX+15),H       ;MAXCLUS
                                
00102D 502D DDCB1026        23      SLA (IX+16)         ;FATSIZ
                                
001031 5031 DDCB1126        23      SLA (IX+17)         ;FIRDIR
001035 5035 DDCB1216        23      RL  (IX+18)         ;FIRDIR
                                
001039 5039 DD6E11          19      LD  L,(IX+17)       ;FIRDIR
00103C 503C DD6612          19      LD  H,(IX+18)       ;FIRDIR
                                
00103F 503F DD7E03          19      LD  A,(IX+3)        ;SECSIZ HIGH
001042 5042 87               4      ADD A,A
001043 5043 87               4      ADD A,A
001044 5044 DD5E0B          19      LD  E,(IX+11)       ;MAXENT
       5047                     GETDPBD5:
001047 5047 CB3B             8      SRL E
001049 5049 1F               4      RRA
00104A 504A 30FB            12      JR  NC,GETDPBD5
00104C 504C 1600             7      LD  D,0
00104E 504E 19              11      ADD HL,DE
00104F 504F DD750C          19      LD  (IX+12),L       ;FIRREC
001052 5052 DD740D          19      LD  (IX+13),H       ;FIRREC
                                
001055 5055 18B4            12      JR  GETDPBD1
                                
       5057                     CHOICE:
001057 5057 210000          10      LD  HL,0
00105A 505A C9              10      RET
                                
       505B                     DSKFMT:
00105B 505B AF               4      XOR A
00105C 505C 37               4      SCF
       505D                     DSKSTP:
00105D 505D C9              10      RET
                                
       505E                     BASENT:
00105E 505E ED7B60F1        20      LD  SP,(BASSTK)
001062 5062 C3D443          10      JP  BASAUTO
                                
       5065                     GETSLT:
001065 5065 3A22FB          13      LD  A,(DRVTBL+1)
001068 5068 C9              10      RET
                                
       5069                     GET_DISK_BANK_FDRV:
001069 5069 3A50F1          13      LD  A,(FDRV)
00106C 506C D601             7      SUB 1
00106E 506E 3003            12      JR  NC,GET_DISK_BANK
001070 5070 3A46F1          13      LD  A,(_DVSW)
       5073                     GET_DISK_BANK:
001073 5073 B7               4      OR  A       ;A=DRIVE
001074 5074 3E01             7      LD  A,DISK_BANK
001076 5076 2803            12      JR  Z,SET_DISK_BANK
                                #if exists FIX_DRIVE
                                    LD  A,FIX_DRIVE
                                #else
001078 5078 3A45F1          13      LD  A,(B_DRIVE)
                                #endif
       507B                     SET_DISK_BANK:
                                #if exists USE_NORMAL_32K_ROM
00107B 507B 320070          13      LD  (ASCII16_BANK1_SEL),A       ;ASCII-16K
                                #else
                                    LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
                                    LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
                                #endif
00107E 507E F5              11      PUSH    AF
00107F 507F E5              11      PUSH    HL
001080 5080 2A0B60          16      LD  HL,(BANK1_ADR+11)   ;BPB_BytsPerSec 
001083 5083 2224F1          16      LD  (SECSZ),HL
001086 5086 3A0D60          13      LD  A,(BANK1_ADR+13)    ;BPB_SecPerClus
001089 5089 CD9250          17      CALL    MUL_AHL
00108C 508C 2222F1          16      LD  (CLSZ),HL
00108F 508F E1              10      POP HL
001090 5090 F1              10      POP AF
001091 5091 C9              10      RET
                                
                                ;   HL = HL * A ただし、A=1,2,4,8,16,32,64,128(2のべき乗に限る)0の場合は256倍
       5092                     MUL_AHL:
001092 5092 37               4      SCF     ;無限ループ回避
       5093                     MUL_AHL1:
001093 5093 1F               4      RRA     ;->CF
001094 5094 D8              11      RET C
001095 5095 29              11      ADD HL,HL
001096 5096 18FB            12      JR  MUL_AHL1
                                
       5098                     DPB2DD:
001098 5098 F9                      DB  0F9H    ;MEDIA
001099 5099 0002                    DW  00200H  ;SECSIZ
00109B 509B 0F                      DB  00FH    ;DIRMSK
00109C 509C 04                      DB  004H    ;DIRSHFT
00109D 509D 01                      DB  001H    ;CLUSMSK
00109E 509E 02                      DB  002H    ;CLUSSHFT
00109F 509F 0100                    DW  00001H  ;FIRFAT
0010A1 50A1 02                      DB  002H    ;FATCNT
0010A2 50A2 70                      DB  070H    ;MAXENT
0010A3 50A3 0E00                    DW  0000EH  ;FIRREC
0010A5 50A5 CA02                    DW  002CAH  ;MAXCLUS
0010A7 50A7 03                      DB  003H    ;FATSIZ
0010A8 50A8 0700                    DW  0007H   ;FIRDIR
       50AA                     DPB2DD_E:
                                
[EOF:DISK.ASM:UTF_8]
                                    INCLUDE "BDOS.ASM"
       50AA                     POP_HL_ERROR:
0010AA 50AA E1              10      POP     HL
       50AB                     _ERROR:
0010AB 50AB 0600             7      LD  B,0
0010AD 50AD A7               4      AND A
0010AE 50AE C9              10      RET
                                
       50AF                     ROM_BDOS:
0010AF 50AF E5              11      PUSH    HL
0010B0 50B0 79               4      LD  A,C
0010B1 50B1 87               4      ADD A,A
0010B2 50B2 38F7            12      JR  C,_ERROR
0010B4 50B4 6F               4      LD  L,A
0010B5 50B5 265F             7      LD  H,high STABLE
0010B7 50B7 7E               7      LD  A,(HL)
0010B8 50B8 2C               4      INC L
0010B9 50B9 66               7      LD  H,(HL)
0010BA 50BA 6F               4      LD  L,A
0010BB 50BB E3              19      EX  (SP),HL
0010BC 50BC 79               4      LD  A,C
0010BD 50BD C9              10      RET
                                
       50BE                     _PRINT:
       50BE                     PRINT:
0010BE 50BE 7B               4      LD  A,E
0010BF 50BF 1803            12      JR  MSG_A
                                
       50C1                     _SYS01:     ;(BDOS)コンソール入力
0010C1 50C1 CD3851          17      CALL    _SYS07
       50C4                     MSG_A:
0010C4 50C4 FE03             7      CP  3
0010C6 50C6 2814            12      JR  Z,MSG_BR
       50C8                     MSGA1:
0010C8 50C8 F5              11      PUSH    AF
0010C9 50C9 C5              11      PUSH    BC
0010CA 50CA D5              11      PUSH    DE
0010CB 50CB E5              11      PUSH    HL
0010CC 50CC DDE5            15      PUSH    IX
0010CE 50CE DD21A200        14      LD  IX,CHPUT
0010D2 50D2 CDFA42          17      CALL    CALSLT_R
0010D5 50D5 DDE1            14      POP IX
0010D7 50D7 E1              10      POP HL
0010D8 50D8 D1              10      POP DE
0010D9 50D9 C1              10      POP BC
       50DA                     MSGA2:
0010DA 50DA F1              10      POP AF
0010DB 50DB C9              10      RET
       50DC                     MSG_BR:
0010DC 50DC F5              11      PUSH    AF
0010DD 50DD 3ADDF3          13      LD  A,(CSRX)
0010E0 50E0 FE02             7      CP  2
0010E2 50E2 38F6            12      JR  C,MSGA2
0010E4 50E4 F1              10      POP AF
       50E5                     MSG_CR:
0010E5 50E5 F5              11      PUSH    AF
0010E6 50E6 3E0D             7      LD  A,00DH
0010E8 50E8 CDC850          17      CALL    MSGA1
0010EB 50EB 3E0A             7      LD  A,00AH
0010ED 50ED CDC850          17      CALL    MSGA1
0010F0 50F0 F1              10      POP AF
0010F1 50F1 C9              10      RET
                                
       50F2                     _SYS02:     ;(BDOS)コンソール出力
0010F2 50F2 CD0D51          17      CALL    BREAK
0010F5 50F5 1805            12      JR  PRINTX
                                
       50F7                     _SYS06:     ;(BDOS)コンソール直接入出力
0010F7 50F7 7B               4      LD  A,E
0010F8 50F8 3C               4      INC A
0010F9 50F9 CA4C51          10      JP  Z,_INKEY
       50FC                     PRINTX:
0010FC 50FC C3BE50          10      JP  _PRINT
                                
       50FF                     _SYS08:     ;(BDOS)エコーなしコンソール入力
0010FF 50FF CD3851          17      CALL    _SYS07
001102 5102 FE03             7      CP  3
001104 5104 CC0D51          17      CALL    Z,_BREAK
001107 5107 FE13             7      CP  013H        ;CTRL+S
001109 5109 C0              11      RET NZ
       510A                     PAUSE:
00110A 510A CD2451          17      CALL    KEYBC
                                
       510D                     _BREAK:
       510D                     BREAK:
00110D 510D F5              11      PUSH    AF
00110E 510E C5              11      PUSH    BC
00110F 510F D5              11      PUSH    DE
001110 5110 E5              11      PUSH    HL
001111 5111 DDE5            15      PUSH    IX
001113 5113 DD21B700        14      LD  IX,BREAKX
001117 5117 CDFA42          17      CALL    CALSLT_R
00111A 511A DDE1            14      POP IX
00111C 511C E1              10      POP HL
00111D 511D D1              10      POP DE
00111E 511E C1              10      POP BC
00111F 511F DC0D51          17      CALL    C,_BREAK
001122 5122 F1              10      POP AF
001123 5123 C9              10      RET
       5124                     KEYBC:
001124 5124 F5              11      PUSH    AF
001125 5125 C5              11      PUSH    BC
001126 5126 D5              11      PUSH    DE
001127 5127 E5              11      PUSH    HL
001128 5128 DDE5            15      PUSH    IX
00112A 512A DD215601        14      LD  IX,KILBUF
00112E 512E CDFA42          17      CALL    CALSLT_R
001131 5131 DDE1            14      POP IX
001133 5133 E1              10      POP HL
001134 5134 D1              10      POP DE
001135 5135 C1              10      POP BC
001136 5136 F1              10      POP AF
001137 5137 C9              10      RET
                                
       5138                     _SYS07:
       5138                     FLGET:
001138 5138 C5              11      PUSH    BC
001139 5139 D5              11      PUSH    DE
00113A 513A E5              11      PUSH    HL
00113B 513B DDE5            15      PUSH    IX
00113D 513D DD219F00        14      LD  IX,CHGET
001141 5141 CDFA42          17      CALL    CALSLT_R
001144 5144 DDE1            14      POP IX
001146 5146 E1              10      POP HL
001147 5147 D1              10      POP DE
001148 5148 C1              10      POP BC
001149 5149 FE03             7      CP  3
00114B 514B C9              10      RET
                                ;   RET NZ
                                ;   JP  CPM_BOOT
                                
       514C                     _INKEY:
       514C                     INKEY:
00114C 514C CDE651          17      CALL    CPM_CONST
00114F 514F C8              11      RET Z
001150 5150 18E6            12      JR  FLGET
                                
       5152                     _SYS0A:     ;(BDOS)文字列入力
001152 5152 C5              11      PUSH    BC
001153 5153 E5              11      PUSH    HL
001154 5154 D5              11      PUSH    DE
001155 5155 CD7E51          17      CALL    GETL
001158 5158 111FF4          10      LD  DE,KBUF
00115B 515B E1              10      POP HL
00115C 515C E5              11      PUSH    HL
00115D 515D 0E00             7      LD  C,0
00115F 515F 3004            12      JR  NC,SAX0
001161 5161 23               6      INC HL
001162 5162 23               6      INC HL
001163 5163 1808            12      JR  SAX4
       5165                     SAX0:
001165 5165 46               7      LD  B,(HL)
001166 5166 23               6      INC HL
       5167                     SAX1:
001167 5167 23               6      INC HL
001168 5168 1A               7      LD  A,(DE)
001169 5169 13               6      INC DE
00116A 516A B7               4      OR  A
00116B 516B 2004            12      JR  NZ,SAX2
       516D                     SAX4:
00116D 516D 360D            10      LD  (HL),00DH
00116F 516F 1804            12      JR  SAX3
       5171                     SAX2:
001171 5171 77               7      LD  (HL),A
001172 5172 0C               4      INC C
001173 5173 10F2            13      DJNZ    SAX1
       5175                     SAX3:
001175 5175 D1              10      POP DE
001176 5176 79               4      LD  A,C
001177 5177 13               6      INC DE
001178 5178 12               7      LD  (DE),A
001179 5179 1B               6      DEC DE
00117A 517A E1              10      POP HL
00117B 517B C1              10      POP BC
00117C 517C A7               4      AND A
00117D 517D C9              10      RET
       517E                     GETL:
00117E 517E DDE5            15      PUSH    IX
001180 5180 FDE5            15      PUSH    IY
                                
001182 5182 2ADCF3          16      LD  HL,(CSRY)
001185 5185 22CAFB          16      LD  (FSTPOS),HL
       5188                     GETL1:
001188 5188 CDFF50          17      CALL    _SYS08
00118B 518B FE09             7      CP  9
00118D 518D 2008            12      JR  NZ,GETL1V
00118F 518F 211FF4          10      LD  HL,KBUF
001192 5192 CD8643          17      CALL    MSX
001195 5195 18F1            12      JR  GETL1
       5197                     GETL1V:
001197 5197 5F               4      LD  E,A
001198 5198 FE08             7      CP  8
00119A 519A CC3452          17      CALL    Z,CTRL02
00119D 519D FE20             7      CP  020H
00119F 519F D46052          17      CALL    NC,INSERT
0011A2 51A2 CDC850          17      CALL    MSGA1
                                
0011A5 51A5 7B               4      LD  A,E
0011A6 51A6 FE0D             7      CP  00DH
0011A8 51A8 20DE            12      JR  NZ,GETL1
                                
0011AA 51AA 111FF4          10      LD  DE,KBUF
0011AD 51AD 3AB0F3          13      LD  A,(LINLEN)
0011B0 51B0 47               4      LD  B,A
0011B1 51B1 CD3E54          17      CALL    ZERO_MEMORY_DE
                                
0011B4 51B4 2ACAFB          16      LD  HL,(FSTPOS)
0011B7 51B7 3ADCF3          13      LD  A,(CSRY)
0011BA 51BA 6F               4      LD  L,A
0011BB 51BB E5              11      PUSH    HL
0011BC 51BC CD9152          17      CALL    LOC0
0011BF 51BF 4D               4      LD  C,L
0011C0 51C0 44               4      LD  B,H
0011C1 51C1 E1              10      POP HL
0011C2 51C2 3AB0F3          13      LD  A,(LINLEN)
0011C5 51C5 94               4      SUB H
0011C6 51C6 3D               4      DEC A
0011C7 51C7 5F               4      LD  E,A
0011C8 51C8 211FF4          10      LD  HL,KBUF
       51CB                     GETL2:
0011CB 51CB CD2452          17      CALL    _SCRN
0011CE 51CE 03               6      INC BC
0011CF 51CF 77               7      LD  (HL),A
0011D0 51D0 23               6      INC HL
0011D1 51D1 1D               4      DEC E
0011D2 51D2 20F7            12      JR  NZ,GETL2
0011D4 51D4 CDE550          17      CALL    MSG_CR
                                
0011D7 51D7 FDE1            14      POP IY
0011D9 51D9 DDE1            14      POP IX
       51DB                     GETL3:
0011DB 51DB 2B               6      DEC HL
0011DC 51DC 7E               7      LD  A,(HL)
0011DD 51DD FE21             7      CP  021H
0011DF 51DF D0              11      RET NC
0011E0 51E0 3600            10      LD  (HL),0
0011E2 51E2 15               4      DEC D
0011E3 51E3 20F6            12      JR  NZ,GETL3
0011E5 51E5 C9              10      RET
                                
       51E6                     _SYS0B:     ;(BDOS)コンソール状態のチェック
       51E6                     CONSTX:
       51E6                     CPM_CONST:
0011E6 51E6 C5              11      PUSH    BC
0011E7 51E7 D5              11      PUSH    DE
0011E8 51E8 E5              11      PUSH    HL
0011E9 51E9 DDE5            15      PUSH    IX
0011EB 51EB DD219C00        14      LD  IX,CHSNS
0011EF 51EF CDFA42          17      CALL    CALSLT_R
0011F2 51F2 DDE1            14      POP IX
0011F4 51F4 E1              10      POP HL
0011F5 51F5 D1              10      POP DE
0011F6 51F6 C1              10      POP BC
0011F7 51F7 C9              10      RET
                                
       51F8                     _SYS2A:     ;(BDOS)日付の獲得
0011F8 51F8 AF               4      XOR A
0011F9 51F9 57               4      LD  D,A
0011FA 51FA 5F               4      LD  E,A
0011FB 51FB 67               4      LD  H,A
0011FC 51FC 6F               4      LD  L,A
0011FD 51FD C9              10      RET
                                
       51FE                     _SYS2C:     ;(BDOS)時刻の獲得
0011FE 51FE AF               4      XOR A
0011FF 51FF 57               4      LD  D,A
001200 5200 5F               4      LD  E,A
001201 5201 67               4      LD  H,A
001202 5202 6F               4      LD  L,A
001203 5203 C9              10      RET
                                
       5204                     POS:
001204 5204 F5              11      PUSH    AF
001205 5205 2ADCF3          16      LD  HL,(CSRY)
001208 5208 7D               4      LD  A,L
001209 5209 6C               4      LD  L,H
00120A 520A 67               4      LD  H,A
00120B 520B 2C               4      INC L
00120C 520C 24               4      INC H
00120D 520D F1              10      POP AF
00120E 520E C9              10      RET
                                
       520F                     LOC:
00120F 520F F5              11      PUSH    AF
001210 5210 E5              11      PUSH    HL
001211 5211 7D               4      LD  A,L
001212 5212 6C               4      LD  L,H
001213 5213 67               4      LD  H,A
001214 5214 2D               4      DEC L
001215 5215 25               4      DEC H
001216 5216 DDE5            15      PUSH    IX
001218 5218 DD21C600        14      LD  IX,POSIT
00121C 521C CDFA42          17      CALL    CALSLT_R
00121F 521F DDE1            14      POP IX
001221 5221 E1              10      POP HL
001222 5222 F1              10      POP AF
001223 5223 C9              10      RET
                                
       5224                     _SCRN:
       5224                     SCRN:
001224 5224 E5              11      PUSH    HL
001225 5225 DDE5            15      PUSH    IX
                                
001227 5227 69               4      LD  L,C
001228 5228 60               4      LD  H,B
001229 5229 DD214A00        14      LD  IX,RDVRM
00122D 522D CDFA42          17      CALL    CALSLT_R
                                
001230 5230 DDE1            14      POP IX
001232 5232 E1              10      POP HL
001233 5233 C9              10      RET
                                
       5234                     CTRL02:
001234 5234 F5              11      PUSH    AF
001235 5235 D5              11      PUSH    DE
001236 5236 2ADCF3          16      LD  HL,(CSRY)
001239 5239 3AB0F3          13      LD  A,(LINLEN)
00123C 523C 4F               4      LD  C,A
00123D 523D 94               4      SUB H   ;CSRX
00123E 523E C602             7      ADD A,2
001240 5240 47               4      LD  B,A ;カーソルより右の文字数
001241 5241 61               4      LD  H,C ;LINLEN
001242 5242 C5              11      PUSH    BC
001243 5243 CD9152          17      CALL    LOC0
001246 5246 C1              10      POP BC
                                
001247 5247 1620             7      LD  D,020H
       5249                     C8X1:
001249 5249 DD214A00        14      LD  IX,RDVRM
00124D 524D CDFA42          17      CALL    CALSLT_R
001250 5250 4F               4      LD  C,A
001251 5251 7A               4      LD  A,D
001252 5252 DD214D00        14      LD  IX,WRTVRM
001256 5256 CDFA42          17      CALL    CALSLT_R
001259 5259 2B               6      DEC HL
00125A 525A 51               4      LD  D,C
00125B 525B 10EC            13      DJNZ    C8X1
00125D 525D D1              10      POP DE
00125E 525E F1              10      POP AF
00125F 525F C9              10      RET
                                
       5260                     INSERT:
001260 5260 F5              11      PUSH    AF
001261 5261 D5              11      PUSH    DE
001262 5262 2ADCF3          16      LD  HL,(CSRY)
001265 5265 3AB0F3          13      LD  A,(LINLEN)
001268 5268 4F               4      LD  C,A
001269 5269 94               4      SUB H   ;CSRX
00126A 526A 3C               4      INC A
00126B 526B 47               4      LD  B,A ;カーソルより右の文字数
00126C 526C C5              11      PUSH    BC
00126D 526D CD9152          17      CALL    LOC0
001270 5270 C1              10      POP BC
                                
001271 5271 1620             7      LD  D,020H
       5273                     INS1:
001273 5273 DD214A00        14      LD  IX,RDVRM
001277 5277 CDFA42          17      CALL    CALSLT_R
00127A 527A 4F               4      LD  C,A
00127B 527B 7A               4      LD  A,D
00127C 527C DD214D00        14      LD  IX,WRTVRM
001280 5280 CDFA42          17      CALL    CALSLT_R
001283 5283 23               6      INC HL
001284 5284 51               4      LD  D,C
001285 5285 10EC            13      DJNZ    INS1
001287 5287 D1              10      POP DE
001288 5288 F1              10      POP AF
001289 5289 C9              10      RET
                                
       528A                     CONOUT1:
00128A 528A 59               4      LD  E,C
00128B 528B C3BE50          10      JP  _PRINT
                                
       528E                     GETVRAM:
00128E 528E 2ADCF3          16      LD  HL,(CSRY)
       5291                     LOC0:
001291 5291 2D               4      DEC L
001292 5292 25               4      DEC H
001293 5293 4C               4      LD  C,H ;CSRX-1
001294 5294 5D               4      LD  E,L ;CSRY-1
       5295                     LOC1:
001295 5295 3AB0F3          13      LD  A,(LINLEN)
001298 5298 67               4      LD  H,A
001299 5299 1600             7      LD  D,0
00129B 529B 6A               4      LD  L,D ;0
00129C 529C 0608             7      LD  B,8
       529E                     LOC2:
00129E 529E 29              11      ADD HL,HL
00129F 529F 3001            12      JR  NC,LOC3
0012A1 52A1 19              11      ADD HL,DE
       52A2                     LOC3:
0012A2 52A2 10FA            13      DJNZ    LOC2
0012A4 52A4 09              11      ADD HL,BC
0012A5 52A5 C9              10      RET
                                
       52A6                     _SYS0C:     ;(BDOS)バージョン番号の獲得
0012A6 52A6 212200          10      LD  HL,00022H
0012A9 52A9 AF               4      XOR A
0012AA 52AA 7D               4      LD  A,L
0012AB 52AB C9              10      RET
                                
       52AC                     _SYS0D:     ;(BDOS)ディスク・リセット
0012AC 52AC 218000          10      LD  HL,00080H
0012AF 52AF 2230F1          16      LD  (_DTA),HL
0012B2 52B2 C9              10      RET
                                
       52B3                     _SYS0E:     ;(BDOS)カレントドライブの設定
0012B3 52B3 3246F1          13      LD  (_DVSW),A
0012B6 52B6 C9              10      RET
                                
       52B7                     _SYS0F:     ;(BDOS)ファイルのオープン
0012B7 52B7 D5              11      PUSH    DE
0012B8 52B8 FDE1            14      POP IY
0012BA 52BA CD2554          17      CALL    INIT_FILE
0012BD 52BD CDB84B          17      CALL    ROM_OPEN
0012C0 52C0 3856            12      JR  C,SCF_FF_RET
                                ;               Open(Read)
0012C2 52C2 FD361CFF        19      LD  (IY+28),0FFH
                                ;               FILENAME
0012C6 52C6 FDE5            15      PUSH    IY
0012C8 52C8 D1              10      POP DE
0012C9 52C9 13               6      INC DE
0012CA 52CA 010B00          10      LD  BC,11
0012CD 52CD EDB0                    LDIR
                                ;               Attribute
0012CF 52CF 7E               7      LD  A,(HL)
0012D0 52D0 FD770D          19      LD  (IY+13),A
                                ;               TIME
0012D3 52D3 110B00          10      LD  DE,11
0012D6 52D6 19              11      ADD HL,DE
0012D7 52D7 7E               7      LD  A,(HL)
0012D8 52D8 23               6      INC HL
0012D9 52D9 FD7716          19      LD  (IY+22),A
0012DC 52DC 7E               7      LD  A,(HL)
0012DD 52DD 23               6      INC HL
0012DE 52DE FD7717          19      LD  (IY+23),A
                                ;               DATE
0012E1 52E1 7E               7      LD  A,(HL)
0012E2 52E2 23               6      INC HL
0012E3 52E3 FD7714          19      LD  (IY+20),A
0012E6 52E6 7E               7      LD  A,(HL)
0012E7 52E7 23               6      INC HL
0012E8 52E8 FD7715          19      LD  (IY+21),A
                                ;               First cluster
0012EB 52EB 7E               7      LD  A,(HL)
0012EC 52EC 23               6      INC HL
0012ED 52ED FD771A          19      LD  (IY+26),A
0012F0 52F0 7E               7      LD  A,(HL)
0012F1 52F1 23               6      INC HL
0012F2 52F2 FD771B          19      LD  (IY+27),A
                                ;               SIZE
0012F5 52F5 7E               7      LD  A,(HL)
0012F6 52F6 23               6      INC HL
0012F7 52F7 FD7710          19      LD  (IY+16),A
0012FA 52FA 7E               7      LD  A,(HL)
0012FB 52FB 23               6      INC HL
0012FC 52FC FD7711          19      LD  (IY+17),A
0012FF 52FF 7E               7      LD  A,(HL)
001300 5300 23               6      INC HL
001301 5301 FD7712          19      LD  (IY+18),A
001304 5304 7E               7      LD  A,(HL)
001305 5305 FD7713          19      LD  (IY+19),A
001308 5308 AF               4      XOR A
001309 5309 FD770C          19      LD  (IY+12),A
00130C 530C C9              10      RET
                                
       530D                     _SYS10:     ;(BDOS)ファイルのクローズ
00130D 530D AF               4      XOR A
00130E 530E C9              10      RET
                                
       530F                     S11X1:
00130F 530F FD7119          19      LD  (IY+25),C       ;RootEntCnt
001312 5312 FD750E          19      LD  (IY+14),L
001315 5315 FD740F          19      LD  (IY+15),H
       5318                     SCF_FF_RET:
001318 5318 37               4      SCF
001319 5319 9F               4      SBC A,A
00131A 531A C9              10      RET
                                
       531B                     _SYS11:     ;(BDOS)最初のファイルの検索
00131B 531B ED5333F1        20      LD  (_FCB),DE
00131F 531F D5              11      PUSH    DE
001320 5320 FDE1            14      POP IY
001322 5322 CD2554          17      CALL    INIT_FILE
001325 5325 CD0A4E          17      CALL    GET_DIR_DAT
       5328                     S12X1:
001328 5328 CDD44B          17      CALL    FILESE
00132B 532B 30E2            12      JR  NC,S11X1
00132D 532D 0D               4      DEC C
00132E 532E FD7119          19      LD  (IY+25),C       ;RootEntCnt
001331 5331 FDCB0D66        20      BIT 4,(IY+13)
001335 5335 2809            12      JR  Z,S12X2
001337 5337 E5              11      PUSH    HL
001338 5338 DDE1            14      POP IX
00133A 533A DDCB0E66        20      BIT 4,(IX+1+13)
00133E 533E 28E8            12      JR  Z,S12X1
       5340                     S12X2:
001340 5340 012000          10      LD  BC,32
001343 5343 ED5B30F1        20      LD  DE,(_DTA)
001347 5347 AF               4      XOR A
001348 5348 12               7      LD  (DE),A      ;ドライブ番号
001349 5349 13               6      INC DE
00134A 534A EDB0                    LDIR            ;ディレクトリエントリ
00134C 534C FD750E          19      LD  (IY+14),L
00134F 534F FD740F          19      LD  (IY+15),H
001352 5352 C9              10      RET
                                
       5353                     _SYS12:
001353 5353 FD2A33F1        20      LD  IY,(_FCB)
001357 5357 FDE5            15      PUSH    IY
001359 5359 D1              10      POP DE
00135A 535A CD2554          17      CALL    INIT_FILE
                                
00135D 535D FD6E0E          19      LD  L,(IY+14)
001360 5360 FD660F          19      LD  H,(IY+15)
001363 5363 FD4E19          19      LD  C,(IY+25)
001366 5366 18C0            12      JR  S12X1
                                
       5368                     _SYS14:     ;(BDOS)シーケンシャルな読み出し
001368 5368 CDF04D          17      CALL    SET_FCB
00136B 536B CDBE4D          17      CALL    GETSEQ
00136E 536E CDAB4D          17      CALL    RB_READ
001371 5371 E5              11      PUSH    HL
001372 5372 CDCB4D          17      CALL    SETSEQ
001375 5375 E1              10      POP HL
       5376                     SREAD:
001376 5376 C601             7      ADD A,001H
001378 5378 D8              11      RET C
                                
001379 5379 7D               4      LD  A,L
00137A 537A D601             7      SUB 001H
00137C 537C 9F               4      SBC A,A
00137D 537D E603             7      AND 3
00137F 537F 1F               4      RRA
001380 5380 C9              10      RET
                                
       5381                     _SYS18:     ;(BDOS)ログインベクトルの獲得
001381 5381 210100          10      LD  HL,00001H
001384 5384 AF               4      XOR A
001385 5385 C9              10      RET
                                
       5386                     _SYS19:     ;(BDOS)カレントドライブ番号の獲得
001386 5386 3A46F1          13      LD  A,(_DVSW)
001389 5389 C9              10      RET
                                
       538A                     _SYS1A:     ;(BDOS)DTAの設定
00138A 538A ED5330F1        20      LD  (_DTA),DE
00138E 538E AF               4      XOR A
00138F 538F C9              10      RET
                                
       5390                     _SYS1B:     ;(BDOS)ディスク情報の獲得
001390 5390 010002          10      LD  BC,512
001393 5393 11C302          10      LD  DE,707
001396 5396 210000          10      LD  HL,0
001399 5399 DD2135F1        14      LD  IX,_BUF
00139D 539D FD2135F1        14      LD  IY,_BUF
0013A1 53A1 FD3600F9        19      LD  (IY+0),0F9H
0013A5 53A5 3E02             7      LD  A,2
0013A7 53A7 C9              10      RET
                                
       53A8                     _SYS21:     ;(BDOS)ランダムな読み出し
0013A8 53A8 CDF04D          17      CALL    SET_FCB
                                
0013AB 53AB FD6E21          19      LD  L,(IY+33)   ;(FCB)Random record
0013AE 53AE FD6622          19      LD  H,(IY+34)
                                
0013B1 53B1 CDAB4D          17      CALL    RB_READ
0013B4 53B4 18C0            12      JR  SREAD
                                
       53B6                     _SYS23:     ;(BDOS)ファイル・サイズの獲得
0013B6 53B6 CDB752          17      CALL    _SYS0F
0013B9 53B9 D8              11      RET C
                                
0013BA 53BA D5              11      PUSH    DE      ;EX DE,IY
0013BB 53BB FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013BD 53BD CDE04D          17      CALL    GETSIZE
       53C0                     _S24X1:
0013C0 53C0 FD7521          19      LD  (IY+33),L   ;(FCB)Random record
0013C3 53C3 FD7422          19      LD  (IY+34),H
0013C6 53C6 FD362300        19      LD  (IY+35),0
                                ;   POP DE      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                ;   PUSH    DE      ;EX DE,IY
0013CA 53CA FDE3            23      EX  (SP),IY     ;
0013CC 53CC D1              10      POP DE      ;
                                
0013CD 53CD AF               4      XOR A
0013CE 53CE C9              10      RET
                                
       53CF                     _SYS24:     ;(BDOS)ランダム・レコード・フィールドの設定
0013CF 53CF E5              11      PUSH    HL
0013D0 53D0 D5              11      PUSH    DE      ;EX DE,IY
0013D1 53D1 FDE3            23      EX  (SP),IY     ;
                                ;   POP DE      ;
                                ;   PUSH    DE      ;DEを破壊しないように注意vv
0013D3 53D3 CDBE4D          17      CALL    GETSEQ
0013D6 53D6 18E8            12      JR  _S24X1      ;^^^^^^^^^^^^^^^^^^^^^^^^
                                
       53D8                     _SYS27:     ;(BDOS)ランダムブロック読み込み
0013D8 53D8 CDF04D          17      CALL    SET_FCB
0013DB 53DB E5              11      PUSH    HL
0013DC 53DC FD6E21          19      LD  L,(IY+33)
0013DF 53DF FD6622          19      LD  H,(IY+34)
0013E2 53E2 2226F1          16      LD  (RR_LOW),HL
0013E5 53E5 FD6E23          19      LD  L,(IY+35)
0013E8 53E8 FD6624          19      LD  H,(IY+36)
0013EB 53EB 2228F1          16      LD  (RR_HIGH),HL
0013EE 53EE E1              10      POP HL
0013EF 53EF CD9D49          17      CALL    ROM_READ
0013F2 53F2 ED5B26F1        20      LD  DE,(RR_LOW)
0013F6 53F6 FD7321          19      LD  (IY+33),E
0013F9 53F9 FD7222          19      LD  (IY+34),D
0013FC 53FC ED5B28F1        20      LD  DE,(RR_HIGH)
001400 5400 FD7323          19      LD  (IY+35),E
001403 5403 FD7224          19      LD  (IY+36),D
001406 5406 9F               4      SBC A,A
001407 5407 C9              10      RET
                                
       5408                     _SYS2F:
001408 5408 44               4      LD  B,H
001409 5409 2A30F1          16      LD  HL,(_DTA)
00140C 540C C3C84E          10      JP  DISKIO
                                
       540F                     _SYS5A:
00140F 540F 0600             7      LD  B,0
001411 5411 D5              11      PUSH    DE
001412 5412 DDE1            14      POP IX
       5414                     _SX5A1:
001414 5414 1A               7      LD  A,(DE)
001415 5415 B7               4      OR  A
001416 5416 2804            12      JR  Z,_SX5A2
001418 5418 13               6      INC DE
001419 5419 04               4      INC B
00141A 541A 18F8            12      JR  _SX5A1
                                
       541C                     _SX5A2:
00141C 541C 78               4      LD  A,B
00141D 541D CD664A          17      CALL    FILE_BDOS
001420 5420 CD8B4E          17      CALL    ROM_CD
001423 5423 9F               4      SBC A,A
001424 5424 C9              10      RET
                                
       5425                     INIT_FILE:
001425 5425 EB               4      EX  DE,HL
001426 5426 1150F1          10      LD  DE,FDRV
001429 5429 010C00          10      LD  BC,1+8+3
00142C 542C EDB0                    LDIR
00142E 542E CD6950          17      CALL    GET_DISK_BANK_FDRV
001431 5431 320068          13      LD  (BANK1_SEL),A           ;ASCII-8K/Konami-8K
001434 5434 320070          13      LD  (KONAMI_SCC_BANK1_SEL),A    ;Konami-8K/Konami-SCC
001437 5437 2A5CF1          16      LD  HL,(_CD)
00143A 543A 225EF1          16      LD  (_CDX),HL           ;カレントディレクトリ
00143D 543D C9              10      RET
                                
       543E                     ZERO_MEMORY_DE:
00143E 543E AF               4      XOR A
       543F                     FILL_MEMORY_DE:
00143F 543F 12               7      LD  (DE),A
001440 5440 13               6      INC DE
001441 5441 10FC            13      DJNZ    FILL_MEMORY_DE
001443 5443 C9              10      RET
                                
001444 5444                         DS  05F00H-$
       5F00                     STABLE:
                                ;0
001F00 5F00 AB50C150F250AB50        DW  _ERROR,_SYS01,_SYS02,_ERROR
001F08 5F08 AB50AB50F7503851        DW  _ERROR,_ERROR,_SYS06,_SYS07
001F10 5F10 FF50AB505251E651        DW  _SYS08,_ERROR,_SYS0A,_SYS0B
001F18 5F18 A652AC52B352B752        DW  _SYS0C,_SYS0D,_SYS0E,_SYS0F
                                ;1
001F20 5F20 0D531B535353AB50        DW  _SYS10,_SYS11,_SYS12,_ERROR
001F28 5F28 6853AB50AB50AB50        DW  _SYS14,_ERROR,_ERROR,_ERROR
001F30 5F30 815386538A539053        DW  _SYS18,_SYS19,_SYS1A,_SYS1B
001F38 5F38 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;2
001F40 5F40 AB50AB50AB50B653        DW  _ERROR,_ERROR,_ERROR,_SYS23
001F48 5F48 CF53AB50AB50D853        DW  _SYS24,_ERROR,_ERROR,_SYS27
001F50 5F50 AB50AB50F851AB50        DW  _ERROR,_ERROR,_SYS2A,_ERROR
001F58 5F58 FE51AB50AB500854        DW  _SYS2C,_ERROR,_ERROR,_SYS2F
                                ;3
001F60 5F60 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F68 5F68 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F70 5F70 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F78 5F78 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;4
001F80 5F80 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F88 5F88 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F90 5F90 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001F98 5F98 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;5
001FA0 5FA0 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FA8 5FA8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FB0 5FB0 AB50AB500F54AB50        DW  _ERROR,_ERROR,_SYS5A,_ERROR
001FB8 5FB8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;6
001FC0 5FC0 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FC8 5FC8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD0 5FD0 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FD8 5FD8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                ;7
001FE0 5FE0 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FE8 5FE8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF0 5FF0 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
001FF8 5FF8 AB50AB50AB50AB50        DW  _ERROR,_ERROR,_ERROR,_ERROR
                                
[EOF:BDOS.ASM:UTF_8]
       6000                     LAST_ADR:
                                
                                    END
[EOF:DISKROM32.ASM:UTF_8]
